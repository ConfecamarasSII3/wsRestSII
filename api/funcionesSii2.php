<?php

class funcionesSii2 {

    public static function actualizarMregEstInscritos($dbx, $data, $codbarras = '', $tt = '', $rec = '') {
        require_once ('LogSii2.class.php');
        $nameLog = 'actualizarMregEstInscritos_' . date("Ymd");

        // Valida que el expediente tenga diferencias
        if (ltrim($data["matricula"], "0") == '' && ltrim($data["proponente"], "0") == '') {
            return true;
        }

        //
        $eOri = \funcionesSii2::retornarExpedienteMercantilSii($dbx, $data["matricula"], '', '', '', 'si', 'N');

        //
        if (!isset($data["fecexafiliacion"])) {
            $data["fecexafiliacion"] = $eOri["fecexafiliacion"];
        }
        if (!isset($data["latitud"])) {
            $data["latitud"] = $eOri["latitud"];
        }
        if (!isset($data["longitud"])) {
            $data["longitud"] = $eOri["longitud"];
        }
        if (!isset($data["econmixta"])) {
            $data["econmixta"] = $eOri["econmixta"];
        }
        if (!isset($data["desactiv"])) {
            $data["desactiv"] = $eOri["desactiv"];
        }
        if (!isset($data["telcor2"])) {
            $data["telcor2"] = '';
        }
        if (!isset($data["cap_apotra"])) {
            $data["cap_apotra"] = 0;
        }
        if (!isset($data["apolab"])) {
            $data["apolab"] = 0;
        }
        if (!isset($data["apolabadi"])) {
            $data["apolabadi"] = 0;
        }
        if (!isset($data["apodin"])) {
            $data["apodin"] = 0;
        }
        if (!isset($data["apotot"])) {
            $data["apotot"] = 0;
        }
        if (!isset($data["apotra"])) {
            $data["apotra"] = 0;
        }
        if (!isset($data["apoact"])) {
            $data["apoact"] = 0;
        }
        if (!isset($data["patnet"])) {
            $data["patnet"] = 0;
        }

        if (!isset($data["cap_porcnalpub"]) || ltrim($data["cap_porcnalpub"], "0") == '') {
            $data["cap_porcnalpub"] = 0;
        }
        if (!isset($data["cap_porcnalpri"]) || ltrim($data["cap_porcnalpri"], "0") == '') {
            $data["cap_porcnalpri"] = 0;
        }
        if (!isset($data["cap_porcextpub"]) || ltrim($data["cap_porcextpub"], "0") == '') {
            $data["cap_porcextpub"] = 0;
        }
        if (!isset($data["cap_porcextpri"]) || ltrim($data["cap_porcextpri"], "0") == '') {
            $data["cap_porcextpri"] = 0;
        }

        if (!isset($data["codigopostalcom"])) {
            $data["codigopostalcom"] = '';
        }
        if (!isset($data["codigopostalnot"])) {
            $data["codigopostalnot"] = '';
        }
        if (!isset($data["fechainiact1"])) {
            $data["fechainiact1"] = '';
        }
        if (!isset($data["fechainiact2"])) {
            $data["fechainiact2"] = '';
        }
        if (!isset($data["codaduaneros"])) {
            $data["codaduaneros"] = '';
        }
        if (!isset($data["gruponiif"])) {
            $data["gruponiif"] = '';
        }
        if (!isset($data["niifconciliacion"])) {
            $data["niifconciliacion"] = '';
        }
        if (!isset($data["ctrderpub"])) {
            $data["ctrderpub"] = '';
        }
        if (!isset($data["ctrcodcoop"])) {
            $data["ctrcodcoop"] = '';
        }
        if (!isset($data["ctrcodotras"])) {
            $data["ctrcodotras"] = '';
        }
        if (!isset($data["ctrdepuracion1727"])) {
            $data["ctrdepuracion1727"] = $eOri["ctrdepuracion1727"];
        }
        if (!isset($data["ctrfechadepuracion1727"])) {
            $data["ctrfechadepuracion1727"] = $eOri["ctrfechadepuracion1727"];
        }
        if (!isset($data["ctrben658"])) {
            $data["ctrben658"] = $eOri["ctrben658"];
        }
        if (!isset($data["cumplerequisitos1780"])) {
            $data["cumplerequisitos1780"] = '';
        }
        if (!isset($data["renunciabeneficios1780"])) {
            $data["renunciabeneficios1780"] = '';
        }
        if (!isset($data["cumplerequisitos1780primren"])) {
            $data["cumplerequisitos1780primren"] = '';
        }

        if (!isset($data["vigcontrol"])) {
            $data["vigcontrol"] = '';
        }
        if (!isset($data["idorigenperj"])) {
            $data["idorigenperj"] = '';
        }
        if (!isset($data["origendocconst"])) {
            $data["origendocconst"] = '';
        }
        if (!isset($data["numperj"])) {
            $data["numperj"] = '';
        }
        if (!isset($data["fecperj"])) {
            $data["fecperj"] = '';
        }
        if (!isset($data["vigifecini"])) {
            $data["vigifecini"] = '';
        }
        if (!isset($data["vigifecfin"])) {
            $data["vigifecfin"] = '';
        }

        if (!isset($data["nrocontrolreactivacion"])) {
            $data["nrocontrolreactivacion"] = '';
        }
        if (!isset($data["fechanacimiento"])) {
            $data["fechanacimiento"] = '';
        }
        if (!isset($data["ideext"])) {
            $data["ideext"] = '';
        }
        if (!isset($data["anodatoscap"])) {
            $data["anodatoscap"] = '';
        }
        if (!isset($data["fechadatoscap"])) {
            $data["fechadatoscap"] = '';
        }
        if (!isset($data["cpafili"])) {
            $data["cpafili"] = '';
        }
        if (!isset($data["cpsaldo"])) {
            $data["cpsaldo"] = 0;
        }
        if (!isset($data["cpurenafi"])) {
            $data["cpurenafi"] = '';
        }
        if (!isset($data["feciniact1"])) {
            $data["feciniact1"] = '';
        }
        if (!isset($data["feciniact2"])) {
            $data["feciniact2"] = '';
        }
        if (!isset($data["estadocapturado"])) {
            $data["estadocapturado"] = '';
        }
        if (!isset($data["estadocapturadootros"])) {
            $data["estadocapturadootros"] = '';
        }
        if (!isset($data["cantest"])) {
            $data["cantest"] = 0;
        }
        if (!isset($data["certificardesde"])) {
            $data["certificardesde"] = '';
        }
        if (!isset($data["ctrbic"])) {
            $data["ctrbic"] = '';
        }

        if (substr($data["matricula"], 0, 1) == 'S') {
            if ($data["estadomatricula"] == 'MA') {
                $data["estadomatricula"] = 'IA';
            }
            if ($data["estadomatricula"] == 'MC') {
                $data["estadomatricula"] = 'IC';
            }
            if ($data["estadomatricula"] == 'MI') {
                $data["estadomatricula"] = 'II';
            }
        }

        //
        $grabarpor = '';
        $dataori = array();
        if ($data["matricula"] != '') {
            $dataori = retornarRegistroMysqli2($dbx, 'mreg_est_inscritos', "matricula='" . ltrim($data["matricula"], "0") . "'");
            $grabarpor = 'matricula';
        } else {
            if ($data["proponente"] != '') {
                $dataori = retornarRegistroMysqli2($dbx, 'mreg_est_inscritos', "proponente='" . ltrim($data["proponente"], "0") . "'");
                $grabarpor = 'proponente';
            }
        }


        // Control de libros de comercio
        $ctrlibroscomercio = 'N';
        if (!empty($data["libroscomercio"])) {
            if (count($data["libroscomercio"]) > 0) {
                $ctrlibroscomercio = 'S';
            }
        }

        //  Control de embargo
        $ctrembargo = 'N';
        if (!empty($data["ctrembargos"])) {
            foreach ($data["ctrembargos"] as $embx) {
                if ($embx["acto"] == '0900' || $embx["acto"] == '0910' || $embx["acto"] == '1000') {
                    if ($embx["estado"] == '1') {
                        $ctrembargo = 'S';
                    }
                }
            }
        }

        //  Control de embargos en tramite
        $ctrembargotramite = 'N';
        $ctrrecursotramite = 'N';
        if (!empty($data["lcodigosbarras"])) {
            foreach ($data["lcodigosbarras"] as $cbax) {
                if ($cbax["ttra"] == '07') {
                    $ctrembargotramite = 'S';
                }
                if ($cbax["ttra"] == '19' || $cbax["ttra"] == '54') {
                    $ctrrecursotramite = 'S';
                }
            }
        }


        // Localiza primer representante legal
        $idereplegal = '';
        $nomreplegal = '';
        if (!empty($data["replegal"])) {
            foreach ($data["replegal"] as $vinx) {
                if ($idereplegal == '') {
                    if ($vinx["vinculoreplegal"] == '2170' ||
                            $vinx["vinculoreplegal"] == '4170') {
                        $idereplegal = $vinx["identificacionreplegal"];
                        $nomreplegal = $vinx["nombrereplegal"];
                    }
                }
            }
        }

        // Localiza documento de constitucion
        $numdocconst = '';
        $fecdocconst = '';
        $oridocconst = $data["origendocconst"];
        if (trim($oridocconst) == '') {
            if (!empty($data["inscripciones"])) {
                foreach ($data["inscripciones"] as $insx) {
                    if ($insx["acto"] == '0040') {
                        $numdocconst = $insx["ndoc"];
                        $fecdocconst = $insx["fdoc"];
                        $oridocconst = $insx["txoridoc"];
                    }
                }
            }
        }



        $nomsegcon = '';
        $carsegcon = '';
        if (isset($data["nombresegundocontacto"])) {
            $nomsegcon = $data["nombresegundocontacto"];
        }
        if (isset($data["cargosegundocontacto"])) {
            $carsegcon = $data["cargosegundocontacto"];
        }

        $econmixta = '';
        if (isset($data["econmixta"])) {
            $econmixta = $data["econmixta"];
        }

        $capesadl = 0;
        if (isset($data["capesadl"])) {
            $capesadl = $data["capesadl"];
        }

        //
        if (trim($data["nuevonombre"]) != '') {
            if (trim($data["nuevonombre"]) != $data["nombre"]) {
                $data["nombreanterior"] = $data["nombre"];
                $data["nombre"] = $data["nuevonombre"];
            }
        }

        // 2018-04-11 : JINT: Controles que se incluyen para pevenir que al actualizar el expediente
        // se elimine información vital
        if ($data["matricula"] != '') {
            if ($data["afiliado"] == '') {
                if (!isset($dataori["ctrafiliacion"])) {
                    $data["afiliado"] = $dataori["ctrafiliacion"];
                }
            }
            if ($data["dircom"] == '') {
                if (!isset($dataori["dircom"])) {
                    $data["dircom"] = $dataori["dircom"];
                }
            }
            if ($data["muncom"] == '') {
                if (!isset($dataori["muncom"])) {
                    $data["muncom"] = $dataori["muncom"];
                }
            }
            if ($data["proponente"] == '') {
                if (!isset($dataori["proponente"])) {
                    $data["proponente"] = $dataori["proponente"];
                }
            }
        }

        // 249
        $arrCampos = array(
            'matricula',
            'proponente',
            'organizacion',
            'categoria',
            'naturaleza',
            'nrocontrolreactivacion',
            'razonsocial',
            'sigla',
            'complementorazonsocial',
            'nombrecomercial',
            'lggr',
            'nombre1',
            'nombre2',
            'apellido1',
            'apellido2',
            'idclase',
            'numid',
            'numidextenso',
            'idmunidoc',
            'fechanacimiento',
            'fecexpdoc',
            'paisexpdoc',
            'nacionalidad',
            'idetripaiori', // Nuevo
            'paiori', // nuevo
            'idetriextep', // Nuevo
            'prerut',
            'admondian',
            'nit',
            'estadonit',
            'fecmatricula',
            'fecrenovacion',
            'ultanoren',
            'feccancelacion',
            'motivocancelacion', // Nuevo
            'fecconstitucion',
            'fecdisolucion',
            'fecliquidacion',
            'estadotipoliquidacion', // Nuevo
            'fecvigencia',
            'tamanoempresa',
            'emprendedor28',
            'pemprendedor28',
            'empresafamiliar', // Nuevo
            'procesosinnovacion', // Nuevo
            'tipogruemp', // Nuevo
            'nombregruemp', // Nuevo
            'vigcontrol', // Entidad que ejerce la vigilancia y control
            'vigifecini',
            'vigifecfin',
            'numperj',
            'fecperj',
            'otorgaperj',
            'numdocconst',
            'fecdocconst',
            'origendocconst',
            'fecmatant',
            'fecrenant',
            'camant',
            'munant',
            'ultanorenant',
            'matant',
            'benart7ant',
            'benley1780ant',
            'dircom',
            'dircom_tipovia',
            'dircom_numvia',
            'dircom_apevia',
            'dircom_orivia',
            'dircom_numcruce',
            'dircom_apecruce',
            'dircom_oricruce',
            'dircom_numplaca',
            'dircom_complemento',
            'codigopostalcom',
            'codigozonacom', // Nuevo
            'barriocom',
            'muncom',
            'paicom', // Nuevo
            'telcom1',
            'telcom2',
            'telcom3',
            'emailcom',
            'emailcom2',
            'emailcom3',
            'urlcom',
            'aacom',
            'faxcom',
            'numpredial',
            'latitud',
            'longitud',
            'dirnot',
            'dirnot_tipovia',
            'dirnot_numvia',
            'dirnot_apevia',
            'dirnot_orivia',
            'dirnot_numcruce',
            'dirnot_apecruce',
            'dirnot_oricruce',
            'dirnot_numplaca',
            'dirnot_complemento',
            'codigopostalnot',
            'codigozonanot', // Nuevo
            'barrionot',
            'munnot',
            'painot', // Nuevo
            'telnot',
            'telnot2',
            'telnot3',
            'emailnot',
            'urlnot',
            'aanot',
            'faxnot',
            'tiposedeadm',
            'dircor',
            'muncor',
            'telcor',
            'telcor2',
            'ciiu1',
            'ciiu2',
            'ciiu3',
            'ciiu4',
            'ciiu5',
            'versionciiu',
            'feciniact1', // Nuevo
            'feciniact2', // Nuevo
            'codaduaneros', // Nuevo
            'actividad',
            'fecaflia',
            'fecactaaflia',
            'numactaaflia',
            'fecactacanaflia',
            'numactacanaflia',
            'anorenaflia',
            'fecrenaflia',
            'valpagaflia',
            'saldoaflia',
            'telaflia',
            'diraflia',
            'munaflia',
            'profaflia',
            'contaflia',
            'dircontaflia',
            'muncontaflia',
            'fecexafiliacion',
            'ctrexpedienteinactivo',
            'ctrestmatricula',
            'ctrestdatos',
            'ctrcertificardesde',
            'ctrestproponente',
            'ctrtipopropiedad',
            'ctrlibroscomercio',
            'ctrafiliacion',
            'ctrvigilancia',
            'ctrestadoactiva',
            'ctrestadopreoperativa',
            'ctrconcordato',
            'ctrestadointervenida',
            'ctrestadodisuelta',
            'ctrestadoenreestructuracion',
            'ctrestadocapturado', //Nuevo
            'ctrestadocapturadootros', // Nuevo
            'ctrembargo',
            'ctrembargostramite',
            'ctrrecursostramite',
            'ctrimpexp',
            'ctrtipolocal',
            'ctrfun',
            'ctrubi',
            'ctrclasegenesadl',
            'ctrclaseespeesadl',
            'ctrclaseeconsoli',
            'ctrderpub',
            'ctrcodcoop',
            'ctrcodotras',
            'ctreconmixta',
            'ctresacntasociados', // Nuevo
            'ctresacntmujeres', // Nuevo
            'ctresacnthombres', // Nuevo
            'ctresapertgremio', // Nuevo
            'ctresagremio', // Nuevo
            'ctresaacredita', // Nuevo
            'ctresaivc', // Nuevo
            'ctresainfoivc', // Nuevo
            'ctresaautregistro', // Nuevo
            'ctresaentautoriza', // Nuevo
            'ctresacodnat', // Nuevo
            'ctresadiscap', // Nuevo
            'ctresaetnia', // Nuevo
            'ctresacualetnia', // Nuevo
            'ctresadespvictreins', // Nuevo
            'ctresacualdespvictreins', // Nuevo
            'ctresaindgest', // Nuevo
            'ctresalgbti', // Nuevo
            'ctrbenart4',
            'ctrbenart7',
            'ctrbenart50',
            'ctrbenley1780',
            'cumplerequisitos1780',
            'renunciabeneficios1780',
            'cumplerequisitos1780primren',
            'ctrcance1429',
            'ctrdepuracion1727',
            'ctrfechadepuracion1727',
            'ctrben658',
            'ctrnotemail',
            'ctrnotsms',
            'ctrivcarea', // Double
            'ctrivcver',
            'ctrivccretip',
            'ctrivcali',
            'ctrivcqui',
            'ctrivcriesgo',
            'ctrivcenvio',
            'ctrivcsuelos',
            'ctrbic',
            'cantest',
            'idereplegal',
            'nomreplegal',
            'gruponiif', // Nuevo
            'niifconciliacion', // Nuevo
            'aportantesegsocial', // Nuevo
            'tipoaportantesegsocial', // Nuevo
            'anodatos',
            'fecdatos',
            'personal',
            'personaltemp',
            'actcte',
            'actnocte',
            'actfij',
            'fijnet',
            'actval',
            'actotr',
            'acttot',
            'actsinaju',
            'invent',
            'pascte',
            'paslar',
            'pastot',
            'pattot',
            'paspat',
            'balsoc',
            'ingope',
            'ingnoope',
            'gasope',
            'gasnoope',
            'gtoven',
            'gtoadm',
            'utiope',
            'utinet',
            'cosven',
            'depamo',
            'gasint',
            'gasimp',
            'actvin',
            'patrimonio',
            'anodatoscap',
            'fecdatoscap',
            'capaut',
            'capsus',
            'cappag',
            'capsoc',
            'apolab',
            'apolabadi',
            'apodin',
            'apotra',
            'apoact',
            'apotot',
            'capesadl',
            'pornalpri',
            'pornalpub',
            'pornaltot',
            'porextpri',
            'porextpub',
            'porexttot',
            'nomsegcon',
            'carsegcon',
            'cntest01',
            'cntest02',
            'cntest03',
            'cntest04',
            'cntest05',
            'cntest06',
            'cntest07',
            'cntest08',
            'cntest09',
            'cntest10',
            'cntest11',
            'refcrenom1',
            'refcreofi1',
            'refcretel1', // Nuevo
            'refcrenom2',
            'refcreofi2',
            'refcretel2', // Nuevo
            'refcomnom1',
            'refcomdir1',
            'refcomtel1',
            'refcomnom2',
            'refcomdir2',
            'refcomtel2',
            'cpcodcam',
            'cpnummat',
            'cprazsoc',
            'cpnumnit',
            'cpdircom',
            'cpdirnot',
            'cpnumtel',
            'cpnumfax',
            'cpcodmun',
            'cpmunnot',
            'cpafili',
            'cpsaldo', // Double
            'cpurenafi',
            'fecactualizacion',
            'compite360',
            'rues',
            'ivc'
        );

        // 249
        $arrValores = array(
            "'" . ltrim($data["matricula"], "0") . "'",
            "'" . ltrim($data["proponente"], "0") . "'",
            "'" . $data["organizacion"] . "'",
            "'" . $data["categoria"] . "'",
            "'" . $data["naturaleza"] . "'",
            "'" . $data["nrocontrolreactivacion"] . "'",
            "'" . addslashes(trim($data["nombre"])) . "'",
            "'" . addslashes(trim($data["sigla"])) . "'",
            "'" . addslashes(trim($data["complementorazonsocial"])) . "'",
            "''", // Nombre comercial
            "'" . addslashes(trim($data["lggr"])) . "'",
            "'" . addslashes(trim($data["nom1"])) . "'",
            "'" . addslashes(trim($data["nom2"])) . "'",
            "'" . addslashes(trim($data["ape1"])) . "'",
            "'" . addslashes(trim($data["ape2"])) . "'",
            "'" . trim($data["tipoidentificacion"]) . "'",
            "'" . trim($data["identificacion"]) . "'",
            "'" . trim($data["ideext"]) . "'",
            "'" . trim($data["idmunidoc"]) . "'",
            "'" . trim($data["fechanacimiento"]) . "'",
            "'" . trim($data["fecexpdoc"]) . "'",
            "'" . trim($data["paisexpdoc"]) . "'",
            "'" . trim($data["nacionalidad"]) . "'",
            "'" . trim($data["idetripaiori"]) . "'",
            "'" . trim($data["paiori"]) . "'",
            "'" . trim($data["idetriextep"]) . "'",
            "'" . trim($data["prerut"]) . "'",
            "'" . trim($data["admondian"]) . "'",
            "'" . trim($data["nit"]) . "'",
            "'" . trim($data["estadonit"]) . "'",
            "'" . trim($data["fechamatricula"]) . "'",
            "'" . trim($data["fecharenovacion"]) . "'",
            "'" . trim($data["ultanoren"]) . "'",
            "'" . trim($data["fechacancelacion"]) . "'",
            "'" . trim($data["motivocancelacion"]) . "'",
            "'" . trim($data["fechaconstitucion"]) . "'",
            "'" . trim($data["fechadisolucion"]) . "'",
            "'" . trim($data["fechaliquidacion"]) . "'",
            "'" . trim($data["estadotipoliquidacion"]) . "'",
            "'" . trim($data["fechavencimiento"]) . "'",
            "'" . trim($data["tamanoempresa"]) . "'",
            "'" . trim($data["emprendedor28"]) . "'",
            doubleval($data["pemprendedor28"]),
            "'" . trim($data["empresafamiliar"]) . "'",
            "'" . trim($data["procesosinnovacion"]) . "'",
            "'" . trim($data["tipogruemp"]) . "'",
            "'" . addslashes(trim($data["nombregruemp"])) . "'",
            "'" . addslashes(trim($data["vigcontrol"])) . "'",
            "'" . trim($data["vigifecini"]) . "'",
            "'" . trim($data["vigifecfin"]) . "'",
            "'" . trim($data["numperj"]) . "'",
            "'" . trim($data["fecperj"]) . "'",
            "'" . trim($data["idorigenperj"]) . "'",
            "'" . trim($numdocconst) . "'",
            "'" . trim($fecdocconst) . "'",
            "'" . trim($oridocconst) . "'",
            "'" . trim($data["fecmatant"]) . "'",
            "'" . trim($data["fecrenant"]) . "'",
            "'" . trim($data["camant"]) . "'",
            "'" . trim($data["munant"]) . "'",
            "'" . trim($data["ultanorenant"]) . "'",
            "'" . trim($data["matant"]) . "'",
            "'" . trim($data["benart7ant"]) . "'",
            "'" . trim($data["benley1780ant"]) . "'",
            "'" . addslashes(trim($data["dircom"])) . "'",
            "'" . trim($data["dircom_tipovia"]) . "'",
            "'" . trim($data["dircom_numvia"]) . "'",
            "'" . trim($data["dircom_apevia"]) . "'",
            "'" . trim($data["dircom_orivia"]) . "'",
            "'" . trim($data["dircom_numcruce"]) . "'",
            "'" . trim($data["dircom_apecruce"]) . "'",
            "'" . trim($data["dircom_oricruce"]) . "'",
            "'" . trim($data["dircom_numplaca"]) . "'",
            "'" . trim($data["dircom_complemento"]) . "'",
            "'" . trim($data["codigopostalcom"]) . "'",
            "'" . trim($data["codigozonacom"]) . "'",
            "'" . trim($data["barriocom"]) . "'",
            "'" . trim($data["muncom"]) . "'",
            "'" . trim($data["paicom"]) . "'",
            "'" . trim($data["telcom1"]) . "'",
            "'" . trim($data["telcom2"]) . "'",
            "'" . trim($data["celcom"]) . "'",
            "'" . addslashes(trim($data["emailcom"])) . "'",
            "'" . addslashes(trim($data["emailcom2"])) . "'",
            "'" . addslashes(trim($data["emailcom3"])) . "'",
            "'" . addslashes(trim($data["urlcom"])) . "'",
            "'" . (trim($data["aacom"])) . "'",
            "'" . (trim($data["faxcom"])) . "'",
            "'" . trim($data["numpredial"]) . "'",
            "'" . trim($data["latitud"]) . "'",
            "'" . trim($data["longitud"]) . "'",
            "'" . addslashes(trim($data["dirnot"])) . "'",
            "'" . trim($data["dirnot_tipovia"]) . "'",
            "'" . trim($data["dirnot_numvia"]) . "'",
            "'" . trim($data["dirnot_apevia"]) . "'",
            "'" . trim($data["dirnot_orivia"]) . "'",
            "'" . trim($data["dirnot_numcruce"]) . "'",
            "'" . trim($data["dirnot_apecruce"]) . "'",
            "'" . trim($data["dirnot_oricruce"]) . "'",
            "'" . trim($data["dirnot_numplaca"]) . "'",
            "'" . trim($data["dirnot_complemento"]) . "'",
            "'" . trim($data["codigopostalnot"]) . "'",
            "'" . trim($data["codigozonanot"]) . "'",
            "'" . trim($data["barrionot"]) . "'",
            "'" . trim($data["munnot"]) . "'",
            "'" . trim($data["painot"]) . "'",
            "'" . trim($data["telnot"]) . "'",
            "'" . trim($data["telnot2"]) . "'",
            "'" . trim($data["celnot"]) . "'",
            "'" . addslashes(trim($data["emailnot"])) . "'",
            "'" . addslashes(trim($data["urlnot"])) . "'",
            "'" . (trim($data["aanot"])) . "'",
            "'" . (trim($data["faxnot"])) . "'",
            "'" . (trim($data["tiposedeadm"])) . "'",
            "'" . trim($data["dircor"]) . "'",
            "'" . trim($data["muncor"]) . "'",
            "'" . trim($data["telcor"]) . "'",
            "'" . trim($data["telcor2"]) . "'",
            "'" . trim($data["ciius"][1]) . "'",
            "'" . trim($data["ciius"][2]) . "'",
            "'" . trim($data["ciius"][3]) . "'",
            "'" . trim($data["ciius"][4]) . "'",
            "'" . trim($data["ciius"][5]) . "'",
            "'" . trim($data["versionciiu"]) . "'",
            "'" . trim($data["feciniact1"]) . "'",
            "'" . trim($data["feciniact2"]) . "'",
            "'" . trim($data["codaduaneros"]) . "'",
            "'" . addslashes(substr(trim($data["desactiv"]), 0, 1000)) . "'",
            "'" . trim($data["fechaafiliacion"]) . "'",
            "'" . trim($data["fecactaaflia"]) . "'",
            "'" . trim($data["numactaaflia"]) . "'",
            "'" . trim($data["fecactaafliacan"]) . "'",
            "'" . trim($data["numactaafliacan"]) . "'",
            "'" . trim($data["ultanorenafi"]) . "'",
            "'" . trim($data["fechaultpagoafi"]) . "'",
            doubleval($data["valorultpagoafi"]),
            doubleval($data["saldoafiliado"]),
            "'" . trim($data["telaflia"]) . "'",
            "'" . trim($data["diraflia"]) . "'",
            "'" . trim($data["munaflia"]) . "'",
            "'" . trim($data["profaflia"]) . "'",
            "'" . trim($data["contaflia"]) . "'",
            "'" . trim($data["dircontaflia"]) . "'",
            "'" . trim($data["muncontaflia"]) . "'",
            "'" . trim($data["fecexafiliacion"]) . "'",
            "''", // ctrexpedienteinactivo
            "'" . trim($data["estadomatricula"]) . "'",
            "'" . trim($data["estadodatosmatricula"]) . "'",
            "'" . trim($data["certificardesde"]) . "'",
            "'" . trim($data["estadoproponente"]) . "'",
            "'" . trim($data["tipopropiedad"]) . "'",
            "'" . trim($ctrlibroscomercio) . "'",
            "'" . trim($data["afiliado"]) . "'",
            "''", // ctrvigilancia
            "''", // ctrestadoactiva
            "''", // ctrestadopreoperativa
            "''", // ctrestadoconcordato
            "''", // ctrestadointervenida
            "''", // ctrestadodisuelta
            "''", // ctrestadoenreestructuracion
            "'" . trim($data["estadocapturado"]) . "'",
            "'" . addslashes(trim($data["estadocapturadootros"])) . "'",
            "'" . trim($ctrembargo) . "'",
            "'" . trim($ctrembargotramite) . "'",
            "'" . trim($ctrrecursotramite) . "'",
            "'" . trim($data["impexp"]) . "'",
            "'" . trim($data["tipolocal"]) . "'",
            "'" . trim($data["ctrfun"]) . "'",
            "'" . trim($data["ctrubi"]) . "'",
            "'" . trim($data["clasegenesadl"]) . "'",
            "'" . trim($data["claseespesadl"]) . "'",
            "'" . trim($data["claseeconsoli"]) . "'",
            "'" . trim($data["ctrderpub"]) . "'",
            "'" . trim($data["ctrcodcoop"]) . "'",
            "'" . trim($data["ctrcodotras"]) . "'",
            "'" . trim($econmixta) . "'",
            intval($data["ctresacntasociados"]),
            intval($data["ctresacntmujeres"]),
            intval($data["ctresacnthombres"]),
            "'" . trim($data["ctresapertgremio"]) . "'",
            "'" . addslashes($data["ctresagremio"]) . "'",
            "'" . addslashes($data["ctresaacredita"]) . "'",
            "'" . trim($data["ctresaivc"]) . "'",
            "'" . trim($data["ctresainfoivc"]) . "'",
            "'" . trim($data["ctresaautregistro"]) . "'",
            "'" . addslashes($data["ctresaentautoriza"]) . "'",
            "'" . trim($data["ctresacodnat"]) . "'",
            "'" . trim($data["ctresadiscap"]) . "'",
            "'" . trim($data["ctresaetnia"]) . "'",
            "'" . addslashes($data["ctresacualetnia"]) . "'",
            "'" . trim($data["ctresadespvictreins"]) . "'",
            "'" . addslashes($data["ctresacualdespvictreins"]) . "'",
            "'" . trim($data["ctresaindgest"]) . "'",
            "'" . trim($data["ctresalgbti"]) . "'",
            "'" . trim($data["art4"]) . "'",
            "'" . trim($data["art7"]) . "'",
            "'" . trim($data["art50"]) . "'",
            "'" . trim($data["benley1780"]) . "'",
            "'" . trim($data["cumplerequisitos1780"]) . "'",
            "'" . trim($data["renunciabeneficios1780"]) . "'",
            "'" . trim($data["cumplerequisitos1780primren"]) . "'",
            "'" . trim($data["ctrcancelacion1429"]) . "'",
            "'" . trim($data["ctrdepuracion1727"]) . "'",
            "'" . trim($data["ctrfechadepuracion1727"]) . "'",
            "'" . trim($data["ctrben658"]) . "'",
            "'" . substr(trim($data["ctrmen"]), 0, 1) . "'",
            "'" . substr(trim($data["ctrmennot"]), 0, 1) . "'",
            doubleval($data["ivcarea"]),
            "'" . trim($data["ivcver"]) . "'",
            "'" . trim($data["ivccretip"]) . "'",
            "'" . trim($data["ivcali"]) . "'",
            "'" . trim($data["ivcqui"]) . "'",
            "'" . trim($data["ivcriesgo"]) . "'",
            "'" . trim($data["ivcenvio"]) . "'",
            "'" . trim($data["ivcsuelos"]) . "'",
            "'" . trim($data["ctrbic"]) . "'",
            intval($data["cantest"]),
            "'" . trim($idereplegal) . "'",
            "'" . addslashes($nomreplegal) . "'",
            "'" . trim($data["gruponiif"]) . "'",
            "'" . trim($data["niifconciliacion"]) . "'",
            "'" . trim($data["aportantesegsocial"]) . "'",
            "'" . trim($data["tipoaportantesegsocial"]) . "'",
            "'" . trim($data["anodatos"]) . "'",
            "'" . trim($data["fechadatos"]) . "'",
            intval($data["personal"]),
            doubleval($data["personaltemp"]),
            doubleval($data["actcte"]),
            doubleval($data["actnocte"]),
            doubleval($data["actfij"]),
            doubleval($data["fijnet"]),
            doubleval($data["actval"]),
            doubleval($data["actotr"]),
            doubleval($data["acttot"]),
            doubleval($data["actsinaju"]),
            doubleval($data["invent"]),
            doubleval($data["pascte"]),
            doubleval($data["paslar"]),
            doubleval($data["pastot"]),
            doubleval($data["pattot"]),
            doubleval($data["paspat"]),
            doubleval($data["balsoc"]),
            doubleval($data["ingope"]),
            doubleval($data["ingnoope"]),
            doubleval($data["gtoven"]), //
            doubleval($data["gtoadm"]), //
            doubleval($data["gtoven"]),
            doubleval($data["gtoadm"]),
            doubleval($data["utiope"]),
            doubleval($data["utinet"]),
            doubleval($data["cosven"]), //
            doubleval($data["depamo"]),
            doubleval($data["gasint"]),
            doubleval($data["gasimp"]),
            doubleval($data["actvin"]),
            doubleval($data["patrimonio"]),
            "'" . trim($data["anodatoscap"]) . "'",
            "'" . trim($data["fechadatoscap"]) . "'",
            doubleval($data["capaut"]),
            doubleval($data["capsus"]),
            doubleval($data["cappag"]),
            doubleval($data["capsoc"]),
            doubleval($data["apolab"]),
            doubleval($data["apolabadi"]),
            doubleval($data["apodin"]),
            doubleval($data["apotra"]),
            doubleval($data["apoact"]),
            doubleval($data["apotot"]),
            doubleval($capesadl),
            doubleval($data["cap_porcnalpri"]),
            doubleval($data["cap_porcnalpub"]),
            doubleval($data["cap_porcnaltot"]),
            doubleval($data["cap_porcextpri"]),
            doubleval($data["cap_porcextpub"]),
            doubleval($data["cap_porcexttot"]),
            "'" . trim($nomsegcon) . "'",
            "'" . trim($carsegcon) . "'",
            intval($data["cntestab01"]),
            intval($data["cntestab02"]),
            intval($data["cntestab03"]),
            intval($data["cntestab04"]),
            intval($data["cntestab05"]),
            intval($data["cntestab06"]),
            intval($data["cntestab07"]),
            intval($data["cntestab08"]),
            intval($data["cntestab09"]),
            intval($data["cntestab10"]),
            intval($data["cntestab11"]),
            "'" . trim($data["refcrenom1"]) . "'",
            "'" . trim($data["refcreofi1"]) . "'",
            "'" . trim($data["refcretel1"]) . "'",
            "'" . trim($data["refcrenom2"]) . "'",
            "'" . trim($data["refcreofi2"]) . "'",
            "'" . trim($data["refcretel2"]) . "'",
            "'" . trim($data["refcomnom1"]) . "'",
            "'" . trim($data["refcomdir1"]) . "'",
            "'" . trim($data["refcomtel1"]) . "'",
            "'" . trim($data["refcomnom2"]) . "'",
            "'" . trim($data["refcomdir2"]) . "'",
            "'" . trim($data["refcomtel2"]) . "'",
            "'" . trim($data["cpcodcam"]) . "'",
            "'" . trim($data["cpnummat"]) . "'",
            "'" . trim($data["cprazsoc"]) . "'",
            "'" . trim($data["cpnumnit"]) . "'",
            "'" . trim($data["cpdircom"]) . "'",
            "'" . trim($data["cpdirnot"]) . "'",
            "'" . trim($data["cpnumtel"]) . "'",
            "'" . trim($data["cpnumfax"]) . "'",
            "'" . trim($data["cpcodmun"]) . "'",
            "'" . trim($data["cpmunnot"]) . "'",
            "'" . trim($data["cpafili"]) . "'",
            doubleval($data["cpsaldo"]),
            "'" . trim($data["cpurenafi"]) . "'",
            "'" . date("Ymd") . "'",
            "'NO'", // Compite360
            "'NO'", // Rues
            "'NO'" // ivc
        );

        // Graba el registro en mreg_est_inscritos
        $idgrabar = 0;

        //
        if ($data["matricula"] != '') {
            $idreg = retornarRegistroMysqli2($dbx, 'mreg_est_inscritos', "matricula='" . ltrim($data["matricula"], "0") . "'");
            if ($idreg && !empty($idreg)) {
                $idgrabar = $idreg["id"];
            }
        } else {
            if ($data["proponente"] != '') {
                $idreg = retornarRegistroMysqli2($dbx, 'mreg_est_inscritos', "proponente='" . ltrim($data["proponente"], "0") . "'");
                if ($idreg && !empty($idreg)) {
                    $idgrabar = $idreg["id"];
                }
            }
        }

        if ($idgrabar == 0) {
            unset($_SESSION["expedienteactual"]);
            $control = 'insertar';
            $res = insertarRegistrosMysqli2($dbx, 'mreg_est_inscritos', $arrCampos, $arrValores);
            if ($res === false) {
                \logSii2::general2($nameLog, ltrim($data["matricula"], "0"), 'Error creando matrícula en mreg_est_inscritos : ' . $_SESSION["generales"]["mensajeerror"]);
                return false;
            }
        }
        if ($idgrabar != 0) {
            unset($_SESSION["expedienteactual"]);
            $control = 'regrabar';
            $res = regrabarRegistrosMysqli2($dbx, 'mreg_est_inscritos', $arrCampos, $arrValores, "id=" . $idgrabar);
            if ($res === false) {
                \logSii2::general2($nameLog, ltrim($data["matricula"], "0"), 'Error regrabando matrícula en mreg_est_inscritos: ' . $_SESSION["generales"]["mensajeerror"]);
                return false;
            }
        }

        //    
        $datafin = array();
        if ($data["matricula"] != '') {
            $datafin = retornarRegistroMysqli2($dbx, 'mreg_est_inscritos', "matricula='" . ltrim($data["matricula"], "0") . "'");
        } else {
            if ($data["proponente"] != '') {
                $datafin = retornarRegistroMysqli2($dbx, 'mreg_est_inscritos', "proponente='" . ltrim($data["proponente"], "0") . "'");
            }
        }

        // Actualiza códigos CAE
        if (ltrim($data["matricula"], "0") != '') {
            $arrY = retornarRegistrosMysqli2($dbx, 'mreg_anexoscae', "1=1", "codigocae");
            if ($arrY && !empty($arrY)) {
                $iValores = 0;
                $arrValores = array();
                $arrCampos = array(
                    'tabla',
                    'registro',
                    'campo',
                    'contenido'
                );

                foreach ($arrY as $y) {
                    borrarRegistrosMysqli2($dbx, 'mreg_est_campostablas', "tabla='200' and registro='" . ltrim($data["matricula"], "0") . "' and campo='" . $y["codigocae"] . "'");
                    if (isset($data["codigoscae"][$y["codigocae"]]) && trim($data["codigoscae"][$y["codigocae"]]) != '') {
                        $iValores++;
                        $arrValores[$iValores] = array(
                            "'200'",
                            "'" . ltrim($data["matricula"], "0") . "'",
                            "'" . $y["codigocae"] . "'",
                            "'" . trim($data["codigoscae"][$y["codigocae"]]) . "'"
                        );
                    }
                }
                if ($iValores > 0) {
                    insertarRegistrosBloqueMysqli2($dbx, 'mreg_est_campostablas', $arrCampos, $arrValores);
                }
            }
        }

        //
        if ($data["matricula"] != '') {
            $arrCampos = array(
                'matricula',
                'campo',
                'fecha',
                'hora',
                'codigobarras',
                'datoanterior',
                'datonuevo',
                'usuario',
                'ip',
                'tipotramite',
                'recibo'
            );
            $arrValores = array();
            $iCambios = 0;
            $fecxact = date("Ymd");
            $horxact = date("His");
            foreach ($datafin as $key => $valor) {
                if ($key != 'id' &&
                        !is_numeric($key) &&
                        $key != 'matricula' &&
                        $key != 'fecactualizacion' &&
                        $key != 'horactualizacion' &&
                        $key != 'fecsincronizacion' &&
                        $key != 'horsincronizacion' &&
                        $key != 'compite360' &&
                        $key != 'rues' &&
                        $key != 'ivc') {

                    if (!isset($dataori[$key])) {
                        $dataori[$key] = '';
                    }
                    if ($dataori[$key] == null) {
                        $dataori[$key] = '';
                    }
                    if ($dataori[$key] == '.00' || $dataori[$key] == '0.00') {
                        $dataori[$key] = '0';
                    }
                    if ($datafin[$key] == '.00' || $datafin[$key] == '0.00') {
                        $datafin[$key] = '0';
                    }

                    if (ltrim(trim($dataori[$key]), "0") != ltrim(trim($datafin[$key]), "0")) {
                        $iCambios++;
                        $arrValores [$iCambios] = array(
                            "'" . ltrim($data["matricula"], "0") . "'",
                            "'" . $key . "'",
                            "'" . $fecxact . "'",
                            "'" . $horxact . "'",
                            "'" . $codbarras . "'",
                            "'" . addslashes(ltrim(trim($dataori[$key]), "0")) . "'",
                            "'" . addslashes(ltrim(trim($datafin[$key]), "0")) . "'",
                            "'" . $_SESSION["generales"]["codigousuario"] . "'",
                            "'" . \funcionesSii2::localizarIP() . "'",
                            "'" . $tt . "'",
                            "'" . $rec . "'"
                        );
                    }
                }
            }

            //
            if ($iCambios > 0) {
                $res = insertarRegistrosBloqueMysqli2($dbx, 'mreg_campos_historicos_' . substr($fecxact, 0, 4), $arrCampos, $arrValores);
                if ($res === false) {
                    \logSii2::general2('actualizarMregCamposHistoricos_' . date("Ymd"), ltrim($data["matricula"], "0"), 'Error grabando matrícula en mreg_campos_historicos_AAAA: ' . $_SESSION["generales"]["mensajeerror"]);
                    return false;
                }
            }
        }

        // Revisa información financiera
        if ($data["matricula"] != '') {
            if (isset($data["f"]) && !empty($data["f"])) {
                foreach ($data["f"] as $fin) {
                    $arrFin = retornarRegistroMysqli2($dbx, 'mreg_est_financiera', "matricula='" . ltrim($data["matricula"], "0") . "' and anodatos='" . $fin["anodatos"] . "' and fechadatos='" . $fin["fechadatos"] . "'");
                    if ($arrFin === false || empty($arrFin)) {
                        $accion = 'insertar';
                    } else {
                        $accion = 'no';
                        if (!isset($fin["patrimonio"])) {
                            $fin["patrimonio"] = 0;
                        }
                        if ($fin["personal"] != $arrFin["personal"] ||
                                $fin["patrimonio"] != $arrFin["patrimonio"] ||
                                $fin["personaltemp"] != $arrFin["pcttemp"] ||
                                $fin["actvin"] != $arrFin["actvin"] ||
                                $fin["actcte"] != $arrFin["actcte"] ||
                                $fin["actnocte"] != $arrFin["actnocte"] ||
                                $fin["actfij"] != $arrFin["actfij"] ||
                                $fin["fijnet"] != $arrFin["fijnet"] ||
                                $fin["actval"] != $arrFin["actval"] ||
                                $fin["actotr"] != $arrFin["actotr"] ||
                                $fin["acttot"] != $arrFin["acttot"] ||
                                $fin["actsinaju"] != $arrFin["actsinaju"] ||
                                $fin["invent"] != $arrFin["invent"] ||
                                $fin["pascte"] != $arrFin["pascte"] ||
                                $fin["paslar"] != $arrFin["paslar"] ||
                                $fin["pastot"] != $arrFin["pastot"] ||
                                $fin["patnet"] != $arrFin["patnet"] ||
                                $fin["paspat"] != $arrFin["paspat"] ||
                                $fin["balsoc"] != $arrFin["balsoc"] ||
                                $fin["ingope"] != $arrFin["ingope"] ||
                                $fin["ingnoope"] != $arrFin["ingnoope"] ||
                                $fin["gtoven"] != $arrFin["gasope"] ||
                                $fin["gtoadm"] != $arrFin["gasadm"] ||
                                $fin["gtoadm"] != $arrFin["gasnoope"] ||
                                $fin["cosven"] != $arrFin["cosven"] ||
                                $fin["gtoven"] != $arrFin["gtoven"] ||
                                $fin["gasint"] != $arrFin["gasint"] ||
                                $fin["gasimp"] != $arrFin["gasimp"] ||
                                $fin["utiope"] != $arrFin["utiope"] ||
                                $fin["utinet"] != $arrFin["utinet"]
                        ) {
                            $accion = 'regrabar';
                        }
                    }

                    if ($accion == 'insertar' || $accion == 'regrabar') {
                        $arrCampos = array(
                            'matricula',
                            'anodatos',
                            'fechadatos',
                            'personal',
                            'pcttemp',
                            'patrimonio',
                            'actvin',
                            'actcte',
                            'actnocte',
                            'actfij',
                            'fijnet',
                            'actval',
                            'actotr',
                            'acttot',
                            'actsinaju',
                            'invent',
                            'pascte',
                            'paslar',
                            'pastot',
                            'patnet',
                            'paspat',
                            'balsoc',
                            'ingope',
                            'ingnoope',
                            'gasope',
                            'gasadm',
                            'gasnoope',
                            'cosven',
                            'gtoven',
                            'gasint',
                            'gasimp',
                            'utiope',
                            'utinet',
                            'depamo',
                            'fecsincronizacion',
                            'horsincronizacion',
                            'compite360'
                        );
                        $arrValores = array(
                            "'" . ltrim($data["matricula"], "0") . "'",
                            "'" . $fin["anodatos"] . "'",
                            "'" . $fin["fechadatos"] . "'",
                            intval($fin["personal"]),
                            doubleval($fin["personaltemp"]),
                            doubleval($fin["patrimonio"]),
                            doubleval($fin["actvin"]),
                            doubleval($fin["actcte"]),
                            doubleval($fin["actnocte"]),
                            doubleval($fin["actfij"]),
                            doubleval($fin["fijnet"]),
                            doubleval($fin["actval"]),
                            doubleval($fin["actotr"]),
                            doubleval($fin["acttot"]),
                            doubleval($fin["actsinaju"]),
                            doubleval($fin["invent"]),
                            doubleval($fin["pascte"]),
                            doubleval($fin["paslar"]),
                            doubleval($fin["pastot"]),
                            doubleval($fin["pattot"]),
                            doubleval($fin["paspat"]),
                            doubleval($fin["balsoc"]),
                            doubleval($fin["ingope"]),
                            doubleval($fin["ingnoope"]),
                            doubleval($fin["gtoven"]),
                            doubleval($fin["gtoadm"]),
                            doubleval($fin["gtoadm"]), //
                            doubleval($fin["cosven"]), //
                            doubleval($fin["gtoven"]), //
                            doubleval($fin["gasint"]), //
                            doubleval($fin["gasimp"]), //
                            doubleval($fin["utiope"]),
                            doubleval($fin["utinet"]),
                            0, // Depamo
                            "'" . date("Ymd") . "'",
                            "'" . date("His") . "'",
                            "'NO'"
                        );
                        if ($accion == 'insertar') {
                            $res = insertarRegistrosMysqli2($dbx, 'mreg_est_financiera', $arrCampos, $arrValores);
                            if ($res === false) {
                                \logSii2::general2('actualizarMregEstFinanciera_' . date("Ymd"), ltrim($data["matricula"], "0"), 'Error insertando matrícula en mreg_est_financiera: ' . $_SESSION["generales"]["mensajeerror"]);
                                return false;
                            }
                        }
                        if ($accion == 'regrabar') {
                            $res = regrabarRegistrosMysqli2($dbx, 'mreg_est_financiera', $arrCampos, $arrValores, "matricula='" . ltrim($data["matricula"], "0") . "' and anodatos='" . $fin["anodatos"] . "' and fechadatos='" . $fin["fechadatos"] . "'");
                            if ($res === false) {
                                \logSii2::general2('actualizarMregEstFinanciera_' . date("Ymd"), ltrim($data["matricula"], "0"), 'Error regrabando matrícula en mreg_est_financiera: ' . $_SESSION["generales"]["mensajeerror"]);
                                return false;
                            }
                        }

                        //
                        $arrCampos = array(
                            'matricula',
                            'campo',
                            'fecha',
                            'hora',
                            'codigobarras',
                            'datoanterior',
                            'datonuevo',
                            'usuario',
                            'ip',
                            'tipotramite',
                            'recibo'
                        );
                        $arrValores = array();
                        $iCambios = 0;
                        $fecxact = date("Ymd");
                        $horxact = date("His");
                        $arrFinFin = retornarRegistroMysqli2($dbx, 'mreg_est_financiera', "matricula='" . ltrim($data["matricula"], "0") . "' and anodatos='" . $fin["anodatos"] . "' and fechadatos='" . $fin["fechadatos"] . "'");
                        foreach ($arrFinFin as $key => $valor) {
                            if ($key != 'id' &&
                                    !is_numeric($key) &&
                                    $key != 'matricula' &&
                                    $key != 'anodatos' &&
                                    $key != 'fechadatos' &&
                                    $key != 'fecsincronizacion' &&
                                    $key != 'horsincronizacion' &&
                                    $key != 'compite360') {
                                if (!isset($arrFin[$key])) {
                                    $arrFin[$key] = '';
                                }
                                if ($arrFin[$key] == null) {
                                    $arrFin[$key] = '';
                                }
                                if (ltrim(trim($arrFinFin[$key]), "0") != ltrim(trim($arrFin[$key]), "0")) {
                                    $iCambios++;
                                    $arrValores [$iCambios] = array(
                                        "'" . ltrim($data["matricula"], "0") . "'",
                                        "'" . $key . '-' . $data["anodatos"] . '-' . $data["fechadatos"] . "'",
                                        "'" . $fecxact . "'",
                                        "'" . $horxact . "'",
                                        "'" . $codbarras . "'",
                                        "'" . addslashes(ltrim(trim($arrFin[$key]), "0")) . "'",
                                        "'" . addslashes(ltrim(trim($arrFinFin[$key]), "0")) . "'",
                                        "'" . $_SESSION["generales"]["codigousuario"] . "'",
                                        "'" . \funcionesSii2::localizarIP() . "'",
                                        "'" . $tt . "'",
                                        "'" . $rec . "'"
                                    );
                                }
                            }
                        }
                        if ($iCambios > 0) {
                            $res = insertarRegistrosBloqueMysqli2($dbx, 'mreg_campos_historicos_' . substr($fecxact, 0, 4), $arrCampos, $arrValores);
                            if ($res === false) {
                                \logSii2::general2('actualizarMregCamposHistoricos_' . date("Ymd"), ltrim($data["matricula"], "0"), 'Error grabando matrícula en mreg_campos_historicos: ' . $_SESSION["generales"]["mensajeerror"]);
                                return false;
                            }
                        }
                    }
                }
            }
        }

        //
        if ($data["matricula"] != '') {
            if ($tt == 'digitacionformulario' || $tt == 'actualizacionmatriculado') {
                if ($data["anodatos"] != '' && $data["fechadatos"] != '') {
                    $condicion = "matricula='" . ltrim($data["matricula"], "0") . "' and anodatos='" . $data["anodatos"] . "' and fechadatos='" . $data["fechadatos"] . "'";
                    $arrFin = retornarRegistroMysqli2($dbx, 'mreg_est_financiera', $condicion);
                    $arrCampos = array(
                        'matricula',
                        'anodatos',
                        'fechadatos',
                        'personal',
                        'pcttemp',
                        'patrimonio',
                        'actvin',
                        'actcte',
                        'actnocte',
                        'actfij',
                        'fijnet',
                        'actval',
                        'actotr',
                        'acttot',
                        'actsinaju',
                        'invent',
                        'pascte',
                        'paslar',
                        'pastot',
                        'patnet',
                        'paspat',
                        'balsoc',
                        'ingope',
                        'ingnoope',
                        'gasope',
                        'gasadm',
                        'gasnoope',
                        'cosven',
                        'gtoven',
                        'gasint',
                        'gasimp',
                        'utiope',
                        'utinet',
                        'depamo',
                        'fecsincronizacion',
                        'horsincronizacion',
                        'compite360'
                    );
                    $arrValores = array(
                        "'" . ltrim($data["matricula"], "0") . "'",
                        "'" . $data["anodatos"] . "'",
                        "'" . $data["fechadatos"] . "'",
                        intval($data["personal"]),
                        doubleval($data["personaltemp"]),
                        doubleval($data["patrimonio"]),
                        doubleval($data["actvin"]),
                        doubleval($data["actcte"]),
                        doubleval($data["actnocte"]),
                        doubleval($data["actfij"]),
                        doubleval($data["fijnet"]),
                        doubleval($data["actval"]),
                        doubleval($data["actotr"]),
                        doubleval($data["acttot"]),
                        doubleval($data["actsinaju"]),
                        doubleval($data["invent"]),
                        doubleval($data["pascte"]),
                        doubleval($data["paslar"]),
                        doubleval($data["pastot"]),
                        doubleval($data["pattot"]),
                        doubleval($data["paspat"]),
                        doubleval($data["balsoc"]),
                        doubleval($data["ingope"]),
                        doubleval($data["ingnoope"]),
                        doubleval($data["gtoven"]),
                        doubleval($data["gtoadm"]),
                        doubleval($data["gtoadm"]), //
                        doubleval($data["cosven"]), //
                        doubleval($data["gtoven"]), //
                        doubleval($data["gasint"]), //
                        doubleval($data["gasimp"]), //
                        doubleval($data["utiope"]),
                        doubleval($data["utinet"]),
                        0, // Depamo
                        "'" . date("Ymd") . "'",
                        "'" . date("His") . "'",
                        "'NO'"
                    );
                    if ($arrFin && !empty($arrFin)) {
                        regrabarRegistrosMysqli2($dbx, 'mreg_est_financiera', $arrCampos, $arrValores, $condicion);
                    } else {
                        insertarRegistrosMysqli2($dbx, 'mreg_est_financiera', $arrCampos, $arrValores);
                    }
                }
            }
        }

        // 2017-08-17 : JINT: Actualiza la información  de patrimonios de esadl 
        if (!isset($data["anodatospatrimonio"])) {
            $data["anodatospatrimonio"] = '';
        }
        if (!isset($data["fechadatospatrimonio"])) {
            $data["fechadatospatrimonio"] = '';
        }
        if (!isset($data["patrimonioesadl"])) {
            $data["patrimonioesadl"] = 0;
        }

        //
        if ($data["matricula"] != '') {
            if ($data["anodatospatrimonio"] != '' && $data["fechadatospatrimonio"] != '' && doubleval($data["patrimonioesadl"]) != 0) {
                $condicion = "matricula='" . ltrim($data["matricula"], "0") . "' and anodatos='" . $data["anodatospatrimonio"] . "' and fechadatos='" . $data["fechadatospatrimonio"] . "'";
                $arrPat = retornarRegistroMysqli2($dbx, 'mreg_est_patrimonios', $condicion);
                $arrCampos = array(
                    'matricula',
                    'anodatos',
                    'fechadatos',
                    'patrimonio'
                );
                $arrValores = array(
                    "'" . $data["matricula"] . "'",
                    "'" . $data["anodatospatrimonio"] . "'",
                    "'" . $data["fechadatospatrimonio"] . "'",
                    doubleval($data["patrimonioesadl"])
                );
                if ($arrPat && !empty($arrPat)) {
                    regrabarRegistrosMysqli2($dbx, 'mreg_est_patrimonios', $arrCampos, $arrValores, $condicion);
                } else {
                    insertarRegistrosMysqli2($dbx, 'mreg_est_patrimonios', $arrCampos, $arrValores);
                }
            }
        }

        // ********************************************************************************************* //
        // 2018-08-31: JINT: Por seguridad actualiza la fecha de mreg_est_inscritos
        // ********************************************************************************************* 
        if ($data["matricula"] != '') {
            $arrCampos = array(
                'fecactualizacion',
                'compite360',
                'rues',
                'ivc'
            );
            $arrValores = array(
                "'" . date("Ymd") . "'",
                "'NO'",
                "'NO'",
                "'NO'"
            );
            regrabarRegistrosMysqli2($dbx, 'mreg_est_inscritos', $arrCampos, $arrValores, "matricula='" . $data["matricula"] . "'");
        }

        //
        return true;
    }

    public static function actualizarMregEstInformacionFinanciera($dbx = null, $data = array(), $codbarras = '', $tt = '', $rec = '') {

        $dataori = retornarRegistroMysqli2($dbx, 'mreg_est_inscritos', "matricula='" . ltrim($data["matricula"], "0") . "'");
        if ($dataori === false || empty($dataori)) {
            $accion = 'insertar';
        } else {
            $accion = 'regrabar';
        }

        //
        $arrCampos = array(
            'anodatos',
            'fecdatos',
            'personal',
            'personaltemp',
            'actcte',
            'actnocte',
            'actfij',
            'fijnet',
            'actval',
            'actotr',
            'acttot',
            'actsinaju',
            'invent',
            'pascte',
            'paslar',
            'pastot',
            'pattot',
            'paspat',
            'balsoc',
            'ingope',
            'ingnoope',
            'gasope',
            'gasnoope',
            'gtoven',
            'gtoadm',
            'utiope',
            'utinet',
            'cosven',
            'depamo',
            'gasint',
            'gasimp',
            'actvin',
            'fecactualizacion',
            'compite360',
            'rues',
            'ivc'
        );

        $arrValores = array(
            "'" . trim($data["anodatos"]) . "'",
            "'" . trim($data["fechadatos"]) . "'",
            intval($data["personal"]),
            doubleval($data["personaltemp"]),
            doubleval($data["actcte"]),
            doubleval($data["actnocte"]),
            doubleval($data["actfij"]),
            doubleval($data["fijnet"]),
            doubleval($data["actval"]),
            doubleval($data["actotr"]),
            doubleval($data["acttot"]),
            doubleval($data["actsinaju"]),
            doubleval($data["invent"]),
            doubleval($data["pascte"]),
            doubleval($data["paslar"]),
            doubleval($data["pastot"]),
            doubleval($data["pattot"]),
            doubleval($data["paspat"]),
            doubleval($data["balsoc"]),
            doubleval($data["ingope"]),
            doubleval($data["ingnoope"]),
            doubleval($data["gasope"]), //
            doubleval($data["gasnoope"]), //
            doubleval($data["gtoven"]),
            doubleval($data["gtoadm"]),
            doubleval($data["utiope"]),
            doubleval($data["utinet"]),
            doubleval($data["cosven"]), //
            doubleval($data["depamo"]),
            doubleval($data["gasint"]),
            doubleval($data["gasimp"]),
            doubleval($data["actvin"]),
            "'" . date("Ymd") . "'", // fecha de actualizacion
            "'NO'", // Compite360
            "'NO'", // Rues
            "'NO'" // Ivc
        );

        // Graba el registro en mreg_est_inscritos
        if ($accion == 'insertar') {
            unset($_SESSION["expedienteactual"]);
            $res = insertarRegistrosMysqli2($dbx, 'mreg_est_inscritos', $arrCampos, $arrValores);
            if ($res === false) {
                \logSii2::general2('actualizarMregEstInformacionFinanciera_' . date("Ymd"), ltrim($data["matricula"], "0"), 'Error creando matrícula en mreg_est_inscritos : ' . $_SESSION["generales"]["mensajeerror"]);
                return false;
            }
        } else {
            unset($_SESSION["expedienteactual"]);
            $res = regrabarRegistrosMysqli2($dbx, 'mreg_est_inscritos', $arrCampos, $arrValores, "matricula='" . ltrim($data["matricula"], "0") . "'");
            if ($res === false) {
                \logSii2::general2('actualizarMregEstInformacionFinanciera_' . date("Ymd"), ltrim($data["matricula"], "0"), 'Error regrabando matrícula en mreg_est_inscritos: ' . $_SESSION["generales"]["mensajeerror"]);
                return false;
            }
        }


        // Revisa información financiera
        $arrFin = retornarRegistroMysqli2($dbx, 'mreg_est_financiera', "matricula='" . ltrim($data["matricula"], "0") . "' and anodatos='" . $data["anodatos"] . "' and fechadatos='" . $data["fechadatos"] . "'");
        if ($arrFin === false || empty($arrFin)) {
            $accion = 'insertar';
        } else {
            $accion = 'no';
            if ($data["personal"] != $arrFin["personal"] ||
                    $data["personaltemp"] != $arrFin["pcttemp"] ||
                    $data["actvin"] != $arrFin["actvin"] ||
                    $data["actcte"] != $arrFin["actcte"] ||
                    $data["actnocte"] != $arrFin["actnocte"] ||
                    $data["actfij"] != $arrFin["actfij"] ||
                    $data["fijnet"] != $arrFin["fijnet"] ||
                    $data["actval"] != $arrFin["actval"] ||
                    $data["actotr"] != $arrFin["actotr"] ||
                    $data["acttot"] != $arrFin["acttot"] ||
                    $data["actsinaju"] != $arrFin["actsinaju"] ||
                    $data["invent"] != $arrFin["invent"] ||
                    $data["pascte"] != $arrFin["pascte"] ||
                    $data["paslar"] != $arrFin["paslar"] ||
                    $data["pastot"] != $arrFin["pastot"] ||
                    $data["pattot"] != $arrFin["patnet"] ||
                    $data["paspat"] != $arrFin["paspat"] ||
                    $data["balsoc"] != $arrFin["balsoc"] ||
                    $data["ingope"] != $arrFin["ingope"] ||
                    $data["ingnoope"] != $arrFin["ingnoope"] ||
                    $data["gasope"] != $arrFin["gasope"] ||
                    $data["gtoadm"] != $arrFin["gasadm"] ||
                    $data["gasnoope"] != $arrFin["gasnoope"] ||
                    $data["cosven"] != $arrFin["cosven"] ||
                    $data["gtoven"] != $arrFin["gtoven"] ||
                    $data["gasint"] != $arrFin["gasint"] ||
                    $data["gasimp"] != $arrFin["gasimp"] ||
                    $data["utiope"] != $arrFin["utiope"] ||
                    $data["utinet"] != $arrFin["utinet"]
            ) {
                $accion = 'regrabar';
            }
        }

        if ($accion == 'insertar' || $accion == 'regrabar') {
            $arrCampos = array(
                'matricula',
                'anodatos',
                'fechadatos',
                'personal',
                'pcttemp',
                'patrimonio',
                'actvin',
                'actcte',
                'actnocte',
                'actfij',
                'fijnet',
                'actval',
                'actotr',
                'acttot',
                'actsinaju',
                'invent',
                'pascte',
                'paslar',
                'pastot',
                'patnet',
                'paspat',
                'balsoc',
                'ingope',
                'ingnoope',
                'gasope',
                'gasadm',
                'gasnoope',
                'cosven',
                'gtoven',
                'gasint',
                'gasimp',
                'utiope',
                'utinet',
                'depamo',
                'fecsincronizacion',
                'horsincronizacion',
                'compite360'
            );
            $arrValores = array(
                "'" . ltrim($data["matricula"], "0") . "'",
                "'" . $data["anodatos"] . "'",
                "'" . $data["fechadatos"] . "'",
                intval($data["personal"]),
                doubleval($data["personaltemp"]),
                doubleval($data["patrimonio"]),
                doubleval($data["actvin"]),
                doubleval($data["actcte"]),
                doubleval($data["actnocte"]),
                doubleval($data["actfij"]),
                doubleval($data["fijnet"]),
                doubleval($data["actval"]),
                doubleval($data["actotr"]),
                doubleval($data["acttot"]),
                doubleval($data["actsinaju"]),
                doubleval($data["invent"]),
                doubleval($data["pascte"]),
                doubleval($data["paslar"]),
                doubleval($data["pastot"]),
                doubleval($data["pattot"]),
                doubleval($data["paspat"]),
                doubleval($data["balsoc"]),
                doubleval($data["ingope"]),
                doubleval($data["ingnoope"]),
                doubleval($data["gasope"]),
                doubleval($data["gtoadm"]),
                doubleval($data["gasnoope"]), //
                doubleval($data["cosven"]), //
                doubleval($data["gtoven"]), //
                doubleval($data["gasint"]), //
                doubleval($data["gasimp"]), //
                doubleval($data["utiope"]),
                doubleval($data["utinet"]),
                0, // Depamo
                "'" . date("Ymd") . "'",
                "'" . date("His") . "'",
                "'NO'"
            );
            if ($accion == 'insertar') {
                $res = insertarRegistrosMysqli2($dbx, 'mreg_est_financiera', $arrCampos, $arrValores);
                if ($res === false) {
                    \logSii2::general2('actualizarMregEstInformacionFinanciera_' . date("Ymd"), ltrim($data["matricula"], "0"), 'Error insertando matrícula en mreg_est_financiera: ' . $_SESSION["generales"]["mensajeerror"]);
                    return false;
                }
            }
            if ($accion == 'regrabar') {
                $res = regrabarRegistrosMysqli2($dbx, 'mreg_est_financiera', $arrCampos, $arrValores, "matricula='" . ltrim($data["matricula"], "0") . "' and anodatos='" . $data["anodatos"] . "' and fechadatos='" . $data["fechadatos"] . "'");
                if ($res === false) {
                    \logSii2::general2('actualizarMregEstInformacionFinanciera_' . date("Ymd"), ltrim($data["matricula"], "0"), 'Error regrabando matrícula en mreg_est_financiera: ' . $_SESSION["generales"]["mensajeerror"]);
                    return false;
                }
            }

            //
            $arrCampos = array(
                'matricula',
                'campo',
                'fecha',
                'hora',
                'codigobarras',
                'datoanterior',
                'datonuevo',
                'usuario',
                'ip',
                'tipotramite',
                'recibo'
            );
            $arrValores = array();
            $iCambios = 0;
            $fecxact = date("Ymd");
            $horxact = date("His");
            $arrFinFin = retornarRegistroMysqli2($dbx, 'mreg_est_financiera', "matricula='" . ltrim($data["matricula"], "0") . "' and anodatos='" . $data["anodatos"] . "' and fechadatos='" . $data["fechadatos"] . "'");
            foreach ($arrFinFin as $key => $valor) {
                if ($key != 'id' &&
                        !is_numeric($key) &&
                        $key != 'matricula' &&
                        $key != 'anodatos' &&
                        $key != 'fechadatos' &&
                        $key != 'fecsincronizacion' &&
                        $key != 'horsincronizacion' &&
                        $key != 'compite360') {
                    if (!isset($arrFin[$key])) {
                        $arrFin[$key] = '';
                    }
                    if ($arrFin[$key] == null) {
                        $arrFin[$key] = '';
                    }
                    if (ltrim(trim($arrFinFin[$key]), "0") != ltrim(trim($arrFin[$key]), "0")) {
                        $iCambios++;
                        $arrValores [$iCambios] = array(
                            "'" . ltrim($data["matricula"], "0") . "'",
                            "'" . $key . '-' . $data["anodatos"] . '-' . $data["fechadatos"] . "'",
                            "'" . $fecxact . "'",
                            "'" . $horxact . "'",
                            "'" . $codbarras . "'",
                            "'" . addslashes(ltrim(trim($arrFin[$key]), "0")) . "'",
                            "'" . addslashes(ltrim(trim($arrFinFin[$key]), "0")) . "'",
                            "'" . $_SESSION["generales"]["codigousuario"] . "'",
                            "'" . \funcionesSii2::localizarIP() . "'",
                            "'" . $tt . "'",
                            "'" . $rec . "'"
                        );
                    }
                }
            }
            if ($iCambios > 0) {
                $res = insertarRegistrosBloqueMysqli2($dbx, 'mreg_campos_historicos_' . substr($fecxact, 0, 4), $arrCampos, $arrValores);
                if ($res === false) {
                    \logSii2::general2('actualizarMregCamposHistoricos_' . date("Ymd"), ltrim($data["matricula"], "0"), 'Error grabando matrícula en mreg_campos_historicos: ' . $_SESSION["generales"]["mensajeerror"]);
                    return false;
                }
            }
        }

        return true;
    }

    public static function actualizarMregEstInscritosCampo($dbx, $matricula, $campo, $contenido = '', $tipocampo = 'varchar', $codbarras = '', $tipotramite = '', $recibo = '') {


        // Valida que el expedienmte tenga diferencias
        if (ltrim($matricula, "0") == '') {
            return true;
        }

        //
        $datoori = retornarRegistroMysqli2($dbx, 'mreg_est_inscritos', "matricula='" . $matricula . "'", $campo);
        if (ltrim(trim($datoori), "0") != ltrim(trim($contenido), "0")) {
            $arrCampos = array(
                $campo,
                'fecactualizacion',
                'compite360',
                'rues',
                'ivc'
            );
            if ($tipocampo == 'varchar') {
                $arrValores = array(
                    "'" . trim($contenido) . "'",
                    "'" . date("Ymd") . "'",
                    "'NO'",
                    "'NO'",
                    "'NO'"
                );
            }
            if ($tipocampo == 'int') {
                $arrValores = array(
                    intval($contenido),
                    "'" . date("Ymd") . "'",
                    "'NO'",
                    "'NO'",
                    "'NO'"
                );
            }
            if ($tipocampo == 'double') {
                $arrValores = array(
                    doubleval($contenido),
                    "'" . date("Ymd") . "'",
                    "'NO'",
                    "'NO'",
                    "'NO'"
                );
            }
            unset($_SESSION["expedienteactual"]);
            $res = regrabarRegistrosMysqli2($dbx, 'mreg_est_inscritos', $arrCampos, $arrValores, "matricula='" . $matricula . "'");
            if ($res === false) {
                \logSii2::general2('actualizarMregEstInscritos_' . date("Ymd"), ltrim($matricula, "0"), 'Error regrabando en mreg_est_inscritos: ' . $_SESSION["generales"]["mensajeerror"]);
                return false;
            }

            $arrCampos = array(
                'matricula',
                'campo',
                'fecha',
                'hora',
                'codigobarras',
                'datoanterior',
                'datonuevo',
                'usuario',
                'ip',
                'tipotramite',
                'recibo'
            );
            $arrValores = array(
                "'" . ltrim($matricula, "0") . "'",
                "'" . $campo . "'",
                "'" . date("Ymd") . "'",
                "'" . date("His") . "'",
                "'" . $codbarras . "'",
                "'" . addslashes($datoori) . "'",
                "'" . addslashes($contenido) . "'",
                "'" . $_SESSION["generales"]["codigousuario"] . "'",
                "'" . \funcionesSii2::localizarIP() . "'",
                "'" . $tipotramite . "'",
                "'" . $recibo . "'"
            );
            $res = insertarRegistrosMysqli2($dbx, 'mreg_campos_historicos_' . date("Y"), $arrCampos, $arrValores);
            if ($res === false) {
                logSii2::general2('actualizarMregCamposHistoricos_' . date("Ymd"), ltrim($matricula, "0"), 'Error grabando en mreg_campos_historicos: ' . $_SESSION["generales"]["mensajeerror"]);
                return false;
            }
        }

        //
        return true;
    }

    public static function actualizarMregInscritosPendienteNuevoCertificado($dbx = null, $libro = null, $acto = null, $matricula = null) {
        $acto = retornarRegistroMysqli2($dbx, 'mreg_actos', "idlibro='" . $libro . "' and idacto='" . $acto . "'");
        if ($acto["idgrupoacto"] != '002' && // Cancelaciones
                $acto["idgrupoacto"] != '003' && // Mutaciones
                $acto["idgrupoacto"] != '004' && // Libros
                $acto["idgrupoacto"] != '046' && // Sitios web
                $acto["idgrupoacto"] != '047' && // habilitación del servicio de transporte
                $acto["idgrupoacto"] != '052' && // Proponente
                $acto["idgrupoacto"] != '999' // otros
        ) {
            if (ltrim($matricula, "0") != '') {
                $exptx = retornarRegistroMysqli2($dbx, 'mreg_est_inscritos', "matricula='" . ltrim($matricula, "0") . "'", "matricula,organizacion,categoria,ctrestmatricula,pendiente_ajuste_nuevo_formato,fecha_pendiente_ajuste_nuevo_formato");
                if ($exptx &&
                        ($exptx["ctrestmatricula"] == 'MA' ||
                        $exptx["ctrestmatricula"] == 'IA' ||
                        $exptx["ctrestmatricula"] == 'MI' ||
                        $exptx["ctrestmatricula"] == 'II' ||
                        $exptx["ctrestmatricula"] == 'MR' ||
                        $exptx["ctrestmatricula"] == 'IR')
                ) {
                    if ($exptx["organizacion"] > '02' && ($exptx["categoria"] == '1' || $exptx["categoria"] == '2')) {
                        $marcar = 'no';
                        if ($exptx["organizacion"] == '12' || $exptx["organizacion"] == '14') {
                            if (defined('FECHA_INICIO_NUEVO_CERTIFICADO_CERESADL') && FECHA_INICIO_NUEVO_CERTIFICADO_CERESADL != '' && FECHA_INICIO_NUEVO_CERTIFICADO_CERESADL <= date("Ymd")) {
                                $marcar = 'si';
                            } else {
                                if (defined('FECHA_INICIO_NUEVO_CERTIFICADO_CEREXI') && FECHA_INICIO_NUEVO_CERTIFICADO_CEREXI != '' && FECHA_INICIO_NUEVO_CERTIFICADO_CEREXI <= date("Ymd")) {
                                    $marcar = 'si';
                                }
                            }
                        }
                        if ($marcar == 'si') {
                            if ($exptx["pendiente_ajuste_nuevo_formato"] == '') {
                                $arrCampos = array(
                                    'pendiente_ajuste_nuevo_formato',
                                    'fecha_pendiente_ajuste_nuevo_formato'
                                );
                                $arrValores = array(
                                    "'P'",
                                    "'" . date("Ymd") . ' ' . date("His") . "'"
                                );
                                regrabarRegistrosMysqli2($dbx, 'mreg_est_inscritos', $arrCampos, $arrValores, "matricula='" . ltrim($matricula, "0") . "'");
                            }
                        }
                    }
                }
            }
        }
        return true;
    }

    public static function actualizarMregLiquidacionFlujo($dbx, $tt, $numliq, $idsol, $est, $numrec, $numope, $numrad, $fecrec, $horrec) {
        $arrCampos = array(
            'tipotramite',
            'idliquidacion',
            'idsolicitudpago',
            'idestadoflujo',
            'numerorecibo',
            'numerooperacion',
            'numeroradicacion',
            'fecharecibo',
            'horarecibo'
        );
        $arrValues = array(
            "'" . $tt . "'",
            $numliq,
            "'" . $idsol . "'",
            "'" . $est . "'",
            "'" . $numrec . "'",
            "'" . $numope . "'",
            "'" . $numrad . "'",
            "'" . $fecrec . "'",
            "'" . $horrec . "'"
        );

        insertarRegistrosMysqli2($dbx, 'mreg_liquidacionflujo', $arrCampos, $arrValues);
    }

    public static function actualizarMregLiquidacionPagoElectronico($dbx, $liqui, $est, $nomcli, $idtipide, $dir, $tel, $mun, $email, $ide, $pagefe, $pagche, $pagvis, $pagach, $pagmas, $pagame, $pagcre, $pagdin, $pagtdeb, $codban, $numche, $numaut, $caj, $numope, $numrec, $fecrec, $horrec, $codbar, $xfra, $xnfra, $formapago = '05') {

        $arrCampos = array(
            'idestado',
            'idtipoidentificacioncliente',
            'identificacioncliente',
            'nombrecliente',
            'email',
            'direccion',
            'idmunicipio',
            'telefono',
            'pagoefectivo',
            'pagocheque',
            'pagovisa',
            'pagomastercard',
            'pagoamerican',
            'pagocredencial',
            'pagodiners',
            'pagotdebito',
            'idformapago',
            'numerorecibo',
            'numerooperacion',
            'fecharecibo',
            'horarecibo',
            'idfranquicia',
            'nombrefranquicia',
            'numeroautorizacion',
            'idcodban',
            'nombrebanco',
            'numerocheque',
            'numeroradicacion'
        );
        $arrValues = array(
            "'" . $est . "'",
            "'" . $idtipide . "'",
            "'" . $ide . "'",
            "'" . $nomcli . "'",
            "'" . $email . "'",
            "'" . addslashes(utf8_encode($dir)) . "'",
            "'" . $mun . "'",
            "'" . $tel . "'",
            $pagefe,
            $pagche,
            $pagvis,
            $pagmas,
            $pagame,
            $pagcre,
            $pagdin,
            $pagtdeb,
            "'" . $formapago . "'", // idformapago (pago electr&oacute;nico)
            "'" . $numrec . "'",
            "'" . $numope . "'",
            "'" . $fecrec . "'",
            "'" . $horrec . "'",
            "'" . $xfra . "'", // idfranquicia
            "'" . $xnfra . "'", // nombre franquicia
            "'" . $numaut . "'",
            "'" . $codban . "'",
            "''", // nombre banco
            "'" . $numche . "'",
            "'" . $codbar . "'"
        );
        regrabarRegistrosMysqli2($dbx, 'mreg_liquidacion', $arrCampos, $arrValues, "idliquidacion=" . $liqui);
        return true;
    }

    public static function actualizarMregNotificacionesParaEnviarEmailSii(
            $mysqli, $tnot, $rad, $dev, $ope, $rec, $lib, $reg, $dup, $idc, $ide, $mat, $pro, $nom, $ema, $det, $fpro, $hpro, $fnot, $hnot, $est, $obs = '', $bandeja = ''
    ) {

        ini_set('memory_limit', '1024M');
        require_once ('genPdfImagenes.php');

        //
        $arrCampos = array(
            'tiponotificacion',
            'radicacion',
            'devolucion',
            'operacion',
            'recibo',
            'libro',
            'registro',
            'dupli',
            'idclase',
            'numid',
            'matricula',
            'proponente',
            'nombre',
            'email',
            'detallenotificacion',
            'fechaprogramacion',
            'horaprogramacion',
            'fechanotificacion',
            'horanotificacion',
            'idestadonotificacion',
            'observaciones'
        );
        $arrValores = array(
            "'" . $tnot . "'",
            "'" . $rad . "'",
            "'" . $dev . "'",
            "'" . $ope . "'",
            "'" . $rec . "'",
            "'" . $lib . "'",
            "'" . $reg . "'",
            "'" . $dup . "'",
            "'" . $idc . "'",
            "'" . $ide . "'",
            "'" . $mat . "'",
            "'" . $pro . "'",
            "'" . addslashes($nom) . "'",
            "'" . addslashes($ema) . "'",
            "'" . addslashes($det) . "'",
            "'" . $fpro . "'",
            "'" . $hpro . "'",
            "'" . $fnot . "'",
            "'" . $hnot . "'",
            "'" . $est . "'",
            "'" . addslashes($obs) . "'"
        );
        insertarRegistrosMysqli2($mysqli, 'mreg_notificaciones_para_enviar_email', $arrCampos, $arrValores);

        // Crea el pdf de la notifcicación
        $_SESSION["generales"]["idanexogenerado"] = generarPdfNotificacionEmailSii($mysqli, $tnot, $rad, $dev, $ope, $rec, $lib, $reg, $dup, $idc, $ide, $mat, $pro, $nom, $ema, $det, $fpro, $hpro, $fnot, $hnot, $est, $obs, $bandeja);

        // Valida que el pdf haya quedado bien generado
        // Busca en el texto del pdf la secuencia "Fecha y hora de programaci"
        // si la encuentra deuelve true de lo controario false.
        $retornar = true;
        $anx = retornarRegistroMysqli2($mysqli, 'mreg_radicacionesanexos', "idanexo=" . $_SESSION["generales"]["idanexogenerado"]);
        if (file_exists('../../../' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/' . $anx["path"])) {
            $resv = validarPdfSii2('../../../' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/' . $anx["path"], 'Fecha y hora de programaci');
            if (!$resv) {
                $retornar = false;
            }
        }

        //
        return $retornar;
    }

    public static function actualizarMregRadicacionesDatos($dbx, $numrad, $sec, $tipotra, $exp, $est, $xml) {
        $arrCampos = array(
            'idradicacion',
            'secuencia',
            'tipotramite',
            'expediente',
            'idestado',
            'xml'
        );
        $arrValues = array(
            "'" . ltrim($numrad, "0") . "'",
            "'" . $sec . "'",
            "'" . $tipotra . "'",
            "'" . $exp . "'",
            "'" . $est . "'",
            "'" . addslashes($xml) . "'"
        );
        $query = "idradicacion='" . ltrim($numrad, "0") . "' and secuencia='" . $sec . "'";
        $result = borrarRegistrosMysqli2($dbx, 'mreg_radicacionesdatos', $query);
        if ($result === false) {
            return false;
        } else {
            $result = insertarRegistrosMysqli2($dbx, 'mreg_radicacionesdatos', $arrCampos, $arrValues);
            if ($result === false) {
                return false;
            } else {
                return true;
            }
        }
    }

    public static function actualizarPilaSmsSii($mysqli, $cel, $tip, $rec, $cba, $ins, $dev, $exp, $mat, $pro, $ide, $nom, $txt, $obs = '', $bandeja = '') {

        //
        require_once ('genPdfImagenes.php');

        //
        $arrCampos = array(
            'celular',
            'texto',
            'recibo',
            'codigobarras',
            'inscripcion',
            'devolucion',
            'expediente',
            'matricula',
            'proponente',
            'identificacion',
            'nombre',
            'fechaprogramacion',
            'horaprogramacion',
            'tipo',
            'estado',
            'fechaenvio',
            'horaenvio'
        );

        //
        $arrValores = array(
            "'" . $cel . "'",
            "'" . addslashes($txt) . "'",
            "'" . $rec . "'",
            "'" . $cba . "'",
            "'" . $ins . "'",
            "'" . $dev . "'",
            "'" . ltrim($exp, "0") . "'",
            "'" . ltrim($mat, "0") . "'",
            "'" . ltrim($pro, "0") . "'",
            "'" . ltrim($ide, "0") . "'",
            "'" . addslashes($nom) . "'",
            "'" . date("Ymd") . "'",
            "'" . date("His") . "'",
            "'" . $tip . "'",
            "'1'",
            "''",
            "''"
        );

        insertarRegistrosMysqli2($mysqli, 'pila_sms', $arrCampos, $arrValores);

        // Crea el pdf de la notificación sipref 
        if ($tip != '6' && $tip != '7' && $tip != '90') {
            $id = generarPdfNotificacionSmsSii($mysqli, $cel, $tip, $rec, $cba, $ins, $dev, $exp, $mat, $pro, $ide, $nom, $txt, $obs, $bandeja);
        }
        return true;
    }

    /**
     * 
     * @param type $dbx
     * @param type $clave
     * @param type $contenido
     */
    public static function actualizarMregSecuenciasSii($dbx, $clave, $contenido) {

        $arrTem = retornarRegistroMysqli2($dbx, 'mreg_secuencias', "id='" . $clave . "'");

        //
        if ($arrTem === false || empty($arrTem)) {

            $arrCampos = array(
                'id',
                'secuencia'
            );
            $arrValores = array(
                "'" . $clave . "'",
                $contenido
            );
            insertarRegistrosMysqli2($dbx, 'mreg_secuencias', $arrCampos, $arrValores);
        } else {

            $arrCampos = array(
                'id',
                'secuencia'
            );
            $arrValores = array(
                "'" . $clave . "'",
                $contenido
            );
            regrabarRegistrosMysqli2($dbx, 'mreg_secuencias', $arrCampos, $arrValores, "id='" . $clave . "'");
        }
    }

    /**
     * 
     * @param type $mysqli
     * @param type $clave
     * @param type $contenido
     */
    public static function actualizarMregSecuenciasAsentarReciboSii($mysqli, $clave, $contenido) {

        $arrTem = retornarRegistroMysqli2($mysqli, 'mreg_secuencias', "id='" . $clave . "'");

        //
        if ($arrTem === false || empty($arrTem)) {

            $arrCampos = array(
                'id',
                'secuencia'
            );
            $arrValores = array(
                "'" . $clave . "'",
                $contenido
            );
            insertarRegistrosMysqli2($mysqli, 'mreg_secuencias', $arrCampos, $arrValores);
        } else {

            $arrCampos = array(
                'id',
                'secuencia'
            );
            $arrValores = array(
                "'" . $clave . "'",
                $contenido
            );
            regrabarRegistrosMysqli2($mysqli, 'mreg_secuencias', $arrCampos, $arrValores, "id='" . $clave . "'");
        }
    }

    /**
     * 
     * @param type $dbx
     * @param type $cri
     * @param type $ide
     * @param type $clave
     * @param type $valor
     * @param type $recibo
     * @param type $numoperacion
     * @param type $servicio
     * @param type $cantidad
     * @param type $detalle
     * @param type $ip
     * @param type $usuario
     * @param type $expediente
     * @param type $email
     * @param type $nombre
     * @param type $celular
     * @param type $direccion
     * @param type $municipio
     * @param type $tipousuario
     * @param type $telefono
     * @param type $nom1
     * @param type $nom2
     * @param type $ape1
     * @param type $ape2
     * @return string
     */
    public static function actualizarPrepago($dbx, $cri, $ide, $clave = '', $valor = '', $recibo = '', $numoperacion = '', $servicio = '', $cantidad = '', $detalle = '', $ip = '', $usuario = '', $expediente = '', $email = '', $nombre = '', $celular = '', $direccion = '', $municipio = '', $tipousuario = '', $telefono = '', $nom1 = '', $nom2 = '', $ape1 = '', $ape2 = '') {

        $resultado = array();
        $resultado["codigoError"] = '0000';
        $resultado["msgError"] = '';
        $resultado["identificacion"] = $ide;
        $resultado["nombre"] = '';
        $resultado["nombre1"] = '';
        $resultado["nombre2"] = '';
        $resultado["apellido1"] = '';
        $resultado["apellido2"] = '';
        $resultado["email"] = '';
        $resultado["telefono"] = '';
        $resultado["celular"] = '';
        $resultado["direccion"] = '';
        $resultado["municipio"] = '';
        $resultado["clave"] = '';
        $resultado["saldoprepago"] = '0';
        $resultado["saldoafiliado"] = '0';
        $resultado["kardex"] = array();
        $resultado["saldos"] = array();

        if ($cri == 'S' || $cri == 'R') { // Retorna los datos y el saldo de un prepago
            $prep = retornarRegistroMysqli2($dbx, 'mreg_prepagos', "identificacion='" . $ide . "'");
            if ($prep && !empty($prep)) {
                $resultado["nombre"] = $prep["nombre"];
                $resultado["nombre1"] = $prep["nombre1"];
                $resultado["nombre2"] = $prep["nombre2"];
                $resultado["apellido1"] = $prep["apellido1"];
                $resultado["apellido2"] = $prep["apellido2"];
                $resultado["email"] = $prep["email"];
                $resultado["telefono"] = $prep["telefono"];
                $resultado["celular"] = $prep["celular"];
                $resultado["direccion"] = $prep["direccion"];
                $resultado["municipio"] = $prep["municipio"];
                $resultado["clave"] = $prep["clave"];
                $resultado["saldoprepago"] = '0';
                $resultado["saldoafiliado"] = '0';
                $preps = retornarRegistrosMysqli2($dbx, 'mreg_prepagos_uso', "identificacion='" . $ide . "'", "fecha,hora");
                if ($preps && !empty($preps)) {
                    foreach ($preps as $p) {
                        if ($p["tipomov"] == 'C') {
                            $resultado["saldoprepago"] = $resultado["saldoprepago"] + $p["valor"];
                        } else {
                            $resultado["saldoprepago"] = $resultado["saldoprepago"] - $p["valor"];
                        }
                    }
                }
            }
            return $resultado;
        }

        if ($cri == 'K') { // retorna el kardex de un prepago
            $prep = retornarRegistroMysqli2($dbx, 'mreg_prepagos', "identificacion='" . $ide . "'");
            if ($prep && !empty($prep)) {
                $resultado["nombre"] = $prep["nombre"];
                $resultado["nombre1"] = $prep["nombre1"];
                $resultado["nombre2"] = $prep["nombre2"];
                $resultado["apellido1"] = $prep["apellido1"];
                $resultado["apellido2"] = $prep["apellido2"];
                $resultado["email"] = $prep["email"];
                $resultado["telefono"] = $prep["telefono"];
                $resultado["celular"] = $prep["celular"];
                $resultado["direccion"] = $prep["direccion"];
                $resultado["municipio"] = $prep["municipio"];
                $resultado["clave"] = $prep["clave"];
                $resultado["saldoprepago"] = '0';
                $resultado["saldoafiliado"] = '0';
                $preps = retornarRegistrosMysqli2($dbx, 'mreg_prepagos_uso', "identificacion='" . $ide . "'", "fecha,hora");
                if ($preps && !empty($preps)) {
                    $ik = 0;
                    foreach ($preps as $p) {
                        if ($p["tipomov"] == 'C') {
                            $resultado["saldoprepago"] = $resultado["saldoprepago"] + $p["valor"];
                        } else {
                            $resultado["saldoprepago"] = $resultado["saldoprepago"] - $p["valor"];
                        }
                        $ik++;
                        $resultado["kardex"][$i]["fecha"] = $p["fecha"];
                        $resultado["kardex"][$i]["hora"] = $p["hora"];
                        $resultado["kardex"][$i]["usuario"] = $p["usuario"];
                        $resultado["kardex"][$i]["operador"] = $p["operador"];
                        $resultado["kardex"][$i]["tipomov"] = $p["tipomov"];
                        $resultado["kardex"][$i]["servicio"] = $p["servicio"];
                        $resultado["kardex"][$i]["expediente"] = $p["expediente"];
                        $resultado["kardex"][$i]["cantidad"] = $p["cantidad"];
                        $resultado["kardex"][$i]["valor"] = $p["valor"];
                        $resultado["kardex"][$i]["recibo"] = $p["recibo"];
                        $resultado["kardex"][$i]["operacion"] = '';
                        $resultado["kardex"][$i]["concepto"] = $p["concepto"];
                    }
                }
            }
            return $resultado;
        }

        if ($cri == 'L') { // retorna la lista de prepagos y su saldo
            $i = 0;
            $prep = retornarRegistrosMysqli2($dbx, 'mreg_prepagos', "1=1", "identificacion");
            if ($prep && !empty($prep)) {
                foreach ($prep as $p1) {
                    $i++;
                    $resultado["saldos"][$i]["identificacion"] = $p1["identificacion"];
                    $resultado["saldos"][$i]["nombre"] = $p1["nombre"];
                    $resultado["saldos"][$i]["email"] = $p1["email"];
                    $resultado["saldos"][$i]["telefono"] = $p1["telefono"];
                    $resultado["saldos"][$i]["saldo"] = 0;
                    $preps = retornarRegistrosMysqli2($dbx, 'mreg_prepagos_uso', "identificacion='" . $p1["identificacion"] . "'", "fecha,hora");
                    if ($preps && !empty($preps)) {
                        $ik = 0;
                        foreach ($preps as $p) {
                            if ($p["tipomov"] == 'C') {
                                $resultado["saldos"][$i]["saldo"] = $resultado["saldos"][$i]["saldo"] + $p["valor"];
                            } else {
                                $resultado["saldos"][$i]["saldo"] = $resultado["saldos"][$i]["saldo"] - $p["valor"];
                            }
                        }
                    }
                }
            }
            return $resultado;
        }

        if ($cri == 'A') { // Verifica la clave de un prepago
            $prep = retornarRegistroMysqli2($dbx, 'mreg_prepagos', "identificacion='" . $ide . "'");
            if (!$prep || empty($prep)) {
                $resultado["codigoError"] = '0020';
                $resultado["msgError"] = 'NO EXISTE PREPAGO PARA LA IDENTIFICACION';
                return $resultado;
            }
            if ($tipousuario != '3') {
                if (md5($clave) != $prep["clave"]) {
                    $resultado["codigoError"] = '0020';
                    $resultado["msgError"] = 'CLAVE NO CORRESPONDE';
                    return $resultado;
                }
            }
            $resultado["nombre"] = $prep["nombre"];
            $resultado["nombre1"] = $prep["nombre1"];
            $resultado["nombre2"] = $prep["nombre2"];
            $resultado["apellido1"] = $prep["apellido1"];
            $resultado["apellido2"] = $prep["apellido2"];
            $resultado["email"] = $prep["email"];
            $resultado["telefono"] = $prep["telefono"];
            $resultado["celular"] = $prep["celular"];
            $resultado["direccion"] = $prep["direccion"];
            $resultado["municipio"] = $prep["municipio"];
            $resultado["clave"] = $prep["clave"];
            $resultado["saldoprepago"] = '0';
            $preps = retornarRegistrosMysqli2($dbx, 'mreg_prepagos_uso', "identificacion='" . $ide . "'", "fecha,hora");
            if ($preps && !empty($preps)) {
                $ik = 0;
                foreach ($preps as $p) {
                    if ($p["tipomov"] == 'C') {
                        $resultado["saldoprepago"] = $resultado["saldoprepago"] + $p["valor"];
                    } else {
                        $resultado["saldoprepago"] = $resultado["saldoprepago"] - $p["valor"];
                    }
                }
            }
            return $resultado;
        }

        if ($cri == 'P') { // Cambio de clave
            $prep = retornarRegistroMysqli2($dbx, 'mreg_prepagos', "identificacion='" . $ide . "'");
            if (!$prep || empty($prep)) {
                $resultado["codigoError"] = '0020';
                $resultado["msgError"] = 'NO EXISTE PREPAGO PARA LA IDENTIFICACION';
                return $resultado;
            }
            $arrCampos = array('clave');
            $arrValores = array("'" . md5($clave) . "'");
            regrabarRegistrosMysqli2($dbx, 'mreg_prepagos', $arrCampos, $arrValores, "identificacion='" . $ide . "'");
            $prep = retornarRegistroMysqli2($dbx, 'mreg_prepagos', "identificacion='" . $ide . "'");
            $resultado["nombre"] = $prep["nombre"];
            $resultado["nombre1"] = $prep["nombre1"];
            $resultado["nombre2"] = $prep["nombre2"];
            $resultado["apellido1"] = $prep["apellido1"];
            $resultado["apellido2"] = $prep["apellido2"];
            $resultado["email"] = $prep["email"];
            $resultado["telefono"] = $prep["telefono"];
            $resultado["celular"] = $prep["celular"];
            $resultado["direccion"] = $prep["direccion"];
            $resultado["municipio"] = $prep["municipio"];
            $resultado["clave"] = $clave;
            $resultado["saldoprepago"] = '0';
            $preps = retornarRegistrosMysqli2($dbx, 'mreg_prepagos_uso', "identificacion='" . $ide . "'", "fecha,hora");
            if ($preps && !empty($preps)) {
                $ik = 0;
                foreach ($preps as $p) {
                    if ($p["tipomov"] == 'C') {
                        $resultado["saldoprepago"] = $resultado["saldoprepago"] + $p["valor"];
                    } else {
                        $resultado["saldoprepago"] = $resultado["saldoprepago"] - $p["valor"];
                    }
                }
            }
            return $resultado;
        }

        if ($cri == 'C') { //Carga al prepgo
            $arrCampos = array(
                'identificacion',
                'nombre',
                'nombre1',
                'nombre2',
                'apellido1',
                'apellido2',
                'direccion',
                'telefono',
                'celular',
                'email',
                'municipio',
                'clave'
            );
            $arrValores = array(
                "'" . $ide . "'",
                "'" . addslashes($nombre) . "'",
                "'" . addslashes($nom1) . "'",
                "'" . addslashes($nom2) . "'",
                "'" . addslashes($ape1) . "'",
                "'" . addslashes($ape2) . "'",
                "'" . addslashes($direccion) . "'",
                "'" . $telefono . "'",
                "'" . $celular . "'",
                "'" . addslashes($email) . "'",
                "'" . $municipio . "'",
                "'" . md5($clave) . "'"
            );
            if (contarRegistrosMysqli2($dbx, 'mreg_prepagos', "identificacion='" . $ide . "'") == 0) {
                insertarRegistrosMysqli2($dbx, 'mreg_prepagos', $arrCampos, $arrValores);
            } else {
                regrabarRegistrosMysqli2($dbx, 'mreg_prepagos', $arrCampos, $arrValores, "identificacion='" . $ide . "'");
            }
            $arrCampos = array(
                'identificacion',
                'fecha',
                'hora',
                'ip',
                'operador',
                'usuario',
                'tipomov',
                'servicio',
                'concepto',
                'expediente',
                'recibo',
                'cantidad',
                'valor'
            );
            $arrValores = array(
                "'" . $ide . "'",
                "'" . date("Ymd") . "'",
                "'" . date("His") . "'",
                "'" . $ip . "'",
                "''", // Operador
                "'" . $usuario . "'",
                "'C'",
                "'" . $servicio . "'",
                "'" . $detalle . "'",
                "''",
                "'" . $recibo . "'",
                0,
                $valor
            );
            insertarRegistrosMysqli2($dbx, 'mreg_prepagos_uso', $arrCampos, $arrValores);
            $prep = retornarRegistroMysqli2($dbx, 'mreg_prepagos', "identificacion='" . $ide . "'");
            $resultado["nombre"] = $prep["nombre"];
            $resultado["nombre1"] = $prep["nombre1"];
            $resultado["nombre2"] = $prep["nombre2"];
            $resultado["apellido1"] = $prep["apellido1"];
            $resultado["apellido2"] = $prep["apellido2"];
            $resultado["email"] = $prep["email"];
            $resultado["celular"] = $prep["celular"];
            $resultado["telefono"] = $prep["telefono"];
            $resultado["direccion"] = $prep["direccion"];
            $resultado["municipio"] = $prep["municipio"];
            $resultado["clave"] = $prep["clave"];
            $resultado["saldoprepago"] = '0';
            $preps = retornarRegistrosMysqli2($dbx, 'mreg_prepagos_uso', "identificacion='" . $ide . "'", "fecha,hora");
            if ($preps && !empty($preps)) {
                $ik = 0;
                foreach ($preps as $p) {
                    if ($p["tipomov"] == 'C') {
                        $resultado["saldoprepago"] = $resultado["saldoprepago"] + $p["valor"];
                    } else {
                        $resultado["saldoprepago"] = $resultado["saldoprepago"] - $p["valor"];
                    }
                }
            }
            return $resultado;
        }

        if ($cri == 'D') { //Descuenta del prepgo
            $prep = retornarRegistroMysqli2($dbx, 'mreg_prepagos', "identificacion='" . $ide . "'");
            if (!$prep || empty($prep)) {
                $resultado["codigoError"] = '0020';
                $resultado["msgError"] = 'NO EXISTE PREPAGO PARA LA IDENTIFICACION';
                return $resultado;
            }
            $resultado["nombre"] = $prep["nombre"];
            $resultado["nombre1"] = $prep["nombre1"];
            $resultado["nombre2"] = $prep["nombre2"];
            $resultado["apellido1"] = $prep["apellido1"];
            $resultado["apellido2"] = $prep["apellido2"];
            $resultado["email"] = $prep["email"];
            $resultado["celular"] = $prep["celular"];
            $resultado["telefono"] = $prep["telefono"];
            $resultado["direccion"] = $prep["direccion"];
            $resultado["municipio"] = $prep["municipio"];
            $resultado["clave"] = $prep["clave"];
            $resultado["saldoprepago"] = '0';
            $preps = retornarRegistrosMysqli2($dbx, 'mreg_prepagos_uso', "identificacion='" . $ide . "'", "fecha,hora");
            if ($preps && !empty($preps)) {
                $ik = 0;
                foreach ($preps as $p) {
                    if ($p["tipomov"] == 'C') {
                        $resultado["saldoprepago"] = $resultado["saldoprepago"] + $p["valor"];
                    } else {
                        $resultado["saldoprepago"] = $resultado["saldoprepago"] - $p["valor"];
                    }
                }
            }
            if ($resultado["saldoprepago"] < $valor) {
                $resultado["codigoError"] = '0021';
                $resultado["msgError"] = 'NO EXISTE SALDO SUFICIENTE';
                return $resultado;
            }

            $arrCampos = array(
                'identificacion',
                'fecha',
                'hora',
                'ip',
                'operador',
                'usuario',
                'tipomov',
                'servicio',
                'concepto',
                'expediente',
                'recibo',
                'cantidad',
                'valor'
            );
            $arrValores = array(
                "'" . $ide . "'",
                "'" . date("Ymd") . "'",
                "'" . date("His") . "'",
                "'" . $ip . "'",
                "''", // Operador
                "'" . $usuario . "'",
                "'D",
                "'" . $servicio . "'",
                "'" . $detalle . "'",
                "'" . $expediente . "'",
                "'" . $recibo . "'",
                $cantidad,
                $valor
            );
            insertarRegistrosMysqli2($dbx, 'mreg_prepagos_uso', $arrCampos, $arrValores);
            $prep = retornarRegistroMysqli2($dbx, 'mreg_prepagos', "identificacion='" . $ide . "'");
            $resultado["nombre"] = $prep["nombre"];
            $resultado["nombre1"] = $prep["nombre1"];
            $resultado["nombre2"] = $prep["nombre2"];
            $resultado["apellido1"] = $prep["apellido1"];
            $resultado["apellido2"] = $prep["apellido2"];
            $resultado["email"] = $prep["email"];
            $resultado["celular"] = $prep["celular"];
            $resultado["telefono"] = $prep["telefono"];
            $resultado["direccion"] = $prep["direccion"];
            $resultado["municipio"] = $prep["municipio"];
            $resultado["clave"] = $prep["clave"];
            $resultado["saldoprepago"] = '0';
            $preps = retornarRegistrosMysqli2($dbx, 'mreg_prepagos_uso', "identificacion='" . $ide . "'", "fecha,hora");
            if ($preps && !empty($preps)) {
                $ik = 0;
                foreach ($preps as $p) {
                    if ($p["tipomov"] == 'C') {
                        $resultado["saldoprepago"] = $resultado["saldoprepago"] + $p["valor"];
                    } else {
                        $resultado["saldoprepago"] = $resultado["saldoprepago"] - $p["valor"];
                    }
                }
            }
            return $resultado;
        }

        if ($cri == 'X') { // Resta del cupo de afiliado
            $expediente = ltrim($expediente, "0");

            $afil = retornarRegistroMysqli2($dbx, 'mreg_est_inscritos', "matricula='" . $expediente . "'");
            if ($afil === false || empty($afil)) {
                $resultado["codigoError"] = '0020';
                $resultado["msgError"] = 'NO EXISTE AFILIADO PARA DESCONTAR';
                return $resultado;
            }
            if ($afil["ctrafiliacion"] != '1') {
                $resultado["codigoError"] = '0020';
                $resultado["msgError"] = 'NO EXISTE AFILIADO PARA DESCONTAR';
                return $resultado;
            }
            if ($afil["saldoaflia"] < $valor) {
                $resultado["codigoError"] = '0021';
                $resultado["msgError"] = 'NO EXISTE SALDO SUFICIENTE COMO AFILIADO';
                return $resultado;
            }
            $afil["saldoaflia"] = $afil["saldoaflia"] - $valor;
            $arrCampos = array(
                'saldoaflia'
            );
            $arrValores = array(
                $afil["saldoaflia"]
            );
            unset($_SESSION["expedienteactual"]);
            regrabarRegistrosMysqli2($dbx, 'mreg_est_inscritos', $arrCampos, $arrValores, "matricula='" . $expediente . "'");

            $resultado["nombre"] = $afil["razonsocial"];
            $resultado["nombre1"] = $afil["nombre1"];
            $resultado["nombre2"] = $afil["nombre2"];
            $resultado["apellido1"] = $afil["apellido1"];
            $resultado["apellido2"] = $afil["apellido2"];
            $resultado["email"] = $afil["emailcom"];
            $resultado["telefono"] = $afil["telcom1"];
            $resultado["celular"] = '';
            $resultado["direccion"] = $prep["dircom"];
            $resultado["municipio"] = $prep["muncom"];
            $resultado["clave"] = '';
            $resultado["saldoprepago"] = '0';
            $resultado["saldoafiliado"] = $afil["saldoaflia"];
            return $resultado;
        }
    }

    /**
     * 
     * @param type $dbx
     * @param type $ind
     * @param type $tra
     * @param type $trans
     */
    public static function adicionarActoEstudioAsentarReciboSii($dbx, $ind, $tra, $trans) {
        $arrCampos = array(
            'idradicacion',
            'idliquidacion',
            'idsecuenciatransaccion',
            'idtransaccion',
            'orden',
            'matricula',
            'proponente',
            'idclase',
            'numid',
            'nombre',
            'idclaseacreedor',
            'numidacreedor',
            'nombreacreedor',
            'tipodoc',
            'numdoc',
            'fechadoc',
            'fechavenci',
            'mundoc',
            'txtorigendoc',
            'dirubi',
            'munubi',
            'valor',
            'descripcion',
            'libro',
            'acto',
            'noticia',
            'librocruce',
            'inscripcioncruce',
            'nuevaorganizacion',
            'nuevacategoria',
            'nuevonombre',
            'nuevafechaduracion',
            'camaraanterior',
            'matriculaanterior',
            'fechamatriculaanterior',
            'fecharenovacionanterior',
            'ultimoanorenovadoanterior',
            'municipioanterior',
            'benart7anterior',
            'personal',
            'acttot',
            'pastot',
            'pattot',
            'actvin',
            'clase_libro',
            'tipo_libro',
            'codigo_libro',
            'nombre_libro',
            'email_libro',
            'emailconfirmacion_libro',
            'paginainicial_libro',
            'paginafinal_libro',
            'libeleanot_libro',
            'libeleanot_registro',
            'libeleanot_dupli',
            'libeleanot_nroacta',
            'libeleanot_fechaacta',
            'libeleanot_nropaginas',
            'libeleanot_fechainiinscripciones',
            'libeleanot_fechafininscripciones',
            'libeleanot_nroregistros',
            'actanro_libro',
            'fechaacta_libro',
            'numlibro',
            'numreg',
            'dupli',
            'fechareg',
            'horareg',
            'usuario'
        );

        //
        switch ($ind) {
            case 1 : $lib = substr($trans["idacto1"], 0, 4);
                $act = $trans["idacto1"];
                break;
            case 2 : $lib = substr($trans["idacto2"], 0, 4);
                $act = $trans["idacto2"];
                break;
            case 3 : $lib = substr($trans["idacto3"], 0, 4);
                $act = $trans["idacto3"];
                break;
            case 4 : $lib = substr($trans["idacto4"], 0, 4);
                $act = $trans["idacto4"];
                break;
            case 5 : $lib = substr($trans["idacto5"], 0, 4);
                $act = $trans["idacto5"];
                break;
        }


        //
        if (ltrim($tra["cantidad"], "0") == '') {
            $tra["cantidad"] = 1;
        }

        //
        for ($i = 1; $i <= $tra["cantidad"]; $i++) {

            if (ltrim($tra["paginainicial_libro"], "0") == '') {
                $tra["paginainicial_libro"] = 0;
            }
            if (ltrim($tra["paginafinal_libro"], "0") == '') {
                $tra["paginafinal_libro"] = 0;
            }

            // En caso que sea un trámite de libros de comercio
            if ($tra["clase_libro"] == 'F') {
                $tra["noticia"] = "REGISTRO DEL LIBRO " . $tra["nombre_libro"] .
                        " DE LA PAGINA NO. " . $tra["paginainicial_libro"] .
                        " A LA " . $tra["paginafinal_libro"] . " (TOTAL " .
                        intval($tra["paginafinal_libro"] - $tra["paginainicial_libro"] + 1) . " FOLIOS)";
            }

            // En caso que la noticia mercantil esté vacía
            // Embargos
            // Desembargos        
            if (trim($tra["noticia"]) == '') {
                if (trim($tra["embargo"]) != '') {
                    $tra["noticia"] .= trim($tra["embargo"]);
                }
                if (trim($tra["desembargo"]) != '') {
                    if (trim($tra["noticia"]) != '') {
                        $tra["noticia"] .= chr(13) . chr(10);
                    }
                    $tra["noticia"] .= trim($tra["desembargo"]);
                }
                if (trim($tra["texto"]) != '') {
                    if (trim($tra["noticia"]) != '') {
                        $tra["noticia"] .= chr(13) . chr(10);
                    }
                    $tra["noticia"] .= trim($tra["texto"]);
                }
            }

            //
            if (trim($tra["noticia"]) == '') {
                $tra["noticia"] = retornarRegistroMysqli2($dbx, 'mreg_actos', "idlibro='" . $lib . "' and idacto='" . substr($act, 5, 4) . "'", "nombre");
            }

            // *************************************************************** //
            // Asigna ls variables del expediente al acto a registrar
            // Por defecto asume los asociados con la matrícula afectada
            // *************************************************************** //
            $matx = $tra["matriculaafectada"];
            $tipoidex = $tra["tipoidentificacion"];
            $idex = $tra["identificacion"];
            $nomx = $tra["razonsocial"];
            $norgx = $tra["organizacion"];
            $ncatx = $tra["categoria"];
            $nnomx = $tra["razonsocial"];
            $perx = $tra["personal"];
            $actix = $tra["activos"];

            // En caso de contratos de compraventa
            if ($trans["idtipotransaccion"] == '022') {
                $actx = retornarRegistroMysqli2($dbx, 'mreg_actos', "idlibro='" . $lib . "' and idacto='" . substr($act, 5, 4) . "'");
                if ($actx["idgrupoacto"] == '002') { // Si se trata de una cancelacion mueve el vendedor
                    $matx = $tra["matriculavendedor"];
                    $tipoidex = $tra["tipoidentificacionvendedor"];
                    $idex = $tra["identificacionvendedor"];
                    $nomx = $tra["nombrevendedor"];
                    $norgx = '';
                    $ncatx = '';
                    $nnomx = '';
                    $perx = 0;
                    $actix = 0;
                    if ($nomx == '') {
                        $nomx = trim($tra["apellido1vendedor"] . ' ' . $tra["apellido2vendedor"] . ' ' . $tra["nombre1vendedor"] . ' ' . $tra["nombre2vendedor"]);
                    }
                }
                if ($actx["idgrupoacto"] == '001' || $actx["idgrupoacto"] == '024') { // Si se trata de la matrícula mueve el comprador
                    $matx = $tra["matriculacomprador"];
                    $tipoidex = $tra["tipoidentificacioncomprador"];
                    $idex = $tra["identificacioncomprador"];
                    $nomx = $tra["nombrecomprador"];
                    $norgx = $tra["organizacioncomprador"];
                    $ncatx = $tra["categoriacomprador"];
                    $perx = $tra["personalcomprador"];
                    $actix = $tra["activoscomprador"];
                    if ($nomx == '') {
                        $nomx = trim($tra["apellido1comprador"] . ' ' . $tra["apellido2comprador"] . ' ' . $tra["nombre1comprador"] . ' ' . $tra["nombre2comprador"]);
                    }
                    $nnomx = $nomx;
                }
            }

            //
            $_SESSION["generales"]["icontrol"] ++;
            $arrValores = array(
                "'" . ltrim($_SESSION["tramite"]["numeroradicacion"], "0") . "'",
                $tra["idliquidacion"],
                $tra["idsecuencia"],
                "'" . $tra["idtransaccion"] . "'",
                "'" . sprintf("%02s", $_SESSION["generales"]["icontrol"]) . "'",
                "'" . $matx . "'",
                "''", // proponente
                "'" . $tipoidex . "'", // Id clase
                "'" . $idex . "'", // Num id
                "'" . addslashes($nomx) . "'", // Nombre
                "''", // Tipo Id acreedor
                "''", // Num Id clase acreedor
                "''", // Nombre acreedor
                "'" . $tra["tipodoc"] . "'",
                "'" . $tra["numdoc"] . "'",
                "'" . $tra["fechadoc"] . "'",
                "''", // Fecha vencimiento
                "'" . $tra["mundoc"] . "'",
                "'" . $tra["origendoc"] . "'",
                "''", // Direccion ubicacion
                "''", // Municipio ubicacion
                0, // Valor
                "''", // Descripcion
                "'" . $lib . "'",
                "'" . $act . "'",
                "'" . addslashes($tra["noticia"]) . "'",
                "''", // Libro cruce
                "''", //Inscripcion cruce
                "'" . $norgx . "'", // Nueva organizacion
                "'" . $ncatx . "'", // Nueva categoria
                "'" . $nnomx . "'", // Nombre
                "'" . $tra["fechaduracion"] . "'", // Nueva fecha de duracion
                "'" . $tra["camaraanterior"] . "'",
                "'" . $tra["matriculaanterior"] . "'",
                "'" . $tra["fechamatriculaanterior"] . "'",
                "'" . $tra["fecharenovacionanterior"] . "'",
                "'" . $tra["ultimoanorevadoanterior"] . "'",
                "'" . $tra["municipioanterior"] . "'",
                "'" . $tra["benart7anterior"] . "'",
                doubleval($perx), // personal
                doubleval($actix), // acttot
                0, // pasttot
                doubleval($tra["patrimonio"]), // pattot
                doubleval($tra["activos"]), // actvin
                "'" . $tra["clase_libro"] . "'", // Clase de libro (F, E, A)
                "'" . $tra["tipo_libro"] . "'", // tipo de libro
                "'" . $tra["codigo_libro"] . "'", // Código del libro
                "'" . $tra["nombre_libro"] . "'", // Nombre del libro
                "'" . $tra["email_libro"] . "'", // Email del libro
                "'" . $tra["emailconfirmacion_libro"] . "'", // Emailconfirmacion del libro
                "'" . $tra["paginainicial_libro"] . "'", // Pagina inicial
                "'" . $tra["paginafinal_libro"] . "'", // Pagina final
                "'" . $tra["libeleanot_libro"] . "'", // Pagina final
                "'" . $tra["libeleanot_registro"] . "'", // Pagina final
                "'" . $tra["libeleanot_dupli"] . "'", // Pagina final
                "'" . $tra["libeleanot_nroacta"] . "'", // Pagina final
                "'" . $tra["libeleanot_fechaacta"] . "'", // Pagina final
                intval($tra["libeleanot_nropaginas"]), // Pagina final
                "'" . $tra["libeleanot_fechainiinscripciones"] . "'", // Pagina final
                "'" . $tra["libeleanot_fechafininscripciones"] . "'", // Pagina final
                intval($tra["libeleanot_nroregistros"]), // Pagina final
                "'" . $tra["actanro_libro"] . "'", // Acta Nro Libro
                "'" . $tra["fechaacta_libro"] . "'", // Fecha del Acta del Libro
                "''", // Libro
                "''", // Registro
                "''", // Dupli
                "''", // Fecha registro
                "''", // Hora registro
                "''" // Usuario
            );
            $res = insertarRegistrosMysqli2($dbx, 'mreg_estudio_actos_registro', $arrCampos, $arrValores);
            if ($res === false) {
                $nameLog = 'adicionarActoEstudioAsentarReciboSii_' . date("Ymd");
                \logSii2::general2($nameLog, '', utf8_encode('Error creando mreg_estudio_actos_registro : ' . $_SESSION["generales"]["mensajeerror"]));
            }
        }
    }

    /**
     * 
     * @param type $dbx
     * @param type $tramae
     * @param type $tradat
     * @param type $tiptra
     * @param type $numacto
     * @return type
     */
    public static function adicionarInscripcionCancelacion($dbx, $tramae, $tradat, $tiptra, $numacto) {

        $xActo = '';
        switch ($numacto) {
            case 1 : $xActo = $tramae["idacto1"];
                break;
            case 2 : $xActo = $tramae["idacto2"];
                break;
            case 3 : $xActo = $tramae["idacto3"];
                break;
            case 4 : $xActo = $tramae["idacto4"];
                break;
            case 5 : $xActo = $tramae["idacto5"];
                break;
        }

        $res = array();
        $res ["tiporegistro"] = $tiptra["tiporegistro"];
        $res ["tiposello"] = '90.20.31';
        $res ["libro"] = substr($xActo, 0, 4);
        $res ["numreg"] = '';
        $res ["organizacion"] = $tradat["organizacion"];
        $res ["filesello"] = '';
        $res ["noticia"] = 'CANCELACION MATRICULA MERCANTIL';
        if ($tradat["organizacion"] == '02') {
            $res ["noticia"] = 'CANCELACION MATRICULA MERCANTIL DE ESTABLECIMIENTO DE COMERCIO';
        }
        if (substr($xActo, 5, 4) == '0532') {
            $res ["noticia"] = 'CANCELACION MATRICULA MERCANTIL POR CAMBIO DE DOMICILIO';
            if ($tradat["municipiodestino"] != '') {
                $res["noticia"] .= ' A LA CIUDAD DE ' . retornarRegistroMysqli2($dbx, 'bas_municipios', "codigomunicipio='" . $tradat["municipiodestino"] . "'", "ciudad");
            }
        }
        $res ["matricula"] = $tradat["matriculaafectada"];
        $res ["proponente"] = '';
        $res ["tipodoc"] = $tradat["tipodoc"];
        $res ["numdoc"] = $tradat["numdoc"];
        $res ["origendoc"] = $tradat["origendoc"];
        $res ["fechadoc"] = $tradat["fechadoc"];
        $res ["municipio"] = $tradat["mundoc"];
        $res ["acto"] = substr($xActo, 5, 4);
        $res ["fecha"] = date("Ymd");
        $res ["hora"] = date("His");
        $res ["tipoidentificacion"] = $tradat["tipoidentificacion"];
        $res ["identificacion"] = $tradat["identificacion"];
        $res ["nombre"] = $tradat["razonsocial"];
        $res ["ope"] = $_SESSION["generales"]["idcodigosirepcaja"]; // 12016-01-12 : JINT : Asigna el registro añ cajero que hce el trámite
        $res ["bandeja"] = $tiptra["bandeja"];

        return $res;
    }

    /**
     * 
     * @param type $dbx
     * @param type $liq
     * @param type $dat
     * @param type $mom
     * @return boolean
     */
    public static function almacenarDatosImportantesRenovacion($dbx, $liq, $dat, $mom) {

        //
        if ($mom == 'F') {
            borrarRegistrosMysqli2($dbx, 'mreg_renovacion_datos_control', "idliquidacion=" . $liq . " and matricula='" . ltrim($dat["matricula"], "0") . "' and momento='F'");
        }

        //
        $arrCampos = array(
            'idliquidacion',
            'matricula',
            'dato',
            'contenido',
            'momento'
        );

        //
        $arrValores = array();

        //
        foreach ($dat as $key => $valor) {
            if (!is_array($valor)) {
                if (ltrim(trim($valor), "0") != '') {
                    $arrValores[] = array($liq, "'" . ltrim($dat["matricula"], "0") . "'", "'" . $key . "'", "'" . $valor . "'", "'" . $mom . "'");
                }
            } else {
                foreach ($valor as $k1 => $v1) {
                    if (!is_array($v1)) {
                        if (ltrim(trim($v1), "0") != '') {
                            $dx = $key . '|' . $k1;
                            $arrValores[] = array($liq, "'" . ltrim($dat["matricula"], "0") . "'", "'" . $dx . "'", "'" . $v1 . "'", "'" . $mom . "'");
                        }
                    } else {
                        foreach ($v1 as $k2 => $v2) {
                            if (!is_array($v2)) {
                                if (ltrim(trim($v2), "0") != '') {
                                    $dx = $key . '|' . $k1 . '|' . $k2;
                                    $arrValores[] = array($liq, "'" . ltrim($dat["matricula"], "0") . "'", "'" . $dx . "'", "'" . $v2 . "'", "'" . $mom . "'");
                                }
                            }
                        }
                    }
                }
            }
        }

        //
        if (trim($dat["ciius"][1]) != '') {
            $arrValores[] = array($liq, "'" . ltrim($dat["matricula"], "0") . "'", "'ciiu1'", "'" . $dat["ciius"][1] . "'", "'" . $mom . "'"); // Ciiu1
        }
        if (trim($dat["ciius"][2]) != '') {
            $arrValores[] = array($liq, "'" . ltrim($dat["matricula"], "0") . "'", "'ciiu2'", "'" . $dat["ciius"][2] . "'", "'" . $mom . "'"); // Ciiu2
        }
        if (trim($dat["ciius"][3]) != '') {
            $arrValores[] = array($liq, "'" . ltrim($dat["matricula"], "0") . "'", "'ciiu3'", "'" . $dat["ciius"][3] . "'", "'" . $mom . "'"); // Ciiu3
        }
        if (trim($dat["ciius"][4]) != '') {
            $arrValores[] = array($liq, "'" . ltrim($dat["matricula"], "0") . "'", "'ciiu4'", "'" . $dat["ciius"][4] . "'", "'" . $mom . "'"); // Ciiu4
        }

        //
        insertarRegistrosBloqueMysqli2($dbx, 'mreg_renovacion_datos_control', $arrCampos, $arrValores);
        return true;
    }

    /**
     * Asigna las variables de sesion necesarias para ejecutar los procesos internos
     * 
     * @param type $dbx
     * @param type $entrada
     * @return boolean
     */
    public static function asignarVariablesSessionSii($dbx, $entrada) {

        $_SESSION["generales"]["zonahoraria"] = "America/Bogota";
        $_SESSION["generales"]["idioma"] = "es";
        $_SESSION["generales"]["navegador"] = obtenerNavegador(getenv("HTTP_USER_AGENT"));
        $_SESSION["generales"]["codigousuario"] = 'USUPUBXX';
        $_SESSION["generales"]["tipousuario"] = '00';
        $_SESSION["generales"]["emailusuariocontrol"] = $entrada["emailcontrol"];
        $_SESSION["generales"]["identificacionusuariocontrol"] = $entrada["identificacioncontrol"];
        $_SESSION["generales"]["celularusuariocontrol"] = $entrada["celularcontrol"];
        $_SESSION["generales"]["validado"] = 'NO';
        $_SESSION["generales"]["escajero"] = 'NO';
        $_SESSION["generales"]["tipousuariocontrol"] = 'usuarioanonimo';
        $_SESSION["generales"]["sedeusuario"] = '99';
        $_SESSION["generales"]["gastoadministrativo"] = 'NO';
        $_SESSION["generales"]["esdispensador"] = 'NO';
        $_SESSION["generales"]["escensador"] = 'NO';
        $_SESSION["generales"]["esbrigadista"] = 'NO';
        $_SESSION["generales"]["puedecerrarcaja"] = 'NO';
        $_SESSION["generales"]["visualizatotales"] = 'NO';
        $_SESSION["generales"]["esrue"] = 'NO';
        $_SESSION["generales"]["eswww"] = 'SI';
        $_SESSION["generales"]["esreversion"] = 'NO';
        $_SESSION["generales"]["essa"] = 'NO';
        $_SESSION["generales"]["esbanco"] = 'NO';
        $_SESSION["generales"]["abogadocoordinador"] = 'NO';
        $_SESSION["generales"]["loginemailusuario"] = $entrada["emailcontrol"];
        $_SESSION["generales"]["perfildocumentacion"] = '';
        $_SESSION["generales"]["controlapresupuesto"] = '';
        $_SESSION["generales"]["idtipoidentificacionusuario"] = $entrada["identificacioncontrol"];
        $_SESSION["generales"]["identificacionusuario"] = $entrada["identificacioncontrol"];
        $_SESSION["generales"]["nitempresausuario"] = '';
        $_SESSION["generales"]["nombreempresausuario"] = '';
        $_SESSION["generales"]["direccionusuario"] = '';
        $_SESSION["generales"]["idmuniciopiousuario"] = '';
        $_SESSION["generales"]["telefonousuario"] = '';
        $_SESSION["generales"]["movilusuario"] = $entrada["celularcontrol"];
        $_SESSION["generales"]["operadorsirepusuario"] = '';
        $_SESSION["generales"]["ccosusuario"] = '';
        $_SESSION["generales"]["cargousuario"] = '';
        $_SESSION["generales"]["nombreempresa"] = '';
        $_SESSION["generales"]["idcodigosirepcaja"] = '';
        $_SESSION["generales"]["idcodigosirepdigitacion"] = '';
        $_SESSION["generales"]["idcodigosirepregistro"] = '';
        $_SESSION["generales"]["habilitadobiometria"] = 'NO';
        $_SESSION["generales"]["administradorbiometria"] = 'NO';
        $_SESSION["generales"]["controlverificacion"] = '';
        $_SESSION["generales"]["fechaactivacion"] = '';
        $_SESSION["generales"]["fechainactivacion"] = '';
        $_SESSION["generales"]["fechacambioclave"] = '';

        if ($entrada["idusuario"] == 'USUPUBXX') {
            $query = "email='" . $entrada["emailcontrol"] . "' and identificacion='" . $entrada["identificacioncontrol"] . "' and celular='" . $entrada["celularcontrol"] . "'";
            $temx = retornarRegistroMysqli2($dbx, 'usuarios_verificados', $query);
            if ($temx === false || empty($temx)) {
                $temx = retornarRegistroMysqli2($dbx, 'usuarios_registrados', $query);
                if ($temx === false || empty($temx)) {
                    return false;
                } else {
                    $tusu = 'usuarioregistrado';
                }
            } else {
                $tusu = 'usuarioverificado';
            }
            $_SESSION["generales"]["validado"] = 'SI';
            $_SESSION["generales"]["escajero"] = 'NO';
            $_SESSION["generales"]["tipousuariocontrol"] = $tusu;
            $_SESSION["generales"]["sedeusuario"] = '99';
            $_SESSION["generales"]["gastoadministrativo"] = 'NO';
            $_SESSION["generales"]["esdispensador"] = 'NO';
            $_SESSION["generales"]["escensador"] = 'NO';
            $_SESSION["generales"]["esbrigadista"] = 'NO';
            $_SESSION["generales"]["puedecerrarcaja"] = 'NO';
            $_SESSION["generales"]["visualizatotales"] = 'NO';
            $_SESSION["generales"]["esrue"] = 'NO';
            $_SESSION["generales"]["eswww"] = 'SI';
            $_SESSION["generales"]["esreversion"] = 'NO';
            $_SESSION["generales"]["essa"] = 'NO';
            $_SESSION["generales"]["esbanco"] = 'NO';
            $_SESSION["generales"]["abogadocoordinador"] = 'NO';
            $_SESSION["generales"]["loginemailusuario"] = $entrada["emailcontrol"];
            $_SESSION["generales"]["perfildocumentacion"] = '';
            $_SESSION["generales"]["controlapresupuesto"] = '';
            $_SESSION["generales"]["idtipoidentificacionusuario"] = $entrada["identificacioncontrol"];
            $_SESSION["generales"]["identificacionusuario"] = $entrada["identificacioncontrol"];
            $_SESSION["generales"]["nitempresausuario"] = '';
            $_SESSION["generales"]["nombreempresausuario"] = '';
            $_SESSION["generales"]["direccionusuario"] = '';
            $_SESSION["generales"]["idmuniciopiousuario"] = '';
            $_SESSION["generales"]["telefonousuario"] = '';
            $_SESSION["generales"]["movilusuario"] = $entrada["celularcontrol"];
            $_SESSION["generales"]["operadorsirepusuario"] = '';
            $_SESSION["generales"]["ccosusuario"] = '';
            $_SESSION["generales"]["cargousuario"] = '';
            $_SESSION["generales"]["nombreempresa"] = '';
            $_SESSION["generales"]["idcodigosirepcaja"] = '';
            $_SESSION["generales"]["idcodigosirepdigitacion"] = '';
            $_SESSION["generales"]["idcodigosirepregistro"] = '';
            $_SESSION["generales"]["controlverificacion"] = '';
            $_SESSION["generales"]["fechaactivacion"] = '';
            $_SESSION["generales"]["fechainactivacion"] = '';
            $_SESSION["generales"]["fechacambioclave"] = '';
        } else {
            $temx = retornarRegistroMysqli2($dbx, "usuarios", "idusuario='" . $entrada["idusuario"] . "'");
            if ($temx === false || empty($temx)) {
                return false;
            }
            $_SESSION["generales"]["codigousuario"] = $entrada["idusuario"];
            $_SESSION["generales"]["tipousuario"] = $temx["idtipousuario"];
            $_SESSION["generales"]["emailusuariocontrol"] = $temx["email"];
            $_SESSION["generales"]["identificacionusuariocontrol"] = $temx["identificacion"];
            $_SESSION["generales"]["celularusuariocontrol"] = $temx["celular"];
            $_SESSION["generales"]["validado"] = 'SI';
            $_SESSION["generales"]["escajero"] = $temx["escajero"];
            $_SESSION["generales"]["tipousuariocontrol"] = 'usuariointerno';
            $_SESSION["generales"]["sedeusuario"] = $temx["idsede"];
            if ($entrada["idusuario"] == 'RUE') {
                $_SESSION["generales"]["sedeusuario"] = '90';
            }
            if ($entrada["idusuario"] == 'RUE') {
                $_SESSION["generales"]["sedeusuario"] = $temx["idsede"];
            }
            if ($temx["idtipousuario"] == '06') {
                $_SESSION["generales"]["sedeusuario"] = '98';
            }

            if ($temx["esbanco"] == 'SI') {
                $_SESSION["generales"]["sedeusuario"] = '97';
            }
            $_SESSION["generales"]["gastoadministrativo"] = $temx["gastoadministrativo"];
            $_SESSION["generales"]["esdispensador"] = $temx["esdispensador"];
            $_SESSION["generales"]["escensador"] = $temx["escensador"];
            $_SESSION["generales"]["esbrigadista"] = $temx["esbrigadista"];
            $_SESSION["generales"]["puedecerrarcaja"] = $temx["puedecerrarcaja"];
            $_SESSION["generales"]["visualizatotales"] = $temx["visualizatotales"];
            $_SESSION["generales"]["esrue"] = $temx["esrue"];
            $_SESSION["generales"]["eswww"] = $temx["eswww"];
            $_SESSION["generales"]["esreversion"] = $temx["esreversion"];
            $_SESSION["generales"]["essa"] = $temx["essa"];
            $_SESSION["generales"]["esbanco"] = $temx["esbanco"];
            $_SESSION["generales"]["abogadocoordinador"] = $temx["abogadocoordinador"];
            $_SESSION["generales"]["loginemailusuario"] = $temx["email"];
            $_SESSION["generales"]["perfildocumentacion"] = $temx["idperfildocumentacion"];
            $_SESSION["generales"]["controlapresupuesto"] = $temx["controlapresupuesto"];
            $_SESSION["generales"]["idtipoidentificacionusuario"] = $temx["idtipoidentificacion"];
            $_SESSION["generales"]["identificacionusuario"] = $temx["identificacion"];
            $_SESSION["generales"]["nitempresausuario"] = $temx["nitempresa"];
            $_SESSION["generales"]["nombreempresausuario"] = $temx["nombreempresa"];
            $_SESSION["generales"]["direccionusuario"] = $temx["direccion"];
            $_SESSION["generales"]["idmuniciopiousuario"] = $temx["idmunicipio"];
            $_SESSION["generales"]["telefonousuario"] = $temx["telefonos"];
            $_SESSION["generales"]["movilusuario"] = $temx["celular"];
            $_SESSION["generales"]["operadorsirepusuario"] = '';
            $_SESSION["generales"]["ccosusuario"] = '';
            $_SESSION["generales"]["cargousuario"] = '';
            $_SESSION["generales"]["nombreempresa"] = '';
            $_SESSION["generales"]["idcodigosirepcaja"] = $temx["idcodigosirepcaja"];
            $_SESSION["generales"]["idcodigosirepdigitacion"] = $temx["idcodigosirepdigitacion"];
            $_SESSION["generales"]["idcodigosirepregistro"] = $temx["idcodigosirepregistro"];
            $_SESSION["generales"]["habilitadobiometria"] = $temx["habilitadobiometria"];
            $_SESSION["generales"]["administradorbiometria"] = $temx["administradorbiometria"];
            $_SESSION["generales"]["controlverificacion"] = '';
            $_SESSION["generales"]["fechaactivacion"] = $temx["fechaactivacion"];
            $_SESSION["generales"]["fechainactivacion"] = $temx["fechainactivacion"];
            $_SESSION["generales"]["fechacambioclave"] = '';
            $_SESSION["generales"]["validado"] = 'NO';
            $_SESSION["generales"]["mensajeerror"] = '';
            $_SESSION["generales"]["pagina"] = '';
            $_SESSION["generales"]["disco"] = '001';
            $_SESSION["generales"]["tipodoc"] = 'mreg';
            $_SESSION["generales"]["sega"] = 'PPAL';
        }

        return true;
    }

    /**
     * 
     * @param type $dbx
     * @param type $tipo
     * @return type
     */
    public static function asignarNumeroRecuperacionSii($dbx, $tipo) {
        require_once('generales.php');

        $OK = 'NO';
        while ($OK == 'NO') {
            if ($tipo == 'mreg') {


                $num = strtoupper(trim(\funcionesSii2::generarAleatorioAlfanumerico('')));
                if (contarRegistrosMysqli2($dbx, 'mreg_liquidacion', "numerorecuperacion='" . trim($num) . "'") == 0) {
                    $OK = "SI";
                } else {
                    $num = strtoupper(trim(\funcionesSii2::generarAleatorioAlfanumerico('')));
                }
            } else {
                if ($tipo == 'news') {
                    $num = strtoupper(trim(\funcionesSii2::generarAleatorioAlfanumerico10('')));
                    if (contarRegistrosMysqli2($dbx, 'news', "numerorecuperacion='" . trim($num) . "'") == 0) {
                        $OK = "SI";
                    } else {
                        $num = strtoupper(trim(\funcionesSii2::generarAleatorioAlfanumerico10('')));
                    }
                } else {
                    $num = strtoupper(trim(\funcionesSii2::generarAleatorioAlfanumerico('')));
                }
            }
        }
        return $num;
    }

    /**
     * 
     * @param type $action
     * @param type $secret_key
     * @param type $secret_iv
     * @param type $string
     * @return type
     */
    public static function encrypt_decrypt($action, $secret_key = 'c0nf3c4m4r4s', $secret_iv = 'c0nf3c4m4r4s', $string = '') {
        $output = false;
        $encrypt_method = "AES-256-CBC";
        $key = hash('sha256', $secret_key);

        // iv - encrypt method AES-256-CBC expects 16 bytes - else you will get a warning
        $iv = substr(hash('sha256', $secret_iv), 0, 16);
        if ($action == 'encrypt') {
            $output = openssl_encrypt($string, $encrypt_method, $key, 0, $iv);
            $output = base64_encode($output);
        } else if ($action == 'decrypt') {
            $output = openssl_decrypt(base64_decode($string), $encrypt_method, $key, 0, $iv);
        }
        return $output;
    }
    

    /**
     * 
     * @param type $servmail
     * @param type $portsmtp
     * @param type $requiautenticacion
     * @param type $tipoencripcion
     * @param type $ctaremi
     * @param type $passremi
     * @param type $remiemail
     * @param type $nombreremi
     * @param type $destino
     * @param type $asunto
     * @param type $mensaje
     * @param type $attach
     * @param type $ctrmasivo
     * @return boolean
     */
    public static function enviarEmailSii2($servmail, $portsmtp, $requiautenticacion, $tipoencripcion, $ctaremi, $passremi, $remiemail, $nombreremi, $destino, $asunto, $mensaje, $attach = array(), $ctrmasivo = 'no') {
        require_once ('phpmailer/class.phpmailer.php');
        // require_once ('myErrorHandler.php');
        require_once ('LogSii2.class.php');
        // set_error_handler('myErrorHandler');
        // Envía correo a través de servicios SMTP
        $mail = new PHPMailer();
        $mail->PluginDir = 'phpmailer/';
        $mail->SetLanguage("es", 'phpmailer/language/');

        //
        $mail->IsSMTP();



        //
        try {
            $mail->Host = $servmail;
            $mail->Port = $portsmtp;
            // $mail->SMTPAuth = $requiautenticacion;
            $mail->SMTPAuth = true;
            if ($tipoencripcion != '') {
                $mail->SMTPSecure = $tipoencripcion;
            }
            $mail->Username = $ctaremi;
            $mail->Password = $passremi;
            $mail->From = $remiemail;
            $mail->FromName = $nombreremi;

            //
            $cantidadRemitentes = 0;
            $cantidadRemitentesAlterno = 0;

            //
            $txt = '';
            if (is_array($destino)) {
                foreach ($destino as $dest) {
                    $encuentraDominio = strpos($dest, 'mail.confecamaras.co');
                    if ($encuentraDominio === false) {
                        $txt .= $dest . ' - ';
                        $mail->AddAddress($dest);
                        $cantidadRemitentes++;
                    }
                }

                $cantidadRemitentes = $cantidadRemitentes + $cantidadRemitentesAlterno;
                if ($cantidadRemitentes <= 0) {
                    return false;
                }
            } else {

                $encuentraDominio = strpos($destino, 'mail.confecamaras.co');
                if ($encuentraDominio === false) {
                    $txt .= $destino . ' - ';
                    $mail->AddAddress($destino);
                    $cantidadRemitentes++;
                }
            }

            if ($cantidadRemitentes <= 0) {
                return false;
            }

            //
            $mail->WordWrap = 50;
            if (!empty($attach)) {
                foreach ($attach as $at) {
                    $mail->AddAttachment($at);
                }
            }
            $mail->IsHTML(true);
            $mail->CharSet = 'UTF-8';
            $mail->Subject = $asunto;
            $mail->Body = $mensaje;

            //
            if (!$mail->Send()) {
                $_SESSION["generales"]["mensajeerror"] = $mail->ErrorInfo;
                \logSii2::general2('email', __FUNCTION__, $txt . ' = ' . $_SESSION["generales"]["mensajeerror"]);
                return false;
            } else {
                $_SESSION["generales"]["mensajeerror"] = '';
                \logSii2::general2('email', __FUNCTION__, $txt . ' = ok');
                return true;
            }
        } catch (phpmailerException $e) {
            $_SESSION["generales"]["mensajeerror"] = $e->errorMessage(); //Pretty error messages from PHPMailer;
            \logSii2::general2('email', __FUNCTION__, $txt . ' = ' . $_SESSION["generales"]["mensajeerror"]);
            return false;
        } catch (Exception $e) {
            $_SESSION["generales"]["mensajeerror"] = $e->getMessage(); //Boring error messages from anything else!
            \logSii2::general2('email', __FUNCTION__, $txt . ' = ' . $_SESSION["generales"]["mensajeerror"]);
            return false;
        }
    }

    public static function evaluarArchivadorAsentarReciboSii($idserv) {
        $archivador = '01';
        if (substr($idserv, 0, 6) == '010101') {
            $archivador = '01';
        }
        if (substr($idserv, 0, 6) == '010102') {
            $archivador = '02';
        }
        if (substr($idserv, 0, 6) == '010103') {
            $archivador = '03';
        }
        if (substr($idserv, 0, 6) == '010201') {
            $archivador = '01';
        }
        if (substr($idserv, 0, 6) == '010202') {
            $archivador = '01';
        }
        if (substr($idserv, 0, 6) == '010203' ||
                substr($idserv, 0, 6) == '010204' ||
                substr($idserv, 0, 6) == '010205' ||
                substr($idserv, 0, 6) == '010206') {
            $archivador = '02';
        }
        if (substr($idserv, 0, 6) >= '010301' &&
                substr($idserv, 0, 6) <= '010322') {
            $archivador = '01';
        }
        if (substr($idserv, 0, 6) >= '010351' &&
                substr($idserv, 0, 6) <= '010355') {
            $archivador = '03';
        }
        if (substr($idserv, 0, 8) == '01020208') {
            $archivador = '03';
        }
        if (substr($idserv, 0, 6) == '010501') {
            $archivador = '01';
        }
        if (substr($idserv, 0, 6) == '010502') {
            $archivador = '02';
        }
        if (substr($idserv, 0, 6) == '010503') {
            $archivador = '03';
        }
        return $archivador;
    }

    public static function generarAleatorioNumerico($dbx, $validar = '') {
        $numrecvalido = 'NO';
        while ($numrecvalido == 'NO') {
            $ok = 'NO';
            while ($ok == 'NO') {
                $alfanumerico = '0123456789';
                $num = '';
                for ($i = 1; $i <= 6; $i++) {
                    $num .= substr(substr($alfanumerico, rand(1, strlen($alfanumerico))), 0, 1);
                }
                if (strlen($num) == 6) {
                    $ok = 'SI';
                }
            }
            if ($validar == '') {
                $numrecvalido = 'SI';
            }
            if ($validar == 'mreg_liquidacion') {
                if (contarRegistrosMysqli2($dbx, 'mreg_liquidacion', "numerorecuperacion='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }
        }
        return $num;
    }

    public static function generarAleatorioAlfanumerico($dbx, $validar = '') {
        $numrecvalido = 'NO';
        while ($numrecvalido == 'NO') {
            $ok = 'NO';
            while ($ok == 'NO') {
                $alfanumerico = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                $num = '';
                for ($i = 1; $i <= 6; $i++) {
                    $num .= substr(substr($alfanumerico, rand(1, strlen($alfanumerico))), 0, 1);
                }
                if (strlen($num) == 6) {
                    $ok = 'SI';
                }
            }
            if ($validar == '') {
                $numrecvalido = 'SI';
            }
            if ($validar == 'mreg_liquidacion') {
                if (contarRegistrosMysqli2($dbx, 'mreg_liquidacion', "numerorecuperacion='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }
            if ($validar == 'mreg_liquidacion_baloto') {
                if (contarRegistrosMysqli2($dbx, 'mreg_liquidacion_baloto', "volantenumero='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }
            if ($validar == 'mreg_liquidacion_exito') {
                if (contarRegistrosMysqli2($dbx, 'mreg_liquidacion_exito', "volantenumero='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }
            if ($validar == 'mreg_reactivaciones_propias') {
                if (contarRegistrosMysqli2($dbx, 'mreg_reactivaciones_propias', "codigoreactivacion='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }
            if ($validar == 'mreg_certificados_virtuales') {
                if (contarRegistrosMysqli2($dbx, 'mreg_certificados_virtuales', "id='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }
        }
        return $num;
    }

    public static function generarAleatorioAlfanumerico8($dbx, $validar = '') {
        $numrecvalido = 'NO';
        while ($numrecvalido == 'NO') {
            $ok = 'NO';
            while ($ok == 'NO') {
                $alfanumerico = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                $num = '';
                for ($i = 1; $i <= 8; $i++) {
                    $num .= substr(substr($alfanumerico, rand(1, strlen($alfanumerico))), 0, 1);
                }
                if (strlen($num) == 8) {
                    $ok = 'SI';
                }
            }
            if ($validar == '') {
                $numrecvalido = 'SI';
            }
            if ($validar == 'mreg_liquidacion') {
                if (contarRegistrosMysqli2($dbx, 'mreg_liquidacion', "numerorecuperacion='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }
            if ($validar == 'mreg_liquidacion_baloto') {
                if (contarRegistrosMysqli2($dbx, 'mreg_liquidacion_baloto', "volantenumero='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }
            if ($validar == 'mreg_liquidacion_exito') {
                if (contarRegistrosMysqli2($dbx, 'mreg_liquidacion_exito', "volantenumero='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }
            if ($validar == 'mreg_reactivaciones_propias') {
                if (contarRegistrosMysqli2($dbx, 'mreg_reactivaciones_propias', "codigoreactivacion='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }
            if ($validar == 'mreg_certificados_virtuales') {
                if (contarRegistrosMysqli2($dbx, 'mreg_certificados_virtuales', "id='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }
        }
        return $num;
    }

    public static function generarAleatorioAlfanumerico9() {
        $ok = 'NO';
        while ($ok == 'NO') {
            $alfanumerico = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            $num = '';
            for ($i = 1; $i <= 9; $i++) {
                $num .= substr(substr($alfanumerico, rand(1, strlen($alfanumerico))), 0, 1);
            }
            if (strlen($num) == 9) {
                $ok = 'SI';
            }
        }
        return $num;
    }

    public static function generarAleatorioAlfanumerico10($dbx, $validar = '') {
        $numrecvalido = 'NO';
        while ($numrecvalido == 'NO') {
            $ok = 'NO';
            while ($ok == 'NO') {
                // $alfanumerico = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                $alfanumerico = 'abcdefghjkmnpqrstuvwxyzABCDEFGHJKMNPQRSTUVWXYZ123456789';
                $num = '';
                for ($i = 1; $i <= 10; $i++) {
                    $num .= substr(substr($alfanumerico, rand(1, strlen($alfanumerico))), 0, 1);
                }
                if (strlen($num) == 10) {
                    $ok = 'SI';
                }
            }
            if ($validar == '') {
                $numrecvalido = 'SI';
            }

            if ($validar == 'desarrollo_actividades') {
                if (contarRegistrosMysqli2($dbx, 'desarrollo_actividades', "numerorecuperacion='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }

            if ($validar == 'desarrollo_actualizaciones') {
                if (contarRegistrosMysqli2($dbx, 'desarrollo_actualizaciones', "numerorecuperacion='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }


            if ($validar == 'desarrollo_control_cambios') {
                if (contarRegistrosMysqli2($dbx, 'desarrollo_control_cambios', "numerorecuperacion='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }

            if ($validar == 'desarrollo_control_cambios_casosuso') {
                if (contarRegistrosMysqli2($dbx, 'desarrollo_control_cambios_casosuso', "numerorecuperacion='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }

            if ($validar == 'infraestructura_contratos') {
                if (contarRegistrosMysqli2($dbx, 'infraestructura_contratos', "numerorecuperacion='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }

            if ($validar == 'infraestructura_proveedores') {
                if (contarRegistrosMysqli2($dbx, 'infraestructura_proveedores', "numerorecuperacion='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }

            if ($validar == 'infraestructura_clientes') {
                if (contarRegistrosMysqli2($dbx, 'infraestructura_clientes', "numerorecuperacion='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }

            if ($validar == 'infraestructura_comentarios') {
                if (contarRegistrosMysqli2($dbx, 'infraestructura_comentarios', "numerorecuperacion='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }

            if ($validar == 'mreg_envio_matriculas_api') {
                if (contarRegistrosMysqli2($dbx, 'mreg_envio_matriculas_api', "idenvio='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }

            if ($validar == 'mreg_liquidacion_sobre') {
                if (contarRegistrosMysqli2($dbx, 'mreg_liquidacion_sobre', "idsobre='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }

            if ($validar == 'mreg_liquidacion') {
                if (contarRegistrosMysqli2($dbx, 'mreg_liquidacion', "numerorecuperacion='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }
            if ($validar == 'mreg_liquidacion_baloto') {
                if (contarRegistrosMysqli2($dbx, 'mreg_liquidacion_baloto', "volantenumero='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }
            if ($validar == 'mreg_liquidacion_exito') {
                if (contarRegistrosMysqli2($dbx, 'mreg_liquidacion_exito', "volantenumero='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }
            if ($validar == 'mreg_reactivaciones_propias') {
                if (contarRegistrosMysqli2($dbx, 'mreg_reactivaciones_propias', "codigoreactivacion='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }
            if ($validar == 'mreg_certificados_virtuales') {
                if (contarRegistrosMysqli2($dbx, 'mreg_certificados_virtuales', "id='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }
            if ($validar == 'mreg_rues_bloque') {
                if (contarRegistrosMysqli2($dbx, 'mreg_rues_bloque', "numerorecuperacion='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }
            if ($validar == 'mreg_est_inscritos_fotos') {
                if (contarRegistrosMysqli2($dbx, 'mreg_est_inscritos_fotos', "identificadorimagen='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }
        }
        return $num;
    }

    public static function generarAleatorioNumerico10($dbx, $validar = '') {
        $numrecvalido = 'NO';
        while ($numrecvalido == 'NO') {
            $ok = 'NO';
            while ($ok == 'NO') {
                $alfanumerico = '0123456789';
                $num = '';
                for ($i = 1; $i <= 10; $i++) {
                    $num .= substr(substr($alfanumerico, rand(1, strlen($alfanumerico))), 0, 1);
                }
                if (strlen($num) == 10) {
                    $ok = 'SI';
                }
            }
            if ($validar == '') {
                $numrecvalido = 'SI';
            }
            if ($validar == 'mreg_liquidacion') {
                if (contarRegistrosMysqli2($dbx, 'mreg_liquidacion', "numerorecuperacion='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }
            if ($validar == 'mreg_liquidacion_baloto') {
                if (contarRegistrosMysqli2($dbx, 'mreg_liquidacion_baloto', "volantenumero='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }
            if ($validar == 'mreg_liquidacion_exito') {
                if (contarRegistrosMysqli2($dbx, 'mreg_liquidacion_exito', "volantenumero='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }
            if ($validar == 'mreg_reactivaciones_propias') {
                if (contarRegistrosMysqli2($dbx, 'mreg_reactivaciones_propias', "codigoreactivacion='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }
            if ($validar == 'mreg_certificados_virtuales') {
                if (contarRegistrosMysqli2($dbx, 'mreg_certificados_virtuales', "id='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }
        }
        return $num;
    }

    public static function generarAleatorioAlfanumerico20($dbx, $validar = '') {
        $numrecvalido = 'NO';
        while ($numrecvalido == 'NO') {
            $ok = 'NO';
            while ($ok == 'NO') {
                $alfanumerico = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                $num = '';
                for ($i = 1; $i <= 20; $i++) {
                    $num .= substr(substr($alfanumerico, rand(1, strlen($alfanumerico))), 0, 1);
                }
                if (strlen($num) == 20) {
                    $ok = 'SI';
                }
            }
            if ($validar == '') {
                $numrecvalido = 'SI';
            }

            if ($validar == 'mreg_documentos_firmados') {
                if (contarRegistrosMysqli2($dbx, 'mreg_documentos_firmados', "idfirmado='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }

            if ($validar == 'mreg_envio_matriculas_api') {
                if (contarRegistrosMysqli2($dbx, 'mreg_envio_matriculas_api', "idenvio='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }

            if ($validar == 'mreg_liquidacion') {
                if (contarRegistrosMysqli2($dbx, 'mreg_liquidacion', "numerorecuperacion='" . $num . "'") == 0) {
                    $numrecvalido = 'SI';
                }
            }
        }
        return $num;
    }

    public static function buscarRangoTarifaSii($dbx, $idservicio = '', $ano = 0, $base = 0, $tipotarifa = 'tarifa') {
        $retornar = 0;
        if ($ano < 1993) {
            $ano = 1993;
        }
        $result = retornarRegistrosMysqli2($dbx, 'mreg_tarifas', "idservicio='" . $idservicio . "' and ano='" . $ano . "'", "idrango");
        if ($result === false || empty($result)) {
            $retornar = false;
        } else {
            $retornar = 0;
            foreach ($result as $res) {
                if (doubleval($res["topeminimo"]) <= doubleval($base) && doubleval($res["topemaximo"]) >= doubleval($base)) {
                    if ($tipotarifa == 'tarifa') {
                        $retornar = doubleval($res["tarifa"]);
                    }
                    if ($tipotarifa == 'tarifapnat') {
                        $retornar = doubleval($res["tarifapnat"]);
                    }
                    if ($tipotarifa == 'tarifapjur') {
                        $retornar = doubleval($res["tarifapjur"]);
                    }
                }
            }
        }
        return $retornar;
    }

    public static function borrarPalabrasAutomaticas($txt, $comple = '') {
        $salida = $txt;
        if ($comple != '') {
            $pos = strpos($salida, $comple);
            if ($pos) {
                $pos = $pos - 1;
                $salida = substr($salida, 0, $pos);
            }
        }
        $pos = strpos($salida, '- EN LIQUIDACION');
        if ($pos) {
            $pos = $pos - 1;
            $salida = substr($salida, 0, $pos);
        }

        $pos = strpos($salida, '- EN LIQUIDACION JUDICIAL');
        if ($pos) {
            $pos = $pos - 1;
            $salida = substr($salida, 0, $pos);
        }

        $pos = strpos($salida, '- EN LIQUIDACION FORZOSA');
        if ($pos) {
            $pos = $pos - 1;
            $salida = substr($salida, 0, $pos);
        }

        $pos = strpos($salida, '- EN ACUERDO DE REESTRUCTURACION');
        if ($pos) {
            $pos = $pos - 1;
            $salida = substr($salida, 0, $pos);
        }
        $pos = strpos($salida, '- EN REESTRUCTURACION');
        if ($pos) {
            $pos = $pos - 1;
            $salida = substr($salida, 0, $pos);
        }
        $pos = strpos($salida, '- EN REORGANIZACION');
        if ($pos) {
            $pos = $pos - 1;
            $salida = substr($salida, 0, $pos);
        }

        $pos = strpos($salida, 'EN LIQUIDACION');
        if ($pos) {
            $pos = $pos - 1;
            $salida = substr($salida, 0, $pos);
        }

        $pos = strpos($salida, 'EN LIQUIDACION');
        if ($pos) {
            $pos = $pos - 1;
            $salida = substr($salida, 0, $pos);
        }

        $pos = strpos($salida, 'EN LIQUIDACION JUDICIAL');
        if ($pos) {
            $pos = $pos - 1;
            $salida = substr($salida, 0, $pos);
        }

        $pos = strpos($salida, 'EN LIQUIDACION FORZOSA');
        if ($pos) {
            $pos = $pos - 1;
            $salida = substr($salida, 0, $pos);
        }

        $pos = strpos($salida, 'EN ACUERDO DE REESTRUCTURACION');
        if ($pos) {
            $pos = $pos - 1;
            $salida = substr($salida, 0, $pos);
        }
        $pos = strpos($salida, 'EN REESTRUCTURACION');
        if ($pos) {
            $pos = $pos - 1;
            $salida = substr($salida, 0, $pos);
        }
        $pos = strpos($salida, 'EN REORGANIZACION');
        if ($pos) {
            $pos = $pos - 1;
            $salida = substr($salida, 0, $pos);
        }
        return $salida;
    }

    public static function buscaTarifaSii($dbx, $idservicio = '', $ano = 0, $cantidad = 0, $base = 0, $tipotarifa = 'tarifa') {
        $tarifa = 0;
        $arrServicio = retornarRegistroMysqli2($dbx, 'mreg_servicios', "idservicio='" . $idservicio . "'");
        if (!$arrServicio) {
            return false;
        }
        if ($arrServicio == 0) {
            return false;
        }
        // Liquida por valor &uacute;nico
        if ($arrServicio["idclasevalor"] == '1') {
            $tarifa = $arrServicio["valorservicio"];
        }
        // Liquida por rango de tarifas
        if ($arrServicio["idclasevalor"] == '2') {
            $tarifa = \funcionesSii2::buscarRangoTarifaSii($dbx, $idservicio, $ano, $base, $tipotarifa);
        }
        // Liquida por porcentaje
        if ($arrServicio["idclasevalor"] == '4') {
            $tarifa = intval($arrServicio["valorservicio"] * $base / 100);
        }
        // Liquida por c&aacute;lculo
        if ($arrServicio["idclasevalor"] == '5') {
            $tarifa = intval($arrServicio["valorservicio"] * $base / 100);
        }
        $tarifa = $tarifa * $cantidad;

        // 2015-12-29: JINT : Redondeos
        if (!isset($arrServicio["redondeo"])) {
            return $tarifa;
        }

        if (trim($arrServicio["redondeo"]) == '') {
            return $tarifa;
        }

        switch ($arrServicio["redondeo"]) {

            case "50":
                $ent = intval($tarifa / 50) * 50;
                $res = $tarifa - $ent;
                if ($res <= 25) {
                    $tarifa = $ent;
                } else {
                    $tarifa = $ent + 50;
                }
                break;

            case "100":
                $ent = intval($tarifa / 100) * 100;
                $res = $tarifa - $ent;
                if ($res <= 50) {
                    $tarifa = $ent;
                } else {
                    $tarifa = $ent + 100;
                }
                break;

            case "500":
                $ent = intval($tarifa / 500) * 500;
                $res = $tarifa - $ent;
                if ($res <= 250) {
                    $tarifa = $ent;
                } else {
                    $tarifa = $ent + 500;
                }
                break;

            case "1000":
                $ent = intval($tarifa / 1000) * 1000;
                $res = $tarifa - $ent;
                if ($res <= 500) {
                    $tarifa = $ent;
                } else {
                    $tarifa = $ent + 1000;
                }
                break;

            case "50+":
                if (intval($tarifa) < 50) {
                    $tarifa = 50;
                }
                break;
            case "100+":
                if (intval($tarifa) < 100) {
                    $tarifa = 100;
                }
                break;
            case "500+":
                if (intval($tarifa) < 500) {
                    $tarifa = 500;
                }
                break;
            case "500+":
                if (intval($tarifa) < 1000) {
                    $tarifa = 1000;
                }
                break;
        }
        return $tarifa;
    }

    public static function consultarMultasPoliciaSii($dbx, $tid, $id, $idliq = 0) {

        $nameLog = 'validacionMultasPonal_API_' . date("Ymd");

        //
        $mysqli = conexionMysqli2();

        //
        $reintentar = 3;
        $multadovencido = 'ER';
        $textoerror = '';
        while ($reintentar > 0) {
            $buscartoken = true;
            $buscarmulta = true;
            $name = PATH_ABSOLUTO_SITIO . '/tmp/' . CODIGO_EMPRESA . '-tokenponal.txt';
            if (file_exists($name)) {
                $x = file_get_contents(PATH_ABSOLUTO_SITIO . '/tmp/' . CODIGO_EMPRESA . '-tokenponal.txt');
                list ($token, $expira) = explode("|", $x);
                $act = date("Y-m-d H:i:s");
                if ($act <= $expira) {
                    $buscartoken = false;
                }
            }

            if ($buscartoken) {
                $ch = curl_init();
                curl_setopt($ch, CURLOPT_URL, 'https://catalogoservicioweb.policia.gov.co/sw/token');
                curl_setopt($ch, CURLOPT_POST, true);
                curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-Type: application/x-www-form-urlencoded'));
                curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
                curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
                curl_setopt($ch, CURLOPT_POSTFIELDS, "username=fvera@confecamaras.org.co&password=fveraPolicia2017*2018&grant_type=password");
                curl_setopt($ch, CURLOPT_TIMEOUT, 10);
                $result = curl_exec($ch);
                curl_close($ch);
                if ((is_string($result) &&
                        (is_object(json_decode($result)) ||
                        is_array(json_decode($result))))) {
                    $resultado = json_decode($result, true);
                    $access_token = $resultado['access_token'];
                    $fecha = date('Y-m-d H:i:s', (strtotime("+20 Hours")));
                    $f = fopen($name, "w");
                    fwrite($f, $access_token . '|' . $fecha);
                    fclose($f);
                } else {
                    $textoerror = 'NO FUE POSIBLE SOLICITAR EL TOKEN (1), LA RESPUESTA DEL SERVICIUO WEB DE TOKEN ES INCORRECTA';
                    \logSii2::general2($nameLog, $tid . '-' . $id, $textoerror . ' : ' . $result);
                    $buscarmulta = false;
                    $reintentar--;
                }
            }

            //
            if ($buscarmulta) {
                if (file_exists($name)) {
                    $x = file_get_contents(PATH_ABSOLUTO_SITIO . '/tmp/' . CODIGO_EMPRESA . '-tokenponal.txt');
                    list ($access_token, $expira) = explode("|", $x);
                } else {
                    $textoerror = 'NO FUE POSIBLE SOLICITAR EL TOKEN (2), NO EXISTE ARCHIVO CON EL TOKEN ALMACENADO';
                    $buscarmulta = false;
                    $reintentar--;
                }
            }

            //
            if ($buscarmulta) {
                $data = array(
                    'codigoCamara' => CODIGO_EMPRESA,
                    'tipoConsulta' => 'CC',
                    'numeroIdentificacion' => $id
                );

                //            
                $fields = json_encode($data);
                $ch = curl_init();
                curl_setopt($ch, CURLOPT_URL, 'https://catalogoservicioweb.policia.gov.co/sw/api/Multa/ConsultaMultaVencidaSeisMeses');
                curl_setopt($ch, CURLOPT_POST, true);
                curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-Type: application/json', 'Authorization: Bearer ' . $access_token));
                curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
                curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
                curl_setopt($ch, CURLOPT_POSTFIELDS, $fields);
                curl_setopt($ch, CURLOPT_TIMEOUT, 10);
                $result = curl_exec($ch);
                curl_close($ch);

                //
                \logSii2::general2($nameLog, $tid . '-' . $id, $result);

                //
                if (!is_dir(PATH_ABSOLUTO_IMAGES . "/" . $_SESSION["generales"]["codigoempresa"])) {
                    mkdir(PATH_ABSOLUTO_IMAGES . "/" . $_SESSION["generales"]["codigoempresa"], 0777);
                    crearIndex(PATH_ABSOLUTO_IMAGES . "/" . $_SESSION["generales"]["codigoempresa"]);
                }
                if (!is_dir(PATH_ABSOLUTO_IMAGES . "/" . $_SESSION["generales"]["codigoempresa"] . "/mreg/")) {
                    mkdir(PATH_ABSOLUTO_IMAGES . "/" . $_SESSION["generales"]["codigoempresa"] . "/mreg/", 0777);
                    crearIndex(PATH_ABSOLUTO_IMAGES . "/" . $_SESSION["generales"]["codigoempresa"] . "/mreg/");
                }
                if (!is_dir(PATH_ABSOLUTO_IMAGES . "/" . $_SESSION["generales"]["codigoempresa"] . "/mreg/ponal/")) {
                    mkdir(PATH_ABSOLUTO_IMAGES . "/" . $_SESSION["generales"]["codigoempresa"] . "/mreg/ponal/", 0777);
                    crearIndex(PATH_ABSOLUTO_IMAGES . "/" . $_SESSION["generales"]["codigoempresa"] . "/mreg/ponal/");
                }

                //
                if (trim($result) == '') {
                    $result = "El servicio web PONAL-MULTAS no retorno respuesta";
                }
                $name1 = PATH_ABSOLUTO_SITIO . '/' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/mreg/ponal/validaciones-' . date("Ym") . '.log';
                $f1 = fopen($name1, "a");
                fwrite($f1, date("Y-m-d") . '|' . date("His") . '|' . $tid . '|' . $id . '|' . $result . chr(13) . chr(10));
                fclose($f1);

                //
                if ((is_string($result) &&
                        (is_object(json_decode($result)) ||
                        is_array(json_decode($result))))) {
                    $resultado = json_decode($result, true);
                    if (isset($resultado["Message"])) {
                        if ($resultado["Message"] == 'Authorization has been denied for this request.') {
                            unlink($name);
                            $reintentar--;
                        } else {
                            $reintentar = 0;
                        }
                    } else {
                        $multadovencido = 'NO';
                        $fecx = date("Ymd");
                        $horx = date("His");
                        foreach ($resultado as $multa) {
                            $arrCampos = array(
                                'fecha',
                                'hora',
                                'tipoidentificacion',
                                'identificacion',
                                'nombres',
                                'apellidos',
                                'nit',
                                'razonsocial',
                                'estado',
                                'fechaimposicion',
                                'multavencida',
                                'direccionhechos',
                                'codigomunicipio',
                                'nombremunicipio',
                                'codigodpto',
                                'nombredpto',
                                'codigobarrio',
                                'nombrebarrio',
                                'numeralinfringido',
                                'articuloinfringido',
                                'idliquidacion'
                            );
                            $arrValores = array(
                                "'" . $fecx . "'",
                                "'" . $horx . "'",
                                "'" . $tid . "'",
                                "'" . $id . "'",
                                "'" . addslashes($multa["NOMBRES"]) . "'",
                                "'" . addslashes($multa["APELLIDOS"]) . "'",
                                "'" . $multa["NIT"] . "'",
                                "'" . addslashes($multa["RAZON_SOCIAL"]) . "'",
                                "'" . $multa["ESTADO"] . "'",
                                "'" . $multa["FECHA_IMPOSICION"] . "'",
                                "'" . $multa["MULTA_VENCIDA"] . "'",
                                "'" . addslashes($multa["DIRECCION_HECHOS"]) . "'",
                                "'" . $multa["COD_MUNICIPIO"] . "'",
                                "'" . addslashes($multa["MUNICIPIO"]) . "'",
                                "'" . $multa["COD_DEPARTAMENTO"] . "'",
                                "'" . addslashes($multa["DEPARTAMENTO"]) . "'",
                                "'" . $multa["COD_BARRIO"] . "'",
                                "'" . addslashes($multa["BARRIO"]) . "'",
                                "'" . addslashes($multa["ARTICULO_INFRINGIDO"]) . "'",
                                "'" . addslashes($multa["NUMERAL_INFRINGIDO"]) . "'",
                                $idliq
                            );
                            insertarRegistrosMysqli($mysqli, 'mreg_multas_ponal', $arrCampos, $arrValores);
                            //
                            if ($multa["MULTA_VENCIDA"] == 'SI') {
                                $multadovencido = 'SI';
                            }
                        }
                        $arrCampos = array(
                            'sincronizomultasponal',
                            'fechasincronizomultasponal',
                            'resultadosincronizomultasponal'
                        );
                        $arrValores = array(
                            "'SI'",
                            "'" . date("Ymd") . "'",
                            "'" . $multadovencido . "'"
                        );
                        regrabarRegistrosMysqli($mysqli, 'mreg_est_inscritos', $arrCampos, $arrValores, "idclase='" . $tid . "' and numid='" . $id . "'");
                        $reintentar = 0;
                    }
                } else {
                    $result = str_replace('"', '', $result);
                    if (substr($result, 0, 16) == 'Para la consulta') {
                        $multadovencido = 'NO';
                        $arrCampos = array(
                            'sincronizomultasponal',
                            'fechasincronizomultasponal',
                            'resultadosincronizomultasponal'
                        );
                        $arrValores = array(
                            "'SI'",
                            "'" . date("Ymd") . "'",
                            "'" . $multadovencido . "'"
                        );
                    } else {
                        $multadovencido = 'ER';
                        $arrCampos = array(
                            'sincronizomultasponal',
                            'fechasincronizomultasponal',
                            'resultadosincronizomultasponal'
                        );
                        $arrValores = array(
                            "'SI'",
                            "'" . date("Ymd") . "'",
                            "'" . $multadovencido . "'"
                        );
                    }
                    regrabarRegistrosMysqli($mysqli, 'mreg_est_inscritos', $arrCampos, $arrValores, "idclase='" . $tid . "' and numid='" . $id . "'");
                    $reintentar = 0;
                }
            }
        }

        //
        $mysqli->close();

        return $multadovencido;
    }

    public static function cambiarSustitutoHtml($txt) {
        $txt = str_replace("[0]", " ", $txt);
        $txt = str_replace("[1]", "<", $txt);
        $txt = str_replace("[2]", ">", $txt);
        $txt = str_replace("[3]", "/", $txt);
        $txt = str_replace("[4]", " ", $txt);
        $txt = str_replace("[5]", "\"", $txt);
        $txt = str_replace("[6]", "'", $txt);
        $txt = str_replace("[7]", "&", $txt);
        $txt = str_replace("[8]", "?", $txt);
        $txt = str_replace("[9]", "&aacute;", $txt);
        $txt = str_replace("[10]", "&eacute;", $txt);
        $txt = str_replace("[11]", "&iacute;", $txt);
        $txt = str_replace("[12]", "&oacute;", $txt);
        $txt = str_replace("[13]", "&uacute;", $txt);
        $txt = str_replace("[14]", "&ntilde;", $txt);
        $txt = str_replace("[15]", "&ntilde;", $txt);
        $txt = str_replace("[16]", "+", $txt);
        $txt = str_replace("[17]", "#", $txt);
        $txt = str_replace("[18]", "&aacute;", $txt);
        $txt = str_replace("[19]", "&eacute;", $txt);
        $txt = str_replace("[20]", "&iacute;", $txt);
        $txt = str_replace("[21]", "&oacute;", $txt);
        $txt = str_replace("[22]", "&uacute;", $txt);
        $txt = str_replace("[menorque]", "<", $txt);
        $txt = str_replace("[mayorque]", ">", $txt);
        $txt = str_replace("[slash]", "/", $txt);
        $txt = str_replace("[caracterblanco]", "&nbsp;", $txt);
        $txt = str_replace("[comilladoble]", "\"", $txt);
        $txt = str_replace("[comillasimple]", "'", $txt);
        $txt = str_replace("[ampersand]", "&", $txt);
        $txt = str_replace("[interrogacion]", "?", $txt);
        $txt = str_replace("[atilde]", "&aacute;", $txt);
        $txt = str_replace("[etilde]", "&eacute;", $txt);
        $txt = str_replace("[itilde]", "&iacute;", $txt);
        $txt = str_replace("[otilde]", "&oacute;", $txt);
        $txt = str_replace("[utilde]", "&uacute;", $txt);
        $txt = str_replace("[ene]", "&ntilde;", $txt);
        $txt = str_replace("[ENE]", "&ntilde;", $txt);
        $txt = str_replace("[mas]", "+", $txt);
        return $txt;
    }

    public static function consultarEstablecimientosNacionales($dbx, $tide, $ide) {
        $buscartoken = true;
        $name = PATH_ABSOLUTO_SITIO . '/tmp/' . CODIGO_EMPRESA . '-tokenrues.txt';
        if (file_exists($name)) {
            $x = file_get_contents(PATH_ABSOLUTO_SITIO . '/tmp/' . CODIGO_EMPRESA . '-tokenrues.txt');
            list ($token, $expira) = explode("|", $x);
            $act = date("Y-m-d H:i:s");
            if ($act <= $expira) {
                $buscartoken = false;
            }
        }

        $buscartoken = true;
        if ($buscartoken) {
            $ch = curl_init();
            curl_setopt($ch, CURLOPT_URL, 'https://ruesapi.rues.org.co/Token');
            curl_setopt($ch, CURLOPT_POST, true);
            curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-Type: application/x-www-form-urlencoded'));
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
            curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
            curl_setopt($ch, CURLOPT_POSTFIELDS, "username=SIIUser&password=Webapi2017*&grant_type=password");
            $result = curl_exec($ch);
            curl_close($ch);
            $resultado = json_decode($result, true);
            $access_token = $resultado['access_token'];
            $fecha = date('Y-m-d H:i:s', (strtotime("+20 Hours")));
            $f = fopen($name, "w");
            fwrite($f, $access_token . '|' . $fecha);
            fclose($f);
        }

        //
        if (file_exists($name)) {
            $x = file_get_contents(PATH_ABSOLUTO_SITIO . '/tmp/' . CODIGO_EMPRESA . '-tokenrues.txt');
            list ($access_token, $expira) = explode("|", $x);
        }

        //
        $nameLog = 'api_consultarEstablecimientosNacionales_' . date("Ymd");
        if ($tide != '2') {
            $ide1 = $ide;
            $ide2 = '';
        } else {
            $sep = \funcionesSii2::separarDv($ide);
            $ide1 = $sep["identificacion"];
            $ide2 = $sep["dv"];
        }
        $url = 'https://ruesapi.rues.org.co/api/establecimientos?usuario=' . CODIGO_EMPRESA . '-API' . '&nit=' . $ide1 . '&dv=' . $ide2;
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_POST, true);
        curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-Type: application/x-www-form-urlencoded', 'Authorization: Bearer ' . $access_token));
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
        curl_setopt($ch, CURLOPT_POSTFIELDS, null);
        curl_setopt($ch, CURLOPT_POST, FALSE);
        curl_setopt($ch, CURLOPT_HTTPGET, TRUE);
        $result = curl_exec($ch);
        curl_close($ch);

        \logSii2::general2($nameLog, $tide . '-' . $ide, '****** PETICION : ' . $url . ' *** RESPUESTA : ' . $result);
        \logSii2::general2($nameLog, $tide . '-' . $ide, '');
        //
        if (!\funcionesSii2::isJson($result)) {
            return array();
        }

        //
        $resultado = json_decode($result, true);
        if (isset($resultado["error"]) && $resultado["error"] != null) {
            return array();
        }

        //
        if ($resultado["establecimientos"] == null) {
            return array();
        }

        //
        $xcon = array();
        $salida = array();
        $ix = 0;
        foreach ($resultado["establecimientos"] as $est) {

            $ind = $est["codigo_camara"] . '-' . $est["matricula"];
            if (!isset($xcon[$ind])) {
                $xcon[$ind] = 1;

                $ix++;
                $salida[$ix] = $est;
                $salida[$ix]["ind"] = $ind;
                $salida[$ix]["nombre_municipio_comercial"] = retornarRegistroMysqli2($dbx, "bas_municipios", "codigomunicipio='" . $est["municipio_comercial"] . "'", "ciudad");

                // Homologa organizacion juridica
                $xorg = '';
                switch ($est["codigo_organizacion_juridica"]) {
                    case "01" : $xorg = '01';
                        break;
                    case "02" : $xorg = '02';
                        break;
                    case "03" : $xorg = '03';
                        break;
                    case "04" : $xorg = '04';
                        break;
                    case "05" : $xorg = '05';
                        break;
                    case "06" : $xorg = '06';
                        break;
                    case "07" : $xorg = '07';
                        break;
                    case "08" : $xorg = '08';
                        break;
                    case "09" : $xorg = '09';
                        break;

                    case "10" : $xorg = '11';
                        break;
                    case "11" : $xorg = '17';
                        break;
                    case "12" : $xorg = '99';
                        break;
                    case "13" : $xorg = '15';
                        break;
                    default: $xorg = '12';
                        break;
                }
                $salida[$ix]["codigo_organizacion_juridica"] = $xorg;

                // Homologo categoria
                $xcat = '';
                switch ($est["codigo_categoria_matricula"]) {
                    case "00" : $xcat = '';
                        break;
                    case "01" : $xcat = '1';
                        break;
                    case "02" : $xcat = '2';
                        break;
                    case "03" : $xcat = '3';
                        break;
                    case "04" : $xcat = '';
                        break;
                }
                $salida[$ix]["codigo_categoria_matricula"] = $xcat;

                // Ajusta fecha de renovacion
                if ($salida[$ix]["fecha_renovacion"] == '') {
                    if (isset($salida[$ix]["fecha_matricula"]) && $salida[$ix]["fecha_matricula"] != '') {
                        $salida[$ix]["fecha_renovacion"] = $salida[$ix]["fecha_matricula"];
                    }
                }
            }
        }
        $salida1 = \funcionesSii2::ordenarMatriz($salida, "ind");

        //
        unset($resultado);

        //
        return $salida1;
    }

    public static function consultarSaldoAfiliado($dbx, $matricula) {

        $fcorte = retornarRegistroMysqli2($dbx, 'mreg_cortes_renovacion', "ano='" . date("Y") . "'", "corte");

        //
        $formaCalculoAfiliacion = retornarClaveValorSii2($dbx, '90.01.60');

        $salida = array(
            'valorultpagoafi' => 0,
            'fechaultpagoafi' => '',
            'pago' => 0,
            'cupo' => 0
        );

        //
        $exp = retornarRegistroMysqli2($dbx, "mreg_est_inscritos", "matricula='" . $matricula . "'");

        //
        $arrSerAfil = retornarRegistrosMysqli2($dbx, "mreg_servicios", "grupoventas='02'", "idservicio");
        $Servicios = "";
        $ServiciosAfiliacion = array();
        foreach ($arrSerAfil as $ServAfil) {
            if ($Servicios != '') {
                $Servicios .= ",";
            }
            $Servicios .= "'" . $ServAfil["idservicio"] . "'";
            $ServiciosAfiliacion[] = $ServAfil["idservicio"];
        }

        //
        $arrFecValAfi = retornarRegistroMysqli2($dbx, 'mreg_est_recibos', "matricula='" . $matricula . "' and servicio in (" . $Servicios . ") and ctranulacion = '0' and (substring(numerorecibo,1,1)='R' or substring(numerorecibo,1,1)='S') order by fecoperacion desc limit 1");
        $salida["valorultpagoafi"] = $arrFecValAfi["valor"];
        $salida["fechaultpagoafi"] = $arrFecValAfi["fecoperacion"];
        unset($arrFecValAfi);

        //
        $detalle = array();
        $iDetalle = 0;
        if ($exp["ultanoren"] == date("Y")) {
            $anox = date("Y");
            $feciniafi = $exp["fecrenovacion"];
        } else {
            if (date("Ymd") <= $fcorte) {
                $anox = date("Y") - 1;
                $feciniafi = (date("Y") - 1) . '0101';
            } else {
                $anox = date("Y");
                $feciniafi = date("Y") . '0101';
            }
        }
        $inix = retornarRegistroMysqli2($dbx, 'mreg_saldos_afiliados_sirp', "ano='" . $anox . "' and matricula='" . $matricula . "'");
        if ($inix && !empty($inix)) {
            $iDetalle++;
            $detalle[$iDetalle] = array(
                'tipo' => 'SaldoInicial-SIRP',
                'fecha' => $anox,
                'recibo' => '',
                'valor' => $inix["cupocargado"],
                'cupo' => $inix["cupocargado"] - $inix["cupoconsumido"]
            );
            $salida["cupo"] = $inix["cupocargado"] - $inix["cupoconsumido"];
        }

        //
        $arrRecs = retornarRegistrosMysqli2($dbx, 'mreg_est_recibos', "(matricula='" . $matricula . "') and ctranulacion = '0' and left(numerorecibo,1) IN ('H','G','R','S') and fecoperacion >= '" . $feciniafi . "'", "fecoperacion");
        if ($arrRecs && !empty($arrRecs)) {
            foreach ($arrRecs as $rx) {
                if (in_array($rx["servicio"], $ServiciosAfiliacion)) {
                    // Si se cambia de año en el pago, se reinicia el histórico e pagos
                    if (substr($rx["fecoperacion"], 0, 4) != substr($feciniafi, 0, 4)) {
                        $iDetalle = 0;
                        $detalle = array();
                        $salida["cupo"] = 0;
                        $salida["pago"] = 0;
                    }

                    //
                    $iDetalle++;
                    $detalle[$iDetalle] = array(
                        'tipo' => 'PagoAfiliación',
                        'fecha' => $rx["fecoperacion"],
                        'recibo' => $rx["numerorecibo"],
                        'valor' => $rx["valor"],
                        'cupo' => 0
                    );
                    $salida["pago"] = $salida["pago"] + $rx["valor"];
                    if ($formaCalculoAfiliacion != '') {
                        if ($formaCalculoAfiliacion == 'RANGO_VAL_AFI') {
                            $arrRan = retornarRegistrosMysqli2($dbx, 'mreg_rangos_cupo_afiliacion', "ano='" . date("Y") . "'", "orden");
                            foreach ($arrRan as $rx1) {
                                if ($rx1["minimo"] <= $salida["pago"] && $rx1["maximo"] >= $salida["pago"]) {
                                    $salida["cupo"] = $rx1["cupo"];
                                }
                            }
                            unset($arrRan);
                            unset($rx1);
                        } else {
                            $salida["cupo"] = round(doubleval($formaCalculoAfiliacion) * $salida["pago"], 0);
                        }
                    }
                    $detalle[$iDetalle]["cupo"] = $salida["cupo"];
                }
                if ($salida["cupo"] > 0) {
                    if ($rx["tipogasto"] == '1') {
                        if ($salida["cupo"] - $rx["valor"] >= 0) {
                            $salida["cupo"] = $salida["cupo"] - $rx["valor"];
                        } else {
                            $salida["cupo"] = 0;
                        }
                        $iDetalle++;
                        $detalle[$iDetalle] = array(
                            'tipo' => 'Consumo',
                            'fecha' => $rx["fecoperacion"],
                            'recibo' => $rx["numerorecibo"],
                            'valor' => $rx["valor"],
                            'cupo' => $salida["cupo"]
                        );
                    }
                    // }
                }
            }
        }

        //
        return $salida;
    }

    public static function consultarSaldoAfiliadoCantidad($mysqli = null, $matricula) {

        $cerrarmysql = 'no';
        if ($mysqli == null) {
            $cerrarmysql = 'si';
            $fuente = '';
            include ($_SESSION ["generales"] ["pathabsoluto"] . '/librerias/funciones/asignaBD.php');
            $mysqli = new mysqli($dbhost, $dbusuario, $dbpassword, $dbname);
        }

        $fcorte = retornarRegistroMysqli2($mysqli, 'mreg_cortes_renovacion', "ano='" . date("Y") . "'", "corte");

        //
        $cupo = 0;

        //
        $exp = retornarRegistroMysqli($mysqli, "mreg_est_inscritos", "matricula='" . $matricula . "'");

        //
        $arrSerAfil = retornarRegistrosMysqli2($mysqli, "mreg_servicios", "grupoventas='02'", "idservicio");
        $Servicios = "";
        $ServiciosAfiliacion = array();
        foreach ($arrSerAfil as $ServAfil) {
            if ($Servicios != '') {
                $Servicios .= ",";
            }
            $Servicios .= "'" . $ServAfil["idservicio"] . "'";
            $ServiciosAfiliacion[] = $ServAfil["idservicio"];
        }

        //
        $arrFecValAfi = retornarRegistroMysqli2($mysqli, 'mreg_est_recibos', "(matricula='" . $matricula . "' or expedienteafectado='" . $matricula . "') and servicio in (" . $Servicios . ") and ctranulacion = '0' and (substring(numerorecibo,1,1)='R' or substring(numerorecibo,1,1)='S') order by fecoperacion desc limit 1");
        $salida["valorultpagoafi"] = $arrFecValAfi["valor"];
        $salida["fechaultpagoafi"] = $arrFecValAfi["fecoperacion"];
        unset($arrFecValAfi);

        //
        $fecpagoafiliacion = '';
        $detalle = array();
        $iDetalle = 0;
        if ($exp["ultanoren"] == date("Y")) {
            $anox = date("Y");
            $feciniafi = $exp["fecrenovacion"];
        } else {
            if (date("Ymd") <= $fcorte) {
                $anox = date("Y") - 1;
                $feciniafi = (date("Y") - 1) . '0101';
            } else {
                $anox = date("Y");
                $feciniafi = date("Y") . '0101';
            }
        }

        //
        $arrRecs = retornarRegistrosMysqli2($mysqli, 'mreg_est_recibos', "(matricula='" . $matricula . "' or expedienteafectado='" . $matricula . "') and ctranulacion = '0' and left(numerorecibo,1) IN ('H','G','R','S') and fecoperacion >= '" . $feciniafi . "'", "fecoperacion");
        if ($arrRecs && !empty($arrRecs)) {
            foreach ($arrRecs as $rx) {
                if (in_array($rx["servicio"], $ServiciosAfiliacion)) {
                    // Si se cambia de año en el pago, se reinicia el histórico e pagos
                    if (substr($rx["fecoperacion"], 0, 4) != substr($feciniafi, 0, 4)) {
                        $iDetalle = 0;
                        $detalle = array();
                        $fecpagoafiliacion = '';
                    } else {
                        if ($fecpagoafiliacion == '') {
                            $fecpagoafiliacion = $rx["fecoperacion"];
                        }
                    }

                    //
                    $iDetalle++;
                    $detalle[$iDetalle] = array(
                        'tipo' => 'PagoAfiliación',
                        'fecha' => $rx["fecoperacion"],
                        'recibo' => $rx["numerorecibo"],
                        'valor' => $rx["valor"],
                        'cantidad' => CANTIDAD_CERTIFICADOS_CUPO_AFILIADO,
                        'cupo' => CANTIDAD_CERTIFICADOS_CUPO_AFILIADO
                    );
                    $cupo = CANTIDAD_CERTIFICADOS_CUPO_AFILIADO;
                }
            }
            foreach ($arrRecs as $rx) {
                if (!in_array($rx["servicio"], $ServiciosAfiliacion)) {
                    if ($cupo > 0) {
                        if ($rx["tipogasto"] == '1') {
                            if ($rx["fecoperacion"] >= $fecpagoafiliacion) {
                                if ($cupo - $rx["cantidad"] >= 0) {
                                    $cupo = $cupo - $rx["cantidad"];
                                } else {
                                    $cupo = 0;
                                }
                                $iDetalle++;
                                $detalle[$iDetalle] = array(
                                    'tipo' => 'Consumo',
                                    'fecha' => $rx["fecoperacion"],
                                    'recibo' => $rx["numerorecibo"],
                                    'valor' => $rx["valor"],
                                    'cantidad' => $rx["cantidad"],
                                    'cupo' => $cupo
                                );
                            }
                        }
                    }
                }
            }
        }

        //
        if ($cerrarmysql == 'si') {
            $mysqli->close();
        }

        //
        return $detalle;
    }

    public static function crearIndex($dir) {

        if (!file_exists($dir . '/index.html')) {
            $f = fopen($dir . '/index.html', "w");
            $txt = '	
		<!DOCTYPE HTML>
		<html>
		<head>
		<title>Directorio protegido</title>
		<meta name="keywords" content="" />
		<meta name="description" content="" />
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="language" content="es" />
		<meta http-equiv="cache-control" content="no-cache">
		</head>
		<body>
			<center>
				<h1>Este directorio no puede ser consultado en forma directa, se encuentra protegido</h1>
			</center>
		</body>
	</html>';
            fwrite($f, $txt);
            fclose($f);
        }
        return true;
    }

    public static function desserializarExpedienteMatricula($dbx, $xml) {

        $retorno = array();
        $retorno["cc"] = '';
        $retorno["matricula"] = '';
        $retorno["proponente"] = '';
        $retorno["nombre"] = '';
        $retorno["nuevonombre"] = '';
        $retorno["ape1"] = '';
        $retorno["ape2"] = '';
        $retorno["nom1"] = '';
        $retorno["nom2"] = '';
        $retorno["sigla"] = '';
        $retorno["complementorazonsocial"] = '';
        $retorno["tipoidentificacion"] = '';
        $retorno["identificacion"] = '';
        $retorno["ideext"] = '';
        $retorno["idmunidoc"] = '';
        $retorno["fechanacimiento"] = '';
        $retorno["fecexpdoc"] = '';
        $retorno["paisexpdoc"] = '';
        $retorno["nit"] = '';
        $retorno["estadonit"] = '';
        $retorno["admondian"] = '';
        $retorno["prerut"] = '';
        $retorno["nacionalidad"] = '';

        // 2017-05-31
        $retorno["idetripaiori"] = ''; // Nuevo campo circular 002
        $retorno["paiori"] = ''; // Nuevo campo circular 002
        $retorno["idetriextep"] = ''; // Nuevo campo circular 002
        //

        $retorno["nrocontrolreactivacion"] = '';
        $retorno["fechamatricula"] = '';
        $retorno["fecharenovacion"] = '';
        $retorno["fechaconstitucion"] = '';
        $retorno["fechavencimiento"] = '';
        $retorno["fechacancelacion"] = '';
        $retorno["motivocancelacion"] = ''; // Nuevo campo circular 002    
        $retorno["fechadisolucion"] = '';
        $retorno["fechaliquidacion"] = '';
        $retorno["ultanoren"] = '';
        $retorno["estadomatricula"] = '';
        $retorno["estadoactiva"] = '';
        $retorno["estadopreoperativa"] = '';
        $retorno["estadoconcordato"] = '';
        $retorno["estadointervenida"] = '';
        $retorno["estadodisuelta"] = '';
        $retorno["estadoreestructuracion"] = '';
        $retorno["estadodatosmatricula"] = '';
        $retorno["certificardesde"] = '';
        $retorno["estadotipoliquidacion"] = ''; // Nuevo campo circular 002 
        $retorno["estadoproponente"] = '';
        $retorno["estadocapturado"] = '';
        $retorno["estadocapturadootros"] = '';
        $retorno["cantest"] = 0;
        $retorno["empresafamiliar"] = ''; // Nuevo campo circular 002  
        $retorno["procesosinnovacion"] = ''; // Nuevo campo circular 002  

        $retorno["ctrubi"] = "";
        $retorno["ctrfun"] = "";
        $retorno["art4"] = "";
        $retorno["art7"] = "";
        $retorno["art50"] = "";
        $retorno["benley1780"] = "";
        $retorno["ctrcancelacion1429"] = "";
        $retorno["cumplerequisitos1780"] = "";
        $retorno["renunciabeneficios1780"] = "";
        $retorno["cumplerequisitos1780primren"] = "";
        $retorno["ctrdepuracion1727"] = "";
        $retorno["ctrfechadepuracion1727"] = "";
        $retorno["ctrben658"] = "";

        $retorno["codigosbarras"] = '';
        $retorno["embargos"] = '';
        $retorno["embargostramite"] = '';
        $retorno["recursostramite"] = '';
        $retorno["tamanoempresa"] = '';
        $retorno["emprendedor28"] = '';
        $retorno["pemprendedor28"] = 0;
        $retorno["organizacion"] = '';
        $retorno["organizaciontexto"] = '';
        $retorno["categoria"] = '';
        $retorno["categoriatexto"] = '';
        $retorno["naturaleza"] = '';
        $retorno["imppredil"] = '';
        $retorno["impexp"] = '';
        $retorno["tipopropiedad"] = '';
        $retorno["tipolocal"] = '';
        $retorno["tipogruemp"] = ''; // Nuevo campo circular 002  
        $retorno["nombregruemp"] = ''; // Nuevo campo circular 002  
        $retorno["ctrbic"] = '';

        //
        // Informacion de ESADL
        $retorno["vigcontrol"] = '';
        $retorno["fecperj"] = '';
        $retorno["idorigenperj"] = '';
        $retorno["numperj"] = '';
        $retorno["vigifecini"] = '';
        $retorno["vigifecfin"] = '';
        $retorno["clasegenesadl"] = '';
        $retorno["claseespesadl"] = '';
        $retorno["claseeconsoli"] = '';
        $retorno["ctrcodcoop"] = '';
        $retorno["ctrcodotras"] = '';
        $retorno["ctrderpub"] = ''; // Nuevo campo circular 002  
        $retorno["econmixta"] = '';


        $retorno["ctresacntasociados"] = ''; // Nuevo campo circular 002  
        $retorno["ctresacntmujeres"] = ''; // Nuevo campo circular 002  
        $retorno["ctresacnthombres"] = ''; // Nuevo campo circular 002  
        $retorno["ctresapertgremio"] = ''; // Nuevo campo circular 002  
        $retorno["ctresagremio"] = ''; // Nuevo campo circular 002  
        $retorno["ctresaacredita"] = ''; // Nuevo campo circular 002  
        $retorno["ctresaivc"] = ''; // Nuevo campo circular 002
        $retorno["ctresainfoivc"] = ''; // Nuevo campo circular 002
        $retorno["ctresaautregistro"] = ''; // Nuevo campo circular 002  
        $retorno["ctresaentautoriza"] = ''; // Nuevo campo circular 002  
        $retorno["ctresacodnat"] = ''; // Nuevo campo circular 002     
        $retorno["ctresadiscap"] = ''; // Nuevo campo circular 002     
        $retorno["ctresaetnia"] = ''; // Nuevo campo circular 002     
        $retorno["ctresacualetnia"] = ''; // Nuevo campo circular 002     
        $retorno["ctresadespvictreins"] = ''; // Nuevo campo circular 002     
        $retorno["ctresacualdespvictreins"] = ''; // Nuevo campo circular 002     
        $retorno["ctresaindgest"] = ''; // Nuevo campo circular 002     
        $retorno["ctresalgbti"] = ''; // Nuevo campo circular 002   
        // Datos de afiliacion
        $retorno["afiliado"] = '';
        $retorno["fechaafiliacion"] = '';
        $retorno["ultanorenafi"] = '';
        $retorno["fechaultpagoafi"] = '';
        $retorno["valorultpagoafi"] = '';
        $retorno["saldoafiliado"] = 0;
        $retorno["telaflia"] = '';
        $retorno["diraflia"] = '';
        $retorno["munaflia"] = '';
        $retorno["profaflia"] = '';
        $retorno["contaflia"] = '';
        $retorno["dircontaflia"] = '';
        $retorno["muncontaflia"] = '';
        $retorno["numactaaflia"] = '';
        $retorno["fecactaaflia"] = '';
        $retorno["numactaafliacan"] = '';
        $retorno["fecactaafliacan"] = '';
        $retorno["fecexafiliacion"] = '';
        $retorno["periodicoafiliados"] = array();

        // informacion de ubicacion comercial en el registro mercantil
        $retorno["lggr"] = '';
        $retorno["nombrecomercial"] = '';
        $retorno["dircom"] = '';
        $retorno["dircom_tipovia"] = '';
        $retorno["dircom_numvia"] = '';
        $retorno["dircom_apevia"] = '';
        $retorno["dircom_orivia"] = '';
        $retorno["dircom_numcruce"] = '';
        $retorno["dircom_apecruce"] = '';
        $retorno["dircom_oricruce"] = '';
        $retorno["dircom_numplaca"] = '';
        $retorno["dircom_complemento"] = '';
        $retorno["latitud"] = '';
        $retorno["longitud"] = '';
        $retorno["barriocom"] = '';
        $retorno["barriocomnombre"] = '';
        $retorno["muncom"] = '';
        $retorno["muncomnombre"] = '';
        $retorno["paicom"] = '';
        $retorno["telcom1"] = '';
        $retorno["telcom2"] = '';
        $retorno["celcom"] = '';
        $retorno["telcomant1"] = '';
        $retorno["telcomant2"] = '';
        $retorno["telcomant3"] = '';
        $retorno["faxcom"] = '';
        $retorno["aacom"] = '';
        $retorno["zonapostalcom"] = '';
        $retorno["codigopostalcom"] = ''; // Nuevo campo circular 002
        $retorno["codigozonacom"] = ''; // Nuevo campo circular 002 (R/U)
        $retorno["emailcom"] = '';
        $retorno["emailcom2"] = '';
        $retorno["emailcom3"] = '';
        $retorno["emailcomant"] = '';
        $retorno["nombresegundocontacto"] = '';
        $retorno["cargosegundocontacto"] = '';
        $retorno["urlcom"] = '';
        $retorno["ctrmen"] = "";
        //
        // informacion de ubicaci&oacute;n de notificacion
        $retorno["dirnot"] = '';
        $retorno["dirnot_tipovia"] = '';
        $retorno["dirnot_numvia"] = '';
        $retorno["dirnot_apevia"] = '';
        $retorno["dirnot_orivia"] = '';
        $retorno["dirnot_numcruce"] = '';
        $retorno["dirnot_apecruce"] = '';
        $retorno["dirnot_oricruce"] = '';
        $retorno["dirnot_numplaca"] = '';
        $retorno["dirnot_complemento"] = '';
        $retorno["barrionot"] = '';
        $retorno["barrionotnombre"] = '';
        $retorno["munnot"] = '';
        $retorno["painot"] = '';
        $retorno["munnotnombre"] = '';
        $retorno["telnot"] = '';
        $retorno["telnot2"] = '';
        $retorno["celnot"] = "";
        $retorno["telnotant1"] = '';
        $retorno["telnotant2"] = '';
        $retorno["telnotant3"] = '';
        $retorno["faxnot"] = '';
        $retorno["aanot"] = '';
        $retorno["zonapostalnot"] = '';
        $retorno["emailnot"] = '';
        $retorno["emailnotant"] = '';
        $retorno["urlnot"] = '';
        $retorno["numpredial"] = "";
        $retorno["latitudgrados"] = "";
        $retorno["latitudminutos"] = "";
        $retorno["latitudsegundos"] = "";
        $retorno["latitudorientacion"] = "";
        $retorno["longitudgrados"] = "";
        $retorno["longitudminutos"] = "";
        $retorno["longitudsegundos"] = "";
        $retorno["longitudorientacion"] = "";
        $retorno["ctrmennot"] = "";
        $retorno["codigopostalnot"] = ''; // Nuevo campo circular 002
        $retorno["codigozonanot"] = ''; // Nuevo campo circular 002 (R/U)
        $retorno["tiposedeadm"] = ''; // Nuevo campo circular 002
        //
        // Datos de correspondencia
        $retorno["dircor"] = '';
        $retorno["telcor"] = '';
        $retorno["telcor2"] = '';
        $retorno["muncor"] = '';

        // informacion ed actividad economica
        $retorno["ciius"] = array();
        $retorno["ciius"][1] = '';
        $retorno["ciius"][2] = '';
        $retorno["ciius"][3] = '';
        $retorno["ciius"][4] = '';
        $retorno["ciius"][5] = '';
        $retorno["shd"] = array();
        $retorno["shd"][1] = '';
        $retorno["shd"][2] = '';
        $retorno["shd"][3] = '';
        $retorno["shd"][4] = '';
        $retorno["shd"][5] = '';

        $retorno["versionciiu"] = '';
        $retorno["desactiv"] = '';
        $retorno["feciniact1"] = ''; // Nuevo campo circular 002
        $retorno["feciniact2"] = ''; // Nuevo campo circular 002
        $retorno["codaduaneros"] = ''; // Nuevo campo circular 002
        //
        // informacion de porcentajes de capital

        $retorno["anodatoscap"] = '';
        $retorno["fechadatoscap"] = '';


        $retorno["cap_porcnaltot"] = 0;
        $retorno["cap_porcnalpri"] = 0;
        $retorno["cap_porcnalpub"] = 0;
        $retorno["cap_porcexttot"] = 0;
        $retorno["cap_porcextpri"] = 0;
        $retorno["cap_porcextpub"] = 0;

        $retorno["cap_apolab"] = 0;
        $retorno["cap_apolabadi"] = 0;
        $retorno["cap_apoact"] = 0;
        $retorno["cap_apodin"] = 0;
        $retorno["cap_apotra"] = 0;
        $retorno["cap_apotot"] = 0;

        $retorno["capaut"] = 0;
        $retorno["capsus"] = 0;
        $retorno["cappag"] = 0;
        $retorno["capsoc"] = 0;

        // informacion de Establecimientos de comercio asociados
        $retorno["cntestab01"] = 0;
        $retorno["cntestab02"] = 0;
        $retorno["cntestab03"] = 0;
        $retorno["cntestab04"] = 0;
        $retorno["cntestab05"] = 0;
        $retorno["cntestab06"] = 0;
        $retorno["cntestab07"] = 0;
        $retorno["cntestab08"] = 0;
        $retorno["cntestab09"] = 0;
        $retorno["cntestab10"] = 0;
        $retorno["cntestab11"] = 0;

        // informacion de referencias comerciales y bancarias
        $retorno["refcrenom1"] = '';
        $retorno["refcreofi1"] = '';
        $retorno["refcretel1"] = '';
        $retorno["refcrenom2"] = '';
        $retorno["refcreofi2"] = '';
        $retorno["refcretel2"] = '';
        $retorno["refcomnom1"] = '';
        $retorno["refcomdir1"] = '';
        $retorno["refcomtel1"] = '';
        $retorno["refcomnom2"] = '';
        $retorno["refcomdir2"] = '';
        $retorno["refcomtel2"] = '';

        // informacion financiera
        $retorno["anodatos"] = '';
        $retorno["fechadatos"] = '';
        $retorno["gruponiif"] = ''; // Nuevo campo circular 002
        $retorno["niifconciliacion"] = ''; // Nuevo campo circular 002
        $retorno["aportantesegsocial"] = ''; // Nuevo campo circular 002
        $retorno["tipoaportantesegsocial"] = ''; // Nuevo campo circular 002        
        $retorno["personal"] = 0;
        $retorno["personaltemp"] = 0;
        $retorno["actvin"] = 0;
        $retorno["actcte"] = 0;
        $retorno["actnocte"] = 0;
        $retorno["actfij"] = 0;
        $retorno["fijnet"] = 0;
        $retorno["actotr"] = 0;
        $retorno["actval"] = 0;
        $retorno["acttot"] = 0;
        $retorno["actsinaju"] = 0;
        $retorno["invent"] = 0;
        $retorno["pascte"] = 0;
        $retorno["paslar"] = 0;
        $retorno["pastot"] = 0;
        $retorno["pattot"] = 0;
        $retorno["paspat"] = 0;
        $retorno["balsoc"] = 0;
        $retorno["ingope"] = 0;
        $retorno["ingnoope"] = 0;
        $retorno["gtoven"] = 0;
        $retorno["gtoadm"] = 0;
        $retorno["gasope"] = 0;
        $retorno["gasnoope"] = 0;
        $retorno["cosven"] = 0;
        $retorno["gasint"] = 0;
        $retorno["gasimp"] = 0;
        $retorno["depamo"] = 0;
        $retorno["utiope"] = 0;
        $retorno["utinet"] = 0;

        $retorno["apolab"] = 0;
        $retorno["apolabadi"] = 0;
        $retorno["apoact"] = 0;
        $retorno["apodin"] = 0;
        $retorno["apotot"] = 0;
        $retorno["apotra"] = 0;
        $retorno["patrimonio"] = 0;

        // informacion de patrimonios esadl
        $retorno["anodatospatrimonio"] = '';
        $retorno["fechadatospatrimonio"] = '';
        $retorno["patrimonioesadl"] = 0;

        //
        $retorno["matriculaanterior"] = "";
        $retorno["fecrenant"] = "";
        $retorno["fecmatant"] = "";
        $retorno["camant"] = "";
        $retorno["munant"] = "";
        $retorno["ultanorenant"] = "";
        $retorno["matant"] = "";
        $retorno["benart7ant"] = "";
        $retorno["benley1780ant"] = "";



        // Campos adicionados en mayo 20 de 2011         
        $retorno["ivcenvio"] = '';
        $retorno["ivcsuelos"] = '';
        $retorno["ivcarea"] = 0;
        $retorno["ivcver"] = '';
        $retorno["ivccretip"] = '';
        $retorno["ivcali"] = '';
        $retorno["ivcqui"] = '';
        $retorno["ivcriesgo"] = '';

        // Representacion legal y administracion
        $retorno["idtipoidentificacionreplegal"] = '';
        $retorno["identificacionreplegal"] = '';
        $retorno["nombrereplegal"] = '';
        $retorno["idtipoidentificacionadministrador"] = '';
        $retorno["identificacionadministrador"] = '';
        $retorno["nombreadministrador"] = '';

        // Propietarios, establecimientos y sucursales y agencias
        $retorno["cpcodcam"] = '';
        $retorno["cpnummat"] = '';
        $retorno["cprazsoc"] = '';
        $retorno["cpnumnit"] = '';
        $retorno["cpdircom"] = '';
        $retorno["cpdirnot"] = '';
        $retorno["cpnumtel"] = '';
        $retorno["cpnumfax"] = '';
        $retorno["cpcodmun"] = '';
        $retorno["cpmunnot"] = '';
        $retorno["cpafili"] = '';
        $retorno["cpsaldo"] = 0;
        $retorno["cpurenafi"] = '';

        // Campos adicionados en junio 23 de 2014
        $retorno["codigoscae"] = array();
        $arrY = retornarRegistrosMysqli2($dbx, 'mreg_anexoscae', "1=1", "codigocae");
        foreach ($arrY as $y) {
            $retorno["codigoscae"][$y["codigocae"]] = '';
        }

        //
        $retorno["informacionadicional"] = array();
        $arrY = retornarRegistrosMysqli2($dbx, 'mreg_campos_adicionales_camara', "1=1", "orden");
        foreach ($arrY as $y) {
            $retorno["informacionadicional"][$y["codigoadicional"]] = '';
        }

        //
        $retorno["bienes"] = array();
        $retorno["replegal"] = array();
        $retorno["vinculos"] = array();
        $retorno["vincuprop"] = array();
        $retorno["propietarios"] = array();
        $retorno["propietariosh"] = array();
        $retorno["establecimientos"] = array();
        $retorno["sucursalesagencias"] = array();
        $retorno["lcodigosbarras"] = array();
        $retorno["camposcae"] = array();
        $retorno["inscripciones"] = array();
        $retorno["nomant"] = array();
        $retorno["capitales"] = array();
        $retorno["patrimoniosesadl"] = array();
        $retorno["hf"] = array();
        $retorno["f"] = array();
        $retorno["crt"] = array();
        $retorno["crtsii"] = array();
        $retorno["ctrembargos"] = array();

        //        
        if (trim($xml) != '') {
            if (\funcionesSii2::isJson($xml)) {
                $retorno = json_decode($xml, true);
                return $retorno;
            }

            $xml = str_replace("[2]amp;", "&", $xml);
            $dom = new DomDocument('1.0', 'utf-8');
            // libxml_use_internal_errors(true);
            $result = $dom->loadXML(xmlEscape($xml));
            if ($result === false) {
                $_SESSION["generales"]["txtemergente"] = 'Error recuperando xml!!! ( ' . addslashes($_SESSION["sirep"]["detalle"]) . ')';
                return 0;
            }
            $iexp = 0;
            $reg1 = $dom->getElementsByTagName("expediente");
            $retorno = array();
            foreach ($reg1 as $reg) {
                $iexp++;
                if ($iexp == 1) {

                    // ***************************************************************************** //
                    // Datos de Identificacon del expediente
                    // ***************************************************************************** //
                    if (isset($reg->getElementsByTagName("cc")->item(0)->textContent)) {
                        $retorno["cc"] = $reg->getElementsByTagName("cc")->item(0)->textContent;
                    } else {
                        $retorno["cc"] = CODIGO_EMPRESA;
                    }
                    $retorno["matricula"] = ltrim($reg->getElementsByTagName("matricula")->item(0)->textContent, "0");
                    $retorno["proponente"] = ltrim($reg->getElementsByTagName("proponente")->item(0)->textContent, "0");
                    $retorno["nombre"] = trim(\funcionesSii2::restaurarEspecialesRazonSocial($reg->getElementsByTagName("nombre")->item(0)->textContent));
                    (isset($reg->getElementsByTagName("nuevonombre")->item(0)->textContent)) ? $retorno["nuevonombre"] = restaurarEspecialesRazonSocial($reg->getElementsByTagName("nuevonombre")->item(0)->textContent) : $retorno["nuevonombre"] = '';
                    $retorno["ape1"] = trim(\funcionesSii2::restaurarEspeciales($reg->getElementsByTagName("ape1")->item(0)->textContent));
                    $retorno["ape2"] = trim(\funcionesSii2::restaurarEspeciales($reg->getElementsByTagName("ape2")->item(0)->textContent));
                    $retorno["nom1"] = trim(\funcionesSii2::restaurarEspeciales($reg->getElementsByTagName("nom1")->item(0)->textContent));
                    $retorno["nom2"] = trim(\funcionesSii2::restaurarEspeciales($reg->getElementsByTagName("nom2")->item(0)->textContent));
                    $retorno["sigla"] = trim(\funcionesSii2::restaurarEspeciales(trim($reg->getElementsByTagName("sigla")->item(0)->textContent)));
                    if (isset($reg->getElementsByTagName("complementorazonsocial")->item(0)->textContent)) {
                        $retorno["complementorazonsocial"] = trim(\funcionesSii2::restaurarEspeciales(trim($reg->getElementsByTagName("complementorazonsocial")->item(0)->textContent)));
                    }
                    $retorno["tipoidentificacion"] = $reg->getElementsByTagName("tipoidentificacion")->item(0)->textContent;
                    $retorno["identificacion"] = ltrim($reg->getElementsByTagName("identificacion")->item(0)->textContent, '0');
                    $retorno["ideext"] = ltrim($reg->getElementsByTagName("ideext")->item(0)->textContent, '0');
                    $retorno["idmunidoc"] = $reg->getElementsByTagName("idmunidoc")->item(0)->textContent;
                    if (isset($reg->getElementsByTagName("fechanacimiento")->item(0)->textContent)) {
                        $retorno["fechanacimiento"] = $reg->getElementsByTagName("fechanacimiento")->item(0)->textContent;
                    }
                    $retorno["fecexpdoc"] = $reg->getElementsByTagName("fecexpdoc")->item(0)->textContent;
                    $retorno["paisexpdoc"] = $reg->getElementsByTagName("paisexpdoc")->item(0)->textContent;
                    $retorno["nit"] = ltrim($reg->getElementsByTagName("nit")->item(0)->textContent, '0');
                    (isset($reg->getElementsByTagName("prerut")->item(0)->textContent)) ? $retorno["prerut"] = ltrim($reg->getElementsByTagName("prerut")->item(0)->textContent, '0') : $retorno["prerut"] = '';
                    $retorno["admondian"] = $reg->getElementsByTagName("admondian")->item(0)->textContent;
                    (isset($reg->getElementsByTagName("estadonit")->item(0)->textContent)) ? $retorno["estadonit"] = trim($reg->getElementsByTagName("estadonit")->item(0)->textContent) : $retorno["estadonit"] = '';
                    $retorno["nacionalidad"] = trim($reg->getElementsByTagName("nacionalidad")->item(0)->textContent);

                    (isset($reg->getElementsByTagName("idetripaiori")->item(0)->textContent)) ? $retorno["idetripaiori"] = trim($reg->getElementsByTagName("idetripaiori")->item(0)->textContent) : $retorno["idetripaiori"] = '';
                    (isset($reg->getElementsByTagName("paiori")->item(0)->textContent)) ? $retorno["paiori"] = trim($reg->getElementsByTagName("paiori")->item(0)->textContent) : $retorno["paiori"] = '';
                    (isset($reg->getElementsByTagName("idetriextep")->item(0)->textContent)) ? $retorno["idetriextep"] = trim($reg->getElementsByTagName("idetriextep")->item(0)->textContent) : $retorno["idetriextep"] = '';

                    (isset($reg->getElementsByTagName("nrocontrolreactivacion")->item(0)->textContent)) ? $retorno["nrocontrolreactivacion"] = ltrim($reg->getElementsByTagName("nrocontrolreactivacion")->item(0)->textContent, '0') : $retorno["nrocontrolreactivacion"] = '';
                    (isset($reg->getElementsByTagName("expedienteinactivo")->item(0)->textContent)) ? $retorno["expedienteinactivo"] = trim($reg->getElementsByTagName("expedienteinactivo")->item(0)->textContent) : $retorno["expedienteinactivo"] = '0';
                    $retorno["fechamatricula"] = $reg->getElementsByTagName("fechamatricula")->item(0)->textContent;
                    $retorno["fecharenovacion"] = $reg->getElementsByTagName("fecharenovacion")->item(0)->textContent;
                    $retorno["ultanoren"] = $reg->getElementsByTagName("ultanoren")->item(0)->textContent;
                    $retorno["estadomatricula"] = $reg->getElementsByTagName("estadomatricula")->item(0)->textContent;
                    (isset($reg->getElementsByTagName("fechaconstitucion")->item(0)->textContent)) ? $retorno["fechaconstitucion"] = $reg->getElementsByTagName("fechaconstitucion")->item(0)->textContent : $retorno["fechaconstitucion"] = '';
                    (isset($reg->getElementsByTagName("fechavencimiento")->item(0)->textContent)) ? $retorno["fechavencimiento"] = $reg->getElementsByTagName("fechavencimiento")->item(0)->textContent : $retorno["fechavencimiento"] = '';
                    (isset($reg->getElementsByTagName("fechacancelacion")->item(0)->textContent)) ? $retorno["fechacancelacion"] = $reg->getElementsByTagName("fechacancelacion")->item(0)->textContent : $retorno["fechacancelacion"] = '';

                    (isset($reg->getElementsByTagName("motivocancelacion")->item(0)->textContent)) ? $retorno["motivocancelacion"] = trim($reg->getElementsByTagName("motivocancelacion")->item(0)->textContent) : $retorno["motivocancelacion"] = '';
                    (isset($reg->getElementsByTagName("estadotipoliquidacion")->item(0)->textContent)) ? $retorno["estadotipoliquidacion"] = trim($reg->getElementsByTagName("estadotipoliquidacion")->item(0)->textContent) : $retorno["estadotipoliquidacion"] = '';

                    (isset($reg->getElementsByTagName("fechadisolucion")->item(0)->textContent)) ? $retorno["fechadisolucion"] = $reg->getElementsByTagName("fechadisolucion")->item(0)->textContent : $retorno["fechadisolucion"] = '';
                    (isset($reg->getElementsByTagName("fechaliquidacion")->item(0)->textContent)) ? $retorno["fechaliquidacion"] = $reg->getElementsByTagName("fechaliquidacion")->item(0)->textContent : $retorno["fechaliquidacion"] = '';

                    (isset($reg->getElementsByTagName("estadoproponente")->item(0)->textContent)) ? $retorno["estadoproponente"] = $reg->getElementsByTagName("estadoproponente")->item(0)->textContent : $retorno["estadoproponente"] = '';
                    (isset($reg->getElementsByTagName("estadodatosmatricula")->item(0)->textContent)) ? $retorno["estadodatosmatricula"] = $reg->getElementsByTagName("ctrcertificardesde")->item(0)->textContent : $retorno["certificardesde"] = '';
                    (isset($reg->getElementsByTagName("ctrcertificardesde")->item(0)->textContent)) ? $retorno["certificardesde"] = $reg->getElementsByTagName("estadodatosmatricula")->item(0)->textContent : $retorno["estadodatosmatricula"] = '';
                    (isset($reg->getElementsByTagName("estadoactiva")->item(0)->textContent)) ? $retorno["estadoactiva"] = $reg->getElementsByTagName("estadoactiva")->item(0)->textContent : $retorno["estadoactiva"] = '';
                    (isset($reg->getElementsByTagName("estadopreoperativa")->item(0)->textContent)) ? $retorno["estadopreoperativa"] = $reg->getElementsByTagName("estadopreoperativa")->item(0)->textContent : $retorno["estadopreoperativa"] = '';
                    (isset($reg->getElementsByTagName("estadoconcordato")->item(0)->textContent)) ? $retorno["estadoconcordato"] = $reg->getElementsByTagName("estadoconcordato")->item(0)->textContent : $retorno["estadoconcordato"] = '';
                    (isset($reg->getElementsByTagName("estadointervenida")->item(0)->textContent)) ? $retorno["estadointervenida"] = $reg->getElementsByTagName("estadointervenida")->item(0)->textContent : $retorno["estadointervenida"] = '';
                    (isset($reg->getElementsByTagName("estadodisuelta")->item(0)->textContent)) ? $retorno["estadodisuelta"] = $reg->getElementsByTagName("estadodisuelta")->item(0)->textContent : $retorno["estadodisuelta"] = '';
                    (isset($reg->getElementsByTagName("estadoreestructuracion")->item(0)->textContent)) ? $retorno["estadoreestructuracion"] = $reg->getElementsByTagName("estadoreestructuracion")->item(0)->textContent : $retorno["estadoreestructuracion"] = '';
                    (isset($reg->getElementsByTagName("estadocapturado")->item(0)->textContent)) ? $retorno["estadocapturado"] = $reg->getElementsByTagName("estadocapturado")->item(0)->textContent : $retorno["estadocapturado"] = '';
                    (isset($reg->getElementsByTagName("estadocapturadootros")->item(0)->textContent)) ? $retorno["estadocapturadootros"] = $reg->getElementsByTagName("estadocapturadootros")->item(0)->textContent : $retorno["estadocapturadootros"] = '';
                    (isset($reg->getElementsByTagName("cantest")->item(0)->textContent)) ? $retorno["cantest"] = intval($reg->getElementsByTagName("cantest")->item(0)->textContent) : $retorno["cantest"] = 0;

                    (isset($reg->getElementsByTagName("tamanoempresa")->item(0)->textContent)) ? $retorno["tamanoempresa"] = $reg->getElementsByTagName("tamanoempresa")->item(0)->textContent : $retorno["tamanoempresa"] = '';
                    (isset($reg->getElementsByTagName("emprendedor28")->item(0)->textContent)) ? $retorno["emprendedor28"] = $reg->getElementsByTagName("emprendedor28")->item(0)->textContent : $retorno["emprendedor28"] = '';
                    (isset($reg->getElementsByTagName("pemprendedor28")->item(0)->textContent)) ? $retorno["pemprendedor28"] = $reg->getElementsByTagName("pemprendedor28")->item(0)->textContent : $retorno["pemprendedor28"] = 0;

                    if (isset($reg->getElementsByTagName("vigcontrol")->item(0)->textContent)) {
                        $retorno["vigcontrol"] = $reg->getElementsByTagName("vigcontrol")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("fecperj")->item(0)->textContent)) {
                        $retorno["fecperj"] = $reg->getElementsByTagName("fecperj")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("idorigenperj")->item(0)->textContent)) {
                        $retorno["idorigenperj"] = $reg->getElementsByTagName("idorigenperj")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("numperj")->item(0)->textContent)) {
                        $retorno["numperj"] = $reg->getElementsByTagName("numperj")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("vigifecini")->item(0)->textContent)) {
                        $retorno["vigifecini"] = $reg->getElementsByTagName("vigifecini")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("vigifecfin")->item(0)->textContent)) {
                        $retorno["vigifecfin"] = $reg->getElementsByTagName("vigifecfin")->item(0)->textContent;
                    }

                    (isset($reg->getElementsByTagName("clasegenesadl")->item(0)->textContent)) ? $retorno["clasegenesadl"] = $reg->getElementsByTagName("clasegenesadl")->item(0)->textContent : $retorno["clasegenesadl"] = '';
                    (isset($reg->getElementsByTagName("claseespesadl")->item(0)->textContent)) ? $retorno["claseespesadl"] = $reg->getElementsByTagName("claseespesadl")->item(0)->textContent : $retorno["claseespesadl"] = '';
                    (isset($reg->getElementsByTagName("claseeconsoli")->item(0)->textContent)) ? $retorno["claseeconsoli"] = $reg->getElementsByTagName("claseeconsoli")->item(0)->textContent : $retorno["claseeconsoli"] = '';

                    (isset($reg->getElementsByTagName("ctrcodcoop")->item(0)->textContent)) ? $retorno["ctrcodcoop"] = $reg->getElementsByTagName("ctrcodcoop")->item(0)->textContent : $retorno["ctrcodcoop"] = '';
                    (isset($reg->getElementsByTagName("ctrcodotras")->item(0)->textContent)) ? $retorno["ctrcodotras"] = $reg->getElementsByTagName("ctrcodotras")->item(0)->textContent : $retorno["ctrcodotras"] = '';
                    (isset($reg->getElementsByTagName("ctrderpub")->item(0)->textContent)) ? $retorno["ctrderpub"] = $reg->getElementsByTagName("ctrderpub")->item(0)->textContent : $retorno["ctrderpub"] = '';
                    (isset($reg->getElementsByTagName("econmixta")->item(0)->textContent)) ? $retorno["econmixta"] = $reg->getElementsByTagName("econmixta")->item(0)->textContent : $retorno["econmixta"] = '';

                    (isset($reg->getElementsByTagName("ctresacntasociados")->item(0)->textContent)) ? $retorno["ctresacntasociados"] = $reg->getElementsByTagName("ctresacntasociados")->item(0)->textContent : $retorno["ctresacntasociados"] = 0;
                    (isset($reg->getElementsByTagName("ctresacntmujeres")->item(0)->textContent)) ? $retorno["ctresacntmujeres"] = $reg->getElementsByTagName("ctresacntmujeres")->item(0)->textContent : $retorno["ctresacntmujeres"] = 0;
                    (isset($reg->getElementsByTagName("ctresacnthombres")->item(0)->textContent)) ? $retorno["ctresacnthombres"] = $reg->getElementsByTagName("ctresacnthombres")->item(0)->textContent : $retorno["ctresacnthombres"] = 0;

                    (isset($reg->getElementsByTagName("ctresapertgremio")->item(0)->textContent)) ? $retorno["ctresapertgremio"] = $reg->getElementsByTagName("ctresapertgremio")->item(0)->textContent : $retorno["ctresapertgremio"] = '';
                    (isset($reg->getElementsByTagName("ctresagremio")->item(0)->textContent)) ? $retorno["ctresagremio"] = $reg->getElementsByTagName("ctresagremio")->item(0)->textContent : $retorno["ctresagremio"] = '';
                    (isset($reg->getElementsByTagName("ctresaacredita")->item(0)->textContent)) ? $retorno["ctresaacredita"] = $reg->getElementsByTagName("ctresaacredita")->item(0)->textContent : $retorno["ctresaacredita"] = '';
                    (isset($reg->getElementsByTagName("ctresaivc")->item(0)->textContent)) ? $retorno["ctresaivc"] = $reg->getElementsByTagName("ctresaivc")->item(0)->textContent : $retorno["ctresaivc"] = '';
                    (isset($reg->getElementsByTagName("ctresainfoivc")->item(0)->textContent)) ? $retorno["ctresainfoivc"] = $reg->getElementsByTagName("ctresainfoivc")->item(0)->textContent : $retorno["ctresainfoivc"] = '';
                    (isset($reg->getElementsByTagName("ctresaautregistro")->item(0)->textContent)) ? $retorno["ctresaautregistro"] = $reg->getElementsByTagName("ctresaautregistro")->item(0)->textContent : $retorno["ctresaautregistro"] = '';
                    (isset($reg->getElementsByTagName("ctresaentautoriza")->item(0)->textContent)) ? $retorno["ctresaentautoriza"] = $reg->getElementsByTagName("ctresaentautoriza")->item(0)->textContent : $retorno["ctresaentautoriza"] = '';
                    (isset($reg->getElementsByTagName("ctresacodnat")->item(0)->textContent)) ? $retorno["ctresacodnat"] = $reg->getElementsByTagName("ctresacodnat")->item(0)->textContent : $retorno["ctresacodnat"] = '';

                    (isset($reg->getElementsByTagName("ctresadiscap")->item(0)->textContent)) ? $retorno["ctresadiscap"] = $reg->getElementsByTagName("ctresadiscap")->item(0)->textContent : $retorno["ctresadiscap"] = '';
                    (isset($reg->getElementsByTagName("ctresaetnia")->item(0)->textContent)) ? $retorno["ctresaetnia"] = $reg->getElementsByTagName("ctresaetnia")->item(0)->textContent : $retorno["ctresaetnia"] = '';
                    (isset($reg->getElementsByTagName("ctresacualetnia")->item(0)->textContent)) ? $retorno["ctresacualetnia"] = $reg->getElementsByTagName("ctresacualetnia")->item(0)->textContent : $retorno["ctresacualetnia"] = '';

                    (isset($reg->getElementsByTagName("ctresadespvictreins")->item(0)->textContent)) ? $retorno["ctresadespvictreins"] = $reg->getElementsByTagName("ctresadespvictreins")->item(0)->textContent : $retorno["ctresadespvictreins"] = '';
                    (isset($reg->getElementsByTagName("ctresacualdespvictreins")->item(0)->textContent)) ? $retorno["ctresacualdespvictreins"] = $reg->getElementsByTagName("ctresacualdespvictreins")->item(0)->textContent : $retorno["ctresacualdespvictreins"] = '';
                    (isset($reg->getElementsByTagName("ctresaindgest")->item(0)->textContent)) ? $retorno["ctresaindgest"] = $reg->getElementsByTagName("ctresaindgest")->item(0)->textContent : $retorno["ctresaindgest"] = '';
                    (isset($reg->getElementsByTagName("ctresalgbti")->item(0)->textContent)) ? $retorno["ctresalgbti"] = $reg->getElementsByTagName("ctresalgbti")->item(0)->textContent : $retorno["ctresalgbti"] = '';

                    //
                    (isset($reg->getElementsByTagName("imppredil")->item(0)->textContent)) ? $retorno["imppredil"] = $reg->getElementsByTagName("imppredil")->item(0)->textContent : $retorno["imppredil"] = 'S';
                    (isset($reg->getElementsByTagName("codigosbarras")->item(0)->textContent)) ? $retorno["codigosbarras"] = ltrim($reg->getElementsByTagName("codigosbarras")->item(0)->textContent, "0") : $retorno["codigosbarras"] = 0;
                    (isset($reg->getElementsByTagName("embargos")->item(0)->textContent)) ? $retorno["embargos"] = trim($reg->getElementsByTagName("embargos")->item(0)->textContent) : $retorno["embargos"] = 0;
                    (isset($reg->getElementsByTagName("embargostramite")->item(0)->textContent)) ? $retorno["embargostramite"] = ltrim($reg->getElementsByTagName("embargostramite")->item(0)->textContent, "0") : $retorno["embargostramite"] = 0;
                    (isset($reg->getElementsByTagName("recursostramite")->item(0)->textContent)) ? $retorno["recursostramite"] = ltrim($reg->getElementsByTagName("recursostramite")->item(0)->textContent, "0") : $retorno["recursostramite"] = 0;

                    $retorno["organizacion"] = $reg->getElementsByTagName("organizacion")->item(0)->textContent;
                    $retorno["organizaciontexto"] = retornarRegistroMysqli2($dbx, 'bas_organizacionjuridica', "id='" . $reg->getElementsByTagName("organizacion")->item(0)->textContent . "'", "descripcion");
                    $retorno["categoria"] = $reg->getElementsByTagName("categoria")->item(0)->textContent;
                    $retorno["categoriatexto"] = retornarRegistroMysqli2($dbx, 'bas_categorias', "id='" . $reg->getElementsByTagName("categoria")->item(0)->textContent . "'", "descripcion");
                    if (isset($reg->getElementsByTagName("naturaleza")->item(0)->textContent)) {
                        $retorno["naturaleza"] = $reg->getElementsByTagName("naturaleza")->item(0)->textContent;
                    } else {
                        $retorno["naturaleza"] = '0';
                    }
                    if ($retorno["organizacion"] == '01') {
                        if (trim($retorno["paisexpdoc"]) == '') {
                            $retorno["paisexpdoc"] = 'CO';
                        }
                        if (trim($retorno["nacionalidad"]) == '') {
                            $retorno["nacionalidad"] = 'COLOMBIANO/A';
                        }
                    }
                    if (($retorno["imppredil"] == '0') || ($retorno["imppredil"] == '1') || ($retorno["imppredil"] == '2') || ($retorno["imppredil"] == '')) {
                        $retorno["imppredil"] = 'S';
                    }

                    $retorno["impexp"] = $reg->getElementsByTagName("impexp")->item(0)->textContent;
                    $retorno["tipopropiedad"] = $reg->getElementsByTagName("tipopropiedad")->item(0)->textContent;
                    $retorno["tipolocal"] = $reg->getElementsByTagName("tipolocal")->item(0)->textContent;

                    // ***************************************************************************** //
                    // Datos de matricula antes del cambio de domicilio
                    // ***************************************************************************** //
                    (isset($reg->getElementsByTagName("fecmatant")->item(0)->textContent)) ? $retorno["fecmatant"] = trim($reg->getElementsByTagName("fecmatant")->item(0)->textContent) : $retorno["fecmatant"] = '';
                    (isset($reg->getElementsByTagName("fecrenant")->item(0)->textContent)) ? $retorno["fecrenant"] = trim($reg->getElementsByTagName("fecrenant")->item(0)->textContent) : $retorno["fecrenant"] = '';
                    (isset($reg->getElementsByTagName("camant")->item(0)->textContent)) ? $retorno["camant"] = trim($reg->getElementsByTagName("camant")->item(0)->textContent) : $retorno["camant"] = '';
                    (isset($reg->getElementsByTagName("munant")->item(0)->textContent)) ? $retorno["munant"] = trim($reg->getElementsByTagName("munant")->item(0)->textContent) : $retorno["munant"] = '';
                    (isset($reg->getElementsByTagName("benart7ant")->item(0)->textContent)) ? $retorno["benart7ant"] = trim($reg->getElementsByTagName("benart7ant")->item(0)->textContent) : $retorno["benart7ant"] = '';
                    (isset($reg->getElementsByTagName("benley1780ant")->item(0)->textContent)) ? $retorno["benley1780ant"] = trim($reg->getElementsByTagName("benley1780ant")->item(0)->textContent) : $retorno["benley1780ant"] = '';
                    (isset($reg->getElementsByTagName("ultanorenant")->item(0)->textContent)) ? $retorno["ultanorenant"] = trim($reg->getElementsByTagName("ultanorenant")->item(0)->textContent) : $retorno["ultanorenant"] = '';
                    (isset($reg->getElementsByTagName("matant")->item(0)->textContent)) ? $retorno["matant"] = trim($reg->getElementsByTagName("matant")->item(0)->textContent) : $retorno["matant"] = '';

                    (isset($reg->getElementsByTagName("tipogruemp")->item(0)->textContent)) ? $retorno["tipogruemp"] = trim($reg->getElementsByTagName("tipogruemp")->item(0)->textContent) : $retorno["tipogruemp"] = '';
                    (isset($reg->getElementsByTagName("nombregruemp")->item(0)->textContent)) ? $retorno["nombregruemp"] = trim($reg->getElementsByTagName("nombregruemp")->item(0)->textContent) : $retorno["nombregruemp"] = '';
                    (isset($reg->getElementsByTagName("empresafamiliar")->item(0)->textContent)) ? $retorno["empresafamiliar"] = trim($reg->getElementsByTagName("empresafamiliar")->item(0)->textContent) : $retorno["empresafamiliar"] = '';
                    (isset($reg->getElementsByTagName("procesosinnovacion")->item(0)->textContent)) ? $retorno["procesosinnovacion"] = trim($reg->getElementsByTagName("procesosinnovacion")->item(0)->textContent) : $retorno["procesosinnovacion"] = '';

                    // ***************************************************************************** //
                    // Informacion de afiliacion
                    // ***************************************************************************** //
                    (isset($reg->getElementsByTagName("afiliado")->item(0)->textContent)) ? $retorno["afiliado"] = $reg->getElementsByTagName("afiliado")->item(0)->textContent : $retorno["afiliado"] = '';
                    (isset($reg->getElementsByTagName("fechaafiliacion")->item(0)->textContent)) ? $retorno["fechaafiliacion"] = $reg->getElementsByTagName("fechaafiliacion")->item(0)->textContent : $retorno["fechaafiliacion"] = '';
                    (isset($reg->getElementsByTagName("ultanorenafi")->item(0)->textContent)) ? $retorno["ultanorenafi"] = $reg->getElementsByTagName("ultanorenafi")->item(0)->textContent : $retorno["ultanorenafi"] = '';
                    (isset($reg->getElementsByTagName("fechaultpagoafi")->item(0)->textContent)) ? $retorno["fechaultpagoafi"] = $reg->getElementsByTagName("fechaultpagoafi")->item(0)->textContent : $retorno["fechaultpagoafi"] = '';
                    (isset($reg->getElementsByTagName("valorultpagoafi")->item(0)->textContent)) ? $retorno["valorultpagoafi"] = $reg->getElementsByTagName("valorultpagoafi")->item(0)->textContent : $retorno["valorultpagoafi"] = 0;
                    (isset($reg->getElementsByTagName("saldoafiliado")->item(0)->textContent)) ? $retorno["saldoafiliado"] = $reg->getElementsByTagName("saldoafiliado")->item(0)->textContent : $retorno["saldoafiliado"] = 0;
                    (isset($reg->getElementsByTagName("telaflia")->item(0)->textContent)) ? $retorno["telaflia"] = $reg->getElementsByTagName("telaflia")->item(0)->textContent : $retorno["telaflia"] = '';
                    (isset($reg->getElementsByTagName("diraflia")->item(0)->textContent)) ? $retorno["diraflia"] = str_replace("#", "Nro.", $reg->getElementsByTagName("diraflia")->item(0)->textContent) : $retorno["diraflia"] = '';
                    (isset($reg->getElementsByTagName("munaflia")->item(0)->textContent)) ? $retorno["munaflia"] = $reg->getElementsByTagName("munaflia")->item(0)->textContent : $retorno["munaflia"] = '';
                    (isset($reg->getElementsByTagName("profaflia")->item(0)->textContent)) ? $retorno["profaflia"] = $reg->getElementsByTagName("profaflia")->item(0)->textContent : $retorno["profaflia"] = '';
                    (isset($reg->getElementsByTagName("contaflia")->item(0)->textContent)) ? $retorno["contaflia"] = $reg->getElementsByTagName("contaflia")->item(0)->textContent : $retorno["contaflia"] = '';
                    (isset($reg->getElementsByTagName("dircontaflia")->item(0)->textContent)) ? $retorno["dircontaflia"] = str_replace("#", "Nro.", $reg->getElementsByTagName("dircontaflia")->item(0)->textContent) : $retorno["dircontaflia"] = '';
                    (isset($reg->getElementsByTagName("muncontaflia")->item(0)->textContent)) ? $retorno["muncontaflia"] = $reg->getElementsByTagName("muncontaflia")->item(0)->textContent : $retorno["muncontaflia"] = '';
                    (isset($reg->getElementsByTagName("numactaaflia")->item(0)->textContent)) ? $retorno["numactaaflia"] = $reg->getElementsByTagName("numactaaflia")->item(0)->textContent : $retorno["numactaaflia"] = '';
                    (isset($reg->getElementsByTagName("fecactaaflia")->item(0)->textContent)) ? $retorno["fecactaaflia"] = $reg->getElementsByTagName("fecactaaflia")->item(0)->textContent : $retorno["fecactaaflia"] = '';
                    (isset($reg->getElementsByTagName("numactaafliacan")->item(0)->textContent)) ? $retorno["numactaafliacan"] = $reg->getElementsByTagName("numactaafliacan")->item(0)->textContent : $retorno["numactaafliacan"] = '';
                    (isset($reg->getElementsByTagName("fecactaafliacan")->item(0)->textContent)) ? $retorno["fecactaafliacan"] = $reg->getElementsByTagName("fecactaafliacan")->item(0)->textContent : $retorno["fecactaafliacan"] = '';
                    (isset($reg->getElementsByTagName("fecexafiliacion")->item(0)->textContent)) ? $retorno["fecexafiliacion"] = $reg->getElementsByTagName("fecexafiliacion")->item(0)->textContent : $retorno["fecexafiliacion"] = '';

                    // ***************************************************************************** //
                    // Pagos de afiliacion
                    // ***************************************************************************** //
                    $iAfil = 0;
                    $retorno["periodicoafiliados"] = array();
                    $reg3 = $reg->getElementsByTagName("pagosafiliado");
                    if (!empty($reg3)) {
                        foreach ($reg3 as $reg4) {
                            $iAfil++;
                            $retorno["periodicoafiliados"][$iAfil]["ano"] = ltrim($reg4->getElementsByTagName("perafiano")->item(0)->textContent, "0");
                            $retorno["periodicoafiliados"][$iAfil]["fecha"] = ltrim($reg4->getElementsByTagName("perafifecha")->item(0)->textContent, "0");
                            $retorno["periodicoafiliados"][$iAfil]["tipo"] = trim($reg4->getElementsByTagName("perafitipo")->item(0)->textContent);
                            $retorno["periodicoafiliados"][$iAfil]["recibo"] = trim($reg4->getElementsByTagName("perafirecibo")->item(0)->textContent);
                            if (!isset($reg4->getElementsByTagName("perafiopera")->item(0)->textContent)) {
                                $retorno["periodicoafiliados"][$iAfil]["operacion"] = '';
                            } else {
                                $retorno["periodicoafiliados"][$iAfil]["operacion"] = trim($reg4->getElementsByTagName("perafiopera")->item(0)->textContent);
                            }
                            $retorno["periodicoafiliados"][$iAfil]["valor"] = ltrim($reg4->getElementsByTagName("perafivalor")->item(0)->textContent, "0");
                        }
                    }

                    // ***************************************************************************** //
                    // informacion de ubicacion comercial en el registro mercantil
                    // ***************************************************************************** //
                    $retorno["lggr"] = $reg->getElementsByTagName("lggr")->item(0)->textContent;
                    $retorno["nombrecomercial"] = \funcionesSii2::restaurarEspeciales($reg->getElementsByTagName("nombrecomercial")->item(0)->textContent);
                    $retorno["dircom"] = \funcionesSii2::restaurarEspeciales(str_replace("#", "Nro.", $reg->getElementsByTagName("dircom")->item(0)->textContent));
                    $retorno["dircom_tipovia"] = $reg->getElementsByTagName("dircom_tipovia")->item(0)->textContent;
                    $retorno["dircom_numvia"] = $reg->getElementsByTagName("dircom_numvia")->item(0)->textContent;
                    $retorno["dircom_apevia"] = $reg->getElementsByTagName("dircom_apevia")->item(0)->textContent;
                    $retorno["dircom_orivia"] = $reg->getElementsByTagName("dircom_orivia")->item(0)->textContent;
                    $retorno["dircom_numcruce"] = $reg->getElementsByTagName("dircom_numcruce")->item(0)->textContent;
                    $retorno["dircom_apecruce"] = $reg->getElementsByTagName("dircom_apecruce")->item(0)->textContent;
                    $retorno["dircom_oricruce"] = $reg->getElementsByTagName("dircom_oricruce")->item(0)->textContent;
                    $retorno["dircom_numplaca"] = $reg->getElementsByTagName("dircom_numplaca")->item(0)->textContent;
                    $retorno["dircom_complemento"] = (\funcionesSii2::restaurarEspeciales($reg->getElementsByTagName("dircom_complemento")->item(0)->textContent));
                    $retorno["muncom"] = $reg->getElementsByTagName("muncom")->item(0)->textContent;
                    $retorno["muncomnombre"] = retornarRegistroMysqli2($dbx, 'bas_municipios', "codigomunicipio='" . $reg->getElementsByTagName("muncom")->item(0)->textContent . "'", "ciudad");
                    (isset($reg->getElementsByTagName("paicom")->item(0)->textContent)) ? $retorno["paicom"] = $reg->getElementsByTagName("paicom")->item(0)->textContent : $retorno["paicom"] = '';
                    (isset($reg->getElementsByTagName("codigopostalcom")->item(0)->textContent)) ? $retorno["codigopostalcom"] = $reg->getElementsByTagName("codigopostalcom")->item(0)->textContent : $retorno["codigopostalcom"] = '';
                    (isset($reg->getElementsByTagName("codigozonacom")->item(0)->textContent)) ? $retorno["codigozonacom"] = $reg->getElementsByTagName("codigozonacom")->item(0)->textContent : $retorno["codigozonacom"] = '';
                    $retorno["telcom1"] = $reg->getElementsByTagName("telcom1")->item(0)->textContent;
                    $retorno["telcom2"] = $reg->getElementsByTagName("telcom2")->item(0)->textContent;
                    $retorno["faxcom"] = $reg->getElementsByTagName("faxcom")->item(0)->textContent;
                    if (isset($reg->getElementsByTagName("celcom")->item(0)->textContent)) {
                        $retorno["celcom"] = $reg->getElementsByTagName("celcom")->item(0)->textContent;
                    } else {
                        $retorno["celcom"] = '';
                    }
                    $retorno["aacom"] = $reg->getElementsByTagName("aacom")->item(0)->textContent;
                    $retorno["zonapostalcom"] = $reg->getElementsByTagName("zonapostalcom")->item(0)->textContent;
                    if (!isset($reg->getElementsByTagName("barriocom")->item(0)->textContent)) {
                        $retorno["barriocom"] = "";
                        $retorno["barriocomnombre"] = "";
                    } else {
                        $retorno["barriocom"] = $reg->getElementsByTagName("barriocom")->item(0)->textContent;
                        $retorno["barriocomnombre"] = retornarRegistroMysqli2($dbx, "mreg_barriosmuni", "idmunicipio='" . $retorno["muncom"] . "' and idbarrio='" . $retorno["barriocom"] . "'", "nombre");
                    }
                    if (!isset($reg->getElementsByTagName("numpredial")->item(0)->textContent)) {
                        $retorno["numpredial"] = "";
                    } else {
                        $retorno["numpredial"] = $reg->getElementsByTagName("numpredial")->item(0)->textContent;
                    }

                    $retorno["emailcom"] = (\funcionesSii2::restaurarEspeciales($reg->getElementsByTagName("emailcom")->item(0)->textContent));
                    if (!isset($reg->getElementsByTagName("emailcom2")->item(0)->textContent)) {
                        $retorno["emailcom2"] = '';
                    } else {
                        $retorno["emailcom2"] = (\funcionesSii2::restaurarEspeciales($reg->getElementsByTagName("emailcom2")->item(0)->textContent));
                    }
                    if (!isset($reg->getElementsByTagName("emailcom3")->item(0)->textContent)) {
                        $retorno["emailcom3"] = '';
                    } else {
                        $retorno["emailcom3"] = (\funcionesSii2::restaurarEspeciales($reg->getElementsByTagName("emailcom3")->item(0)->textContent));
                    }
                    if (!isset($reg->getElementsByTagName("nombresegundocontacto")->item(0)->textContent)) {
                        $retorno["nombresegundocontacto"] = '';
                    } else {
                        $retorno["nombresegundocontacto"] = (\funcionesSii2::restaurarEspeciales($reg->getElementsByTagName("nombresegundocontacto")->item(0)->textContent));
                    }
                    if (!isset($reg->getElementsByTagName("cargosegundocontacto")->item(0)->textContent)) {
                        $retorno["cargosegundocontacto"] = '';
                    } else {
                        $retorno["cargosegundocontacto"] = (\funcionesSii2::restaurarEspeciales($reg->getElementsByTagName("cargosegundocontacto")->item(0)->textContent));
                    }

                    $retorno["urlcom"] = (\funcionesSii2::restaurarEspeciales($reg->getElementsByTagName("urlcom")->item(0)->textContent));

                    // ***************************************************************************** //
                    // informacion de ubicacion de notificacion
                    // ***************************************************************************** //
                    $retorno["dirnot"] = (\funcionesSii2::restaurarEspeciales(str_replace("#", "Nro.", $reg->getElementsByTagName("dirnot")->item(0)->textContent)));
                    $retorno["dirnot_tipovia"] = $reg->getElementsByTagName("dirnot_tipovia")->item(0)->textContent;
                    $retorno["dirnot_numvia"] = $reg->getElementsByTagName("dirnot_numvia")->item(0)->textContent;
                    $retorno["dirnot_apevia"] = $reg->getElementsByTagName("dirnot_apevia")->item(0)->textContent;
                    $retorno["dirnot_orivia"] = $reg->getElementsByTagName("dirnot_orivia")->item(0)->textContent;
                    $retorno["dirnot_numcruce"] = $reg->getElementsByTagName("dirnot_numcruce")->item(0)->textContent;
                    $retorno["dirnot_apecruce"] = $reg->getElementsByTagName("dirnot_apecruce")->item(0)->textContent;
                    $retorno["dirnot_oricruce"] = $reg->getElementsByTagName("dirnot_oricruce")->item(0)->textContent;
                    $retorno["dirnot_numplaca"] = $reg->getElementsByTagName("dirnot_numplaca")->item(0)->textContent;
                    $retorno["dirnot_complemento"] = (\funcionesSii2::restaurarEspeciales($reg->getElementsByTagName("dirnot_complemento")->item(0)->textContent));
                    $retorno["munnot"] = $reg->getElementsByTagName("munnot")->item(0)->textContent;
                    $retorno["munnotnombre"] = retornarRegistroMysqli2($dbx, "bas_municipios", "codigomunicipio='" . $reg->getElementsByTagName("munnot")->item(0)->textContent . "'", "ciudad");
                    (isset($reg->getElementsByTagName("painot")->item(0)->textContent)) ? $retorno["painot"] = $reg->getElementsByTagName("painot")->item(0)->textContent : $retorno["painot"] = '';
                    (isset($reg->getElementsByTagName("codigopostalnot")->item(0)->textContent)) ? $retorno["codigopostalnot"] = $reg->getElementsByTagName("codigopostalnot")->item(0)->textContent : $retorno["codigopostalnot"] = '';
                    (isset($reg->getElementsByTagName("codigozonanot")->item(0)->textContent)) ? $retorno["codigozonanot"] = $reg->getElementsByTagName("codigozonanot")->item(0)->textContent : $retorno["codigozonanot"] = '';
                    (isset($reg->getElementsByTagName("tiposedeadm")->item(0)->textContent)) ? $retorno["tiposedeadm"] = $reg->getElementsByTagName("tiposedeadm")->item(0)->textContent : $retorno["tiposedeadm"] = '';
                    $retorno["telnot"] = $reg->getElementsByTagName("telnot")->item(0)->textContent;
                    if (!isset($reg->getElementsByTagName("telnot2")->item(0)->textContent)) {
                        $retorno["telnot2"] = '';
                    } else {
                        $retorno["telnot2"] = $reg->getElementsByTagName("telnot2")->item(0)->textContent;
                    }
                    if (!isset($reg->getElementsByTagName("celnot")->item(0)->textContent)) {
                        $retorno["celnot"] = '';
                    } else {
                        $retorno["celnot"] = $reg->getElementsByTagName("celnot")->item(0)->textContent;
                    }

                    $retorno["faxnot"] = $reg->getElementsByTagName("faxnot")->item(0)->textContent;
                    $retorno["aanot"] = $reg->getElementsByTagName("aanot")->item(0)->textContent;
                    $retorno["zonapostalnot"] = $reg->getElementsByTagName("zonapostalnot")->item(0)->textContent;
                    if (!isset($reg->getElementsByTagName("barrionot")->item(0)->textContent)) {
                        $retorno["barrionot"] = "";
                        $retorno["barrionotnombre"] = '';
                    } else {
                        $retorno["barrionot"] = $reg->getElementsByTagName("barrionot")->item(0)->textContent;
                        $retorno["barrionotnombre"] = retornarRegistroMysqli2($dbx, "mreg_barriosmuni", "idmunicipio='" . $retorno["munnot"] . "' and idbarrio='" . $retorno["barrionot"] . "'", "nombre");
                    }
                    $retorno["emailnot"] = (\funcionesSii2::restaurarEspeciales($reg->getElementsByTagName("emailnot")->item(0)->textContent));
                    $retorno["urlnot"] = (\funcionesSii2::restaurarEspeciales($reg->getElementsByTagName("urlnot")->item(0)->textContent));

                    // ***************************************************************************** //
                    // Datos de correspondencia
                    // ***************************************************************************** //
                    (isset($reg->getElementsByTagName("dircor")->item(0)->textContent)) ? (\funcionesSii2::restaurarEspeciales(str_replace("#", "Nro.", $retorno["dircor"] = $reg->getElementsByTagName("dircor")->item(0)->textContent))) : $retorno["dircor"] = '';
                    (isset($reg->getElementsByTagName("telcor")->item(0)->textContent)) ? (\funcionesSii2::restaurarEspeciales($retorno["telcor"] = $reg->getElementsByTagName("telcor")->item(0)->textContent)) : $retorno["telcor"] = '';
                    (isset($reg->getElementsByTagName("muncor")->item(0)->textContent)) ? (\funcionesSii2::restaurarEspeciales($retorno["muncor"] = $reg->getElementsByTagName("muncor")->item(0)->textContent)) : $retorno["muncor"] = '';

                    // ***************************************************************************** //
                    // informacion de actividad economica
                    // ***************************************************************************** //
                    $i = 0;
                    $retorno["ciius"][1] = '';
                    $retorno["ciius"][2] = '';
                    $retorno["ciius"][3] = '';
                    $retorno["ciius"][4] = '';
                    $retorno["ciius"][5] = '';
                    $retorno["ciiusant"][1] = '';
                    $retorno["ciiusant"][2] = '';
                    $retorno["ciiusant"][3] = '';
                    $retorno["ciiusant"][4] = '';
                    $retorno["ciiusant"][5] = '';

                    $ciius = $reg->getElementsByTagName("ciiu");
                    if (!empty($ciius)) {
                        foreach ($ciius as $ciiu) {
                            if (!empty($ciiu)) {
                                $i++;
                                $retorno["ciius"][$i] = trim($ciiu->textContent);
                            }
                        }
                    }
                    unset($ciius);

                    $ciiusant = $reg->getElementsByTagName("ciiuant");
                    if (!empty($ciiusant)) {
                        foreach ($ciiusant as $ciiu) {
                            if (!empty($ciiu)) {
                                $i++;
                                $retorno["ciiusant"][$i] = trim($ciiu->textContent);
                            }
                        }
                    }
                    unset($ciiusant);

                    if (trim($retorno["ciius"][1]) != '') {
                        if ((substr($retorno["ciius"][1], 0, 1) >= '0') && (substr($retorno["ciius"][1], 0, 1) <= '9')) {
                            $retorno["ciius"][1] = \funcionesSii2::localizarLetraCiiu($dbx, $retorno["ciius"][1]) . $retorno["ciius"][1];
                        }
                    }
                    if (trim($retorno["ciius"][2]) != '') {
                        if ((substr($retorno["ciius"][2], 0, 1) >= '0') && (substr($retorno["ciius"][2], 0, 1) <= '9')) {
                            $retorno["ciius"][2] = \funcionesSii2::localizarLetraCiiu($dbx, $retorno["ciius"][2]) . $retorno["ciius"][2];
                        }
                    }
                    if (trim($retorno["ciius"][3]) != '') {
                        if ((substr($retorno["ciius"][3], 0, 1) >= '0') && (substr($retorno["ciius"][3], 0, 1) <= '9')) {
                            $retorno["ciius"][3] = \funcionesSii2::localizarLetraCiiu($dbx, $retorno["ciius"][3]) . $retorno["ciius"][3];
                        }
                    }
                    if (trim($retorno["ciius"][4]) != '') {
                        if ((substr($retorno["ciius"][4], 0, 1) >= '0') && (substr($retorno["ciius"][4], 0, 1) <= '9')) {
                            $retorno["ciius"][4] = \funcionesSii2::localizarLetraCiiu($dbx, $retorno["ciius"][4]) . $retorno["ciius"][4];
                        }
                    }

                    $i = 0;
                    $retorno["shd"][1] = '';
                    $retorno["shd"][2] = '';
                    $retorno["shd"][3] = '';
                    $retorno["shd"][4] = '';

                    $shds = $reg->getElementsByTagName("shd");
                    if (!empty($shds)) {
                        foreach ($shds as $shd) {
                            if (!empty($shd)) {
                                $i++;
                                $retorno["shd"][$i] = trim($shd->textContent);
                            }
                        }
                    }
                    unset($shds);

                    //
                    if (isset($reg->getElementsByTagName("versionciiu")->item(0)->textContent)) {
                        $retorno["versionciiu"] = trim($reg->getElementsByTagName("versionciiu")->item(0)->textContent);
                    } else {
                        $retorno["versionciiu"] = '';
                    }

                    if (isset($reg->getElementsByTagName("desactiv")->item(0)->textContent)) {
                        $retorno["desactiv"] = $reg->getElementsByTagName("desactiv")->item(0)->textContent;
                    } else {
                        $retorno["desactiv"] = '';
                    }

                    if (isset($reg->getElementsByTagName("feciniact1")->item(0)->textContent)) {
                        $retorno["feciniact1"] = trim($reg->getElementsByTagName("feciniact1")->item(0)->textContent);
                    } else {
                        $retorno["feciniact1"] = '';
                    }
                    if (isset($reg->getElementsByTagName("feciniact2")->item(0)->textContent)) {
                        $retorno["feciniact2"] = trim($reg->getElementsByTagName("feciniact2")->item(0)->textContent);
                    } else {
                        $retorno["feciniact2"] = '';
                    }

                    (isset($reg->getElementsByTagName("codaduaneros")->item(0)->textContent)) ? (\funcionesSii2::restaurarEspeciales($retorno["codaduaneros"] = $reg->getElementsByTagName("codaduaneros")->item(0)->textContent)) : $retorno["codaduaneros"] = '';
                    (isset($reg->getElementsByTagName("gruponiif")->item(0)->textContent)) ? (\funcionesSii2::restaurarEspeciales($retorno["gruponiif"] = $reg->getElementsByTagName("gruponiif")->item(0)->textContent)) : $retorno["gruponiif"] = '';
                    (isset($reg->getElementsByTagName("niifconciliacion")->item(0)->textContent)) ? (\funcionesSii2::restaurarEspeciales($retorno["niifconciliacion"] = $reg->getElementsByTagName("niifconciliacion")->item(0)->textContent)) : $retorno["niifconciliacion"] = '';
                    (isset($reg->getElementsByTagName("aportantesegsocial")->item(0)->textContent)) ? (\funcionesSii2::restaurarEspeciales($retorno["aportantesegsocial"] = $reg->getElementsByTagName("aportantesegsocial")->item(0)->textContent)) : $retorno["aportantesegsocial"] = '';
                    (isset($reg->getElementsByTagName("tipoaportantesegsocial")->item(0)->textContent)) ? (\funcionesSii2::restaurarEspeciales($retorno["tipoaportantesegsocial"] = $reg->getElementsByTagName("tipoaportantesegsocial")->item(0)->textContent)) : $retorno["tipoaportantesegsocial"] = '';
                    (isset($reg->getElementsByTagName("cumplerequisitos1780")->item(0)->textContent)) ? (\funcionesSii2::restaurarEspeciales($retorno["cumplerequisitos1780"] = $reg->getElementsByTagName("cumplerequisitos1780")->item(0)->textContent)) : $retorno["cumplerequisitos1780"] = '';
                    (isset($reg->getElementsByTagName("renunciabeneficios1780")->item(0)->textContent)) ? (\funcionesSii2::restaurarEspeciales($retorno["renunciabeneficios1780"] = $reg->getElementsByTagName("renunciabeneficios1780")->item(0)->textContent)) : $retorno["renunciabeneficios1780"] = '';
                    (isset($reg->getElementsByTagName("cumplerequisitos1780primren")->item(0)->textContent)) ? (\funcionesSii2::restaurarEspeciales($retorno["cumplerequisitos1780primren"] = $reg->getElementsByTagName("cumplerequisitos1780primren")->item(0)->textContent)) : $retorno["cumplerequisitos1780primren"] = '';

                    // ***************************************************************************** //
                    // informacion financiera - prinicpal o actual
                    // ***************************************************************************** //
                    // ***************************************************************************** //
                    // Inicializa
                    // ***************************************************************************** //
                    $retorno["anodatos"] = '';
                    $retorno["fechadatos"] = '';
                    $retorno["personal"] = 0;
                    $retorno["personaltemp"] = 0;
                    $retorno["patrimonio"] = 0;
                    $retorno["actvin"] = 0;
                    $retorno["actcte"] = 0;
                    $retorno["actnocte"] = 0;
                    $retorno["actfij"] = 0;
                    $retorno["fijnet"] = 0;
                    $retorno["actotr"] = 0;
                    $retorno["actval"] = 0;
                    $retorno["acttot"] = 0;
                    $retorno["actsinaju"] = 0;
                    $retorno["invent"] = 0;
                    $retorno["pascte"] = 0;
                    $retorno["paslar"] = 0;
                    $retorno["pastot"] = 0;
                    $retorno["pattot"] = 0;
                    $retorno["paspat"] = 0;
                    $retorno["balsoc"] = 0;
                    $retorno["ingope"] = 0;
                    $retorno["ingnoope"] = 0;
                    $retorno["gtoven"] = 0;
                    $retorno["gtoadm"] = 0;
                    $retorno["gasope"] = 0;
                    $retorno["gasnoope"] = 0;
                    $retorno["cosven"] = 0;
                    $retorno["depamo"] = 0;
                    $retorno["gasint"] = 0;
                    $retorno["gasimp"] = 0;
                    $retorno["utiope"] = 0;
                    $retorno["utinet"] = 0;
                    $retorno["valest"] = 0;

                    // ***************************************************************************** //
                    // Mueve actuales basicos 
                    // ***************************************************************************** //
                    if (isset($reg->getElementsByTagName("anodatos")->item(0)->textContent)) {
                        $retorno["anodatos"] = $reg->getElementsByTagName("anodatos")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("fechadatos")->item(0)->textContent)) {
                        $retorno["fechadatos"] = $reg->getElementsByTagName("fechadatos")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("personal")->item(0)->textContent)) {
                        $retorno["personal"] = $reg->getElementsByTagName("personal")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("personaltemp")->item(0)->textContent)) {
                        $retorno["personaltemp"] = doubleval($reg->getElementsByTagName("personaltemp")->item(0)->textContent);
                    }
                    if (isset($reg->getElementsByTagName("actvin")->item(0)->textContent)) {
                        $retorno["actvin"] = $reg->getElementsByTagName("actvin")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("actcte")->item(0)->textContent)) {
                        $retorno["actcte"] = $reg->getElementsByTagName("actcte")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("actnocte")->item(0)->textContent)) {
                        $retorno["actnocte"] = $reg->getElementsByTagName("actnocte")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("actfij")->item(0)->textContent)) {
                        $retorno["actfij"] = $reg->getElementsByTagName("actfij")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("fijnet")->item(0)->textContent)) {
                        $retorno["fijnet"] = $reg->getElementsByTagName("fijnet")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("actotr")->item(0)->textContent)) {
                        $retorno["actotr"] = $reg->getElementsByTagName("actotr")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("actval")->item(0)->textContent)) {
                        $retorno["actval"] = $reg->getElementsByTagName("actval")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("acttot")->item(0)->textContent)) {
                        $retorno["acttot"] = $reg->getElementsByTagName("acttot")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("pascte")->item(0)->textContent)) {
                        $retorno["pascte"] = $reg->getElementsByTagName("pascte")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("paslar")->item(0)->textContent)) {
                        $retorno["paslar"] = $reg->getElementsByTagName("paslar")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("pastot")->item(0)->textContent)) {
                        $retorno["pastot"] = $reg->getElementsByTagName("pastot")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("pattot")->item(0)->textContent)) {
                        $retorno["pattot"] = $reg->getElementsByTagName("pattot")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("paspat")->item(0)->textContent)) {
                        $retorno["paspat"] = $reg->getElementsByTagName("paspat")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("balsoc")->item(0)->textContent)) {
                        $retorno["balsoc"] = $reg->getElementsByTagName("balsoc")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("ingope")->item(0)->textContent)) {
                        $retorno["ingope"] = $reg->getElementsByTagName("ingope")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("ingnoope")->item(0)->textContent)) {
                        $retorno["ingnoope"] = $reg->getElementsByTagName("ingnoope")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("gtoven")->item(0)->textContent)) {
                        $retorno["gtoven"] = $reg->getElementsByTagName("gtoven")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("gtoadm")->item(0)->textContent)) {
                        $retorno["gtoadm"] = $reg->getElementsByTagName("gtoadm")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("gasope")->item(0)->textContent)) {
                        $retorno["gasope"] = $reg->getElementsByTagName("gasope")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("gasnoope")->item(0)->textContent)) {
                        $retorno["gasnoope"] = $reg->getElementsByTagName("gasnoope")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("cosven")->item(0)->textContent)) {
                        $retorno["cosven"] = $reg->getElementsByTagName("cosven")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("gasint")->item(0)->textContent)) {
                        $retorno["gasint"] = $reg->getElementsByTagName("gasint")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("gasimp")->item(0)->textContent)) {
                        $retorno["gasimp"] = $reg->getElementsByTagName("gasimp")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("utiope")->item(0)->textContent)) {
                        $retorno["utiope"] = $reg->getElementsByTagName("utiope")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("utinet")->item(0)->textContent)) {
                        $retorno["utinet"] = $reg->getElementsByTagName("utinet")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("valest")->item(0)->textContent)) {
                        $retorno["valest"] = $reg->getElementsByTagName("valest")->item(0)->textContent;
                    }

                    // ***************************************************************************** //
                    // Información del patrimonio de las ESADL
                    // ***************************************************************************** //
                    if (isset($reg->getElementsByTagName("anodatospatrimonio")->item(0)->textContent)) {
                        $retorno["anodatospatrimonio"] = $reg->getElementsByTagName("anodatospatrimonio")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("fechadatospatrimonio")->item(0)->textContent)) {
                        $retorno["fechadatospatrimonio"] = $reg->getElementsByTagName("fechadatospatrimonio")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("patrimonioesadl")->item(0)->textContent)) {
                        $retorno["patrimonioesadl"] = $reg->getElementsByTagName("patrimonioesadl")->item(0)->textContent;
                    }

                    // ***************************************************************************** //
                    // informacion financiera - prinicpal o actual
                    // ***************************************************************************** //
                    if (isset($reg->getElementsByTagName("anodatosactual")->item(0)->textContent)) {
                        $retorno["anodatos"] = $reg->getElementsByTagName("anodatosactual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("fechadatosactual")->item(0)->textContent)) {
                        $retorno["fechadatos"] = $reg->getElementsByTagName("fechadatosactual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("personalactual")->item(0)->textContent)) {
                        $retorno["personal"] = $reg->getElementsByTagName("personalactual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("patrimonioactual")->item(0)->textContent)) {
                        $retorno["patrimonio"] = doubleval($reg->getElementsByTagName("patrimonio")->item(0)->textContent);
                    }
                    if (isset($reg->getElementsByTagName("personaltempactual")->item(0)->textContent)) {
                        $retorno["personaltemp"] = doubleval($reg->getElementsByTagName("personaltempactual")->item(0)->textContent);
                    }
                    if (isset($reg->getElementsByTagName("actvinactual")->item(0)->textContent)) {
                        $retorno["actvin"] = $reg->getElementsByTagName("actvinactual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("actcteactual")->item(0)->textContent)) {
                        $retorno["actcte"] = $reg->getElementsByTagName("actcteactual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("actnocteactual")->item(0)->textContent)) {
                        $retorno["actnocte"] = $reg->getElementsByTagName("actnocteactual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("actfijactual")->item(0)->textContent)) {
                        $retorno["actfij"] = $reg->getElementsByTagName("actfijactual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("fijnetactual")->item(0)->textContent)) {
                        $retorno["fijnet"] = $reg->getElementsByTagName("fijnetactual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("actotractual")->item(0)->textContent)) {
                        $retorno["actotr"] = $reg->getElementsByTagName("actotractual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("actvalactual")->item(0)->textContent)) {
                        $retorno["actval"] = $reg->getElementsByTagName("actvalactual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("acttotactual")->item(0)->textContent)) {
                        $retorno["acttot"] = $reg->getElementsByTagName("acttotactual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("pascteactual")->item(0)->textContent)) {
                        $retorno["pascte"] = $reg->getElementsByTagName("pascteactual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("paslaractual")->item(0)->textContent)) {
                        $retorno["paslar"] = $reg->getElementsByTagName("paslaractual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("pastotactual")->item(0)->textContent)) {
                        $retorno["pastot"] = $reg->getElementsByTagName("pastotactual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("pattotactual")->item(0)->textContent)) {
                        $retorno["pattot"] = $reg->getElementsByTagName("pattotactual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("paspatactual")->item(0)->textContent)) {
                        $retorno["paspat"] = $reg->getElementsByTagName("paspatactual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("balsocactual")->item(0)->textContent)) {
                        $retorno["balsoc"] = $reg->getElementsByTagName("balsocactual")->item(0)->textContent;
                    }

                    if (isset($reg->getElementsByTagName("ingopeactual")->item(0)->textContent)) {
                        $retorno["ingope"] = $reg->getElementsByTagName("ingopeactual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("ingnoopeactual")->item(0)->textContent)) {
                        $retorno["ingnoope"] = $reg->getElementsByTagName("ingnoopeactual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("gtovenactual")->item(0)->textContent)) {
                        $retorno["gtoven"] = $reg->getElementsByTagName("gtovenactual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("gtoadmactual")->item(0)->textContent)) {
                        $retorno["gtoadm"] = $reg->getElementsByTagName("gtoadmactual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("gasopeactual")->item(0)->textContent)) {
                        $retorno["gasope"] = $reg->getElementsByTagName("gasopeactual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("gasnoopeactual")->item(0)->textContent)) {
                        $retorno["gasnoope"] = $reg->getElementsByTagName("gasnoopeactual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("cosvenactual")->item(0)->textContent)) {
                        $retorno["cosven"] = $reg->getElementsByTagName("cosvenactual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("gasintactual")->item(0)->textContent)) {
                        $retorno["gasint"] = $reg->getElementsByTagName("gasintactual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("gasimpactual")->item(0)->textContent)) {
                        $retorno["gasimp"] = $reg->getElementsByTagName("gasimpactual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("utiopeactual")->item(0)->textContent)) {
                        $retorno["utiope"] = $reg->getElementsByTagName("utiopeactual")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("utinetactual")->item(0)->textContent)) {
                        $retorno["utinet"] = $reg->getElementsByTagName("utinetactual")->item(0)->textContent;
                    }

                    // ***************************************************************************** //
                    // Información de capitales            
                    // ***************************************************************************** //
                    $retorno["anodatoscap"] = '';
                    $retorno["fechadatoscap"] = '';
                    $retorno["cap_porcnaltot"] = 0;
                    $retorno["cap_porcnalpri"] = 0;
                    $retorno["cap_porcnalpub"] = 0;
                    $retorno["cap_porcexttot"] = 0;
                    $retorno["cap_porcextpri"] = 0;
                    $retorno["cap_porcextpub"] = 0;
                    $retorno["cap_apolab"] = 0;
                    $retorno["cap_apolabadi"] = 0;
                    $retorno["cap_apoact"] = 0;
                    $retorno["cap_apodin"] = 0;
                    $retorno["capaut"] = 0;
                    $retorno["capsus"] = 0;
                    $retorno["cappag"] = 0;
                    $retorno["capsoc"] = 0;

                    $retorno["cap_porcnaltot"] = $reg->getElementsByTagName("cap_porcnaltot")->item(0)->textContent;
                    $retorno["cap_porcnalpri"] = $reg->getElementsByTagName("cap_porcnalpri")->item(0)->textContent;
                    $retorno["cap_porcnalpub"] = $reg->getElementsByTagName("cap_porcnalpub")->item(0)->textContent;
                    $retorno["cap_porcexttot"] = $reg->getElementsByTagName("cap_porcexttot")->item(0)->textContent;
                    $retorno["cap_porcextpri"] = $reg->getElementsByTagName("cap_porcextpri")->item(0)->textContent;
                    $retorno["cap_porcextpub"] = $reg->getElementsByTagName("cap_porcextpub")->item(0)->textContent;

                    if (isset($reg->getElementsByTagName("cap_anodatos")->item(0)->textContent)) {
                        $retorno["anodatoscap"] = $reg->getElementsByTagName("cap_anodatos")->item(0)->textContent;
                    } else {
                        $retorno["anodatoscap"] = '';
                    }
                    if (isset($reg->getElementsByTagName("cap_fechadatos")->item(0)->textContent)) {
                        $retorno["fechadatoscap"] = $reg->getElementsByTagName("cap_fechadatos")->item(0)->textContent;
                    } else {
                        $retorno["fechadatoscap"] = '';
                    }
                    if (isset($reg->getElementsByTagName("cap_autorizado")->item(0)->textContent)) {
                        $retorno["capaut"] = $reg->getElementsByTagName("cap_autorizado")->item(0)->textContent;
                    } else {
                        $retorno["capaut"] = '';
                    }
                    if (isset($reg->getElementsByTagName("cap_suscrito")->item(0)->textContent)) {
                        $retorno["capsus"] = $reg->getElementsByTagName("cap_suscrito")->item(0)->textContent;
                    } else {
                        $retorno["capsus"] = '';
                    }
                    if (isset($reg->getElementsByTagName("cap_pagado")->item(0)->textContent)) {
                        $retorno["cappag"] = $reg->getElementsByTagName("cap_pagado")->item(0)->textContent;
                    } else {
                        $retorno["cappag"] = '';
                    }
                    if (isset($reg->getElementsByTagName("cap_social")->item(0)->textContent)) {
                        $retorno["capsoc"] = $reg->getElementsByTagName("cap_social")->item(0)->textContent;
                    } else {
                        $retorno["capsoc"] = '';
                    }

                    if (isset($reg->getElementsByTagName("cap_apolab")->item(0)->textContent)) {
                        $retorno["cap_apolab"] = $reg->getElementsByTagName("cap_apolab")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("cap_apolabadi")->item(0)->textContent)) {
                        $retorno["cap_apolabadi"] = $reg->getElementsByTagName("cap_apolabadi")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("cap_apoact")->item(0)->textContent)) {
                        $retorno["cap_apoact"] = $reg->getElementsByTagName("cap_apoact")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("cap_apodin")->item(0)->textContent)) {
                        $retorno["cap_apodin"] = $reg->getElementsByTagName("cap_apodin")->item(0)->textContent;
                    }
                    $retorno["cap_apotot"] = $retorno["cap_apolab"] + $retorno["cap_apolabadi"] + $retorno["cap_apoact"] + $retorno["cap_apodin"];

                    $retorno["capitales"] = array();
                    $caps = $reg->getElementsByTagName("cap");
                    if (!empty($caps)) {
                        $icap = 0;
                        foreach ($caps as $hcap) {
                            if (isset($hcap->getElementsByTagName("cap_anodat")->item(0)->textContent)) {
                                $icap++;
                                $retorno["capitales"][$icap]["anodatos"] = $hcap->getElementsByTagName("cap_anodat")->item(0)->textContent;
                                $retorno["capitales"][$icap]["fechadatos"] = $hcap->getElementsByTagName("cap_fecdat")->item(0)->textContent;
                                $retorno["capitales"][$icap]["libro"] = $hcap->getElementsByTagName("cap_libro")->item(0)->textContent;
                                $retorno["capitales"][$icap]["registro"] = $hcap->getElementsByTagName("cap_registro")->item(0)->textContent;
                                $retorno["capitales"][$icap]["tipoeconomia"] = $hcap->getElementsByTagName("cap_economia")->item(0)->textContent;

                                $retorno["capitales"][$icap]["pornaltot"] = doubleval($hcap->getElementsByTagName("cap_pctnaltot")->item(0)->textContent);
                                $retorno["capitales"][$icap]["pornalpri"] = doubleval($hcap->getElementsByTagName("cap_pctnalpri")->item(0)->textContent);
                                $retorno["capitales"][$icap]["pornalpub"] = doubleval($hcap->getElementsByTagName("cap_pctnalpub")->item(0)->textContent);
                                $retorno["capitales"][$icap]["porexttot"] = doubleval($hcap->getElementsByTagName("cap_pctexttot")->item(0)->textContent);
                                $retorno["capitales"][$icap]["porextpri"] = doubleval($hcap->getElementsByTagName("cap_pctextpri")->item(0)->textContent);
                                $retorno["capitales"][$icap]["porextpub"] = doubleval($hcap->getElementsByTagName("cap_pctextpub")->item(0)->textContent);

                                $retorno["capitales"][$icap]["apoact"] = doubleval($hcap->getElementsByTagName("cap_apoact")->item(0)->textContent);
                                $retorno["capitales"][$icap]["apodin"] = doubleval($hcap->getElementsByTagName("cap_apodin")->item(0)->textContent);
                                $retorno["capitales"][$icap]["apolab"] = doubleval($hcap->getElementsByTagName("cap_apolab")->item(0)->textContent);
                                $retorno["capitales"][$icap]["apolabadi"] = doubleval($hcap->getElementsByTagName("cap_apolabadi")->item(0)->textContent);

                                $retorno["capitales"][$icap]["suscrito"] = doubleval($hcap->getElementsByTagName("cap_suscrito")->item(0)->textContent);
                                $retorno["capitales"][$icap]["autorizado"] = doubleval($hcap->getElementsByTagName("cap_autorizado")->item(0)->textContent);
                                $retorno["capitales"][$icap]["pagado"] = doubleval($hcap->getElementsByTagName("cap_pagado")->item(0)->textContent);
                                $retorno["capitales"][$icap]["social"] = doubleval($hcap->getElementsByTagName("cap_social")->item(0)->textContent);
                                $retorno["capitales"][$icap]["asigsuc"] = doubleval($hcap->getElementsByTagName("cap_asigsuc")->item(0)->textContent);
                                $retorno["capitales"][$icap]["cuosuscrito"] = doubleval($hcap->getElementsByTagName("cap_cuosuscrito")->item(0)->textContent);
                                $retorno["capitales"][$icap]["cuoautorizado"] = doubleval($hcap->getElementsByTagName("cap_cuoautorizado")->item(0)->textContent);
                                $retorno["capitales"][$icap]["cuopagado"] = doubleval($hcap->getElementsByTagName("cap_cuopagado")->item(0)->textContent);
                                $retorno["capitales"][$icap]["cuosocial"] = doubleval($hcap->getElementsByTagName("cap_cuosocial")->item(0)->textContent);
                            }
                        }
                    }

                    // ***************************************************************************** //
                    // informacion de Patrimonios de ESADL
                    // ***************************************************************************** //                
                    $retorno["patrimoniosesadl"] = array();
                    $caps = $reg->getElementsByTagName("pesadl");
                    if (!empty($caps)) {
                        $icap = 0;
                        foreach ($caps as $hcap) {
                            if (isset($hcap->getElementsByTagName("pesadl_anodat")->item(0)->textContent)) {
                                $icap++;
                                $retorno["patrimoniosesadl"][$icap]["anodatos"] = $hcap->getElementsByTagName("pesadl_anodat")->item(0)->textContent;
                                $retorno["patrimoniosesadl"][$icap]["fechadatos"] = $hcap->getElementsByTagName("pesadl_fecdat")->item(0)->textContent;
                                $retorno["patrimoniosesadl"][$icap]["patrimonio"] = doubleval($hcap->getElementsByTagName("pesadl_patrimonio")->item(0)->textContent);
                                $retorno["patrimonio"] = doubleval($hcap->getElementsByTagName("pesadl_patrimonio")->item(0)->textContent);
                            }
                        }
                    }

                    // ***************************************************************************** //
                    // informacion de Establecimientos de comercio asociados
                    // ***************************************************************************** //
                    $retorno["cntestab01"] = $reg->getElementsByTagName("cntestab01")->item(0)->textContent;
                    $retorno["cntestab02"] = $reg->getElementsByTagName("cntestab02")->item(0)->textContent;
                    $retorno["cntestab03"] = $reg->getElementsByTagName("cntestab03")->item(0)->textContent;
                    $retorno["cntestab04"] = $reg->getElementsByTagName("cntestab04")->item(0)->textContent;
                    $retorno["cntestab05"] = $reg->getElementsByTagName("cntestab05")->item(0)->textContent;
                    $retorno["cntestab06"] = $reg->getElementsByTagName("cntestab06")->item(0)->textContent;
                    $retorno["cntestab07"] = $reg->getElementsByTagName("cntestab07")->item(0)->textContent;
                    $retorno["cntestab08"] = $reg->getElementsByTagName("cntestab08")->item(0)->textContent;
                    $retorno["cntestab09"] = $reg->getElementsByTagName("cntestab09")->item(0)->textContent;
                    $retorno["cntestab10"] = $reg->getElementsByTagName("cntestab10")->item(0)->textContent;
                    $retorno["cntestab11"] = $reg->getElementsByTagName("cntestab11")->item(0)->textContent;

                    // ***************************************************************************** //
                    // informacion de referencias comerciales y bancarias
                    // ***************************************************************************** //
                    $retorno["refcrenom1"] = $reg->getElementsByTagName("refcrenom1")->item(0)->textContent;
                    $retorno["refcreofi1"] = $reg->getElementsByTagName("refcreofi1")->item(0)->textContent;
                    if (isset($reg->getElementsByTagName("refcretel1")->item(0)->textContent)) {
                        $retorno["refcretel1"] = $reg->getElementsByTagName("refcretel1")->item(0)->textContent;
                    } else {
                        $retorno["refcretel1"] = '';
                    }
                    $retorno["refcrenom2"] = $reg->getElementsByTagName("refcrenom2")->item(0)->textContent;
                    $retorno["refcreofi2"] = $reg->getElementsByTagName("refcreofi2")->item(0)->textContent;
                    if (isset($reg->getElementsByTagName("refcretel2")->item(0)->textContent)) {
                        $retorno["refcretel2"] = $reg->getElementsByTagName("refcretel2")->item(0)->textContent;
                    } else {
                        $retorno["refcretel2"] = '';
                    }
                    $retorno["refcomnom1"] = $reg->getElementsByTagName("refcomnom1")->item(0)->textContent;
                    $retorno["refcomdir1"] = $reg->getElementsByTagName("refcomdir1")->item(0)->textContent;
                    $retorno["refcomtel1"] = $reg->getElementsByTagName("refcomtel1")->item(0)->textContent;
                    $retorno["refcomnom2"] = $reg->getElementsByTagName("refcomnom2")->item(0)->textContent;
                    $retorno["refcomdir2"] = $reg->getElementsByTagName("refcomdir2")->item(0)->textContent;
                    $retorno["refcomtel2"] = $reg->getElementsByTagName("refcomtel2")->item(0)->textContent;



                    // ***************************************************************************** //
                    // informacion financiera anteriores (historicos)
                    // ***************************************************************************** //
                    $retorno["hf"] = array();
                    $ifin = 0;
                    $hfs = $reg->getElementsByTagName("hf");
                    if (!empty($hfs)) {
                        foreach ($hfs as $hfin) {
                            if (isset($hfin->getElementsByTagName("hf_anodatos")->item(0)->textContent)) {
                                $ifin++;
                                if ($retorno["organizacion"] == '01' ||
                                        ($retorno["organizacion"] > '02' && $retorno["categoria"] == '1')
                                ) {
                                    $retorno["hf"][$ifin]["anodatos"] = $hfin->getElementsByTagName("hf_anodatos")->item(0)->textContent;
                                    $retorno["hf"][$ifin]["feccredat"] = $hfin->getElementsByTagName("hf_feccredat")->item(0)->textContent;
                                    $retorno["hf"][$ifin]["fechadatos"] = $hfin->getElementsByTagName("hf_feccredat")->item(0)->textContent;
                                    $retorno["hf"][$ifin]["actcte"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_actcte")->item(0)->textContent));
                                    if (isset($hfin->getElementsByTagName("hf_actnocte")->item(0)->textContent)) {
                                        $retorno["hf"][$ifin]["actnocte"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_actnocte")->item(0)->textContent));
                                    } else {
                                        $retorno["f"][$iFin]["actnocte"] = 0;
                                    }
                                    $retorno["hf"][$ifin]["actfij"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_actfij")->item(0)->textContent));
                                    $retorno["hf"][$ifin]["fijnet"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_fijnet")->item(0)->textContent));
                                    $retorno["hf"][$ifin]["actval"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_actval")->item(0)->textContent));
                                    $retorno["hf"][$ifin]["actotr"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_actotr")->item(0)->textContent));
                                    $retorno["hf"][$ifin]["acttot"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_acttot")->item(0)->textContent));
                                    $retorno["hf"][$ifin]["actsin"] = 0;
                                    $retorno["hf"][$ifin]["actsinaju"] = 0;
                                    $retorno["hf"][$ifin]["invent"] = 0;
                                    $retorno["hf"][$ifin]["pascte"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_pascte")->item(0)->textContent));
                                    $retorno["hf"][$ifin]["paslar"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_paslar")->item(0)->textContent));
                                    $retorno["hf"][$ifin]["pastot"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_pastot")->item(0)->textContent));
                                    $retorno["hf"][$ifin]["patliq"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_patliq")->item(0)->textContent));
                                    $retorno["hf"][$ifin]["pattot"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_patliq")->item(0)->textContent));
                                    $retorno["hf"][$ifin]["patnet"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_patliq")->item(0)->textContent));
                                    if (isset($hfin->getElementsByTagName("hf_patnet")->item(0)->textContent)) {
                                        $retorno["hf"][$ifin]["patliq"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_patnet")->item(0)->textContent));
                                        $retorno["hf"][$ifin]["pattot"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_patnet")->item(0)->textContent));
                                        $retorno["hf"][$ifin]["patnet"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_patnet")->item(0)->textContent));
                                    }
                                    $retorno["hf"][$ifin]["paspat"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_paspat")->item(0)->textContent));
                                    if (isset($hfin->getElementsByTagName("hf_balsoc")->item(0)->textContent)) {
                                        $retorno["hf"][$ifin]["balsoc"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_balsoc")->item(0)->textContent));
                                    } else {
                                        $retorno["hf"][$iFin]["balsoc"] = 0;
                                    }
                                    $retorno["hf"][$ifin]["ingope"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_ingope")->item(0)->textContent));
                                    $retorno["hf"][$ifin]["ingnoope"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_ingnoope")->item(0)->textContent));
                                    $retorno["hf"][$ifin]["cosven"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_cosven")->item(0)->textContent));
                                    $retorno["hf"][$ifin]["gasadm"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_gasadm")->item(0)->textContent));
                                    $retorno["hf"][$ifin]["gtoadm"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_gasadm")->item(0)->textContent));
                                    $retorno["hf"][$ifin]["gasope"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_gasope")->item(0)->textContent));
                                    $retorno["hf"][$ifin]["gtoven"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_gasope")->item(0)->textContent));
                                    $retorno["hf"][$ifin]["utiope"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_utiope")->item(0)->textContent));
                                    $retorno["hf"][$ifin]["utinet"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_utinet")->item(0)->textContent));
                                    $retorno["hf"][$ifin]["person"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_person")->item(0)->textContent));
                                    $retorno["hf"][$ifin]["personal"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_person")->item(0)->textContent));
                                    $retorno["hf"][$ifin]["pcttem"] = doubleval($hfin->getElementsByTagName("hf_pcttem")->item(0)->textContent);
                                    $retorno["hf"][$ifin]["personaltemp"] = doubleval($hfin->getElementsByTagName("hf_pcttem")->item(0)->textContent);
                                    $retorno["hf"][$ifin]["depamo"] = 0;
                                    if (isset($hfin->getElementsByTagName("hf_gasint")->item(0)->textContent)) {
                                        $retorno["hf"][$ifin]["gasint"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_gasint")->item(0)->textContent));
                                    } else {
                                        $retorno["hf"][$iFin]["gasint"] = 0;
                                    }
                                    if (isset($hfin->getElementsByTagName("hf_gasimp")->item(0)->textContent)) {
                                        $retorno["hf"][$ifin]["gasimp"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_gasimp")->item(0)->textContent));
                                    } else {
                                        $retorno["hf"][$iFin]["gasimp"] = 0;
                                    }
                                    $retorno["hf"][$ifin]["operacion"] = '';
                                } else {
                                    $retorno["hf"][$ifin]["anodatos"] = $hfin->getElementsByTagName("hf_anodatos")->item(0)->textContent;
                                    $retorno["hf"][$ifin]["feccredat"] = $hfin->getElementsByTagName("hf_feccredat")->item(0)->textContent;
                                    $retorno["hf"][$ifin]["fechadatos"] = $hfin->getElementsByTagName("hf_feccredat")->item(0)->textContent;
                                    $retorno["hf"][$ifin]["valest"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_valest")->item(0)->textContent));
                                    if (isset($hfin->getElementsByTagName("hf_actvin")->item(0)->textContent)) {
                                        $retorno["hf"][$ifin]["actvin"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_actvin")->item(0)->textContent));
                                    } else {
                                        $retorno["hf"][$ifin]["actvin"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_valest")->item(0)->textContent));
                                    }
                                    $retorno["hf"][$ifin]["person"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_person")->item(0)->textContent));
                                    $retorno["hf"][$ifin]["personal"] = doubleval(\funcionesSii2::convertirStringNumero($hfin->getElementsByTagName("hf_person")->item(0)->textContent));
                                    $retorno["hf"][$ifin]["pcttem"] = 0;
                                    $retorno["hf"][$ifin]["personaltemp"] = 0;
                                    $retorno["hf"][$ifin]["operacion"] = '';
                                }
                            }
                        }
                    }

                    // ***************************************************************************** //
                    // informacion financiera anteriores
                    // ***************************************************************************** //
                    $retorno["f"] = array();
                    $fins = $reg->getElementsByTagName("financieraanteriores");
                    foreach ($fins as $fin) {
                        $iFin = $fin->getElementsByTagName("anodatos")->item(0)->textContent;
                        if (trim($iFin) != '') {
                            $retorno["f"][$iFin]["anodatos"] = $fin->getElementsByTagName("anodatos")->item(0)->textContent;
                            $retorno["f"][$iFin]["fechadatos"] = $fin->getElementsByTagName("fechadatos")->item(0)->textContent;
                            $retorno["f"][$iFin]["personal"] = $fin->getElementsByTagName("personal")->item(0)->textContent;
                            $retorno["f"][$iFin]["personaltemp"] = $fin->getElementsByTagName("personaltemp")->item(0)->textContent;
                            $retorno["f"][$iFin]["actvin"] = $fin->getElementsByTagName("actvin")->item(0)->textContent;
                            $retorno["f"][$iFin]["actcte"] = $fin->getElementsByTagName("actcte")->item(0)->textContent;
                            if (isset($fin->getElementsByTagName("actnocte")->item(0)->textContent)) {
                                $retorno["f"][$iFin]["actnocte"] = $fin->getElementsByTagName("actnocte")->item(0)->textContent;
                            } else {
                                $retorno["f"][$iFin]["actnocte"] = 0;
                            }
                            $retorno["f"][$iFin]["actfij"] = $fin->getElementsByTagName("actfij")->item(0)->textContent;
                            if (isset($fin->getElementsByTagName("fijnet")->item(0)->textContent)) {
                                $retorno["f"][$iFin]["fijnet"] = $fin->getElementsByTagName("fijnet")->item(0)->textContent;
                            } else {
                                $retorno["f"][$iFin]["fijnet"] = 0;
                            }
                            $retorno["f"][$iFin]["actotr"] = $fin->getElementsByTagName("actotr")->item(0)->textContent;
                            $retorno["f"][$iFin]["actval"] = $fin->getElementsByTagName("actval")->item(0)->textContent;
                            $retorno["f"][$iFin]["acttot"] = $fin->getElementsByTagName("acttot")->item(0)->textContent;
                            $retorno["f"][$iFin]["actsinaju"] = 0;
                            $retorno["f"][$iFin]["invent"] = 0;
                            $retorno["f"][$iFin]["depamo"] = 0;
                            $retorno["f"][$iFin]["pascte"] = $fin->getElementsByTagName("pascte")->item(0)->textContent;
                            $retorno["f"][$iFin]["paslar"] = $fin->getElementsByTagName("paslar")->item(0)->textContent;
                            $retorno["f"][$iFin]["pastot"] = $fin->getElementsByTagName("pastot")->item(0)->textContent;
                            $retorno["f"][$iFin]["pattot"] = $fin->getElementsByTagName("pattot")->item(0)->textContent;
                            $retorno["f"][$iFin]["paspat"] = $fin->getElementsByTagName("paspat")->item(0)->textContent;
                            if (isset($fin->getElementsByTagName("balsoc")->item(0)->textContent)) {
                                $retorno["f"][$iFin]["balsoc"] = $fin->getElementsByTagName("balsoc")->item(0)->textContent;
                            } else {
                                $retorno["f"][$iFin]["balsoc"] = 0;
                            }
                            $retorno["f"][$iFin]["ingope"] = $fin->getElementsByTagName("ingope")->item(0)->textContent;
                            if (isset($fin->getElementsByTagName("ingnoope")->item(0)->textContent)) {
                                $retorno["f"][$iFin]["ingnoope"] = $fin->getElementsByTagName("ingnoope")->item(0)->textContent;
                            } else {
                                $retorno["f"][$iFin]["ingnoope"] = 0;
                            }
                            $retorno["f"][$iFin]["gtoven"] = $fin->getElementsByTagName("gtoven")->item(0)->textContent;
                            $retorno["f"][$iFin]["gtoadm"] = $fin->getElementsByTagName("gtoadm")->item(0)->textContent;
                            if (isset($fin->getElementsByTagName("cosven")->item(0)->textContent)) {
                                $retorno["f"][$iFin]["cosven"] = $fin->getElementsByTagName("cosven")->item(0)->textContent;
                            } else {
                                $retorno["f"][$iFin]["cosven"] = 0;
                            }
                            if (isset($fin->getElementsByTagName("gasope")->item(0)->textContent)) {
                                $retorno["f"][$iFin]["gasope"] = $fin->getElementsByTagName("gasope")->item(0)->textContent;
                            } else {
                                $retorno["f"][$iFin]["gasope"] = 0;
                            }
                            if (isset($fin->getElementsByTagName("gasnoope")->item(0)->textContent)) {
                                $retorno["f"][$iFin]["gasnoope"] = $fin->getElementsByTagName("gasnoope")->item(0)->textContent;
                            } else {
                                $retorno["f"][$iFin]["gasnoope"] = 0;
                            }
                            if (isset($fin->getElementsByTagName("gasint")->item(0)->textContent)) {
                                $retorno["f"][$iFin]["gasint"] = $fin->getElementsByTagName("gasint")->item(0)->textContent;
                            } else {
                                $retorno["f"][$iFin]["gasint"] = 0;
                            }
                            if (isset($fin->getElementsByTagName("gasimp")->item(0)->textContent)) {
                                $retorno["f"][$iFin]["gasimp"] = $fin->getElementsByTagName("gasimp")->item(0)->textContent;
                            } else {
                                $retorno["f"][$iFin]["gasimp"] = 0;
                            }
                            $retorno["f"][$iFin]["utiope"] = $fin->getElementsByTagName("utiope")->item(0)->textContent;
                            $retorno["f"][$iFin]["utinet"] = $fin->getElementsByTagName("utinet")->item(0)->textContent;
                        }
                    }


                    if (isset($reg->getElementsByTagName("celcom")->item(0)->textContent)) {
                        $retorno["celcom"] = $reg->getElementsByTagName("celcom")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("celnot")->item(0)->textContent)) {
                        $retorno["celnot"] = $reg->getElementsByTagName("celnot")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("ctrmen")->item(0)->textContent)) {
                        $retorno["ctrmen"] = $reg->getElementsByTagName("ctrmen")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("ctrmennot")->item(0)->textContent)) {
                        $retorno["ctrmennot"] = $reg->getElementsByTagName("ctrmennot")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("ctrubi")->item(0)->textContent)) {
                        $retorno["ctrubi"] = $reg->getElementsByTagName("ctrubi")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("ctrfun")->item(0)->textContent)) {
                        $retorno["ctrfun"] = $reg->getElementsByTagName("ctrfun")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("art4")->item(0)->textContent)) {
                        $retorno["art4"] = $reg->getElementsByTagName("art4")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("art7")->item(0)->textContent)) {
                        $retorno["art7"] = $reg->getElementsByTagName("art7")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("art50")->item(0)->textContent)) {
                        $retorno["art50"] = $reg->getElementsByTagName("art50")->item(0)->textContent;
                    }

                    if (isset($reg->getElementsByTagName("benley1780")->item(0)->textContent)) {
                        $retorno["benley1780"] = $reg->getElementsByTagName("benley1780")->item(0)->textContent;
                    }

                    if (isset($reg->getElementsByTagName("matriculaanterior")->item(0)->textContent)) {
                        $retorno["matriculaanterior"] = ltrim($reg->getElementsByTagName("matriculaanterior")->item(0)->textContent . "0");
                    }

                    if (isset($reg->getElementsByTagName("ctrcancelacion1429")->item(0)->textContent)) {
                        $retorno["ctrcancelacion1429"] = $reg->getElementsByTagName("ctrcancelacion1429")->item(0)->textContent;
                    }

                    if (isset($reg->getElementsByTagName("ctrdepuracion1727")->item(0)->textContent)) {
                        $retorno["ctrdepuracion1727"] = $reg->getElementsByTagName("ctrdepuracion1727")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("ctrfechadepuracion1727")->item(0)->textContent)) {
                        $retorno["ctrfechadepuracion1727"] = $reg->getElementsByTagName("ctrfechadepuracion1727")->item(0)->textContent;
                    }

                    if (isset($reg->getElementsByTagName("ctrben658")->item(0)->textContent)) {
                        $retorno["ctrben658"] = $reg->getElementsByTagName("ctrben658")->item(0)->textContent;
                    }

                    if (isset($reg->getElementsByTagName("personaltemp")->item(0)->textContent)) {
                        $retorno["personaltemp"] = $reg->getElementsByTagName("personaltemp")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("ivcenvio")->item(0)->textContent)) {
                        $retorno["ivcenvio"] = $reg->getElementsByTagName("ivcenvio")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("ivcsuelos")->item(0)->textContent)) {
                        $retorno["ivcsuelos"] = $reg->getElementsByTagName("ivcsuelos")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("ivcarea")->item(0)->textContent)) {
                        $retorno["ivcarea"] = $reg->getElementsByTagName("ivcarea")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("ivcver")->item(0)->textContent)) {
                        $retorno["ivcver"] = $reg->getElementsByTagName("ivcver")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("ivccretip")->item(0)->textContent)) {
                        $retorno["ivccretip"] = $reg->getElementsByTagName("ivccretip")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("ivcali")->item(0)->textContent)) {
                        $retorno["ivcali"] = $reg->getElementsByTagName("ivcali")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("ivcqui")->item(0)->textContent)) {
                        $retorno["ivcqui"] = $reg->getElementsByTagName("ivcqui")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("ivcriesgo")->item(0)->textContent)) {
                        $retorno["ivcriesgo"] = $reg->getElementsByTagName("ivcriesgo")->item(0)->textContent;
                    }

                    // ***************************************************************************** //
                    // Datos de bienes que posee la empresa
                    // ***************************************************************************** //
                    $retorno["bienes"] = array();
                    $i = 0;
                    $bies = $reg->getElementsByTagName("bien");
                    if (!empty($bies)) {
                        foreach ($bies as $bie) {
                            $i++;
                            $retorno["bienes"][$i]["matinmo"] = $bie->getElementsByTagName("matinmo")->item(0)->textContent;
                            $retorno["bienes"][$i]["dir"] = str_replace("#", "Nro.", $bie->getElementsByTagName("dir")->item(0)->textContent);
                            $retorno["bienes"][$i]["barrio"] = $bie->getElementsByTagName("barrio")->item(0)->textContent;
                            $retorno["bienes"][$i]["muni"] = $bie->getElementsByTagName("muni")->item(0)->textContent;
                            $retorno["bienes"][$i]["dpto"] = $bie->getElementsByTagName("dpto")->item(0)->textContent;
                            $retorno["bienes"][$i]["pais"] = $bie->getElementsByTagName("pais")->item(0)->textContent;
                        }
                    }
                    unset($bies);
                    unset($bie);

                    // ***************************************************************************** //
                    // Representacion legal y administracion 
                    // ***************************************************************************** //
                    $retorno["replegal"] = array();
                    $i = 0;
                    $reps = $reg->getElementsByTagName("representantelegal");
                    if (!empty($reps)) {
                        foreach ($reps as $rep) {
                            $i++;
                            $retorno["replegal"][$i]["idtipoidentificacionreplegal"] = $rep->getElementsByTagName("idtipoidentificacionreplegal")->item(0)->textContent;
                            $retorno["replegal"][$i]["identificacionreplegal"] = ltrim($rep->getElementsByTagName("identificacionreplegal")->item(0)->textContent, "0");
                            $retorno["replegal"][$i]["nombrereplegal"] = (\funcionesSii2::restaurarEspeciales(trim($rep->getElementsByTagName("nombrereplegal")->item(0)->textContent)));
                            $retorno["replegal"][$i]["nombre1replegal"] = (\funcionesSii2::restaurarEspeciales(trim($rep->getElementsByTagName("nombre1replegal")->item(0)->textContent)));
                            $retorno["replegal"][$i]["nombre2replegal"] = (\funcionesSii2::restaurarEspeciales(trim($rep->getElementsByTagName("nombre2replegal")->item(0)->textContent)));
                            $retorno["replegal"][$i]["apellido1replegal"] = (\funcionesSii2::restaurarEspeciales(trim($rep->getElementsByTagName("apellido1replegal")->item(0)->textContent)));
                            $retorno["replegal"][$i]["apellido2replegal"] = (\funcionesSii2::restaurarEspeciales(trim($rep->getElementsByTagName("apellido2replegal")->item(0)->textContent)));
                            $retorno["replegal"][$i]["emailreplegal"] = '';
                            $retorno["replegal"][$i]["celularreplegal"] = '';
                            if (isset($rep->getElementsByTagName("emailreplegal")->item(0)->textContent)) {
                                $retorno["replegal"][$i]["emailreplegal"] = (\funcionesSii2::restaurarEspeciales(trim($rep->getElementsByTagName("emailreplegal")->item(0)->textContent)));
                            }
                            if (isset($rep->getElementsByTagName("celularreplegal")->item(0)->textContent)) {
                                $retorno["replegal"][$i]["celularreplegal"] = (\funcionesSii2::restaurarEspeciales(trim($rep->getElementsByTagName("emailreplegal")->item(0)->textContent)));
                            }
                            $retorno["replegal"][$i]["cargoreplegal"] = (\funcionesSii2::restaurarEspeciales(trim($rep->getElementsByTagName("cargoreplegal")->item(0)->textContent)));
                            $retorno["replegal"][$i]["vinculoreplegal"] = (\funcionesSii2::restaurarEspeciales(trim($rep->getElementsByTagName("vinculoreplegal")->item(0)->textContent)));
                            $retorno["replegal"][$i]["libroreplegal"] = (\funcionesSii2::restaurarEspeciales(trim($rep->getElementsByTagName("libroreplegal")->item(0)->textContent)));
                            $retorno["replegal"][$i]["inscripcionreplegal"] = (\funcionesSii2::restaurarEspeciales(trim($rep->getElementsByTagName("inscripcionreplegal")->item(0)->textContent)));
                            $retorno["replegal"][$i]["fechareplegal"] = (\funcionesSii2::restaurarEspeciales(trim($rep->getElementsByTagName("fechareplegal")->item(0)->textContent)));
                        }
                    }

                    unset($reps);
                    unset($rep);

                    // ***************************************************************************** //
                    // Socios, juntas directivas y organos directivos.
                    // ***************************************************************************** //
                    $retorno["vinculos"] = array();
                    $i = 0;
                    $socs = $reg->getElementsByTagName("vinculo");
                    if (!empty($socs)) {
                        foreach ($socs as $soc) {
                            if (isset($soc->getElementsByTagName("idtipoidentificacionotros")->item(0)->textContent)) {
                                $i++;
                                $retorno["vinculos"][$i]["idtipoidentificacionotros"] = $soc->getElementsByTagName("idtipoidentificacionotros")->item(0)->textContent;
                                $retorno["vinculos"][$i]["identificacionotros"] = ltrim($soc->getElementsByTagName("identificacionotros")->item(0)->textContent, "0");
                                $retorno["vinculos"][$i]["nombreotros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("nombreotros")->item(0)->textContent)));
                                $retorno["vinculos"][$i]["apellido1otros"] = '';
                                $retorno["vinculos"][$i]["apellido2otros"] = '';
                                $retorno["vinculos"][$i]["nombre1otros"] = '';
                                $retorno["vinculos"][$i]["nombre2otros"] = '';
                                $retorno["vinculos"][$i]["emailotros"] = '';
                                $retorno["vinculos"][$i]["celularotros"] = '';
                                $retorno["vinculos"][$i]["ciiu1"] = '';
                                $retorno["vinculos"][$i]["ciiu2"] = '';
                                $retorno["vinculos"][$i]["ciiu3"] = '';
                                $retorno["vinculos"][$i]["ciiu4"] = '';
                                $retorno["vinculos"][$i]["tipositcontrol"] = '';

                                if (isset($soc->getElementsByTagName("apellido1otros")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["apellido1otros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("apellido1otros")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("apellido2otros")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["apellido2otros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("apellido2otros")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("nombre1otros")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["nombre1otros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("nombre1otros")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("nombre2otros")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["nombre2otros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("nombre2otros")->item(0)->textContent)));
                                }

                                if (isset($soc->getElementsByTagName("emailotros")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["emailotros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("emailotros")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("celularotros")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["celularotros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("celularotros")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("idcarotros")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["idcargootros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("idcarotros")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("cargootros")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["cargootros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("cargootros")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("vinculootros")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["vinculootros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("vinculootros")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("cargootros")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["cargootros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("cargootros")->item(0)->textContent)));
                                }

                                if (isset($soc->getElementsByTagName("numtarpotros")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["numtarprofotros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("numtarpotros")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("idclaseemp")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["idclaseemp"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("idclaseemp")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("numidemp")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["numidemp"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("numidemp")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("idvindian")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["idvindian"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("idvindian")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("cuotasconst")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["cuotasconst"] = doubleval($soc->getElementsByTagName("cuotasconst")->item(0)->textContent);
                                }
                                if (isset($soc->getElementsByTagName("cuotasref")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["cuotasref"] = doubleval($soc->getElementsByTagName("cuotasref")->item(0)->textContent);
                                }
                                if (isset($soc->getElementsByTagName("valorconst")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["valorconst"] = doubleval($soc->getElementsByTagName("valorconst")->item(0)->textContent);
                                }
                                if (isset($soc->getElementsByTagName("valorref")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["valorref"] = doubleval($soc->getElementsByTagName("valorref")->item(0)->textContent);
                                }
                                if (isset($soc->getElementsByTagName("va1")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["va1"] = doubleval($soc->getElementsByTagName("va1")->item(0)->textContent);
                                }
                                if (isset($soc->getElementsByTagName("va2")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["va2"] = doubleval($soc->getElementsByTagName("va2")->item(0)->textContent);
                                }
                                if (isset($soc->getElementsByTagName("va3")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["va3"] = doubleval($soc->getElementsByTagName("va3")->item(0)->textContent);
                                }
                                if (isset($soc->getElementsByTagName("va4")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["va4"] = doubleval($soc->getElementsByTagName("va4")->item(0)->textContent);
                                }
                                if (isset($soc->getElementsByTagName("va5")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["va5"] = doubleval($soc->getElementsByTagName("va5")->item(0)->textContent);
                                }
                                if (isset($soc->getElementsByTagName("va6")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["va6"] = doubleval($soc->getElementsByTagName("va6")->item(0)->textContent);
                                }
                                if (isset($soc->getElementsByTagName("va7")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["va7"] = doubleval($soc->getElementsByTagName("va7")->item(0)->textContent);
                                }
                                if (isset($soc->getElementsByTagName("va8")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["va8"] = doubleval($soc->getElementsByTagName("va8")->item(0)->textContent);
                                }
                                if (isset($soc->getElementsByTagName("librootros")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["librootros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("librootros")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("inscripcionotros")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["inscripcionotros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("inscripcionotros")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("dupliotros")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["dupliotros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("dupliotros")->item(0)->textContent)));
                                } else {
                                    $retorno["vinculos"][$i]["dupliotros"] = '';
                                }

                                if (isset($soc->getElementsByTagName("fechaotros")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["fechaotros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("fechaotros")->item(0)->textContent)));
                                }

                                if (isset($soc->getElementsByTagName("ciiu1")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["ciiu1"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("ciiu1")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("ciiu2")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["ciiu2"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("ciiu2")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("ciiu3")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["ciiu3"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("ciiu3")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("ciiu4")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["ciiu4"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("ciiu4")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("tipositcontrol")->item(0)->textContent)) {
                                    $retorno["vinculos"][$i]["tipositcontrol"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("tipositcontrol")->item(0)->textContent)));
                                }

                                if (trim($retorno["vinculos"][$i]["ciiu1"]) != '') {
                                    if ((substr($retorno["vinculos"][$i]["ciiu1"], 0, 1) >= '0') && (substr($retorno["vinculos"][$i]["ciiu1"], 0, 1) <= '9')) {
                                        $retorno["vinculos"][$i]["ciiu1"] = \funcionesSii2::localizarLetraCiiu($retorno["vinculos"][$i]["ciiu1"]) . $retorno["vinculos"][$i]["ciiu1"];
                                    }
                                }
                                if (trim($retorno["vinculos"][$i]["ciiu2"]) != '') {
                                    if ((substr($retorno["vinculos"][$i]["ciiu2"], 0, 1) >= '0') && (substr($retorno["vinculos"][$i]["ciiu2"], 0, 1) <= '9')) {
                                        $retorno["vinculos"][$i]["ciiu2"] = \funcionesSii2::localizarLetraCiiu($retorno["vinculos"][$i]["ciiu2"]) . $retorno["vinculos"][$i]["ciiu2"];
                                    }
                                }
                                if (trim($retorno["vinculos"][$i]["ciiu3"]) != '') {
                                    if ((substr($retorno["vinculos"][$i]["ciiu3"], 0, 1) >= '0') && (substr($retorno["vinculos"][$i]["ciiu3"], 0, 1) <= '9')) {
                                        $retorno["vinculos"][$i]["ciiu3"] = \funcionesSii2::localizarLetraCiiu($retorno["vinculos"][$i]["ciiu3"]) . $retorno["vinculos"][$i]["ciiu3"];
                                    }
                                }
                                if (trim($retorno["vinculos"][$i]["ciiu4"]) != '') {
                                    if ((substr($retorno["vinculos"][$i]["ciiu4"], 0, 1) >= '0') && (substr($retorno["vinculos"][$i]["ciiu4"], 0, 1) <= '9')) {
                                        $retorno["vinculos"][$i]["ciiu4"] = \funcionesSii2::localizarLetraCiiu($retorno["vinculos"][$i]["ciiu4"]) . $retorno["vinculos"][$i]["ciiu4"];
                                    }
                                }
                            }
                        }
                    }
                    unset($socs);
                    unset($soc);

                    // ***************************************************************************** //
                    // Socios, juntas directivas y organos directivos - historicos
                    // ***************************************************************************** //
                    $retorno["vinculosh"] = array();
                    $i = 0;
                    $socs = $reg->getElementsByTagName("vinculoh");
                    if (!empty($socs)) {
                        foreach ($socs as $soc) {
                            if (isset($soc->getElementsByTagName("idtipoidentificacionotros")->item(0)->textContent)) {
                                $i++;
                                $retorno["vinculosh"][$i]["idtipoidentificacionotros"] = $soc->getElementsByTagName("idtipoidentificacionotros")->item(0)->textContent;
                                $retorno["vinculosh"][$i]["identificacionotros"] = ltrim($soc->getElementsByTagName("identificacionotros")->item(0)->textContent, "0");
                                $retorno["vinculosh"][$i]["nombreotros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("nombreotros")->item(0)->textContent)));
                                $retorno["vinculosh"][$i]["apellido1otros"] = '';
                                $retorno["vinculosh"][$i]["apellido2otros"] = '';
                                $retorno["vinculosh"][$i]["nombre1otros"] = '';
                                $retorno["vinculosh"][$i]["nombre2otros"] = '';
                                $retorno["vinculosh"][$i]["ciiu1"] = '';
                                $retorno["vinculosh"][$i]["ciiu2"] = '';
                                $retorno["vinculosh"][$i]["ciiu3"] = '';
                                $retorno["vinculosh"][$i]["ciiu4"] = '';
                                $retorno["vinculosh"][$i]["tipositcontrol"] = '';

                                if (isset($soc->getElementsByTagName("apellido1otros")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["apellido1otros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("apellido1otros")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("apellido2otros")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["apellido2otros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("apellido2otros")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("nombre1otros")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["nombre1otros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("nombre1otros")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("nombre2otros")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["nombre2otros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("nombre2otros")->item(0)->textContent)));
                                }

                                $retorno["vinculosh"][$i]["emailotros"] = '';
                                $retorno["vinculosh"][$i]["celularotros"] = '';
                                if (isset($soc->getElementsByTagName("emailotros")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["emailotros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("emailotros")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("celularotros")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["celularotros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("celularotros")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("idcarotros")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["idcargootros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("idcarotros")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("cargootros")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["cargootros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("cargootros")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("vinculootros")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["vinculootros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("vinculootros")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("cargootros")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["cargootros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("cargootros")->item(0)->textContent)));
                                }

                                if (isset($soc->getElementsByTagName("numtarpotros")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["numtarprofotros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("numtarpotros")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("idclaseemp")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["idclaseemp"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("idclaseemp")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("numidemp")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["numidemp"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("numidemp")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("idvindian")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["idvindian"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("idvindian")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("cuotasconst")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["cuotasconst"] = doubleval($soc->getElementsByTagName("cuotasconst")->item(0)->textContent);
                                }
                                if (isset($soc->getElementsByTagName("cuotasref")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["cuotasref"] = doubleval($soc->getElementsByTagName("cuotasref")->item(0)->textContent);
                                }
                                if (isset($soc->getElementsByTagName("valorconst")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["valorconst"] = doubleval($soc->getElementsByTagName("valorconst")->item(0)->textContent);
                                }
                                if (isset($soc->getElementsByTagName("valorref")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["valorref"] = doubleval($soc->getElementsByTagName("valorref")->item(0)->textContent);
                                }
                                if (isset($soc->getElementsByTagName("va1")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["va1"] = doubleval($soc->getElementsByTagName("va1")->item(0)->textContent);
                                }
                                if (isset($soc->getElementsByTagName("va2")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["va2"] = doubleval($soc->getElementsByTagName("va2")->item(0)->textContent);
                                }
                                if (isset($soc->getElementsByTagName("va3")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["va3"] = doubleval($soc->getElementsByTagName("va3")->item(0)->textContent);
                                }
                                if (isset($soc->getElementsByTagName("va4")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["va4"] = doubleval($soc->getElementsByTagName("va4")->item(0)->textContent);
                                }
                                if (isset($soc->getElementsByTagName("va5")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["va5"] = doubleval($soc->getElementsByTagName("va5")->item(0)->textContent);
                                }
                                if (isset($soc->getElementsByTagName("va6")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["va6"] = doubleval($soc->getElementsByTagName("va6")->item(0)->textContent);
                                }
                                if (isset($soc->getElementsByTagName("va7")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["va7"] = doubleval($soc->getElementsByTagName("va7")->item(0)->textContent);
                                }
                                if (isset($soc->getElementsByTagName("va8")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["va8"] = doubleval($soc->getElementsByTagName("va8")->item(0)->textContent);
                                }
                                if (isset($soc->getElementsByTagName("librootros")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["librootros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("librootros")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("inscripcionotros")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["inscripcionotros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("inscripcionotros")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("dupliotros")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["dupliotros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("dupliotros")->item(0)->textContent)));
                                }

                                if (isset($soc->getElementsByTagName("fechaotros")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["fechaotros"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("fechaotros")->item(0)->textContent)));
                                }

                                if (isset($soc->getElementsByTagName("ciiu1")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["ciiu1"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("ciiu1")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("ciiu2")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["ciiu2"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("ciiu2")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("ciiu3")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["ciiu3"] = (restaurarEspeciales(trim($soc->getElementsByTagName("ciiu3")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("ciiu4")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["ciiu4"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("ciiu4")->item(0)->textContent)));
                                }
                                if (isset($soc->getElementsByTagName("tipositcontrol")->item(0)->textContent)) {
                                    $retorno["vinculosh"][$i]["tipositcontrol"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("tipositcontrol")->item(0)->textContent)));
                                }

                                if (trim($retorno["vinculosh"][$i]["ciiu1"]) != '') {
                                    if ((substr($retorno["vinculosh"][$i]["ciiu1"], 0, 1) >= '0') && (substr($retorno["vinculosh"][$i]["ciiu1"], 0, 1) <= '9')) {
                                        $retorno["vinculosh"][$i]["ciiu1"] = \funcionesSii2::localizarLetraCiiu($retorno["vinculosh"][$i]["ciiu1"]) . $retorno["vinculosh"][$i]["ciiu1"];
                                    }
                                }
                                if (trim($retorno["vinculosh"][$i]["ciiu2"]) != '') {
                                    if ((substr($retorno["vinculosh"][$i]["ciiu2"], 0, 1) >= '0') && (substr($retorno["vinculosh"][$i]["ciiu2"], 0, 1) <= '9')) {
                                        $retorno["vinculosh"][$i]["ciiu2"] = \funcionesSii2::localizarLetraCiiu($retorno["vinculosh"][$i]["ciiu2"]) . $retorno["vinculosh"][$i]["ciiu2"];
                                    }
                                }
                                if (trim($retorno["vinculosh"][$i]["ciiu3"]) != '') {
                                    if ((substr($retorno["vinculosh"][$i]["ciiu3"], 0, 1) >= '0') && (substr($retorno["vinculosh"][$i]["ciiu3"], 0, 1) <= '9')) {
                                        $retorno["vinculosh"][$i]["ciiu3"] = \funcionesSii2::localizarLetraCiiu($retorno["vinculosh"][$i]["ciiu3"]) . $retorno["vinculosh"][$i]["ciiu3"];
                                    }
                                }
                                if (trim($retorno["vinculosh"][$i]["ciiu4"]) != '') {
                                    if ((substr($retorno["vinculosh"][$i]["ciiu4"], 0, 1) >= '0') && (substr($retorno["vinculosh"][$i]["ciiu4"], 0, 1) <= '9')) {
                                        $retorno["vinculosh"][$i]["ciiu4"] = \funcionesSii2::localizarLetraCiiu($retorno["vinculosh"][$i]["ciiu4"]) . $retorno["vinculosh"][$i]["ciiu4"];
                                    }
                                }
                            }
                        }
                    }
                    unset($socs);
                    unset($soc);

                    // ***************************************************************************** //
                    // Vinculos propietarios - de la sociedad propietaria
                    // ***************************************************************************** //
                    $retorno["vincuprop"] = array();
                    $i = 0;
                    $socs = $reg->getElementsByTagName("vp");
                    if (!empty($socs)) {
                        foreach ($socs as $soc) {
                            if (isset($soc->getElementsByTagName("vpidclase")->item(0)->textContent)) {
                                $i++;
                                $retorno["vincuprop"][$i]["idclase"] = $soc->getElementsByTagName("vpidclase")->item(0)->textContent;
                                $retorno["vincuprop"][$i]["numid"] = ltrim($soc->getElementsByTagName("vpnumid")->item(0)->textContent, "0");
                                $retorno["vincuprop"][$i]["nombre"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("vpnombre")->item(0)->textContent)));
                                $retorno["vincuprop"][$i]["vinculo"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("vpvinculo")->item(0)->textContent)));
                                $retorno["vincuprop"][$i]["cargo"] = (\funcionesSii2::restaurarEspeciales(trim($soc->getElementsByTagName("vpcargo")->item(0)->textContent)));
                            }
                        }
                    }
                    unset($socs);
                    unset($soc);

                    // ***************************************************************************** //
                    // Administrador
                    // ***************************************************************************** //
                    $retorno["idtipoidentificacionadministrador"] = $reg->getElementsByTagName("idtipoidentificacionadministrador")->item(0)->textContent;
                    $retorno["identificacionadministrador"] = $reg->getElementsByTagName("identificacionadministrador")->item(0)->textContent;
                    $retorno["nombreadministrador"] = (\funcionesSii2::restaurarEspeciales($reg->getElementsByTagName("nombreadministrador")->item(0)->textContent));

                    // ***************************************************************************** //
                    // propietarios
                    // ***************************************************************************** //
                    $retorno["propietarios"] = array();
                    $i = 0;
                    $j = 0;
                    $props = $reg->getElementsByTagName("propietario");
                    if (count($props) > 0) {
                        foreach ($props as $prop) {
                            $j++;
                            $incluir = 'si';
                            if ($j > 1) {
                                for ($x = 1; $x <= $i; $x++) {
                                    if ($retorno["propietarios"][$x]["identificacionpropietario"] == ltrim($prop->getElementsByTagName("identificacionpropietario")->item(0)->textContent, '0')) {
                                        $incluir = 'no';
                                    }
                                }
                            }
                            if ($incluir == 'si') {
                                $i++;
                                $retorno["propietarios"][$i]["camarapropietario"] = $prop->getElementsByTagName("camarapropietario")->item(0)->textContent;
                                $retorno["propietarios"][$i]["matriculapropietario"] = ltrim($prop->getElementsByTagName("matriculapropietario")->item(0)->textContent, '0');
                                $retorno["propietarios"][$i]["idtipoidentificacionpropietario"] = trim($prop->getElementsByTagName("idtipoidentificacionpropietario")->item(0)->textContent);
                                $retorno["propietarios"][$i]["identificacionpropietario"] = ltrim($prop->getElementsByTagName("identificacionpropietario")->item(0)->textContent, '0');
                                $retorno["propietarios"][$i]["nitpropietario"] = ltrim($prop->getElementsByTagName("nitpropietario")->item(0)->textContent, '0');
                                $retorno["propietarios"][$i]["nombrepropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("nombrepropietario")->item(0)->textContent));

                                //
                                (!isset($prop->getElementsByTagName("nom1propietario")->item(0)->textContent)) ? $retorno["propietarios"][$i]["nom1propietario"] = '' : $retorno["propietarios"][$i]["nom1propietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("nom1propietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("nom2propietario")->item(0)->textContent)) ? $retorno["propietarios"][$i]["nom2propietario"] = '' : $retorno["propietarios"][$i]["nom2propietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("nom2propietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("ape1propietario")->item(0)->textContent)) ? $retorno["propietarios"][$i]["ape1propietario"] = '' : $retorno["propietarios"][$i]["ape1propietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("ape1propietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("ape2propietario")->item(0)->textContent)) ? $retorno["propietarios"][$i]["ape2propietario"] = '' : $retorno["propietarios"][$i]["ape2propietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("ape2propietario")->item(0)->textContent));

                                //
                                (!isset($prop->getElementsByTagName("tipopropiedad")->item(0)->textContent)) ? $retorno["propietarios"][$i]["tipopropiedad"] = '0' : $retorno["propietarios"][$i]["tipopropiedad"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("tipopropiedad")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("direccionpropietario")->item(0)->textContent)) ? $retorno["propietarios"][$i]["direccionpropietario"] = '' : $retorno["propietarios"][$i]["direccionpropietario"] = (\funcionesSii2::restaurarEspeciales(str_replace("#", "Nro.", $prop->getElementsByTagName("direccionpropietario")->item(0)->textContent)));
                                (!isset($prop->getElementsByTagName("municipiopropietario")->item(0)->textContent)) ? $retorno["propietarios"][$i]["municipiopropietario"] = '' : $retorno["propietarios"][$i]["municipiopropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("municipiopropietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("direccionnotpropietario")->item(0)->textContent)) ? $retorno["propietarios"][$i]["direccionnotpropietario"] = '' : $retorno["propietarios"][$i]["direccionnotpropietario"] = (\funcionesSii2::restaurarEspeciales(str_replace("#", "Nro.", $prop->getElementsByTagName("direccionnotpropietario")->item(0)->textContent)));
                                (!isset($prop->getElementsByTagName("municipionotpropietario")->item(0)->textContent)) ? $retorno["propietarios"][$i]["municipionotpropietario"] = '' : $retorno["propietarios"][$i]["municipionotpropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("municipionotpropietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("telefonopropietario")->item(0)->textContent)) ? $retorno["propietarios"][$i]["telefonopropietario"] = '' : $retorno["propietarios"][$i]["telefonopropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("telefonopropietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("telefono2propietario")->item(0)->textContent)) ? $retorno["propietarios"][$i]["telefono2propietario"] = '' : $retorno["propietarios"][$i]["telefono2propietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("telefono2propietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("celularpropietario")->item(0)->textContent)) ? $retorno["propietarios"][$i]["celularpropietario"] = '' : $retorno["propietarios"][$i]["celularpropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("celularpropietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("nomreplegpropietario")->item(0)->textContent)) ? $retorno["propietarios"][$i]["nomreplegpropietario"] = '' : $retorno["propietarios"][$i]["nomreplegpropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("nomreplegpropietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("numidreplegpropietario")->item(0)->textContent)) ? $retorno["propietarios"][$i]["numidreplegpropietario"] = '' : $retorno["propietarios"][$i]["numidreplegpropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("numidreplegpropietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("tipoidreplegpropietario")->item(0)->textContent)) ? $retorno["propietarios"][$i]["tipoidreplegpropietario"] = '' : $retorno["propietarios"][$i]["tipoidreplegpropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("tipoidreplegpropietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("fecmatripropietario")->item(0)->textContent)) ? $retorno["propietarios"][$i]["fecmatripropietario"] = '' : $retorno["propietarios"][$i]["fecmatripropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("fecmatripropietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("fecrenovpropietario")->item(0)->textContent)) ? $retorno["propietarios"][$i]["fecrenovpropietario"] = '' : $retorno["propietarios"][$i]["fecrenovpropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("fecrenovpropietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("ultanorenpropietario")->item(0)->textContent)) ? $retorno["propietarios"][$i]["ultanorenpropietario"] = '' : $retorno["propietarios"][$i]["ultanorenpropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("ultanorenpropietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("organizacionpropietario")->item(0)->textContent)) ? $retorno["propietarios"][$i]["organizacionpropietario"] = '' : $retorno["propietarios"][$i]["organizacionpropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("organizacionpropietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("estadodatospropietario")->item(0)->textContent)) ? $retorno["propietarios"][$i]["estadodatospropietario"] = '' : $retorno["propietarios"][$i]["estadodatospropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("estadodatospropietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("estadomatriculapropietario")->item(0)->textContent)) ? $retorno["propietarios"][$i]["estadomatriculapropietario"] = '' : $retorno["propietarios"][$i]["estadomatriculapropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("estadomatriculapropietario")->item(0)->textContent));

                                //
                                (!isset($prop->getElementsByTagName("afiliacionpropietario")->item(0)->textContent)) ? $retorno["propietarios"][$i]["afiliacionpropietario"] = '' : $retorno["propietarios"][$i]["afiliacionpropietario"] = $prop->getElementsByTagName("afiliacionpropietario")->item(0)->textContent;
                                (!isset($prop->getElementsByTagName("ultanorenafipropietario")->item(0)->textContent)) ? $retorno["propietarios"][$i]["ultanorenafipropietario"] = '' : $retorno["propietarios"][$i]["ultanorenafipropietario"] = $prop->getElementsByTagName("ultanorenafipropietario")->item(0)->textContent;
                                (!isset($prop->getElementsByTagName("saldoafiliadopropietario")->item(0)->textContent)) ? $retorno["propietarios"][$i]["saldoafiliadopropietario"] = 0 : $retorno["propietarios"][$i]["saldoafiliadopropietario"] = doubleval($prop->getElementsByTagName("saldoafiliadopropietario")->item(0)->textContent);
                            }
                        }
                    } else {
                        $retorno["propietarios"] = array();
                    }
                    unset($props);

                    // ***************************************************************************** //
                    // propietarios historicos
                    // ***************************************************************************** //
                    $retorno["propietariosh"] = array();
                    $i = 0;
                    $j = 0;
                    $props = $reg->getElementsByTagName("propietarioh");
                    if (count($props) > 0) {
                        foreach ($props as $prop) {
                            $j++;
                            $incluir = 'si';
                            if ($j > 1) {
                                for ($x = 1; $x <= $i; $x++) {
                                    if ($retorno["propietariosh"][$x]["identificacionpropietario"] == ltrim($prop->getElementsByTagName("identificacionpropietario")->item(0)->textContent, '0')) {
                                        $incluir = 'no';
                                    }
                                }
                            }
                            if ($incluir == 'si') {
                                $i++;
                                $retorno["propietariosh"][$i]["camarapropietario"] = $prop->getElementsByTagName("camarapropietario")->item(0)->textContent;
                                $retorno["propietariosh"][$i]["matriculapropietario"] = ltrim($prop->getElementsByTagName("matriculapropietario")->item(0)->textContent, '0');
                                $retorno["propietariosh"][$i]["idtipoidentificacionpropietario"] = trim($prop->getElementsByTagName("idtipoidentificacionpropietario")->item(0)->textContent);
                                $retorno["propietariosh"][$i]["identificacionpropietario"] = ltrim($prop->getElementsByTagName("identificacionpropietario")->item(0)->textContent, '0');
                                $retorno["propietariosh"][$i]["nitpropietario"] = ltrim($prop->getElementsByTagName("nitpropietario")->item(0)->textContent, '0');
                                $retorno["propietariosh"][$i]["nombrepropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("nombrepropietario")->item(0)->textContent));

                                //
                                (!isset($prop->getElementsByTagName("nom1propietarioh")->item(0)->textContent)) ? $retorno["propietariosh"][$i]["nom1propietario"] = '' : $retorno["propietariosh"][$i]["nom1propietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("nom1propietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("nom2propietarioh")->item(0)->textContent)) ? $retorno["propietariosh"][$i]["nom2propietario"] = '' : $retorno["propietariosh"][$i]["nom2propietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("nom2propietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("ape1propietarioh")->item(0)->textContent)) ? $retorno["propietariosh"][$i]["ape1propietario"] = '' : $retorno["propietariosh"][$i]["ape1propietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("ape1propietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("ape2propietarioh")->item(0)->textContent)) ? $retorno["propietariosh"][$i]["ape2propietario"] = '' : $retorno["propietariosh"][$i]["ape2propietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("ape2propietario")->item(0)->textContent));

                                //
                                (!isset($prop->getElementsByTagName("tipopropiedadh")->item(0)->textContent)) ? $retorno["propietariosh"][$i]["tipopropiedad"] = '0' : $retorno["propietariosh"][$i]["tipopropiedad"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("tipopropiedad")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("direccionpropietarioh")->item(0)->textContent)) ? $retorno["propietariosh"][$i]["direccionpropietario"] = '' : $retorno["propietariosh"][$i]["direccionpropietario"] = (\funcionesSii2::restaurarEspeciales(str_replace("#", "Nro.", $prop->getElementsByTagName("direccionpropietario")->item(0)->textContent)));
                                (!isset($prop->getElementsByTagName("municipiopropietarioh")->item(0)->textContent)) ? $retorno["propietariosh"][$i]["municipiopropietario"] = '' : $retorno["propietariosh"][$i]["municipiopropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("municipiopropietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("direccionnotpropietarioh")->item(0)->textContent)) ? $retorno["propietariosh"][$i]["direccionnotpropietario"] = '' : $retorno["propietariosh"][$i]["direccionnotpropietario"] = (\funcionesSii2::restaurarEspeciales(str_replace("#", "Nro.", $prop->getElementsByTagName("direccionnotpropietario")->item(0)->textContent)));
                                (!isset($prop->getElementsByTagName("municipionotpropietarioh")->item(0)->textContent)) ? $retorno["propietariosh"][$i]["municipionotpropietario"] = '' : $retorno["propietariosh"][$i]["municipionotpropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("municipionotpropietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("telefonopropietarioh")->item(0)->textContent)) ? $retorno["propietariosh"][$i]["telefonopropietario"] = '' : $retorno["propietariosh"][$i]["telefonopropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("telefonopropietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("telefono2propietarioh")->item(0)->textContent)) ? $retorno["propietariosh"][$i]["telefono2propietario"] = '' : $retorno["propietariosh"][$i]["telefono2propietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("telefono2propietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("celularpropietarioh")->item(0)->textContent)) ? $retorno["propietariosh"][$i]["celularpropietario"] = '' : $retorno["propietariosh"][$i]["celularpropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("celularpropietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("nomreplegpropietarioh")->item(0)->textContent)) ? $retorno["propietariosh"][$i]["nomreplegpropietario"] = '' : $retorno["propietariosh"][$i]["nomreplegpropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("nomreplegpropietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("numidreplegpropietarioh")->item(0)->textContent)) ? $retorno["propietariosh"][$i]["numidreplegpropietario"] = '' : $retorno["propietariosh"][$i]["numidreplegpropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("numidreplegpropietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("tipoidreplegpropietarioh")->item(0)->textContent)) ? $retorno["propietariosh"][$i]["tipoidreplegpropietario"] = '' : $retorno["propietariosh"][$i]["tipoidreplegpropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("tipoidreplegpropietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("fecmatripropietarioh")->item(0)->textContent)) ? $retorno["propietariosh"][$i]["fecmatripropietario"] = '' : $retorno["propietariosh"][$i]["fecmatripropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("fecmatripropietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("fecrenovpropietarioh")->item(0)->textContent)) ? $retorno["propietariosh"][$i]["fecrenovpropietario"] = '' : $retorno["propietariosh"][$i]["fecrenovpropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("fecrenovpropietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("ultanorenpropietarioh")->item(0)->textContent)) ? $retorno["propietariosh"][$i]["ultanorenpropietario"] = '' : $retorno["propietariosh"][$i]["ultanorenpropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("ultanorenpropietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("organizacionpropietarioh")->item(0)->textContent)) ? $retorno["propietariosh"][$i]["organizacionpropietario"] = '' : $retorno["propietariosh"][$i]["organizacionpropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("organizacionpropietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("estadodatospropietarioh")->item(0)->textContent)) ? $retorno["propietariosh"][$i]["estadodatospropietario"] = '' : $retorno["propietariosh"][$i]["estadodatospropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("estadodatospropietario")->item(0)->textContent));
                                (!isset($prop->getElementsByTagName("estadomatriculapropietarioh")->item(0)->textContent)) ? $retorno["propietariosh"][$i]["estadomatriculapropietario"] = '' : $retorno["propietariosh"][$i]["estadomatriculapropietario"] = (\funcionesSii2::restaurarEspeciales($prop->getElementsByTagName("estadomatriculapropietario")->item(0)->textContent));

                                //
                                (!isset($prop->getElementsByTagName("afiliacionpropietarioh")->item(0)->textContent)) ? $retorno["propietariosh"][$i]["afiliacionpropietario"] = '' : $retorno["propietariosh"][$i]["afiliacionpropietario"] = $prop->getElementsByTagName("afiliacionpropietario")->item(0)->textContent;
                                (!isset($prop->getElementsByTagName("ultanorenafipropietarioh")->item(0)->textContent)) ? $retorno["propietariosh"][$i]["ultanorenafipropietario"] = '' : $retorno["propietariosh"][$i]["ultanorenafipropietario"] = $prop->getElementsByTagName("ultanorenafipropietario")->item(0)->textContent;
                                (!isset($prop->getElementsByTagName("saldoafiliadopropietarioh")->item(0)->textContent)) ? $retorno["propietariosh"][$i]["saldoafiliadopropietario"] = 0 : $retorno["propietariosh"][$i]["saldoafiliadopropietario"] = doubleval($prop->getElementsByTagName("saldoafiliadopropietario")->item(0)->textContent);
                            }
                        }
                    } else {
                        $retorno["propietariosh"] = array();
                    }
                    unset($props);

                    // ***************************************************************************** //
                    // establecimientos
                    // ***************************************************************************** //
                    $i = 0;
                    $retorno["establecimientos"] = array();
                    $ests = $reg->getElementsByTagName("establecimiento");
                    if (count($ests) > 0) {
                        foreach ($ests as $est) {
                            if (ltrim($est->getElementsByTagName("matriculaestablecimiento")->item(0)->textContent, '0') != '') {
                                if ($est->getElementsByTagName("estadomatricula")->item(0)->textContent == 'MA' ||
                                        $est->getElementsByTagName("estadomatricula")->item(0)->textContent == 'MI' ||
                                        $est->getElementsByTagName("estadomatricula")->item(0)->textContent == 'MR' ||
                                        $est->getElementsByTagName("estadomatricula")->item(0)->textContent == 'IA' ||
                                        $est->getElementsByTagName("estadomatricula")->item(0)->textContent == 'II') {
                                    $i++;
                                    $retorno["establecimientos"][$i]["matriculaestablecimiento"] = ltrim($est->getElementsByTagName("matriculaestablecimiento")->item(0)->textContent, '0');
                                    $retorno["establecimientos"][$i]["nombreestablecimiento"] = (\funcionesSii2::restaurarEspeciales($est->getElementsByTagName("nombreestablecimiento")->item(0)->textContent));
                                    $retorno["establecimientos"][$i]["estadodatosestablecimiento"] = \funcionesSii2::restaurarEspeciales($est->getElementsByTagName("estadodatosestablecimiento")->item(0)->textContent);
                                    $retorno["establecimientos"][$i]["estadomatricula"] = \funcionesSii2::restaurarEspeciales($est->getElementsByTagName("estadomatricula")->item(0)->textContent);
                                    $retorno["establecimientos"][$i]["dircom"] = \funcionesSii2::restaurarEspeciales($est->getElementsByTagName("dircom")->item(0)->textContent);
                                    $retorno["establecimientos"][$i]["telcom1"] = \funcionesSii2::restaurarEspeciales($est->getElementsByTagName("telcom1")->item(0)->textContent);
                                    $retorno["establecimientos"][$i]["telcom2"] = \funcionesSii2::restaurarEspeciales($est->getElementsByTagName("telcom2")->item(0)->textContent);
                                    $retorno["establecimientos"][$i]["telcom3"] = \funcionesSii2::restaurarEspeciales($est->getElementsByTagName("telcom3")->item(0)->textContent);
                                    $retorno["establecimientos"][$i]["muncom"] = \funcionesSii2::restaurarEspeciales($est->getElementsByTagName("muncom")->item(0)->textContent);
                                    $retorno["establecimientos"][$i]["emailcom"] = \funcionesSii2::restaurarEspeciales($est->getElementsByTagName("emailcom")->item(0)->textContent);
                                    $retorno["establecimientos"][$i]["fechamatricula"] = \funcionesSii2::restaurarEspeciales($est->getElementsByTagName("fechamatricula")->item(0)->textContent);
                                    $retorno["establecimientos"][$i]["fecharenovacion"] = \funcionesSii2::restaurarEspeciales($est->getElementsByTagName("fecharenovacion")->item(0)->textContent);

                                    $retorno["establecimientos"][$i]["ultanoren"] = '';
                                    $retorno["establecimientos"][$i]["ciiu1"] = '';
                                    $retorno["establecimientos"][$i]["ciiu2"] = '';
                                    $retorno["establecimientos"][$i]["ciiu3"] = '';
                                    $retorno["establecimientos"][$i]["ciiu4"] = '';
                                    $retorno["establecimientos"][$i]["embargado"] = '';
                                    $retorno["establecimientos"][$i]["actvin"] = 0;
                                    $retorno["establecimientos"][$i]["valest"] = 0;

                                    //
                                    if (isset($est->getElementsByTagName("ultanorenovado")->item(0)->textContent)) {
                                        $retorno["establecimientos"][$i]["ultanoren"] = \funcionesSii2::restaurarEspeciales($est->getElementsByTagName("ultanorenovado")->item(0)->textContent);
                                    }
                                    if (isset($est->getElementsByTagName("actvin")->item(0)->textContent)) {
                                        $retorno["establecimientos"][$i]["actvin"] = \funcionesSii2::restaurarEspeciales($est->getElementsByTagName("actvin")->item(0)->textContent);
                                        $retorno["establecimientos"][$i]["valest"] = \funcionesSii2::restaurarEspeciales($est->getElementsByTagName("actvin")->item(0)->textContent);
                                    }
                                    if (isset($est->getElementsByTagName("ciiu1")->item(0)->textContent)) {
                                        $retorno["establecimientos"][$i]["ciiu1"] = \funcionesSii2::restaurarEspeciales($est->getElementsByTagName("ciiu1")->item(0)->textContent);
                                    }
                                    if (isset($est->getElementsByTagName("ciiu2")->item(0)->textContent)) {
                                        $retorno["establecimientos"][$i]["ciiu2"] = \funcionesSii2::restaurarEspeciales($est->getElementsByTagName("ciiu2")->item(0)->textContent);
                                    }
                                    if (isset($est->getElementsByTagName("ciiu3")->item(0)->textContent)) {
                                        $retorno["establecimientos"][$i]["ciiu3"] = \funcionesSii2::restaurarEspeciales($est->getElementsByTagName("ciiu3")->item(0)->textContent);
                                    }
                                    if (isset($est->getElementsByTagName("ciiu4")->item(0)->textContent)) {
                                        $retorno["establecimientos"][$i]["ciiu4"] = \funcionesSii2::restaurarEspeciales($est->getElementsByTagName("ciiu4")->item(0)->textContent);
                                    }
                                    if (isset($est->getElementsByTagName("embargado")->item(0)->textContent)) {
                                        $retorno["establecimientos"][$i]["embargado"] = \funcionesSii2::restaurarEspeciales($est->getElementsByTagName("embargado")->item(0)->textContent);
                                    }
                                }
                            }
                        }
                    } else {
                        $retorno["establecimientos"] = array();
                    }
                    unset($ests);

                    // ***************************************************************************** //
                    // sucursales y agencias
                    // ***************************************************************************** //
                    $i = 0;
                    $sucs = $reg->getElementsByTagName("sucage");
                    if (count($sucs) > 0) {
                        foreach ($sucs as $suc) {
                            $i++;
                            $retorno["sucursalesagencias"][$i]["matriculasucage"] = ltrim($suc->getElementsByTagName("matriculasucage")->item(0)->textContent, '0');
                            $retorno["sucursalesagencias"][$i]["nombresucage"] = (\funcionesSii2::restaurarEspeciales($suc->getElementsByTagName("nombresucage")->item(0)->textContent));
                            $retorno["sucursalesagencias"][$i]["categoria"] = (\funcionesSii2::restaurarEspeciales($suc->getElementsByTagName("categoria")->item(0)->textContent));
                            $retorno["sucursalesagencias"][$i]["estado"] = (\funcionesSii2::restaurarEspeciales($suc->getElementsByTagName("estado")->item(0)->textContent));
                            $retorno["sucursalesagencias"][$i]["fechamatricula"] = (\funcionesSii2::restaurarEspeciales($suc->getElementsByTagName("fechamatricula")->item(0)->textContent));
                            $retorno["sucursalesagencias"][$i]["fecharenovacion"] = (\funcionesSii2::restaurarEspeciales($suc->getElementsByTagName("fecharenovacion")->item(0)->textContent));
                            $retorno["sucursalesagencias"][$i]["ultanoren"] = (\funcionesSii2::restaurarEspeciales($suc->getElementsByTagName("ultanorenovado")->item(0)->textContent));
                            $retorno["sucursalesagencias"][$i]["dircom"] = (\funcionesSii2::restaurarEspeciales($suc->getElementsByTagName("dircom")->item(0)->textContent));
                            $retorno["sucursalesagencias"][$i]["muncom"] = (\funcionesSii2::restaurarEspeciales($suc->getElementsByTagName("muncom")->item(0)->textContent));
                            $retorno["sucursalesagencias"][$i]["telcom1"] = (\funcionesSii2::restaurarEspeciales($suc->getElementsByTagName("telcom1")->item(0)->textContent));
                            $retorno["sucursalesagencias"][$i]["telcom2"] = (\funcionesSii2::restaurarEspeciales($suc->getElementsByTagName("telcom2")->item(0)->textContent));
                            $retorno["sucursalesagencias"][$i]["telcom3"] = (\funcionesSii2::restaurarEspeciales($suc->getElementsByTagName("telcom3")->item(0)->textContent));
                            $retorno["sucursalesagencias"][$i]["emailcom"] = (\funcionesSii2::restaurarEspeciales($suc->getElementsByTagName("emailcom")->item(0)->textContent));
                            $retorno["sucursalesagencias"][$i]["ciiu1"] = (\funcionesSii2::restaurarEspeciales($suc->getElementsByTagName("ciiu1")->item(0)->textContent));
                            $retorno["sucursalesagencias"][$i]["ciiu2"] = (\funcionesSii2::restaurarEspeciales($suc->getElementsByTagName("ciiu2")->item(0)->textContent));
                            $retorno["sucursalesagencias"][$i]["ciiu3"] = (\funcionesSii2::restaurarEspeciales($suc->getElementsByTagName("ciiu3")->item(0)->textContent));
                            $retorno["sucursalesagencias"][$i]["ciiu4"] = (\funcionesSii2::restaurarEspeciales($suc->getElementsByTagName("ciiu4")->item(0)->textContent));
                            $retorno["sucursalesagencias"][$i]["embargado"] = (\funcionesSii2::restaurarEspeciales($suc->getElementsByTagName("embargado")->item(0)->textContent));
                            $retorno["sucursalesagencias"][$i]["actvin"] = doubleval(\funcionesSii2::restaurarEspeciales($suc->getElementsByTagName("actvin")->item(0)->textContent));
                        }
                    } else {
                        $retorno["sucursalesagencias"] = array();
                    }
                    unset($sucs);

                    // ***************************************************************************** //
                    // reseña a casa principal
                    // ***************************************************************************** //
                    (!isset($reg->getElementsByTagName("cpcodcam")->item(0)->textContent)) ? $retorno["cpcodcam"] = '' : $retorno["cpcodcam"] = trim($reg->getElementsByTagName("cpcodcam")->item(0)->textContent);
                    (!isset($reg->getElementsByTagName("cpnummat")->item(0)->textContent)) ? $retorno["cpnummat"] = '' : $retorno["cpnummat"] = ltrim($reg->getElementsByTagName("cpnummat")->item(0)->textContent, "0");
                    (!isset($reg->getElementsByTagName("cprazsoc")->item(0)->textContent)) ? $retorno["cprazsoc"] = '' : $retorno["cprazsoc"] = (\funcionesSii2::restaurarEspeciales(trim($reg->getElementsByTagName("cprazsoc")->item(0)->textContent)));
                    (!isset($reg->getElementsByTagName("cpnumnit")->item(0)->textContent)) ? $retorno["cpnumnit"] = '' : $retorno["cpnumnit"] = ltrim($reg->getElementsByTagName("cpnumnit")->item(0)->textContent, "0");
                    (!isset($reg->getElementsByTagName("cpdircom")->item(0)->textContent)) ? $retorno["cpdircom"] = '' : $retorno["cpdircom"] = (\funcionesSii2::restaurarEspeciales(trim(str_replace("#", "Nro.", $reg->getElementsByTagName("cpdircom")->item(0)->textContent))));
                    (!isset($reg->getElementsByTagName("cpdirnot")->item(0)->textContent)) ? $retorno["cpdirnot"] = '' : $retorno["cpdirnot"] = (\funcionesSii2::restaurarEspeciales(trim(str_replace("#", "Nro.", $reg->getElementsByTagName("cpdirnot")->item(0)->textContent))));
                    (!isset($reg->getElementsByTagName("cpnumtel")->item(0)->textContent)) ? $retorno["cpnumtel"] = '' : $retorno["cpnumtel"] = ltrim($reg->getElementsByTagName("cpnumtel")->item(0)->textContent, "0");
                    (!isset($reg->getElementsByTagName("cpnumfax")->item(0)->textContent)) ? $retorno["cpnumfax"] = '' : $retorno["cpnumfax"] = ltrim($reg->getElementsByTagName("cpnumfax")->item(0)->textContent, "0");
                    (!isset($reg->getElementsByTagName("cpcodmun")->item(0)->textContent)) ? $retorno["cpcodmun"] = '' : $retorno["cpcodmun"] = trim($reg->getElementsByTagName("cpcodmun")->item(0)->textContent);
                    (!isset($reg->getElementsByTagName("cpmunnot")->item(0)->textContent)) ? $retorno["cpmunnot"] = '' : $retorno["cpmunnot"] = trim($reg->getElementsByTagName("cpmunnot")->item(0)->textContent);
                    (!isset($reg->getElementsByTagName("cpafili")->item(0)->textContent)) ? $retorno["cpafili"] = '' : $retorno["cpafili"] = trim($reg->getElementsByTagName("cpafili")->item(0)->textContent);
                    (!isset($reg->getElementsByTagName("cpsaldo")->item(0)->textContent)) ? $retorno["cpsaldo"] = '' : $retorno["cpsaldo"] = trim($reg->getElementsByTagName("cpsaldo")->item(0)->textContent);
                    (!isset($reg->getElementsByTagName("cpurenafi")->item(0)->textContent)) ? $retorno["cpurenafi"] = '' : $retorno["cpurenafi"] = trim($reg->getElementsByTagName("cpurenafi")->item(0)->textContent);


                    // ***************************************************************************** //
                    // Libros de comercio
                    // ***************************************************************************** //
                    $retorno["libroscomercio"] = array();
                    $i = 0;
                    $lc = $reg->getElementsByTagName("lc");
                    if (!empty($lc)) {
                        foreach ($lc as $l) {
                            $i++;
                            $retorno["libroscomercio"][$i]["lib"] = $l->getElementsByTagName("lib")->item(0)->textContent;
                            $retorno["libroscomercio"][$i]["nreg"] = ltrim($l->getElementsByTagName("nreg")->item(0)->textContent, "0");
                            $retorno["libroscomercio"][$i]["freg"] = $l->getElementsByTagName("freg")->item(0)->textContent;
                            $retorno["libroscomercio"][$i]["codl"] = $l->getElementsByTagName("codl")->item(0)->textContent;
                            $retorno["libroscomercio"][$i]["noml"] = trim($l->getElementsByTagName("noml")->item(0)->textContent);
                            $retorno["libroscomercio"][$i]["pini"] = $l->getElementsByTagName("pini")->item(0)->textContent;
                            $retorno["libroscomercio"][$i]["pfin"] = $l->getElementsByTagName("pfin")->item(0)->textContent;
                            $retorno["libroscomercio"][$i]["npag"] = $l->getElementsByTagName("npag")->item(0)->textContent;
                            $retorno["libroscomercio"][$i]["not"] = trim($l->getElementsByTagName("not")->item(0)->textContent);
                        }
                    }
                    unset($lc);
                    unset($l);

                    // ***************************************************************************** //
                    // Codigos de barras no terminados
                    // ***************************************************************************** //
                    $retorno["lcodigosbarras"] = array();
                    $i = 0;
                    if ($retorno["codigosbarras"] > 0) {
                        $cb = $reg->getElementsByTagName("cb");
                        if (!empty($cb)) {
                            foreach ($cb as $l) {
                                $i++;
                                $retorno["lcodigosbarras"][$i]["cbar"] = $l->getElementsByTagName("cbar")->item(0)->textContent;
                                $retorno["lcodigosbarras"][$i]["frad"] = $l->getElementsByTagName("frad")->item(0)->textContent;
                                $retorno["lcodigosbarras"][$i]["ttra"] = $l->getElementsByTagName("ttra")->item(0)->textContent;
                                $retorno["lcodigosbarras"][$i]["esta"] = $l->getElementsByTagName("esta")->item(0)->textContent;
                                $retorno["lcodigosbarras"][$i]["nesta"] = '';
                                $retorno["lcodigosbarras"][$i]["ntra"] = retornarRegistroMysqli2($dbx, 'mreg_codrutas', "id='" . $retorno["lcodigosbarras"][$i]["ttra"] . "'", "descripcion");
                                $retorno["lcodigosbarras"][$i]["sist"] = retornarRegistroMysqli2($dbx, 'mreg_codrutas', "id='" . $retorno["lcodigosbarras"][$i]["ttra"] . "'", "tipo");
                                if (($retorno["lcodigosbarras"][$i]["sist"] == 'ME') || ($retorno["lcodigosbarras"][$i]["sist"] == 'ES') ||
                                        ($retorno["lcodigosbarras"][$i]["sist"] == 'RM') || ($retorno["lcodigosbarras"][$i]["sist"] == 'RE')) {
                                    $retorno["lcodigosbarras"][$i]["nesta"] = retornarRegistroMysqli2($dbx, 'mreg_codestados_rutamercantil', "id='" . $retorno["lcodigosbarras"][$i]["esta"] . "'", "descripcion");
                                }
                                if ($retorno["lcodigosbarras"][$i]["sist"] == 'PR') {
                                    $retorno["lcodigosbarras"][$i]["nesta"] = retornarRegistroMysqli2($dbx, 'meweg_codestados_rutaproponentes', "id='" . $retorno["lcodigosbarras"][$i]["esta"] . "'", "descripcion");
                                }
                            }
                        }
                        unset($cb);
                        unset($l);
                    }

                    // ***************************************************************************** //
                    // Inscripciones en libros
                    // ***************************************************************************** //
                    $retorno["inscripciones"] = array();
                    $i = 0;
                    $li = $reg->getElementsByTagName("li");
                    if (!empty($li)) {
                        foreach ($li as $l) {
                            $i++;
                            if ($l->getElementsByTagName("lib")->item(0)->textContent < '50') {
                                $retorno["inscripciones"][$i]["lib"] = 'RM' . $l->getElementsByTagName("lib")->item(0)->textContent;
                            } else {
                                $retorno["inscripciones"][$i]["lib"] = 'RE' . $l->getElementsByTagName("lib")->item(0)->textContent;
                            }
                            $retorno["inscripciones"][$i]["nreg"] = ltrim($l->getElementsByTagName("nreg")->item(0)->textContent, "0");
                            if (isset($l->getElementsByTagName("dupli")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["dupli"] = $l->getElementsByTagName("dupli")->item(0)->textContent;
                            } else {
                                $retorno["inscripciones"][$i]["dupli"] = '';
                            }
                            if (isset($l->getElementsByTagName("freg")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["freg"] = $l->getElementsByTagName("freg")->item(0)->textContent;
                            } else {
                                $retorno["inscripciones"][$i]["freg"] = '';
                            }
                            if (isset($l->getElementsByTagName("hreg")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["hreg"] = $l->getElementsByTagName("hreg")->item(0)->textContent;
                            } else {
                                $retorno["inscripciones"][$i]["hreg"] = '';
                            }
                            if (isset($l->getElementsByTagName("frad")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["frad"] = $l->getElementsByTagName("frad")->item(0)->textContent;
                            } else {
                                $retorno["inscripciones"][$i]["frad"] = '';
                            }
                            if (isset($l->getElementsByTagName("acto")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["acto"] = $l->getElementsByTagName("acto")->item(0)->textContent;
                            } else {
                                $retorno["inscripciones"][$i]["acto"] = '';
                            }
                            if (isset($l->getElementsByTagName("idclase")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["idclase"] = $l->getElementsByTagName("idclase")->item(0)->textContent;
                            } else {
                                $retorno["inscripciones"][$i]["idclase"] = '';
                            }
                            if (isset($l->getElementsByTagName("numid")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["numid"] = ltrim($l->getElementsByTagName("numid")->item(0)->textContent, "0");
                            } else {
                                $retorno["inscripciones"][$i]["numid"] = '';
                            }
                            if (isset($l->getElementsByTagName("ndocext")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["ndocext"] = ltrim($l->getElementsByTagName("ndocext")->item(0)->textContent, "0");
                            } else {
                                $retorno["inscripciones"][$i]["ndocext"] = '';
                            }
                            if (isset($l->getElementsByTagName("ndoc")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["ndoc"] = ltrim($l->getElementsByTagName("ndoc")->item(0)->textContent, "0");
                            } else {
                                $retorno["inscripciones"][$i]["ndoc"] = '';
                            }
                            if (isset($l->getElementsByTagName("tdoc")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["tdoc"] = $l->getElementsByTagName("tdoc")->item(0)->textContent;
                            } else {
                                $retorno["inscripciones"][$i]["tdoc"] = '';
                            }
                            if (isset($l->getElementsByTagName("fdoc")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["fdoc"] = $l->getElementsByTagName("fdoc")->item(0)->textContent;
                            } else {
                                $retorno["inscripciones"][$i]["fdoc"] = '';
                            }
                            if (isset($l->getElementsByTagName("idoridoc")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["idoridoc"] = $l->getElementsByTagName("idoridoc")->item(0)->textContent;
                            } else {
                                $retorno["inscripciones"][$i]["idoridoc"] = '';
                            }
                            if (isset($l->getElementsByTagName("txoridoc")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["txoridoc"] = trim($l->getElementsByTagName("txoridoc")->item(0)->textContent);
                            } else {
                                $retorno["inscripciones"][$i]["txoridoc"] = '';
                            }
                            if (isset($l->getElementsByTagName("idmundoc")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["idmundoc"] = $l->getElementsByTagName("idmundoc")->item(0)->textContent;
                            } else {
                                $retorno["inscripciones"][$i]["idmundoc"] = '';
                            }
                            if (isset($l->getElementsByTagName("idpaidoc")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["idpaidoc"] = $l->getElementsByTagName("idpaidoc")->item(0)->textContent;
                            } else {
                                $retorno["inscripciones"][$i]["idpaidoc"] = '';
                            }
                            if (isset($l->getElementsByTagName("idlibvii")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["idlibvii"] = $l->getElementsByTagName("idlibvii")->item(0)->textContent;
                            } else {
                                $retorno["inscripciones"][$i]["idlibvii"] = '';
                            }
                            if (isset($l->getElementsByTagName("codlibcom")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["codlibcom"] = $l->getElementsByTagName("codlibcom")->item(0)->textContent;
                            } else {
                                $retorno["inscripciones"][$i]["codlibcom"] = '';
                            }
                            if (isset($l->getElementsByTagName("numhojas")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["numhojas"] = $l->getElementsByTagName("numhojas")->item(0)->textContent;
                            } else {
                                $retorno["inscripciones"][$i]["numhojas"] = '';
                            }
                            if (isset($l->getElementsByTagName("not")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["not"] = trim($l->getElementsByTagName("not")->item(0)->textContent);
                            } else {
                                $retorno["inscripciones"][$i]["not"] = '';
                            }
                            if (isset($l->getElementsByTagName("not2")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["not2"] = trim($l->getElementsByTagName("not2")->item(0)->textContent);
                            } else {
                                $retorno["inscripciones"][$i]["not2"] = '';
                            }
                            if (isset($l->getElementsByTagName("not3")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["not3"] = trim($l->getElementsByTagName("not3")->item(0)->textContent);
                            } else {
                                $retorno["inscripciones"][$i]["not3"] = '';
                            }
                            if (isset($l->getElementsByTagName("crecu")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["crecu"] = $l->getElementsByTagName("crecu")->item(0)->textContent;
                            } else {
                                $retorno["inscripciones"][$i]["crecu"] = '';
                            }
                            if (isset($l->getElementsByTagName("cimg")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["cimg"] = $l->getElementsByTagName("cimg")->item(0)->textContent;
                            } else {
                                $retorno["inscripciones"][$i]["cimg"] = '';
                            }
                            if (isset($l->getElementsByTagName("cver")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["cver"] = $l->getElementsByTagName("cver")->item(0)->textContent;
                            } else {
                                $retorno["inscripciones"][$i]["cver"] = '';
                            }
                            if (isset($l->getElementsByTagName("crot")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["crot"] = $l->getElementsByTagName("crot")->item(0)->textContent;
                            } else {
                                $retorno["inscripciones"][$i]["crot"] = '';
                            }
                            if (isset($l->getElementsByTagName("crev")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["crev"] = $l->getElementsByTagName("crev")->item(0)->textContent;
                            } else {
                                $retorno["inscripciones"][$i]["crev"] = '';
                            }
                            if (isset($l->getElementsByTagName("cnat")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["cnat"] = $l->getElementsByTagName("cnat")->item(0)->textContent;
                            } else {
                                $retorno["inscripciones"][$i]["cnat"] = '';
                            }
                            if (isset($l->getElementsByTagName("regrev")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["regrev"] = $l->getElementsByTagName("regrev")->item(0)->textContent;
                            } else {
                                $retorno["inscripciones"][$i]["regrev"] = '';
                            }
                            if (isset($l->getElementsByTagName("fir")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["fir"] = $l->getElementsByTagName("fir")->item(0)->textContent;
                            } else {
                                $retorno["inscripciones"][$i]["fir"] = '';
                            }
                            if (isset($l->getElementsByTagName("cfir")->item(0)->textContent)) {
                                $retorno["inscripciones"][$i]["cfir"] = $l->getElementsByTagName("cfir")->item(0)->textContent;
                            } else {
                                $retorno["inscripciones"][$i]["cfir"] = '';
                            }
                            if ($retorno["inscripciones"][$i]["not"] == '') {
                                $retorno["inscripciones"][$i]["not"] = retornarRegistroMysqli2($dbx, 'mreg_actos', "idlibro='" . $retorno["inscripciones"][$i]["lib"] . "' and idacto='", $retorno["inscripciones"][$i]["acto"] . "'", "nombre");
                            }
                        }
                    }
                    unset($li);
                    unset($l);

                    // ***************************************************************************** //
                    // Nombres anteriores
                    // ***************************************************************************** //
                    $retorno["nomant"] = array();
                    $i = 0;
                    $li = $reg->getElementsByTagName("na");
                    if (!empty($li)) {
                        foreach ($li as $l) {
                            $i++;
                            $retorno["nomant"][$i]["sec"] = sprintf("%03s", $l->getElementsByTagName("sec")->item(0)->textContent);
                            $retorno["nomant"][$i]["lib"] = $l->getElementsByTagName("lib")->item(0)->textContent;
                            $retorno["nomant"][$i]["nreg"] = ltrim($l->getElementsByTagName("nreg")->item(0)->textContent, "0");
                            $retorno["nomant"][$i]["freg"] = ltrim($l->getElementsByTagName("freg")->item(0)->textContent, "0");
                            $retorno["nomant"][$i]["nom"] = trim($l->getElementsByTagName("nom")->item(0)->textContent);
                            $retorno["nomant"][$i]["ope"] = '';
                            $retorno["nomant"][$i]["fcre"] = '';
                            if (isset($l->getElementsByTagName("ope")->item(0)->textContent)) {
                                $retorno["nomant"][$i]["ope"] = trim($l->getElementsByTagName("ope")->item(0)->textContent);
                            }
                            if (isset($l->getElementsByTagName("fcre")->item(0)->textContent)) {
                                $retorno["nomant"][$i]["fcre"] = trim($l->getElementsByTagName("fcre")->item(0)->textContent);
                            }
                        }
                    }
                    unset($li);
                    unset($l);


                    //
                    $retorno["codigoscae"] = array();
                    $arrY = retornarRegistrosMysqli2($dbx, 'mreg_anexoscae', "1=1", "codigocae");
                    if ($arrY && !empty($arrY)) {
                        foreach ($arrY as $y) {
                            $retorno["codigoscae"][$y["codigocae"]] = '';
                            if (!empty($reg->getElementsByTagName($y["codigocae"])->item(0)->textContent)) {
                                $retorno["codigoscae"][$y["codigocae"]] = trim($reg->getElementsByTagName($y["codigocae"])->item(0)->textContent);
                            }
                        }
                    }

                    //
                    $retorno["informacionadicional"] = array();
                    $arrY = retornarRegistrosMysqli2($dbx, 'mreg_campos_adicionales_camara', "1=1", "orden");
                    if ($arrY && !empty($arrY)) {
                        foreach ($arrY as $y) {
                            $retorno["informacionadicional"][$y["codigoadicional"]] = '';
                            if (!empty($reg->getElementsByTagName($y["codigoadicional"])->item(0)->textContent)) {
                                $retorno["informacionadicional"][$y["codigoadicional"]] = trim($reg->getElementsByTagName($y["codigoadicional"])->item(0)->textContent);
                            }
                        }
                    }

                    // ***************************************************************************** //
                    // Certificas
                    // ***************************************************************************** //
                    $retorno["crt"] = array();
                    $crtant = '';
                    $crt = $reg->getElementsByTagName("ce");
                    if (!empty($crt)) {
                        foreach ($crt as $l) {
                            $crtant = $l->getElementsByTagName("cd")->item(0)->textContent;
                            if (!isset($retorno["crt"][$crtant])) {
                                $retorno["crt"][$crtant] = '';
                            }
                            if ($retorno["crt"][$crtant] != '') {
                                $retorno["crt"][$crtant] .= '|';
                            }
                            $retorno["crt"][$crtant] .= trim($l->getElementsByTagName("tx")->item(0)->textContent);
                        }
                    }
                    unset($crt);
                    unset($l);

                    // ***************************************************************************** //
                    // Certificas SII
                    // ***************************************************************************** //
                    $retorno["crtsii"] = array();


                    // ***************************************************************************** //
                    // Embargos
                    // ***************************************************************************** //
                    $retorno["ctrembargos"] = array();
                    $emb = $reg->getElementsByTagName("emb");
                    $i = 0;
                    if (!empty($emb)) {
                        foreach ($emb as $e) {
                            $i++;
                            $retorno["ctrembargos"][$i] = array();
                            $retorno["ctrembargos"][$i]["acto"] = $e->getElementsByTagName("acto")->item(0)->textContent;
                            $retorno["ctrembargos"][$i]["idclase"] = $e->getElementsByTagName("idclase")->item(0)->textContent;
                            $retorno["ctrembargos"][$i]["numid"] = ltrim($e->getElementsByTagName("numid")->item(0)->textContent, "0");
                            $retorno["ctrembargos"][$i]["nombre"] = trim($e->getElementsByTagName("nombre")->item(0)->textContent);
                            $retorno["ctrembargos"][$i]["idclasedemandante"] = '';
                            $retorno["ctrembargos"][$i]["numiddemandante"] = '';
                            $retorno["ctrembargos"][$i]["nombredemandante"] = '';
                            $retorno["ctrembargos"][$i]["tipdoc"] = trim($e->getElementsByTagName("tipdoc")->item(0)->textContent);
                            $retorno["ctrembargos"][$i]["numdoc"] = ltrim($e->getElementsByTagName("numdoc")->item(0)->textContent, "0");
                            $retorno["ctrembargos"][$i]["fecdoc"] = trim($e->getElementsByTagName("fecdoc")->item(0)->textContent);
                            $retorno["ctrembargos"][$i]["idorigen"] = trim($e->getElementsByTagName("idorigen")->item(0)->textContent);
                            $retorno["ctrembargos"][$i]["txtorigen"] = trim($e->getElementsByTagName("txtorigen")->item(0)->textContent);
                            $retorno["ctrembargos"][$i]["fecrad"] = trim($e->getElementsByTagName("fecrad")->item(0)->textContent);
                            $retorno["ctrembargos"][$i]["estado"] = trim($e->getElementsByTagName("estado")->item(0)->textContent);
                            $retorno["ctrembargos"][$i]["libro"] = '';
                            if (isset($e->getElementsByTagName("idlibro")->item(0)->textContent)) {
                                if (trim($e->getElementsByTagName("idlibro")->item(0)->textContent) < '50') {
                                    $retorno["ctrembargos"][$i]["libro"] = 'RM' . trim($e->getElementsByTagName("idlibro")->item(0)->textContent);
                                } else {
                                    $retorno["ctrembargos"][$i]["libro"] = 'RE' . trim($e->getElementsByTagName("idlibro")->item(0)->textContent);
                                }
                            }
                            $retorno["ctrembargos"][$i]["numreg"] = ltrim($e->getElementsByTagName("numreg")->item(0)->textContent, "0");
                            $retorno["ctrembargos"][$i]["codbarras"] = ltrim($e->getElementsByTagName("codbarras")->item(0)->textContent, "0");
                            $retorno["ctrembargos"][$i]["noticia"] = ltrim($e->getElementsByTagName("noticia")->item(0)->textContent, "0");
                            $retorno["ctrembargos"][$i]["fecinscripcion"] = $e->getElementsByTagName("fecinscripcion")->item(0)->textContent;
                        }
                    }
                    unset($emb);
                    unset($e);
                }
            }
            unset($reg);
            unset($reg1);
            unset($dom);
        }
        return $retorno;
    }

    function desserializarExpedienteProponente($dbx, $xml, $codigoempresa = '', $controlprimeravez = 'no', $proceso = 'llamado directo a desserializarExpedienteProponente', $tipotramite = '') {
        $retorno = array();

        // Datos del tramite
        $retorno["tipotramite"] = '';
        $retorno["numerorecuperacion"] = '';
        $retorno["numeroliquidacion"] = '';

        // Datos de Identificacion del expediente
        $retorno["proponente"] = '';
        $retorno["matricula"] = '';
        $retorno["fecmatricula"] = '';
        $retorno["nombre"] = '';
        $retorno["ape1"] = '';
        $retorno["ape2"] = '';
        $retorno["nom1"] = '';
        $retorno["nom2"] = '';
        $retorno["sigla"] = '';
        $retorno["tipoidentificacion"] = '';
        $retorno["categoria"] = '';

        $retorno["identificacion"] = '';
        $retorno["idpaisidentificacion"] = '';
        $retorno["nit"] = '';
        $retorno["nacionalidad"] = '';
        $retorno["organizacion"] = '';
        $retorno["tamanoempresa"] = '';
        $retorno["emprendedor28"] = '';
        $retorno["pemprendedor28"] = 0;
        $retorno["vigcontrol"] = '';

        // Datos de cambio de domicilio
        $retorno["cambidom_idmunicipioorigen"] = '';
        $retorno["cambidom_idmunicipiodestino"] = '';
        $retorno["cambidom_fechaultimainscripcion"] = '';
        $retorno["cambidom_fechaultimarenovacion"] = '';
        $retorno["propcamaraorigen"] = '';
        $retorno["propcamaradestino"] = '';

        // Datos de catalogacion del registro
        $retorno["idestadoproponente"] = '';
        $retorno["certificardesde"] = '';
        $retorno["fechaultimainscripcion"] = '';
        $retorno["fechaultimarenovacion"] = '';
        $retorno["fechaultimaactualizacion"] = '';
        $retorno["fechacancelacion"] = '';
        $retorno["idtipodocperjur"] = '';
        $retorno["numdocperjur"] = '';
        $retorno["fecdocperjur"] = '';
        $retorno["origendocperjur"] = '';
        $retorno["fechaconstitucion"] = '';
        $retorno["fechavencimiento"] = '';

        // informacion de ubicacion comercial en el registro mercantil
        $retorno["dircom"] = '';
        $retorno["dircom_tipovia"] = '';
        $retorno["dircom_numvia"] = '';
        $retorno["dircom_apevia"] = '';
        $retorno["dircom_orivia"] = '';
        $retorno["dircom_numcruce"] = '';
        $retorno["dircom_apecruce"] = '';
        $retorno["dircom_oricruce"] = '';
        $retorno["dircom_numplaca"] = '';
        $retorno["dircom_complemento"] = '';
        $retorno["muncom"] = '';
        $retorno["telcom1"] = '';
        $retorno["telcom2"] = '';
        $retorno["faxcom"] = '';
        $retorno["celcom"] = '';
        $retorno["telcomant1"] = '';
        $retorno["telcomant2"] = '';
        $retorno["telcomant3"] = '';
        $retorno["emailcom"] = '';
        $retorno["emailcomant"] = '';
        $retorno["enviarint"] = '';

        // informacion de ubicacion de notificacion
        $retorno["dirnot"] = '';
        $retorno["dirnot_tipovia"] = '';
        $retorno["dirnot_numvia"] = '';
        $retorno["dirnot_apevia"] = '';
        $retorno["dirnot_orivia"] = '';
        $retorno["dirnot_numcruce"] = '';
        $retorno["dirnot_apecruce"] = '';
        $retorno["dirnot_oricruce"] = '';
        $retorno["dirnot_numplaca"] = '';
        $retorno["dirnot_complemento"] = '';
        $retorno["munnot"] = '';
        $retorno["telnot"] = '';
        $retorno["telnot2"] = '';
        $retorno["faxnot"] = '';
        $retorno["celnot"] = '';
        $retorno["telnotant1"] = '';
        $retorno["telnotant2"] = '';
        $retorno["telnotant3"] = '';
        $retorno["emailnot"] = '';
        $retorno["emailnotant"] = '';
        $retorno["enviarnot"] = '';

        // representacion legal   
        $retorno["representanteslegales"] = array();
        $retorno["facultades"] = '';
        $retorno["crt0041"] = '';
        $retorno["crt1121"] = '';

        // Situaciones de control
        $retorno["sitcontrol"] = array();

        // Informacion financiera decreto 1510
        $retorno["inffin1510_fechacorte"] = '';
        $retorno["inffin1510_actcte"] = 0;
        $retorno["inffin1510_actnocte"] = 0;
        $retorno["inffin1510_fijnet"] = 0;
        $retorno["inffin1510_actotr"] = 0;
        $retorno["inffin1510_actval"] = 0;
        $retorno["inffin1510_acttot"] = 0;

        $retorno["inffin1510_pascte"] = 0;
        $retorno["inffin1510_paslar"] = 0;
        $retorno["inffin1510_pastot"] = 0;
        $retorno["inffin1510_patnet"] = 0;
        $retorno["inffin1510_paspat"] = 0;
        $retorno["inffin1510_balsoc"] = 0;

        $retorno["inffin1510_ingope"] = 0;
        $retorno["inffin1510_ingnoope"] = 0;
        $retorno["inffin1510_gasope"] = 0;
        $retorno["inffin1510_gasnoope"] = 0;
        $retorno["inffin1510_cosven"] = 0;
        $retorno["inffin1510_utinet"] = 0;
        $retorno["inffin1510_utiope"] = 0;
        $retorno["inffin1510_gasint"] = 0;
        $retorno["inffin1510_gasimp"] = 0;

        $retorno["inffin1510_indliq"] = 0;
        $retorno["inffin1510_nivend"] = 0;
        $retorno["inffin1510_razcob"] = 0;
        $retorno["inffin1510_renpat"] = 0;
        $retorno["inffin1510_renact"] = 0;
        $retorno["inffin1510_gruponiif"] = '';

        // Contratos ejecutados 1510
        $retorno["exp1510"] = array();

        // Clasificaciones 1510
        $retorno["clasi1510"] = array();
        $retorno["clasitem1510"] = array();

        // Bienes
        $retorno["bienes"] = array();

        // Contratos mults y sanciones de Entidades del Estado
        $retorno["contratos"] = array();
        $retorno["multas"] = array();
        $retorno["sanciones"] = array();
        $retorno["sandis"] = array();
        $retorno["inscripciones"] = array();

        // Datos del proponente que están en firme
        if ($tipotramite == 'enfirme') {
            $enfirme = 'enfirme';
            $retorno[$enfirme] = array();
            $retorno[$enfirme]["proponente"] = '';
            $retorno[$enfirme]["matricula"] = '';
            $retorno[$enfirme]["nombre"] = '';
            $retorno[$enfirme]["ape1"] = '';
            $retorno[$enfirme]["ape2"] = '';
            $retorno[$enfirme]["nom1"] = '';
            $retorno[$enfirme]["nom2"] = '';
            $retorno[$enfirme]["sigla"] = '';
            $retorno[$enfirme]["tipoidentificacion"] = '';
            $retorno[$enfirme]["categoria"] = '';

            $retorno[$enfirme]["identificacion"] = '';
            $retorno[$enfirme]["idpaisidentificacion"] = '';
            $retorno[$enfirme]["nit"] = '';
            $retorno[$enfirme]["nacionalidad"] = '';
            $retorno[$enfirme]["organizacion"] = '';
            $retorno[$enfirme]["tamanoempresa"] = '';
            $retorno[$enfirme]["emprendedor28"] = '';
            $retorno[$enfirme]["pemprendedor28"] = 0;
            $retorno[$enfirme]["vigcontrol"] = '';

            // Datos de cambio de domicilio
            $retorno[$enfirme]["cambidom_idmunicipioorigen"] = '';
            $retorno[$enfirme]["cambidom_idmunicipiodestino"] = '';
            $retorno[$enfirme]["cambidom_fechaultimainscripcion"] = '';
            $retorno[$enfirme]["cambidom_fechaultimarenovacion"] = '';
            $retorno[$enfirme]["propcamaraorigen"] = '';
            $retorno[$enfirme]["propcamaradestino"] = '';

            // Datos de catalogacion del registro
            $retorno[$enfirme]["idestadoproponente"] = '';
            $retorno[$enfirme]["fechaultimainscripcion"] = '';
            $retorno[$enfirme]["fechaultimarenovacion"] = '';
            $retorno[$enfirme]["fechaultimaactualizacion"] = '';
            $retorno[$enfirme]["fechacancelacion"] = '';
            $retorno[$enfirme]["idtipodocperjur"] = '';
            $retorno[$enfirme]["numdocperjur"] = '';
            $retorno[$enfirme]["fecdocperjur"] = '';
            $retorno[$enfirme]["origendocperjur"] = '';
            $retorno[$enfirme]["fechaconstitucion"] = '';
            $retorno[$enfirme]["fechavencimiento"] = '';

            // informacion de ubicacion comercial en el registro mercantil
            $retorno[$enfirme]["dircom"] = '';
            $retorno[$enfirme]["dircom_tipovia"] = '';
            $retorno[$enfirme]["dircom_numvia"] = '';
            $retorno[$enfirme]["dircom_apevia"] = '';
            $retorno[$enfirme]["dircom_orivia"] = '';
            $retorno[$enfirme]["dircom_numcruce"] = '';
            $retorno[$enfirme]["dircom_apecruce"] = '';
            $retorno[$enfirme]["dircom_oricruce"] = '';
            $retorno[$enfirme]["dircom_numplaca"] = '';
            $retorno[$enfirme]["dircom_complemento"] = '';
            $retorno[$enfirme]["muncom"] = '';
            $retorno[$enfirme]["telcom1"] = '';
            $retorno[$enfirme]["telcom2"] = '';
            $retorno[$enfirme]["faxcom"] = '';
            $retorno[$enfirme]["celcom"] = '';
            $retorno[$enfirme]["telcomant1"] = '';
            $retorno[$enfirme]["telcomant2"] = '';
            $retorno[$enfirme]["telcomant3"] = '';
            $retorno[$enfirme]["emailcom"] = '';
            $retorno[$enfirme]["emailcomant"] = '';
            $retorno[$enfirme]["enviarint"] = '';

            // informacion de ubicacion de notificacion
            $retorno[$enfirme]["dirnot"] = '';
            $retorno[$enfirme]["dirnot_tipovia"] = '';
            $retorno[$enfirme]["dirnot_numvia"] = '';
            $retorno[$enfirme]["dirnot_apevia"] = '';
            $retorno[$enfirme]["dirnot_orivia"] = '';
            $retorno[$enfirme]["dirnot_numcruce"] = '';
            $retorno[$enfirme]["dirnot_apecruce"] = '';
            $retorno[$enfirme]["dirnot_oricruce"] = '';
            $retorno[$enfirme]["dirnot_numplaca"] = '';
            $retorno[$enfirme]["dirnot_complemento"] = '';
            $retorno[$enfirme]["munnot"] = '';
            $retorno[$enfirme]["telnot"] = '';
            $retorno[$enfirme]["telnot2"] = '';
            $retorno[$enfirme]["faxnot"] = '';
            $retorno[$enfirme]["celnot"] = '';
            $retorno[$enfirme]["telnotant1"] = '';
            $retorno[$enfirme]["telnotant2"] = '';
            $retorno[$enfirme]["telnotant3"] = '';
            $retorno[$enfirme]["emailnot"] = '';
            $retorno[$enfirme]["emailnotant"] = '';
            $retorno[$enfirme]["enviarnot"] = '';

            // representacion legal   
            $retorno[$enfirme]["representanteslegales"] = array();
            $retorno[$enfirme]["facultades"] = '';

            // Situaciones de control
            $retorno[$enfirme]["sitcontrol"] = array();

            // Informacion financiera decreto 1510
            $retorno[$enfirme]["inffin1510_fechacorte"] = '';
            $retorno[$enfirme]["inffin1510_actcte"] = 0;
            $retorno[$enfirme]["inffin1510_actnocte"] = 0;
            $retorno[$enfirme]["inffin1510_fijnet"] = 0;
            $retorno[$enfirme]["inffin1510_actotr"] = 0;
            $retorno[$enfirme]["inffin1510_actval"] = 0;
            $retorno[$enfirme]["inffin1510_acttot"] = 0;

            $retorno[$enfirme]["inffin1510_pascte"] = 0;
            $retorno[$enfirme]["inffin1510_paslar"] = 0;
            $retorno[$enfirme]["inffin1510_pastot"] = 0;
            $retorno[$enfirme]["inffin1510_patnet"] = 0;
            $retorno[$enfirme]["inffin1510_paspat"] = 0;
            $retorno[$enfirme]["inffin1510_balsoc"] = 0;

            $retorno[$enfirme]["inffin1510_ingope"] = 0;
            $retorno[$enfirme]["inffin1510_ingnoope"] = 0;
            $retorno[$enfirme]["inffin1510_gasope"] = 0;
            $retorno[$enfirme]["inffin1510_gasnoope"] = 0;
            $retorno[$enfirme]["inffin1510_cosven"] = 0;
            $retorno[$enfirme]["inffin1510_utinet"] = 0;
            $retorno[$enfirme]["inffin1510_utiope"] = 0;
            $retorno[$enfirme]["inffin1510_gasint"] = 0;
            $retorno[$enfirme]["inffin1510_gasimp"] = 0;

            $retorno[$enfirme]["inffin1510_indliq"] = 0;
            $retorno[$enfirme]["inffin1510_nivend"] = 0;
            $retorno[$enfirme]["inffin1510_razcob"] = 0;
            $retorno[$enfirme]["inffin1510_renpat"] = 0;
            $retorno[$enfirme]["inffin1510_renact"] = 0;

            $retorno[$enfirme]["inffin1510_gruponiif"] = '';

            // Contratos ejecutados 1510
            $retorno[$enfirme]["exp1510"] = array();

            // Clasificaciones 1510
            $retorno[$enfirme]["clasi1510"] = array();
            $retorno[$enfirme]["clasitem1510"] = array();
        }


        //
        if (trim($xml) != '') {
            $dom = new DomDocument('1.0', 'utf-8');
            try {
                ini_set('display_errors', '1');
                $result = $dom->loadXML($xml);
                ini_set('display_errors', '1');
                if ($result === false) {
                    $detalle = isset($_SESSION["sirep"]["detalle"]) ? $_SESSION["sirep"]["detalle"] : "";
                    $_SESSION["generales"]["txtemergente"] = 'Error desserializando xml: ' . $result . ' (' . $detalle . ') (' . $controlprimeravez . ') (' . $proceso . ')';
                    return 0;
                }
            } catch (exception $e) {
                $_SESSION["generales"]["txtemergente"] = 'Error de excepci&oacute;n : ' . $e->getMessage();
                return 0;
            }

            $ix = 0;
            $reg1 = $dom->getElementsByTagName("expediente");

            foreach ($reg1 as $reg) {
                $ix++;

                // Datos de Identificaci&oacute;n del expediente
                $retorno["tipotramite"] = (isset($reg->getElementsByTagName("tipotramite")->item(0)->textContent)) ? ltrim($reg->getElementsByTagName("tipotramite")->item(0)->textContent, '0') : '';
                $retorno["numerorecuperacion"] = (isset($reg->getElementsByTagName("numerorecuperacion")->item(0)->textContent)) ? trim($reg->getElementsByTagName("numerorecuperacion")->item(0)->textContent) : '';
                $retorno["numeroliquidacion"] = (isset($reg->getElementsByTagName("numeroliquidacion")->item(0)->textContent)) ? ltrim($reg->getElementsByTagName("numeroliquidacion")->item(0)->textContent, '0') : '';

                // *********************************************************************************************************************** //
                // Datos en firme
                // *********************************************************************************************************************** //
                if ($tipotramite == 'enfirme') {
                    $enfirme = '';
                    switch ($ix) {
                        case 1 : $enfirme = 'enfirme';
                            break;
                        case 2 : $enfirme = 'nofirme01';
                            break;
                        case 3 : $enfirme = 'nofirme02';
                            break;
                        case 4 : $enfirme = 'nofirme03';
                            break;
                        case 5 : $enfirme = 'nofirme04';
                            break;
                    }
                    $retorno[$enfirme]["proponente"] = ltrim($reg->getElementsByTagName("proponente")->item(0)->textContent, '0');
                    $retorno[$enfirme]["matricula"] = ltrim($reg->getElementsByTagName("matricula")->item(0)->textContent, '0');
                    $retorno[$enfirme]["nombre"] = \funcionesSii2::restaurarEspeciales(trim($reg->getElementsByTagName("nombre")->item(0)->textContent));
                    $retorno[$enfirme]["ape1"] = \funcionesSii2::restaurarEspeciales(trim($reg->getElementsByTagName("ape1")->item(0)->textContent));
                    $retorno[$enfirme]["ape2"] = \funcionesSii2::restaurarEspeciales(trim($reg->getElementsByTagName("ape2")->item(0)->textContent));
                    $retorno[$enfirme]["nom1"] = \funcionesSii2::restaurarEspeciales(trim($reg->getElementsByTagName("nom1")->item(0)->textContent));
                    $retorno[$enfirme]["nom2"] = \funcionesSii2::restaurarEspeciales(trim($reg->getElementsByTagName("nom2")->item(0)->textContent));
                    $retorno[$enfirme]["sigla"] = \funcionesSii2::restaurarEspeciales(trim($reg->getElementsByTagName("sigla")->item(0)->textContent));
                    $retorno[$enfirme]["idtipoidentificacion"] = $reg->getElementsByTagName("idtipoidentificacion")->item(0)->textContent;
                    $retorno[$enfirme]["identificacion"] = ltrim($reg->getElementsByTagName("identificacion")->item(0)->textContent, '0');
                    $retorno[$enfirme]["idpaisidentificacion"] = $reg->getElementsByTagName("idpaisidentificacion")->item(0)->textContent;
                    $retorno[$enfirme]["nit"] = ltrim($reg->getElementsByTagName("nit")->item(0)->textContent, '0');
                    $retorno[$enfirme]["nacionalidad"] = trim($reg->getElementsByTagName("nacionalidad")->item(0)->textContent);
                    $retorno[$enfirme]["organizacion"] = $reg->getElementsByTagName("organizacion")->item(0)->textContent;

                    $retorno[$enfirme]["tamanoempresa"] = $reg->getElementsByTagName("tamanoempresa")->item(0)->textContent;
                    $retorno[$enfirme]["emprendedor28"] = $reg->getElementsByTagName("emprendedor28")->item(0)->textContent;
                    $retorno[$enfirme]["pemprendedor28"] = $reg->getElementsByTagName("pemprendedor28")->item(0)->textContent;
                    $retorno[$enfirme]["vigcontrol"] = $reg->getElementsByTagName("vigcontrol")->item(0)->textContent;

                    $retorno[$enfirme]["cambidom_fechaultimainscripcion"] = $reg->getElementsByTagName("cambidom_fechaultimainscripcion")->item(0)->textContent;
                    $retorno[$enfirme]["cambidom_fechaultimarenovacion"] = $reg->getElementsByTagName("cambidom_fechaultimarenovacion")->item(0)->textContent;
                    $retorno[$enfirme]["cambidom_idmunicipioorigen"] = $reg->getElementsByTagName("cambidom_idmunicipioorigen")->item(0)->textContent;
                    $retorno[$enfirme]["cambidom_idmunicipiodestino"] = $reg->getElementsByTagName("cambidom_idmunicipiodestino")->item(0)->textContent;
                    $retorno[$enfirme]["propcamaraorigen"] = $reg->getElementsByTagName("propcamaraorigen")->item(0)->textContent;
                    $retorno[$enfirme]["propcamaradestino"] = $reg->getElementsByTagName("propcamaradestino")->item(0)->textContent;

                    $retorno[$enfirme]["idestadoproponente"] = $reg->getElementsByTagName("idestadoproponente")->item(0)->textContent;
                    $retorno[$enfirme]["fechaultimainscripcion"] = $reg->getElementsByTagName("fechaultimainscripcion")->item(0)->textContent;
                    $retorno[$enfirme]["fechaultimarenovacion"] = $reg->getElementsByTagName("fechaultimarenovacion")->item(0)->textContent;
                    $retorno[$enfirme]["fechaultimaactualizacion"] = $reg->getElementsByTagName("fechaultimaactualizacion")->item(0)->textContent;
                    $retorno[$enfirme]["fechacancelacion"] = $reg->getElementsByTagName("fechacancelacion")->item(0)->textContent;

                    $retorno[$enfirme]["idtipodocperjur"] = $reg->getElementsByTagName("idtipodocperjur")->item(0)->textContent;
                    $retorno[$enfirme]["numdocperjur"] = ltrim($reg->getElementsByTagName("numdocperjur")->item(0)->textContent, '0');
                    $retorno[$enfirme]["fecdocperjur"] = $reg->getElementsByTagName("fecdocperjur")->item(0)->textContent;
                    $retorno[$enfirme]["origendocperjur"] = (trim($reg->getElementsByTagName("origendocperjur")->item(0)->textContent));
                    $retorno[$enfirme]["fechaconstitucion"] = $reg->getElementsByTagName("fechaconstitucion")->item(0)->textContent;
                    $retorno[$enfirme]["fechavencimiento"] = $reg->getElementsByTagName("fechavencimiento")->item(0)->textContent;
                    $retorno[$enfirme]["dircom"] = \funcionesSii2::restaurarEspeciales(ltrim($reg->getElementsByTagName("dircom")->item(0)->textContent));
                    $retorno[$enfirme]["muncom"] = $reg->getElementsByTagName("muncom")->item(0)->textContent;
                    $retorno[$enfirme]["telcom1"] = $reg->getElementsByTagName("telcom1")->item(0)->textContent;
                    $retorno[$enfirme]["telcom2"] = $reg->getElementsByTagName("telcom2")->item(0)->textContent;
                    $retorno[$enfirme]["celcom"] = $reg->getElementsByTagName("celcom")->item(0)->textContent;
                    $retorno[$enfirme]["faxcom"] = $reg->getElementsByTagName("faxcom")->item(0)->textContent;
                    $retorno[$enfirme]["emailcom"] = $reg->getElementsByTagName("emailcom")->item(0)->textContent;
                    $retorno[$enfirme]["enviarint"] = $reg->getElementsByTagName("enviarint")->item(0)->textContent;
                    $retorno[$enfirme]["dirnot"] = \funcionesSii2::restaurarEspeciales(trim($reg->getElementsByTagName("dirnot")->item(0)->textContent));
                    $retorno[$enfirme]["munnot"] = $reg->getElementsByTagName("munnot")->item(0)->textContent;
                    $retorno[$enfirme]["telnot"] = $reg->getElementsByTagName("telnot")->item(0)->textContent;
                    $retorno[$enfirme]["telnot2"] = $reg->getElementsByTagName("telnot2")->item(0)->textContent;
                    $retorno[$enfirme]["celnot"] = $reg->getElementsByTagName("celnot")->item(0)->textContent;
                    $retorno[$enfirme]["faxnot"] = $reg->getElementsByTagName("faxnot")->item(0)->textContent;
                    $retorno[$enfirme]["emailnot"] = $reg->getElementsByTagName("emailnot")->item(0)->textContent;
                    $retorno[$enfirme]["enviarnot"] = $reg->getElementsByTagName("enviarnot")->item(0)->textContent;

                    // informacion de representantes legales
                    if ($retorno[$enfirme]["organizacion"] != '01') {
                        if (ltrim($retorno[$enfirme]["matricula"], '0') != '') {
                            if ($ix == 1) {
                                $i = 0;
                                $rlegs = $reg->getElementsByTagName("representantelegal");
                                if (count($rlegs) > 0) {
                                    foreach ($rlegs as $rleg) {
                                        $i++;
                                        $retorno[$enfirme]["representanteslegales"][$i]["idtipoidentificacionrepleg"] = $rleg->getElementsByTagName("idtipoidentificacionrepleg")->item(0)->textContent;
                                        $retorno[$enfirme]["representanteslegales"][$i]["identificacionrepleg"] = ltrim($rleg->getElementsByTagName("identificacionrepleg")->item(0)->textContent, '0');
                                        if ($controlprimeravez == 'si') {
                                            $retorno[$enfirme]["representanteslegales"][$i]["nombrerepleg"] = \funcionesSii2::restaurarEspeciales(trim($rleg->getElementsByTagName("nombrerepleg")->item(0)->textContent));
                                            $retorno[$enfirme]["representanteslegales"][$i]["cargorepleg"] = \funcionesSii2::restaurarEspeciales(trim($rleg->getElementsByTagName("cargorepleg")->item(0)->textContent));
                                        } else {
                                            $retorno[$enfirme]["representanteslegales"][$i]["nombrerepleg"] = \funcionesSii2::restaurarEspeciales(trim($rleg->getElementsByTagName("nombrerepleg")->item(0)->textContent));
                                            $retorno[$enfirme]["representanteslegales"][$i]["cargorepleg"] = \funcionesSii2::restaurarEspeciales(trim($rleg->getElementsByTagName("cargorepleg")->item(0)->textContent));
                                        }
                                    }
                                }
                            }
                        } else {
                            if ($reg->getElementsByTagName("representanteslegales")) {
                                $retorno[$enfirme]["representanteslegales"] = array();
                                $i = 0;
                                $rlegs = $reg->getElementsByTagName("representantelegal");
                                if (count($rlegs) > 0) {
                                    foreach ($rlegs as $rleg) {
                                        $i++;
                                        $retorno[$enfirme]["representanteslegales"][$i]["idtipoidentificacionrepleg"] = $rleg->getElementsByTagName("idtipoidentificacionrepleg")->item(0)->textContent;
                                        $retorno[$enfirme]["representanteslegales"][$i]["identificacionrepleg"] = ltrim($rleg->getElementsByTagName("identificacionrepleg")->item(0)->textContent, '0');
                                        $retorno[$enfirme]["representanteslegales"][$i]["nombrerepleg"] = \funcionesSii2::restaurarEspeciales(trim($rleg->getElementsByTagName("nombrerepleg")->item(0)->textContent));
                                        $retorno[$enfirme]["representanteslegales"][$i]["cargorepleg"] = \funcionesSii2::restaurarEspeciales(trim($rleg->getElementsByTagName("cargorepleg")->item(0)->textContent));
                                    }
                                }
                            }
                        }
                    }
                    unset($rlegs);

                    // informacion de facultades y limitaciones
                    if ($retorno[$enfirme]["organizacion"] != '01') {
                        if (ltrim($retorno[$enfirme]["matricula"], '0') != '') {
                            if ($ix == 1) {
                                if (isset($reg->getElementsByTagName("facultades")->item(0)->textContent)) {
                                    $retorno[$enfirme]["facultades"] = \funcionesSii2::restaurarEspeciales(trim($reg->getElementsByTagName("facultades")->item(0)->textContent));
                                }
                            }
                        } else {
                            if (isset($reg->getElementsByTagName("facultades")->item(0)->textContent)) {
                                $retorno[$enfirme]["facultades"] = \funcionesSii2::restaurarEspeciales(trim($reg->getElementsByTagName("facultades")->item(0)->textContent));
                            }
                        }
                    }

                    $i = 0;
                    $sitcon = $reg->getElementsByTagName("sitcontrol");
                    if (count($sitcon) > 0) {
                        foreach ($sitcon as $sc) {
                            if (trim(restaurarEspeciales(trim($sc->getElementsByTagName("nombre")->item(0)->textContent))) != '') {
                                $i++;
                                $retorno[$enfirme]["sitcontrol"][$i]["nombre"] = \funcionesSii2::restaurarEspeciales(trim($sc->getElementsByTagName("nombre")->item(0)->textContent));
                                $retorno[$enfirme]["sitcontrol"][$i]["identificacion"] = \funcionesSii2::restaurarEspeciales(trim($sc->getElementsByTagName("identificacion")->item(0)->textContent));
                                $retorno[$enfirme]["sitcontrol"][$i]["domicilio"] = \funcionesSii2::restaurarEspeciales(trim($sc->getElementsByTagName("domicilio")->item(0)->textContent));
                                $retorno[$enfirme]["sitcontrol"][$i]["tipo"] = trim($sc->getElementsByTagName("tipo")->item(0)->textContent);
                            }
                        }
                    }

                    // informaci&oacute;n de clasificaciones
                    $i = -1;
                    $j = 0;
                    $clas = $reg->getElementsByTagName("cla1510");
                    if (count($clas) > 0) {
                        foreach ($clas as $cla) {
                            $i++;
                            if (trim($clas->item($i)->textContent) != '') {
                                $j++;
                                $retorno[$enfirme]["clasi1510"][$j] = trim($clas->item($i)->textContent);
                            }
                        }
                    }
                    unset($clas);

                    $clas = $reg->getElementsByTagName("clasi1510");
                    if (count($clas) > 0) {
                        foreach ($clas as $cla) {
                            $i++;
                            if (trim($clas->item($i)->textContent) != '') {
                                $j++;
                                $retorno[$enfirme]["clasi1510"][$j] = trim($clas->item($i)->textContent);
                            }
                        }
                    }
                    unset($clas);

                    // Informaci&oacute;n financiera - Decreto 1510
                    if (isset($reg->getElementsByTagName("inffin1510_fechacorte")->item(0)->textContent)) {
                        $retorno[$enfirme]["inffin1510_fechacorte"] = $reg->getElementsByTagName("inffin1510_fechacorte")->item(0)->textContent;
                    }
                    if (isset($reg->getElementsByTagName("inffin1510_actcte")->item(0)->textContent)) {
                        $retorno[$enfirme]["inffin1510_actcte"] = trim($reg->getElementsByTagName("inffin1510_actcte")->item(0)->textContent);
                    }
                    if (isset($reg->getElementsByTagName("inffin1510_actnocte")->item(0)->textContent)) {
                        $retorno[$enfirme]["inffin1510_actnocte"] = trim($reg->getElementsByTagName("inffin1510_actnocte")->item(0)->textContent);
                    }
                    if (isset($reg->getElementsByTagName("inffin1510_fijnet")->item(0)->textContent)) {
                        $retorno[$enfirme]["inffin1510_fijnet"] = trim($reg->getElementsByTagName("inffin1510_fijnet")->item(0)->textContent);
                    }
                    if (isset($reg->getElementsByTagName("inffin1510_actotr")->item(0)->textContent)) {
                        $retorno[$enfirme]["inffin1510_actotr"] = trim($reg->getElementsByTagName("inffin1510_actotr")->item(0)->textContent);
                    }
                    if (isset($reg->getElementsByTagName("inffin1510_actval")->item(0)->textContent)) {
                        $retorno[$enfirme]["inffin1510_actval"] = trim($reg->getElementsByTagName("inffin1510_actval")->item(0)->textContent);
                    }
                    if (isset($reg->getElementsByTagName("inffin1510_acttot")->item(0)->textContent)) {
                        $retorno[$enfirme]["inffin1510_acttot"] = trim($reg->getElementsByTagName("inffin1510_acttot")->item(0)->textContent);
                    }

                    if (isset($reg->getElementsByTagName("inffin1510_pascte")->item(0)->textContent)) {
                        $retorno[$enfirme]["inffin1510_pascte"] = trim($reg->getElementsByTagName("inffin1510_pascte")->item(0)->textContent);
                    }
                    if (isset($reg->getElementsByTagName("inffin1510_paslar")->item(0)->textContent)) {
                        $retorno[$enfirme]["inffin1510_paslar"] = trim($reg->getElementsByTagName("inffin1510_paslar")->item(0)->textContent);
                    }
                    if (isset($reg->getElementsByTagName("inffin1510_pastot")->item(0)->textContent)) {
                        $retorno[$enfirme]["inffin1510_pastot"] = trim($reg->getElementsByTagName("inffin1510_pastot")->item(0)->textContent);
                    }
                    if (isset($reg->getElementsByTagName("inffin1510_patnet")->item(0)->textContent)) {
                        $retorno[$enfirme]["inffin1510_patnet"] = trim($reg->getElementsByTagName("inffin1510_patnet")->item(0)->textContent);
                    }
                    if (isset($reg->getElementsByTagName("inffin1510_paspat")->item(0)->textContent)) {
                        $retorno[$enfirme]["inffin1510_paspat"] = trim($reg->getElementsByTagName("inffin1510_paspat")->item(0)->textContent);
                    }
                    $retorno[$enfirme]["inffin1510_paspat"] = doubleval($retorno[$enfirme]["inffin1510_pastot"]) + doubleval($retorno[$enfirme]["inffin1510_patnet"]);
                    if (isset($reg->getElementsByTagName("inffin1510_balsoc")->item(0)->textContent)) {
                        $retorno[$enfirme]["inffin1510_balsoc"] = trim($reg->getElementsByTagName("inffin1510_balsoc")->item(0)->textContent);
                    }

                    if (isset($reg->getElementsByTagName("inffin1510_ingope")->item(0)->textContent)) {
                        $retorno[$enfirme]["inffin1510_ingope"] = trim($reg->getElementsByTagName("inffin1510_ingope")->item(0)->textContent);
                    }
                    if (isset($reg->getElementsByTagName("inffin1510_ingnoope")->item(0)->textContent)) {
                        $retorno[$enfirme]["inffin1510_ingnoope"] = trim($reg->getElementsByTagName("inffin1510_ingnoope")->item(0)->textContent);
                    }
                    if (isset($reg->getElementsByTagName("inffin1510_gasope")->item(0)->textContent)) {
                        $retorno[$enfirme]["inffin1510_gasope"] = trim($reg->getElementsByTagName("inffin1510_gasope")->item(0)->textContent);
                    }
                    if (isset($reg->getElementsByTagName("inffin1510_gasnoope")->item(0)->textContent)) {
                        $retorno[$enfirme]["inffin1510_gasnoope"] = trim($reg->getElementsByTagName("inffin1510_gasnoope")->item(0)->textContent);
                    }
                    if (isset($reg->getElementsByTagName("inffin1510_cosven")->item(0)->textContent)) {
                        $retorno[$enfirme]["inffin1510_cosven"] = trim($reg->getElementsByTagName("inffin1510_cosven")->item(0)->textContent);
                    }
                    if (isset($reg->getElementsByTagName("inffin1510_utinet")->item(0)->textContent)) {
                        $retorno[$enfirme]["inffin1510_utinet"] = trim($reg->getElementsByTagName("inffin1510_utinet")->item(0)->textContent);
                    }
                    if (isset($reg->getElementsByTagName("inffin1510_utiope")->item(0)->textContent)) {
                        $retorno[$enfirme]["inffin1510_utiope"] = trim($reg->getElementsByTagName("inffin1510_utiope")->item(0)->textContent);
                    }
                    if (isset($reg->getElementsByTagName("inffin1510_gasint")->item(0)->textContent)) {
                        $retorno[$enfirme]["inffin1510_gasint"] = trim($reg->getElementsByTagName("inffin1510_gasint")->item(0)->textContent);
                    }
                    if (isset($reg->getElementsByTagName("inffin1510_gasimp")->item(0)->textContent)) {
                        $retorno[$enfirme]["inffin1510_gasimp"] = trim($reg->getElementsByTagName("inffin1510_gasimp")->item(0)->textContent);
                    }

                    if (isset($reg->getElementsByTagName("inffin1510_indliq")->item(0)->textContent)) {
                        if ($reg->getElementsByTagName("inffin1510_indliq")->item(0)->textContent == '999') {
                            $retorno[$enfirme]["inffin1510_indliq"] = 'INDEFINIDO';
                        } else {
                            $retorno[$enfirme]["inffin1510_indliq"] = trim($reg->getElementsByTagName("inffin1510_indliq")->item(0)->textContent);
                        }
                    }

                    if (isset($reg->getElementsByTagName("inffin1510_nivend")->item(0)->textContent)) {
                        if ($reg->getElementsByTagName("inffin1510_nivend")->item(0)->textContent == '999') {
                            $retorno[$enfirme]["inffin1510_nivend"] = 'INDEFINIDO';
                        } else {
                            $retorno[$enfirme]["inffin1510_nivend"] = trim($reg->getElementsByTagName("inffin1510_nivend")->item(0)->textContent);
                        }
                    }

                    if (isset($reg->getElementsByTagName("inffin1510_razcob")->item(0)->textContent)) {
                        if ($reg->getElementsByTagName("inffin1510_razcob")->item(0)->textContent == '999') {
                            $retorno[$enfirme]["inffin1510_razcob"] = 'INDEFINIDO';
                        } else {
                            $retorno[$enfirme]["inffin1510_razcob"] = trim($reg->getElementsByTagName("inffin1510_razcob")->item(0)->textContent);
                        }
                    }

                    if (isset($reg->getElementsByTagName("inffin1510_renpat")->item(0)->textContent)) {
                        if ($reg->getElementsByTagName("inffin1510_renpat")->item(0)->textContent == '999') {
                            $retorno[$enfirme]["inffin1510_renpat"] = 'INDEFINIDO';
                        } else {
                            $retorno[$enfirme]["inffin1510_renpat"] = trim($reg->getElementsByTagName("inffin1510_renpat")->item(0)->textContent);
                        }
                    }

                    if (isset($reg->getElementsByTagName("inffin1510_renact")->item(0)->textContent)) {
                        if ($reg->getElementsByTagName("inffin1510_renact")->item(0)->textContent == '999') {
                            $retorno[$enfirme]["inffin1510_renact"] = 'INDEFINIDO';
                        } else {
                            $retorno[$enfirme]["inffin1510_renact"] = trim($reg->getElementsByTagName("inffin1510_renact")->item(0)->textContent);
                        }
                    }

                    //
                    $retorno[$enfirme]["inffin1510_actnocte"] = $retorno[$enfirme]["inffin1510_actnocte"] +
                            $retorno[$enfirme]["inffin1510_fijnet"] +
                            $retorno[$enfirme]["inffin1510_actotr"] +
                            $retorno[$enfirme]["inffin1510_actval"];

                    if (isset($reg->getElementsByTagName("inffin1510_gruponiif")->item(0)->textContent)) {
                        $retorno[$enfirme]["inffin1510_gruponiif"] = trim($reg->getElementsByTagName("inffin1510_gruponiif")->item(0)->textContent);
                    }

                    /*        	  
                     * Experiencia decreto 1510
                     * Celebrado por: 
                     * 1.- El proponente
                     * 2.- Accionista
                     * 3.- Consorcio o union temporal
                     */
                    $cont = $reg->getElementsByTagName("exp1510");
                    if (count($cont) > 0) {
                        foreach ($cont as $cnt) {
                            if (intval($cnt->getElementsByTagName("secuencia")->item(0)->textContent) <= 3) {
                                $sec = sprintf("%03s", intval($cnt->getElementsByTagName("secuencia")->item(0)->textContent));
                            } else {
                                $sec = ltrim(trim($cnt->getElementsByTagName("secuencia")->item(0)->textContent), "0");
                            }
                            $ind = intval($sec);
                            $retorno[$enfirme]["exp1510"][$ind]["secuencia"] = $sec;
                            if (isset($cnt->getElementsByTagName("clavecontrato")->item(0)->textContent)) {
                                $retorno[$enfirme]["exp1510"][$ind]["clavecontrato"] = trim(\funcionesSii2::restaurarEspeciales($cnt->getElementsByTagName("clavecontrato")->item(0)->textContent));
                            } else {
                                $retorno[$enfirme]["exp1510"][$ind]["clavecontrato"] = '';
                            }
                            $retorno[$enfirme]["exp1510"][$ind]["celebradopor"] = trim(\funcionesSii2::restaurarEspeciales($cnt->getElementsByTagName("celebradopor")->item(0)->textContent));
                            $retorno[$enfirme]["exp1510"][$ind]["nombrecontratista"] = trim(\funcionesSii2::restaurarEspeciales($cnt->getElementsByTagName("nombrecontratista")->item(0)->textContent));
                            $retorno[$enfirme]["exp1510"][$ind]["nombrecontratante"] = trim(\funcionesSii2::restaurarEspeciales($cnt->getElementsByTagName("nombrecontratante")->item(0)->textContent));
                            if (isset($cnt->getElementsByTagName("fecejecucion")->item(0)->textContent)) {
                                $retorno[$enfirme]["exp1510"][$ind]["fecejecucion"] = trim(\funcionesSii2::restaurarEspeciales($cnt->getElementsByTagName("fecejecucion")->item(0)->textContent));
                            } else {
                                $retorno[$enfirme]["exp1510"][$ind]["fecejecucion"] = '';
                            }
                            if (isset($cnt->getElementsByTagName("valorpesos")->item(0)->textContent)) {
                                $retorno[$enfirme]["exp1510"][$ind]["valorpesos"] = $cnt->getElementsByTagName("valorpesos")->item(0)->textContent;
                            } else {
                                $retorno[$enfirme]["exp1510"][$ind]["valorpesos"] = 0;
                            }
                            $retorno[$enfirme]["exp1510"][$ind]["valor"] = trim(\funcionesSii2::restaurarEspeciales($cnt->getElementsByTagName("valor")->item(0)->textContent));
                            $retorno[$enfirme]["exp1510"][$ind]["porcentaje"] = trim(\funcionesSii2::restaurarEspeciales($cnt->getElementsByTagName("porcentaje")->item(0)->textContent));
                            $clas = $cnt->getElementsByTagName("clasif");
                            $iCla = 0;
                            foreach ($clas as $c) {
                                $iCla++;
                                $retorno[$enfirme]["exp1510"][$ind]["clasif"][$iCla] = $c->textContent;
                            }
                            if (isset($cnt->getElementsByTagName("generardeclaracion")->item(0)->textContent)) {
                                $retorno[$enfirme]["exp1510"][$ind]["generardeclaracion"] = $cnt->getElementsByTagName("generardeclaracion")->item(0)->textContent;
                            } else {
                                $retorno[$enfirme]["exp1510"][$ind]["generardeclaracion"] = '';
                            }
                            $retorno[$enfirme]["exp1510"][$ind]["soportedeclaracion"] = '';
                            $retorno[$enfirme]["exp1510"][$ind]["soportecontrato"] = '';
                        }
                    }
                    unset($cont);
                    if (!empty($retorno[$enfirme]["exp1510"])) {
                        $temx = \funcionesSii2::ordenarMatriz($retorno[$enfirme]["exp1510"], "secuencia");
                        $retorno[$enfirme]["exp1510"] = array();
                        $iCon = 0;
                        foreach ($temx as $t) {
                            $iCon++;
                            $retorno[$enfirme]["exp1510"][$iCon] = $t;
                        }
                        unset($temx);
                    }
                }

                // *********************************************************************************************************************** //
                // Datos actuales
                // *********************************************************************************************************************** //
                if ($ix == 1) {
                    (!isset($reg->getElementsByTagName("proponente")->item(0)->textContent)) ? $retorno["proponente"] = '' : $retorno["proponente"] = ltrim($reg->getElementsByTagName("proponente")->item(0)->textContent, '0');
                    (!isset($reg->getElementsByTagName("matricula")->item(0)->textContent)) ? $retorno["matricula"] = '' : $retorno["matricula"] = ltrim($reg->getElementsByTagName("matricula")->item(0)->textContent, '0');
                    (!isset($reg->getElementsByTagName("nombre")->item(0)->textContent)) ? $retorno["nombre"] = '' : $retorno["nombre"] = \funcionesSii2::restaurarEspeciales(trim($reg->getElementsByTagName("nombre")->item(0)->textContent));
                    (!isset($reg->getElementsByTagName("ape1")->item(0)->textContent)) ? $retorno["ape1"] = '' : $retorno["ape1"] = \funcionesSii2::restaurarEspeciales(trim($reg->getElementsByTagName("ape1")->item(0)->textContent));
                    (!isset($reg->getElementsByTagName("ape2")->item(0)->textContent)) ? $retorno["ape2"] = '' : $retorno["ape2"] = \funcionesSii2::restaurarEspeciales(trim($reg->getElementsByTagName("ape2")->item(0)->textContent));
                    (!isset($reg->getElementsByTagName("nom1")->item(0)->textContent)) ? $retorno["nom1"] = '' : $retorno["nom1"] = \funcionesSii2::restaurarEspeciales(trim($reg->getElementsByTagName("nom1")->item(0)->textContent));
                    (!isset($reg->getElementsByTagName("nom2")->item(0)->textContent)) ? $retorno["nom2"] = '' : $retorno["nom2"] = \funcionesSii2::restaurarEspeciales(trim($reg->getElementsByTagName("nom2")->item(0)->textContent));
                    (!isset($reg->getElementsByTagName("sigla")->item(0)->textContent)) ? $retorno["sigla"] = '' : $retorno["sigla"] = \funcionesSii2::restaurarEspeciales(trim($reg->getElementsByTagName("sigla")->item(0)->textContent));
                    (!isset($reg->getElementsByTagName("idtipoidentificacion")->item(0)->textContent)) ? $retorno["idtipoidentificacion"] = '' : $retorno["idtipoidentificacion"] = $reg->getElementsByTagName("idtipoidentificacion")->item(0)->textContent;
                    (!isset($reg->getElementsByTagName("identificacion")->item(0)->textContent)) ? $retorno["identificacion"] = '' : $retorno["identificacion"] = ltrim($reg->getElementsByTagName("identificacion")->item(0)->textContent, '0');
                    (!isset($reg->getElementsByTagName("idpaisidentificacion")->item(0)->textContent)) ? $retorno["idpaisidentificacion"] = '' : $retorno["idpaisidentificacion"] = $reg->getElementsByTagName("idpaisidentificacion")->item(0)->textContent;
                    (!isset($reg->getElementsByTagName("nit")->item(0)->textContent)) ? $retorno["nit"] = '' : $retorno["nit"] = ltrim($reg->getElementsByTagName("nit")->item(0)->textContent, '0');
                    (!isset($reg->getElementsByTagName("nacionalidad")->item(0)->textContent)) ? $retorno["nacionalidad"] = '' : $retorno["nacionalidad"] = trim($reg->getElementsByTagName("nacionalidad")->item(0)->textContent);
                    (!isset($reg->getElementsByTagName("organizacion")->item(0)->textContent)) ? $retorno["organizacion"] = '' : $retorno["organizacion"] = $reg->getElementsByTagName("organizacion")->item(0)->textContent;
                }

                if (isset($reg->getElementsByTagName("tamanoempresa")->item(0)->textContent)) {
                    $retorno["tamanoempresa"] = $reg->getElementsByTagName("tamanoempresa")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("emprendedor28")->item(0)->textContent)) {
                    $retorno["emprendedor28"] = $reg->getElementsByTagName("emprendedor28")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("pemprendedor28")->item(0)->textContent)) {
                    $retorno["pemprendedor28"] = $reg->getElementsByTagName("pemprendedor28")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("vigcontrol")->item(0)->textContent)) {
                    $retorno["vigcontrol"] = $reg->getElementsByTagName("vigcontrol")->item(0)->textContent;
                }

                // Datos de cambio de domicilio
                if ($ix == 1) {
                    (isset($reg->getElementsByTagName("cambidom_fechaultimainscripcion")->item(0)->textContent)) ? $retorno["cambidom_fechaultimainscripcion"] = $reg->getElementsByTagName("cambidom_fechaultimainscripcion")->item(0)->textContent : $retorno["cambidom_fechaultimainscripcion"] = '';
                    (isset($reg->getElementsByTagName("cambidom_fechaultimarenovacion")->item(0)->textContent)) ? $retorno["cambidom_fechaultimarenovacion"] = $reg->getElementsByTagName("cambidom_fechaultimarenovacion")->item(0)->textContent : $retorno["cambidom_fechaultimarenovacion"] = '';
                    (isset($reg->getElementsByTagName("cambidom_idmunicipioorigen")->item(0)->textContent)) ? $retorno["cambidom_idmunicipioorigen"] = $reg->getElementsByTagName("cambidom_idmunicipioorigen")->item(0)->textContent : $retorno["cambidom_idmunicipioorigen"] = '';
                    (isset($reg->getElementsByTagName("cambidom_idmunicipiodestino")->item(0)->textContent)) ? $retorno["cambidom_idmunicipiodestino"] = $reg->getElementsByTagName("cambidom_idmunicipiodestino")->item(0)->textContent : $retorno["cambidom_idmunicipiodestino"] = '';
                    (isset($reg->getElementsByTagName("propcamaraorigen")->item(0)->textContent)) ? $retorno["propcamaraorigen"] = $reg->getElementsByTagName("propcamaraorigen")->item(0)->textContent : $retorno["propcamaraorigen"] = '';
                    (isset($reg->getElementsByTagName("propcamaradestino")->item(0)->textContent)) ? $retorno["propcamaradestino"] = $reg->getElementsByTagName("propcamaradestino")->item(0)->textContent : $retorno["propcamaradestino"] = '';
                }

                // Datos de catalogacion del registro
                if ($ix == 1) {
                    $retorno["idestadoproponente"] = $reg->getElementsByTagName("idestadoproponente")->item(0)->textContent;
                    (!isset($reg->getElementsByTagName("certificardesde")->item(0)->textContent)) ? $retorno["certificardesde"] = '' : $retorno["certificardesde"] = $reg->getElementsByTagName("certificardesde")->item(0)->textContent;
                    $retorno["fechaultimainscripcion"] = $reg->getElementsByTagName("fechaultimainscripcion")->item(0)->textContent;
                    $retorno["fechaultimarenovacion"] = $reg->getElementsByTagName("fechaultimarenovacion")->item(0)->textContent;
                    (isset($reg->getElementsByTagName("fechaultimaactualizacion")->item(0)->textContent)) ? $retorno["fechaultimaactualizacion"] = $reg->getElementsByTagName("fechaultimaactualizacion")->item(0)->textContent : $retorno["fechaultimaactualizacion"] = '';
                    $retorno["fechacancelacion"] = $reg->getElementsByTagName("fechacancelacion")->item(0)->textContent;
                }

                if (isset($reg->getElementsByTagName("idtipodocperjur")->item(0)->textContent)) {
                    $retorno["idtipodocperjur"] = $reg->getElementsByTagName("idtipodocperjur")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("numdocperjur")->item(0)->textContent)) {
                    $retorno["numdocperjur"] = ltrim($reg->getElementsByTagName("numdocperjur")->item(0)->textContent, '0');
                }
                if (isset($reg->getElementsByTagName("fecdocperjur")->item(0)->textContent)) {
                    $retorno["fecdocperjur"] = $reg->getElementsByTagName("fecdocperjur")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("origendocperjur")->item(0)->textContent)) {
                    $retorno["origendocperjur"] = (trim($reg->getElementsByTagName("origendocperjur")->item(0)->textContent));
                }
                if (isset($reg->getElementsByTagName("fechaconstitucion")->item(0)->textContent)) {
                    $retorno["fechaconstitucion"] = $reg->getElementsByTagName("fechaconstitucion")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("fechavencimiento")->item(0)->textContent)) {
                    $retorno["fechavencimiento"] = $reg->getElementsByTagName("fechavencimiento")->item(0)->textContent;
                }

                // informaci&oacute;n de ubicaci&oacute;n comercial en el registro mercantil
                if (isset($reg->getElementsByTagName("dircom")->item(0)->textContent)) {
                    $retorno["dircom"] = restaurarEspeciales(ltrim($reg->getElementsByTagName("dircom")->item(0)->textContent));
                }
                if (isset($reg->getElementsByTagName("muncom")->item(0)->textContent)) {
                    $retorno["muncom"] = $reg->getElementsByTagName("muncom")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("telcom1")->item(0)->textContent)) {
                    $retorno["telcom1"] = $reg->getElementsByTagName("telcom1")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("telcom2")->item(0)->textContent)) {
                    $retorno["telcom2"] = $reg->getElementsByTagName("telcom2")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("celcom")->item(0)->textContent)) {
                    $retorno["celcom"] = $reg->getElementsByTagName("celcom")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("faxcom")->item(0)->textContent)) {
                    $retorno["faxcom"] = $reg->getElementsByTagName("faxcom")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("emailcom")->item(0)->textContent)) {
                    $retorno["emailcom"] = $reg->getElementsByTagName("emailcom")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("enviarint")->item(0)->textContent)) {
                    $retorno["enviarint"] = $reg->getElementsByTagName("enviarint")->item(0)->textContent;
                }

                // informacion de ubicacion de notificacion
                if (isset($reg->getElementsByTagName("dirnot")->item(0)->textContent)) {
                    $retorno["dirnot"] = \funcionesSii2::restaurarEspeciales(trim($reg->getElementsByTagName("dirnot")->item(0)->textContent));
                }
                if (isset($reg->getElementsByTagName("munnot")->item(0)->textContent)) {
                    $retorno["munnot"] = $reg->getElementsByTagName("munnot")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("telnot")->item(0)->textContent)) {
                    $retorno["telnot"] = $reg->getElementsByTagName("telnot")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("telnot2")->item(0)->textContent)) {
                    $retorno["telnot2"] = $reg->getElementsByTagName("telnot2")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("celnot")->item(0)->textContent)) {
                    $retorno["celnot"] = $reg->getElementsByTagName("celnot")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("faxnot")->item(0)->textContent)) {
                    $retorno["faxnot"] = $reg->getElementsByTagName("faxnot")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("emailnot")->item(0)->textContent)) {
                    $retorno["emailnot"] = $reg->getElementsByTagName("emailnot")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("enviarnot")->item(0)->textContent)) {
                    $retorno["enviarnot"] = $reg->getElementsByTagName("enviarnot")->item(0)->textContent;
                }

                // informaci&oacute;n de representantes legales
                if ($retorno["organizacion"] != '01') {
                    if (ltrim($retorno["matricula"], '0') != '') {
                        if ($ix == 1) {
                            $i = 0;
                            $rlegs = $reg->getElementsByTagName("representantelegal");
                            if (count($rlegs) > 0) {
                                foreach ($rlegs as $rleg) {
                                    $i++;
                                    $retorno["representanteslegales"][$i]["idtipoidentificacionrepleg"] = $rleg->getElementsByTagName("idtipoidentificacionrepleg")->item(0)->textContent;
                                    $retorno["representanteslegales"][$i]["identificacionrepleg"] = ltrim($rleg->getElementsByTagName("identificacionrepleg")->item(0)->textContent, '0');
                                    if ($controlprimeravez == 'si') {
                                        $retorno["representanteslegales"][$i]["nombrerepleg"] = \funcionesSii2::restaurarEspeciales(trim($rleg->getElementsByTagName("nombrerepleg")->item(0)->textContent));
                                        $retorno["representanteslegales"][$i]["cargorepleg"] = \funcionesSii2::restaurarEspeciales(trim($rleg->getElementsByTagName("cargorepleg")->item(0)->textContent));
                                    } else {
                                        $retorno["representanteslegales"][$i]["nombrerepleg"] = \funcionesSii2::restaurarEspeciales(trim($rleg->getElementsByTagName("nombrerepleg")->item(0)->textContent));
                                        $retorno["representanteslegales"][$i]["cargorepleg"] = \funcionesSii2::restaurarEspeciales(trim($rleg->getElementsByTagName("cargorepleg")->item(0)->textContent));
                                    }
                                }
                            }
                        }
                    } else {
                        if ($reg->getElementsByTagName("representanteslegales")) {
                            $retorno["representanteslegales"] = array();
                            $i = 0;
                            $rlegs = $reg->getElementsByTagName("representantelegal");
                            if (count($rlegs) > 0) {
                                foreach ($rlegs as $rleg) {
                                    $i++;
                                    $retorno["representanteslegales"][$i]["idtipoidentificacionrepleg"] = $rleg->getElementsByTagName("idtipoidentificacionrepleg")->item(0)->textContent;
                                    $retorno["representanteslegales"][$i]["identificacionrepleg"] = ltrim($rleg->getElementsByTagName("identificacionrepleg")->item(0)->textContent, '0');
                                    $retorno["representanteslegales"][$i]["nombrerepleg"] = \funcionesSii2::restaurarEspeciales(trim($rleg->getElementsByTagName("nombrerepleg")->item(0)->textContent));
                                    $retorno["representanteslegales"][$i]["cargorepleg"] = \funcionesSii2::restaurarEspeciales(trim($rleg->getElementsByTagName("cargorepleg")->item(0)->textContent));
                                }
                            }
                        }
                    }
                }
                unset($rlegs);

                // informacion de facultades y limitaciones
                if ($retorno["organizacion"] != '01') {
                    if (ltrim($retorno["matricula"], '0') != '') {
                        if ($ix == 1) {
                            if (isset($reg->getElementsByTagName("facultades")->item(0)->textContent)) {
                                $retorno["facultades"] = \funcionesSii2::restaurarEspeciales(trim($reg->getElementsByTagName("facultades")->item(0)->textContent));
                            }
                        }
                    } else {
                        if (isset($reg->getElementsByTagName("facultades")->item(0)->textContent)) {
                            $retorno["facultades"] = \funcionesSii2::restaurarEspeciales(trim($reg->getElementsByTagName("facultades")->item(0)->textContent));
                        }
                    }
                }

                /* Situaciones de control
                 * Tipo puede ser:
                 * 0.- Matriz
                 * 1.- Subordinada
                 * 2.- Controlante
                 * 3.- Controlada
                 * 4.- Matriz y Subordinada
                 * 5.- Matriz y Controlante
                 * 6.- Matriz y Controlada
                 * 7.- Subordinada y Controlante
                 * 8.- Subordinada y Controlada
                 * 9.- Controlante y Controlada
                 */
                $i = 0;
                $sitcon = $reg->getElementsByTagName("sitcontrol");
                if (count($sitcon) > 0) {
                    foreach ($sitcon as $sc) {
                        if (trim(\funcionesSii2::restaurarEspeciales(trim($sc->getElementsByTagName("nombre")->item(0)->textContent))) != '') {
                            $i++;
                            $retorno["sitcontrol"][$i]["nombre"] = \funcionesSii2::restaurarEspeciales(trim($sc->getElementsByTagName("nombre")->item(0)->textContent));
                            $retorno["sitcontrol"][$i]["identificacion"] = \funcionesSii2::restaurarEspeciales(trim($sc->getElementsByTagName("identificacion")->item(0)->textContent));
                            $retorno["sitcontrol"][$i]["domicilio"] = \funcionesSii2::restaurarEspeciales(trim($sc->getElementsByTagName("domicilio")->item(0)->textContent));
                            $retorno["sitcontrol"][$i]["tipo"] = trim($sc->getElementsByTagName("tipo")->item(0)->textContent);
                        }
                    }
                }

                // informaci&oacute;n de clasificaciones
                $i = -1;
                $j = 0;
                $clas = $reg->getElementsByTagName("cla1510");
                if (count($clas) > 0) {
                    foreach ($clas as $cla) {
                        $i++;
                        if (trim($clas->item($i)->textContent) != '') {
                            $j++;
                            $retorno["clasi1510"][$j] = trim($clas->item($i)->textContent);
                        }
                    }
                }
                unset($clas);

                $clas = $reg->getElementsByTagName("clasi1510");
                if (count($clas) > 0) {
                    foreach ($clas as $cla) {
                        $i++;
                        if (trim($clas->item($i)->textContent) != '') {
                            $j++;
                            $retorno["clasi1510"][$j] = trim($clas->item($i)->textContent);
                        }
                    }
                }
                unset($clas);

                // Informaci&oacute;n financiera - Decreto 1510
                if (isset($reg->getElementsByTagName("inffin1510_fechacorte")->item(0)->textContent)) {
                    $retorno["inffin1510_fechacorte"] = $reg->getElementsByTagName("inffin1510_fechacorte")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("inffin1510_actcte")->item(0)->textContent)) {
                    $retorno["inffin1510_actcte"] = $reg->getElementsByTagName("inffin1510_actcte")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("inffin1510_actnocte")->item(0)->textContent)) {
                    $retorno["inffin1510_actnocte"] = $reg->getElementsByTagName("inffin1510_actnocte")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("inffin1510_fijnet")->item(0)->textContent)) {
                    $retorno["inffin1510_fijnet"] = $reg->getElementsByTagName("inffin1510_fijnet")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("inffin1510_actotr")->item(0)->textContent)) {
                    $retorno["inffin1510_actotr"] = $reg->getElementsByTagName("inffin1510_actotr")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("inffin1510_actval")->item(0)->textContent)) {
                    $retorno["inffin1510_actval"] = $reg->getElementsByTagName("inffin1510_actval")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("inffin1510_acttot")->item(0)->textContent)) {
                    $retorno["inffin1510_acttot"] = $reg->getElementsByTagName("inffin1510_acttot")->item(0)->textContent;
                }

                if (isset($reg->getElementsByTagName("inffin1510_pascte")->item(0)->textContent)) {
                    $retorno["inffin1510_pascte"] = $reg->getElementsByTagName("inffin1510_pascte")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("inffin1510_paslar")->item(0)->textContent)) {
                    $retorno["inffin1510_paslar"] = $reg->getElementsByTagName("inffin1510_paslar")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("inffin1510_pastot")->item(0)->textContent)) {
                    $retorno["inffin1510_pastot"] = $reg->getElementsByTagName("inffin1510_pastot")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("inffin1510_patnet")->item(0)->textContent)) {
                    $retorno["inffin1510_patnet"] = $reg->getElementsByTagName("inffin1510_patnet")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("inffin1510_paspat")->item(0)->textContent)) {
                    $retorno["inffin1510_paspat"] = $reg->getElementsByTagName("inffin1510_paspat")->item(0)->textContent;
                }
                $retorno["inffin1510_paspat"] = doubleval($retorno["inffin1510_pastot"]) + doubleval($retorno["inffin1510_patnet"]);
                if (isset($reg->getElementsByTagName("inffin1510_balsoc")->item(0)->textContent)) {
                    $retorno["inffin1510_balsoc"] = $reg->getElementsByTagName("inffin1510_balsoc")->item(0)->textContent;
                }

                if (isset($reg->getElementsByTagName("inffin1510_ingope")->item(0)->textContent)) {
                    $retorno["inffin1510_ingope"] = $reg->getElementsByTagName("inffin1510_ingope")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("inffin1510_ingnoope")->item(0)->textContent)) {
                    $retorno["inffin1510_ingnoope"] = $reg->getElementsByTagName("inffin1510_ingnoope")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("inffin1510_gasope")->item(0)->textContent)) {
                    $retorno["inffin1510_gasope"] = $reg->getElementsByTagName("inffin1510_gasope")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("inffin1510_gasnoope")->item(0)->textContent)) {
                    $retorno["inffin1510_gasnoope"] = $reg->getElementsByTagName("inffin1510_gasnoope")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("inffin1510_cosven")->item(0)->textContent)) {
                    $retorno["inffin1510_cosven"] = $reg->getElementsByTagName("inffin1510_cosven")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("inffin1510_utinet")->item(0)->textContent)) {
                    $retorno["inffin1510_utinet"] = $reg->getElementsByTagName("inffin1510_utinet")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("inffin1510_utiope")->item(0)->textContent)) {
                    $retorno["inffin1510_utiope"] = $reg->getElementsByTagName("inffin1510_utiope")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("inffin1510_gasint")->item(0)->textContent)) {
                    $retorno["inffin1510_gasint"] = $reg->getElementsByTagName("inffin1510_gasint")->item(0)->textContent;
                }
                if (isset($reg->getElementsByTagName("inffin1510_gasimp")->item(0)->textContent)) {
                    $retorno["inffin1510_gasimp"] = $reg->getElementsByTagName("inffin1510_gasimp")->item(0)->textContent;
                }

                if (isset($reg->getElementsByTagName("inffin1510_indliq")->item(0)->textContent)) {
                    if ($reg->getElementsByTagName("inffin1510_indliq")->item(0)->textContent == '999') {
                        $retorno["inffin1510_indliq"] = 'INDEFINIDO';
                    } else {
                        $retorno["inffin1510_indliq"] = $reg->getElementsByTagName("inffin1510_indliq")->item(0)->textContent;
                    }
                }

                if (isset($reg->getElementsByTagName("inffin1510_nivend")->item(0)->textContent)) {
                    if ($reg->getElementsByTagName("inffin1510_nivend")->item(0)->textContent == '999') {
                        $retorno["inffin1510_nivend"] = 'INDEFINIDO';
                    } else {
                        $retorno["inffin1510_nivend"] = $reg->getElementsByTagName("inffin1510_nivend")->item(0)->textContent;
                    }
                }

                if (isset($reg->getElementsByTagName("inffin1510_razcob")->item(0)->textContent)) {
                    if ($reg->getElementsByTagName("inffin1510_razcob")->item(0)->textContent == '999') {
                        $retorno["inffin1510_razcob"] = 'INDEFINIDO';
                    } else {
                        $retorno["inffin1510_razcob"] = $reg->getElementsByTagName("inffin1510_razcob")->item(0)->textContent;
                    }
                }

                if (isset($reg->getElementsByTagName("inffin1510_renpat")->item(0)->textContent)) {
                    if ($reg->getElementsByTagName("inffin1510_renpat")->item(0)->textContent == '999') {
                        $retorno["inffin1510_renpat"] = 'INDEFINIDO';
                    } else {
                        $retorno["inffin1510_renpat"] = $reg->getElementsByTagName("inffin1510_renpat")->item(0)->textContent;
                    }
                }

                if (isset($reg->getElementsByTagName("inffin1510_renact")->item(0)->textContent)) {
                    if ($reg->getElementsByTagName("inffin1510_renact")->item(0)->textContent == '999') {
                        $retorno["inffin1510_renact"] = 'INDEFINIDO';
                    } else {
                        $retorno["inffin1510_renact"] = $reg->getElementsByTagName("inffin1510_renact")->item(0)->textContent;
                    }
                }

                //
                $retorno["inffin1510_actnocte"] = $retorno["inffin1510_actnocte"] +
                        $retorno["inffin1510_fijnet"] +
                        $retorno["inffin1510_actotr"] +
                        $retorno["inffin1510_actval"];

                if (isset($reg->getElementsByTagName("inffin1510_gruponiif")->item(0)->textContent)) {
                    $retorno["inffin1510_gruponiif"] = $reg->getElementsByTagName("inffin1510_gruponiif")->item(0)->textContent;
                }

                /*        	  
                 * Experiencia decreto 1510
                 * Celebrado por: 
                 * 1.- El proponente
                 * 2.- Accionista
                 * 3.- Consorcio o union temporal
                 */

                $cont = $reg->getElementsByTagName("exp1510");
                if (count($cont) > 0) {
                    foreach ($cont as $cnt) {
                        if (strlen(ltrim(trim($cnt->getElementsByTagName("secuencia")->item(0)->textContent), "0")) <= 3) {
                            $sec = sprintf("%03s", ltrim(trim($cnt->getElementsByTagName("secuencia")->item(0)->textContent), "0"));
                        } else {
                            $sec = ltrim(trim($cnt->getElementsByTagName("secuencia")->item(0)->textContent), "0");
                        }
                        $ind = intval($sec);
                        $retorno["exp1510"][$ind]["secuencia"] = $sec;
                        if (isset($cnt->getElementsByTagName("clavecontrato")->item(0)->textContent)) {
                            $retorno["exp1510"][$ind]["clavecontrato"] = trim(\funcionesSii2::restaurarEspeciales($cnt->getElementsByTagName("clavecontrato")->item(0)->textContent));
                        } else {
                            $retorno["exp1510"][$ind]["clavecontrato"] = '';
                        }
                        $retorno["exp1510"][$ind]["celebradopor"] = trim(\funcionesSii2::restaurarEspeciales($cnt->getElementsByTagName("celebradopor")->item(0)->textContent));
                        $retorno["exp1510"][$ind]["nombrecontratista"] = trim(\funcionesSii2::restaurarEspeciales($cnt->getElementsByTagName("nombrecontratista")->item(0)->textContent));
                        $retorno["exp1510"][$ind]["nombrecontratante"] = trim(\funcionesSii2::restaurarEspeciales($cnt->getElementsByTagName("nombrecontratante")->item(0)->textContent));
                        if (isset($cnt->getElementsByTagName("fecejecucion")->item(0)->textContent)) {
                            $retorno["exp1510"][$ind]["fecejecucion"] = trim(\funcionesSii2::restaurarEspeciales($cnt->getElementsByTagName("fecejecucion")->item(0)->textContent));
                        } else {
                            $retorno["exp1510"][$ind]["fecejecucion"] = '';
                        }
                        if (isset($cnt->getElementsByTagName("valorpesos")->item(0)->textContent)) {
                            $retorno["exp1510"][$ind]["valorpesos"] = $cnt->getElementsByTagName("valorpesos")->item(0)->textContent;
                        } else {
                            $retorno["exp1510"][$ind]["valorpesos"] = 0;
                        }
                        $retorno["exp1510"][$ind]["valor"] = trim(\funcionesSii2::restaurarEspeciales($cnt->getElementsByTagName("valor")->item(0)->textContent));
                        $retorno["exp1510"][$ind]["porcentaje"] = trim(\funcionesSii2::restaurarEspeciales($cnt->getElementsByTagName("porcentaje")->item(0)->textContent));
                        $clas = $cnt->getElementsByTagName("clasif");
                        $iCla = 0;
                        foreach ($clas as $c) {
                            $iCla++;
                            $retorno["exp1510"][$ind]["clasif"][$iCla] = $c->textContent;
                        }
                        if (isset($cnt->getElementsByTagName("generardeclaracion")->item(0)->textContent)) {
                            $retorno["exp1510"][$ind]["generardeclaracion"] = $cnt->getElementsByTagName("generardeclaracion")->item(0)->textContent;
                        } else {
                            $retorno["exp1510"][$ind]["generardeclaracion"] = '';
                        }
                        $retorno["exp1510"][$ind]["soportedeclaracion"] = '';
                        $retorno["exp1510"][$ind]["soportecontrato"] = '';
                        $retorno["exp1510"][$ind]["revisado"] = '';
                        if (ltrim($retorno["numeroliquidacion"], "0") != '') {
                            $rets = retornarRegistro('mreg_revision_experiencia', "idliquidacion=" . $retorno["numeroliquidacion"] . " and secuencia='" . $sec . "'");
                            if ($rets && !empty($rets)) {
                                if (substr($rets["controlcalidad"], 0, 2) == 'si') {
                                    $retorno["exp1510"][$ind]["revisado"] = $rets["controlcalidad"];
                                }
                            }
                        }
                    }
                }
                unset($cont);
                if (!empty($retorno["exp1510"])) {
                    $temx = \funcionesSii2::ordenarMatriz($retorno["exp1510"], "secuencia");
                    $retorno["exp1510"] = array();
                    $iCon = 0;
                    foreach ($temx as $t) {
                        $iCon++;
                        $retorno["exp1510"][$iCon] = $t;
                    }
                    unset($temx);
                }

                // Bienes
                $retorno["bienes"] = array();
                $i = 0;
                $bies = $reg->getElementsByTagName("bien");
                if (!empty($bies)) {
                    foreach ($bies as $bie) {
                        $i++;
                        $retorno["bienes"][$i]["matinmo"] = $bie->getElementsByTagName("matinmo")->item(0)->textContent;
                        $retorno["bienes"][$i]["dir"] = $bie->getElementsByTagName("dir")->item(0)->textContent;
                        $retorno["bienes"][$i]["barrio"] = $bie->getElementsByTagName("barrio")->item(0)->textContent;
                        $retorno["bienes"][$i]["muni"] = $bie->getElementsByTagName("muni")->item(0)->textContent;
                        $retorno["bienes"][$i]["pais"] = $bie->getElementsByTagName("pais")->item(0)->textContent;
                    }
                }
                unset($bies);
                unset($bie);


                // Contratos mults y sanciones
                $retorno["contratos"] = array();
                $retorno["multas"] = array();
                $retorno["sanciones"] = array();
                $retorno["sandis"] = array();


                // Desserializa informacion de contratos de entidades del estado
                $i = 0;
                $contratos = $reg->getElementsByTagName("contrato");
                if (count($contratos) > 0) {
                    foreach ($contratos as $contrato) {
                        $i++;
                        if (isset($contrato->getElementsByTagName("isn")->item(0)->textContent)) {
                            $retorno["contratos"][$i]["isn"] = ltrim($contrato->getElementsByTagName("isn")->item(0)->textContent, "0");
                        } else {
                            $retorno["contratos"][$i]["isn"] = '';
                        }
                        $retorno["contratos"][$i]["codcamara"] = ltrim($contrato->getElementsByTagName("codcamara")->item(0)->textContent, "0");
                        $retorno["contratos"][$i]["numradic"] = ltrim($contrato->getElementsByTagName("numradic")->item(0)->textContent, "0");
                        $retorno["contratos"][$i]["fecradic"] = ltrim($contrato->getElementsByTagName("fecradic")->item(0)->textContent, "0");
                        $retorno["contratos"][$i]["horradic"] = trim($contrato->getElementsByTagName("horradic")->item(0)->textContent);
                        $retorno["contratos"][$i]["fecreporte"] = ltrim($contrato->getElementsByTagName("fecreporte")->item(0)->textContent, "0");
                        $retorno["contratos"][$i]["nitentidad"] = ltrim($contrato->getElementsByTagName("nitentidad")->item(0)->textContent, "0");
                        $retorno["contratos"][$i]["nombreentidad"] = (trim(\funcionesSii2::restaurarEspeciales($contrato->getElementsByTagName("nombreentidad")->item(0)->textContent)));
                        $retorno["contratos"][$i]["idmunientidad"] = trim($contrato->getElementsByTagName("idmunientidad")->item(0)->textContent);
                        $retorno["contratos"][$i]["divarea"] = trim($contrato->getElementsByTagName("divarea")->item(0)->textContent);
                        $retorno["contratos"][$i]["idefun"] = ltrim($contrato->getElementsByTagName("idefun")->item(0)->textContent, "0");
                        $retorno["contratos"][$i]["nomfun"] = (trim(\funcionesSii2::restaurarEspeciales($contrato->getElementsByTagName("nomfun")->item(0)->textContent)));
                        $retorno["contratos"][$i]["carfun"] = trim($contrato->getElementsByTagName("carfun")->item(0)->textContent);
                        $retorno["contratos"][$i]["numcontrato"] = trim($contrato->getElementsByTagName("numcontrato")->item(0)->textContent);
                        if (isset($contrato->getElementsByTagName("numcontratosecop")->item(0)->textContent)) {
                            $retorno["contratos"][$i]["numcontratosecop"] = trim($contrato->getElementsByTagName("numcontratosecop")->item(0)->textContent);
                        } else {
                            $retorno["contratos"][$i]["numcontratosecop"] = '';
                        }
                        $retorno["contratos"][$i]["fechaadj"] = trim($contrato->getElementsByTagName("fechaadj")->item(0)->textContent);

                        //
                        (isset($contrato->getElementsByTagName("fechaper")->item(0)->textContent)) ?
                                        $retorno["contratos"][$i]["fechaper"] = trim($contrato->getElementsByTagName("fechaper")->item(0)->textContent) :
                                        $retorno["contratos"][$i]["fechaper"] = '';

                        //
                        $retorno["contratos"][$i]["fechaini"] = trim($contrato->getElementsByTagName("fechaini")->item(0)->textContent);
                        $retorno["contratos"][$i]["fechater"] = trim($contrato->getElementsByTagName("fechater")->item(0)->textContent);

                        //
                        (isset($contrato->getElementsByTagName("fechaeje")->item(0)->textContent)) ?
                                        $retorno["contratos"][$i]["fechaeje"] = trim($contrato->getElementsByTagName("fechaeje")->item(0)->textContent) :
                                        $retorno["contratos"][$i]["fechaeje"] = '';

                        //
                        (isset($contrato->getElementsByTagName("fechaliq")->item(0)->textContent)) ?
                                        $retorno["contratos"][$i]["fechaliq"] = trim($contrato->getElementsByTagName("fechaliq")->item(0)->textContent) :
                                        $retorno["contratos"][$i]["fechaliq"] = '';

                        //
                        (isset($contrato->getElementsByTagName("codigoact")->item(0)->textContent)) ?
                                        $retorno["contratos"][$i]["codigoact"] = trim($contrato->getElementsByTagName("codigoact")->item(0)->textContent) :
                                        $retorno["contratos"][$i]["codigoact"] = '';

                        //
                        (isset($contrato->getElementsByTagName("ciiu1")->item(0)->textContent)) ?
                                        $retorno["contratos"][$i]["ciiu1"] = trim($contrato->getElementsByTagName("ciiu1")->item(0)->textContent) :
                                        $retorno["contratos"][$i]["ciiu1"] = '';

                        //
                        (isset($contrato->getElementsByTagName("ciiu2")->item(0)->textContent)) ?
                                        $retorno["contratos"][$i]["ciiu2"] = trim($contrato->getElementsByTagName("ciiu2")->item(0)->textContent) :
                                        $retorno["contratos"][$i]["ciiu2"] = '';

                        //
                        (isset($contrato->getElementsByTagName("ciiu3")->item(0)->textContent)) ?
                                        $retorno["contratos"][$i]["ciiu3"] = trim($contrato->getElementsByTagName("ciiu3")->item(0)->textContent) :
                                        $retorno["contratos"][$i]["ciiu3"] = '';

                        //
                        (isset($contrato->getElementsByTagName("ciiu4")->item(0)->textContent)) ?
                                        $retorno["contratos"][$i]["ciiu4"] = trim($contrato->getElementsByTagName("ciiu4")->item(0)->textContent) :
                                        $retorno["contratos"][$i]["ciiu4"] = '';

                        //
                        $retorno["contratos"][$i]["tipocont"] = trim($contrato->getElementsByTagName("tipocont")->item(0)->textContent);
                        $retorno["contratos"][$i]["valorcont"] = ltrim($contrato->getElementsByTagName("valorcont")->item(0)->textContent, "0");
                        $retorno["contratos"][$i]["valorcontpag"] = ltrim($contrato->getElementsByTagName("valorcontpag")->item(0)->textContent, "0");
                        $retorno["contratos"][$i]["indcump"] = trim($contrato->getElementsByTagName("indcump")->item(0)->textContent);
                        $retorno["contratos"][$i]["estadocont"] = trim($contrato->getElementsByTagName("estadocont")->item(0)->textContent);

                        //
                        (isset($contrato->getElementsByTagName("motivoter")->item(0)->textContent)) ?
                                        $retorno["contratos"][$i]["motivoter"] = trim($contrato->getElementsByTagName("motivoter")->item(0)->textContent) :
                                        $retorno["contratos"][$i]["motivoter"] = '';

                        //
                        (isset($contrato->getElementsByTagName("fechaterant")->item(0)->textContent)) ?
                                        $retorno["contratos"][$i]["fechaterant"] = trim($contrato->getElementsByTagName("fechaterant")->item(0)->textContent) :
                                        $retorno["contratos"][$i]["fechaterant"] = '';

                        //
                        (isset($contrato->getElementsByTagName("motivoces")->item(0)->textContent)) ?
                                        $retorno["contratos"][$i]["motivoces"] = trim($contrato->getElementsByTagName("motivoces")->item(0)->textContent) :
                                        $retorno["contratos"][$i]["motivoces"] = '';

                        //
                        (isset($contrato->getElementsByTagName("fechaces")->item(0)->textContent)) ?
                                        $retorno["contratos"][$i]["fechaces"] = trim($contrato->getElementsByTagName("fechaces")->item(0)->textContent) :
                                        $retorno["contratos"][$i]["fechaces"] = '';

                        //
                        (isset($contrato->getElementsByTagName("observaciones")->item(0)->textContent)) ?
                                        $retorno["contratos"][$i]["observaciones"] = trim($contrato->getElementsByTagName("observaciones")->item(0)->textContent) :
                                        $retorno["contratos"][$i]["observaciones"] = '';

                        //
                        $retorno["contratos"][$i]["numlibro"] = trim($contrato->getElementsByTagName("numlibro")->item(0)->textContent);
                        $retorno["contratos"][$i]["numreglib"] = trim($contrato->getElementsByTagName("numreglib")->item(0)->textContent);
                        $retorno["contratos"][$i]["fecreglib"] = trim($contrato->getElementsByTagName("fecreglib")->item(0)->textContent);

                        //
                        $retorno["contratos"][$i]["clasificaciones"] = array();
                        $clasif = $contrato->getElementsByTagName("clasicon");
                        $j = -1;
                        if (count($clasif) == 0) {
                            $retorno["contratos"][$i]["clasificaciones"] = array();
                        } else {
                            foreach ($clasif as $clas) {
                                $j++;
                                $retorno["contratos"][$i]["clasificaciones"][$j] = trim($clas->textContent);
                            }
                        }

                        //	
                        $retorno["contratos"][$i]["unspsc"] = array();
                        $clasif = $contrato->getElementsByTagName("unspsc");
                        $j = -1;
                        if (count($clasif) == 0) {
                            $retorno["contratos"][$i]["unspsc"] = array();
                        } else {
                            foreach ($clasif as $clas) {
                                $j++;
                                $retorno["contratos"][$i]["unspsc"][$j] = trim($clas->textContent);
                            }
                        }

                        //
                        $retorno["contratos"][$i]["objeto"] = '';
                        $descs = $contrato->getElementsByTagName("objeto");
                        if (count($descs) != 0) {
                            foreach ($descs as $des) {
                                $retorno["contratos"][$i]["objeto"] .= trim($des->textContent);
                            }
                        }
                        $retorno["contratos"][$i]["objeto"] = \funcionesSii2::restaurarEspeciales($retorno["contratos"][$i]["objeto"]);

                        //
                        if (isset($contrato->getElementsByTagName("codigocamaraorigen")->item(0)->textContent)) {
                            $retorno["contratos"][$i]["codigocamaraorigen"] = trim($contrato->getElementsByTagName("codigocamaraorigen")->item(0)->textContent);
                            $retorno["contratos"][$i]["numregistrocamaraorigen"] = trim($contrato->getElementsByTagName("numregistrocamaraorigen")->item(0)->textContent);
                            $retorno["contratos"][$i]["fecregistrocamaraorigen"] = trim($contrato->getElementsByTagName("fecregistrocamaraorigen")->item(0)->textContent);
                        } else {
                            $retorno["contratos"][$i]["codigocamaraorigen"] = '';
                            $retorno["contratos"][$i]["numregistrocamaraorigen"] = '';
                            $retorno["contratos"][$i]["fecregistrocamaraorigen"] = '';
                        }
                        $retorno["contratos"][$i]["indicadorenvio"] = '0';

                        //
                    }
                }

                // Desserializa informacion de multas
                $i = 0;
                $multas = $reg->getElementsByTagName("multa");
                if (count($multas) > 0) {
                    foreach ($multas as $multa) {
                        $i++;
                        if (isset($multa->getElementsByTagName("isn")->item(0)->textContent)) {
                            $retorno["multas"][$i]["isn"] = ltrim($multa->getElementsByTagName("isn")->item(0)->textContent, "0");
                        } else {
                            $retorno["multas"][$i]["isn"] = '';
                        }
                        $retorno["multas"][$i]["codcamara"] = ltrim($multa->getElementsByTagName("codcamara")->item(0)->textContent, "0");
                        $retorno["multas"][$i]["numradic"] = ltrim($multa->getElementsByTagName("numradic")->item(0)->textContent, "0");
                        $retorno["multas"][$i]["fecradic"] = ltrim($multa->getElementsByTagName("fecradic")->item(0)->textContent, "0");
                        $retorno["multas"][$i]["horradic"] = trim($multa->getElementsByTagName("horradic")->item(0)->textContent);
                        $retorno["multas"][$i]["fecreporte"] = ltrim($multa->getElementsByTagName("fecreporte")->item(0)->textContent, "0");
                        $retorno["multas"][$i]["nitentidad"] = ltrim($multa->getElementsByTagName("nitentidad")->item(0)->textContent, "0");
                        $retorno["multas"][$i]["nombreentidad"] = (trim(\funcionesSii2::restaurarEspeciales($multa->getElementsByTagName("nombreentidad")->item(0)->textContent)));
                        $retorno["multas"][$i]["idmunientidad"] = trim($multa->getElementsByTagName("idmunientidad")->item(0)->textContent);
                        $retorno["multas"][$i]["divarea"] = trim($multa->getElementsByTagName("divarea")->item(0)->textContent);
                        $retorno["multas"][$i]["idefun"] = ltrim($multa->getElementsByTagName("idefun")->item(0)->textContent, "0");
                        $retorno["multas"][$i]["nomfun"] = (trim(\funcionesSii2::restaurarEspeciales($multa->getElementsByTagName("nomfun")->item(0)->textContent)));
                        $retorno["multas"][$i]["carfun"] = trim($multa->getElementsByTagName("carfun")->item(0)->textContent);
                        $retorno["multas"][$i]["numcontrato"] = trim($multa->getElementsByTagName("numcontrato")->item(0)->textContent);
                        if (isset($multa->getElementsByTagName("numcontratosecop")->item(0)->textContent)) {
                            $retorno["multas"][$i]["numcontratosecop"] = trim($multa->getElementsByTagName("numcontratosecop")->item(0)->textContent);
                        } else {
                            $retorno["multas"][$i]["numcontratosecop"] = '';
                        }
                        $retorno["multas"][$i]["numacto"] = trim($multa->getElementsByTagName("numacto")->item(0)->textContent);
                        $retorno["multas"][$i]["fechaacto"] = trim($multa->getElementsByTagName("fechaacto")->item(0)->textContent);
                        (isset($multa->getElementsByTagName("fechaeje")->item(0)->textContent)) ?
                                        $retorno["multas"][$i]["fechaeje"] = trim($multa->getElementsByTagName("fechaeje")->item(0)->textContent) :
                                        $retorno["multas"][$i]["fechaeje"] = '';
                        $retorno["multas"][$i]["valormult"] = ltrim($multa->getElementsByTagName("valormult")->item(0)->textContent, "0");
                        $retorno["multas"][$i]["valormultpag"] = ltrim($multa->getElementsByTagName("valormultpag")->item(0)->textContent, "0");
                        (isset($multa->getElementsByTagName("numsus")->item(0)->textContent)) ?
                                        $retorno["multas"][$i]["numsus"] = trim($multa->getElementsByTagName("numsus")->item(0)->textContent) :
                                        $retorno["multas"][$i]["numsus"] = '';
                        (isset($multa->getElementsByTagName("fechasus")->item(0)->textContent)) ?
                                        $retorno["multas"][$i]["fechasus"] = trim($multa->getElementsByTagName("fechasus")->item(0)->textContent) :
                                        $retorno["multas"][$i]["fechasus"] = '';
                        (isset($multa->getElementsByTagName("numconf")->item(0)->textContent)) ?
                                        $retorno["multas"][$i]["numconf"] = trim($multa->getElementsByTagName("numconf")->item(0)->textContent) :
                                        $retorno["multas"][$i]["numconf"] = '';
                        (isset($multa->getElementsByTagName("fechaconf")->item(0)->textContent)) ?
                                        $retorno["multas"][$i]["fechaconf"] = trim($multa->getElementsByTagName("fechaconf")->item(0)->textContent) :
                                        $retorno["multas"][$i]["fechaconf"] = '';
                        $retorno["multas"][$i]["estadomult"] = trim($multa->getElementsByTagName("estadomult")->item(0)->textContent);
                        $retorno["multas"][$i]["numrev"] = trim($multa->getElementsByTagName("numrev")->item(0)->textContent);
                        $retorno["multas"][$i]["fechanumrev"] = trim($multa->getElementsByTagName("fechanumrev")->item(0)->textContent);
                        $retorno["multas"][$i]["numlibro"] = trim($multa->getElementsByTagName("numlibro")->item(0)->textContent);
                        $retorno["multas"][$i]["numreglib"] = trim($multa->getElementsByTagName("numreglib")->item(0)->textContent);
                        $retorno["multas"][$i]["fecreglib"] = trim($multa->getElementsByTagName("fecreglib")->item(0)->textContent);

                        if (isset($multa->getElementsByTagName("codigocamaraorigen")->item(0)->textContent)) {
                            $retorno["multas"][$i]["codigocamaraorigen"] = trim($multa->getElementsByTagName("codigocamaraorigen")->item(0)->textContent);
                            $retorno["multas"][$i]["numregistrocamaraorigen"] = trim($multa->getElementsByTagName("numregistrocamaraorigen")->item(0)->textContent);
                            $retorno["multas"][$i]["fecregistrocamaraorigen"] = trim($multa->getElementsByTagName("fecregistrocamaraorigen")->item(0)->textContent);
                        } else {
                            $retorno["multas"][$i]["codigocamaraorigen"] = '';
                            $retorno["multas"][$i]["numregistrocamaraorigen"] = '';
                            $retorno["multas"][$i]["fecregistrocamaraorigen"] = '';
                        }
                        $retorno["multas"][$i]["indicadorenvio"] = '0';

                        //
                        (isset($multa->getElementsByTagName("observaciones")->item(0)->textContent)) ?
                                        $retorno["multas"][$i]["observaciones"] = trim($multa->getElementsByTagName("observaciones")->item(0)->textContent) :
                                        $retorno["multas"][$i]["observaciones"] = '';
                    }
                }

                // Desserializa informacion de sanciones
                $i = 0;
                $sanciones = $reg->getElementsByTagName("sancion");
                if (count($sanciones) > 0) {
                    foreach ($sanciones as $sancion) {
                        $i++;
                        if (isset($sancion->getElementsByTagName("isn")->item(0)->textContent)) {
                            $retorno["sanciones"][$i]["isn"] = ltrim($sancion->getElementsByTagName("isn")->item(0)->textContent, "0");
                        } else {
                            $retorno["sanciones"][$i]["isn"] = '';
                        }
                        $retorno["sanciones"][$i]["codcamara"] = ltrim($sancion->getElementsByTagName("codcamara")->item(0)->textContent, "0");
                        $retorno["sanciones"][$i]["numradic"] = ltrim($sancion->getElementsByTagName("numradic")->item(0)->textContent, "0");
                        $retorno["sanciones"][$i]["fecradic"] = ltrim($sancion->getElementsByTagName("fecradic")->item(0)->textContent, "0");
                        $retorno["sanciones"][$i]["horradic"] = trim($sancion->getElementsByTagName("horradic")->item(0)->textContent);
                        $retorno["sanciones"][$i]["fecreporte"] = ltrim($sancion->getElementsByTagName("fecreporte")->item(0)->textContent, "0");
                        $retorno["sanciones"][$i]["nitentidad"] = ltrim($sancion->getElementsByTagName("nitentidad")->item(0)->textContent, "0");
                        $retorno["sanciones"][$i]["nombreentidad"] = (trim(\funcionesSii2::restaurarEspeciales($sancion->getElementsByTagName("nombreentidad")->item(0)->textContent)));
                        $retorno["sanciones"][$i]["idmunientidad"] = trim($sancion->getElementsByTagName("idmunientidad")->item(0)->textContent);
                        $retorno["sanciones"][$i]["divarea"] = trim($sancion->getElementsByTagName("divarea")->item(0)->textContent);
                        $retorno["sanciones"][$i]["idefun"] = ltrim($sancion->getElementsByTagName("idefun")->item(0)->textContent, "0");
                        $retorno["sanciones"][$i]["nomfun"] = (trim(\funcionesSii2::restaurarEspeciales($sancion->getElementsByTagName("nomfun")->item(0)->textContent)));
                        $retorno["sanciones"][$i]["carfun"] = trim($sancion->getElementsByTagName("carfun")->item(0)->textContent);
                        $retorno["sanciones"][$i]["numcontrato"] = trim($sancion->getElementsByTagName("numcontrato")->item(0)->textContent);
                        if (isset($sancion->getElementsByTagName("numcontratosecop")->item(0)->textContent)) {
                            $retorno["sanciones"][$i]["numcontratosecop"] = trim($sancion->getElementsByTagName("numcontratosecop")->item(0)->textContent);
                        } else {
                            $retorno["sanciones"][$i]["numcontratosecop"] = '';
                        }
                        $retorno["sanciones"][$i]["numacto"] = trim($sancion->getElementsByTagName("numacto")->item(0)->textContent);
                        $retorno["sanciones"][$i]["fechaacto"] = trim($sancion->getElementsByTagName("fechaacto")->item(0)->textContent);
                        (isset($sancion->getElementsByTagName("fechaeje")->item(0)->textContent)) ?
                                        $retorno["sanciones"][$i]["fechaeje"] = trim($sancion->getElementsByTagName("fechaeje")->item(0)->textContent) :
                                        $retorno["sanciones"][$i]["fechaeje"] = '';
                        (isset($sancion->getElementsByTagName("numsus")->item(0)->textContent)) ?
                                        $retorno["sanciones"][$i]["numsus"] = trim($sancion->getElementsByTagName("numsus")->item(0)->textContent) :
                                        $retorno["sanciones"][$i]["numsus"] = '';
                        (isset($sancion->getElementsByTagName("fechasus")->item(0)->textContent)) ?
                                        $retorno["sanciones"][$i]["fechasus"] = trim($sancion->getElementsByTagName("fechasus")->item(0)->textContent) :
                                        $retorno["sanciones"][$i]["fechasus"] = '';
                        (isset($sancion->getElementsByTagName("numconf")->item(0)->textContent)) ?
                                        $retorno["sanciones"][$i]["numconf"] = trim($sancion->getElementsByTagName("numconf")->item(0)->textContent) :
                                        $retorno["sanciones"][$i]["numconf"] = '';
                        (isset($sancion->getElementsByTagName("fechaconf")->item(0)->textContent)) ?
                                        $retorno["sanciones"][$i]["fechaconf"] = trim($sancion->getElementsByTagName("fechaconf")->item(0)->textContent) :
                                        $retorno["sanciones"][$i]["fechaconf"] = '';
                        (isset($sancion->getElementsByTagName("estadosanc")->item(0)->textContent)) ?
                                        $retorno["sanciones"][$i]["estadosanc"] = trim($sancion->getElementsByTagName("estadosanc")->item(0)->textContent) :
                                        $retorno["sanciones"][$i]["estadosanc"] = '';
                        (isset($sancion->getElementsByTagName("condinc")->item(0)->textContent)) ?
                                        $retorno["sanciones"][$i]["condinc"] = trim($sancion->getElementsByTagName("condinc")->item(0)->textContent) :
                                        $retorno["sanciones"][$i]["condinc"] = '';
                        (isset($sancion->getElementsByTagName("cumsanc")->item(0)->textContent)) ?
                                        $retorno["sanciones"][$i]["cumsanc"] = trim($sancion->getElementsByTagName("cumsanc")->item(0)->textContent) :
                                        $retorno["sanciones"][$i]["cumsanc"] = '';

                        $retorno["sanciones"][$i]["numrev"] = trim($sancion->getElementsByTagName("numrev")->item(0)->textContent);
                        $retorno["sanciones"][$i]["fechanumrev"] = trim($sancion->getElementsByTagName("fechanumrev")->item(0)->textContent);
                        $retorno["sanciones"][$i]["numlibro"] = trim($sancion->getElementsByTagName("numlibro")->item(0)->textContent);
                        $retorno["sanciones"][$i]["numreglib"] = trim($sancion->getElementsByTagName("numreglib")->item(0)->textContent);
                        $retorno["sanciones"][$i]["fecreglib"] = trim($sancion->getElementsByTagName("fecreglib")->item(0)->textContent);

                        //
                        $retorno["sanciones"][$i]["descripcion"] = '';
                        $descs = $sancion->getElementsByTagName("dessanc");
                        if (count($descs) != 0) {
                            foreach ($descs as $des) {
                                $retorno["sanciones"][$i]["descripcion"] .= trim($des->textContent);
                            }
                        }
                        $retorno["sanciones"][$i]["descripcion"] = \funcionesSii2::restaurarEspeciales($retorno["sanciones"][$i]["descripcion"]);

                        //
                        $retorno["sanciones"][$i]["fundamento"] = '';
                        $descs = $sancion->getElementsByTagName("fundame");
                        if (count($descs) != 0) {
                            foreach ($descs as $des) {
                                $retorno["sanciones"][$i]["fundamento"] .= trim($des->textContent);
                            }
                        }
                        $retorno["sanciones"][$i]["fundamento"] = \funcionesSii2::restaurarEspeciales($retorno["sanciones"][$i]["fundamento"]);

                        if (isset($sancion->getElementsByTagName("vigencia")->item(0)->textContent)) {
                            $retorno["sanciones"][$i]["vigencia"] = trim($sancion->getElementsByTagName("vigencia")->item(0)->textContent);
                        } else {
                            $retorno["sanciones"][$i]["vigencia"] = '';
                        }

                        if (isset($sancion->getElementsByTagName("codigocamaraorigen")->item(0)->textContent)) {
                            $retorno["sanciones"][$i]["codigocamaraorigen"] = trim($sancion->getElementsByTagName("codigocamaraorigen")->item(0)->textContent);
                            $retorno["sanciones"][$i]["numregistrocamaraorigen"] = trim($sancion->getElementsByTagName("numregistrocamaraorigen")->item(0)->textContent);
                            $retorno["sanciones"][$i]["fecregistrocamaraorigen"] = trim($sancion->getElementsByTagName("fecregistrocamaraorigen")->item(0)->textContent);
                        } else {
                            $retorno["sanciones"][$i]["codigocamaraorigen"] = '';
                            $retorno["sanciones"][$i]["numregistrocamaraorigen"] = '';
                            $retorno["sanciones"][$i]["fecregistrocamaraorigen"] = '';
                        }
                        $retorno["sanciones"][$i]["indicadorenvio"] = '0';
                    }
                }

                // Desserializa informacion de sanciones
                $i = 0;
                $sandisc = $reg->getElementsByTagName("sandis");
                if (count($sandisc) > 0) {
                    foreach ($sandisc as $sancion) {
                        $i++;
                        if (isset($sancion->getElementsByTagName("isn")->item(0)->textContent)) {
                            $retorno["sandis"][$i]["isn"] = ltrim($sancion->getElementsByTagName("isn")->item(0)->textContent, "0");
                        } else {
                            $retorno["sandis"][$i]["isn"] = '';
                        }
                        $retorno["sandis"][$i]["codcamara"] = ltrim($sancion->getElementsByTagName("codcamara")->item(0)->textContent, "0");
                        $retorno["sandis"][$i]["numradic"] = ltrim($sancion->getElementsByTagName("numradic")->item(0)->textContent, "0");
                        $retorno["sandis"][$i]["fecradic"] = ltrim($sancion->getElementsByTagName("fecradic")->item(0)->textContent, "0");
                        $retorno["sandis"][$i]["horradic"] = trim($sancion->getElementsByTagName("horradic")->item(0)->textContent);
                        $retorno["sandis"][$i]["fecreporte"] = ltrim($sancion->getElementsByTagName("fecreporte")->item(0)->textContent, "0");
                        $retorno["sandis"][$i]["nitentidad"] = ltrim($sancion->getElementsByTagName("nitentidad")->item(0)->textContent, "0");
                        $retorno["sandis"][$i]["nombreentidad"] = (trim($sancion->getElementsByTagName("nombreentidad")->item(0)->textContent));
                        $retorno["sandis"][$i]["idmunientidad"] = trim($sancion->getElementsByTagName("idmunientidad")->item(0)->textContent);
                        $retorno["sandis"][$i]["divarea"] = trim($sancion->getElementsByTagName("divarea")->item(0)->textContent);
                        $retorno["sandis"][$i]["idefun"] = ltrim($sancion->getElementsByTagName("idefun")->item(0)->textContent, "0");
                        $retorno["sandis"][$i]["nomfun"] = (trim($sancion->getElementsByTagName("nomfun")->item(0)->textContent));
                        $retorno["sandis"][$i]["carfun"] = trim($sancion->getElementsByTagName("carfun")->item(0)->textContent);

                        if (isset($sancion->getElementsByTagName("numcontratosecop")->item(0)->textContent)) {
                            $retorno["sandis"][$i]["numcontratosecop"] = trim($sancion->getElementsByTagName("numcontratosecop")->item(0)->textContent);
                        } else {
                            $retorno["sandis"][$i]["numcontratosecop"] = '';
                        }

                        $retorno["sandis"][$i]["numacto"] = trim($sancion->getElementsByTagName("numacto")->item(0)->textContent);
                        $retorno["sandis"][$i]["fechaacto"] = trim($sancion->getElementsByTagName("fechaacto")->item(0)->textContent);
                        (isset($sancion->getElementsByTagName("fechaeje")->item(0)->textContent)) ?
                                        $retorno["sandis"][$i]["fechaeje"] = trim($sancion->getElementsByTagName("fechaeje")->item(0)->textContent) :
                                        $retorno["sandis"][$i]["fechaeje"] = '';
                        (isset($sancion->getElementsByTagName("numsus")->item(0)->textContent)) ?
                                        $retorno["sandis"][$i]["numsus"] = trim($sancion->getElementsByTagName("numsus")->item(0)->textContent) :
                                        $retorno["sandis"][$i]["numsus"] = '';
                        (isset($sancion->getElementsByTagName("fechasus")->item(0)->textContent)) ?
                                        $retorno["sandis"][$i]["fechasus"] = trim($sancion->getElementsByTagName("fechasus")->item(0)->textContent) :
                                        $retorno["sandis"][$i]["fechasus"] = '';
                        (isset($sancion->getElementsByTagName("numconf")->item(0)->textContent)) ?
                                        $retorno["sandis"][$i]["numconf"] = trim($sancion->getElementsByTagName("numconf")->item(0)->textContent) :
                                        $retorno["sandis"][$i]["numconf"] = '';
                        (isset($sancion->getElementsByTagName("fechaconf")->item(0)->textContent)) ?
                                        $retorno["sandis"][$i]["fechaconf"] = trim($sancion->getElementsByTagName("fechaconf")->item(0)->textContent) :
                                        $retorno["sandis"][$i]["fechaconf"] = '';
                        (isset($sancion->getElementsByTagName("estadosanc")->item(0)->textContent)) ?
                                        $retorno["sandis"][$i]["estadosanc"] = trim($sancion->getElementsByTagName("estadosanc")->item(0)->textContent) :
                                        $retorno["sandis"][$i]["estadosanc"] = '';
                        $retorno["sandis"][$i]["numrev"] = trim($sancion->getElementsByTagName("numrev")->item(0)->textContent);
                        $retorno["sandis"][$i]["fechanumrev"] = trim($sancion->getElementsByTagName("fechanumrev")->item(0)->textContent);
                        $retorno["sandis"][$i]["numlibro"] = trim($sancion->getElementsByTagName("numlibro")->item(0)->textContent);
                        $retorno["sandis"][$i]["numreglib"] = trim($sancion->getElementsByTagName("numreglib")->item(0)->textContent);
                        $retorno["sandis"][$i]["fecreglib"] = trim($sancion->getElementsByTagName("fecreglib")->item(0)->textContent);

                        //
                        $retorno["sandis"][$i]["descripcion"] = '';
                        $descs = $sancion->getElementsByTagName("dessanc");
                        if (count($descs) != 0) {
                            foreach ($descs as $des) {
                                $retorno["sandis"][$i]["descripcion"] .= trim($des->textContent);
                            }
                        }

                        //
                        $retorno["sandis"][$i]["fundamento"] = '';
                        $descs = $sancion->getElementsByTagName("fundame");
                        if (count($descs) != 0) {
                            foreach ($descs as $des) {
                                $retorno["sandis"][$i]["fundamento"] .= trim($des->textContent);
                            }
                        }

                        if (isset($sancion->getElementsByTagName("vigencia")->item(0)->textContent)) {
                            $retorno["sandis"][$i]["vigencia"] = trim($contrato->getElementsByTagName("vigencia")->item(0)->textContent);
                        } else {
                            $retorno["sandis"][$i]["vigencia"] = '';
                        }

                        if (isset($sancion->getElementsByTagName("codigocamaraorigen")->item(0)->textContent)) {
                            $retorno["sandis"][$i]["codigocamaraorigen"] = trim($sancion->getElementsByTagName("codigocamaraorigen")->item(0)->textContent);
                            $retorno["sandis"][$i]["numregistrocamaraorigen"] = trim($sancion->getElementsByTagName("numregistrocamaraorigen")->item(0)->textContent);
                            $retorno["sandis"][$i]["fecregistrocamaraorigen"] = trim($sancion->getElementsByTagName("fecregistrocamaraorigen")->item(0)->textContent);
                        } else {
                            $retorno["sandis"][$i]["codigocamaraorigen"] = '';
                            $retorno["sandis"][$i]["numregistrocamaraorigen"] = '';
                            $retorno["sandis"][$i]["fecregistrocamaraorigen"] = '';
                        }

                        $retorno["sandis"][$i]["indicadorenvio"] = '0';
                    }
                }
            }

            // Verifica si en el XML hay grupos modificados
            $retorno["gruposmodificados"] = array();
            // if ($dom->getElementsByTagName("codigocamaraorigen") != null) {
            if ($dom->getElementsByTagName("gruposmodificados") != null) {
                $reg1 = $dom->getElementsByTagName("gruposmodificados");
                foreach ($reg1 as $reg) {
                    $gm = $reg->getElementsByTagName("grupo");
                    if (count($gm) > 0) {
                        foreach ($gm as $g) {
                            $retorno["gruposmodificados"][$g->textContent] = $g->textContent;
                        }
                    }
                }
            }
            unset($gm);
            unset($reg);
            unset($reg1);
            unset($dom);
        }
        return $retorno;
    }

    public static function diferenciaEntreFechasCalendario($fecha_principal, $fecha_secundaria, $obtener = 'DIAS', $redondear = true) {
        date_default_timezone_set($_SESSION["generales"]["zonahoraria"]);
        $f0 = strtotime($fecha_principal);
        $f1 = strtotime($fecha_secundaria);
        if ($f0 < $f1) {
            $tmp = $f1;
            $f1 = $f0;
            $f0 = $tmp;
        }
        $resultado = ($f0 - $f1);
        switch ($obtener) {
            default: break;
            case "MINUTOS" : $resultado = $resultado / 60;
                break;
            case "HORAS" : $resultado = $resultado / 60 / 60;
                break;
            case "DIAS" :
                $resultado = $resultado / 60 / 60 / 24;
                // $resultado = $resultado+1;   
                break;
            case "SEMANAS" : $resultado = $resultado / 60 / 60 / 24 / 7;
                break;
            case "MESES" : $resultado = $resultado / 60 / 60 / 24 / 30;
                break;
            case "ANOS" : $resultado = $resultado / 60 / 60 / 24 / 30 / 12;
                break;
        }
        if ($redondear) {
            $resultado = round($resultado);
        }
        return $resultado;
    }

    public static function dumpArregloSii($arreglo) {
        $txt = '';
        foreach ($arreglo as $key => $valor) {
            if (!is_array($valor)) {
                if ($valor != '') {
                    $txt .= $key . ' => ' . $valor . chr(13) . chr(10);
                }
            } else {
                $txt .= $key . '(arreglo)' . chr(13) . chr(10);
                foreach ($valor as $key1 => $valor1) {
                    if (!is_array($valor1)) {
                        if ($valor1 != '') {
                            $txt .= '..... ' . $key1 . ' => ' . $valor1 . chr(13) . chr(10);
                        }
                    } else {
                        $txt .= '..... ' . $key1 . '(arreglo)' . chr(13) . chr(10);
                        foreach ($valor1 as $key2 => $valor2) {
                            if (!is_array($valor2)) {
                                if ($valor2 != '') {
                                    $txt .= '.... ..... ' . $key2 . ' => ' . $valor2 . chr(13) . chr(10);
                                }
                            } else {
                                $txt .= '.... .... ' . $key2 . '(arreglo)' . chr(13) . chr(10);
                                foreach ($valor2 as $key3 => $valor3) {
                                    if (!is_array($valor3)) {
                                        if ($valor3 != '') {
                                            $txt .= '.... ..... .... ' . $key3 . ' => ' . $valor3 . chr(13) . chr(10);
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
        return $txt;
    }

    public static function encontrarPathImagen($dbx, $tam = 0, $directorio = 'mreg', $tipoanexo = '000') {
        $disco = intval(\funcionesSii2::localizarDiscoActual($dbx, $tipoanexo));
        if ($disco === false) {
            return false;
        }

        //
        if (ltrim($disco, "0") == '') {
            $disco = 1;
        }

        if (!defined('TIPO_REPOSITORIO_NUEVAS_IMAGENES')) {
            define('TIPO_REPOSITORIO_NUEVAS_IMAGENES', 'LOCAL');
        }

        $peso = 0;
        if (TIPO_REPOSITORIO_NUEVAS_IMAGENES == 'LOCAL' || TIPO_REPOSITORIO_NUEVAS_IMAGENES == '' || TIPO_REPOSITORIO_NUEVAS_IMAGENES == 'EFS_S3') {
            $path = PATH_ABSOLUTO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/' . $directorio;
            if (!is_dir($path) || !is_readable($path)) {
                mkdir($path, 0777);
                \funcionessii2::crearIndex($path);
            }

            // ubica el disco
            $ok = 'no';
            $limite = 0;
            while ($ok != 'si') {
                $path = PATH_ABSOLUTO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/' . $directorio . '/' . sprintf("%03s", $disco);
                if (!is_dir($path) || !is_readable($path)) {
                    mkdir($path, 0777);
                    \funcionessii2::crearIndex($path);
                }
                $salida = array();
                exec('du --block-size=1000 ' . $path, $salida);
                $list = explode("/", $salida[0]);
                $peso = intval(trim($list[0]));
                if ($peso < (TAMANO_DISCO_KB)) {
                    $ok = 'si';
                } else {
                    $disco++;
                    $limite++;
                    if ($limite == 100) {
                        $ok = 'si';
                    }
                }
            }
        }

        // SI el repositorio es Remoto
        if (TIPO_REPOSITORIO_NUEVAS_IMAGENES == 'WS') {
            $path = $_SESSION["generales"]["codigoempresa"] . '/' . $directorio;
            crearDirectorioWsRemoto($path);

            // ubica el disco
            $ok = 'no';
            $limite = 0;
            while ($ok != 'si') {
                $path = $_SESSION["generales"]["codigoempresa"] . '/' . $directorio . '/' . sprintf("%03s", $disco);
                crearDirectorioWsRemoto($path);
                $peso = tamanoDirectorioWsRemoto($path);
                if ($peso === false) {
                    $ok = 'si';
                } else {
                    if ($peso < (TAMANO_DISCO_KB)) {
                        $ok = 'si';
                    } else {
                        $disco++;
                        $limite++;
                        if ($limite == 100) {
                            $ok = 'si';
                        }
                    }
                }
            }
        }

        // SI el repositorio es Aws S3
        if (TIPO_REPOSITORIO_NUEVAS_IMAGENES == 'S3-V4') {
            $path = $_SESSION["generales"]["codigoempresa"] . '/' . $directorio;

            // ubica el disco
            $ok = 'no';
            $limite = 0;
            while ($ok != 'si') {
                $path = $_SESSION["generales"]["codigoempresa"] . '/' . $directorio . '/' . sprintf("%03s", $disco);
                $peso = intval(tamanoS3Version4($path));
                if ($peso === false) {
                    $ok = 'si';
                } else {
                    if ($peso < (TAMANO_DISCO_KB)) {
                        $ok = 'si';
                    } else {
                        $disco++;
                        $limite++;
                        if ($limite == 100) {
                            $ok = 'si';
                        }
                    }
                }
            }
        }


        if ($peso === false) {
            $_SESSION["generales"]["mensajeerror"] = 'No fue posible localizar el directorio a utilizar';
            return false;
        }

        //
        // Actualización del campo "disco" para el registro mercantil en claves-valor
        $arrTem = retornarRegistroMysqli2($dbx, 'bas_tipoanexodocumentos', "id='" . $tipoanexo . "'");
        if ($arrTem === false || empty($arrTem)) {
            $_SESSION["generales"]["mensajeerror"] = 'Imposible localizar tipo de anexo en tabla bas_tipoanexodocumentos';
            return false;
        }

        $arrTem1 = retornarRegistroMysqli2($dbx, 'bas_claves_valor', "idorden='" . $arrTem["clavevalor"] . "'");
        if ($arrTem1 === false) {
            $_SESSION["generales"]["mensajeerror"] = 'Imposible localizar tipo de anexo en tabla bas_claves_valor';
            return false;
        }

        //
        $arrCampos = array(
            'id',
            'valor'
        );
        $arrValores = array(
            $arrTem1["id"],
            "'" . sprintf("%03s", $disco) . "'"
        );

        //
        if (contarRegistrosMysqli2($dbx, 'claves_valor', "id=" . $arrTem1["id"]) == 0) {
            insertarRegistrosMysqli2($dbx, 'claves_valor', $arrCampos, $arrValores);
        } else {
            regrabarRegistrosMysqli2($dbx, 'claves_valor', $arrCampos, $arrValores, "id=" . $arrTem1["id"]);
        }

        //
        // Si el repositorio es Local
        if (TIPO_REPOSITORIO_NUEVAS_IMAGENES == 'LOCAL' || TIPO_REPOSITORIO_NUEVAS_IMAGENES == '' || TIPO_REPOSITORIO_NUEVAS_IMAGENES == 'EFS_S3') {
            // Crea el directorio base, si no existe
            if (!is_dir(PATH_ABSOLUTO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/' . $directorio)) {
                mkdir(PATH_ABSOLUTO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/' . $directorio, 0777);
                \funcionesSii2::crearIndex(PATH_ABSOLUTO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/' . $directorio);
            }

            // Crea el disco, si no existe
            if (!is_dir(PATH_ABSOLUTO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/' . $directorio . '/' . sprintf("%03s", $disco))) {
                mkdir(PATH_ABSOLUTO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/' . $directorio . '/' . sprintf("%03s", $disco), 0777);
                \funcionesSii2::crearIndex(PATH_ABSOLUTO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/' . $directorio . '/' . sprintf("%03s", $disco));
            }
        }

        //
        return $disco;
    }

    public static function diferenciaEntreFechaBase30($fechafinal, $fechainicial) {
        $fechafinal = str_replace(array("-", "/"), "", $fechafinal);
        $fechainicial = str_replace(array("-", "/"), "", $fechainicial);
        $iDias = 0;
        $iFecha = $fechainicial;
        while ($iFecha <= $fechafinal) {
            $ano = intval(substr($iFecha, 0, 4));
            $mes = intval(substr($iFecha, 4, 2));
            $dia = intval(substr($iFecha, 6, 2));

            if ($dia < 31) {
                $iDias++;
            }

            if ($dia == 31) {
                $dia = 1;
                $mes++;
                if ($mes == 13) {
                    $ano++;
                    $mes = 1;
                }
            } else {
                if ($dia == 30) {
                    if (($mes == 4) || ($mes == 6) || ($mes == 9) || ($mes == 11)) {
                        $dia = 1;
                        $mes++;
                    } else {
                        $dia++;
                    }
                } else {
                    if ($dia == 29) {
                        if (($mes == 2)) {
                            $dia = 1;
                            $mes++;
                            $iDias++;
                        } else {
                            $dia++;
                        }
                    } else {
                        if ($dia == 28) {
                            if (($mes == 2)) {
                                if (($ano != 2000) && ($ano != 2004) && ($ano != 2008) && ($ano != 2012) && ($ano != 2014) &&
                                        ($ano != 2018) && ($ano != 2022) && ($ano != 2026) && ($ano != 2030) && ($ano != 2034)) {
                                    $dia = 1;
                                    $mes++;
                                    $iDias++;
                                    $iDias++;
                                } else {
                                    $dia++;
                                }
                            } else {
                                $dia++;
                            }
                        } else {
                            $dia++;
                        }
                    }
                }
            }
            $iFecha = sprintf("%04s", $ano) . sprintf("%02s", $mes) . sprintf("%02s", $dia);
        }
        return $iDias;
    }

    public static function grabarAnexoRadicacion(
            $dbx, $idradicacion = 0, $numerorecibo = '', $numerooperacion = '', $identificacion = '', $nombre = '', $acreedor = '', $nombreacreedor = '', $matricula = '', $proponente = '', $idtipodoc = '', $numdoc = '', $fechadoc = '', $idorigendoc = '', $txtorigendoc = '', $idclasificacion = '', $numcontrato = '', $idfuente = '', $version = 1, $path = '', $estado = '', $fechaescaneo = '', $idusuarioescaneo = '', $idcajaarchivo = '', $idlibroarchivo = '', $observaciones = '', $libro = '', $registro = '', $bandeja = '', $soporterecibo = '', $identificador = '', $tipoanexo = '', $procesoespecial = ''
    ) {
        if (ltrim($idradicacion, "0") == '') {
            $idradicacion = '';
        }

        if (trim($libro) != '') {
            if (strlen($libro) == 2) {
                if ($bandeja == '6.-REGPRO') {
                    $libro = 'RP' . sprintf("%02s", $libro);
                } else {
                    if ($libro >= '01' && $libro <= '49') {
                        $libro = 'RM' . sprintf("%02s", $libro);
                    } else {
                        $libro = 'RE' . sprintf("%02s", $libro);
                    }
                }
            }
        }

        $arrCampos = array(
            'idradicacion',
            'numerorecibo',
            'numerooperacion',
            'libro',
            'registro',
            'identificacion',
            'nombre',
            'acreedor',
            'nombreacreedor',
            'matricula',
            'proponente',
            'idtipodoc',
            'numdoc',
            'fechadoc',
            'idorigendoc',
            'txtorigendoc',
            'idclasificacion',
            'numcontrato',
            'idfuente',
            'version',
            'path',
            'estado',
            'fechaescaneo',
            'idusuarioescaneo',
            'idcajaarchivo',
            'idlibroarchivo',
            'observaciones',
            'bandeja',
            'soporterecibo',
            'identificador',
            'tipoanexo',
            'procesosespeciales',
            'eliminado'
        );


        //
        $arrValores = array(
            "'" . ltrim($idradicacion, "0") . "'",
            "'" . $numerorecibo . "'",
            "'" . $numerooperacion . "'",
            "'" . $libro . "'",
            "'" . $registro . "'",
            "'" . $identificacion . "'",
            "'" . addslashes(strtoupper($nombre)) . "'",
            "'" . $acreedor . "'",
            "'" . addslashes(strtoupper($nombreacreedor)) . "'",
            "'" . $matricula . "'",
            "'" . $proponente . "'",
            "'" . $idtipodoc . "'",
            "'" . $numdoc . "'",
            "'" . $fechadoc . "'",
            "'" . $idorigendoc . "'",
            "'" . addslashes(strtoupper($txtorigendoc)) . "'",
            "'" . $idclasificacion . "'",
            "'" . $numcontrato . "'",
            "'" . $idfuente . "'",
            $version,
            "'" . $path . "'",
            "'" . $estado . "'",
            "'" . $fechaescaneo . "'",
            "'" . $idusuarioescaneo . "'",
            "'" . $idcajaarchivo . "'",
            "'" . $idlibroarchivo . "'",
            "'" . addslashes(strtoupper($observaciones)) . "'",
            "'" . $bandeja . "'",
            "'" . $soporterecibo . "'",
            "'" . $identificador . "'",
            "'" . $tipoanexo . "'",
            "'" . $procesoespecial . "'",
            "'NO'"
        );
        insertarRegistrosMysqli2($dbx, 'mreg_radicacionesanexos', $arrCampos, $arrValores, 'si');
        return $_SESSION["generales"]["lastId"];
    }

    public static function grabarHistoricos($dbx, $fecha = '', $hora = '', $mat = '', $pro = '', $tipoid = '', $numid = '', $nom = '', $tt = '', $reg = '', $lib = '', $numreg = '', $rec = '', $ope = '', $codbar = '', $xmlo = '', $xmlf = '', $usu = '', $ip = '') {
        $arrCampos = array(
            'fecha',
            'hora',
            'matricula',
            'proponente',
            'tipoidentificacion',
            'identificacion',
            'nombre',
            'tipotramite',
            'registro',
            'libro',
            'inscripcion',
            'recibo',
            'operacion',
            'codigobarras',
            'xmloriginal',
            'xmlfinal',
            'usuario',
            'ip'
        );
        $arrValores = array(
            "'" . $fecha . "'",
            "'" . $hora . "'",
            "'" . $mat . "'",
            "'" . $pro . "'",
            "'" . $tipoid . "'",
            "'" . $numid . "'",
            "'" . addslashes($nom) . "'",
            "'" . $tt . "'",
            "'" . $reg . "'",
            "'" . $lib . "'",
            "'" . $numreg . "'",
            "'" . $rec . "'",
            "'" . $ope . "'",
            "'" . $codbar . "'",
            "'" . addslashes($xmlo) . "'",
            "'" . addslashes($xmlf) . "'",
            "'" . $usu . "'",
            "'" . $ip . "'"
        );

        insertarRegistrosMysqli2($dbx, 'mreg_historicos_' . date("Y"), $arrCampos, $arrValores);
    }

    public static function grabarLiquidacionMregSii($dbx) {
        require_once ('sanarEntradas.class.php');

        //
        $conteo = contarRegistrosMysqli2($dbx, 'mreg_liquidacion', 'idliquidacion=' . $_SESSION["tramite"]["numeroliquidacion"]);
        if ($conteo === false) {
            $_SESSION["generales"]["mensajeerror"] = 'Error al ubicar la liquidación en mreg_liquidacion';
            return false;
        }

        //
        if (!isset($_SESSION["tramite"]["tipomatricula"])) {
            $_SESSION["tramite"]["tipomatricula"] = '';
        }

        if (!isset($_SESSION["tramite"]["subtipotramite"])) {
            $_SESSION["tramite"]["subtipotramite"] = '';
        }

        if (!isset($_SESSION["tramite"]["origen"])) {
            $_SESSION["tramite"]["origen"] = '';
        }

        if (!isset($_SESSION["tramite"]["sede"])) {
            $_SESSION["tramite"]["sede"] = '';
        }
        if ($_SESSION["tramite"]["sede"] == '') {
            if ($_SESSION["tramite"]["idusuario"] == 'USUPUBXX') {
                $_SESSION["tramite"]["sede"] = '99';
            } else {
                if ($_SESSION["tramite"]["idusuario"] == 'RUE') {
                    $_SESSION["tramite"]["sede"] = '90';
                } else {
                    if (!isset($_SESSION["generales"]["sedeusuario"])) {
                        $_SESSION["generales"]["sedeusuario"] = '01';
                    }
                    $_SESSION["tramite"]["sede"] = $_SESSION["generales"]["sedeusuario"];
                }
            }
        }
        if ($_SESSION["tramite"]["sede"] == '') {
            $_SESSION["tramite"]["sede"] = '01';
        }

        // Datos base
        if (!isset($_SESSION["tramite"]["matriculabase"])) {
            $_SESSION["tramite"]["matriculabase"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombrebase"])) {
            $_SESSION["tramite"]["nombrebase"] = '';
        }
        if (!isset($_SESSION["tramite"]["nom1base"])) {
            $_SESSION["tramite"]["nom1base"] = '';
        }
        if (!isset($_SESSION["tramite"]["nom2base"])) {
            $_SESSION["tramite"]["nom2base"] = '';
        }
        if (!isset($_SESSION["tramite"]["ape1base"])) {
            $_SESSION["tramite"]["ape1base"] = '';
        }
        if (!isset($_SESSION["tramite"]["ape2base"])) {
            $_SESSION["tramite"]["ape2base"] = '';
        }
        if (!isset($_SESSION["tramite"]["tipoidentificacionbase"])) {
            $_SESSION["tramite"]["tipoidentificacionbase"] = '';
        }
        if (!isset($_SESSION["tramite"]["identificacionbase"])) {
            $_SESSION["tramite"]["identificacionbase"] = '';
        }
        if (!isset($_SESSION["tramite"]["organizacionbase"])) {
            $_SESSION["tramite"]["organizacionbase"] = '';
        }
        if (!isset($_SESSION["tramite"]["categoriabase"])) {
            $_SESSION["tramite"]["categoriabase"] = '';
        }
        if (!isset($_SESSION["tramite"]["afiliadobase"])) {
            $_SESSION["tramite"]["afiliadobase"] = '';
        }

        if (!isset($_SESSION["tramite"]["idexpedientebase"])) {
            $_SESSION["tramite"]["idexpedientebase"] = '';
        }
        if (!isset($_SESSION["tramite"]["idmatriculabase"])) {
            $_SESSION["tramite"]["idmatriculabase"] = '';
        }
        if (!isset($_SESSION["tramite"]["idproponentebase"])) {
            $_SESSION["tramite"]["idproponentebase"] = '';
        }
        if (!isset($_SESSION["tramite"]["tipoproponente"])) {
            $_SESSION["tramite"]["tipoproponente"] = '';
        }

        // Datos del cliente
        if (!isset($_SESSION["tramite"]["tipocliente"])) {
            $_SESSION["tramite"]["tipocliente"] = '';
        }
        if (!isset($_SESSION["tramite"]["razonsocialcliente"])) {
            $_SESSION["tramite"]["razonsocialcliente"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellidocliente"])) {
            $_SESSION["tramite"]["apellidocliente"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido1cliente"])) {
            $_SESSION["tramite"]["apellido1cliente"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido2cliente"])) {
            $_SESSION["tramite"]["apellido2cliente"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre1cliente"])) {
            $_SESSION["tramite"]["nombre1cliente"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre2cliente"])) {
            $_SESSION["tramite"]["nombre2cliente"] = '';
        }

        // Datos del pagador
        if (!isset($_SESSION["tramite"]["tipopagador"])) {
            $_SESSION["tramite"]["tipopagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["razonsocialpagador"])) {
            $_SESSION["tramite"]["razonsocialpagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre1pagador"])) {
            $_SESSION["tramite"]["nombre1pagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre2pagador"])) {
            $_SESSION["tramite"]["nombre2pagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido1pagador"])) {
            $_SESSION["tramite"]["apellido1pagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido2pagador"])) {
            $_SESSION["tramite"]["apellido2pagador"] = '';
        }

        if (!isset($_SESSION["tramite"]["movilpagador"])) {
            $_SESSION["tramite"]["movilpagador"] = '';
        }


        if (!isset($_SESSION["tramite"]["idsolicitudpago"])) {
            $_SESSION["tramite"]["idsolicitudpago"] = '';
        }
        if ($_SESSION["tramite"]["idsolicitudpago"] == '') {
            $_SESSION["tramite"]["idsolicitudpago"] = 0;
        }

        //
        if (!isset($_SESSION["tramite"]["alertaid"])) {
            $_SESSION["tramite"]["alertaid"] = 0;
        }
        if (!isset($_SESSION["tramite"]["alertaservicio"])) {
            $_SESSION["tramite"]["alertaservicio"] = '';
        }
        if (!isset($_SESSION["tramite"]["alertavalor"])) {
            $_SESSION["tramite"]["alertavalor"] = 0;
        }
        if (!isset($_SESSION["tramite"]["ctrcancelacion"])) {
            $_SESSION["tramite"]["ctrcancelacion"] = '';
        }
        if (!isset($_SESSION["tramite"]["idasesor"])) {
            $_SESSION["tramite"]["idasesor"] = '';
        }
        if (!isset($_SESSION["tramite"]["numeroempleados"])) {
            $_SESSION["tramite"]["numeroempleados"] = 0;
        }
        if (!isset($_SESSION["tramite"]["nombrepagador"])) {
            $_SESSION["tramite"]["nombrepagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellidopagador"])) {
            $_SESSION["tramite"]["apellidopagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["tipoidentificacionpagador"])) {
            $_SESSION["tramite"]["tipoidentificacionpagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["identificacionpagador"])) {
            $_SESSION["tramite"]["identificacionpagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["direccionpagador"])) {
            $_SESSION["tramite"]["direccionpagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["telefonopagador"])) {
            $_SESSION["tramite"]["telefonopagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["municipiopagador"])) {
            $_SESSION["tramite"]["municipiopagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailpagador"])) {
            $_SESSION["tramite"]["emailpagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["pagoprepago"])) {
            $_SESSION["tramite"]["pagoprepago"] = 0;
        }
        if (!isset($_SESSION["tramite"]["pagoafiliado"])) {
            $_SESSION["tramite"]["pagoafiliado"] = 0;
        }
        if (!isset($_SESSION["tramite"]["pagoacredito"])) {
            $_SESSION["tramite"]["pagoacredito"] = 0;
        }
        if (!isset($_SESSION["tramite"]["pagoconsignacion"])) {
            $_SESSION["tramite"]["pagoconsignacion"] = 0;
        }
        if (!isset($_SESSION["tramite"]["proyectocaja"])) {
            $_SESSION["tramite"]["proyectocaja"] = '001';
        }
        if (!isset($_SESSION["tramite"]["cargoafiliacion"])) {
            $_SESSION["tramite"]["cargoafiliacion"] = 'NO';
        }
        if (!isset($_SESSION["tramite"]["cargogastoadministrativo"])) {
            $_SESSION["tramite"]["cargogastoadministrativo"] = 'NO';
        }
        if (!isset($_SESSION["tramite"]["cargoentidadoficial"])) {
            $_SESSION["tramite"]["cargoentidadoficial"] = 'NO';
        }
        if (!isset($_SESSION["tramite"]["cargoconsulta"])) {
            $_SESSION["tramite"]["cargoconsulta"] = 'NO';
        }
        if (!isset($_SESSION["tramite"]["actualizacionciiuversion4"])) {
            $_SESSION["tramite"]["actualizacionciiuversion4"] = 'NO';
        }
        if (!isset($_SESSION["tramite"]["domicilioorigen"])) {
            $_SESSION["tramite"]["domicilioorigen"] = '';
        }
        if (!isset($_SESSION["tramite"]["domiciliodestino"])) {
            $_SESSION["tramite"]["domiciliodestino"] = '';
        }
        if (!isset($_SESSION["tramite"]["reliquidacion"])) {
            $_SESSION["tramite"]["reliquidacion"] = '';
        }
        if (!isset($_SESSION["tramite"]["pagoafiliacion"])) {
            $_SESSION["tramite"]["pagoafiliacion"] = '';
        }
        if (!isset($_SESSION["tramite"]["numerofactura"])) {
            $_SESSION["tramite"]["numerofactura"] = '';
        }
        if (!isset($_SESSION["tramite"]["nrocontrolsipref"])) {
            $_SESSION["tramite"]["nrocontrolsipref"] = '';
        }
        if (!isset($_SESSION["tramite"]["tipoideradicador"])) {
            $_SESSION["tramite"]["tipoideradicador"] = '';
        }
        if (!isset($_SESSION["tramite"]["ideradicador"])) {
            $_SESSION["tramite"]["ideradicador"] = '';
        }
        if (!isset($_SESSION["tramite"]["fechaexpradicador"])) {
            $_SESSION["tramite"]["fechaexpradicador"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombreradicador"])) {
            $_SESSION["tramite"]["nombreradicador"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombrebanco"])) {
            $_SESSION["tramite"]["nombrebanco"] = '';
        }

        if (!isset($_SESSION["tramite"]["orgpnat"])) {
            $_SESSION["tramite"]["orgpnat"] = '';
        }
        if (!isset($_SESSION["tramite"]["tipoidepnat"])) {
            $_SESSION["tramite"]["tipoidepnat"] = '';
        }
        if (!isset($_SESSION["tramite"]["idepnat"])) {
            $_SESSION["tramite"]["idepnat"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombrepnat"])) {
            $_SESSION["tramite"]["nombrepnat"] = '';
        }
        if (!isset($_SESSION["tramite"]["actpnat"])) {
            $_SESSION["tramite"]["actpnat"] = '';
        }
        if (!isset($_SESSION["tramite"]["perpnat"])) {
            $_SESSION["tramite"]["perpnat"] = '';
        }
        if (!isset($_SESSION["tramite"]["munpnat"])) {
            $_SESSION["tramite"]["munpnat"] = '';
        }

        if (!isset($_SESSION["tramite"]["numeromatriculapnat"])) {
            $_SESSION["tramite"]["numeromatriculapnat"] = '';
        }
        if (!isset($_SESSION["tramite"]["camarapnat"])) {
            $_SESSION["tramite"]["camarapnat"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombreest"])) {
            $_SESSION["tramite"]["nombreest"] = '';
        }
        if (!isset($_SESSION["tramite"]["actest"])) {
            $_SESSION["tramite"]["actest"] = '';
        }
        if (!isset($_SESSION["tramite"]["munest"])) {
            $_SESSION["tramite"]["munest"] = '';
        }
        if (!isset($_SESSION["tramite"]["ultanoren"])) {
            $_SESSION["tramite"]["ultanoren"] = '';
        }
        if (!isset($_SESSION["tramite"]["incluirformularios"])) {
            $_SESSION["tramite"]["incluirformularios"] = '';
        }
        if (!isset($_SESSION["tramite"]["incluircertificados"])) {
            $_SESSION["tramite"]["incluircertificados"] = '';
        }
        if (!isset($_SESSION["tramite"]["incluirdiploma"])) {
            $_SESSION["tramite"]["incluirdiploma"] = '';
        }
        if (!isset($_SESSION["tramite"]["incluircartulina"])) {
            $_SESSION["tramite"]["incluircartulina"] = '';
        }
        if (!isset($_SESSION["tramite"]["matricularpnat"])) {
            $_SESSION["tramite"]["matricularpnat"] = '';
        }
        if (!isset($_SESSION["tramite"]["matricularest"])) {
            $_SESSION["tramite"]["matricularest"] = '';
        }
        if (!isset($_SESSION["tramite"]["regimentributario"])) {
            $_SESSION["tramite"]["regimentributario"] = '';
        }
        if (!isset($_SESSION["tramite"]["benart7"])) {
            $_SESSION["tramite"]["benart7"] = 'N';
        }
        if (!isset($_SESSION["tramite"]["benley1780"])) {
            $_SESSION["tramite"]["benley1780"] = 'N';
        }
        if (!isset($_SESSION["tramite"]["fechanacimientopnat"])) {
            $_SESSION["tramite"]["fechanacimientopnat"] = '';
        }
        if (!isset($_SESSION["tramite"]["controlfirma"])) {
            $_SESSION["tramite"]["controlfirma"] = 'N';
        }
        if (!isset($_SESSION["tramite"]["modcom"])) {
            $_SESSION["tramite"]["modcom"] = 'N';
        }
        if (!isset($_SESSION["tramite"]["modnot"])) {
            $_SESSION["tramite"]["modnot"] = 'N';
        }
        if (!isset($_SESSION["tramite"]["modciiu"])) {
            $_SESSION["tramite"]["modciiu"] = 'N';
        }
        if (!isset($_SESSION["tramite"]["modnombre"])) {
            $_SESSION["tramite"]["modnombre"] = 'N';
        }

        if (!isset($_SESSION["tramite"]["nombrepjur"])) {
            $_SESSION["tramite"]["nombrepjur"] = '';
        }
        if (!isset($_SESSION["tramite"]["perpjur"])) {
            $_SESSION["tramite"]["perpjur"] = '';
        }
        if (!isset($_SESSION["tramite"]["actpjur"])) {
            $_SESSION["tramite"]["actpjur"] = '';
        }
        if (!isset($_SESSION["tramite"]["munpjur"])) {
            $_SESSION["tramite"]["munpjur"] = '';
        }
        if (!isset($_SESSION["tramite"]["orgpjur"])) {
            $_SESSION["tramite"]["orgpjur"] = '';
        }

        if (!isset($_SESSION["tramite"]["nombresuc"])) {
            $_SESSION["tramite"]["nombresuc"] = '';
        }
        if (!isset($_SESSION["tramite"]["actsuc"])) {
            $_SESSION["tramite"]["actsuc"] = '';
        }
        if (!isset($_SESSION["tramite"]["munsuc"])) {
            $_SESSION["tramite"]["munsuc"] = '';
        }
        if (!isset($_SESSION["tramite"]["orgsuc"])) {
            $_SESSION["tramite"]["orgsuc"] = '';
        }

        if (!isset($_SESSION["tramite"]["nombreage"])) {
            $_SESSION["tramite"]["nombreage"] = '';
        }
        if (!isset($_SESSION["tramite"]["actage"])) {
            $_SESSION["tramite"]["actage"] = '';
        }
        if (!isset($_SESSION["tramite"]["munage"])) {
            $_SESSION["tramite"]["munage"] = '';
        }
        if (!isset($_SESSION["tramite"]["orgage"])) {
            $_SESSION["tramite"]["orgage"] = '';
        }

        if (!isset($_SESSION["tramite"]["matriculacambidom"])) {
            $_SESSION["tramite"]["matriculacambidom"] = '';
        }
        if (!isset($_SESSION["tramite"]["camaracambidom"])) {
            $_SESSION["tramite"]["camaracambidom"] = '';
        }
        if (!isset($_SESSION["tramite"]["municipiocambidom"])) {
            $_SESSION["tramite"]["municipiocambidom"] = '';
        }
        if (!isset($_SESSION["tramite"]["fecmatcambidom"])) {
            $_SESSION["tramite"]["fecmatcambidom"] = '';
        }
        if (!isset($_SESSION["tramite"]["fecrencambidom"])) {
            $_SESSION["tramite"]["fecrencambidom"] = '';
        }

        if (ltrim($_SESSION["tramite"]["actpnat"], "0") == '') {
            $_SESSION["tramite"]["actpnat"] = 0;
        }
        if (ltrim($_SESSION["tramite"]["perpnat"], "0") == '') {
            $_SESSION["tramite"]["perpnat"] = 0;
        }
        if (ltrim($_SESSION["tramite"]["perpjur"], "0") == '') {
            $_SESSION["tramite"]["perpjur"] = 0;
        }
        if (ltrim($_SESSION["tramite"]["actest"], "0") == '') {
            $_SESSION["tramite"]["actest"] = 0;
        }
        if (ltrim($_SESSION["tramite"]["actpjur"], "0") == '') {
            $_SESSION["tramite"]["actpjur"] = 0;
        }
        if (ltrim($_SESSION["tramite"]["actsuc"], "0") == '') {
            $_SESSION["tramite"]["actsuc"] = 0;
        }
        if (ltrim($_SESSION["tramite"]["actage"], "0") == '') {
            $_SESSION["tramite"]["actage"] = 0;
        }

        if (!isset($_SESSION["tramite"]["capital"])) {
            $_SESSION["tramite"]["capital"] = 0;
        }
        if (!isset($_SESSION["tramite"]["tipodoc"])) {
            $_SESSION["tramite"]["tipodoc"] = '';
        }
        if (!isset($_SESSION["tramite"]["numdoc"])) {
            $_SESSION["tramite"]["numdoc"] = '';
        }
        if (!isset($_SESSION["tramite"]["fechadoc"])) {
            $_SESSION["tramite"]["fechadoc"] = '';
        }
        if (!isset($_SESSION["tramite"]["origendoc"])) {
            $_SESSION["tramite"]["origendoc"] = '';
        }
        if (!isset($_SESSION["tramite"]["mundoc"])) {
            $_SESSION["tramite"]["mundoc"] = '';
        }
        if (!isset($_SESSION["tramite"]["organizacion"])) {
            $_SESSION["tramite"]["organizacion"] = '';
        }
        if (!isset($_SESSION["tramite"]["categoria"])) {
            $_SESSION["tramite"]["categoria"] = '';
        }

        if (!isset($_SESSION["tramite"]["tipoiderepleg"])) {
            $_SESSION["tramite"]["tipoiderepleg"] = '';
        }
        if (!isset($_SESSION["tramite"]["iderepleg"])) {
            $_SESSION["tramite"]["iderepleg"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombrerepleg"])) {
            $_SESSION["tramite"]["nombrerepleg"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre1repleg"])) {
            $_SESSION["tramite"]["nombre1repleg"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre2repleg"])) {
            $_SESSION["tramite"]["nombre2repleg"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido1repleg"])) {
            $_SESSION["tramite"]["apellido1repleg"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido2repleg"])) {
            $_SESSION["tramite"]["apellido2repleg"] = '';
        }
        if (!isset($_SESSION["tramite"]["cargorepleg"])) {
            $_SESSION["tramite"]["cargorepleg"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailrepleg"])) {
            $_SESSION["tramite"]["emailrepleg"] = '';
        }
        if (!isset($_SESSION["tramite"]["firmorepleg"])) {
            $_SESSION["tramite"]["firmorepleg"] = '';
        }
        if (!isset($_SESSION["tramite"]["celularrepleg"])) {
            $_SESSION["tramite"]["celularrepleg"] = '';
        }

        if (!isset($_SESSION["tramite"]["tipoideradicador"])) {
            $_SESSION["tramite"]["tipoideradicador"] = '';
        }
        if (!isset($_SESSION["tramite"]["ideradicador"])) {
            $_SESSION["tramite"]["ideradicador"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombreradicador"])) {
            $_SESSION["tramite"]["nombreradicador"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailradicador"])) {
            $_SESSION["tramite"]["emailradicador"] = '';
        }
        if (!isset($_SESSION["tramite"]["telefonoradicador"])) {
            $_SESSION["tramite"]["telefonoradicador"] = '';
        }
        if (!isset($_SESSION["tramite"]["celularradicador"])) {
            $_SESSION["tramite"]["celularradicador"] = '';
        }

        if (!isset($_SESSION["tramite"]["tipolibro"])) {
            $_SESSION["tramite"]["tipolibro"] = '';
        }
        if (!isset($_SESSION["tramite"]["codigolibro"])) {
            $_SESSION["tramite"]["codigolibro"] = '';
        }
        if (!isset($_SESSION["tramite"]["primeravez"])) {
            $_SESSION["tramite"]["primeravez"] = '';
        }
        if (!isset($_SESSION["tramite"]["confirmadigital"])) {
            $_SESSION["tramite"]["confirmadigital"] = '';
        }

        if (!isset($_SESSION["tramite"]["iderevfis"])) {
            $_SESSION["tramite"]["iderevfis"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre1revfis"])) {
            $_SESSION["tramite"]["nombre1revfis"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre2revfis"])) {
            $_SESSION["tramite"]["nombre2revfis"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido1revfis"])) {
            $_SESSION["tramite"]["apellido1revfis"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido2revfis"])) {
            $_SESSION["tramite"]["apellido2revfis"] = '';
        }
        if (!isset($_SESSION["tramite"]["cargorevfis"])) {
            $_SESSION["tramite"]["cargorevfis"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailrevfis"])) {
            $_SESSION["tramite"]["emailrevfis"] = '';
        }
        if (!isset($_SESSION["tramite"]["firmorevfis"])) {
            $_SESSION["tramite"]["firmorevfis"] = '';
        }
        if (!isset($_SESSION["tramite"]["celularrevfis"])) {
            $_SESSION["tramite"]["celularrevfis"] = '';
        }

        if (!isset($_SESSION["tramite"]["idepreasa"])) {
            $_SESSION["tramite"]["idepreasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre1preasa"])) {
            $_SESSION["tramite"]["nombre1preasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre2preasa"])) {
            $_SESSION["tramite"]["nombre2preasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido1preasa"])) {
            $_SESSION["tramite"]["apellido1preasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido2preasa"])) {
            $_SESSION["tramite"]["apellido2preasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["cargopreasa"])) {
            $_SESSION["tramite"]["cargopreasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailpreasa"])) {
            $_SESSION["tramite"]["emailpreasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["firmopreasa"])) {
            $_SESSION["tramite"]["firmopreasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["celularpreasa"])) {
            $_SESSION["tramite"]["celularpreasa"] = '';
        }

        if (!isset($_SESSION["tramite"]["idesecasa"])) {
            $_SESSION["tramite"]["idesecasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre1secasa"])) {
            $_SESSION["tramite"]["nombre1secasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre2secasa"])) {
            $_SESSION["tramite"]["nombre2secasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido1secasa"])) {
            $_SESSION["tramite"]["apellido1secasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido2secasa"])) {
            $_SESSION["tramite"]["apellido2secasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["cargosecasa"])) {
            $_SESSION["tramite"]["cargosecasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailsecasa"])) {
            $_SESSION["tramite"]["emailsecasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["firmosecasa"])) {
            $_SESSION["tramite"]["firmosecasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["celularsecasa"])) {
            $_SESSION["tramite"]["celularsecasa"] = '';
        }

        if (ltrim($_SESSION["tramite"]["actpnat"], "0") == '') {
            $_SESSION["tramite"]["actpnat"] = 0;
        }
        if (ltrim($_SESSION["tramite"]["perpnat"], "0") == '') {
            $_SESSION["tramite"]["perpnat"] = 0;
        }
        if (ltrim($_SESSION["tramite"]["actest"], "0") == '') {
            $_SESSION["tramite"]["actest"] = 0;
        }
        if (ltrim($_SESSION["tramite"]["capital"], "0") == '') {
            $_SESSION["tramite"]["capital"] = 0;
        }

        if (!isset($_SESSION["tramite"]["tipoidentificacionaceptante"])) {
            $_SESSION["tramite"]["tipoidentificacionaceptante"] = '';
        }
        if (!isset($_SESSION["tramite"]["identificacionaceptante"])) {
            $_SESSION["tramite"]["identificacionaceptante"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre1aceptante"])) {
            $_SESSION["tramite"]["nombre1aceptante"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre2aceptante"])) {
            $_SESSION["tramite"]["nombre2aceptante"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido1aceptante"])) {
            $_SESSION["tramite"]["apellido1aceptante"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido2aceptante"])) {
            $_SESSION["tramite"]["apellido2aceptante"] = '';
        }
        if (!isset($_SESSION["tramite"]["direccionaceptante"])) {
            $_SESSION["tramite"]["direccionaceptante"] = '';
        }
        if (!isset($_SESSION["tramite"]["municipioaceptante"])) {
            $_SESSION["tramite"]["municipioaceptante"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailaceptante"])) {
            $_SESSION["tramite"]["emailaceptante"] = '';
        }
        if (!isset($_SESSION["tramite"]["telefonoaceptante"])) {
            $_SESSION["tramite"]["telefonoaceptante"] = '';
        }
        if (!isset($_SESSION["tramite"]["celularaceptante"])) {
            $_SESSION["tramite"]["celularaceptante"] = '';
        }
        if (!isset($_SESSION["tramite"]["cargoaceptante"])) {
            $_SESSION["tramite"]["cargoaceptante"] = '';
        }
        if (!isset($_SESSION["tramite"]["fechadocideaceptante"])) {
            $_SESSION["tramite"]["fechadocideaceptante"] = '';
        }

        if (!isset($_SESSION["tramite"]["motivocorreccion"])) {
            $_SESSION["tramite"]["motivocorreccion"] = '';
        }
        if (!isset($_SESSION["tramite"]["tipoerror1"])) {
            $_SESSION["tramite"]["tipoerror1"] = '';
        }
        if (!isset($_SESSION["tramite"]["tipoerror2"])) {
            $_SESSION["tramite"]["tipoerror2"] = '';
        }
        if (!isset($_SESSION["tramite"]["tipoerror3"])) {
            $_SESSION["tramite"]["tipoerror3"] = '';
        }
        if (!isset($_SESSION["tramite"]["tipoidentificacioncor"])) {
            $_SESSION["tramite"]["tipoidentificacioncor"] = '';
        }
        if (!isset($_SESSION["tramite"]["identificacioncor"])) {
            $_SESSION["tramite"]["identificacioncor"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre1cor"])) {
            $_SESSION["tramite"]["nombre1cor"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre2cor"])) {
            $_SESSION["tramite"]["nombre2cor"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido1cor"])) {
            $_SESSION["tramite"]["apellido1cor"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido2cor"])) {
            $_SESSION["tramite"]["apellido2cor"] = '';
        }
        if (!isset($_SESSION["tramite"]["direccioncor"])) {
            $_SESSION["tramite"]["direccioncor"] = '';
        }
        if (!isset($_SESSION["tramite"]["municipiocor"])) {
            $_SESSION["tramite"]["municipiocor"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailcor"])) {
            $_SESSION["tramite"]["emailcor"] = '';
        }
        if (!isset($_SESSION["tramite"]["telefonocor"])) {
            $_SESSION["tramite"]["telefonocor"] = '';
        }
        if (!isset($_SESSION["tramite"]["celularcor"])) {
            $_SESSION["tramite"]["celularcor"] = '';
        }


        if (!isset($_SESSION["tramite"]["descripcionembargo"])) {
            $_SESSION["tramite"]["descripcionembargo"] = '';
        }
        if (!isset($_SESSION["tramite"]["descripciondesembargo"])) {
            $_SESSION["tramite"]["descripciondesembargo"] = '';
        }
        if (!isset($_SESSION["tramite"]["tipoidentificaciondemandante"])) {
            $_SESSION["tramite"]["tipoidentificaciondemandante"] = '';
        }
        if (!isset($_SESSION["tramite"]["identificaciondemandante"])) {
            $_SESSION["tramite"]["identificaciondemandante"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombredemandante"])) {
            $_SESSION["tramite"]["nombredemandante"] = '';
        }
        if (!isset($_SESSION["tramite"]["libro"])) {
            $_SESSION["tramite"]["libro"] = '';
        }
        if (!isset($_SESSION["tramite"]["numreg"])) {
            $_SESSION["tramite"]["numreg"] = '';
        }

        if (!isset($_SESSION["tramite"]["descripcionpqr"])) {
            $_SESSION["tramite"]["descripcionpqr"] = '';
        }
        if (!isset($_SESSION["tramite"]["tipoidentificacionpqr"])) {
            $_SESSION["tramite"]["tipoidentificacionpqr"] = '';
        }
        if (!isset($_SESSION["tramite"]["identificacionpqr"])) {
            $_SESSION["tramite"]["identificacionpqr"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre1pqr"])) {
            $_SESSION["tramite"]["nombre1pqr"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre2pqr"])) {
            $_SESSION["tramite"]["nombre2pqr"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido1pqr"])) {
            $_SESSION["tramite"]["apellido1pqr"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido2pqr"])) {
            $_SESSION["tramite"]["apellido2pqr"] = '';
        }
        if (!isset($_SESSION["tramite"]["direccionpqr"])) {
            $_SESSION["tramite"]["direccionpqr"] = '';
        }
        if (!isset($_SESSION["tramite"]["municipiopqr"])) {
            $_SESSION["tramite"]["municipiopqr"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailpqr"])) {
            $_SESSION["tramite"]["emailpqr"] = '';
        }
        if (!isset($_SESSION["tramite"]["telefonopqr"])) {
            $_SESSION["tramite"]["telefonopqr"] = '';
        }
        if (!isset($_SESSION["tramite"]["celularpqr"])) {
            $_SESSION["tramite"]["celularpqr"] = '';
        }

        if (!isset($_SESSION["tramite"]["descripcionrr"])) {
            $_SESSION["tramite"]["descripcionrr"] = '';
        }
        if (!isset($_SESSION["tramite"]["tipoidentificacionrr"])) {
            $_SESSION["tramite"]["tipoidentificacionrr"] = '';
        }
        if (!isset($_SESSION["tramite"]["identificacionrr"])) {
            $_SESSION["tramite"]["identificacionrr"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre1rr"])) {
            $_SESSION["tramite"]["nombre1rr"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre2rr"])) {
            $_SESSION["tramite"]["nombre2rr"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido1rr"])) {
            $_SESSION["tramite"]["apellido1rr"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido2rr"])) {
            $_SESSION["tramite"]["apellido2rr"] = '';
        }
        if (!isset($_SESSION["tramite"]["direccionrr"])) {
            $_SESSION["tramite"]["direccionrr"] = '';
        }
        if (!isset($_SESSION["tramite"]["municipiorr"])) {
            $_SESSION["tramite"]["municipiorr"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailrr"])) {
            $_SESSION["tramite"]["emailrr"] = '';
        }
        if (!isset($_SESSION["tramite"]["telefonorr"])) {
            $_SESSION["tramite"]["telefonorr"] = '';
        }
        if (!isset($_SESSION["tramite"]["celularrr"])) {
            $_SESSION["tramite"]["celularrr"] = '';
        }

        if (!isset($_SESSION["tramite"]["tipocertificado"])) {
            $_SESSION["tramite"]["tipocertificado"] = '';
        }
        if (!isset($_SESSION["tramite"]["explicacion"])) {
            $_SESSION["tramite"]["explicacion"] = '';
        }
        if (!isset($_SESSION["tramite"]["textolibre"])) {
            $_SESSION["tramite"]["textolibre"] = '';
        }

        // Datos de mutación de direccion - comercial
        if (!isset($_SESSION["tramite"]["ant_dircom"])) {
            $_SESSION["tramite"]["ant_dircom"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_telcom1"])) {
            $_SESSION["tramite"]["ant_telcom1"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_telcom2"])) {
            $_SESSION["tramite"]["ant_telcom2"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_faxcom"])) {
            $_SESSION["tramite"]["ant_faxcom"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_celcom"])) {
            $_SESSION["tramite"]["ant_celcom"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_barriocom"])) {
            $_SESSION["tramite"]["ant_barriocom"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_muncom"])) {
            $_SESSION["tramite"]["ant_muncom"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_emailcom"])) {
            $_SESSION["tramite"]["ant_emailcom"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_emailcom2"])) {
            $_SESSION["tramite"]["ant_emailcom2"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_emailcom3"])) {
            $_SESSION["tramite"]["ant_emailcom3"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_numpredial"])) {
            $_SESSION["tramite"]["ant_numpredial"] = '';
        }

        if (!isset($_SESSION["tramite"]["dircom"])) {
            $_SESSION["tramite"]["dircom"] = '';
        }
        if (!isset($_SESSION["tramite"]["telcom1"])) {
            $_SESSION["tramite"]["telcom1"] = '';
        }
        if (!isset($_SESSION["tramite"]["telcom2"])) {
            $_SESSION["tramite"]["telcom2"] = '';
        }
        if (!isset($_SESSION["tramite"]["faxcom"])) {
            $_SESSION["tramite"]["faxcom"] = '';
        }
        if (!isset($_SESSION["tramite"]["celcom"])) {
            $_SESSION["tramite"]["celcom"] = '';
        }
        if (!isset($_SESSION["tramite"]["barriocom"])) {
            $_SESSION["tramite"]["barriocom"] = '';
        }
        if (!isset($_SESSION["tramite"]["muncom"])) {
            $_SESSION["tramite"]["muncom"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailcom"])) {
            $_SESSION["tramite"]["emailcom"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailcom2"])) {
            $_SESSION["tramite"]["emailcom2"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailcom3"])) {
            $_SESSION["tramite"]["emailcom3"] = '';
        }
        if (!isset($_SESSION["tramite"]["numpredial"])) {
            $_SESSION["tramite"]["numpredial"] = '';
        }

        // Datos de mutación de direccion - notificación
        if (!isset($_SESSION["tramite"]["ant_dirnot"])) {
            $_SESSION["tramite"]["ant_dirnot"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_telnot1"])) {
            $_SESSION["tramite"]["ant_telnot1"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_telnot2"])) {
            $_SESSION["tramite"]["ant_telnot2"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_faxnot"])) {
            $_SESSION["tramite"]["ant_faxnot"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_celnot"])) {
            $_SESSION["tramite"]["ant_celnot"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_barrionot"])) {
            $_SESSION["tramite"]["ant_barrionot"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_munnot"])) {
            $_SESSION["tramite"]["ant_munnot"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_emailnot"])) {
            $_SESSION["tramite"]["ant_emailnot"] = '';
        }

        if (!isset($_SESSION["tramite"]["dirnot"])) {
            $_SESSION["tramite"]["dirnot"] = '';
        }
        if (!isset($_SESSION["tramite"]["telnot1"])) {
            $_SESSION["tramite"]["telnot1"] = '';
        }
        if (!isset($_SESSION["tramite"]["telnot2"])) {
            $_SESSION["tramite"]["telnot2"] = '';
        }
        if (!isset($_SESSION["tramite"]["faxnot"])) {
            $_SESSION["tramite"]["faxnot"] = '';
        }
        if (!isset($_SESSION["tramite"]["celnot"])) {
            $_SESSION["tramite"]["celnot"] = '';
        }
        if (!isset($_SESSION["tramite"]["barrionot"])) {
            $_SESSION["tramite"]["barrionot"] = '';
        }
        if (!isset($_SESSION["tramite"]["munnot"])) {
            $_SESSION["tramite"]["munnot"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailnot"])) {
            $_SESSION["tramite"]["emailnot"] = '';
        }

        // Datos de mutación de actividad
        if (!isset($_SESSION["tramite"]["ant_versionciiu"])) {
            $_SESSION["tramite"]["ant_versionciiu"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_ciiu11"])) {
            $_SESSION["tramite"]["ant_ciiu11"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_ciiu12"])) {
            $_SESSION["tramite"]["ant_ciiu12"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_ciiu13"])) {
            $_SESSION["tramite"]["ant_ciiu13"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_ciiu14"])) {
            $_SESSION["tramite"]["ant_ciiu14"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_ciiu21"])) {
            $_SESSION["tramite"]["ant_ciiu21"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_ciiu22"])) {
            $_SESSION["tramite"]["ant_ciiu22"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_ciiu23"])) {
            $_SESSION["tramite"]["ant_ciiu23"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_ciiu24"])) {
            $_SESSION["tramite"]["ant_ciiu24"] = '';
        }

        if (!isset($_SESSION["tramite"]["versionciiu"])) {
            $_SESSION["tramite"]["versionciiu"] = '';
        }
        if (!isset($_SESSION["tramite"]["ciiu11"])) {
            $_SESSION["tramite"]["ciiu11"] = '';
        }
        if (!isset($_SESSION["tramite"]["ciiu12"])) {
            $_SESSION["tramite"]["ciiu12"] = '';
        }
        if (!isset($_SESSION["tramite"]["ciiu13"])) {
            $_SESSION["tramite"]["ciiu13"] = '';
        }
        if (!isset($_SESSION["tramite"]["ciiu14"])) {
            $_SESSION["tramite"]["ciiu14"] = '';
        }
        if (!isset($_SESSION["tramite"]["ciiu21"])) {
            $_SESSION["tramite"]["ciiu21"] = '';
        }
        if (!isset($_SESSION["tramite"]["ciiu22"])) {
            $_SESSION["tramite"]["ciiu22"] = '';
        }
        if (!isset($_SESSION["tramite"]["ciiu23"])) {
            $_SESSION["tramite"]["ciiu23"] = '';
        }
        if (!isset($_SESSION["tramite"]["ciiu24"])) {
            $_SESSION["tramite"]["ciiu24"] = '';
        }

        // Datos mutación de nombre
        if (!isset($_SESSION["tramite"]["nombreanterior"])) {
            $_SESSION["tramite"]["nombreanterior"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombrenuevo"])) {
            $_SESSION["tramite"]["nombrenuevo"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombrenuevo"])) {
            $_SESSION["tramite"]["nombrenuevo"] = '';
        }
        if (!isset($_SESSION["tramite"]["nuevonombre"])) {
            $_SESSION["tramite"]["nuevonombre"] = '';
        }

        // Datos del afiliado
        if (!isset($_SESSION["tramite"]["matriculaafiliado"])) {
            $_SESSION["tramite"]["matriculaafiliado"] = '';
        }
        if (!isset($_SESSION["tramite"]["opcionafiliado"])) {
            $_SESSION["tramite"]["opcionafiliado"] = '';
        }
        if (!isset($_SESSION["tramite"]["saldoafiliado"])) {
            $_SESSION["tramite"]["saldoafiliado"] = 0;
        }
        if (!isset($_SESSION["tramite"]["ultanorenafi"])) {
            $_SESSION["tramite"]["ultanorenafi"] = '';
        }

        // Variables de trámites rues
        if (!isset($_SESSION["tramite"]["rues_empleados"])) {
            $_SESSION["tramite"]["rues_empleados"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_numerointerno"])) {
            $_SESSION["tramite"]["rues_numerointerno"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_numerounico"])) {
            $_SESSION["tramite"]["rues_numerounico"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_camarareceptora"])) {
            $_SESSION["tramite"]["rues_camarareceptora"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_camararesponsable"])) {
            $_SESSION["tramite"]["rues_camararesponsable"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_matricula"])) {
            $_SESSION["tramite"]["rues_matricula"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_proponente"])) {
            $_SESSION["tramite"]["rues_proponente"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_nombreregistrado"])) {
            $_SESSION["tramite"]["rues_nombreregistrado"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_claseidentificacion"])) {
            $_SESSION["tramite"]["rues_claseidentificacion"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_numeroidentificacion"])) {
            $_SESSION["tramite"]["rues_numeroidentificacion"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_dv"])) {
            $_SESSION["tramite"]["rues_dv"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_estado_liquidacion"])) {
            $_SESSION["tramite"]["rues_estado_liquidacion"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_estado_transaccion"])) {
            $_SESSION["tramite"]["rues_estado_transaccion"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_nombrepagador"])) {
            $_SESSION["tramite"]["rues_nombrepagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_origendocumento"])) {
            $_SESSION["tramite"]["rues_origendocumento"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_fechadocumento"])) {
            $_SESSION["tramite"]["rues_fechadocumento"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_fechapago"])) {
            $_SESSION["tramite"]["rues_fechapago"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_numerofactura"])) {
            $_SESSION["tramite"]["rues_numerofactura"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_referenciaoperacion"])) {
            $_SESSION["tramite"]["rues_referenciaoperacion"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_totalpagado"])) {
            $_SESSION["tramite"]["rues_totalpagado"] = 0;
        }
        if (!isset($_SESSION["tramite"]["rues_formapago"])) {
            $_SESSION["tramite"]["rues_formapago"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_indicadororigen"])) {
            $_SESSION["tramite"]["rues_indicadororigen"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_indicadorbeneficio"])) {
            $_SESSION["tramite"]["rues_indicadorbeneficio"] = 0;
        }
        if (!isset($_SESSION["tramite"]["rues_fecharespuesta"])) {
            $_SESSION["tramite"]["rues_fecharespuesta"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_codigoservicioradicar"])) {
            $_SESSION["tramite"]["rues_codigoservicioradicar"] = '';
        }

        if (!isset($_SESSION["tramite"]["rues_horarespuesta"])) {
            $_SESSION["tramite"]["rues_horarespuesta"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_codigoerror"])) {
            $_SESSION["tramite"]["rues_codigoerror"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_mensajeerror"])) {
            $_SESSION["tramite"]["rues_mensajeerror"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_firmadigital"])) {
            $_SESSION["tramite"]["rues_firmadigital"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_caracteres_por_linea"])) {
            $_SESSION["tramite"]["rues_caracteres_por_linea"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_texto"])) {
            $_SESSION["tramite"]["rues_texto"] = array();
        }

        // Variables del firmante
        if (!isset($_SESSION["tramite"]["tipoidefirmante"])) {
            $_SESSION["tramite"]["tipoidefirmante"] = '';
        }
        if (!isset($_SESSION["tramite"]["identificacionfirmante"])) {
            $_SESSION["tramite"]["identificacionfirmante"] = '';
        }
        if (!isset($_SESSION["tramite"]["fechaexpfirmante"])) {
            $_SESSION["tramite"]["fechaexpfirmante"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido1firmante"])) {
            $_SESSION["tramite"]["apellido1firmante"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido2firmante"])) {
            $_SESSION["tramite"]["apellido2firmante"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre1firmante"])) {
            $_SESSION["tramite"]["nombre1firmante"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre2firmante"])) {
            $_SESSION["tramite"]["nombre2firmante"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailfirmante"])) {
            $_SESSION["tramite"]["emailfirmante"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailfirmanteseguimiento"])) {
            $_SESSION["tramite"]["emailfirmanteseguimiento"] = '';
        }
        if (!isset($_SESSION["tramite"]["celularfirmante"])) {
            $_SESSION["tramite"]["celularfirmante"] = '';
        }
        if (!isset($_SESSION["tramite"]["direccionfirmante"])) {
            $_SESSION["tramite"]["direccionfirmante"] = '';
        }
        if (!isset($_SESSION["tramite"]["municipiofirmante"])) {
            $_SESSION["tramite"]["municipiofirmante"] = '';
        }

        if (!isset($_SESSION["tramite"]["firmadoelectronicamente"])) {
            $_SESSION["tramite"]["firmadoelectronicamente"] = '';
        }

        // Variables para el proceso de asesoria
        if (!isset($_SESSION["tramite"]["emailcontactoasesoria"])) {
            $_SESSION["tramite"]["emailcontactoasesoria"] = '';
        }
        if (!isset($_SESSION["tramite"]["comentariosasesoria"])) {
            $_SESSION["tramite"]["comentariosasesoria"] = '';
        }

        //
        if (!isset($_SESSION["tramite"]["pedirbalance"])) {
            $_SESSION["tramite"]["pedirbalance"] = '';
        }

        //
        if (!isset($_SESSION["tramite"]["quienasesora"])) {
            $_SESSION["tramite"]["quienasesora"] = '';
        }

        //
        if (!isset($_SESSION["tramite"]["incrementocupocertificados"])) {
            $_SESSION["tramite"]["incrementocupocertificados"] = 0;
        }

        //
        if (!isset($_SESSION["tramite"]["aceptadoprepago"])) {
            $_SESSION["tramite"]["aceptadoprepago"] = 'NO';
        }

        //
        if (!isset($_SESSION["tramite"]["propcamaraorigen"])) {
            $_SESSION["tramite"]["propcamaraorigen"] = '';
        }
        if (!isset($_SESSION["tramite"]["propidmunicipioorigen"])) {
            $_SESSION["tramite"]["propidmunicipioorigen"] = '';
        }
        if (!isset($_SESSION["tramite"]["propidmunicipiodestino"])) {
            $_SESSION["tramite"]["propidmunicipiodestino"] = '';
        }
        if (!isset($_SESSION["tramite"]["propproponenteorigen"])) {
            $_SESSION["tramite"]["propproponenteorigen"] = '';
        }
        if (!isset($_SESSION["tramite"]["propfechaultimainscripcion"])) {
            $_SESSION["tramite"]["propfechaultimainscripcion"] = '';
        }
        if (!isset($_SESSION["tramite"]["propfechaultimarenovacion"])) {
            $_SESSION["tramite"]["propfechaultimarenovacion"] = '';
        }
        if (!isset($_SESSION["tramite"]["propdircom"])) {
            $_SESSION["tramite"]["propdircom"] = '';
        }
        if (!isset($_SESSION["tramite"]["propmuncom"])) {
            $_SESSION["tramite"]["propmuncom"] = '';
        }
        if (!isset($_SESSION["tramite"]["proptelcom1"])) {
            $_SESSION["tramite"]["proptelcom1"] = '';
        }
        if (!isset($_SESSION["tramite"]["proptelcom2"])) {
            $_SESSION["tramite"]["proptelcom2"] = '';
        }
        if (!isset($_SESSION["tramite"]["proptelcom3"])) {
            $_SESSION["tramite"]["proptelcom3"] = '';
        }
        if (!isset($_SESSION["tramite"]["propemailcom"])) {
            $_SESSION["tramite"]["propemailcom"] = '';
        }
        if (!isset($_SESSION["tramite"]["propdirnot"])) {
            $_SESSION["tramite"]["propdirnot"] = '';
        }
        if (!isset($_SESSION["tramite"]["propmunnot"])) {
            $_SESSION["tramite"]["propmunnot"] = '';
        }
        if (!isset($_SESSION["tramite"]["proptelnot1"])) {
            $_SESSION["tramite"]["proptelnot1"] = '';
        }
        if (!isset($_SESSION["tramite"]["proptelnot2"])) {
            $_SESSION["tramite"]["proptelnot2"] = '';
        }
        if (!isset($_SESSION["tramite"]["proptelnot3"])) {
            $_SESSION["tramite"]["proptelnot3"] = '';
        }
        if (!isset($_SESSION["tramite"]["propemailnot"])) {
            $_SESSION["tramite"]["propemailnot"] = '';
        }

        // 2017-11-26:JINT: Para indicar el email del usuario que está logueado
        if (!isset($_SESSION["tramite"]["emailcontrol"])) {
            if (isset($_SESSION["generales"]["emailusuariocontrol"])) {
                $_SESSION["tramite"]["emailcontrol"] = $_SESSION["generales"]["emailusuariocontrol"];
            } else {
                $_SESSION["tramite"]["emailcontrol"] = '';
            }
        }

        // 2017-11-26:JINT: control para el cumplimiento de los requisitos de la ley 1780
        if (!isset($_SESSION["tramite"]["cumplorequisitosbenley1780"])) {
            $_SESSION["tramite"]["cumplorequisitosbenley1780"] = '';
        }

        // 2017-11-26:JINT: control para el mantenimiento de los requisitos de la ley 1780
        if (!isset($_SESSION["tramite"]["mantengorequisitosbenley1780"])) {
            $_SESSION["tramite"]["mantengorequisitosbenley1780"] = '';
        }

        // 2017-12-23:JINT: Control de renuncia al beneficio ley 1780
        if (!isset($_SESSION["tramite"]["renunciobeneficiosley1780"])) {
            $_SESSION["tramite"]["renunciobeneficiosley1780"] = '';
        }

        // 2017-11-26:JINT: control de actividades de alto impacto
        if (!isset($_SESSION["tramite"]["controlactividadaltoimpacto"])) {
            $_SESSION["tramite"]["controlactividadaltoimpacto"] = '';
        }

        // 2017-12-16:JINT: control de multas
        if (!isset($_SESSION["tramite"]["multadoponal"])) {
            $_SESSION["tramite"]["multadoponal"] = '';
        }

        // 2016-04-08: JINT
        if (!isset($_SESSION["tramite"]["tramitepresencial"]) || $_SESSION["tramite"]["tramitepresencial"] == '') {
            if (!isset($_SESSION["generales"]["codigousuario"]) || $_SESSION["generales"]["codigousuario"] == 'USUPUBXX') {
                $_SESSION["tramite"]["tramitepresencial"] = '1'; // Trámite virtual
            } else {
                $_SESSION["tramite"]["tramitepresencial"] = '4'; // Trámite presencial
            }
        }

        // 2016-08-23: JINT
        if (!isset($_SESSION["tramite"]["cobrarmutacion"])) {
            $_SESSION["tramite"]["cobrarmutacion"] = '';
        }

        // 2018-11-07:JINT: Prediligenciados
        if (!isset($_SESSION["tramite"]["tiporenovacion"])) {
            $_SESSION["tramite"]["tiporenovacion"] = '';
        }
        if (!isset($_SESSION["tramite"]["activosbase"])) {
            $_SESSION["tramite"]["activosbase"] = '';
        }
        if (!isset($_SESSION["tramite"]["personalbase"])) {
            $_SESSION["tramite"]["personalbase"] = '';
        }

        if (!isset($_SESSION["tramite"]["enviara"])) {
            $_SESSION["tramite"]["enviara"] = '';
        }

        //    
        $arrCampos = array(
            'idliquidacion',
            'fecha',
            'hora',
            'fechaultimamodificacion',
            'idusuario',
            'sede',
            'tipotramite',
            'iptramite',
            'idestado',
            'idexpedientebase',
            'idmatriculabase',
            'idproponentebase',
            'tipoidentificacionbase',
            'identificacionbase',
            'nombrebase',
            'organizacionbase',
            'categoriabase',
            'tipoidepnat',
            'idepnat',
            'nombrepnat',
            'actpnat',
            'perpnat',
            'numeromatriculapnat',
            'camarapnat',
            'nombreest',
            'actest',
            'ultanoren',
            'domicilioorigen',
            'domiciliodestino',
            'idtipoidentificacioncliente',
            'identificacioncliente',
            'nombrecliente',
            'apellidocliente',
            'email',
            'direccion',
            'idmunicipio',
            'telefono',
            'movil',
            'nombrepagador',
            'apellidopagador',
            'tipoidentificacionpagador',
            'identificacionpagador',
            'direccionpagador',
            'telefonopagador',
            'movilpagador',
            'municipiopagador',
            'emailpagador',
            'valorbruto',
            'valorbaseiva',
            'valoriva',
            'valortotal',
            'idsolicitudpago',
            'pagoefectivo',
            'pagocheque',
            'pagoconsignacion',
            'pagovisa',
            'pagoach',
            'pagomastercard',
            'pagoamerican',
            'pagocredencial',
            'pagodiners',
            'pagotdebito',
            'pagoprepago',
            'pagoafiliado',
            'pagoacredito',
            'idformapago',
            'numerorecibo',
            'numerooperacion',
            'fecharecibo',
            'horarecibo',
            'idfranquicia',
            'nombrefranquicia',
            'numeroautorizacion',
            'idcodban',
            'nombrebanco',
            'numerocheque',
            'numerorecuperacion',
            'numeroradicacion',
            'alertaid',
            'alertaservicio',
            'alertavalor',
            'ctrcancelacion',
            'idasesor',
            'numeroempleados',
            'pagoafiliacion',
            'numerofactura',
            'incluirformularios',
            'incluircertificados',
            'incluirdiploma',
            'incluircartulina',
            'matricularpnat',
            'matricularest',
            'regimentributario',
            'tipomatricula',
            'camaracambidom',
            'matriculacambidom',
            'municipiocambidom',
            'fecmatcambidom',
            'benart7',
            'controlfirma',
            'proyectocaja',
            'cargoafiliacion',
            'cargogastoadministrativo',
            'cargoentidadoficial',
            'cargoconsulta',
            'actualizacionciiuversion4',
            'reliquidacion',
            'capital',
            'tipodoc',
            'numdoc',
            'fechadoc',
            'origendoc',
            'mundoc',
            'organizacion',
            'categoria',
            'tipoiderepleg',
            'iderepleg',
            'nombrerepleg',
            'tipoideradicador',
            'ideradicador',
            'fechaexpradicador',
            'nombreradicador',
            'emailradicador',
            'telefonoradicador',
            'celularradicador',
            'nrocontrolsipref',
            'tramitepresencial',
            'firmadoelectronicamente',
            'emailcontrol',
            'cumplorequisitosbenley1780',
            'mantengorequisitosbenley1780',
            'renunciobeneficiosley1780',
            'controlactividadaltoimpacto',
            'multadoponal'
        );

        $arrValues = array(
            $_SESSION["tramite"]["numeroliquidacion"],
            "'" . $_SESSION["tramite"]["fecha"] . "'",
            "'" . $_SESSION["tramite"]["hora"] . "'",
            "'" . date("Ymd") . "'",
            "'" . $_SESSION["tramite"]["idusuario"] . "'",
            "'" . $_SESSION["tramite"]["sede"] . "'",
            "'" . $_SESSION["tramite"]["tipotramite"] . "'",
            "'" . str_replace(",", "", $_SESSION["tramite"]["iptramite"]) . "'",
            "'" . $_SESSION["tramite"]["idestado"] . "'",
            "'" . ltrim($_SESSION["tramite"]["idexpedientebase"], '0') . "'",
            "'" . ltrim($_SESSION["tramite"]["idmatriculabase"], '0') . "'",
            "'" . ltrim($_SESSION["tramite"]["idproponentebase"], '0') . "'",
            "'" . ltrim($_SESSION["tramite"]["tipoidentificacionbase"], '0') . "'",
            "'" . ltrim($_SESSION["tramite"]["identificacionbase"], '0') . "'",
            "'" . addslashes(substr($_SESSION["tramite"]["nombrebase"], 0, 250)) . "'",
            "'" . $_SESSION["tramite"]["organizacionbase"] . "'",
            "'" . $_SESSION["tramite"]["categoriabase"] . "'",
            "'" . $_SESSION["tramite"]["tipoidepnat"] . "'",
            "'" . $_SESSION["tramite"]["idepnat"] . "'",
            "'" . addslashes(substr($_SESSION["tramite"]["nombrepnat"], 0, 128)) . "'",
            doubleval($_SESSION["tramite"]["actpnat"]),
            doubleval($_SESSION["tramite"]["perpnat"]),
            "'" . $_SESSION["tramite"]["numeromatriculapnat"] . "'",
            "'" . $_SESSION["tramite"]["camarapnat"] . "'",
            "'" . addslashes(substr($_SESSION["tramite"]["nombreest"], 0, 128)) . "'",
            doubleval($_SESSION["tramite"]["actest"]),
            "'" . $_SESSION["tramite"]["ultanoren"] . "'",
            "'" . $_SESSION["tramite"]["domicilioorigen"] . "'",
            "'" . $_SESSION["tramite"]["domiciliodestino"] . "'",
            "'" . $_SESSION["tramite"]["idtipoidentificacioncliente"] . "'",
            "'" . $_SESSION["tramite"]["identificacioncliente"] . "'",
            "'" . addslashes(substr($_SESSION["tramite"]["nombrecliente"], 0, 60)) . "'",
            "'" . addslashes(substr($_SESSION["tramite"]["apellidocliente"], 0, 128)) . "'",
            "'" . addslashes(substr($_SESSION["tramite"]["email"], 0, 60)) . "'",
            "'" . addslashes(substr($_SESSION["tramite"]["direccion"], 0, 128)) . "'",
            "'" . $_SESSION["tramite"]["idmunicipio"] . "'",
            "'" . $_SESSION["tramite"]["telefono"] . "'",
            "'" . $_SESSION["tramite"]["movil"] . "'",
            "'" . addslashes(substr($_SESSION["tramite"]["nombrepagador"], 0, 50)) . "'",
            "'" . addslashes(substr($_SESSION["tramite"]["apellidopagador"], 0, 50)) . "'",
            "'" . $_SESSION["tramite"]["tipoidentificacionpagador"] . "'",
            "'" . $_SESSION["tramite"]["identificacionpagador"] . "'",
            "'" . addslashes(substr($_SESSION["tramite"]["direccionpagador"], 0, 128)) . "'",
            "'" . $_SESSION["tramite"]["telefonopagador"] . "'",
            "'" . $_SESSION["tramite"]["movilpagador"] . "'",
            "'" . $_SESSION["tramite"]["municipiopagador"] . "'",
            "'" . addslashes(substr($_SESSION["tramite"]["emailpagador"], 0, 70)) . "'",
            doubleval($_SESSION["tramite"]["valorbruto"]),
            doubleval($_SESSION["tramite"]["valorbaseiva"]),
            doubleval($_SESSION["tramite"]["valoriva"]),
            doubleval($_SESSION["tramite"]["valortotal"]),
            doubleval($_SESSION["tramite"]["idsolicitudpago"]),
            doubleval($_SESSION["tramite"]["pagoefectivo"]),
            doubleval($_SESSION["tramite"]["pagocheque"]),
            doubleval($_SESSION["tramite"]["pagoconsignacion"]),
            doubleval($_SESSION["tramite"]["pagovisa"]),
            doubleval($_SESSION["tramite"]["pagoach"]),
            doubleval($_SESSION["tramite"]["pagomastercard"]),
            doubleval($_SESSION["tramite"]["pagoamerican"]),
            doubleval($_SESSION["tramite"]["pagocredencial"]),
            doubleval($_SESSION["tramite"]["pagodiners"]),
            doubleval($_SESSION["tramite"]["pagotdebito"]),
            doubleval($_SESSION["tramite"]["pagoprepago"]),
            doubleval($_SESSION["tramite"]["pagoafiliado"]),
            doubleval($_SESSION["tramite"]["pagoacredito"]),
            "'" . $_SESSION["tramite"]["idformapago"] . "'",
            "'" . $_SESSION["tramite"]["numerorecibo"] . "'",
            "'" . $_SESSION["tramite"]["numerooperacion"] . "'",
            "'" . $_SESSION["tramite"]["fecharecibo"] . "'",
            "'" . $_SESSION["tramite"]["horarecibo"] . "'",
            "'" . $_SESSION["tramite"]["idfranquicia"] . "'",
            "'" . $_SESSION["tramite"]["nombrefranquicia"] . "'",
            "'" . $_SESSION["tramite"]["numeroautorizacion"] . "'",
            "'" . $_SESSION["tramite"]["idcodban"] . "'",
            "'" . $_SESSION["tramite"]["nombrebanco"] . "'",
            "'" . $_SESSION["tramite"]["numerocheque"] . "'",
            "'" . $_SESSION["tramite"]["numerorecuperacion"] . "'",
            "'" . ltrim($_SESSION["tramite"]["numeroradicacion"], '0') . "'",
            intval($_SESSION["tramite"]["alertaid"]),
            "'" . $_SESSION["tramite"]["alertaservicio"] . "'",
            doubleval($_SESSION["tramite"]["alertavalor"]),
            "'" . $_SESSION["tramite"]["ctrcancelacion"] . "'",
            "'" . $_SESSION["tramite"]["idasesor"] . "'",
            intval($_SESSION["tramite"]["numeroempleados"]),
            "'" . $_SESSION["tramite"]["pagoafiliacion"] . "'",
            "'" . $_SESSION["tramite"]["numerofactura"] . "'",
            "'" . $_SESSION["tramite"]["incluirformularios"] . "'",
            "'" . $_SESSION["tramite"]["incluircertificados"] . "'",
            "'" . $_SESSION["tramite"]["incluirdiploma"] . "'",
            "'" . $_SESSION["tramite"]["incluircartulina"] . "'",
            "'" . $_SESSION["tramite"]["matricularpnat"] . "'",
            "'" . $_SESSION["tramite"]["matricularest"] . "'",
            "'" . $_SESSION["tramite"]["regimentributario"] . "'",
            "'" . $_SESSION["tramite"]["tipomatricula"] . "'",
            "'" . $_SESSION["tramite"]["camaracambidom"] . "'",
            "'" . $_SESSION["tramite"]["matriculacambidom"] . "'",
            "'" . $_SESSION["tramite"]["municipiocambidom"] . "'",
            "'" . $_SESSION["tramite"]["fecmatcambidom"] . "'",
            "'" . $_SESSION["tramite"]["benart7"] . "'",
            "'" . $_SESSION["tramite"]["controlfirma"] . "'",
            "'" . $_SESSION["tramite"]["proyectocaja"] . "'",
            "'" . $_SESSION["tramite"]["cargoafiliacion"] . "'",
            "'" . $_SESSION["tramite"]["cargogastoadministrativo"] . "'",
            "'" . $_SESSION["tramite"]["cargoentidadoficial"] . "'",
            "'" . $_SESSION["tramite"]["cargoconsulta"] . "'",
            "'" . $_SESSION["tramite"]["actualizacionciiuversion4"] . "'",
            "'" . $_SESSION["tramite"]["reliquidacion"] . "'",
            doubleval($_SESSION["tramite"]["capital"]),
            // "'" . substr(trim($_SESSION["tramite"]["tipodoc"]),0,2) . "'",
            "''", // Tipo de documento
            "'" . $_SESSION["tramite"]["numdoc"] . "'",
            "'" . $_SESSION["tramite"]["fechadoc"] . "'",
            "'" . addslashes($_SESSION["tramite"]["origendoc"]) . "'",
            "'" . $_SESSION["tramite"]["mundoc"] . "'",
            "'" . $_SESSION["tramite"]["organizacion"] . "'",
            "'" . $_SESSION["tramite"]["categoria"] . "'",
            "'" . $_SESSION["tramite"]["tipoiderepleg"] . "'",
            "'" . $_SESSION["tramite"]["iderepleg"] . "'",
            "'" . addslashes($_SESSION["tramite"]["nombrerepleg"]) . "'",
            "'" . $_SESSION["tramite"]["tipoideradicador"] . "'",
            "'" . $_SESSION["tramite"]["ideradicador"] . "'",
            "'" . $_SESSION["tramite"]["fechaexpradicador"] . "'",
            "'" . addslashes($_SESSION["tramite"]["nombreradicador"]) . "'",
            "'" . addslashes($_SESSION["tramite"]["emailradicador"]) . "'",
            "'" . $_SESSION["tramite"]["telefonoradicador"] . "'",
            "'" . $_SESSION["tramite"]["celularradicador"] . "'",
            "'" . addslashes($_SESSION["tramite"]["nrocontrolsipref"]) . "'",
            "'" . $_SESSION["tramite"]["tramitepresencial"] . "'",
            "'" . $_SESSION["tramite"]["firmadoelectronicamente"] . "'",
            "'" . addslashes($_SESSION["tramite"]["emailcontrol"]) . "'",
            "'" . $_SESSION["tramite"]["cumplorequisitosbenley1780"] . "'",
            "'" . $_SESSION["tramite"]["mantengorequisitosbenley1780"] . "'",
            "'" . $_SESSION["tramite"]["renunciobeneficiosley1780"] . "'",
            "'" . $_SESSION["tramite"]["controlactividadaltoimpacto"] . "'",
            "'" . $_SESSION["tramite"]["multadoponal"] . "'"
        );

        //
        if ($conteo == 0) {
            $result = insertarRegistrosmyqli2($dbx, 'mreg_liquidacion', $arrCampos, $arrValues);
            if ($result === false) {
                $_SESSION["generales"]["mensajeerror"] = 'Error insertando liquidacion en mreg_liquidacion (' . $_SESSION["generales"]["mensajeerror"] . ')';
                return false;
            }
        }

        //
        if ($conteo > 0) {
            $condicion = 'idliquidacion=' . $_SESSION["tramite"]["numeroliquidacion"];
            $result = regrabarRegistrosMysqli2($dbx, 'mreg_liquidacion', $arrCampos, $arrValues, $condicion);
            if ($result === false) {
                $_SESSION["generales"]["mensajeerror"] = 'Error actualizando liquidacion en mreg_liquidacion (' . $_SESSION["generales"]["mensajeerror"] . ')';
                return false;
            }
        }


        // Campos adicionales de la liquidación
        borrarRegistrosMysqli2($dbx, 'mreg_liquidacion_campos', "idliquidacion=" . $_SESSION["tramite"]["numeroliquidacion"]);

        //

        $res = array();
        $arrCampos = array(
            'idliquidacion',
            'campo',
            'contenido'
        );
        $ix = 0;
        $arrValores = array();

        // WSIERRA 2018-03-05 grabación del campo de control de matriculas a renovar   
        if (isset($_SESSION["tramite"]["procesartodas"]) && trim($_SESSION["tramite"]["procesartodas"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'procesartodas'", "'" . $_SESSION["tramite"]["procesartodas"] . "'");
        }

        if (trim($_SESSION["tramite"]["origen"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'origen'", "'" . $_SESSION["tramite"]["origen"] . "'");
        }

        if (trim($_SESSION["tramite"]["subtipotramite"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'subtipotramite'", "'" . $_SESSION["tramite"]["subtipotramite"] . "'");
        }

        if (trim($_SESSION["tramite"]["tipoproponente"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipoproponente'", "'" . $_SESSION["tramite"]["tipoproponente"] . "'");
        }

        if (trim($_SESSION["tramite"]["matriculabase"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'matriculabase'", "'" . $_SESSION["tramite"]["matriculabase"] . "'");
        }

        if (trim($_SESSION["tramite"]["nom1base"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nom1base'", "'" . $_SESSION["tramite"]["nom1base"] . "'");
        }

        if (trim($_SESSION["tramite"]["nom2base"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nom2base'", "'" . $_SESSION["tramite"]["nom2base"] . "'");
        }

        if (trim($_SESSION["tramite"]["ape1base"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ape1base'", "'" . $_SESSION["tramite"]["ape1base"] . "'");
        }

        if (trim($_SESSION["tramite"]["ape2base"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ape1base'", "'" . $_SESSION["tramite"]["ape2base"] . "'");
        }

        if (trim($_SESSION["tramite"]["tipoidentificacionbase"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipoidentificacionbase'", "'" . $_SESSION["tramite"]["tipoidentificacionbase"] . "'");
        }

        if (trim($_SESSION["tramite"]["identificacionbase"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'identificacionbase'", "'" . $_SESSION["tramite"]["identificacionbase"] . "'");
        }

        if (trim($_SESSION["tramite"]["organizacionbase"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'organizacionbase'", "'" . $_SESSION["tramite"]["organizacionbase"] . "'");
        }

        if (trim($_SESSION["tramite"]["categoriabase"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'categoriabase'", "'" . $_SESSION["tramite"]["categoriabase"] . "'");
        }

        if (trim($_SESSION["tramite"]["afiliadobase"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'afiliadobase'", "'" . $_SESSION["tramite"]["afiliadobase"] . "'");
        }


        if (trim($_SESSION["tramite"]["tipocliente"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipocliente'", "'" . $_SESSION["tramite"]["tipocliente"] . "'");
        }

        if (trim($_SESSION["tramite"]["razonsocialcliente"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'razonsocialcliente'", "'" . $_SESSION["tramite"]["razonsocialcliente"] . "'");
        }

        if (trim($_SESSION["tramite"]["apellido1cliente"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido1cliente'", "'" . $_SESSION["tramite"]["apellido1cliente"] . "'");
        }

        if (trim($_SESSION["tramite"]["apellido2cliente"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido2cliente'", "'" . $_SESSION["tramite"]["apellido2cliente"] . "'");
        }

        if (trim($_SESSION["tramite"]["nombre1cliente"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre1cliente'", "'" . $_SESSION["tramite"]["nombre1cliente"] . "'");
        }

        if (trim($_SESSION["tramite"]["nombre2cliente"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre2cliente'", "'" . $_SESSION["tramite"]["nombre2cliente"] . "'");
        }



        //
        if (trim($_SESSION["tramite"]["tipopagador"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipopagador'", "'" . $_SESSION["tramite"]["tipopagador"] . "'");
        }
        if (trim($_SESSION["tramite"]["razonsocialpagador"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'razonsocialpagador'", "'" . $_SESSION["tramite"]["razonsocialpagador"] . "'");
        }
        if (trim($_SESSION["tramite"]["apellido1pagador"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido1pagador'", "'" . $_SESSION["tramite"]["apellido1pagador"] . "'");
        }
        if (trim($_SESSION["tramite"]["apellido2pagador"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido2pagador'", "'" . $_SESSION["tramite"]["apellido2pagador"] . "'");
        }
        if (trim($_SESSION["tramite"]["nombre1pagador"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre1pagador'", "'" . $_SESSION["tramite"]["nombre1pagador"] . "'");
        }
        if (trim($_SESSION["tramite"]["nombre2pagador"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre2pagador'", "'" . $_SESSION["tramite"]["nombre2pagador"] . "'");
        }

        //
        if (trim($_SESSION["tramite"]["modcom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'modcom'", "'" . $_SESSION["tramite"]["modcom"] . "'");
        }
        if (trim($_SESSION["tramite"]["modnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'modnot'", "'" . $_SESSION["tramite"]["modnot"] . "'");
        }
        if (trim($_SESSION["tramite"]["modciiu"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'modciiu'", "'" . $_SESSION["tramite"]["modciiu"] . "'");
        }
        if (trim($_SESSION["tramite"]["modnombre"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'modnombre'", "'" . $_SESSION["tramite"]["modnombre"] . "'");
        }
        if (trim($_SESSION["tramite"]["fecrencambidom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'fecrencambidom'", "'" . $_SESSION["tramite"]["fecrencambidom"] . "'");
        }

        if (trim($_SESSION["tramite"]["nombre1repleg"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre1repleg'", "'" . addslashes($_SESSION["tramite"]["nombre1repleg"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre2repleg"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre2repleg'", "'" . addslashes($_SESSION["tramite"]["nombre2repleg"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido1repleg"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido1repleg'", "'" . addslashes($_SESSION["tramite"]["apellido1repleg"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido2repleg"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido2repleg'", "'" . addslashes($_SESSION["tramite"]["apellido2repleg"]) . "'");
        }
        if (trim($_SESSION["tramite"]["cargorepleg"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'cargorepleg'", "'" . addslashes($_SESSION["tramite"]["cargorepleg"]) . "'");
        }
        if (trim($_SESSION["tramite"]["emailrepleg"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailrepleg'", "'" . addslashes($_SESSION["tramite"]["emailrepleg"]) . "'");
        }
        if (trim($_SESSION["tramite"]["firmorepleg"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'firmorepleg'", "'" . $_SESSION["tramite"]["firmorepleg"] . "'");
        }
        if (trim($_SESSION["tramite"]["celularrepleg"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'celularrepleg'", "'" . $_SESSION["tramite"]["celularrepleg"] . "'");
        }

        if (trim($_SESSION["tramite"]["tipolibro"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipolibro'", "'" . $_SESSION["tramite"]["tipolibro"] . "'");
        }
        if (trim($_SESSION["tramite"]["codigolibro"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'codigolibro'", "'" . $_SESSION["tramite"]["codigolibro"] . "'");
        }
        if (trim($_SESSION["tramite"]["primeravez"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'primeravez'", "'" . $_SESSION["tramite"]["primeravez"] . "'");
        }
        if (trim($_SESSION["tramite"]["confirmadigital"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'confirmadigital'", "'" . $_SESSION["tramite"]["confirmadigital"] . "'");
        }

        if (trim($_SESSION["tramite"]["iderevfis"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'iderevfis'", "'" . $_SESSION["tramite"]["iderevfis"] . "'");
        }
        if (trim($_SESSION["tramite"]["nombre1revfis"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre1revfis'", "'" . addslashes($_SESSION["tramite"]["nombre1revfis"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre2revfis"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre2revfis'", "'" . addslashes($_SESSION["tramite"]["nombre2revfis"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido1revfis"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido1revfis'", "'" . addslashes($_SESSION["tramite"]["apellido1revfis"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido2revfis"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido2revfis'", "'" . addslashes($_SESSION["tramite"]["apellido2revfis"]) . "'");
        }
        if (trim($_SESSION["tramite"]["cargorevfis"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'cargorevfis'", "'" . addslashes($_SESSION["tramite"]["cargorevfis"]) . "'");
        }
        if (trim($_SESSION["tramite"]["emailrevfis"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailrevfis'", "'" . addslashes($_SESSION["tramite"]["emailrevfis"]) . "'");
        }
        if (trim($_SESSION["tramite"]["firmorevfis"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'firmorevfis'", "'" . $_SESSION["tramite"]["firmorevfis"] . "'");
        }
        if (trim($_SESSION["tramite"]["celularrevfis"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'celularrevfis'", "'" . $_SESSION["tramite"]["celularrevfis"] . "'");
        }

        if (trim($_SESSION["tramite"]["idepreasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'idepreasa'", "'" . $_SESSION["tramite"]["idepreasa"] . "'");
        }
        if (trim($_SESSION["tramite"]["nombre1preasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre1preasa'", "'" . addslashes($_SESSION["tramite"]["nombre1preasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre2preasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre2preasa'", "'" . addslashes($_SESSION["tramite"]["nombre2preasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido1preasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido1preasa'", "'" . addslashes($_SESSION["tramite"]["apellido1preasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido2preasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido2preasa'", "'" . addslashes($_SESSION["tramite"]["apellido2preasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["cargopreasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'cargopreasa'", "'" . addslashes($_SESSION["tramite"]["cargopreasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["emailpreasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailpreasa'", "'" . addslashes($_SESSION["tramite"]["emailpreasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["firmopreasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'firmopreasa'", "'" . addslashes($_SESSION["tramite"]["firmopreasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["celularpreasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'celularpreasa'", "'" . $_SESSION["tramite"]["celularpreasa"] . "'");
        }

        if (trim($_SESSION["tramite"]["idesecasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'idesecasa'", "'" . addslashes($_SESSION["tramite"]["idesecasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre1secasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre1secasa'", "'" . addslashes($_SESSION["tramite"]["nombre1secasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre2secasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre2secasa'", "'" . addslashes($_SESSION["tramite"]["nombre2secasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido1secasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido1secasa'", "'" . addslashes($_SESSION["tramite"]["apellido1secasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido2secasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido2secasa'", "'" . addslashes($_SESSION["tramite"]["apellido2secasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["cargosecasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'cargosecasa'", "'" . addslashes($_SESSION["tramite"]["cargosecasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["emailsecasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailsecasa'", "'" . addslashes($_SESSION["tramite"]["emailsecasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["firmosecasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'firmosecasa'", "'" . addslashes($_SESSION["tramite"]["firmosecasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["celularsecasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'celularsecasa'", "'" . $_SESSION["tramite"]["celularsecasa"] . "'");
        }

        if (trim($_SESSION["tramite"]["tipoidentificacionaceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipoidentificacionaceptante'", "'" . addslashes($_SESSION["tramite"]["tipoidentificacionaceptante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["identificacionaceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'identificacionaceptante'", "'" . addslashes($_SESSION["tramite"]["identificacionaceptante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre1aceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre1aceptante'", "'" . addslashes($_SESSION["tramite"]["nombre1aceptante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre2aceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre2aceptante'", "'" . addslashes($_SESSION["tramite"]["nombre2aceptante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido1aceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido1aceptante'", "'" . addslashes($_SESSION["tramite"]["apellido1aceptante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido2aceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido2aceptante'", "'" . addslashes($_SESSION["tramite"]["apellido2aceptante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["direccionaceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'direccionaceptante'", "'" . addslashes($_SESSION["tramite"]["direccionaceptante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["emailaceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailaceptante'", "'" . addslashes($_SESSION["tramite"]["emailaceptante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["municipioaceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'municipioaceptante'", "'" . addslashes($_SESSION["tramite"]["municipioaceptante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["telefonoaceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'telefonoaceptante'", "'" . addslashes($_SESSION["tramite"]["telefonoaceptante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["celularaceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'celularaceptante'", "'" . addslashes($_SESSION["tramite"]["celularaceptante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["cargoaceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'cargoaceptante'", "'" . addslashes($_SESSION["tramite"]["cargoaceptante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["fechadocideaceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'fechadocideaceptante'", "'" . addslashes($_SESSION["tramite"]["fechadocideaceptante"]) . "'");
        }

        if (trim($_SESSION["tramite"]["motivocorreccion"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'motivocorreccion'", "'" . addslashes($_SESSION["tramite"]["motivocorreccion"]) . "'");
        }
        if (trim($_SESSION["tramite"]["tipoerror1"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipoerror1'", "'" . addslashes($_SESSION["tramite"]["tipoerror1"]) . "'");
        }
        if (trim($_SESSION["tramite"]["tipoerror2"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipoerror2'", "'" . addslashes($_SESSION["tramite"]["tipoerror2"]) . "'");
        }
        if (trim($_SESSION["tramite"]["tipoerror3"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipoerror3'", "'" . addslashes($_SESSION["tramite"]["tipoerror3"]) . "'");
        }
        if (trim($_SESSION["tramite"]["tipoidentificacioncor"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipoidentificacioncor'", "'" . addslashes($_SESSION["tramite"]["tipoidentificacioncor"]) . "'");
        }
        if (trim($_SESSION["tramite"]["identificacioncor"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'identificacioncor'", "'" . addslashes($_SESSION["tramite"]["identificacioncor"]) . "'");
        }

        if (trim($_SESSION["tramite"]["nombre1cor"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre1cor'", "'" . addslashes($_SESSION["tramite"]["nombre1cor"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre2cor"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre2cor'", "'" . addslashes($_SESSION["tramite"]["nombre2cor"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido1cor"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido1cor'", "'" . addslashes($_SESSION["tramite"]["apellido1cor"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido2cor"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido2cor'", "'" . addslashes($_SESSION["tramite"]["apellido2cor"]) . "'");
        }
        if (trim($_SESSION["tramite"]["direccioncor"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'direccioncor'", "'" . addslashes($_SESSION["tramite"]["direccioncor"]) . "'");
        }
        if (trim($_SESSION["tramite"]["municipiocor"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'municipiocor'", "'" . addslashes($_SESSION["tramite"]["municipiocor"]) . "'");
        }
        if (trim($_SESSION["tramite"]["emailcor"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailcor'", "'" . addslashes($_SESSION["tramite"]["emailcor"]) . "'");
        }
        if (trim($_SESSION["tramite"]["telefonocor"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'telefonocor'", "'" . addslashes($_SESSION["tramite"]["telefonocor"]) . "'");
        }
        if (trim($_SESSION["tramite"]["celularcor"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'celularcor'", "'" . addslashes($_SESSION["tramite"]["celularcor"]) . "'");
        }


        if (trim($_SESSION["tramite"]["descripcionembargo"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'descripcionembargo'", "'" . addslashes($_SESSION["tramite"]["descripcionembargo"]) . "'");
        }
        if (trim($_SESSION["tramite"]["descripciondesembargo"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'descripciondesembargo'", "'" . addslashes($_SESSION["tramite"]["descripciondesembargo"]) . "'");
        }
        if (trim($_SESSION["tramite"]["tipoidentificaciondemandante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipoidentificaciondemandante'", "'" . addslashes($_SESSION["tramite"]["tipoidentificaciondemandante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["identificaciondemandante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'identificaciondemandante'", "'" . addslashes($_SESSION["tramite"]["identificaciondemandante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombredemandante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombredemandante'", "'" . addslashes($_SESSION["tramite"]["nombredemandante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["libro"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'libro'", "'" . addslashes($_SESSION["tramite"]["libro"]) . "'");
        }
        if (trim($_SESSION["tramite"]["numreg"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'numreg'", "'" . addslashes($_SESSION["tramite"]["numreg"]) . "'");
        }

        if (trim($_SESSION["tramite"]["descripcionpqr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'descripcionpqr'", "'" . addslashes($_SESSION["tramite"]["descripcionpqr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["tipoidentificacionpqr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipoidentificacionpqr'", "'" . addslashes($_SESSION["tramite"]["tipoidentificacionpqr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["identificacionpqr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'identificacionpqr'", "'" . addslashes($_SESSION["tramite"]["identificacionpqr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre1pqr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre1pqr'", "'" . addslashes($_SESSION["tramite"]["nombre1pqr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre2pqr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre2pqr'", "'" . addslashes($_SESSION["tramite"]["nombre2pqr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido1pqr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido1pqr'", "'" . addslashes($_SESSION["tramite"]["apellido1pqr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido2pqr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido2pqr'", "'" . addslashes($_SESSION["tramite"]["apellido2pqr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["direccionpqr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'direccionpqr'", "'" . addslashes($_SESSION["tramite"]["direccionpqr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["municipiopqr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'municipiopqr'", "'" . addslashes($_SESSION["tramite"]["municipiopqr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["emailpqr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailpqr'", "'" . addslashes($_SESSION["tramite"]["emailpqr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["telefonopqr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'telefonopqr'", "'" . addslashes($_SESSION["tramite"]["telefonopqr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["celularpqr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'celularpqr'", "'" . addslashes($_SESSION["tramite"]["celularpqr"]) . "'");
        }

        if (trim($_SESSION["tramite"]["descripcionrr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'descripcionrr'", "'" . addslashes($_SESSION["tramite"]["descripcionrr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["tipoidentificacionrr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipoidentificacionrr'", "'" . addslashes($_SESSION["tramite"]["tipoidentificacionrr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["identificacionrr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'identificacionrr'", "'" . addslashes($_SESSION["tramite"]["identificacionrr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre1rr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre1rr'", "'" . addslashes($_SESSION["tramite"]["nombre1rr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre2rr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre2rr'", "'" . addslashes($_SESSION["tramite"]["nombre2rr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido1rr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido1rr'", "'" . addslashes($_SESSION["tramite"]["apellido1rr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido2rr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido2rr'", "'" . addslashes($_SESSION["tramite"]["apellido2rr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["direccionrr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'direccionrr'", "'" . addslashes($_SESSION["tramite"]["direccionrr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["municipiorr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'municipiorr'", "'" . addslashes($_SESSION["tramite"]["municipiorr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["emailrr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailrr'", "'" . addslashes($_SESSION["tramite"]["emailrr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["telefonorr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'telefonorr'", "'" . addslashes($_SESSION["tramite"]["telefonorr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["celularrr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'celularrr'", "'" . addslashes($_SESSION["tramite"]["celularrr"]) . "'");
        }


        if (trim($_SESSION["tramite"]["tipocertificado"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipocertificado'", "'" . addslashes($_SESSION["tramite"]["tipocertificado"]) . "'");
        }
        if (trim($_SESSION["tramite"]["explicacion"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'explicacion'", "'" . addslashes($_SESSION["tramite"]["explicacion"]) . "'");
        }

        if (trim($_SESSION["tramite"]["textolibre"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'textolibre'", "'" . addslashes($_SESSION["tramite"]["textolibre"]) . "'");
        }

        if (trim($_SESSION["tramite"]["matriculaafiliado"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'matriculaafiliado'", "'" . addslashes($_SESSION["tramite"]["matriculaafiliado"]) . "'");
        }
        if (trim($_SESSION["tramite"]["opcionafiliado"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'opcionafiliado'", "'" . addslashes($_SESSION["tramite"]["opcionafiliado"]) . "'");
        }
        if (trim($_SESSION["tramite"]["saldoafiliado"]) != 0) {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'saldoafiliado'", "'" . addslashes($_SESSION["tramite"]["saldoafiliado"]) . "'");
        }
        if (trim($_SESSION["tramite"]["ultanorenafi"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ultanorenafi'", "'" . addslashes($_SESSION["tramite"]["ultanorenafi"]) . "'");
        }

        //
        if (trim($_SESSION["tramite"]["nombrepjur"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombrepjur'", "'" . addslashes($_SESSION["tramite"]["nombrepjur"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombresuc"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombresuc'", "'" . addslashes($_SESSION["tramite"]["nombresuc"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombreage"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombreage'", "'" . addslashes($_SESSION["tramite"]["nombreage"]) . "'");
        }

        if (trim($_SESSION["tramite"]["orgpnat"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'orgpnat'", "'" . addslashes($_SESSION["tramite"]["orgpnat"]) . "'");
        }
        if (trim($_SESSION["tramite"]["orgpjur"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'orgpjur'", "'" . addslashes($_SESSION["tramite"]["orgpjur"]) . "'");
        }
        if (trim($_SESSION["tramite"]["orgsuc"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'orgsuc'", "'" . addslashes($_SESSION["tramite"]["orgsuc"]) . "'");
        }
        if (trim($_SESSION["tramite"]["orgage"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'orgage'", "'" . addslashes($_SESSION["tramite"]["orgage"]) . "'");
        }

        if (trim($_SESSION["tramite"]["munpnat"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'munpnat'", "'" . addslashes($_SESSION["tramite"]["munpnat"]) . "'");
        }
        if (trim($_SESSION["tramite"]["munest"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'munest'", "'" . addslashes($_SESSION["tramite"]["munest"]) . "'");
        }
        if (trim($_SESSION["tramite"]["munpjur"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'munpjur'", "'" . addslashes($_SESSION["tramite"]["munpjur"]) . "'");
        }
        if (trim($_SESSION["tramite"]["munsuc"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'munsuc'", "'" . addslashes($_SESSION["tramite"]["munsuc"]) . "'");
        }
        if (trim($_SESSION["tramite"]["munage"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'munage'", "'" . addslashes($_SESSION["tramite"]["munage"]) . "'");
        }

        if (trim($_SESSION["tramite"]["perpjur"]) != 0) {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'perpjur'", "'" . addslashes($_SESSION["tramite"]["perpjur"]) . "'");
        }

        if (trim($_SESSION["tramite"]["actpjur"]) != 0) {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'actpjur'", "'" . addslashes($_SESSION["tramite"]["actpjur"]) . "'");
        }
        if (trim($_SESSION["tramite"]["actsuc"]) != 0) {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'actsuc", "'" . addslashes($_SESSION["tramite"]["actsuc"]) . "'");
        }
        if (trim($_SESSION["tramite"]["actage"]) != 0) {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'actage'", "'" . addslashes($_SESSION["tramite"]["actage"]) . "'");
        }

        // En caso de mutaciones - direccion comercial
        if (trim($_SESSION["tramite"]["ant_dircom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_dircom'", "'" . $_SESSION["tramite"]["ant_dircom"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_telcom1"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_telcom1'", "'" . $_SESSION["tramite"]["ant_telcom1"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_telcom2"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_telcom2'", "'" . $_SESSION["tramite"]["ant_telcom2"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_faxcom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_faxcom'", "'" . $_SESSION["tramite"]["ant_faxcom"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_celcom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_celcom'", "'" . $_SESSION["tramite"]["ant_celcom"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_numpredial"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_numpredial'", "'" . $_SESSION["tramite"]["ant_numpredial"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_barriocom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_barriocom'", "'" . $_SESSION["tramite"]["ant_barriocom"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_muncom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_muncom'", "'" . $_SESSION["tramite"]["ant_muncom"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_emailcom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_emailcom'", "'" . $_SESSION["tramite"]["ant_emailcom"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_emailcom2"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_emailcom2'", "'" . $_SESSION["tramite"]["ant_emailcom2"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_emailcom3"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_emailcom3'", "'" . $_SESSION["tramite"]["ant_emailcom3"] . "'");
        }

        if (trim($_SESSION["tramite"]["dircom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'dircom'", "'" . $_SESSION["tramite"]["dircom"] . "'");
        }
        if (trim($_SESSION["tramite"]["telcom1"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'telcom1'", "'" . $_SESSION["tramite"]["telcom1"] . "'");
        }
        if (trim($_SESSION["tramite"]["telcom2"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'telcom2'", "'" . $_SESSION["tramite"]["telcom2"] . "'");
        }
        if (trim($_SESSION["tramite"]["faxcom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'faxcom'", "'" . $_SESSION["tramite"]["faxcom"] . "'");
        }
        if (trim($_SESSION["tramite"]["celcom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'celcom'", "'" . $_SESSION["tramite"]["celcom"] . "'");
        }
        if (trim($_SESSION["tramite"]["barriocom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'barriocom'", "'" . $_SESSION["tramite"]["barriocom"] . "'");
        }
        if (trim($_SESSION["tramite"]["muncom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'muncom'", "'" . $_SESSION["tramite"]["muncom"] . "'");
        }
        if (trim($_SESSION["tramite"]["numpredial"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'numpredial'", "'" . $_SESSION["tramite"]["numpredial"] . "'");
        }
        if (trim($_SESSION["tramite"]["emailcom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailcom'", "'" . $_SESSION["tramite"]["emailcom"] . "'");
        }
        if (trim($_SESSION["tramite"]["emailcom2"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailcom2'", "'" . $_SESSION["tramite"]["emailcom2"] . "'");
        }
        if (trim($_SESSION["tramite"]["emailcom3"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailcom3'", "'" . $_SESSION["tramite"]["emailcom3"] . "'");
        }

        // En caso de mutaciones - direccion notificacion
        if (trim($_SESSION["tramite"]["ant_dirnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_dirnot'", "'" . $_SESSION["tramite"]["ant_dirnot"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_telnot1"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_telnot1'", "'" . $_SESSION["tramite"]["ant_telnot1"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_telnot2"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_telnot2'", "'" . $_SESSION["tramite"]["ant_telnot2"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_faxnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_faxnot'", "'" . $_SESSION["tramite"]["ant_faxnot"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_celnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_celnot'", "'" . $_SESSION["tramite"]["ant_celnot"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_barrionot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_barrionot'", "'" . $_SESSION["tramite"]["ant_barrionot"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_munnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_munnot'", "'" . $_SESSION["tramite"]["ant_munnot"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_emailnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_emailnot'", "'" . $_SESSION["tramite"]["ant_emailnot"] . "'");
        }

        if (trim($_SESSION["tramite"]["dirnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'dirnot'", "'" . $_SESSION["tramite"]["dirnot"] . "'");
        }
        if (trim($_SESSION["tramite"]["telnot1"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'telnot1'", "'" . $_SESSION["tramite"]["telnot1"] . "'");
        }
        if (trim($_SESSION["tramite"]["telnot2"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'telnot2'", "'" . $_SESSION["tramite"]["telnot2"] . "'");
        }
        if (trim($_SESSION["tramite"]["faxnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'faxnot'", "'" . $_SESSION["tramite"]["faxnot"] . "'");
        }
        if (trim($_SESSION["tramite"]["celnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'celnot'", "'" . $_SESSION["tramite"]["celnot"] . "'");
        }
        if (trim($_SESSION["tramite"]["barrionot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'barrionot'", "'" . $_SESSION["tramite"]["barrionot"] . "'");
        }
        if (trim($_SESSION["tramite"]["munnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'munnot'", "'" . $_SESSION["tramite"]["munnot"] . "'");
        }
        if (trim($_SESSION["tramite"]["emailnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailnot'", "'" . $_SESSION["tramite"]["emailnot"] . "'");
        }

        // En caso de mutaciones - actividad
        if (trim($_SESSION["tramite"]["ant_versionciiu"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_versionciiu'", "'" . $_SESSION["tramite"]["ant_versionciiu"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_ciiu11"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_ciiu11'", "'" . $_SESSION["tramite"]["ant_ciiu11"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_ciiu12"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_ciiu12'", "'" . $_SESSION["tramite"]["ant_ciiu12"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_ciiu13"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_ciiu13'", "'" . $_SESSION["tramite"]["ant_ciiu13"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_ciiu14"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_ciiu14'", "'" . $_SESSION["tramite"]["ant_ciiu14"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_ciiu21"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_ciiu21'", "'" . $_SESSION["tramite"]["ant_ciiu21"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_ciiu22"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_ciiu22'", "'" . $_SESSION["tramite"]["ant_ciiu22"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_ciiu23"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_ciiu23'", "'" . $_SESSION["tramite"]["ant_ciiu23"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_ciiu24"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_ciiu24'", "'" . $_SESSION["tramite"]["ant_ciiu24"] . "'");
        }

        if (trim($_SESSION["tramite"]["nombreanterior"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombreanterior'", "'" . $_SESSION["tramite"]["nombreanterior"] . "'");
        }
        if (trim($_SESSION["tramite"]["nombrenuevo"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombrenuevo'", "'" . $_SESSION["tramite"]["nombrenuevo"] . "'");
        }
        if (trim($_SESSION["tramite"]["nuevonombre"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nuevonombre'", "'" . $_SESSION["tramite"]["nuevonombre"] . "'");
        }

        if (trim($_SESSION["tramite"]["versionciiu"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'versionciiu'", "'" . $_SESSION["tramite"]["versionciiu"] . "'");
        }
        if (trim($_SESSION["tramite"]["ciiu11"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ciiu11'", "'" . $_SESSION["tramite"]["ciiu11"] . "'");
        }
        if (trim($_SESSION["tramite"]["ciiu12"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ciiu12'", "'" . $_SESSION["tramite"]["ciiu12"] . "'");
        }
        if (trim($_SESSION["tramite"]["ciiu13"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ciiu13'", "'" . $_SESSION["tramite"]["ciiu13"] . "'");
        }
        if (trim($_SESSION["tramite"]["ciiu14"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ciiu14'", "'" . $_SESSION["tramite"]["ciiu14"] . "'");
        }
        if (trim($_SESSION["tramite"]["ciiu21"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ciiu21'", "'" . $_SESSION["tramite"]["ciiu21"] . "'");
        }
        if (trim($_SESSION["tramite"]["ciiu22"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ciiu22'", "'" . $_SESSION["tramite"]["ciiu22"] . "'");
        }
        if (trim($_SESSION["tramite"]["ciiu23"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ciiu23'", "'" . $_SESSION["tramite"]["ciiu23"] . "'");
        }
        if (trim($_SESSION["tramite"]["ciiu24"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ciiu24'", "'" . $_SESSION["tramite"]["ciiu24"] . "'");
        }

        if (trim($_SESSION["tramite"]["nombreanterior"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombreanterior'", "'" . $_SESSION["tramite"]["nombreanterior"] . "'");
        }
        if (trim($_SESSION["tramite"]["nombrenuevo"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombrenuevo'", "'" . $_SESSION["tramite"]["nombrenuevo"] . "'");
        }

        // En caso de tr&aacute;mites rues
        if (trim($_SESSION["tramite"]["rues_numerointerno"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_numerointerno'", "'" . addslashes($_SESSION["tramite"]["rues_numerointerno"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_numerounico"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_numerounico'", "'" . addslashes($_SESSION["tramite"]["rues_numerounico"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_camarareceptora"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_camarareceptora'", "'" . addslashes($_SESSION["tramite"]["rues_camarareceptora"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_camararesponsable"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_camararesponsable'", "'" . addslashes($_SESSION["tramite"]["rues_camararesponsable"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_codigoservicioradicar"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_codigoservicioradicar'", "'" . addslashes($_SESSION["tramite"]["rues_codigoservicioradicar"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_matricula"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_matricula'", "'" . addslashes($_SESSION["tramite"]["rues_matricula"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_proponente"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_proponente'", "'" . addslashes($_SESSION["tramite"]["rues_proponente"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_nombreregistrado"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_nombreregistrado'", "'" . addslashes($_SESSION["tramite"]["rues_nombreregistrado"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_claseidentificacion"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_claseidentificacion'", "'" . $_SESSION["tramite"]["rues_claseidentificacion"] . "'");
        }
        if (trim($_SESSION["tramite"]["rues_numeroidentificacion"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_numeroidentificacion'", "'" . $_SESSION["tramite"]["rues_numeroidentificacion"] . "'");
        }
        if (trim($_SESSION["tramite"]["rues_dv"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_dv'", "'" . $_SESSION["tramite"]["rues_dv"] . "'");
        }
        if (trim($_SESSION["tramite"]["rues_estado_liquidacion"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_estado_liquidacion'", "'" . $_SESSION["tramite"]["rues_estado_liquidacion"] . "'");
        }
        if (trim($_SESSION["tramite"]["rues_estado_transaccion"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_estado_transaccion'", "'" . $_SESSION["tramite"]["rues_estado_transaccion"] . "'");
        }
        if (trim($_SESSION["tramite"]["rues_nombrepagador"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_nombrepagador'", "'" . addslashes($_SESSION["tramite"]["rues_nombrepagador"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_origendocumento"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_origendocumento'", "'" . addslashes($_SESSION["tramite"]["rues_origendocumento"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_fechadocumento"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_fechadocumento'", "'" . addslashes($_SESSION["tramite"]["rues_fechadocumento"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_fechapago"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_fechapago'", "'" . addslashes($_SESSION["tramite"]["rues_fechapago"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_numerofactura"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_numerofactura'", "'" . addslashes($_SESSION["tramite"]["rues_numerofactura"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_referenciaoperacion"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_referenciaoperacion'", "'" . addslashes($_SESSION["tramite"]["rues_referenciaoperacion"]) . "'");
        }
        if (doubleval($_SESSION["tramite"]["rues_totalpagado"]) != 0) {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_totalpagado'", "'" . addslashes($_SESSION["tramite"]["rues_totalpagado"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_formapago"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_formapago'", "'" . addslashes($_SESSION["tramite"]["rues_formapago"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_indicadororigen"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_indicadororigen'", "'" . addslashes($_SESSION["tramite"]["rues_indicadororigen"]) . "'");
        }
        if (doubleval($_SESSION["tramite"]["rues_empleados"]) != 0) {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_empleados'", "'" . addslashes($_SESSION["tramite"]["rues_empleados"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_indicadorbeneficio"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_indicadorbeneficio'", "'" . addslashes($_SESSION["tramite"]["rues_indicadorbeneficio"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_fecharespuesta"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_fecharespuesta'", "'" . addslashes($_SESSION["tramite"]["rues_fecharespuesta"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_horarespuesta"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_horarespuesta'", "'" . addslashes($_SESSION["tramite"]["rues_horarespuesta"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_codigoerror"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_codigoerror'", "'" . addslashes($_SESSION["tramite"]["rues_codigoerror"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_mensajeerror"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_mensajeerror'", "'" . addslashes($_SESSION["tramite"]["rues_mensajeerror"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_firmadigital"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_firmadigital'", "'" . addslashes($_SESSION["tramite"]["rues_firmadigital"]) . "'");
        }
        if (doubleval($_SESSION["tramite"]["rues_caracteres_por_linea"]) != 0) {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_caracteres_por_linea'", "'" . addslashes($_SESSION["tramite"]["rues_caracteres_por_linea"]) . "'");
        }
        if (trim($_SESSION["tramite"]["tipoidefirmante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipoidefirmante'", "'" . addslashes($_SESSION["tramite"]["tipoidefirmante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["identificacionfirmante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'identificacionfirmante'", "'" . addslashes($_SESSION["tramite"]["identificacionfirmante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["fechaexpfirmante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'fechaexpfirmante'", "'" . addslashes($_SESSION["tramite"]["fechaexpfirmante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido1firmante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido1firmante'", "'" . addslashes($_SESSION["tramite"]["apellido1firmante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido2firmante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido2firmante'", "'" . addslashes($_SESSION["tramite"]["apellido2firmante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre1firmante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre1firmante'", "'" . addslashes($_SESSION["tramite"]["nombre1firmante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre2firmante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre2firmante'", "'" . addslashes($_SESSION["tramite"]["nombre2firmante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["emailfirmante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailfirmante'", "'" . addslashes($_SESSION["tramite"]["emailfirmante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["emailfirmanteseguimiento"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailfirmanteseguimiento'", "'" . addslashes($_SESSION["tramite"]["emailfirmanteseguimiento"]) . "'");
        }
        if (trim($_SESSION["tramite"]["celularfirmante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'celularfirmante'", "'" . addslashes($_SESSION["tramite"]["celularfirmante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["direccionfirmante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'direccionfirmante'", "'" . addslashes($_SESSION["tramite"]["direccionfirmante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["municipiofirmante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'municipiofirmante'", "'" . addslashes($_SESSION["tramite"]["municipiofirmante"]) . "'");
        }

        //
        if (trim($_SESSION["tramite"]["emailcontactoasesoria"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailcontactoasesoria'", "'" . addslashes($_SESSION["tramite"]["emailcontactoasesoria"]) . "'");
        }
        if (trim($_SESSION["tramite"]["comentariosasesoria"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'comentariosasesoria'", "'" . addslashes($_SESSION["tramite"]["comentariosasesoria"]) . "'");
        }

        //
        if (trim($_SESSION["tramite"]["pedirbalance"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'pedirbalance'", "'" . addslashes($_SESSION["tramite"]["pedirbalance"]) . "'");
        }

        //
        if (trim($_SESSION["tramite"]["quienasesora"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'quienasesora'", "'" . addslashes($_SESSION["tramite"]["quienasesora"]) . "'");
        }

        //
        if (trim($_SESSION["tramite"]["benley1780"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'benley1780'", "'" . addslashes($_SESSION["tramite"]["benley1780"]) . "'");
        }

        //
        if (trim($_SESSION["tramite"]["fechanacimientopnat"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'fechanacimientopnat'", "'" . addslashes($_SESSION["tramite"]["fechanacimientopnat"]) . "'");
        }

        //
        if (intval(trim($_SESSION["tramite"]["incrementocupocertificados"])) != 0) {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'incrementocupocertificados'", "'" . ($_SESSION["tramite"]["incrementocupocertificados"]) . "'");
        }

        // 2016-08-23 : JINT
        if (intval(trim($_SESSION["tramite"]["cobrarmutacion"])) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'cobrarmutacion'", "'" . ($_SESSION["tramite"]["cobrarmutacion"]) . "'");
        }

        // 2016-10-22 : JINT
        $ix++;
        $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'aceptadoprepago'", "'" . ($_SESSION["tramite"]["aceptadoprepago"]) . "'");

        // 2016-10-22 : JINT
        if (trim($_SESSION["tramite"]["propcamaraorigen"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'propcamaraorigen'", "'" . ($_SESSION["tramite"]["propcamaraorigen"]) . "'");
        }
        if (trim($_SESSION["tramite"]["propidmunicipioorigen"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'propidmunicipioorigen'", "'" . ($_SESSION["tramite"]["propidmunicipioorigen"]) . "'");
        }
        if (trim($_SESSION["tramite"]["propidmunicipiodestino"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'propidmunicipiodestino'", "'" . ($_SESSION["tramite"]["propidmunicipiodestino"]) . "'");
        }
        if (trim($_SESSION["tramite"]["propproponenteorigen"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'propproponenteorigen'", "'" . ($_SESSION["tramite"]["propproponenteorigen"]) . "'");
        }
        if (trim($_SESSION["tramite"]["propfechaultimainscripcion"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'propfechaultimainscripcion'", "'" . ($_SESSION["tramite"]["propfechaultimainscripcion"]) . "'");
        }
        if (trim($_SESSION["tramite"]["propfechaultimarenovacion"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'propfechaultimarenovacion'", "'" . ($_SESSION["tramite"]["propfechaultimarenovacion"]) . "'");
        }
        if (trim($_SESSION["tramite"]["propdircom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'propdircom'", "'" . ($_SESSION["tramite"]["propdircom"]) . "'");
        }
        if (trim($_SESSION["tramite"]["propmuncom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'propmuncom'", "'" . ($_SESSION["tramite"]["propmuncom"]) . "'");
        }
        if (trim($_SESSION["tramite"]["proptelcom1"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'proptelcom1'", "'" . ($_SESSION["tramite"]["proptelcom1"]) . "'");
        }
        if (trim($_SESSION["tramite"]["proptelcom2"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'proptelcom2'", "'" . ($_SESSION["tramite"]["proptelcom2"]) . "'");
        }
        if (trim($_SESSION["tramite"]["proptelcom3"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'proptelcom3'", "'" . ($_SESSION["tramite"]["proptelcom3"]) . "'");
        }
        if (trim($_SESSION["tramite"]["propemailcom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'propemailcom'", "'" . ($_SESSION["tramite"]["propemailcom"]) . "'");
        }
        if (trim($_SESSION["tramite"]["propdirnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'propdirnot'", "'" . ($_SESSION["tramite"]["propdirnot"]) . "'");
        }
        if (trim($_SESSION["tramite"]["propmunnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'propmunnot'", "'" . ($_SESSION["tramite"]["propmunnot"]) . "'");
        }
        if (trim($_SESSION["tramite"]["proptelnot1"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'proptelnot1'", "'" . ($_SESSION["tramite"]["proptelnot1"]) . "'");
        }
        if (trim($_SESSION["tramite"]["proptelnot2"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'proptelnot2'", "'" . ($_SESSION["tramite"]["proptelnot2"]) . "'");
        }
        if (trim($_SESSION["tramite"]["proptelnot3"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'proptelnot3'", "'" . ($_SESSION["tramite"]["proptelnot3"]) . "'");
        }
        if (trim($_SESSION["tramite"]["propemailnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'propemailnot'", "'" . ($_SESSION["tramite"]["propemailnot"]) . "'");
        }

        if (trim($_SESSION["tramite"]["tiporenovacion"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tiporenovacion'", "'" . ($_SESSION["tramite"]["tiporenovacion"]) . "'");
        }
        if (trim($_SESSION["tramite"]["activosbase"]) != '' && $_SESSION["tramite"]["activosbase"] != 0) {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'activosbase'", "'" . ($_SESSION["tramite"]["activosbase"]) . "'");
        }
        if (trim($_SESSION["tramite"]["personalbase"]) != '' && $_SESSION["tramite"]["personalbase"] != 0) {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'personalbase'", "'" . ($_SESSION["tramite"]["personalbase"]) . "'");
        }
        if (trim($_SESSION["tramite"]["enviara"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'enviara'", "'" . ($_SESSION["tramite"]["enviara"]) . "'");
        }

        //
        $res = insertarRegistrosBloqueMysqli2($dbx, 'mreg_liquidacion_campos', $arrCampos, $arrValores);
        if ($res === false) {
            return false;
        }

        $result = borrarRegistrosMysqli2($dbx, 'mreg_liquidaciondetalle', 'idliquidacion=' . $_SESSION["tramite"]["numeroliquidacion"]);
        $exp1 = '';
        $nom1 = '';
        $i = 0;
        foreach ($_SESSION["tramite"]["liquidacion"] as $liq) {
            if (!isset($liq["idsec"])) {
                $liq["idsec"] = '';
            }
            if (!isset($liq["idservicio"])) {
                $liq["idservicio"] = '';
            }
            if (!isset($liq["expediente"])) {
                $liq["expediente"] = '';
            }
            if (!isset($liq["nombre"])) {
                $liq["nombre"] = '';
            }
            if (!isset($liq["ano"])) {
                $liq["ano"] = '';
            }
            if (!isset($liq["cantidad"])) {
                $liq["cantidad"] = 0;
            }
            if (!isset($liq["valorbase"])) {
                $liq["valorbase"] = 0;
            }
            if (!isset($liq["porcentaje"])) {
                $liq["porcentaje"] = 0;
            }
            if (!isset($liq["valorservicio"])) {
                $liq["valorservicio"] = 0;
            }
            if (!isset($liq["benart7"])) {
                $liq["benart7"] = '';
            }
            if (!isset($liq["benley1780"])) {
                $liq["benley1780"] = '';
            }

            if (!isset($liq["reliquidacion"])) {
                $liq["reliquidacion"] = '';
            }
            if (!isset($liq["serviciobase"])) {
                $liq["serviciobase"] = '';
            }
            if (!isset($liq["pagoafiliacion"])) {
                $liq["pagoafiliacion"] = '';
            }
            if (!isset($liq["ir"])) {
                $liq["ir"] = '';
            }
            if (!isset($liq["iva"])) {
                $liq["iva"] = '';
            }
            if (!isset($liq["idalerta"])) {
                $liq["idalerta"] = '';
            }

            if (trim($liq["idservicio"]) != '') {
                $i++;
                if ($i == 1) {
                    $exp1 = $liq["expediente"];
                    $nom1 = $liq["nombre"];
                }

                //
                $arrCampos = array(
                    'idliquidacion',
                    'secuencia',
                    'idsec',
                    'idservicio',
                    'cc',
                    'expediente',
                    'nombre',
                    'ano',
                    'cantidad',
                    'valorbase',
                    'porcentaje',
                    'valorservicio',
                    'benart7',
                    'benley1780',
                    'reliquidacion',
                    'serviciobase',
                    'pagoafiliacion',
                    'ir',
                    'iva',
                    'idalerta'
                );

                //
                if (!isset($liq["cc"])) {
                    $liq["cc"] = '';
                }
                //
                $arrValues = array(
                    $_SESSION["tramite"]["numeroliquidacion"],
                    $i,
                    "'" . sprintf("%03s", $liq["idsec"]) . "'",
                    "'" . $liq["idservicio"] . "'",
                    "'" . $liq["cc"] . "'",
                    "'" . $liq["expediente"] . "'",
                    "'" . addslashes($liq["nombre"]) . "'",
                    "'" . $liq["ano"] . "'",
                    intval($liq["cantidad"]),
                    doubleval($liq["valorbase"]),
                    doubleval($liq["porcentaje"]),
                    doubleval($liq["valorservicio"]),
                    "'" . $liq["benart7"] . "'",
                    "'" . $liq["benley1780"] . "'",
                    "'" . $liq["reliquidacion"] . "'",
                    "'" . $liq["serviciobase"] . "'",
                    "'" . $liq["pagoafiliacion"] . "'",
                    "'" . $liq["ir"] . "'",
                    "'" . $liq["iva"] . "'",
                    intval($liq["idalerta"])
                );

                //
                $result = insertarRegistrosMysqli2($dbx, 'mreg_liquidaciondetalle', $arrCampos, $arrValues);
                if ($result === false) {
                    $_SESSION["generales"]["mensajeerror"] = 'Error insertando registros en mreg_liquidaciondetalle (' . $_SESSION ["generales"] ["mensajeerror"] . ')';
                    return false;
                }
            }
        }

        // Graba liquidacion RUES
        $result = borrarRegistrosMysqli2($dbx, 'mreg_liquidaciondetalle_rues', 'idliquidacion=' . $_SESSION["tramite"]["numeroliquidacion"]);
        if ($result === false) {
            $_SESSION["generales"]["mensajeerror"] = 'Error borrando registros de mreg_liquidaciondetalle_rues';
            return false;
        }
        $exp1 = '';
        $nom1 = '';
        $i = 0;

        //
        if (!isset($_SESSION["tramite"]["rues_servicios"])) {
            $_SESSION["tramite"]["rues_servicios"] = array();
        }

        //
        foreach ($_SESSION["tramite"]["rues_servicios"] as $liq) {
            if (!isset($liq["codigo_servicio"])) {
                $liq["codigo_servicio"] = '';
            }
            if (!isset($liq["descripcion_servicio"])) {
                $liq["descripcion_servicio"] = '';
            }
            if (!isset($liq["orden_servicio"])) {
                $liq["orden_servicio"] = 0;
            }
            if (!isset($liq["orden_servicio_asociado"])) {
                $liq["orden_servicio_asociado"] = 0;
            }
            if (!isset($liq["nombre_base"])) {
                $liq["nombre_base"] = '';
            }
            if (!isset($liq["valor_base"])) {
                $liq["valor_base"] = 0;
            }
            if (!isset($liq["valor_liquidacion"])) {
                $liq["valor_liquidacion"] = 0;
            }
            if (!isset($liq["cantidad_servicio"])) {
                $liq["cantidad_servicio"] = 0;
            }
            if (!isset($liq["indicador_base"])) {
                $liq["indicador_base"] = '';
            }
            if (!isset($liq["indicador_renovacion"])) {
                $liq["indicador_renovacion"] = '';
            }
            if (!isset($liq["matricula_servicio"])) {
                $liq["matricula_servicio"] = '';
            }
            if (!isset($liq["nombre_matriculado"])) {
                $liq["nombre_matriculado"] = '';
            }
            if (!isset($liq["ano_renovacion"])) {
                $liq["ano_renovacion"] = '';
            }
            if (!isset($liq["valor_activos_sin_ajustes"])) {
                $liq["valor_activos_sin_ajustes"] = 0;
            }

            $i++;


            $arrCampos = array(
                'idliquidacion',
                'secuencia',
                'codigo_servicio',
                'descripcion_servicio',
                'orden_servicio',
                'orden_servicio_asociado',
                'nombre_base',
                'valor_base',
                'valor_liquidacion',
                'cantidad_servicio',
                'indicador_base',
                'indicador_renovacion',
                'matricula_servicio',
                'nombre_matriculado',
                'ano_renovacion',
                'valor_activos_sin_ajustes'
            );


            $arrValues = array(
                $_SESSION["tramite"]["numeroliquidacion"],
                $i,
                "'" . $liq["codigo_servicio"] . "'",
                "'" . $liq["descripcion_servicio"] . "'",
                "'" . $liq["orden_servicio"] . "'",
                "'" . $liq["orden_servicio_asociado"] . "'",
                "'" . addslashes($liq["nombre_base"]) . "'",
                "'" . $liq["valor_base"] . "'",
                "'" . $liq["valor_liquidacion"] . "'",
                "'" . $liq["cantidad_servicio"] . "'",
                "'" . $liq["indicador_base"] . "'",
                "'" . $liq["indicador_renovacion"] . "'",
                "'" . $liq["matricula_servicio"] . "'",
                "'" . addslashes($liq["nombre_matriculado"]) . "'",
                "'" . $liq["ano_renovacion"] . "'",
                "'" . $liq["valor_activos_sin_ajustes"] . "'"
            );


            $result = insertarRegistrosMysqli2($dbx, 'mreg_liquidaciondetalle_rues', $arrCampos, $arrValues);
            if ($result === false) {
                $_SESSION["generales"]["mensajeerror"] = 'Error insertando registros en mreg_liquidaciondetalle_rues (' . $_SESSION ["generales"] ["mensajeerror"] . ')';
                return false;
            }
        }

        //
        if (!isset($_SESSION["tramite"]["rues_textos"])) {
            $_SESSION["tramite"]["rues_textos"] = array();
        }

        //
        borrarRegistrosMysqli2($dbx, 'mreg_liquidacion_textos_rues', "idliquidacion=" . $_SESSION["tramite"]["numeroliquidacion"]);

        //
        $ix = 0;
        foreach ($_SESSION["tramite"]["rues_textos"] as $tx) {
            $ix++;

            //
            $arrCampos = array(
                'idliquidacion',
                'secuencia',
                'texto',
            );

            //
            $arrValues = array(
                $_SESSION["tramite"]["numeroliquidacion"],
                $ix,
                "'" . addslashes($tx) . "'"
            );

            //
            $result = insertarRegistrosMysqli2($dbx, 'mreg_liquidacion_textos_rues', $arrCampos, $arrValues);
            if ($result === false) {
                $_SESSION["generales"]["mensajeerror"] = 'Error insertando registros en mreg_liquidaciontextos_rues (' . $_SESSION ["generales"] ["mensajeerror"] . ')';
                return false;
            }
        }


        // Graba expedientes
        $result = borrarRegistrosMysqli2($dbx, 'mreg_liquidacionexpedientes', 'idliquidacion=' . $_SESSION["tramite"]["numeroliquidacion"]);
        if ($result === false) {
            $_SESSION["generales"]["mensajeerror"] = 'Error borrando registros de mreg_liquidacionexpedientes';
            return false;
        }

        if (!empty($_SESSION["tramite"]["expedientes"])) {
            $i = 0;
            foreach ($_SESSION["tramite"]["expedientes"] as $mat) {
                if (!isset($mat["cc"])) {
                    $mat["cc"] = '';
                }
                if (!isset($mat["matricula"])) {
                    $mat["matricula"] = '';
                }
                if (!isset($mat["proponente"])) {
                    $mat["proponente"] = '';
                }
                if (!isset($mat["numrue"])) {
                    $mat["numrue"] = '';
                }
                if (!isset($mat["idtipoidentificacion"])) {
                    $mat["idtipoidentificacion"] = '';
                }
                if (!isset($mat["identificacion"])) {
                    $mat["identificacion"] = '';
                }
                if (!isset($mat["razonsocial"])) {
                    $mat["razonsocial"] = '';
                }
                if (!isset($mat["ape1"])) {
                    $mat["ape1"] = '';
                }
                if (!isset($mat["ape2"])) {
                    $mat["ape2"] = '';
                }
                if (!isset($mat["nom1"])) {
                    $mat["nom1"] = '';
                }
                if (!isset($mat["nom2"])) {
                    $mat["nom2"] = '';
                }
                if (!isset($mat["organizacion"])) {
                    $mat["organizacion"] = '';
                }
                if (!isset($mat["categoria"])) {
                    $mat["caetgoria"] = '';
                }
                if (!isset($mat["afiliado"])) {
                    $mat["afiliado"] = '';
                }
                if (!isset($mat["propietariojurisdiccion"])) {
                    $mat["propietariojurisdiccion"] = '';
                }
                if (!isset($mat["primeranorenovado"])) {
                    $mat["primeranorenovado"] = '';
                }
                if (!isset($mat["ultimoanoafiliado"])) {
                    $mat["ultimoanoafiliado"] = '';
                }
                if (!isset($mat["ultimoanorenovado"])) {
                    $mat["ultimoanorenovado"] = '';
                }
                if (!isset($mat["ultimosactivos"])) {
                    $mat["ultimosactivos"] = 0;
                }
                if (!isset($mat["nuevosactivos"])) {
                    $mat["nuevosactivos"] = 0;
                }
                if (!isset($mat["actividad"])) {
                    $mat["actividad"] = '';
                }
                if (!isset($mat["registrobase"])) {
                    $mat["registrobase"] = '';
                }
                if (!isset($mat["benart7"])) {
                    $mat["benart7"] = '';
                }
                if (!isset($mat["benley1780"])) {
                    $mat["benley1780"] = '';
                }

                if (!isset($mat["renovaresteano"])) {
                    $mat["renovaresteano"] = '';
                }
                if (!isset($mat["fechanacimiento"])) {
                    $mat["fechanacimiento"] = '';
                }
                if (!isset($mat["fechamatricula"])) {
                    $mat["fechamatricula"] = '';
                }
                if (!isset($mat["fecmatant"])) {
                    $mat["fecmatant"] = '';
                }
                if (!isset($mat["reliquidacion"])) {
                    $mat["reliquidacion"] = '';
                }
                if ($mat["ultimosactivos"] == '') {
                    $mat["ultimosactivos"] = 0;
                }
                if ($mat["nuevosactivos"] == '') {
                    $mat["nuevosactivos"] = 0;
                }
                if (!isset($mat["controlpot"])) {
                    $mat["controlpot"] = '';
                }
                if (!isset($mat["dircom"])) {
                    $mat["dircom"] = '';
                }
                if (!isset($mat["muncom"])) {
                    $mat["muncom"] = '';
                }

                //
                $i++;
                $arrCampos = array(
                    'idliquidacion',
                    'secuencia',
                    'cc',
                    'matricula',
                    'proponente',
                    'numrue',
                    'idtipoidentificacion',
                    'identificacion',
                    'razonsocial',
                    'ape1',
                    'ape2',
                    'nom1',
                    'nom2',
                    'organizacion',
                    'categoria',
                    'afiliado',
                    'propietariojurisdiccion',
                    'ultimoanoafiliado',
                    'ultimoanorenovado',
                    'primeranorenovado',
                    'ultimosactivos',
                    'nuevosactivos',
                    'actividad',
                    'registrobase',
                    'benart7',
                    'benley1780',
                    'renovaresteano',
                    'fechanacimiento',
                    'fechamatricula',
                    'fecmatant',
                    'reliquidacion',
                    'controlpot',
                    'dircom',
                    'muncom'
                );
                if (!isset($mat["primeranorenovado"])) {
                    $mat["primeranorenovado"] = '';
                }
                if (!isset($mat["controlpot"])) {
                    $mat["controlpot"] = '';
                }
                $arrValues = array(
                    $_SESSION["tramite"]["numeroliquidacion"],
                    sprintf("%03s", $i),
                    "'" . $mat["cc"] . "'",
                    "'" . $mat["matricula"] . "'",
                    "'" . $mat["proponente"] . "'",
                    "'" . $mat["numrue"] . "'",
                    "'" . $mat["idtipoidentificacion"] . "'",
                    "'" . $mat["identificacion"] . "'",
                    "'" . addslashes(\sanarEntradas::sanarString($mat["razonsocial"])) . "'",
                    "'" . addslashes(\sanarEntradas::sanarString($mat["ape1"])) . "'",
                    "'" . addslashes(\sanarEntradas::sanarString($mat["ape2"])) . "'",
                    "'" . addslashes(\sanarEntradas::sanarString($mat["nom1"])) . "'",
                    "'" . addslashes(\sanarEntradas::sanarString($mat["nom2"])) . "'",
                    "'" . $mat["organizacion"] . "'",
                    "'" . $mat["categoria"] . "'",
                    "'" . $mat["afiliado"] . "'",
                    "'" . $mat["propietariojurisdiccion"] . "'",
                    "'" . $mat["ultimoanoafiliado"] . "'",
                    "'" . $mat["ultimoanorenovado"] . "'",
                    "'" . $mat["primeranorenovado"] . "'",
                    $mat["ultimosactivos"],
                    $mat["nuevosactivos"],
                    "'" . $mat["actividad"] . "'",
                    "'" . $mat["registrobase"] . "'",
                    "'" . $mat["benart7"] . "'",
                    "'" . $mat["benley1780"] . "'",
                    "'" . $mat["renovaresteano"] . "'",
                    "'" . $mat["fechanacimiento"] . "'",
                    "'" . $mat["fechamatricula"] . "'",
                    "'" . $mat["fecmatant"] . "'",
                    "'" . $mat["reliquidacion"] . "'",
                    "'" . $mat["controlpot"] . "'",
                    "'" . addslashes($mat["dircom"]) . "'",
                    "'" . $mat["muncom"] . "'"
                );
                $result = insertarRegistrosMysqli2($dbx, 'mreg_liquidacionexpedientes', $arrCampos, $arrValues);
                if ($result === false) {
                    $_SESSION["generales"]["mensajeerror"] = 'Error insertando registros de mreg_liquidacionexpedientes';
                    return false;
                }
            }
        }

        // Graba transacciones
        $result = borrarRegistrosMysqli2($dbx, 'mreg_liquidacion_transacciones', 'idliquidacion=' . $_SESSION["tramite"]["numeroliquidacion"]);
        if ($result === false) {
            $_SESSION["generales"]["mensajeerror"] = 'Error borrando registros de mreg_liquidaciondetalle';
            return false;
        }
        $exp1 = '';
        $nom1 = '';
        $i = 0;

        //
        $retornar = true;
        $mensajeRetornar = '';

        if (!empty($_SESSION["tramite"]["transacciones"])) {
            foreach ($_SESSION["tramite"]["transacciones"] as $tra) {
                if (!isset($tra["ultimoanorenovadoanterior"])) {
                    $tra["ultimoanorenovadoanterior"] = '';
                }

                //
                if (!isset($tra["benart7"])) {
                    $tra["benart7"] = '';
                }
                if (!isset($tra["benley1780"])) {
                    $tra["benley1780"] = '';
                }
                if (!isset($tra["fechanacimientopnat"])) {
                    $tra["fechanacimientopnat"] = '';
                }

                //
                if (!isset($tra["patrimonio"])) {
                    $tra["patrimonio"] = 0;
                }
                if (!isset($tra["capitalsocial"])) {
                    $tra["capitalsocial"] = 0;
                }
                if (!isset($tra["capitalautorizado"])) {
                    $tra["capitalautorizado"] = 0;
                }
                if (!isset($tra["capitalsuscrito"])) {
                    $tra["capitalsuscrito"] = 0;
                }
                if (!isset($tra["capitalpagado"])) {
                    $tra["capitalpagado"] = 0;
                }
                if (!isset($tra["aportedinero"])) {
                    $tra["aportedinero"] = 0;
                }
                if (!isset($tra["aporteactivos"])) {
                    $tra["aporteactivos"] = 0;
                }
                if (!isset($tra["aportelaboral"])) {
                    $tra["aportelaboral"] = 0;
                }
                if (!isset($tra["aportelaboraladicional"])) {
                    $tra["aportelaboraladicional"] = 0;
                }
                if (!isset($tra["capitalasignado"])) {
                    $tra["capitalasignado"] = 0;
                }
                if (!isset($tra["pornaltot"])) {
                    $tra["pornaltot"] = 0;
                }
                if (!isset($tra["pornalpub"])) {
                    $tra["pornalpub"] = 0;
                }
                if (!isset($tra["pornalpri"])) {
                    $tra["pornalpri"] = 0;
                }
                if (!isset($tra["porexttot"])) {
                    $tra["porexttot"] = 0;
                }
                if (!isset($tra["porextpub"])) {
                    $tra["porextpub"] = 0;
                }
                if (!isset($tra["porextpri"])) {
                    $tra["porextpri"] = 0;
                }

                if (!isset($tra["tipoidentificacionvendedor"])) {
                    $tra["tipoidentificacionvendedor"] = '';
                }
                if (!isset($tra["identificacionvendedor"])) {
                    $tra["identificacionvendedor"] = '';
                }
                if (!isset($tra["nombrevendedor"])) {
                    $tra["nombrevendedor"] = '';
                }
                if (!isset($tra["camaravendedor"])) {
                    $tra["camaravendedor"] = '';
                }
                if (!isset($tra["matriculavendedor"])) {
                    $tra["matriculavendedor"] = '';
                }
                if (!isset($tra["nombre1vendedor"])) {
                    $tra["nombre1vendedor"] = '';
                }
                if (!isset($tra["nombre2vendedor"])) {
                    $tra["nombre2vendedor"] = '';
                }
                if (!isset($tra["apellido1vendedor"])) {
                    $tra["apellido1vendedor"] = '';
                }
                if (!isset($tra["apellido2vendedor"])) {
                    $tra["apellido2vendedor"] = '';
                }
                if (!isset($tra["emailvendedor"])) {
                    $tra["emailvendedor"] = '';
                }
                if (!isset($tra["celularvendedor"])) {
                    $tra["celularvendedor"] = '';
                }
                if (!isset($tra["cancelarvendedor"])) {
                    $tra["cancelarvendedor"] = '';
                }

                if (!isset($tra["tipoidentificacioncomprador"])) {
                    $tra["tipoidentificacioncomprador"] = '';
                }
                if (!isset($tra["identificacioncomprador"])) {
                    $tra["identificacioncomprador"] = '';
                }
                if (!isset($tra["nombrecomprador"])) {
                    $tra["nombrecomprador"] = '';
                }
                if (!isset($tra["camaracomprador"])) {
                    $tra["camaracomprador"] = '';
                }
                if (!isset($tra["matriculacomprador"])) {
                    $tra["matriculacomprador"] = '';
                }
                if (!isset($tra["organizacioncomprador"])) {
                    $tra["organizacioncomprador"] = '';
                }
                if (!isset($tra["municipiocomprador"])) {
                    $tra["municipiocomprador"] = '';
                }
                if (!isset($tra["nombre1comprador"])) {
                    $tra["nombre1comprador"] = '';
                }
                if (!isset($tra["nombre2comprador"])) {
                    $tra["nombre2comprador"] = '';
                }
                if (!isset($tra["apellido1comprador"])) {
                    $tra["apellido1comprador"] = '';
                }
                if (!isset($tra["apellido2comprador"])) {
                    $tra["apellido2comprador"] = '';
                }
                if (!isset($tra["emailcomprador"])) {
                    $tra["emailcomprador"] = '';
                }
                if (!isset($tra["celularcomprador"])) {
                    $tra["celularcomprador"] = '';
                }
                if (!isset($tra["activoscomprador"])) {
                    $tra["activoscomprador"] = 0;
                }
                if (!isset($tra["personalcomprador"])) {
                    $tra["personalcomprador"] = 0;
                }

                if (!isset($tra["municipioanterior"])) {
                    $tra["municipioanterior"] = '';
                }
                if (!isset($tra["matriculaanterior"])) {
                    $tra["matriculaanterior"] = '';
                }
                if (!isset($tra["camaraanterior"])) {
                    $tra["camaraanterior"] = '';
                }
                if (!isset($tra["fecharenovacionanterior"])) {
                    $tra["fecharenovacionanterior"] = '';
                }
                if (!isset($tra["benart7anterior"])) {
                    $tra["benart7anterior"] = '';
                }
                if (!isset($tra["municipiodestino"])) {
                    $tra["municipiodestino"] = '';
                }
                if (!isset($tra["camaradestino"])) {
                    $tra["camaradestino"] = '';
                }
                if (!isset($tra["prerut"])) {
                    $tra["prerut"] = '';
                }
                if (!isset($tra["acreditapagoir"])) {
                    $tra["acreditapagoir"] = '';
                }
                if (!isset($tra["nroreciboacreditapagoir"])) {
                    $tra["nroreciboacreditapagoir"] = '';
                }
                if (!isset($tra["fechareciboacreditapagoir"])) {
                    $tra["fechareciboacreditapagoir"] = '';
                }
                if (!isset($tra["gobernacionreciboacreditapagoir"])) {
                    $tra["gobernacionreciboacreditapagoir"] = '';
                }
                if (!isset($tra["tipodisolucion"])) {
                    $tra["tipodisolucion"] = '';
                }
                if (!isset($tra["tipoliquidacion"])) {
                    $tra["tipoliquidacion"] = '';
                }
                if (!isset($tra["motivoliquidacion"])) {
                    $tra["motivoliquidacion"] = '';
                }
                if (!isset($tra["ciiu1"])) {
                    $tra["ciiu1"] = '';
                }
                if (!isset($tra["ciiu2"])) {
                    $tra["ciiu2"] = '';
                }
                if (!isset($tra["ciiu3"])) {
                    $tra["ciiu3"] = '';
                }
                if (!isset($tra["ciiu4"])) {
                    $tra["ciiu4"] = '';
                }
                if (!isset($tra["entidadvigilancia"])) {
                    $tra["entidadvigilancia"] = '';
                }
                if (!isset($tra["objetosocial"])) {
                    $tra["objetosocial"] = '';
                }
                if (!isset($tra["facultades"])) {
                    $tra["facultades"] = '';
                }
                if (!isset($tra["limitaciones"])) {
                    $tra["limitaciones"] = '';
                }
                if (!isset($tra["entidadvigilancia"])) {
                    $tra["entidadvigilancia"] = '';
                }
                if (!isset($tra["poderespecial"])) {
                    $tra["poderespecial"] = '';
                }

                if (!isset($tra["clase_libro"])) {
                    $tra["clase_libro"] = '';
                }
                if (!isset($tra["tipo_libro"])) {
                    $tra["tipo_libro"] = '';
                }
                if (!isset($tra["codigo_libro"])) {
                    $tra["codigo_libro"] = '';
                }
                if (!isset($tra["nombre_libro"])) {
                    $tra["nombre_libro"] = '';
                }
                if (!isset($tra["email_libro"])) {
                    $tra["email_libro"] = '';
                }
                if (!isset($tra["emailconfirmacion_libro"])) {
                    $tra["emailconfirmacion_libro"] = '';
                }
                if (!isset($tra["paginainicial_libro"]) || ltrim($tra["paginainicial_libro"], "0") == '') {
                    $tra["paginainicial_libro"] = 0;
                }
                if (!isset($tra["paginafinal_libro"]) || ltrim($tra["paginafinal_libro"], "0") == '') {
                    $tra["paginafinal_libro"] = 0;
                }
                if (!isset($tra["incluirrotulado_libro"])) {
                    $tra["incluirrotulado_libro"] = '';
                }

                if (!isset($tra["actanro_libro"])) {
                    $tra["actanro_libro"] = '';
                }
                if (!isset($tra["fechaacta_libro"])) {
                    $tra["fechaacta_libro"] = '';
                }
                if (!isset($tra["horaacta_libro"])) {
                    $tra["horaacta_libro"] = '';
                }
                if (!isset($tra["fechaini_libroelectronico"])) {
                    $tra["fechaini_libroelectronico"] = '';
                }
                if (!isset($tra["fechafin_libroelectronico"])) {
                    $tra["fechafin_libroelectronico"] = '';
                }
                if (!isset($tra["fechainiinscripciones_libroelectronico"])) {
                    $tra["fechainiinscripciones_libroelectronico"] = '';
                }
                if (!isset($tra["fechafininscripciones_libroelectronico"])) {
                    $tra["fechafininscripciones_libroelectronico"] = '';
                }

                //
                if (!isset($tra["libeleanot_libro"])) {
                    $tra["libeleanot_libro"] = '';
                }
                if (!isset($tra["libeleanot_registro"])) {
                    $tra["libeleanot_registro"] = '';
                }
                if (!isset($tra["libeleanot_dupli"])) {
                    $tra["libeleanot_dupli"] = '';
                }

                if (!isset($tra["libeleanot_nroacta"])) {
                    $tra["libeleanot_nroacta"] = '';
                }
                if (!isset($tra["libeleanot_fechaacta"])) {
                    $tra["libeleanot_fechaacta"] = '';
                }
                if (!isset($tra["libeleanot_nropaginas"])) {
                    $tra["libeleanot_nropaginas"] = 0;
                }
                if (!isset($tra["libeleanot_fechainiinscripciones"])) {
                    $tra["libeleanot_fechainiinscripciones"] = '';
                }
                if (!isset($tra["libeleanot_fechafininscripciones"])) {
                    $tra["libeleanot_fechafininscripciones"] = '';
                }
                if (!isset($tra["libeleanot_nroregistros"])) {
                    $tra["libeleanot_nroregistros"] = 0;
                }


                //
                if (!isset($tra["embargo"])) {
                    $tra["embargo"] = '';
                }
                if (!isset($tra["tipoideembargante"])) {
                    $tra["tipoideembargante"] = '';
                }
                if (!isset($tra["ideembargante"])) {
                    $tra["ideembargante"] = '';
                }
                if (!isset($tra["nom1embargante"])) {
                    $tra["nom1embargante"] = '';
                }
                if (!isset($tra["nom2embargante"])) {
                    $tra["nom2embargante"] = '';
                }
                if (!isset($tra["ape1embargante"])) {
                    $tra["ape1embargante"] = '';
                }
                if (!isset($tra["ape2embargante"])) {
                    $tra["ape2embargante"] = '';
                }

                //
                if (!isset($tra["desembargo"])) {
                    $tra["desembargo"] = '';
                }
                if (!isset($tra["librocruce"])) {
                    $tra["librocruce"] = '';
                }
                if (!isset($tra["inscripcioncruce"])) {
                    $tra["inscripcioncruce"] = '';
                }

                if (!isset($tra["cantidad"])) {
                    $tra["cantidad"] = 1;
                }

                if (!isset($tra["cantidadadicional"])) {
                    $tra["cantidadadicional"] = 0;
                }

                $i++;
                $arrCampos = array(
                    'idliquidacion',
                    'idsecuencia',
                    'idtransaccion',
                    'matriculaafectada',
                    'tipodoc',
                    'numdoc',
                    'fechadoc',
                    'origendoc',
                    'mundoc',
                    'camaravendedor',
                    'matriculavendedor',
                    'tipoidentificacionvendedor',
                    'identificacionvendedor',
                    'nombrevendedor',
                    'nombre1vendedor',
                    'nombre2vendedor',
                    'apellido1vendedor',
                    'apellido2vendedor',
                    'emailvendedor',
                    'celularvendedor',
                    'cancelarvendedor',
                    'camaracomprador',
                    'matriculacomprador',
                    'organizacioncomprador',
                    'municipiocomprador',
                    'tipoidentificacioncomprador',
                    'identificacioncomprador',
                    'nombrecomprador',
                    'nombre1comprador',
                    'nombre2comprador',
                    'apellido1comprador',
                    'apellido2comprador',
                    'emailcomprador',
                    'celularcomprador',
                    'activoscomprador',
                    'personalcomprador',
                    'municipioanterior',
                    'matriculaanterior',
                    'camaraanterior',
                    'fechamatriculaanterior',
                    'fecharenovacionanterior',
                    'ultimoanorenovadoanterior',
                    'benart7anterior',
                    'municipiodestino',
                    'camaradestino',
                    'organizacion',
                    'categoria',
                    'razonsocial',
                    'sigla',
                    'tipoidentificacion',
                    'identificacion',
                    'nit',
                    'prerut',
                    'ape1',
                    'ape2',
                    'nom1',
                    'nom2',
                    'cargo',
                    'idvinculo',
                    'idrenglon',
                    'aceptacion',
                    'identificacionrepresentada',
                    'razonsocialrepresentada',
                    'pornaltot',
                    'pornalpub',
                    'pornalpri',
                    'porexttot',
                    'porextpub',
                    'porextpri',
                    'personal',
                    'activos',
                    'costotransaccion',
                    'patrimonio',
                    'benart7',
                    'benley1780',
                    'fechanacimientopnat',
                    'capitalsocial',
                    'capitalautorizado',
                    'capitalsuscrito',
                    'capitalpagado',
                    'aporteactivos',
                    'aportedinero',
                    'aportelaboral',
                    'aportelaboraladicional',
                    'capitalasignado',
                    'acreditapagoir',
                    'nroreciboacreditapagoir',
                    'fechareciboacreditapagoir',
                    'gobernacionacreditapagoir',
                    'dircom',
                    'municipio',
                    'fechaduracion',
                    'tipodisolucion',
                    'motivodisolucion',
                    'tipoliquidacion',
                    'motivoliquidacion',
                    'ciiu1',
                    'ciiu2',
                    'ciiu3',
                    'ciiu4',
                    'clase_libro',
                    'tipo_libro',
                    'codigo_libro',
                    'nombre_libro',
                    'email_libro',
                    'emailconfirmacion_libro',
                    'paginainicial_libro',
                    'paginafinal_libro',
                    'incluirrotulado_libro',
                    'libeleanot_libro',
                    'libeleanot_registro',
                    'libeleanot_dupli',
                    'libeleanot_nroacta',
                    'libeleanot_fechaacta',
                    'libeleanot_nropaginas',
                    'libeleanot_fechainiinscripciones',
                    'libeleanot_fechafininscripciones',
                    'libeleanot_nroregistros',
                    'actanro_libro',
                    'fechaacta_libro',
                    'horaacta_libro',
                    'fechaini_libroelectronico',
                    'fechafin_libroelectronico',
                    'fechainiinscripciones_libroelectronico',
                    'fechafininscripciones_libroelectronico',
                    'embargo',
                    'tipoideembargante',
                    'ideembargante',
                    'nom1embargante',
                    'nom2embargante',
                    'ape1embargante',
                    'ape2embargante',
                    'desembargo',
                    'librocruce',
                    'inscripcioncruce',
                    'entidadvigilancia',
                    'objetosocial',
                    'facultades',
                    'limitaciones',
                    'poderespecial',
                    'texto',
                    'cantidad'
                );

                if (doubleval($tra["activos"]) == 0) {
                    $tra["activos"] = 0;
                }
                if (doubleval($tra["personal"]) == 0) {
                    $tra["personal"] = 0;
                }
                if (doubleval($tra["costotransaccion"]) == 0) {
                    $tra["costotransaccion"] = 0;
                }
                if (doubleval($tra["patrimonio"]) == 0) {
                    $tra["patrimonio"] = 0;
                }
                if (doubleval($tra["capitalsocial"]) == 0) {
                    $tra["capitalsocial"] = 0;
                }
                if (doubleval($tra["capitalautorizado"]) == 0) {
                    $tra["capitalautorizado"] = 0;
                }
                if (doubleval($tra["capitalsuscrito"]) == 0) {
                    $tra["capitalsuscrito"] = 0;
                }
                if (doubleval($tra["capitalpagado"]) == 0) {
                    $tra["capitalpagado"] = 0;
                }
                if (doubleval($tra["aportedinero"]) == 0) {
                    $tra["aportedinero"] = 0;
                }
                if (doubleval($tra["aporteactivos"]) == 0) {
                    $tra["aporteactivos"] = 0;
                }
                if (doubleval($tra["aportelaboral"]) == 0) {
                    $tra["aportelaboral"] = 0;
                }
                if (doubleval($tra["aportelaboraladicional"]) == 0) {
                    $tra["aportelaboraladicional"] = 0;
                }
                if (doubleval($tra["capitalasignado"]) == 0) {
                    $tra["capitalasignado"] = 0;
                }
                if (doubleval($tra["pornaltot"]) == 0) {
                    $tra["pornaltot"] = 0;
                }
                if (doubleval($tra["pornalpub"]) == 0) {
                    $tra["pornalpub"] = 0;
                }
                if (doubleval($tra["pornalpri"]) == 0) {
                    $tra["pornalpri"] = 0;
                }
                if (doubleval($tra["porexttot"]) == 0) {
                    $tra["porexttot"] = 0;
                }
                if (doubleval($tra["porextpub"]) == 0) {
                    $tra["porextpub"] = 0;
                }
                if (doubleval($tra["porextpri"]) == 0) {
                    $tra["porextpri"] = 0;
                }
                if (!isset($tra["nit"])) {
                    $tra["nit"] = '';
                }

                $arrValores = array(
                    $_SESSION["tramite"]["numeroliquidacion"],
                    "'" . sprintf("%03s", $i) . "'",
                    "'" . $tra['idtransaccion'] . "'",
                    "'" . $tra['matriculaafectada'] . "'",
                    "'" . $tra['tipodoc'] . "'",
                    "'" . $tra['numdoc'] . "'",
                    "'" . $tra['fechadoc'] . "'",
                    "'" . $tra['origendoc'] . "'",
                    "'" . $tra['mundoc'] . "'",
                    "'" . $tra['camaravendedor'] . "'",
                    "'" . $tra['matriculavendedor'] . "'",
                    "'" . $tra['tipoidentificacionvendedor'] . "'",
                    "'" . $tra['identificacionvendedor'] . "'",
                    "'" . addslashes(($tra['nombrevendedor'])) . "'",
                    "'" . addslashes(($tra['nombre1vendedor'])) . "'",
                    "'" . addslashes(($tra['nombre2vendedor'])) . "'",
                    "'" . addslashes(($tra['apellido1vendedor'])) . "'",
                    "'" . addslashes(($tra['apellido2vendedor'])) . "'",
                    "'" . addslashes($tra['emailvendedor']) . "'",
                    "'" . addslashes($tra['celularvendedor']) . "'",
                    "'" . addslashes($tra['cancelarvendedor']) . "'",
                    "'" . $tra['camaracomprador'] . "'",
                    "'" . $tra['matriculacomprador'] . "'",
                    "'" . $tra['organizacioncomprador'] . "'",
                    "'" . $tra['municipiocomprador'] . "'",
                    "'" . $tra['tipoidentificacioncomprador'] . "'",
                    "'" . $tra['identificacioncomprador'] . "'",
                    "'" . addslashes(($tra['nombrecomprador'])) . "'",
                    "'" . addslashes(($tra['nombre1comprador'])) . "'",
                    "'" . addslashes(($tra['nombre2comprador'])) . "'",
                    "'" . addslashes(($tra['apellido1comprador'])) . "'",
                    "'" . addslashes(($tra['apellido2comprador'])) . "'",
                    "'" . addslashes($tra['emailcomprador']) . "'",
                    "'" . addslashes($tra['celularcomprador']) . "'",
                    $tra['activoscomprador'],
                    $tra['personalcomprador'],
                    "'" . $tra['municipioanterior'] . "'",
                    "'" . $tra['matriculaanterior'] . "'",
                    "'" . $tra['camaraanterior'] . "'",
                    "'" . $tra['fechamatriculaanterior'] . "'",
                    "'" . $tra['fecharenovacionanterior'] . "'",
                    "'" . $tra['ultimoanorenovadoanterior'] . "'",
                    "'" . $tra['benart7anterior'] . "'",
                    "'" . $tra['municipiodestino'] . "'",
                    "'" . $tra['camaradestino'] . "'",
                    "'" . $tra['organizacion'] . "'",
                    "'" . $tra['categoria'] . "'",
                    "'" . addslashes(($tra['razonsocial'])) . "'",
                    "'" . addslashes(($tra['sigla'])) . "'",
                    "'" . $tra['tipoidentificacion'] . "'",
                    "'" . $tra['identificacion'] . "'",
                    "'" . $tra['nit'] . "'",
                    "'" . $tra['prerut'] . "'",
                    "'" . addslashes(($tra['ape1'])) . "'",
                    "'" . addslashes(($tra['ape2'])) . "'",
                    "'" . addslashes(($tra['nom1'])) . "'",
                    "'" . addslashes(($tra['nom2'])) . "'",
                    "'" . addslashes(($tra['cargo'])) . "'",
                    "'" . $tra['idvinculo'] . "'",
                    "'" . $tra['idrenglon'] . "'",
                    "'" . $tra['aceptacion'] . "'",
                    "'" . $tra['identificacionrepresentada'] . "'",
                    "'" . addslashes(($tra['razonsocialrepresentada'])) . "'",
                    $tra['pornaltot'],
                    $tra['pornalpub'],
                    $tra['pornalpri'],
                    $tra['porexttot'],
                    $tra['porextpub'],
                    $tra['porextpri'],
                    $tra['personal'],
                    $tra['activos'],
                    $tra['costotransaccion'],
                    $tra['patrimonio'],
                    "'" . addslashes($tra['benart7']) . "'",
                    "'" . addslashes($tra['benley1780']) . "'",
                    "'" . addslashes($tra['fechanacimientopnat']) . "'",
                    $tra['capitalsocial'],
                    $tra['capitalautorizado'],
                    $tra['capitalsuscrito'],
                    $tra['capitalpagado'],
                    $tra['aporteactivos'],
                    $tra['aportedinero'],
                    $tra['aportelaboral'],
                    $tra['aportelaboraladicional'],
                    $tra['capitalasignado'],
                    "'" . $tra['acreditapagoir'] . "'",
                    "'" . $tra['nroreciboacreditapagoir'] . "'",
                    "'" . $tra['fechareciboacreditapagoir'] . "'",
                    "'" . $tra['gobernacionacreditapagoir'] . "'",
                    "'" . addslashes($tra['dircom']) . "'",
                    "'" . $tra['municipio'] . "'",
                    "'" . $tra['fechaduracion'] . "'",
                    "'" . $tra['tipodisolucion'] . "'",
                    "'" . addslashes($tra['motivodisolucion']) . "'",
                    "'" . $tra['tipoliquidacion'] . "'",
                    "'" . addslashes($tra['motivoliquidacion']) . "'",
                    "'" . $tra['ciiu1'] . "'",
                    "'" . $tra['ciiu2'] . "'",
                    "'" . $tra['ciiu3'] . "'",
                    "'" . $tra['ciiu4'] . "'",
                    "'" . $tra['clase_libro'] . "'",
                    "'" . $tra['tipo_libro'] . "'",
                    "'" . $tra['codigo_libro'] . "'",
                    "'" . addslashes($tra['nombre_libro']) . "'",
                    "'" . addslashes($tra['email_libro']) . "'",
                    "'" . addslashes($tra['emailconfirmacion_libro']) . "'",
                    $tra['paginainicial_libro'],
                    $tra['paginafinal_libro'],
                    "'" . $tra['incluirrotulado_libro'] . "'",
                    "'" . $tra['libeleanot_libro'] . "'",
                    "'" . $tra['libeleanot_registro'] . "'",
                    "'" . $tra['libeleanot_dupli'] . "'",
                    "'" . $tra['libeleanot_nroacta'] . "'",
                    "'" . $tra['libeleanot_fechaacta'] . "'",
                    intval($tra['libeleanot_nropaginas']),
                    "'" . $tra['libeleanot_fechainiinscripciones'] . "'",
                    "'" . $tra['libeleanot_fechafininscripciones'] . "'",
                    intval($tra['libeleanot_nroregistros']),
                    "'" . $tra['actanro_libro'] . "'",
                    "'" . $tra['fechaacta_libro'] . "'",
                    "'" . $tra['horaacta_libro'] . "'",
                    "'" . $tra['fechaini_libroelectronico'] . "'",
                    "'" . $tra['fechafin_libroelectronico'] . "'",
                    "'" . $tra['fechainiinscripciones_libroelectronico'] . "'",
                    "'" . $tra['fechafininscripciones_libroelectronico'] . "'",
                    "'" . addslashes($tra['embargo']) . "'",
                    "'" . $tra['tipoideembargante'] . "'",
                    "'" . $tra['ideembargante'] . "'",
                    "'" . addslashes($tra['nom1embargante']) . "'",
                    "'" . addslashes($tra['nom2embargante']) . "'",
                    "'" . addslashes($tra['ape1embargante']) . "'",
                    "'" . addslashes($tra['ape2embargante']) . "'",
                    "'" . addslashes($tra['desembargo']) . "'",
                    "'" . $tra['librocruce'] . "'",
                    "'" . $tra['inscripcioncruce'] . "'",
                    "'" . addslashes($tra['entidadvigilancia']) . "'",
                    "'" . addslashes($tra['objetosocial']) . "'",
                    "'" . addslashes($tra['facultades']) . "'",
                    "'" . addslashes($tra['limitaciones']) . "'",
                    "'" . addslashes($tra['poderespecial']) . "'",
                    "'" . addslashes($tra['texto']) . "'",
                    intval($tra["cantidad"])
                );

                $res = insertarRegistrosMysqli2($dbx, 'mreg_liquidacion_transacciones', $arrCampos, $arrValores);
                if ($res === false) {
                    $retornar = false;
                    $mensajeRetornar = $_SESSION["generales"]["mensajeerror"];
                }
            }
        }

        $_SESSION["generales"]["mensajeerror"] = $mensajeRetornar;
        return $retornar;
    }

    public static function grabarPathAnexoRadicacion($dbx, $idanexo = '', $path = '') {
        $arrCampos = array(
            'path'
        );
        $arrValores = array(
            "'" . $path . "'"
        );
        $condicion = "idanexo = " . $idanexo;
        regrabarRegistrosMysqli2($dbx, 'mreg_radicacionesanexos', $arrCampos, $arrValores, $condicion);
    }

    public static function generarEmailNotificacionInscripcionSiprefSii($mysqli, $t) {
        $tiporeg = '';
        switch (substr($t["libro"], 0, 2)) {
            case "RM" :
            case "ME" :
                $tiporeg = 'REGISTRO PUBLICO MERCANTIL';
                if (substr($t["libro"], 2, 2) == '22') {
                    $tiporeg = 'REGISTRO DE COMERCIANTES QUE EJERCEN LA ACTIVIDAD DE APUESTAS Y JUEGOS DE AZAR';
                }
                break;
            case "RE" :
            case "ES" :
                $tiporeg = 'REGISTRO DE ENTIDADES SIN ANIMO DE LUCRO';
                if (substr($t["libro"], 2, 2) == '53') {
                    $tiporeg = 'REGISTRO DE LA ECONOMIA SOLIDARIA';
                }
                if (substr($t["libro"], 2, 2) == '54') {
                    $tiporeg = 'REGISTRO DE VEEDURIAS';
                }
                if (substr($t["libro"], 2, 2) == '55') {
                    $tiporeg = 'REGISTRO DE ENTIDADES SIN ANIMO DE LUCRO DE CAPITAL PRIVADO EXTRANJERO';
                }
                break;
        }

        //
        $msg = '';
        $msg .= 'LA ' . RAZONSOCIAL . ' le informa que el dia ' . mostrarFechaSii2($t["fecharegistro"]) . ' a las ' . mostrarHoraSii2($t["horaregistro"]) . ' ';
        $msg .= 'fue inscrito en el ' . $tiporeg . ', en el libro ' . substr($t["libro"], 2, 2) . ' bajo el numero ' . $t["registro"] . ' la siguiente actuacion: <br><br>';

        if (trim($t["recibo"]) != '') {
            $msg .= 'Recibo de Caja No. ' . $t["recibo"] . '<br>';
        }
        if (trim($t["numerooperacion"]) != '') {
            $msg .= 'Numero Operacion: ' . $t["numerooperacion"] . '<br>';
        }
        if (ltrim($t["matricula"], "0") != '') {
            $msg .= 'Matricula: ' . $t["matricula"] . '<br>';
        }
        if (ltrim($t["identificacion"], "0") != '') {
            $msg .= 'Identificacion: ' . $t["identificacion"] . '<br>';
        }
        $msg .= 'Nombre: ' . \funcionesGenerales::utf8_decode($t["nombre"]) . '<br>';

        //
        $txtx = '';
        if (substr($t["libro"], 0, 2) == 'RM' || substr($t["libro"], 0, 2) == 'ME') {
            $txtx = 'Acto: ' . retornarRegistroMysqli2($mysqli, 'mreg_actos', "idlibro='" . $t["libro"] . "' and idacto='" . $t["acto"] . "'", "nombre");
        }
        if (substr($t["libro"], 0, 2) == 'RE' || substr($t["libro"], 0, 2) == 'ES') {
            $txtx = 'Acto: ' . retornarRegistroMysqli2($mysqli, 'mreg_actos', "idlibro='" . $t["libro"] . "' and idacto='" . $t["acto"] . "'", "nombre");
        }

        //
        $msg .= $txtx . '<br>';

        //
        $msg .= 'En el siguiente enlace podra encontrar el detalle de la inscripcion realizada: ';
        $msg .= '<a href="' . TIPO_HTTP . HTTP_HOST . '/librerias/proceso/mregConsultaNoticiaMercantil.php?accion=vernoticia&_empresa=' . $_SESSION["generales"]["codigoempresa"] . '&libro=' . $t["libro"] . '&inscripcion=' . $t["registro"] . '&dupli=' . $t["dupli"] . '">Ver inscripcion</a>';
        $msg .= '<br><br>';
        $msg .= 'Antes de proceder con la solicitud del certificado en la C&aacute;mara de Comercio le recomendamos validar en el siguiente enlace que ';
        $msg .= 'el radicado haya terminado su proceso de digitaci&oacute;n y control de calidad. ';
        $msg .= '<a href="' . TIPO_HTTP . HTTP_HOST . '/librerias/proceso/mregConsultaRutaDocumentos.php?accion=traerruta&_empresa=' . $_SESSION["generales"]["codigoempresa"] . '&_recibo=' . $t["recibo"] . '">Verificar</a>';
        $msg .= '<br><br>';
        //
        if (!defined('NOTIFICAR_TELEFONO')) {
            define('NOTIFICAR_TELEFONO', 'NO');
        }
        if (NOTIFICAR_TELEFONO == 'SI') {
            $msg .= 'Para mayores informes por favor comunicarse al numero ';
            $msg .= TELEFONO_ATENCION_USUARIOS . ' en la ciudad de ' . retornarRegistroMysqli2($mysqli, "bas_municipios", "codigomunicipio='" . MUNICIPIO . "'", "ciudad") . '.<br><br>';
        }
        $msg .= 'Este mensaje se envia en forma automatica por el Sistema de Registro de LA ' . RAZONSOCIAL . ' y tiene por objeto informar, ';
        $msg .= 'en cumplimiento a lo contemplado en el Codigo de Procedimiento Administrativo y de lo Contencioso Administrativo.';
        $msg .= '<br><br>';
        $msg .= 'Correo desatendido: Por favor no responda a la direccion de correo electronico que envia este mensaje, dicha cuenta ';
        $msg .= 'no es revisada por ningun funcionario de nuestra entidad. Este mensaje es informativo.';
        $msg .= '<br><br>';
        $msg .= 'Los acentos y tildes de este correo han sido omitidos intencionalmente con el objeto de evitar inconvenientes en la lectura del mismo.';
        return $msg;
    }

    public static function generarFormularioRenovacionRepositorio($dbx, $mat = '') {
        //
        $iForm = 0;
        $iEstab = 0;
        $iPpal = 0;

        //
        $_SESSION["formulario"]["datos"] = array();
        $_SESSION["formulario"]["datoshijos"] = array();
        $_SESSION["formulario"]["matriculashijos"] = array();
        $_SESSION["formulario"]["tipotramite"] = $_SESSION["tramite"]["tipotramite"];

        //
        $datPrincipal = array();
        $textoFirmadoDatPrincipal = '';
        $tramasha1DatPrincipal = '';

        $arrForms = retornarRegistrosMysqli2($dbx, 'mreg_liquidaciondatos', "idliquidacion=" . $_SESSION["tramite"]["numeroliquidacion"], "id", "xml");
        // $arrForms = retornarLiquidacionDatosExpedienteArregloXml($_SESSION["tramite"]["numeroliquidacion"]);
        if (!empty($arrForms)) {
            foreach ($arrForms as $form) {

                $x = \funcionesSii2::desserializarExpedienteMatricula($dbx, $form);

                // 2018-10-17: JINT: Para generarf formato de renovación de afiliacion
                if (defined('TIPO_DOC_FOR_AFILIACION') && TIPO_DOC_FOR_AFILIACION != '') {
                    if ($_SESSION["tramite"]["tipotramite"] == 'renovacionmatricula') {
                        if ($x["organizacion"] == '01' || $x["organizacion"] > '02') {
                            if ($x["afiliado"] == '1') {
                                $datPrincipal = $x;
                            }
                        }
                    }
                }

                if (
                        $x["organizacion"] == '01' ||
                        ($x["organizacion"] > '02' && $x["categoria"] == '1')
                ) {
                    $_SESSION["formulario"]["datos"] = $x;
                    $_SESSION["formulario"]["datos"]["fechaultimamodificacion"] = $_SESSION["tramite"]["fechaultimamodificacion"];
                    $iPpal++;
                } else {
                    $iEstab++;
                    $_SESSION["formulario"]["datoshijos"][$iEstab] = $x;
                    $_SESSION["formulario"]["datoshijos"][$iEstab]["fechaultimamodificacion"] = $_SESSION["tramite"]["fechaultimamodificacion"];
                }
                $iForm++;
            }


            if ($iForm > 0) {

                if ($iPpal > 0) {

                    $det = '';

                    if ($_SESSION["tramite"]["tipotramite"] == 'renovacionmatricula' ||
                            $_SESSION["tramite"]["tipotramite"] == 'renovacionesadl'
                    ) {
                        $det = 'FORMULARIO DE RENOVACION - MATRICULA NO. ' . ltrim($_SESSION["formulario"]["datos"]["matricula"], "0");
                    }

                    if ($_SESSION["tramite"]["tipotramite"] == 'matriculapnat' ||
                            $_SESSION["tramite"]["tipotramite"] == 'matriculaest' ||
                            $_SESSION["tramite"]["tipotramite"] == 'matriculapjur'
                    ) {
                        $det = 'FORMULARIO DE MATRICULA - MATRICULA NO. ' . ltrim($_SESSION["formulario"]["datos"]["matricula"], "0");
                    }

                    if ($_SESSION["tramite"]["tipotramite"] == 'matriculaesadl'
                    ) {
                        $det = 'FORMULARIO DE INSCRIPCION AL REG-ESADL - NO. ' . ltrim($_SESSION["formulario"]["datos"]["matricula"], "0");
                    }
                    $name = armarPdfPrincipalNuevo1082Sii($dbx, $_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"], '');


                    if (count($_SESSION["formulario"]["datos"]["f"]) > 1) {
                        if (ACTIVAR_CIRCULAR_002_2016 == 'SI1') {
                            $name1 = armarPdfPrincipalNuevoAnosAnteriores1510Sii($dbx, $_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"], '');
                        } else {
                            $name1 = armarPdfPrincipalNuevoAnosAnteriores1082Sii($dbx, $_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"], '');
                        }
                        unirPdfs(array('../../../tmp/' . $name, '../../../tmp/' . $name1), '../../tmp/' . $name);
                    }

                    //
                    $bandeja = '';
                    if (substr(ltrim($_SESSION["formulario"]["datos"]["matricula"], "0"), 0, 1) == 'S') {
                        $bandeja = '5.-REGESADL';
                    } else {
                        $bandeja = '4.-REGMER';
                    }

                    //
                    $id = \funcionesSii2::grabarAnexoRadicacion(
                                    $dbx, ltrim($_SESSION["tramite"]["numeroradicacion"], "0"), // Codigo barras
                                    trim($_SESSION["tramite"]["numerorecibo"]), // Recibo
                                    trim($_SESSION["tramite"]["numerooperacion"]), // Operacion
                                    ltrim($_SESSION["tramite"]["identificacioncliente"], "0"), // Identificacion
                                    trim($_SESSION["tramite"]["nombrecliente"]), // Nombre
                                    '', // Acreedor
                                    '', // Nombre acreedor
                                    ltrim($_SESSION["formulario"]["datos"]["matricula"], "0"), // N&uacute;mero de matr&iacute;cula
                                    '', // N&uacute;mero de proponente
                                    TIPO_DOC_FOR_MERCANTIL, // Tipo de documento
                                    '', // N&uacute;mero del documento
                                    $_SESSION["tramite"]["fecharecibo"], '', // C&oacute;digo de origen
                                    'EL COMERCIANTE', '', // Clasificaci&oacute;n
                                    '', // N&uacute;mero del contrato
                                    '', // Idfuente
                                    1, // versi&oacute;n
                                    '', // Path
                                    '1', // Estado
                                    date("Ymd"), // fecha de escaneo o generaci&oacute;n
                                    $_SESSION["generales"]["codigousuario"], '', // Caja
                                    '', // Libro
                                    $det, '', // Libro del registro
                                    '', // N&uacute;mero del registro
                                    $bandeja, // Bandeja de registro
                                    'S', // Soporte del recibo
                                    '', // identificador
                                    '503' // Tipo anexo
                    );

                    $dirx = date("Ymd");
                    $path = PATH_ABSOLUTO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/mreg/' . $dirx;
                    if (!is_dir($path) || !is_readable($path)) {
                        mkdir($path, 0777);
                        \funcionesSii2::crearIndex($path);
                    }

                    $pathsalida = 'mreg/' . $dirx . '/' . $id . '.pdf';
                    copy('../../../tmp/' . $name, '../../../' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/' . $pathsalida);
                    unlink('../../tmp/' . $name);
                    \funcionesSii2::grabarPathAnexoRadicacion($dbx, $id, $pathsalida);
                }

                if ($iEstab > 0) {

                    foreach ($_SESSION["formulario"]["datoshijos"] as $hijo) {

                        $_SESSION["formulario"]["datos"] = $hijo;
                        $det = '';

                        if ($_SESSION["tramite"]["tipotramite"] == 'renovacionmatricula' ||
                                $_SESSION["tramite"]["tipotramite"] == 'renovacionesadl'
                        ) {
                            $det = 'FORMULARIO DE RENOVACION - MATRICULA NO. ' . ltrim($_SESSION["formulario"]["datos"]["matricula"], "0");
                        }

                        if ($_SESSION["tramite"]["tipotramite"] == 'matriculapnat' ||
                                $_SESSION["tramite"]["tipotramite"] == 'matriculaest' ||
                                $_SESSION["tramite"]["tipotramite"] == 'matriculapjur' ||
                                $_SESSION["tramite"]["tipotramite"] == 'matriculaesadl'
                        ) {
                            $det = 'FORMULARIO DE MATRICULA - MATRICULA NO. ' . ltrim($_SESSION["formulario"]["datos"]["matricula"], "0");
                        }

                        /*
                          if (FECHA_INICIAL_DECRETO1510 <= date("Ymd")) {
                          $name = armarPdfEstablecimientoNuevo1510($_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"], '');
                          } else {
                          $name = armarPdfEstablecimientoNuevo($_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"], '');
                          }
                         */
                        if (ACTIVAR_CIRCULAR_002_2016 == 'SI1') {
                            $name = armarPdfEstablecimientoNuevo1510Sii($dbx, $_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"], '');
                        } else {
                            $name = armarPdfEstablecimientoNuevo1082Sii($dbx, $_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"], '');
                        }

                        if (count($_SESSION["formulario"]["datos"]["f"]) > 1) {

                            /*
                              if (FECHA_INICIAL_DECRETO1510 <= date("Ymd")) {
                              $name1 = armarPdfEstablecimientoNuevoAnosAnteriores1510($_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"], '');
                              } else {
                              $name1 = armarPdfEstablecimientoNuevoAnosAnteriores($_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"], '');
                              }
                             */
                            if (ACTIVAR_CIRCULAR_002_2016 == 'SI1') {
                                $name1 = armarPdfEstablecimientoNuevoAnosAnteriores1510Sii($dbx, $_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"], '');
                            } else {
                                $name1 = armarPdfEstablecimientoNuevoAnosAnteriores1082Sii($dbx, $_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"], '');
                            }



                            unirPdfs(array('../../../tmp/' . $name, '../../../tmp/' . $name1), '../../tmp/' . $name);
                        }


                        //
                        $bandeja = '';
                        if (substr(ltrim($_SESSION["formulario"]["datos"]["matricula"], "0"), 0, 1) == 'S') {
                            $bandeja = '5.-REGESADL';
                        } else {
                            $bandeja = '4.-REGMER';
                        }

                        $id = \funcionesSii2::grabarAnexoRadicacion(
                                        $dbx, ltrim($_SESSION["tramite"]["numeroradicacion"], "0"), trim($_SESSION["tramite"]["numerorecibo"]), trim($_SESSION["tramite"]["numerooperacion"]), ltrim($_SESSION["tramite"]["identificacioncliente"], "0"), trim($_SESSION["tramite"]["nombrecliente"]), '', // Acreedor
                                        '', // Nombre acreedor
                                        ltrim($_SESSION["formulario"]["datos"]["matricula"], "0"), // N&uacute;mero de matr&iacute;cula
                                        '', // N&uacute;mero de proponente
                                        TIPO_DOC_FOR_MERCANTIL, // Tipo de documento
                                        '', // N&uacute;mero del documento
                                        $_SESSION["tramite"]["fecharecibo"], '', // C&oacute;digo de origen
                                        'EL COMERCIANTE', '', // Clasificaci&oacute;n
                                        '', // N&uacute;mero del contrato
                                        '', // Idfuente
                                        1, // versi&oacute;n
                                        '', // Path
                                        '1', // Estado
                                        date("Ymd"), // fecha de escaneo o generaci&oacute;n
                                        $_SESSION["generales"]["codigousuario"], '', // Caja
                                        '', // Libro
                                        $det, '', // Libro del registro
                                        '', // N&uacute;mero del registro
                                        $bandeja, // Bandeja de registro
                                        'S', // Soporte del recibo
                                        '', // Identificador
                                        '503' // Tipo de anexo
                        );

                        $dirx = date("Ymd");
                        $path = PATH_ABSOLUTO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/mreg/' . $dirx;
                        if (!is_dir($path) || !is_readable($path)) {
                            mkdir($path, 0777);
                            \funcionesSii2::crearIndex($path);
                        }

                        $pathsalida = 'mreg/' . $dirx . '/' . $id . '.pdf';
                        copy('../../../tmp/' . $name, '../../' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/' . $pathsalida);
                        unlink('../../../tmp/' . $name);
                        \funcionesSii2::grabarPathAnexoRadicacion($dbx, $id, $pathsalida);
                    }
                }
            }
            unset($arrForms);
            unset($form);

            //
            if (!empty($datPrincipal)) {
                $bandeja = '4.-REGMER';
                $_SESSION["formulario"]["datos"] = $datPrincipal;
                $_SESSION["formulario"]["numrec"] = $_SESSION["tramite"]["numerorecuperacion"];
                $name = armarPdfFormatoAfiliacionSii($dbx, $_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"], '', '');
                $det = 'Formato de renovación de afiliación matrícula No. ' . $datPrincipal["matricula"];
                $id = \funcionesSii2::grabarAnexoRadicacion(
                                $dbx, ltrim($_SESSION["tramite"]["numeroradicacion"], "0"), // COdigo barras
                                trim($_SESSION["tramite"]["numerorecibo"]), // Recibo
                                trim($_SESSION["tramite"]["numerooperacion"]), // Operacion
                                ltrim($_SESSION["tramite"]["identificacioncliente"], "0"), // identificacion
                                trim($_SESSION["tramite"]["nombrecliente"]), // Nombre
                                '', // Acreedor
                                '', // Nombre acreedor
                                ltrim($_SESSION["formulario"]["datos"]["matricula"], "0"), // Numero de matricula
                                '', // N&uacute;mero de proponente
                                TIPO_DOC_FOR_AFILIACION, // Tipo de documento
                                '', // Numero del documento
                                $_SESSION["tramite"]["fecharecibo"], // fecha del recibo
                                '', // Codigo de origen
                                'EL COMERCIANTE', '', // Clasificacion
                                '', // Numero del contrato
                                '', // Idfuente
                                1, // version
                                '', // Path
                                '1', // Estado
                                date("Ymd"), // fecha de escaneo o generacion
                                $_SESSION["generales"]["codigousuario"], // Usuario que genera
                                '', // Caja
                                '', // Libro
                                $det, // Detalle
                                '', // Libro del registro
                                '', // Numero del registro
                                $bandeja, // Bandeja de registro
                                'S', // Soporte del recibo
                                '', // Identificador
                                '503' // Tipo de anexo
                );

                $dirx = date("Ymd");
                $path = PATH_ABSOLUTO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/mreg/' . $dirx;
                if (!is_dir($path) || !is_readable($path)) {
                    mkdir($path, 0777);
                    \funcionesSii2::crearIndex($path);
                }

                $pathsalida = 'mreg/' . $dirx . '/' . $id . '.pdf';
                copy('../../../tmp/' . $name, '../../' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/' . $pathsalida);
                unlink('../../../tmp/' . $name);
                \funcionesSii2::grabarPathAnexoRadicacion($dbx, $id, $pathsalida);
            }
        }
    }

    public static function generarReciboCajaRepositorio($dbx, $mat, $pro, $arreglo = array(), $tiporegistro = 'RegMer', $genrec = '') {
        require_once ('genPdfsGenerales.php');
        if (!isset($_SESSION["tramite"]["claveprepago"])) {
            $_SESSION["tramite"]["claveprepago"] = '';
        }
        if (!isset($_SESSION["tramite"]["saldoprepago"])) {
            $_SESSION["tramite"]["saldoprepago"] = 0;
        }

        // echo "entra a armar pdf del recibo<br>";
        $name = armarPdfReciboSii($dbx, $_SESSION["tramite"]["idliquidacion"], 'T', 'SI', $arreglo, $_SESSION["tramite"]["claveprepago"], $_SESSION["tramite"]["saldoprepago"], $genrec);
        // echo "armo pdf del recibo<br>";

        $tipodoc = '';
        $bandeja = '';
        switch ($tiporegistro) {
            case "RegMer": {
                    $tipodoc = TIPO_DOC_REC_CAJA_MERCANTIL;
                    $bandeja = '4.-REGMER';
                    break;
                }
            case "LibCom":
                $tipodoc = TIPO_DOC_REC_CAJA_MERCANTIL;
                $bandeja = '4.-REGMER';
                break;
            case "CerEle":
                $tipodoc = TIPO_DOC_REC_CAJA_MERCANTIL;
                $bandeja = '4.-REGMER';
                break;
            case "CerVirt":
                $tipodoc = TIPO_DOC_REC_CAJA_MERCANTIL;
                $bandeja = '4.-REGMER';
                break;
            case "InscDoc":
                $tipodoc = TIPO_DOC_REC_CAJA_MERCANTIL;
                $bandeja = '4.-REGMER';
                break;
            case "InscDocRegMer":
                $tipodoc = TIPO_DOC_REC_CAJA_MERCANTIL;
                $bandeja = '4.-REGMER';
                break;
            case "InscDocEsadl":
                $tipodoc = TIPO_DOC_REC_CAJA_ESADL;
                $bandeja = '5.-REGESADL';
                break;
            case "crm":
                $tipodoc = TIPO_DOC_REC_CAJA_MERCANTIL;
                $bandeja = '4.-REGMER';
                break;
            case "RegEsadl":
                $tipodoc = TIPO_DOC_REC_CAJA_ESADL;
                $bandeja = '5.-REGESADL';
                break;
            case "RegPro":
                $tipodoc = TIPO_DOC_REC_CAJA_PROPONENTES;
                $bandeja = '6.-REGPRO';
                break;
            case "PrePag":
                $tipodoc = TIPO_DOC_REC_CAJA_MERCANTIL;
                $bandeja = '4.-REGMER';
                break;
            default :
                $tipodoc = TIPO_DOC_REC_CAJA_MERCANTIL;
                $bandeja = '4.-REGMER';
                break;
        }

        $id = \funcionesSii2::grabarAnexoRadicacion(
                        $dbx, // COnexion
                        ltrim($_SESSION["tramite"]["numeroradicacion"], "0"), // NumRad
                        trim($_SESSION["tramite"]["numerorecibo"]), // NumRecibo
                        trim($_SESSION["tramite"]["numerooperacion"]), // NumOpe
                        ltrim($_SESSION["tramite"]["identificacioncliente"], "0"), // IdeCliente
                        trim($_SESSION["tramite"]["nombrecliente"]), // NomCliente
                        '', // Acreedor
                        '', // Nombre acreedor
                        ltrim($mat, "0"), // mat
                        ltrim($pro, "0"), // Prop
                        $tipodoc, // Tipo de documento
                        '', // N&uacute;mero del documento
                        $_SESSION["tramite"]["fecharecibo"], // fechaRecibo
                        '', // C&oacute;digo de origen
                        'CAJA DE LA CAMARA DE COMERCIO', // Txtorigen
                        '', // Clasificaci&oacute;n
                        '', // N&uacute;mero del contrato
                        '', // Idfuente
                        1, // versi&oacute;n
                        '', // Path
                        '1', // Estado
                        date("Ymd"), // fecha de escaneo o generaci&oacute;n
                        $_SESSION["generales"]["codigousuario"], // Usuario
                        '', // Caja
                        '', // Libro
                        'RECIBO DE CAJA No. ' . $_SESSION["tramite"]["numerorecibo"], // Detalle
                        '', // Libro de comercio
                        '', // N&uacute;mero de registros en libro
                        $bandeja, // Bandeja de registro
                        'S', // Soporte del recibo de caja
                        '', // Identificador
                        '509' // Tipo anexo	
        );

        // Traslada la imagen tif del sello al repositorio
        // $tam = filesize($name);

        $dirx = date("Ymd");
        $path = PATH_ABSOLUTO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/mreg/' . $dirx;
        if (!is_dir($path) || !is_readable($path)) {
            mkdir($path, 0777);
            \funcionesSii2::crearIndex($path);
        }

        $pathsalida = 'mreg/' . $dirx . '/' . $id . '.pdf';
        copy($name, '../../../' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/' . $pathsalida);
        unlink($name);
        \funcionesSii2::grabarPathAnexoRadicacion($dbx, $id, $pathsalida);
    }

    public static function generarSecuenciaCodigoBarras($dbx) {
        $nameLog = 'generarSecuenciaCodigoBarras_' . date("Ymd");
        //
        $cb = 0;
        $cb = \funcionesSii2::retornarMregSecuencia($dbx, 'CODIGOS-BARRAS');
        if ($cb == 0) {
            log::general2($nameLog, '', 'Error recuperando secuencia codigo de barras : ' . $_SESSION["generales"]["mensajeerror"]);
            $_SESSION["generales"]["mensajeerror"] = 'No fue posible localizar el ultimo codigo de barras asignado';
            return false;
        }

        // ************************************************************************************************ //
        // Revisa que el codigo de barras no este previamente creado
        // ************************************************************************************************ //
        $seguir = "si";
        while ($seguir == 'si') {
            $cb++;
            if (contarRegistrosMysqli2($dbx, 'mreg_est_codigosbarras', "codigobarras='" . $cb . "'") == 0) {
                $seguir = 'no';
            }
        }

        // ************************************************************************************************ //
        // Actualiza el consecutivo en claves valor
        // ************************************************************************************************ //	
        \funcionesSii2::actualizarMregSecuenciasSii($dbx, 'CODIGOS-BARRAS', $cb);

        // ************************************************************************************************ //
        // Arma los arreglos para grabar el recibo
        // ************************************************************************************************ //

        $arrCampos = array(
            'codigobarras',
            'operacion',
            'recibo',
            'fecharadicacion',
            'matricula',
            'proponente',
            'idclase',
            'numid',
            'numdocextenso',
            'nombre',
            'estadofinal',
            'operadorfinal',
            'fechaestadofinal',
            'horaestadofinal',
            'sucursalfinal',
            'activos',
            'liquidacion',
            'reliquidacion',
            'actoreparto',
            'tipdoc',
            'numdoc',
            'oridoc',
            'mundoc',
            'fecdoc',
            'detalle',
            'canins',
            'candoc',
            'canfor',
            'cananx1',
            'cananx2',
            'cananx3',
            'cananx4',
            'cananx5',
            'sucursalradicacion',
            'tiprut',
            'numcaja',
            'escaneocompleto',
            'clavefirmado'
        );

        //
        $arrValores = array(
            "'" . $cb . "'",
            "''", // operacion
            "''", // recibo
            "'" . date("Ymd") . "'",
            "''", // matricula
            "''", // proponente
            "''", // idclase
            "''", // numid
            "''", // numdocextenso
            "''", // nombre
            "'" . '01' . "'",
            "''", // operadorfinal
            "'" . date("Ymd") . "'",
            "'" . date("His") . "'",
            "''", // sucursalfinal
            0, // activos
            0, // liquidacion
            "''", // reliquidacion
            "''", // actoreparto
            "''", // tipdoc
            "''", // numdoc
            "''", // oridoc
            "''", // mundoc
            "''", // fecdoc
            "''", // detalle
            0, // canins
            0, // candoc
            0, // canfor
            0, // cananx1
            0, // cananx2
            0, // cananx3
            0, // cananx4
            0, // cananx5
            "''", // sucursal radicacion
            "''", // tiprut
            "''", // numcaja
            "''", // escaneo completo
            "''" // clave firmado
        );

        //
        $res = insertarRegistrosMysqli2($dbx, 'mreg_est_codigosbarras', $arrCampos, $arrValores);
        if ($res === false) {
            log::general2($nameLog, '', 'Error creando codigo de barras : ' . $_SESSION["generales"]["mensajeerror"]);
            return false;
        }

        return $cb;
    }

    public static function generarSecuenciaCodigoBarrasPowerFile($dbx) {
        $cb = false;
        $headers = array(
            'function: authenticationUser',
            'pmhost: http://bpm.cccucuta.org.co',
            'workspace: cccucuta',
            'Content-Type: application/json'
        );
        $data = array('pmhost' => 'http://bpm.cccucuta.org.co',
            'workspace' => 'cccucuta',
            'clientId' => 'NZPXVTXFOLFZTOGQVGGYUDXGCGLLRFQV',
            'clientSecret' => '13653564459a7194df19bb2021547438',
            'username' => 'confecamara',
            'password' => '123456789'
        );

        $fields = json_encode($data);
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, 'http://bpm.cccucuta.org.co/syscccucuta/en/neoclassic/NewUser/services/loginUserService.php');
        curl_setopt($ch, CURLOPT_POST, true);
        curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
        curl_setopt($ch, CURLOPT_POSTFIELDS, $fields);
        $result = curl_exec($ch);
        curl_close($ch);
        $resultado = json_decode($result, true);
        $access_token = $resultado['access_token'];
        $expires_in = $resultado['expires_in'];
        $token_type = $resultado['token_type'];
        $scope = $resultado['scope'];
        $refresh_token = $resultado['refresh_token'];

        //echo $access_token;
        //Validacion de Autenticacion
        if ($access_token != '') {
            $header = array(
                'function: newCaseTrigger',
                'pmhost: http://bpm.cccucuta.org.co',
                'workspace: cccucuta',
                'Authorization:' . $access_token,
                'statusIngestion: SUCCESSFUL',
                'processId: 125488281598ddd07bbb5e4006297031',
                'taskId: 130462646598ddd080ea780009585776',
                'userId: 85714721659a72800144f89026507541',
                'Content-Type: application/json'
            );

            $ch = curl_init();
            curl_setopt($ch, CURLOPT_URL, 'http://bpm.cccucuta.org.co/syscccucuta/en/neoclassic/NewUser/services/powerfileService.php');
            curl_setopt($ch, CURLOPT_POST, true);
            curl_setopt($ch, CURLOPT_HTTPHEADER, $header);
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
            curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
            curl_setopt($ch, CURLOPT_POSTFIELDS, $fields);
            $results = curl_exec($ch);
            curl_close($ch);
            $resultado = json_decode($results, true);
            if (isset($resultado["txt_NumRad"])) {
                $cb = ltrim(trim($resultado["txt_NumRad"]), "0");
            }
        }

        // ************************************************************************************************ //
        // Arma los arreglos para grabar el recibo
        // ************************************************************************************************ //

        if ($cb && $cb != '') {
            $arrCampos = array(
                'codigobarras',
                'operacion',
                'recibo',
                'fecharadicacion',
                'matricula',
                'proponente',
                'idclase',
                'numid',
                'numdocextenso',
                'nombre',
                'estadofinal',
                'operadorfinal',
                'fechaestadofinal',
                'horaestadofinal',
                'sucursalfinal',
                'activos',
                'liquidacion',
                'reliquidacion',
                'actoreparto',
                'tipdoc',
                'numdoc',
                'oridoc',
                'mundoc',
                'fecdoc',
                'detalle',
                'canins',
                'candoc',
                'canfor',
                'cananx1',
                'cananx2',
                'cananx3',
                'cananx4',
                'cananx5',
                'sucursalradicacion',
                'tiprut',
                'numcaja',
                'escaneocompleto',
                'clavefirmado'
            );

            //
            $arrValores = array(
                "'" . $cb . "'",
                "''", // operacion
                "''", // recibo
                "'" . date("Ymd") . "'",
                "''", // matricula
                "''", // proponente
                "''", // idclase
                "''", // numid
                "''", // numdocextenso
                "''", // nombre
                "'" . '01' . "'",
                "''", // operadorfinal
                "'" . date("Ymd") . "'",
                "'" . date("His") . "'",
                "''", // sucursalfinal
                0, // activos
                0, // liquidacion
                "''", // reliquidacion
                "''", // actoreparto
                "''", // tipdoc
                "''", // numdoc
                "''", // oridoc
                "''", // mundoc
                "''", // fecdoc
                "''", // detalle
                0, // canins
                0, // candoc
                0, // canfor
                0, // cananx1
                0, // cananx2
                0, // cananx3
                0, // cananx4
                0, // cananx5
                "''", // sucursal radicacion
                "''", // tiprut
                "''", // numcaja
                "''", // escaneo completo
                "''" // clave firmado
            );

            //
            $res = insertarRegistrosMysqli2($dbx, 'mreg_est_codigosbarras', $arrCampos, $arrValores);
            if ($res === false) {
                return false;
            }
        }

        return $cb;
    }

    public static function generarSecuenciaLibros($dbx, $libro = '') {
        if (strlen($libro) == 2) {
            if ($libro < '50') {
                $libro = 'RM' . $libro;
            } else {
                $libro = 'RE' . $libro;
            }
        }

        //
        $ins = 0;
        $ins = retornarMregSecuencia('LIBRO-' . $libro);
        if ($ins == 0) {
            $_SESSION["generales"]["mensajeerror"] = 'No fue posible localizar la ultima inscripcion para el libro' . $libro;
            return false;
        }

        // ************************************************************************************************ //
        // Revisa que la inscripción no haya sido previamente asignada
        // ************************************************************************************************ //
        $seguir = "si";
        while ($seguir == 'si') {
            $ins++;
            if (contarRegistros('mreg_est_inscripciones', "libro='" . $libro . "' and registro='" . $ins . "'") == 0) {
                $seguir = 'no';
            }
        }

        // ************************************************************************************************ //
        // Actualiza el consecutivo en claves valor
        // ************************************************************************************************ //	
        actualizarMregSecuencias('LIBRO-' . $libro, $ins);

        // ************************************************************************************************ //
        // Arma los arreglos para grabar el recibo
        // ************************************************************************************************ //

        $arrCampos = array(
            'libro',
            'registro',
            'dupli'
        );

        //
        $arrValores = array(
            "'" . $libro . "'",
            "'" . $ins . "'",
            "'1'"
        );

        //
        $res = insertarRegistros('mreg_est_inscripciones', $arrCampos, $arrValores);
        if ($res === false) {
            return false;
        }

        return $ins;
    }

    public static function generarSecuenciaMatriculaSii($dbx, $tipomat = '') {
        $nameLog = 'generarSecuenciaMatriculaSii_' . date("Ymd");

        //
        $mat = 0;
        $mat = \funcionesSii2::retornarMregSecuenciaSii($dbx, $tipomat);

        if ($mat == 0) {
            $_SESSION["generales"]["mensajeerror"] = 'No fue posible localizar la ultima matricula asignada';
            return false;
        }

        // ************************************************************************************************ //
        // Revisa que la inscripción no haya sido previamente asignada
        // ************************************************************************************************ //
        $seguir = "si";
        while ($seguir == 'si') {
            $mat++;
            if ($tipomat == 'MATREGMER') {
                $xMat = ltrim($mat, "0");
            }
            if ($tipomat == 'MATESADL') {
                $xMat = "S" . sprintf("%07s", $mat);
            }
            if ($tipomat == 'MATCIVIL') {
                $xMat = "N" . sprintf("%07s", $mat);
            }

            // $tx = retornarRegistro ('mreg_est_inscritos',"matricula='" . $xMat . "'");
            if (contarRegistrosMysqli2($dbx, 'mreg_est_inscritos', "matricula='" . $xMat . "'") == 0) {
                $seguir = 'no';
            }
        }

        // ************************************************************************************************ //
        // Actualiza el consecutivo en claves valor
        // ************************************************************************************************ //	
        \funcionesSii2::actualizarMregSecuenciasSii($dbx, $tipomat, $mat);

        //
        $arrCampos = array(
            'matricula',
            'ctrestmatricula',
            'ctrestdatos',
            'origendocconst',
            'fecactualizacion',
            'fecsincronizacion',
            'horsincronizacion'
        );
        $arrValores = array(
            "'" . $xMat . "'",
            "'AS'",
            "'3'",
            "''",
            "''",
            "''",
            "''"
        );
        unset($_SESSION["expedienteactual"]);
        $res = insertarRegistrosMysqli2($dbx, 'mreg_est_inscritos', $arrCampos, $arrValores);
        if ($res === false) {
            \logSii2::general2($nameLog, '', 'Error asignando numero de matricula : ' . $_SESSION["generales"]["mensajeerror"]);
            return false;
        }

        return $xMat;
    }

    public static function generarSecuenciaOperacion($dbx, $usuario, $fecha, $cajero = '', $sedex = '') {
        $sec = 0;
        $sec1 = 0;
        $sede = $sedex;

        // ************************************************************************************************ //
        // Si el usuario es INTERNET o USUPUBXX
        // ************************************************************************************************ //
        if ($cajero == 'INTERNET' || $cajero == 'USUPUBXX') {
            $sede = '99';
        }

        // ************************************************************************************************ //
        // Si el usuario es INTERNET o USUPUBXX
        // ************************************************************************************************ //    
        if ($cajero == 'RUE') {
            $sede = '90';
        }

        // ************************************************************************************************ //
        // Si el usuario es diferente de INTERNET, USUPUBXX, RUE
        // ************************************************************************************************ //    
        if ($cajero != 'INTERNET' && $cajero != 'USUPUBXX' && $cajero != 'RUE') {

            // ************************************************************************************************ //
            // Localiza el usuario en la tabla de usuarios
            // ************************************************************************************************ //
            $arrTem = retornarRegistroMysqli2($dbx, "usuarios", "idusuario='" . $cajero . "'");

            // ************************************************************************************************ //
            // Si el usuario no existe
            // ************************************************************************************************ //
            if ($arrTem === false) {
                $_SESSION["generales"]["mensajeerror"] = 'Usuario-cajero no localizado en la tabla de usuarios';
                return false;
            }

            // ************************************************************************************************ //
            // Si el usuario esta inactivo
            // ************************************************************************************************ //
            if ($arrTem["fechainactivacion"] != '' && $arrTem["fechainactivacion"] != '00000000') {
                $_SESSION["generales"]["mensajeerror"] = 'Usuario-cajero esta inactivo';
                return false;
            }

            // ************************************************************************************************ //
            // Si el usuario no ha sido activado
            // ************************************************************************************************ //
            if ($arrTem["fechaactivacion"] == '' || $arrTem["fechaactivacion"] == '00000000') {
                $_SESSION["generales"]["mensajeerror"] = 'Usuario-cajero no ha sido activado';
                return false;
            }

            // ************************************************************************************************ //
            // Si el usuario no ha sido activado
            // ************************************************************************************************ //
            if ($arrTem["escajero"] != 'SI') {
                $_SESSION["generales"]["mensajeerror"] = 'Usuario-cajero no es tipo cajero';
                return false;
            }

            // ************************************************************************************************ //
            // Asigna la sede al número de operación.
            // Solo si esta no fue pasada como parámetro desde la liquidación.
            // ************************************************************************************************ //    
            if ($sede == '') {
                $sede = $arrTem["idsede"];
                if (trim($sede) == '') {
                    $sede = '01';
                }
            }
        }

        // ************************************************************************************************ //
        // Calcula la secuencia de la operacion
        // ************************************************************************************************ //
        $contar = contarRegistrosMysqli2($dbx, 'mreg_controlusuarios', "usuario='" . $cajero . "' and fecha='" . $fecha . "'");
        if ($contar === false) {
            return false;
        }

        if ($contar == 0) {
            $arrCampos = array(
                'usuario',
                'fecha',
                'secuencia'
            );
            $arrValores = array(
                "'" . $usuario . "'",
                "'" . $fecha . "'",
                1
            );
            insertarRegistrosMysqli2($dbx, 'mreg_controlusuarios', $arrCampos, $arrValores);
            $sec1 = 1;
        } else {
            $arrTem = retornarRegistroMysqli2($dbx, 'mreg_controlusuarios', "usuario='" . $cajero . "' and fecha='" . $fecha . "'");
            $sec = $arrTem["secuencia"] + 1;
            $sec1 = $sec;
            $arrCampos = array(
                'secuencia'
            );
            $arrValores = array(
                $sec
            );
            regrabarRegistrosMysqli2($dbx, 'mreg_controlusuarios', $arrCampos, $arrValores, "usuario='" . $cajero . "' and fecha='" . $fecha . "'");
        }

        // ************************************************************************************************ //
        // Retorna el numero de operacion
        // 2016-07-30 : JINT
        // Si hay integración con SIREP, retornar el número de operación a 12 dígitos
        // Si no hay integración con SIREP retorna el número de operación a 25 digitos
        // ************************************************************************************************ //
        return $sede . '-' . trim($cajero) . '-' . $fecha . '-' . sprintf("%04s", $sec1);
    }

    public static function generarSecuenciaReciboNuevaSii($mysqli, $tipo = 'S', $fps = array(), $operacion = '', $fecha = '', $hora = '', $codbarras = '', $tiporegistro = '', $identificacion = '', $nombre = '', $organizacion = '', $categoria = '', $idtipodoc = '', $numdoc = '', $origendoc = '', $fechadoc = '') {

        // ******************************************************************************* //
        // validas que todos los datos requeridos se pasen
        // ******************************************************************************* //
        $errores = array();
        if (!empty($fps)) {
            $jx = 0;
            foreach ($fps as $d) {
                $jx++;
                if (!isset($d["tipo"])) {
                    $errores[] = 'FPago ' . $jx . ' . Tipo no reportado';
                }
                if (!isset($d["valor"])) {
                    $errores[] = 'FPago ' . $jx . ' . Valor no reportado';
                }
                if (!isset($d["banco"])) {
                    $errores[] = 'FPago ' . $jx . ' . Banco no reportado';
                }
                if (!isset($d["cheque"])) {
                    $errores[] = 'FPago ' . $jx . ' . Cheque no reportado';
                }
            }
        }

        if (!empty($errores)) {
            $_SESSION["generales"]["mensajeerror"] = '';
            foreach ($errores as $e) {
                $_SESSION["generales"]["mensajeerror"] .= $e . " ** ";
            }
            return false;
        }

        //
        $rec = 0;
        $recx = '';

        // ************************************************************************************************ //
        // Localiza el numero del recibo a generar dependiendo del tipo de documento
        // ************************************************************************************************ //
        if ($tipo == 'S') { // Si son recibos normales
            $tclave = 'RECIBOS-NORMALES';
            $rec = \funcionesSii2::retornarMregSecuenciaMaxAsentarReciboSii($mysqli, $tclave);
        }
        if ($tipo == 'M') { // Si son notas de reversion
            $tclave = 'RECIBOS-NOTAS';
            $rec = \funcionesSii2::retornarMregSecuenciaMaxAsentarReciboSii($mysqli, $tclave);
        }
        if ($tipo == 'H') { // Si son gastos administrativos
            $tclave = 'RECIBOS-GA';
            $rec = \funcionesSii2::retornarMregSecuenciaMaxAsentarReciboSii($mysqli, $tclave);
        }
        if ($tipo == 'D') { // Si son consultas
            $tclave = 'RECIBOS-CO';
            $rec = \funcionesSii2::retornarMregSecuenciaMaxAsentarReciboSii($mysqli, $tclave);
        }
        if ($rec === false) {
            \logSii2::general2('reportarPago_' . date("Ymd"), '', 'Error recuperando la secuencia del recibo de caja : ' . $_SESSION["generales"]["mensajeerror"]);
            $_SESSION["generales"]["mensajeerror"] = 'Error recuperando la secuencia del recibo de caja';
            return false;
        } else {
            \logSii2::general2('generarSecuenciaReciboNuevaSii_' . date("Ymd"), '', 'Secuencia generada : ' . $rec);
        }

        // ************************************************************************************************ //
        if ($rec == '') {
            $rec = 0;
        } else {
            $rec = intval($rec);
        }

        // ************************************************************************************************ //
        // Revisa que el recibo no esta creado previamente, de ser asi, genera un nuevo numero
        // ************************************************************************************************ //
        $seguir = "si";
        while ($seguir == 'si') {
            $rec++;
            $recx = $tipo . sprintf("%09s", $rec);
            if (contarRegistrosMysqli2($mysqli, 'mreg_recibosgenerados', "recibo='" . $recx . "'") == 0) {
                $seguir = 'no';
            }
        }

        // ************************************************************************************************ //
        // Actualiza el consecutivo en claves valor
        // ************************************************************************************************ //	
        \funcionesSii2::actualizarMregSecuenciasAsentarReciboSii($mysqli, $tclave, $rec);

        // ************************************************************************************************ //
        // Arma los arreglos para grabar el recibo
        // ************************************************************************************************ //

        $arrCampos = array(
            'recibo',
            'operacion',
            'factura',
            'codigobarras',
            'fecha',
            'hora',
            'usuario',
            'tipogasto',
            'tipoidentificacion',
            'identificacion',
            'razonsocial',
            'nombre1',
            'nombre2',
            'apellido1',
            'apellido2',
            'direccion',
            'municipio',
            'telefono1',
            'telefono2',
            'email',
            'idliquidacion',
            'tipotramite',
            'valorneto',
            'pagoprepago',
            'pagoafiliado',
            'pagoefectivo',
            'pagocheque',
            'pagoconsignacion',
            'pagopseach',
            'pagovisa',
            'pagomastercard',
            'pagocredencial',
            'pagoamerican',
            'pagodiners',
            'pagotdebito',
            'numeroautorizacion',
            'cheque',
            'franquicia',
            'nombrefranquicia',
            'codbanco',
            'nombrebanco',
            'alertaid',
            'alertaservicio',
            'alertavalor',
            'proyectocaja',
            'numerounicorue',
            'numerointernorue',
            'tipotramiterue',
            'idformapago',
            'estado',
            'estadoemail',
            'estadosms'
        );

        $_SESSION["tramite"]["tipotramiterue"] = '';
        if (substr($_SESSION["tramite"]["tipotramite"], 0, 4) == 'rues') {
            $_SESSION["tramite"]["tipotramiterue"] = substr($_SESSION["tramite"]["tipotramite"], 6);
        }

        //
        $arrValores = array(
            "'" . $recx . "'",
            "'" . $operacion . "'",
            "'" . $_SESSION["tramite"]["numerofactura"] . "'",
            "'" . $codbarras . "'",
            "'" . $fecha . "'",
            "'" . $hora . "'",
            "'" . $_SESSION["generales"]["cajero"] . "'",
            "'" . $_SESSION["tramite"]["tipogasto"] . "'",
            "'" . $_SESSION["tramite"]["tipoidentificacionpagador"] . "'",
            "'" . ltrim($_SESSION["tramite"]["identificacionpagador"], "0") . "'",
            "'" . addslashes(trim($_SESSION["tramite"]["nombrepagador"] . ' ' . $_SESSION["tramite"]["apellidopagador"])) . "'",
            "'" . addslashes(trim($_SESSION["tramite"]["nombre1pagador"])) . "'",
            "'" . addslashes(trim($_SESSION["tramite"]["nombre2pagador"])) . "'",
            "'" . addslashes(trim($_SESSION["tramite"]["apellido1pagador"])) . "'",
            "'" . addslashes(trim($_SESSION["tramite"]["apellido2pagador"])) . "'",
            "'" . addslashes(trim($_SESSION["tramite"]["direccionpagador"])) . "'",
            "'" . trim($_SESSION["tramite"]["municipiopagador"]) . "'",
            "'" . trim($_SESSION["tramite"]["telefonopagador"]) . "'",
            "'" . trim($_SESSION["tramite"]["movilpagador"]) . "'",
            "'" . addslashes(trim($_SESSION["tramite"]["emailpagador"])) . "'",
            $_SESSION["tramite"]["numeroliquidacion"],
            "'" . trim($_SESSION["tramite"]["tipotramite"]) . "'",
            $_SESSION["tramite"]["valortotal"],
            $_SESSION["tramite"]["pagoprepago"],
            $_SESSION["tramite"]["pagoafiliado"],
            $_SESSION["tramite"]["pagoefectivo"],
            $_SESSION["tramite"]["pagocheque"],
            $_SESSION["tramite"]["pagoconsignacion"],
            $_SESSION["tramite"]["pagoach"],
            $_SESSION["tramite"]["pagovisa"],
            $_SESSION["tramite"]["pagomastercard"],
            $_SESSION["tramite"]["pagocredencial"],
            $_SESSION["tramite"]["pagoamerican"],
            $_SESSION["tramite"]["pagodiners"],
            $_SESSION["tramite"]["pagotdebito"],
            "'" . $_SESSION["tramite"]["numeroautorizacion"] . "'",
            "'" . $_SESSION["tramite"]["numerocheque"] . "'",
            "'" . $_SESSION["tramite"]["idfranquicia"] . "'",
            "'" . $_SESSION["tramite"]["nombrefranquicia"] . "'",
            "'" . $_SESSION["tramite"]["idcodban"] . "'",
            "''", // Nombre banco
            $_SESSION["tramite"]["alertaid"],
            "'" . $_SESSION["tramite"]["alertaservicio"] . "'",
            $_SESSION["tramite"]["alertavalor"],
            "'" . $_SESSION["tramite"]["proyectocaja"] . "'",
            "'" . $_SESSION["tramite"]["rues_numerounico"] . "'",
            "'" . $_SESSION["tramite"]["rues_numerointerno"] . "'",
            "'" . $_SESSION["tramite"]["tipotramiterue"] . "'",
            "'" . $_SESSION["tramite"]["idformapago"] . "'",
            "'01'",
            "'0'",
            "'0'"
        );

        //
        $res = insertarRegistrosMysqli2($mysqli, 'mreg_recibosgenerados', $arrCampos, $arrValores);
        if ($res === false) {
            \logSii2::general2('generarSecuenciaReciboNuevaSii_' . date("Ymd"), '', 'Error insertando en mreg_recibosgenerados : ' . $_SESSION["generales"]["mensajeerror"]);
            return false;
        }

        // ************************************************************************************************ //
        // Arma el detalle del recibo y lo graba
        // ************************************************************************************************ //
        $arrCampos = array(
            'recibo',
            'secuencia',
            'fecha',
            'idservicio',
            // 'cc',
            'matricula',
            'proponente',
            // 'tipogasto',
            'ano',
            'cantidad',
            'valorbase',
            'porcentaje',
            'valorservicio',
            'identificacion',
            'razonsocial',
            'organizacion',
            'categoria',
            'idtipodoc',
            'numdoc',
            'origendoc',
            'fechadoc',
            'expedienteafectado',
            'fecharenovacionaplicable'
        );
        $sec = 0;
        foreach ($_SESSION["tramite"]["liquidacion"] as $d) {
            $matx = '';
            $prox = '';
            if (!isset($d["expediente"])) {
                $d["expediente"] = '';
            }
            if (!isset($d["idservicio"])) {
                $d["idservicio"] = '';
            }
            if (!isset($d["ano"])) {
                $d["ano"] = '';
            }
            if (!isset($d["cantidad"])) {
                $d["cantidad"] = 0;
            }
            if (!isset($d["valorbase"])) {
                $d["valorbase"] = 0;
            }
            if (!isset($d["porcentaje"])) {
                $d["porcentaje"] = 0;
            }
            if (!isset($d["valorservicio"])) {
                $d["valorservicio"] = 0;
            }
            if (!isset($d["expedienteafiliado"])) {
                $d["expedienteafiliado"] = '';
            }
            if (!isset($d["ccos"])) {
                $d["ccos"] = '';
            }

            //
            if ($tiporegistro == 'RegPro') {
                $prox = $d["expediente"];
            } else {
                $matx = $d["expediente"];
            }

            $sec++;
            $arrValores = array(
                "'" . $recx . "'",
                $sec,
                "'" . $fecha . "'",
                "'" . $d["idservicio"] . "'",
                // "''",
                "'" . ltrim($matx, "0") . "'",
                "'" . ltrim($prox, "0") . "'",
                // "'" . $tots["tipogasto"] . "'",
                "'" . ltrim($d["ano"], "0") . "'",
                intval($d["cantidad"]),
                doubleval($d["valorbase"]),
                doubleval($d["porcentaje"]),
                doubleval($d["valorservicio"]),
                "'" . $identificacion . "'",
                "'" . addslashes($nombre) . "'",
                "'" . $organizacion . "'",
                "'" . $categoria . "'",
                "'" . $idtipodoc . "'",
                "'" . $numdoc . "'",
                "'" . addslashes($origendoc) . "'",
                "'" . $fechadoc . "'",
                "'" . $d["expedienteafiliado"] . "'",
                "'" . $fecha . "'"
            );
            $res = insertarRegistrosMysqli2($mysqli, 'mreg_recibosgenerados_detalle', $arrCampos, $arrValores);
            if ($res === false) {
                \logSii2::general2('generarSecuenciaReciboNuevaSii_' . date("Ymd"), '', 'Error insertando en mreg_recibosgenerados_detalle : ' . $_SESSION["generales"]["mensajeerror"]);
                return false;
            }
        }

        // ************************************************************************************************ //
        // Arma formas de pago del recibo y las graba
        // ************************************************************************************************ //
        $arrCampos = array(
            'recibo',
            'tipo',
            'valor',
            'banco',
            'cheque',
        );
        $sec = 0;
        foreach ($fps as $fp) {
            $arrValores = array(
                "'" . $recx . "'",
                "'" . $fp["tipo"] . "'",
                $fp["valor"],
                "'" . $fp["banco"] . "'",
                "'" . $fp["cheque"] . "'"
            );
            $res = insertarRegistrosMysqli2($mysqli, 'mreg_recibosgenerados_fpago', $arrCampos, $arrValores);
            if ($res === false) {
                \logSii2::general2('generarSecuenciaReciboNuevaSii_' . date("Ymd"), '', 'Error insertando en mreg_recibosgenerados_fpago : ' . $_SESSION["generales"]["mensajeerror"]);
                return false;
            }
        }

        // ************************************************************************************************ //
        // 2016-07-31 : JINT
        // crea el recibo automáticamente en mreg_est_recibos
        // ************************************************************************************************ //
        $arrCampos = array(
            'numerorecibo',
            'ctranulacion',
            'numfactura',
            'fecoperacion',
            'horaoperacion',
            'idclase',
            'identificacion',
            'nombre',
            'operador',
            'sucursal',
            'ccos',
            'unidad',
            'producto',
            'servicio',
            'serviciodescuento',
            'cantidad',
            'valor',
            'tipogasto',
            'base',
            'moneda',
            'tasa',
            'codigocontable',
            'matricula',
            'activos',
            'anorenovacion',
            'formapago',
            'apellido1',
            'apellido2',
            'nombre1',
            'nombre2',
            'numinterno',
            'numunico',
            'numerooperacion',
            'direccion',
            'municipio',
            'telefono',
            'email',
            'compite360',
            'proyecto',
            'expedienteafectado',
            'fecharenovacionaplicable'
        );
        $arrValores = array();
        $sec = 0;
        if (!isset($_SESSION["tramite"]["camaradestino"])) {
            $_SESSION["tramite"]["camaradestino"] = '';
        }
        if (!isset($_SESSION["tramite"]["camaraorigen"])) {
            $_SESSION["tramite"]["camaraorigen"] = '';
        }
        if (!isset($_SESSION["tramite"]["numerointernorue"])) {
            $_SESSION["tramite"]["numerointernorue"] = '';
        }
        if (!isset($_SESSION["tramite"]["numerounicorue"])) {
            $_SESSION["tramite"]["numerounicorue"] = '';
        }
        if (!isset($_SESSION["tramite"]["proyecto"])) {
            $_SESSION["tramite"]["proyecto"] = '001';
        }

        foreach ($_SESSION["tramite"]["liquidacion"] as $d) {
            if (!isset($d["expediente"])) {
                $d["expediente"] = '';
            }
            if (!isset($d["idservicio"])) {
                $d["idservicio"] = '';
            }
            if (!isset($d["ano"])) {
                $d["ano"] = '';
            }
            if (!isset($d["cantidad"])) {
                $d["cantidad"] = 0;
            }
            if (!isset($d["valorbase"])) {
                $d["valorbase"] = 0;
            }
            if (!isset($d["porcentaje"])) {
                $d["porcentaje"] = 0;
            }
            if (!isset($d["valorservicio"])) {
                $d["valorservicio"] = 0;
            }
            if (!isset($d["expedienteafiliado"])) {
                $d["expedienteafiliado"] = '';
            }
            if (!isset($d["ccos"])) {
                $d["ccos"] = '';
            }

            //            
            $cc = '';
            if ($_SESSION["tramite"]["tipogasto"] == '7') {
                $cc = $_SESSION["tramite"]["camaradestino"];
            }
            if ($_SESSION["tramite"]["tipogasto"] == '8') {
                $cc = $_SESSION["tramite"]["camaraorigen"];
            }

            $fp = '1';
            switch ($_SESSION["tramite"]["idformapago"]) {
                case "02" : $fp = '2';
                    break;
                case "03" : $fp = '7';
                    break;
                case "04" : $fp = '3';
                    break;
                case "05" : $fp = '7';
                    break;
                case "06" : $fp = '5';
                    break;
                case "09" : $fp = '7';
                    break;
                case "90" : $fp = '4';
                    break;
            }

            $sec++;

            $arrValores = array(
                "'" . $recx . "'",
                "'0'",
                "'" . $_SESSION["tramite"]["numerofactura"] . "'",
                "'" . $fecha . "'",
                "'" . $hora . "'",
                "'" . $_SESSION["tramite"]["tipoidentificacionpagador"] . "'",
                "'" . ltrim($_SESSION["tramite"]["identificacionpagador"], "0") . "'",
                "'" . addslashes(trim($_SESSION["tramite"]["nombrepagador"])) . "'",
                "'" . $_SESSION["generales"]["cajero"] . "'",
                "'" . $_SESSION["tramite"]["sede"] . "'",
                "'" . $d["ccos"] . "'", // Ccos
                "''", // Unidad
                "''", // Servicio
                "'" . $d["idservicio"] . "'",
                "''", // Servicio descuento
                intval($d["cantidad"]),
                doubleval($d["valorservicio"]),
                "'" . $_SESSION["tramite"]["tipogasto"] . "'",
                doubleval($d["valorbase"]),
                "'001'",
                0,
                "'" . $cc . "'",
                "'" . ltrim($d["expediente"], "0") . "'",
                doubleval($d["valorbase"]),
                "'" . $d["ano"] . "'",
                "'" . $fp . "'",
                "'" . addslashes(substr(trim($_SESSION["tramite"]["apellido1pagador"]), 0, 50)) . "'",
                "'" . addslashes(substr(trim($_SESSION["tramite"]["apellido2pagador"]), 0, 50)) . "'",
                "'" . addslashes(substr(trim($_SESSION["tramite"]["nombre1pagador"]), 0, 50)) . "'",
                "'" . addslashes(substr(trim($_SESSION["tramite"]["nombre2pagador"]), 0, 50)) . "'",
                "'" . $_SESSION["tramite"]["numerointernorue"] . "'",
                "'" . $_SESSION["tramite"]["numerounicorue"] . "'",
                "'" . $operacion . "'",
                "'" . addslashes(trim($_SESSION["tramite"]["direccionpagador"])) . "'",
                "'" . addslashes(trim($_SESSION["tramite"]["municipiopagador"])) . "'",
                "'" . addslashes(trim($_SESSION["tramite"]["telefonopagador"])) . "'",
                "'" . addslashes(trim($_SESSION["tramite"]["emailpagador"])) . "'",
                "'NO'",
                "'" . sprintf("%03s", $_SESSION["tramite"]["proyectocaja"]) . "'",
                "'" . $d["expedienteafiliado"] . "'",
                "'" . $fecha . "'"
            );
            $res = insertarRegistrosMysqli2($mysqli, 'mreg_est_recibos', $arrCampos, $arrValores);
            if ($res === false) {
                \logSii2::general2('generarSecuenciaReciboNuevaSii_' . date("Ymd"), '', 'Error insertando en mreg_est_recibos : ' . $_SESSION["generales"]["mensajeerror"]);
            }
        }

        //
        return $recx;
    }

    public static function retornarSalarioMinimoActualSii($dbx = null, $ano = '') {
        $smlvs = retornarRegistrosMysqli2($dbx, 'bas_smlv', "1=1", "fecha asc");
        $minimo = 0;
        foreach ($smlvs as $sm) {
            if ($ano != '') {
                if (substr($sm["fecha"], 0, 4) == $ano) {
                    $minimo = $sm["salario"];
                }
            } else {
                if (($sm["fecha"] <= date("Ymd"))) {
                    $minimo = $sm["salario"];
                }
            }
        }
        unset($smlvs);
        unset($sm);
        return $minimo;
    }

    public static function isJson($string) {
        return ((is_string($string) &&
                (is_object(json_decode($string)) ||
                is_array(json_decode($string))))) ? true : false;
    }

    public static function localizarDiscoActual($dbx, $tipo = '000') {
        $arrTem = retornarRegistroMysqli2($dbx, 'bas_tipoanexodocumentos', "id='" . $tipo . "'");
        if ($arrTem === false || (empty($arrTem))) {
            $_SESSION["generales"]["mensajeerror"] = 'Imposible localizar el tipo de anexo en la tabla bas_tipoanexodocumentos';
            return false;
        }
        if (trim($arrTem["clavevalor"]) == '') {
            $_SESSION["generales"]["mensajeerror"] = 'Tipo anexo de documentos ' . $tipo . ' no tiene asignada una clave_valor para localización del disco actual';
            return false;
        }
        $disco = retornarClaveValorSii2($dbx, $arrTem["clavevalor"]); // Disco de la carpeta correspondiente
        if ($disco === false) {
            $_SESSION["generales"]["mensajeerror"] = 'Imposible localizar la entrada ' . $arrTem["clavevalor"] . ' en claves_valor';
            return false;
        }
        if (ltrim(trim($disco), "0") == '') {
            $disco = '001';
        }
        return $disco;
    }

    public static function retornarPantallaPredisenada($mysqli, $pantalla = '') {
        $pant = retornarRegistroMysqli2($mysqli, 'pantallas_propias', "idpantalla='" . $pantalla . "'");
        if ($pant === false || empty($pant)) {
            $pant = retornarRegistroMysqli2($mysqli, 'bas_pantallas', "idpantalla='" . $pantalla . "'");
            if ($pant === false || empty($pant)) {
                return "";
            } else {
                return $pant["txtasociado"];
            }
        } else {
            return $pant["txtasociado"];
        }
    }

    public static function localizarIP() {
        $ip = '';

        //
        if (isset($_SERVER['REMOTE_ADDR'])) {
            $ip = $_SERVER['REMOTE_ADDR'];
        }

        //
        if ($ip == '') {
            if (!empty($_SERVER['HTTP_CLIENT_IP'])) {
                $ip = $_SERVER['HTTP_CLIENT_IP'];
            } else {
                if (!empty($_SERVER['HTTP_X_FORWARDED_FOR'])) {
                    $ip = $_SERVER['HTTP_X_FORWARDED_FOR'];
                } else {
                    $ip = '127.0.0.1';
                }
            }
        }
        return $ip;
    }

    public static function localizarLetraCiiu($dbx, $ciiu) {
        $query = "select * from bas_ciius where idciiunum='" . $ciiu . "'";
        $res = retornarRegistroMysqli2($dbx, "bas_ciius", "idciiunum='" . $ciiu . "'");
        if ($res === false || empty($res)) {
            return '';
        }
        $resultado = $res["idciiu"];
        return substr($resultado, 0, 1);
    }

    public static function localizarSmmlv($fecha, $dbx = null) {

        $resultado = '';
        $cerrar = 'no';
        if ($dbx === null) {
            $fuente = '';
            include ($_SESSION ["generales"] ["pathabsoluto"] . '/librerias/funciones/asignaBD.php');
            $dbx = new mysqli($dbhost, $dbusuario, $dbpassword, $dbname);
            $cerrar = 'si';
        }

        $temx = retornarRegistrosMysqli2($dbx, 'bas_smlv', "fecha");
        foreach ($temx as $res) {
            if ($res["fecha"] < $fecha) {
                $resultado = $res["salario"];
            }
        }

        if ($cerrar == 'si') {
            $dbx->close();
        }
        return $resultado;
    }

    public static function mostrarFecha($fec) {
        if ((trim($fec) == '') || (ltrim($fec, "0") == '')) {
            return '';
        }
        if (strlen($fec) == 10) {
            $fec = str_replace("/", "-", $fec);
            return $fec;
        } else {
            return substr($fec, 0, 4) . '-' . substr($fec, 4, 2) . '-' . substr($fec, 6, 2);
        }
    }

    public static function mostrarFecha2($fec) {
        if ((trim($fec) == '') || (ltrim($fec, "0") == '')) {
            return '';
        }
        if (strlen($fec) == 10) {
            $fec = str_replace(array("/", "-"), "", $fec);
        }
        return substr($fec, 6, 2) . '/' . substr($fec, 4, 2) . '/' . substr($fec, 0, 4);
    }

    public static function mostrarFechaLetras($fec) {
        if (trim($fec) == '') {
            return '';
        }
        $fec = str_replace(array('-', '/'), "", $fec);
        if (trim($fec) == '') {
            return '';
        }
        $txt = '';
        $mes = substr($fec, 4, 2);
        switch ($mes) {
            case "01": $txt = 'enero';
                break;
            case "02": $txt = 'febrero';
                break;
            case "03": $txt = 'marzo';
                break;
            case "04": $txt = 'abril';
                break;
            case "05": $txt = 'mayo';
                break;
            case "06": $txt = 'junio';
                break;
            case "07": $txt = 'julio';
                break;
            case "08": $txt = 'agosto';
                break;
            case "09": $txt = 'septiembre';
                break;
            case "10": $txt = 'octubre';
                break;
            case "11": $txt = 'noviembre';
                break;
            case "12": $txt = 'diciembre';
                break;
        }
        if (strlen($fec) == 6) {
            return $txt . ' ' . ' de ' . substr($fec, 0, 4);
        } else {
            return $txt . ' ' . substr($fec, 6, 2) . ' de ' . substr($fec, 0, 4);
        }
    }

    public static function mostrarFechaLetras1($fec) {
        if (trim($fec) == '') {
            return '';
        }
        $fec = str_replace(array('-', '/'), "", $fec);
        if (trim($fec) == '') {
            return '';
        }
        $txt = '';
        $mes = substr($fec, 4, 2);
        switch ($mes) {
            case "01": $txt = 'enero';
                break;
            case "02": $txt = 'febrero';
                break;
            case "03": $txt = 'marzo';
                break;
            case "04": $txt = 'abril';
                break;
            case "05": $txt = 'mayo';
                break;
            case "06": $txt = 'junio';
                break;
            case "07": $txt = 'julio';
                break;
            case "08": $txt = 'agosto';
                break;
            case "09": $txt = 'septiembre';
                break;
            case "10": $txt = 'octubre';
                break;
            case "11": $txt = 'noviembre';
                break;
            case "12": $txt = 'diciembre';
                break;
        }
        if (strlen($fec) == 6) {
            return $txt . ' ' . ' de ' . substr($fec, 0, 4);
        } else {
            return substr($fec, 6, 2) . ' de ' . $txt . ' de ' . substr($fec, 0, 4);
        }
    }

    public static function mostrarHora($dat) {
        $dat = str_replace(":", "", $dat);
        if ((trim($dat) == '') || (ltrim($dat, "0") == '')) {
            return '';
        }
        if (strlen($dat) == 6) {
            return substr($dat, 0, 2) . ':' . substr($dat, 2, 2) . ':' . substr($dat, 4, 2);
        } else {
            if (strlen($dat) == 4) {
                return substr($dat, 0, 2) . ':' . substr($dat, 2, 2) . ':00';
            } else {
                return $dat;
            }
        }
    }

    public static function mostrarPesos2($var) {
        if (trim($var) == '') {
            return "-o-";
        }
        if (!is_numeric($var)) {
            return "-o-";
        }
        return "$" . number_format($var, 2, ",", ".");
    }

    public static function ordenarMatriz($arreglo, $campo, $inverse = false) {
        $position = array();
        $newRow = array();
        foreach ($arreglo as $key => $row) {
            $position[$key] = $row[$campo];
            $newRow[$key] = $row;
        }
        if ($inverse) {
            arsort($position);
        } else {
            asort($position);
        }
        $returnArray = array();
        foreach ($position as $key => $pos) {
            $returnArray[] = $newRow[$key];
        }
        return $returnArray;
    }

    public static function programarAlertaTempranaSii($dbx, $tiporegistro, $liquidacion, $matricula, $proponente, $tipotramite) {

        //
        if ($_SESSION["generales"]["tipousuario"] == '00' || $_SESSION["generales"]["tipousuario"] == '06') {
            if (trim($_SESSION["generales"]["emailusuariocontrol"]) != '') {
                $resEmail = retornarRegistroMysqli2($dbx, 'mreg_email_excluidos_alertas_tempranas', "email='" . $_SESSION["generales"]["emailusuariocontrol"] . "'");
                $res = retornarRegistroMysqli2($dbx, 'mreg_alertas_tempranas', "idliquidacion=" . $liquidacion);
                if ($res === false || empty($res)) {
                    if ($tiporegistro == 'RegPro') {
                        $arrExp = retornarRegistroMysqli2($dbx, 'mreg_est_proponentes', "proponente='" . $proponente . "'");
                        if ($arrExp && !empty($arrExp)) {
                            $arrExp["razonsocial"] = $arrExp["nombre"];
                        }
                    } else {
                        $arrExp = retornarRegistroMysqli2($dbx, 'mreg_est_inscritos', "matricula='" . $matricula . "'");
                    }
                    if ($arrExp && !empty($arrExp)) {
                        $email = '';
                        $email = $arrExp["emailnot"];
                        if ($email == '') {
                            $email = $arrExp["emailcom"];
                        }
                        if (trim($email) != '') {
                            $asunto = 'Alerta temprana por acceso al expediente No. ' . trim($matricula . $proponente) . ' en la ' . RAZONSOCIAL;
                            $detalle = 'Señor(es)<br>';
                            $detalle .= $arrExp["razonsocial"] . '<br><br>';
                            $detalle .= 'Nos permitimos informarle que el día ' . date("Y-m-d") . ' a las ' . date("H:i:s") . ' ';
                            $detalle .= 'se solicitó en los sistemas de registro que administra la ' . RAZONSOCIAL . ' el siguiente trámite:<br><br>';
                            $detalle .= '- Expediente : ' . $matricula . $proponente . '<br>';
                            $detalle .= '- Trámite solicitado : ' . $tipotramite . '<br>';
                            $detalle .= '- Email del usuario que solicita el trámite : ' . $_SESSION["generales"]["emailusuariocontrol"] . '<br>';
                            $detalle .= '- Ip del usuario : ' . \funcionesSii2::localizarIP() . '<br><br>';
                            $detalle .= 'Esta alerta se genera en cumplimiento de lo establecido en la Circular 002 de 2016 expedida por la ';
                            $detalle .= 'Superintendencia de Industria y Comercio, numeral 1.14.<br><br>';
                            $detalle .= 'Cordialmente<br><br>';
                            $detalle .= 'Area de Registros Públicos<br>';
                            $detalle .= RAZONSOCIAL;

                            $arrCampos = array(
                                'idliquidacion',
                                'matricula',
                                'proponente',
                                'fecha',
                                'hora',
                                'email',
                                'celular',
                                'usuario',
                                'tipotramite',
                                'ip',
                                'textoalerta',
                                'estado'
                            );
                            $arrValores = array(
                                $liquidacion,
                                "'" . $matricula . "'",
                                "'" . $proponente . "'",
                                "'" . date("Ymd") . "'",
                                "'" . date("His") . "'",
                                "'" . addslashes($email) . "'",
                                "''", // celular
                                "'" . addslashes($_SESSION["generales"]["emailusuariocontrol"]) . "'",
                                "'" . $tipotramite . "'",
                                "'" . \funcionesSii2::localizarIP() . "'",
                                "'" . addslashes($detalle) . "'",
                                "'1'" // programada
                            );
                            insertarRegistrosMysqli2($dbx, 'mreg_alertas_tempranas', $arrCampos, $arrValores);

                            if (!defined('TIPO_AMBIENTE')) {
                                define('TIPO_AMBIENTE', 'PRUEBAS');
                            }
                            if (TIPO_AMBIENTE == 'PRODUCCION') {
                                if (!$resEmail || empty($resEmail)) {
                                    if ($_SESSION["generales"]["emailusuariocontrol"] != 'prueba@prueba.prueba') {
                                        $res = \funcionesSii2::enviarEmailSii2(SERVER_SMTP, SMTP_PORT, REQUIERE_SMTP_AUTENTICACION, SMTP_TIPO_ENCRIPCION, CUENTA_ADMIN_PORTAL, CLAVE_ADMIN_PORTAL, EMAIL_ADMIN_PORTAL, NOMBRE_ADMIN_PORTAL, $email, $asunto, $detalle);
                                    }
                                }
                            } else {
                                if ($_SESSION["generales"]["emailusuariocontrol"] != 'prueba@prueba.prueba') {
                                    if (isset($resEmail) && !empty($resEmail)) {
                                        $res = \funcionesSii2::enviarEmailSii2(SERVER_SMTP, SMTP_PORT, REQUIERE_SMTP_AUTENTICACION, SMTP_TIPO_ENCRIPCION, CUENTA_ADMIN_PORTAL, CLAVE_ADMIN_PORTAL, EMAIL_ADMIN_PORTAL, NOMBRE_ADMIN_PORTAL, $resEmail["email"], $asunto, $detalle);
                                    }
                                }
                            }
                            if ($res) {
                                $arrCampos = array(
                                    'estado'
                                );
                                $arrValores = array(
                                    "'3'" // Enviado con éxito
                                );
                                regrabarRegistrosMysqli2($dbx, 'mreg_alertas_tempranas', $arrCampos, $arrValores, "idliquidacion=" . $liquidacion);
                            } else {
                                $arrCampos = array(
                                    'estado'
                                );
                                $arrValores = array(
                                    "'4'" // Envio con error
                                );
                                regrabarRegistrosMysqli2($dbx, 'mreg_alertas_tempranas', $arrCampos, $arrValores, "idliquidacion=" . $liquidacion);
                            }
                        }
                    }
                }
            }
        }
    }

    public static function retornarSecuenciaSii($dbx, $sec) {
        $res = retornarRegistroMysqli2($dbx, 'secuencias', "tipo='" . $sec . "'");
        if ($res === false) {
            return false;
        }
        if (empty($res)) {
            $retornar = 0;
        } else {
            $retornar = $res["consecutivo"];
        }

        //
        $retornar++;

        //
        if ($sec == 'LIQUIDACION-REGISTROS') {
            $ok = 'no';
            while ($ok == 'no') {
                if (contarRegistrosMysqli2($dbx, 'mreg_liquidacion', "idliquidacion=" . $retornar) > 0) {
                    $retornar++;
                } else {
                    $arrCampos = array(
                        'idliquidacion',
                        'fecha',
                        'hora',
                        'idestado'
                    );
                    $arrValores = array(
                        $retornar,
                        "'" . date("Ymd") . "'",
                        "'" . date("H:i:s") . "'",
                        "'01'"
                    );
                    insertarRegistrosMysqli2($dbx, 'mreg_liquidacion', $arrCampos, $arrValores);
                    $ok = 'si';
                }
            }
        }

        if ($sec == 'DEVOLUCION-REGISTROS') {
            $ok = 'no';
            while ($ok == 'no') {
                if (contarRegistrosMysqli2($dbx, 'mreg_devoluciones_nueva', "iddevolucion=" . $retornar) > 0) {
                    $retornar++;
                } else {
                    $ok = 'si';
                }
            }
        }

        if ($sec == 'RADICACION-REPORTES-EE') {
            $ok = 'no';
            while ($ok == 'no') {
                if (contarRegistrosMyqli2($dbx, 'mreg_reportesradicados', "idradicacion='" . ltrim($retornar, "0") . "'") > 0) {
                    $retornar++;
                } else {
                    $ok = 'si';
                }
            }
        }

        if (empty($res)) {
            $arrCampos = array(
                'tipo',
                'consecutivo'
            );
            $arrValores = array(
                "'" . $sec . "'",
                $retornar
            );
            insertarRegistrosMyqli2($dbx, 'secuencias', $arrCampos, $arrValores);
        } else {
            $arrCampos = array(
                'consecutivo'
            );
            $arrValores = array(
                $retornar
            );
            regrabarRegistrosMysqli2($dbx, 'secuencias', $arrCampos, $arrValores, "tipo='" . $sec . "'");
        }

        //
        return $retornar;
    }

    public static function rutinaNotificarRadicacionSii($dbx, $recibo = '', $codbarras = '', $emailsentrada = array(), $celularesentrada = array(), $nameLog = '') {
        require_once ('LogSii2.class.php');
        ini_set('memory_limit', '1024M');

        if ($nameLog == '') {
            $nameLog = 'rutinaNotificarRadicacionSii_' . date("Ymd");
        }
        \logSii2::general2($nameLog, '', 'Ingreso a notificar radicacion  : ' . $recibo . ' /' . $codbarras);

        //
        $reg = false;
        $notificar = 'si';

        //
        if ($recibo == '' && $codbarras != '') {
            $temx = retornarRegistroMysqli2($dbx, 'mreg_est_codigosbarras', "codigobarras='" . $codbarras . "'");
            if ($temx && !empty($temx)) {
                if ($temx["recibo"] != '') {
                    $query = "recibo='" . $temx["recibo"] . "' and tipogasto IN ('0','4','6','8')";
                    $reg = retornarRegistroMysqli2($dbx, 'mreg_recibosgenerados', $query);
                }
            }
            \logSii2::general2($nameLog, '', 'Localizo recibo a traves del codigo de barras');
        }

        if ($recibo != '') {
            $query = "recibo='" . $recibo . "' and tipogasto IN ('0','4','6','8')";
            $reg = retornarRegistroMysqli2($dbx, 'mreg_recibosgenerados', $query);
            \logSii2::general2($nameLog, '', 'Localizo recibo a traves del nro de recibo');
        }

        //
        $resultadoRecibo = array();
        if ($reg && !empty($reg)) {

            $liq = retornarRegistroMysqli2($dbx, 'mreg_liquidacion', "numerorecibo='" . $reg["recibo"] . "'");

            $arrTemCB = retornarRegistroMysqli2($dbx, 'mreg_est_codigosbarras', "codigobarras='" . $reg["codigobarras"] . "'");
            if ($arrTemCB && !empty($arrTemCB)) {
                if ($arrTemCB["actoreparto"] == '07' || $arrTemCB["actoreparto"] == '29') {
                    $notificar = 'no';
                }
            } else {
                $notificar = 'no';
            }
            if ($notificar == 'no') {
                \logSii2::general2($nameLog, $liq["idliquidacion"], 'Código de barras no notificable  : ' . $reg["recibo"] . ' /' . $reg["codigobarras"]);
            }
            if ($notificar == 'si') {

                $bandejaDigitalizacion = '';
                $tt = retornarRegistroMysqli2($dbx, 'mreg_codrutas', "id='" . $arrTemCB["actoreparto"] . "'");
                if ($tt && !empty($tt)) {
                    $bandejaDigitalizacion = $tt["bandeja"];
                }

                //
                \logSii2::general2($nameLog, $liq["idliquidacion"], 'Notificaciones: Localizo recibo : ' . $reg["recibo"]);
                $resultadoRecibo["nrec"] = $reg["recibo"];
                $resultadoRecibo["cba"] = $reg["codigobarras"];
                $resultadoRecibo["ope"] = $reg["operacion"];
                $resultadoRecibo["fec"] = $reg["fecha"];
                $resultadoRecibo["hor"] = $reg["hora"];
                $resultadoRecibo["ide"] = $reg["identificacion"];
                $resultadoRecibo["nom"] = $reg["razonsocial"];
                $resultadoRecibo["mat"] = array();
                $resultadoRecibo["pro"] = '';
                $resultadoRecibo["ser"] = '';
                $resultadoRecibo["valor"] = $reg["valorneto"];
                $resultadoRecibo["tt"] = $reg["tipotramite"];
                $resultadoRecibo["emails"] = array();
                $resultadoRecibo["telefonos"] = array();

                //
                $resultadoRecibo["emails"][$reg["email"]] = $reg["email"];
                if ($reg["telefono1"] != '' && strlen($reg["telefono1"]) == 10 && substr($reg["telefono1"], 0, 1) == '3') {
                    $resultadoRecibo["telefonos"][$reg["telefono1"]] = $reg["telefono1"];
                }
                if ($reg["telefono2"] != '' && strlen($reg["telefono2"]) == 10 && substr($reg["telefono2"], 0, 1) == '3') {
                    $resultadoRecibo["telefonos"][$reg["telefono2"]] = $reg["telefono2"];
                }

                //
                if (empty($emailsentrada)) {
                    foreach ($emailsentrada as $e) {
                        if (!isset($resultadoRecibo["emails"][$e])) {
                            $resultadoRecibo["emails"][$e] = $e;
                        }
                    }
                }

                //
                if (empty($celularesentrada)) {
                    foreach ($celularesentrada as $e) {
                        if (!isset($resultadoRecibo["telefonos"][$e])) {
                            $resultadoRecibo["telefonos"][$e] = $e;
                        }
                    }
                }

                //
                $arrTem = retornarRegistrosMysqli2($dbx, 'mreg_recibosgenerados_detalle', "recibo='" . $reg["recibo"] . "'", "secuencia");
                $j = 0;
                if ($arrTem && !empty($arrTem)) {
                    foreach ($arrTem as $tx) {
                        $j++;
                        if ($j == 1) {
                            if ($tx["matricula"] != '' && substr($tx["matricula"], 0, 5) != 'NUEVA') {
                                $resultadoRecibo["mat"][$tx["matricula"]] = $tx["matricula"];
                            }
                            if ($tx["proponente"] != '') {
                                $resultadoRecibo["pro"] = $tx["proponente"];
                            }
                            $resultadoRecibo["ser"] = $tx["idservicio"];
                            \logSii2::general2($nameLog, $liq["idliquidacion"], 'Notificaciones: Localizo matricula : ' . $tx["matricula"]);
                            \logSii2::general2($nameLog, $liq["idliquidacion"], 'Notificaciones: Localizo servicio : ' . $tx["idservicio"]);
                        }
                    }
                }

                // ************************************************************************************************** //
                // 2017-12-15: JINT: Se notifica sin importar que sea a los emails del recibo y del código de barras
                // ************************************************************************************************** //
                // $arrTemCB = retornarRegistroMysqli($mysqli, 'mreg_est_codigosbarras', "codigobarras='" . $reg["codigobarras"] . "'");
                if ($arrTemCB["emailnot1"] != '') {
                    $resultadoRecibo["emails"][$arrTemCB["emailnot1"]] = $arrTemCB["emailnot1"];
                }
                if ($arrTemCB["emailnot2"] != '') {
                    $resultadoRecibo["emails"][$arrTemCB["emailnot2"]] = $arrTemCB["emailnot2"];
                }
                if ($arrTemCB["emailnot3"] != '') {
                    $resultadoRecibo["emails"][$arrTemCB["emailnot3"]] = $arrTemCB["emailnot3"];
                }
                if ($arrTemCB["celnot1"] != '' && strlen($arrTemCB["celnot1"]) == 10 && substr($arrTemCB["celnot1"], 0, 1) == '3') {
                    $resultadoRecibo["telefonos"][$arrTemCB["celnot1"]] = $arrTemCB["celnot1"];
                }
                if ($arrTemCB["celnot2"] != '' && strlen($arrTemCB["celnot2"]) == 10 && substr($arrTemCB["celnot2"], 0, 1) == '3') {
                    $resultadoRecibo["telefonos"][$arrTemCB["celnot2"]] = $arrTemCB["celnot2"];
                }
                if ($arrTemCB["celnot3"] != '' && strlen($arrTemCB["celnot3"]) == 10 && substr($arrTemCB["celnot3"], 0, 1) == '3') {
                    $resultadoRecibo["telefonos"][$arrTemCB["celnot3"]] = $arrTemCB["celnot3"];
                }

                // *********************************************************************************** //
                // Siempre y cuando no sea un embargo
                // *********************************************************************************** //            
                if (($arrTemCB["actoreparto"] != '07') && ($arrTemCB["actoreparto"] != '29')) {

                    // *********************************************************************************** //
                    // Busca cada expediente
                    // *********************************************************************************** //            
                    if (!empty($resultadoRecibo["mat"])) {
                        foreach ($resultadoRecibo["mat"] as $m) {
                            $exp = retornarRegistroMysqli2($dbx, 'mreg_est_inscritos', "matricula='" . $m . "'");

                            // *********************************************************************************** //
                            // Localiza emails y celulares actuales
                            // *********************************************************************************** //                                    
                            if ($exp && !empty($exp)) {
                                if (trim($exp["telcom1"]) != '' && strlen($exp["telcom1"]) == 10 && substr($exp["telcom1"], 0, 1) == '3') {
                                    $resultadoRecibo["telefonos"][$exp["telcom1"]] = $exp["telcom1"];
                                }
                                if (trim($exp["telcom2"]) != '' && strlen($exp["telcom2"]) == 10 && substr($exp["telcom2"], 0, 1) == '3') {
                                    $resultadoRecibo["telefonos"][$exp["telcom2"]] = $exp["telcom2"];
                                }
                                if (trim($exp["telcom3"]) != '' && strlen($exp["telcom3"]) == 10 && substr($exp["telcom3"], 0, 1) == '3') {
                                    $resultadoRecibo["telefonos"][$exp["telcom3"]] = $exp["telcom3"];
                                }
                                if (trim($exp["telnot"]) != '' && strlen($exp["telnot"]) == 10 && substr($exp["telnot"], 0, 1) == '3') {
                                    $resultadoRecibo["telefonos"][$exp["telnot"]] = $exp["telnot"];
                                }
                                if (trim($exp["telnot2"]) != '' && strlen($exp["telnot2"]) == 10 && substr($exp["telnot2"], 0, 1) == '3') {
                                    $resultadoRecibo["telefonos"][$exp["telnot2"]] = $exp["telnot2"];
                                }
                                if (trim($exp["telnot3"]) != '' && strlen($exp["telnot3"]) == 10 && substr($exp["telnot3"], 0, 1) == '3') {
                                    $resultadoRecibo["telefonos"][$exp["telnot3"]] = $exp["telnot3"];
                                }
                                if (trim($exp["emailcom"]) != '') {
                                    $resultadoRecibo["emails"][$exp["emailcom"]] = $exp["emailcom"];
                                }
                                if (trim($exp["emailcom2"]) != '') {
                                    $resultadoRecibo["emails"][$exp["emailcom2"]] = $exp["emailcom2"];
                                }
                                if (trim($exp["emailcom3"]) != '') {
                                    $resultadoRecibo["emails"][$exp["emailcom3"]] = $exp["emailcom3"];
                                }
                                if (trim($exp["emailnot"]) != '') {
                                    $resultadoRecibo["emails"][$exp["emailnot"]] = $exp["emailnot"];
                                }
                            }

                            // *********************************************************************************** //
                            // Localiza emails y celulares anteriores migrados del SIREP
                            // *********************************************************************************** //                                                            
                            $exps = retornarRegistrosMysqli2($dbx, 'mreg_est_campostablas', "tabla='200' and registro='" . ltrim($m, "0") . "'", "id");
                            if ($exps && !empty($exps)) {
                                foreach ($exps as $exps1) {
                                    if (trim($exps1["campo"]) == "EMAILCOM-ANTERIOR") {
                                        $resultadoRecibo["emails"][trim($exps1["contenido"])] = trim($exps1["contenido"]);
                                    }
                                    if (trim($exps1["campo"]) == "EMAILNOT-ANTERIOR") {
                                        $resultadoRecibo["emails"][trim($exps1["contenido"])] = trim($exps1["contenido"]);
                                    }
                                    if (trim($exps1["campo="]) == "CELCOM-ANTERIOR") {
                                        if (strlen(trim($exps1["contenido"])) == 10 && substr(trim($exps1["contenido"]), 0, 1) == '3') {
                                            $resultadoRecibo["telefonos"][trim($exps1["contenido"])] = trim($exps1["contenido"]);
                                        }
                                    }
                                    if (trim($exps1["campo"]) == "CELNOT-ANTERIOR") {
                                        if (strlen(trim($exps1["contenido"])) == 10 && substr(trim($exps1["contenido"]), 0, 1) == '3') {
                                            $resultadoRecibo["telefonos"][trim($exps1["contenido"])] = trim($exps1["contenido"]);
                                        }
                                    }
                                }
                            }

                            // *********************************************************************************** //
                            // Localiza emails y celulares modificados en mreg_campos_historicos_AAAA
                            // *********************************************************************************** //                                                            
                            $d = localizarCampoAnteriorTodosSii2($dbx, $m, 'telcom1');
                            foreach ($d as $d1) {
                                if (trim($d1) != '' && strlen($d1) == 10 && substr($d1, 0, 1) == '3') {
                                    $resultadoRecibo["telefonos"][trim($d1)] = trim($d1);
                                }
                            }
                            $d = localizarCampoAnteriorTodosSii2($dbx, $m, 'telcom2');
                            foreach ($d as $d1) {
                                if (trim($d1) != '' && strlen($d1) == 10 && substr($d1, 0, 1) == '3') {
                                    $resultadoRecibo["telefonos"][trim($d1)] = trim($d1);
                                }
                            }
                            $d = localizarCampoAnteriorTodosSii2($dbx, $m, 'telcom3');
                            foreach ($d as $d1) {
                                if (trim($d1) != '' && strlen($d1) == 10 && substr($d1, 0, 1) == '3') {
                                    $resultadoRecibo["telefonos"][trim($d1)] = trim($d1);
                                }
                            }
                            $d = localizarCampoAnteriorTodosSii2($dbx, $m, 'telnot');
                            foreach ($d as $d1) {
                                if (trim($d1) != '' && strlen($d1) == 10 && substr($d1, 0, 1) == '3') {
                                    $resultadoRecibo["telefonos"][trim($d1)] = trim($d1);
                                }
                            }
                            $d = localizarCampoAnteriorTodosSii2($dbx, $m, 'emailcom');
                            foreach ($d as $d1) {
                                $resultadoRecibo["emails"][trim($d1)] = trim($d1);
                            }
                            $d = localizarCampoAnteriorTodosSii2($dbx, $m, 'emailnot');
                            foreach ($d as $d1) {
                                $resultadoRecibo["emails"][trim($d1)] = trim($d1);
                            }
                        }
                    }
                }

                // Recupera números telefonicos y emails actuales - proponentes
                if ($resultadoRecibo["pro"] != '') {
                    $exp = retornarRegistroMysqli2($dbx, 'mreg_est_proponentes', "proponente='" . $resultadoRecibo["pro"] . "'");
                    if ($exp && !empty($exp)) {
                        if (trim($exp["telcom1"]) != '' && strlen($exp["telcom1"]) == 10 && substr($exp["telcom1"], 0, 1) == '3') {
                            $resultadoRecibo["telefonos"][$exp["telcom1"]] = $exp["telcom1"];
                        }
                        if (trim($exp["telcom2"]) != '' && strlen($exp["telcom2"]) == 10 && substr($exp["telcom2"], 0, 1) == '3') {
                            $resultadoRecibo["telefonos"][$exp["telcom2"]] = $exp["telcom2"];
                        }
                        if (trim($exp["celcom"]) != '' && strlen($exp["celcom"]) == 10 && substr($exp["celcom"], 0, 1) == '3') {
                            $resultadoRecibo["telefonos"][$exp["celcom"]] = $exp["celcom"];
                        }
                        if (trim($exp["telnot"]) != '' && strlen($exp["telnot"]) == 10 && substr($exp["telnot"], 0, 1) == '3') {
                            $resultadoRecibo["telefonos"][$exp["telnot"]] = $exp["telnot"];
                        }
                        if (trim($exp["telnot2"]) != '' && strlen($exp["telnot2"]) == 10 && substr($exp["telnot2"], 0, 1) == '3') {
                            $resultadoRecibo["telefonos"][$exp["telnot2"]] = $exp["telnot2"];
                        }
                        if (trim($exp["celnot"]) != '' && strlen($exp["celnot"]) == 10 && substr($exp["celnot"], 0, 1) == '3') {
                            $resultadoRecibo["telefonos"][$exp["celnot"]] = $exp["celnot"];
                        }
                        if (trim($exp["emailcom"]) != '') {
                            $resultadoRecibo["emails"][$exp["emailcom"]] = $exp["emailcom"];
                        }
                        if (trim($exp["emailnot"]) != '') {
                            $resultadoRecibo["emails"][$exp["emailnot"]] = $exp["emailnot"];
                        }
                    }
                }

                // recupera números y emails anteriores (proponentes)
                if ($resultadoRecibo["pro"] != '') {
                    $exps = retornarRegistrosMysqli2($dbx, 'mreg_est_campostablas', "tabla='032' and registro='" . ltrim($resultadoRecibo["pro"], "0") . "'", "id");
                    if ($exps && !empty($exps)) {
                        foreach ($exps as $exps1) {
                            if (trim($exps1["campo"]) == "EMAILCOM-ANTERIOR") {
                                $resultadoRecibo["emails"][trim($exps1["contenido"])] = trim($exps1["contenido"]);
                            }
                            if (trim($exps1["campo"]) == "EMAILNOT-ANTERIOR") {
                                $resultadoRecibo["emails"][trim($exps1["contenido"])] = trim($exps1["contenido"]);
                            }
                            if (trim($exps1["campo"]) == "CELCOM-ANTERIOR") {
                                if (strlen(trim($exps1["contenido"])) == 10 && substr(trim($exps1["contenido"]), 0, 1) == '3') {
                                    $resultadoRecibo["telefonos"][trim($exps1["contenido"])] = trim($exps1["contenido"]);
                                }
                            }
                            if (trim($exps1["campo"]) == "CELNOT-ANTERIOR") {
                                if (strlen(trim($exps1["contenido"])) == 10 && substr(trim($exps1["contenido"]), 0, 1) == '3') {
                                    $resultadoRecibo["telefonos"][trim($exps1["contenido"])] = trim($exps1["contenido"]);
                                }
                            }
                        }
                    }
                }

                unset($reg);
                unset($reg1);

                //
                //
                \logSii2::general2($nameLog, $liq["idliquidacion"], 'Notificaciones: Total emails : ' . count($resultadoRecibo["emails"]));
                \logSii2::general2($nameLog, $liq["idliquidacion"], 'Notificaciones: Total celulares : ' . count($resultadoRecibo["telefonos"]));

                //
                \logSii2::general2($nameLog, $liq["idliquidacion"], 'Notificaciones: Servicio base ' . $resultadoRecibo["ser"]);
                $sinemails = 0;

                if (count($resultadoRecibo["emails"]) == 0) {
                    $arrCampos = array('estadoemail');
                    $arrValores = array("'2'");
                    regrabarRegistrosMysqli2($dbx, 'mreg_recibosgenerados', $arrCampos, $arrValores, "recibo='" . $resultadoRecibo["nrec"] . "'");
                    $sinemails++;
                } else {
                    $msg = '';
                    $msg .= 'LA ' . RAZONSOCIAL . ' le informa que el dia ' . mostrarFecha2Sii2($resultadoRecibo["fec"]) . ' a las ' . mostrarHoraSii2($resultadoRecibo["hor"]) . ' ';
                    $msg .= 'fue radicada en nuestras oficinas una transaccion sujeta a registro en los registros publicos que ';
                    $msg .= 'administra y maneja nuestra entidad. Los datos del tramite radicado son los siguientes:<br><br>';
                    $msg .= 'Recibo de Caja No. ' . $resultadoRecibo["nrec"] . '<br>';
                    $msg .= 'Numero operacion: ' . $resultadoRecibo["ope"] . '<br>';
                    if (ltrim($resultadoRecibo["cba"], "0") != '') {
                        $msg .= 'Codigo de barras: ' . $resultadoRecibo["cba"] . '<br>';
                    }
                    // $msg .= 'Expediente: ' . $resultadoRecibo["mat"] . '/' . $resultadoRecibo["pro"] . '<br>';
                    $mats = '';
                    if (!empty($resultadoRecibo["mat"])) {
                        foreach ($resultadoRecibo["mat"] as $mt1) {
                            if ($mats != '') {
                                $mats .= ', ';
                            }
                            $mats .= $mt1;
                        }
                    }
                    if ($mats != '') {
                        $msg .= 'Matriculas/Inscripciones: ' . $mats . '<br>';
                    }
                    if (ltrim($resultadoRecibo["pro"], "0") != '') {
                        $msg .= 'Proponente: ' . $resultadoRecibo["pro"] . '<br>';
                    }

                    $msg .= 'Identificacion: ' . $resultadoRecibo["ide"] . '<br>';
                    $msg .= 'Nombre: ' . \funcionesGenerales::utf8_decode($resultadoRecibo["nom"]) . '<br>';
                    $msg .= 'Tramite: ' . retornarRegistroMysqli2($dbx, 'mreg_servicios', "idservicio='" . $resultadoRecibo["ser"] . "'", "nombre") . '<br>';
                    foreach ($resultadoRecibo["emails"] as $emx) {
                        $msg .= 'Email : ' . $emx . '<br>';
                    }
                    $msg .= '<br>';
                    $msg .= 'Valor de la transaccion: ' . $resultadoRecibo["valor"] . '<br><br>';

                    if (!defined('NOTIFICAR_TELEFONO')) {
                        define('NOTIFICAR_TELEFONO', 'NO');
                    }
                    if (NOTIFICAR_TELEFONO == 'SI') {
                        $msg .= 'Si tiene alguna duda o inquietud con el contenido de esta notificacion, puede comunicarse al ';
                        $msg .= 'numero ' . TELEFONO_ATENCION_USUARIOS . ' en la ciudad de ' . retornarRegistroMysqli2($dbx, 'bas_municipios', "codigomunicipio='" . MUNICIPIO . "'", "ciudad") . ' ';
                        $msg .= 'citando el tramite (recibo de caja) No. ' . $resultadoRecibo["nrec"] . '<br><br>';
                    }

                    $msg .= 'Este mensaje se envia en forma automatica por el Sistema de Registro de LA ' . RAZONSOCIAL . ' ';
                    $msg .= 'en cumplimiento a lo contemplado en el Codigo de Procedimiento Administrativo y de lo Contencioso Administrativo.';
                    $msg .= '<br><br>';
                    $msg .= 'Correo desatendido: Por favor no responda a la direccion de correo electronico que envia este mensaje, dicha cuenta ';
                    $msg .= 'no es revisada por ningun funcionario de nuestra entidad. Este mensaje es informativo.';
                    $msg .= '<br><br>';
                    $msg .= 'Los acentos y tildes de este correo han sido omitidos intencionalmente con el objeto de evitar inconvenientes en la lectura del mismo.';

                    // ***************************************************************************************** //
                    // En caso de renovación que se asienta automáticamente
                    // ***************************************************************************************** //
                    $msg1 = '';
                    $msg1 .= 'LA ' . RAZONSOCIAL . ' le informa que el dia ' . mostrarFechaSii2($resultadoRecibo["fec"]) . ' a las ' . mostrarHoraSii2($resultadoRecibo["hor"]) . ' ';
                    $msg1 .= 'fue asentada en los registros publicos que ';
                    $msg1 .= 'administra y maneja nuestra organizacion una renovacion con la siguiente informacion: <br><br>';
                    $msg1 .= 'Recibo de Caja No. ' . $resultadoRecibo["nrec"] . '<br>';
                    $msg1 .= 'Numero operacion: ' . $resultadoRecibo["ope"] . '<br>';
                    if (ltrim($resultadoRecibo["cba"], "0") != '') {
                        $msg1 .= 'Codigo de barras: ' . $resultadoRecibo["cba"] . '<br>';
                    }
                    // $msg1 .= 'Expediente: ' . $resultadoRecibo["mat"] . '/' . $resultadoRecibo["pro"] . '<br>';
                    $mats = '';
                    if (!empty($resultadoRecibo["mat"])) {
                        foreach ($resultadoRecibo["mat"] as $mt1) {
                            if ($mats != '') {
                                $mats .= ', ';
                            }
                            $mats .= $mt1;
                        }
                    }
                    if ($mats != '') {
                        $msg1 .= 'Matriculas/Inscripciones: ' . $mats . '<br>';
                    }
                    if (ltrim($resultadoRecibo["pro"], "0") != '') {
                        $msg1 .= 'Proponente: ' . $resultadoRecibo["pro"] . '<br>';
                    }

                    $msg1 .= 'Identificacion: ' . $resultadoRecibo["ide"] . '<br>';
                    $msg1 .= 'Nombre: ' . \funcionesGenerales::utf8_decode($resultadoRecibo["nom"]) . '<br>';
                    $msg1 .= 'Tramite: ' . retornarRegistroMysqli2($dbx, 'mreg_servicios', "idservicio='" . $resultadoRecibo["ser"] . "'", "nombre") . '<br>';
                    foreach ($resultadoRecibo["emails"] as $emx) {
                        $msg1 .= 'Email : ' . $emx . '<br>';
                    }
                    $msg1 .= '<br>';
                    $msg1 .= 'Valor de la transaccion: ' . $resultadoRecibo["valor"] . '<br><br>';

                    if (!defined('NOTIFICAR_TELEFONO')) {
                        define('NOTIFICAR_TELEFONO', 'NO');
                    }
                    if (NOTIFICAR_TELEFONO == 'SI') {
                        $msg1 .= 'Si tiene alguna duda o inquietud con el contenido de esta notificacion, puede comunicarse al ';
                        $msg1 .= 'numero ' . TELEFONO_ATENCION_USUARIOS . ' en la ciudad de ' . retornarRegistroMysqli2($dbx, 'bas_municipios', "codigomunicipio='" . MUNICIPIO . "'", "ciudad") . ' ';
                        $msg1 .= 'citando el tramite (recibo de caja) No. ' . $resultadoRecibo["nrec"] . '<br><br>';
                    }

                    $msg1 .= 'Este mensaje se envia en forma automatica por el Sistema de Registro de LA ' . RAZONSOCIAL . ' ';
                    $msg1 .= 'en cumplimiento a lo contemplado en el Codigo de Procedimiento Administrativo y de lo Contencioso Administrativo.';
                    $msg1 .= '<br><br>';
                    $msg1 .= 'Correo desatendido: Por favor no responda a la direccion de correo electronico que envia este mensaje, dicha cuenta ';
                    $msg1 .= 'no es revisada por ningun funcionario de nuestra entidad. Este mensaje es informativo.';
                    $msg1 .= '<br><br>';
                    $msg1 .= 'Los acentos y tildes de este correo han sido omitidos intencionalmente con el objeto de evitar inconvenientes en la lectura del mismo.';

                    //
                    $emailtotales = 0;
                    $emailvalidos = 0;
                    foreach ($resultadoRecibo["emails"] as $emx) {
                        if (trim($emx) != '') {
                            $emx1 = $emx;
                            if (TIPO_AMBIENTE == 'PRUEBAS') {
                                $emx1 = 'jint@confecamaras.org.co';
                            }
                            $emailtotales++;
                            if (validarEmailSii2($emx) === true) {

                                $rEmail = \funcionesSii2::enviarEmailSii2(SERVER_SMTP, SMTP_PORT, REQUIERE_SMTP_AUTENTICACION, SMTP_TIPO_ENCRIPCION, CUENTA_ADMIN_PORTAL, CLAVE_ADMIN_PORTAL, EMAIL_ADMIN_PORTAL, NOMBRE_ADMIN_PORTAL, $emx1, 'Notificacion de radicacion No. ' . $resultadoRecibo["nrec"] . ' en  LA ' . RAZONSOCIAL, $msg);
                                if ($resultadoRecibo["tt"] == 'renovacionmatricula' || $resultadoRecibo["tt"] == 'renovacionesadl') {
                                    if ($_SESSION["tramite"]["multadoponal"] != 'S' &&
                                            $_SESSION["tramite"]["multadoponal"] != 'L' &&
                                            $_SESSION["tramite"]["controlactividadaltoimpacto"] != 'S' &&
                                            ($_SESSION ["tramite"] ["cumplorequisitosbenley1780"] != 'S' ||
                                            $_SESSION ["tramite"] ["mantengorequisitosbenley1780"] != 'S' ||
                                            $_SESSION ["tramite"] ["renunciobeneficiosley1780"] != 'N')) {
                                        $rEmail1 = \funcionesSii2::enviarEmailSii2(SERVER_SMTP, SMTP_PORT, REQUIERE_SMTP_AUTENTICACION, SMTP_TIPO_ENCRIPCION, CUENTA_ADMIN_PORTAL, CLAVE_ADMIN_PORTAL, EMAIL_ADMIN_PORTAL, NOMBRE_ADMIN_PORTAL, $emx1, 'Notificacion de asentamiento No. ' . $resultadoRecibo["nrec"] . ' en  LA ' . RAZONSOCIAL, $msg1);
                                    } else {
                                        unset($rEmail1);
                                    }
                                } else {
                                    unset($rEmail1);
                                }
                                foreach ($resultadoRecibo["mat"] as $mt1) {
                                    if ($rEmail === false) {
                                        \funcionesSii2::actualizarMregNotificacionesParaEnviarEmailSii($dbx, '01', $resultadoRecibo["cba"], '', $resultadoRecibo["ope"], $resultadoRecibo["nrec"], '', '', '', '', $resultadoRecibo["ide"], $mt1, $resultadoRecibo["pro"], $resultadoRecibo["nom"], $emx, $msg, date("Ymd"), date("His"), date("Ymd"), date("His"), '2', '** ERROR : ' . $_SESSION["generales"]["mensajeerror"], $bandejaDigitalizacion);
                                    } else {
                                        \funcionesSii2::actualizarMregNotificacionesParaEnviarEmailSii($dbx, '01', $resultadoRecibo["cba"], '', $resultadoRecibo["ope"], $resultadoRecibo["nrec"], '', '', '', '', $resultadoRecibo["ide"], $mt1, $resultadoRecibo["pro"], $resultadoRecibo["nom"], $emx, $msg, date("Ymd"), date("His"), date("Ymd"), date("His"), '3', '**OK **', $bandejaDigitalizacion);
                                    }
                                    if (isset($rEmail1)) {
                                        if ($rEmail1 === false) {
                                            \funcionesSii2::actualizarMregNotificacionesParaEnviarEmailSii($dbx, '10', $resultadoRecibo["cba"], '', $resultadoRecibo["ope"], $resultadoRecibo["nrec"], '', '', '', '', $resultadoRecibo["ide"], $mt1, $resultadoRecibo["pro"], $resultadoRecibo["nom"], $emx, $msg1, date("Ymd"), date("His"), date("Ymd"), date("His"), '2', '** ERROR : ' . $_SESSION["generales"]["mensajeerror"], $bandejaDigitalizacion);
                                        } else {
                                            \funcionesSii2::actualizarMregNotificacionesParaEnviarEmailSii($dbx, '10', $resultadoRecibo["cba"], '', $resultadoRecibo["ope"], $resultadoRecibo["nrec"], '', '', '', '', $resultadoRecibo["ide"], $mt1, $resultadoRecibo["pro"], $resultadoRecibo["nom"], $emx, $msg1, date("Ymd"), date("His"), date("Ymd"), date("His"), '3', '**OK **', $bandejaDigitalizacion);
                                        }
                                    }
                                }
                                if ($rEmail) {
                                    $emailvalidos++;
                                }
                            }
                        }
                    }

                    // Actualiza el estado de la notificacion en SIREP
                    if ($emailvalidos == 0) {
                        if (NOTIFICAR_RADICACION == 'SI') {
                            $arrCampos = array('estadoemail');
                            $arrValores = array("'2'");
                            regrabarRegistrosMysqli2($dbx, 'mreg_recibosgenerados', $arrCampos, $arrValores, "recibo='" . $resultadoRecibo["nrec"] . "'");
                        }
                    }

                    if ($emailvalidos > 0) {
                        if (NOTIFICAR_RADICACION == 'SI') {
                            $arrCampos = array('estadoemail');
                            $arrValores = array("'1'");
                            regrabarRegistrosMysqli2($dbx, 'mreg_recibosgenerados', $arrCampos, $arrValores, "recibo='" . $resultadoRecibo["nrec"] . "'");
                        }
                    }
                }


                if (count($resultadoRecibo["telefonos"]) == 0) {
                    if (NOTIFICAR_RADICACION == 'SI') {
                        $arrCampos = array('estadosms');
                        $arrValores = array("'2'");
                        regrabarRegistrosMysqli2($dbx, 'mreg_recibosgenerados', $arrCampos, $arrValores, "recibo='" . $resultadoRecibo["nrec"] . "'");
                    }
                } else {
                    $mt1 = '';
                    foreach ($resultadoRecibo["mat"] as $mx) {
                        if ($mt1 == '') {
                            $mt1 = $mx;
                        }
                    }

                    if (defined('RAZONSOCIALSMS') && trim(RAZONSOCIALSMS) != '') {
                        $txtSms = 'La ' . RAZONSOCIALSMS . ' le informa que el ' . mostrarFechaSii2($resultadoRecibo["fec"]) . ' a las ' . mostrarHoraSii2($resultadoRecibo["hor"]) . ' se radico una transaccion para el expediente ' . ltrim($mt1, "0") . ltrim($resultadoRecibo["pro"], "0");
                    } else {
                        $txtSms = 'La ' . RAZONSOCIAL . ' le informa que el ' . mostrarFechaSii2($resultadoRecibo["fec"]) . ' a las ' . mostrarHoraSii2($resultadoRecibo["hor"]) . ' se radico una transaccion para el expediente ' . ltrim($mt1, "0") . ltrim($resultadoRecibo["pro"], "0");
                    }

                    if (defined('RAZONSOCIALSMS') && trim(RAZONSOCIALSMS) != '') {
                        $txtSms1 = 'La ' . RAZONSOCIALSMS . ' le informa que el ' . mostrarFechaSii2($resultadoRecibo["fec"]) . ' a las ' . mostrarHoraSii2($resultadoRecibo["hor"]) . ' se asento la renovacion del expediente ' . ltrim($mt1, "0") . ltrim($resultadoRecibo["pro"], "0");
                    } else {
                        $txtSms1 = 'La ' . RAZONSOCIAL . ' le informa que el ' . mostrarFechaSii2($resultadoRecibo["fec"]) . ' a las ' . mostrarHoraSii2($resultadoRecibo["hor"]) . ' se asento la renovacion del expediente ' . ltrim($mt1, "0") . ltrim($resultadoRecibo["pro"], "0");
                    }

                    foreach ($resultadoRecibo["telefonos"] as $t) {
                        $exp1 = '';
                        if (ltrim($mt1, "0") != '') {
                            $exp1 = $mt1;
                        }
                        if (ltrim($resultadoRecibo["pro"], "0") != '') {
                            $exp1 = $resultadoRecibo["pro"];
                        }
                        \funcionesSii2::actualizarPilaSmsSii($dbx, $t, '1', $resultadoRecibo["nrec"], $resultadoRecibo["cba"], '', '', $exp1, $mt1, $resultadoRecibo["pro"], $resultadoRecibo["ide"], $resultadoRecibo["nom"], $txtSms, '', $bandejaDigitalizacion);
                        if ($resultadoRecibo["tt"] == 'renovacionmatricula' || $resultadoRecibo["tt"] == 'renovacionesadl') {
                            if ($_SESSION["tramite"]["multadoponal"] != 'S' &&
                                    $_SESSION["tramite"]["multadoponal"] != 'L' &&
                                    $_SESSION["tramite"]["controlactividadaltoimpacto"] != 'S' &&
                                    ($_SESSION ["tramite"] ["cumplorequisitosbenley1780"] != 'S' ||
                                    $_SESSION ["tramite"] ["mantengorequisitosbenley1780"] != 'S' ||
                                    $_SESSION ["tramite"] ["renunciobeneficiosley1780"] != 'N')) {
                                \funcionesSii2::actualizarPilaSmsSii($dbx, $t, '10', $resultadoRecibo["nrec"], $resultadoRecibo["cba"], '', '', $exp1, $mt1, $resultadoRecibo["pro"], $resultadoRecibo["ide"], $resultadoRecibo["nom"], $txtSms1, '', $bandejaDigitalizacion);
                            }
                        }
                    }

                    $arrCampos = array('estadosms');
                    $arrValores = array("'1'");
                    regrabarRegistrosMysqli2($dbx, 'mreg_recibosgenerados', $arrCampos, $arrValores, "recibo='" . $resultadoRecibo["nrec"] . "'");
                }
            }
        }
    }

    public static function quitarCaracteresDireccion($txt) {

        $patronesLetraNum[0] = '[^a-zA-Z0-9 ]';
        $reemplazos1[0] = '';
        $txt_tmp = trim(preg_replace($patronesLetraNum, $reemplazos1, $txt));

        $patronesSimbolos[0] = '[^.-#ºª?°]';
        $reemplazos2[0] = '';
        return trim(preg_replace($patronesSimbolos, $reemplazos2, $txt_tmp));
    }

    public static function reemplazarInvertidos($txt) {

        $txt = str_replace("À", "Á", $txt);
        $txt = str_replace("È", "É", $txt);
        $txt = str_replace("Ì", "Í", $txt);
        $txt = str_replace("Ò", "Ó", $txt);
        $txt = str_replace("Ù", "Ú", $txt);

        $txt = str_replace("à", "á", $txt);
        $txt = str_replace("è", "é", $txt);
        $txt = str_replace("ì", "í", $txt);
        $txt = str_replace("ò", "ó", $txt);
        $txt = str_replace("ù", "ú", $txt);

        $txt = str_replace("©", "@", $txt);

        return $txt;
    }

    /**
     * Funci&oacute;n que recibe un texto y reemplaza caracteres especiales por tags
     * Utilizado para enviar la informaci&oacute;n al SIREP
     *
     * @param 	string		$txt	Texto a convertir
     * @return 	string				Texto convertido
     */
    public static function reemplazarEspeciales($txt) {

        //
        $txt = str_replace("\"", "[0]", $txt);
        $txt = str_replace("'", "[1]", $txt);
        $txt = str_replace("&", "[2]", $txt);
        // $txt = str_replace("?", "[3]", $txt);
        $txt = str_replace("á", "[4]", $txt);
        $txt = str_replace("é", "[5]", $txt);
        $txt = str_replace("í", "[6]", $txt);
        $txt = str_replace("ó", "[7]", $txt);
        $txt = str_replace("ú", "[8]", $txt);
        $txt = str_replace("ñ", "[9]", $txt);
        $txt = str_replace("Ñ", "[10]", $txt);
        // $txt = str_replace("+", "[11]", $txt);
        // $txt = str_replace("#", "[12]", $txt);
        $txt = str_replace("Á", "[13]", $txt);
        $txt = str_replace("É", "[14]", $txt);
        $txt = str_replace("Í", "[15]", $txt);
        $txt = str_replace("Ó", "[16]", $txt);
        $txt = str_replace("Ú", "[17]", $txt);
        $txt = str_replace("Ü", "[18]", $txt);
        $txt = str_replace("º", "[19]", $txt);
        $txt = str_replace("°", "[20]", $txt);
        //
        $txt = str_replace("ª", "[21]", $txt);
        $txt = str_replace("!", "[22]", $txt);
        $txt = str_replace("¡", "[23]", $txt);
        $txt = str_replace("'", "[24]", $txt);
        $txt = str_replace("´", "[25]", $txt);
        $txt = str_replace("`", "[26]", $txt);
        //
        $txt = str_replace("À", "[28]", $txt);
        $txt = str_replace("È", "[29]", $txt);
        $txt = str_replace("Ì", "[30]", $txt);
        $txt = str_replace("Ò", "[31]", $txt);
        $txt = str_replace("Ù", "[32]", $txt);
        //
        $txt = str_replace("à", "[33]", $txt);
        $txt = str_replace("è", "[34]", $txt);
        $txt = str_replace("ì", "[35]", $txt);
        $txt = str_replace("ò", "[36]", $txt);
        $txt = str_replace("ù", "[37]", $txt);

        //
        $txt = str_replace("©", "@", $txt);

        //             
        $txt = str_replace("[SALTOPARRAFO]", "", $txt);



        return $txt;
    }

    /**
     * Funci&oacute;n que recibe un texto y reemplaza caracteres especiales por tags
     * Utilizado para enviar la informaci&oacute;n al SIREP
     *
     * @param 	string		$txt	Texto a convertir
     * @return 	string				Texto convertido
     */
    public static function reemplazarEspecialesDom($txt) {
        $txt = str_replace("&", "[2]", $txt);
        $txt = str_replace("á", "[4]", $txt);
        $txt = str_replace("é", "[5]", $txt);
        $txt = str_replace("í", "[6]", $txt);
        $txt = str_replace("ó", "[7]", $txt);
        $txt = str_replace("ú", "[8]", $txt);
        $txt = str_replace("ñ", "[9]", $txt);
        $txt = str_replace("Ñ", "[10]", $txt);
        $txt = str_replace("Á", "[13]", $txt);
        $txt = str_replace("É", "[14]", $txt);
        $txt = str_replace("Í", "[15]", $txt);
        $txt = str_replace("Ó", "[16]", $txt);
        $txt = str_replace("Ú", "[17]", $txt);
        $txt = str_replace("Ü", "[18]", $txt);
        $txt = str_replace("º", "[19]", $txt);
        $txt = str_replace("°", "[20]", $txt);
        //
        $txt = str_replace("ª", "[21]", $txt);
        // $txt = str_replace("!", "[22]", $txt);
        $txt = str_replace("¡", "[23]", $txt);
        $txt = str_replace("'", "[24]", $txt);
        $txt = str_replace("´", "[25]", $txt);
        $txt = str_replace("`", "[26]", $txt);
        //
        $txt = str_replace("À", "[28]", $txt);
        $txt = str_replace("È", "[29]", $txt);
        $txt = str_replace("Ì", "[30]", $txt);
        $txt = str_replace("Ò", "[31]", $txt);
        $txt = str_replace("Ù", "[32]", $txt);
        //
        $txt = str_replace("à", "[33]", $txt);
        $txt = str_replace("è", "[34]", $txt);
        $txt = str_replace("ì", "[35]", $txt);
        $txt = str_replace("ò", "[36]", $txt);
        $txt = str_replace("ù", "[37]", $txt);
        //
        return $txt;
    }

    public static function reemplazarEspecialesDomRee($txt) {
        $txt = str_replace("&", "[2]", $txt);
        $txt = str_replace("á", "[4]", $txt);
        $txt = str_replace("é", "[5]", $txt);
        $txt = str_replace("í", "[6]", $txt);
        $txt = str_replace("ó", "[7]", $txt);
        $txt = str_replace("ú", "[8]", $txt);
        $txt = str_replace("ñ", "[9]", $txt);
        $txt = str_replace("Ñ", "[10]", $txt);
        $txt = str_replace("Á", "[13]", $txt);
        $txt = str_replace("É", "[14]", $txt);
        $txt = str_replace("Í", "[15]", $txt);
        $txt = str_replace("Ó", "[16]", $txt);
        $txt = str_replace("Ú", "[17]", $txt);
        $txt = str_replace("Ü", "[18]", $txt);
        $txt = str_replace("º", "[19]", $txt);
        $txt = str_replace("°", "[20]", $txt);
        //
        $txt = str_replace("ª", "[21]", $txt);
        // $txt = str_replace("!", "[22]", $txt);
        $txt = str_replace("¡", "[23]", $txt);
        // $txt = str_replace("'", "[24]", $txt);
        $txt = str_replace("´", "[25]", $txt);
        $txt = str_replace("`", "[26]", $txt);
        //
        $txt = str_replace("À", "[28]", $txt);
        $txt = str_replace("È", "[29]", $txt);
        $txt = str_replace("Ì", "[30]", $txt);
        $txt = str_replace("Ò", "[31]", $txt);
        $txt = str_replace("Ù", "[32]", $txt);
        //
        $txt = str_replace("à", "[33]", $txt);
        $txt = str_replace("è", "[34]", $txt);
        $txt = str_replace("ì", "[35]", $txt);
        $txt = str_replace("ò", "[36]", $txt);
        $txt = str_replace("ù", "[37]", $txt);
        //
        return $txt;
    }

    /**
     * Funci&oacute;n que recibe un texto y sustituye los tags por caracteres
     * Utilizado para recibir la informaci&oacute;n al SIREP
     *
     * @param 	string		$txt		Texto a convertir
     * @return 	string					RTexto convertido
     */
    public static function restaurarEspeciales($txt) {
        $txt = str_replace("[0]", "\"", $txt);
        $txt = str_replace("[1]", "'", $txt);
        $txt = str_replace("[2]", "&", $txt);
        $txt = str_replace("[3]", "?", $txt);
        $txt = str_replace("[4]", "á", $txt);
        $txt = str_replace("[5]", "é", $txt);
        $txt = str_replace("[6]", "í", $txt);
        $txt = str_replace("[7]", "ó", $txt);
        $txt = str_replace("[8]", "ú", $txt);
        $txt = str_replace("[9]", "ñ", $txt);
        $txt = str_replace("[10]", "Ñ", $txt);
        $txt = str_replace("[11]", "+", $txt);
        $txt = str_replace("[12]", "#", $txt);
        $txt = str_replace("[13]", "Á", $txt);
        $txt = str_replace("[14]", "É", $txt);
        $txt = str_replace("[15]", "Í", $txt);
        $txt = str_replace("[16]", "Ó", $txt);
        $txt = str_replace("[17]", "Ú", $txt);
        $txt = str_replace("[18]", "Ü", $txt);
        $txt = str_replace("[19]", "º", $txt);
        $txt = str_replace("[20]", "°", $txt);
        $txt = str_replace("[21]", "ª", $txt);
        //
        $txt = str_replace("[22]", "!", $txt);
        $txt = str_replace("[23]", "¡", $txt);
        $txt = str_replace("[24]", "'", $txt);
        $txt = str_replace("[25]", "´", $txt);
        $txt = str_replace("[26]", "`", $txt);
        //
        $txt = str_replace("[28]", "À", $txt);
        $txt = str_replace("[29]", "È", $txt);
        $txt = str_replace("[30]", "Ì", $txt);
        $txt = str_replace("[31]", "Ò", $txt);
        $txt = str_replace("[32]", "Ù", $txt);
        //
        $txt = str_replace("[33]", "à", $txt);
        $txt = str_replace("[34]", "è", $txt);
        $txt = str_replace("[35]", "ì", $txt);
        $txt = str_replace("[36]", "ò", $txt);
        $txt = str_replace("[37]", "ù", $txt);

        $txt = str_replace("[39]", "Ñ", $txt);
        //
        return $txt;
    }

    function restaurarEspecialesMayusculas($txt) {
        $txt = str_replace("[0]", "\"", $txt);
        $txt = str_replace("[1]", "'", $txt);
        $txt = str_replace("[2]", "&", $txt);
        $txt = str_replace("[3]", "?", $txt);
        $txt = str_replace("[4]", "Á", $txt);
        $txt = str_replace("[5]", "É", $txt);
        $txt = str_replace("[6]", "Í", $txt);
        $txt = str_replace("[7]", "Ó", $txt);
        $txt = str_replace("[8]", "Ú", $txt);
        $txt = str_replace("[9]", "Ñ", $txt);
        $txt = str_replace("[10]", "Ñ", $txt);
        $txt = str_replace("[11]", "+", $txt);
        $txt = str_replace("[12]", "#", $txt);
        $txt = str_replace("[13]", "Á", $txt);
        $txt = str_replace("[14]", "É", $txt);
        $txt = str_replace("[15]", "Í", $txt);
        $txt = str_replace("[16]", "Ó", $txt);
        $txt = str_replace("[17]", "Ú", $txt);
        $txt = str_replace("[18]", "Ü", $txt);
        $txt = str_replace("[19]", "º", $txt);
        $txt = str_replace("[20]", "°", $txt);
        $txt = str_replace("[21]", "ª", $txt);
        //
        $txt = str_replace("[22]", "!", $txt);
        $txt = str_replace("[23]", "¡", $txt);
        $txt = str_replace("[24]", "'", $txt);
        $txt = str_replace("[25]", "´", $txt);
        $txt = str_replace("[26]", "`", $txt);
        //
        $txt = str_replace("[28]", "À", $txt);
        $txt = str_replace("[29]", "È", $txt);
        $txt = str_replace("[30]", "Ì", $txt);
        $txt = str_replace("[31]", "Ò", $txt);
        $txt = str_replace("[32]", "Ù", $txt);
        //
        $txt = str_replace("[33]", "à", $txt);
        $txt = str_replace("[34]", "è", $txt);
        $txt = str_replace("[35]", "ì", $txt);
        $txt = str_replace("[36]", "ò", $txt);
        $txt = str_replace("[37]", "ù", $txt);

        $txt = str_replace("[39]", "Ñ", $txt);
        //
        return $txt;
    }

    public static function restaurarEspecialesSinTildes($txt) {
        $txt = str_replace("[0]", "\"", $txt);
        $txt = str_replace("[1]", "'", $txt);
        $txt = str_replace("[2]", "&", $txt);
        $txt = str_replace("[3]", "?", $txt);
        $txt = str_replace("[4]", "a", $txt);
        $txt = str_replace("[5]", "e", $txt);
        $txt = str_replace("[6]", "i", $txt);
        $txt = str_replace("[7]", "o", $txt);
        $txt = str_replace("[8]", "u", $txt);
        $txt = str_replace("[9]", "&ntilde;", $txt);
        $txt = str_replace("[10]", "&Ntilde;", $txt);
        $txt = str_replace("[11]", "+", $txt);
        $txt = str_replace("[12]", "#", $txt);
        $txt = str_replace("[13]", "A", $txt);
        $txt = str_replace("[14]", "E", $txt);
        $txt = str_replace("[15]", "I", $txt);
        $txt = str_replace("[16]", "O", $txt);
        $txt = str_replace("[17]", "U", $txt);
        $txt = str_replace("[18]", "Ü", $txt);
        $txt = str_replace("[19]", "º", $txt);
        $txt = str_replace("[20]", "°", $txt);
        //
        $txt = str_replace("[21]", "ª", $txt);
        $txt = str_replace("[22]", "!", $txt);
        $txt = str_replace("[23]", "¡", $txt);
        $txt = str_replace("[24]", "'", $txt);
        $txt = str_replace("[25]", "´", $txt);
        $txt = str_replace("[26]", "`", $txt);
        //
        $txt = str_replace("[28]", "A", $txt);
        $txt = str_replace("[29]", "E", $txt);
        $txt = str_replace("[30]", "I", $txt);
        $txt = str_replace("[31]", "O", $txt);
        $txt = str_replace("[32]", "U", $txt);
        //
        $txt = str_replace("[33]", "a", $txt);
        $txt = str_replace("[34]", "e", $txt);
        $txt = str_replace("[35]", "i", $txt);
        $txt = str_replace("[36]", "o", $txt);
        $txt = str_replace("[37]", "u", $txt);
        //
        return $txt;
    }

    /**
     * Funci&oacute;n que recibe un texto y sustituye los tags por caracteres
     * Utilizado para recibir la informaci&oacute;n al SIREP
     *
     * @param 	string		$txt		Texto a convertir
     * @return 	string					RTexto convertido
     */
    public static function restaurarEspecialesRazonSocial($txt) {
        $txt = str_replace("[0]", "", $txt);
        $txt = str_replace("[1]", "", $txt);
        $txt = str_replace("[2]", "&", $txt);
        $txt = str_replace("[3]", "?", $txt);
        $txt = str_replace("[4]", "á", $txt);
        $txt = str_replace("[5]", "é", $txt);
        $txt = str_replace("[6]", "í", $txt);
        $txt = str_replace("[7]", "ó", $txt);
        $txt = str_replace("[8]", "ú", $txt);
        $txt = str_replace("[9]", "ñ", $txt);
        $txt = str_replace("[10]", "Ñ", $txt);
        $txt = str_replace("[11]", "+", $txt);
        $txt = str_replace("[12]", "#", $txt);
        $txt = str_replace("[13]", "Á", $txt);
        $txt = str_replace("[14]", "É", $txt);
        $txt = str_replace("[15]", "Í", $txt);
        $txt = str_replace("[16]", "Ó", $txt);
        $txt = str_replace("[17]", "Ú", $txt);
        $txt = str_replace("[18]", "Ü", $txt);
        $txt = str_replace("[19]", "º", $txt);
        $txt = str_replace("[20]", "°", $txt);
        //
        $txt = str_replace("[21]", "ª", $txt);
        $txt = str_replace("[22]", "!", $txt);
        $txt = str_replace("[23]", "¡", $txt);
        $txt = str_replace("[24]", "'", $txt);
        $txt = str_replace("[25]", "´", $txt);
        $txt = str_replace("[26]", "`", $txt);
        //
        $txt = str_replace("[28]", "À", $txt);
        $txt = str_replace("[29]", "È", $txt);
        $txt = str_replace("[30]", "Ì", $txt);
        $txt = str_replace("[31]", "Ò", $txt);
        $txt = str_replace("[32]", "Ù", $txt);
        //
        $txt = str_replace("[33]", "à", $txt);
        $txt = str_replace("[34]", "è", $txt);
        $txt = str_replace("[35]", "ì", $txt);
        $txt = str_replace("[36]", "ò", $txt);
        $txt = str_replace("[37]", "ù", $txt);
        //
        return $txt;
    }

    /**
     * Funci&oacute;n que recibe un texto y reemplaza caracteres especiales por tags
     * Utilizado para enviar la informaci&oacute;n al SIREP
     *
     * @param 	string		$txt	Texto a convertir
     * @return 	string				Texto convertido
     */
    public static function reemplazarHtmlPdf($txt) {
        $txt = strip_tags($txt, "<p><ul><il>");
        $txt = str_replace("&nbsp;", " ", $txt);
        $txt = str_replace("&aacute;", "á", $txt);
        $txt = str_replace("&eacute;", "é", $txt);
        $txt = str_replace("&iacute;", "í", $txt);
        $txt = str_replace("&oacute;", "ó", $txt);
        $txt = str_replace("&uacute;", "ú", $txt);
        $txt = str_replace("&ntilde;", "ñ", $txt);
        $txt = str_replace("&Aacute;", "Á", $txt);
        $txt = str_replace("&Eacute;", "É", $txt);
        $txt = str_replace("&Iacute;", "Í", $txt);
        $txt = str_replace("&Oacute;", "Ó", $txt);
        $txt = str_replace("&Uacute;", "Ú", $txt);
        $txt = str_replace("&Ntilde;", "Ñ", $txt);
        $txt = str_replace("<p>", "", $txt);
        $txt = str_replace("</p>", chr(13) . chr(10), $txt);
        $txt = str_replace("<ul>", "*", $txt);
        $txt = str_replace("<il>", "*", $txt);
        return $txt;
    }

    public static function reemplazarHtml($txt) {
        $txt = str_replace("á", "&aacute;", $txt);
        $txt = str_replace("é", "&eacute;", $txt);
        $txt = str_replace("í", "&iacute;", $txt);
        $txt = str_replace("ó", "&oacute;", $txt);
        $txt = str_replace("ú", "&uacute;", $txt);
        $txt = str_replace("ñ", "&ntilde;", $txt);
        $txt = str_replace("Á", "&Aacute;", $txt);
        $txt = str_replace("É", "&Eacute;", $txt);
        $txt = str_replace("Í", "&Iacute;", $txt);
        $txt = str_replace("Ó", "&Oacute;", $txt);
        $txt = str_replace("Ú", "&Uacute;", $txt);
        $txt = str_replace("Ñ", "&Ntilde;", $txt);
        return $txt;
    }

    public static function quitarTildes($txt) {
        $txt = str_replace("á", "a", $txt);
        $txt = str_replace("é", "e", $txt);
        $txt = str_replace("í", "i", $txt);
        $txt = str_replace("ó", "o", $txt);
        $txt = str_replace("ú", "u", $txt);
        $txt = str_replace("ñ", "n", $txt);
        $txt = str_replace("Á", "A", $txt);
        $txt = str_replace("É", "E", $txt);
        $txt = str_replace("Í", "I", $txt);
        $txt = str_replace("Ó", "O", $txt);
        $txt = str_replace("Ú", "U", $txt);
        $txt = str_replace("Ñ", "N", $txt);
        return $txt;
    }

    public static function serializacionLineal($arr) {
        $sal = '';
        foreach ($arr as $key => $datos) {
            if (!is_array($datos)) {
                $sal .= '<' . $key . '><![CDATA[' . $datos . ']]></' . $key . '>';
            } else {
                $sal .= '<' . $key . '>';
                foreach ($datos as $key1 => $datos1) {
                    if (!is_array($datos1)) {
                        $sal .= '<' . $key1 . '><![CDATA[' . $datos1 . ']]></' . $key1 . '>';
                    } else {
                        $sal .= '<' . $key1 . '>';
                        foreach ($datos1 as $key2 => $datos2) {
                            if (!is_array($datos2)) {
                                $sal .= '<' . $key2 . '><![CDATA[' . $datos2 . ']]></' . $key2 . '>';
                            } else {
                                $sal .= '<' . $key2 . '>';
                                foreach ($datos2 as $key3 => $datos3) {
                                    $sal .= '<' . $key3 . '><![CDATA[' . $datos3 . ']]></' . $key3 . '>';
                                }
                                $sal .= '</' . $key2 . '>';
                            }
                        }
                        $sal .= '</' . $key1 . '>';
                    }
                }
                $sal .= '</' . $key . '>';
            }
        }
        return $sal;
    }

    public static function serializarExpedienteMatricula($dbx, $numrec = '', $datos = array(), $reemplazar = 'si', $extendido = 'si') {
        //
        $xml = '<?xml version="1.0" encoding="utf-8" ?>';
        $xml .= '<expedientes>';
        $xml .= '<error>0000</error>';
        $xml .= '<msgError>Registro serializado correctamente</msgError>';
        $xml .= '<expediente>';

        // Valida los datos conm nlos que debe trabajar
        if (trim($numrec) != '') {
            $xml .= '<numerorecuperacion>' . $numrec . '</numerorecuperacion>';
        } else {
            if (isset($_SESSION["tramite"]["numerorecuperacion"])) {
                $xml .= '<numerorecuperacion>' . trim($_SESSION["tramite"]["numerorecuperacion"]) . '</numerorecuperacion>';
            } else {
                $xml .= '<numerorecuperacion></numerorecuperacion>';
            }
        }
        if (empty($datos)) {
            $datos = $_SESSION["formulario"]["datos"];
        }

        //
        if (!isset($datos["cc"])) {
            $datos["cc"] = CODIGO_EMPRESA;
        }
        if (!isset($datos["complementorazonsocial"])) {
            $datos["complementorazonsocial"] = '';
        }
        if (!isset($datos["estadoproponente"])) {
            $datos["estadoproponente"] = '';
        }
        if (!isset($datos["nuevonombre"])) {
            $datos["nuevonombre"] = '';
        }
        if (!isset($datos["fechanacimiento"])) {
            $datos["fechanacimiento"] = '';
        }
        if (!isset($datos["ideext"])) {
            $datos["ideext"] = '';
        }
        if (!isset($datos["estadonit"])) {
            $datos["estadonit"] = '';
        }
        if (!isset($datos["prerut"])) {
            $datos["prerut"] = '';
        }
        if (!isset($datos["expedienteinactivo"])) {
            $datos["expedienteinactivo"] = '';
        }
        if (!isset($datos["fechacancelacion"])) {
            $datos["fechacancelacion"] = '';
        }
        if (!isset($datos["motivocancelacion"])) {
            $datos["motivocancelacion"] = '';
        }
        if (!isset($datos["estadotipoliquidacion"])) {
            $datos["estadotipoliquidacion"] = '';
        }
        if (!isset($datos["paiori"])) {
            $datos["paiori"] = '';
        }
        if (!isset($datos["idetripaiori"])) {
            $datos["idetripaiori"] = '';
        }
        if (!isset($datos["idetriextep"])) {
            $datos["idetriextep"] = '';
        }

        if (!isset($datos["empresafamiliar"])) {
            $datos["empresafamiliar"] = '';
        }
        if (!isset($datos["procesosinnovacion"])) {
            $datos["procesosinnovacion"] = '';
        }
        if (!isset($datos["tipogruemp"])) {
            $datos["tipogruemp"] = '';
        }
        if (!isset($datos["nombregruemp"])) {
            $datos["nombregruemp"] = '';
        }
        if (!isset($datos["ctrderpub"])) {
            $datos["ctrderpub"] = '';
        }
        if (!isset($datos["ctrcodcoop"])) {
            $datos["ctrcodcoop"] = '';
        }
        if (!isset($datos["ctrcodotras"])) {
            $datos["ctrcodotras"] = '';
        }
        if (!isset($datos["ctresacntasociados"])) {
            $datos["ctresacntasociados"] = 0;
        }
        if (!isset($datos["ctresacntmujeres"])) {
            $datos["ctresacntmujeres"] = 0;
        }
        if (!isset($datos["ctresacnthombres"])) {
            $datos["ctresacnthombres"] = 0;
        }
        if (!isset($datos["ctresapertgremio"])) {
            $datos["ctresapertgremio"] = '';
        }
        if (!isset($datos["ctresagremio"])) {
            $datos["ctresagremio"] = '';
        }
        if (!isset($datos["ctresaacredita"])) {
            $datos["ctresaacredita"] = '';
        }
        if (!isset($datos["ctresaivc"])) {
            $datos["ctresaivc"] = '';
        }
        if (!isset($datos["ctresainfoivc"])) {
            $datos["ctresainfoivc"] = '';
        }
        if (!isset($datos["ctresaautregistro"])) {
            $datos["ctresaautregistro"] = '';
        }
        if (!isset($datos["ctresaentautoriza"])) {
            $datos["ctresaentautoriza"] = '';
        }
        if (!isset($datos["ctresacodnat"])) {
            $datos["ctresacodnat"] = '';
        }
        if (!isset($datos["ctresadiscap"])) {
            $datos["ctresadiscap"] = '';
        }
        if (!isset($datos["ctresaetnia"])) {
            $datos["ctresaetnia"] = '';
        }
        if (!isset($datos["ctresacualetnia"])) {
            $datos["ctresacualetnia"] = '';
        }
        if (!isset($datos["ctresadespvictreins"])) {
            $datos["ctresadespvictreins"] = '';
        }
        if (!isset($datos["ctresacualdespvictreins"])) {
            $datos["ctresacualdespvictreins"] = '';
        }
        if (!isset($datos["ctresalgbti"])) {
            $datos["ctresalgbti"] = '';
        }
        if (!isset($datos["ctresaindgest"])) {
            $datos["ctresaindgest"] = '';
        }
        if (!isset($datos["codigopostalcom"])) {
            $datos["codigopostalcom"] = '';
        }
        if (!isset($datos["codigopostalnot"])) {
            $datos["codigopostalnot"] = '';
        }
        if (!isset($datos["feciniact1"])) {
            $datos["feciniact1"] = '';
        }
        if (!isset($datos["feciniact2"])) {
            $datos["feciniact2"] = '';
        }
        if (!isset($datos["codaduaneros"])) {
            $datos["codaduaneros"] = '';
        }
        if (!isset($datos["gruponiif"])) {
            $datos["gruponiif"] = '';
        }
        if (!isset($datos["niifconciliacion"])) {
            $datos["niifconciliacion"] = '';
        }
        if (!isset($datos["aportantesegsocial"])) {
            $datos["aportantesegsocial"] = '';
        }
        if (!isset($datos["tipoaportantesegsocial"])) {
            $datos["tipoaportantesegsocial"] = '';
        }

        if (!isset($datos["prerut"])) {
            $datos["prerut"] = '';
        }
        if (!isset($datos["fecmatant"])) {
            $datos["fecmatant"] = '';
        }
        if (!isset($datos["fecrenant"])) {
            $datos["fecrenant"] = '';
        }
        if (!isset($datos["camant"])) {
            $datos["camant"] = '';
        }
        if (!isset($datos["munant"])) {
            $datos["munant"] = '';
        }
        if (!isset($datos["benart7ant"])) {
            $datos["benart7ant"] = '';
        }
        if (!isset($datos["ultanorenant"])) {
            $datos["ultanorenant"] = '';
        }
        if (!isset($datos["matant"])) {
            $datos["matant"] = '';
        }
        if (!isset($datos["otorgaperjur"])) {
            $datos["otorgaperjur"] = '';
        }
        if (!isset($datos["nroperjur"])) {
            $datos["nroperjur"] = '';
        }
        if (!isset($datos["patrimonio"])) {
            $datos["patrimonio"] = 0;
        }
        if (!isset($datos["nombresegundocontacto"])) {
            $datos["nombresegundocontacto"] = '';
        }
        if (!isset($datos["cargosegundocontacto"])) {
            $datos["cargosegundocontacto"] = '';
        }

        if (!isset($datos["cumplerequisitos1780"])) {
            $datos["cumplerequisitos1780"] = '';
        }
        if (!isset($datos["cumplerequisitos1780primren"])) {
            $datos["cumplerequisitos1780primren"] = '';
        }
        if (!isset($datos["renunciabeneficios1780"])) {
            $datos["renunciabeneficios1780"] = '';
        }
        if (!isset($datos["naturaleza"])) {
            $datos["naturaleza"] = '0';
        }

        //
        if (!isset($datos["paicom"])) {
            $datos["paicom"] = '';
        }
        if (!isset($datos["painot"])) {
            $datos["painot"] = '';
        }
        if (!isset($datos["estadocapturado"])) {
            $datos["estadocapturado"] = '';
        }
        if (!isset($datos["estadocapturadootros"])) {
            $datos["estadocapturadootros"] = '';
        }
        if (!isset($datos["cantest"])) {
            $datos["cantest"] = 0;
        }
        if (!isset($datos["certificardesde"])) {
            $datos["certificardesde"] = '';
        }
        if (!isset($datos["ctrbic"])) {
            $datos["ctrbic"] = '';
        }

        if (!isset($datos["shd"])) {
            $datos["shd"] = array();
        }
        if (!isset($datos["shd"][1])) {
            $datos["shd"][1] = '';
        }
        if (!isset($datos["shd"][2])) {
            $datos["shd"][2] = '';
        }
        if (!isset($datos["shd"][3])) {
            $datos["shd"][3] = '';
        }
        if (!isset($datos["shd"][4])) {
            $datos["shd"][4] = '';
        }



        // Datos b&aacute;sicos
        $xml .= '<cc>' . $datos["cc"] . '</cc>';
        $xml .= '<matricula>' . ltrim($datos["matricula"], '0') . '</matricula>';
        $xml .= '<proponente>' . sprintf("%08s", $datos["proponente"]) . '</proponente>';
        if ($reemplazar == 'si') {
            $xml .= '<nombre><![CDATA[' . \funcionesSii2::reemplazarEspeciales($datos["nombre"]) . ']]></nombre>';
            $xml .= '<nuevonombre><![CDATA[' . \funcionesSii2::reemplazarEspeciales($datos["nuevonombre"]) . ']]></nuevonombre>';
            $xml .= '<ape1><![CDATA[' . \funcionesSii2::reemplazarEspeciales($datos["ape1"]) . ']]></ape1>';
            $xml .= '<ape2><![CDATA[' . \funcionesSii2::reemplazarEspeciales($datos["ape2"]) . ']]></ape2>';
            $xml .= '<nom1><![CDATA[' . \funcionesSii2::reemplazarEspeciales($datos["nom1"]) . ']]></nom1>';
            $xml .= '<nom2><![CDATA[' . \funcionesSii2::reemplazarEspeciales($datos["nom2"]) . ']]></nom2>';
            $xml .= '<sigla><![CDATA[' . \funcionesSii2::reemplazarEspeciales($datos["sigla"]) . ']]></sigla>';
        } else {
            $xml .= '<nombre><![CDATA[' . $datos["nombre"] . ']]></nombre>';
            $xml .= '<nuevonombre><![CDATA[' . $datos["nuevonombre"] . ']]></nuevonombre>';
            $xml .= '<ape1><![CDATA[' . $datos["ape1"] . ']]></ape1>';
            $xml .= '<ape2><![CDATA[' . $datos["ape2"] . ']]></ape2>';
            $xml .= '<nom1><![CDATA[' . $datos["nom1"] . ']]></nom1>';
            $xml .= '<nom2><![CDATA[' . $datos["nom2"] . ']]></nom2>';
            $xml .= '<sigla><![CDATA[' . $datos["sigla"] . ']]></sigla>';
        }
        $xml .= '<complementorazonsocial><![CDATA[' . $datos["complementorazonsocial"] . ']]></complementorazonsocial>';
        $xml .= '<tipoidentificacion>' . $datos["tipoidentificacion"] . '</tipoidentificacion>';
        if (ltrim($datos["identificacion"], "0") == '') {
            $xml .= '<identificacion></identificacion>';
        } else {
            $xml .= '<identificacion>' . sprintf("%011s", $datos["identificacion"]) . '</identificacion>';
        }
        if (ltrim($datos["ideext"], "0") == '') {
            $xml .= '<ideext></ideext>';
        } else {
            $xml .= '<ideext>' . sprintf("%015s", $datos["ideext"]) . '</ideext>';
        }
        $xml .= '<idmunidoc>' . $datos["idmunidoc"] . '</idmunidoc>';
        $xml .= '<fechanacimiento>' . $datos["fechanacimiento"] . '</fechanacimiento>';
        $xml .= '<fecexpdoc>' . $datos["fecexpdoc"] . '</fecexpdoc>';
        $xml .= '<paisexpdoc>' . $datos["paisexpdoc"] . '</paisexpdoc>';
        $xml .= '<nit>' . sprintf("%015s", $datos["nit"]) . '</nit>';
        $xml .= '<prerut>' . $datos["prerut"] . '</prerut>';
        $xml .= '<admondian>' . $datos["admondian"] . '</admondian>';
        $xml .= '<estadonit>' . $datos["estadonit"] . '</estadonit>';
        $xml .= '<expedienteinactivo>' . $datos["expedienteinactivo"] . '</expedienteinactivo>';
        $xml .= '<nacionalidad><![CDATA[' . $datos["nacionalidad"] . ']]></nacionalidad>';
        $xml .= '<fechamatricula>' . $datos["fechamatricula"] . '</fechamatricula>';

        //
        $xml .= '<fecmatant>' . $datos["fecmatant"] . '</fecmatant>';
        $xml .= '<fecrenant>' . $datos["fecrenant"] . '</fecrenant>';
        $xml .= '<camant>' . $datos["camant"] . '</camant>';
        $xml .= '<munant>' . $datos["munant"] . '</munant>';
        $xml .= '<benart7ant>' . $datos["benart7ant"] . '</benart7ant>';
        $xml .= '<ultanorenant>' . $datos["ultanorenant"] . '</ultanorenant>';
        $xml .= '<matant>' . $datos["matant"] . '</matant>';

        //
        $xml .= '<fecharenovacion>' . $datos["fecharenovacion"] . '</fecharenovacion>';
        $xml .= '<fechaconstitucion>' . ltrim($datos["fechaconstitucion"], "0") . '</fechaconstitucion>';
        $xml .= '<fechavencimiento>' . ltrim($datos["fechavencimiento"], "0") . '</fechavencimiento>';

        $xml .= '<fechacancelacion>' . ltrim($datos["fechacancelacion"], "0") . '</fechacancelacion>';
        $xml .= '<motivocancelacion>' . $datos["motivocancelacion"] . '</motivocancelacion>';
        $xml .= '<estadotipoliquidacion>' . $datos["estadotipoliquidacion"] . '</estadotipoliquidacion>';

        $xml .= '<ultanoren>' . $datos["ultanoren"] . '</ultanoren>';
        $xml .= '<estadomatricula>' . $datos["estadomatricula"] . '</estadomatricula>';
        $xml .= '<estadoproponente>' . $datos["estadoproponente"] . '</estadoproponente>';
        $xml .= '<estadoactiva>' . $datos["estadoactiva"] . '</estadoactiva>';
        $xml .= '<estadopreoperativa>' . $datos["estadopreoperativa"] . '</estadopreoperativa>';
        $xml .= '<estadoconcordato>' . $datos["estadoconcordato"] . '</estadoconcordato>';
        $xml .= '<estadointervenida>' . $datos["estadointervenida"] . '</estadointervenida>';
        $xml .= '<estadodisuelta>' . $datos["estadodisuelta"] . '</estadodisuelta>';
        $xml .= '<estadoreestructuracion>' . $datos["estadoreestructuracion"] . '</estadoreestructuracion>';
        $xml .= '<estadodatosmatricula>' . $datos["estadodatosmatricula"] . '</estadodatosmatricula>';
        $xml .= '<ctrcertificardesde>' . $datos["certificardesde"] . '</ctrcertificardesde>';
        $xml .= '<tamanoempresa>' . $datos["tamanoempresa"] . '</tamanoempresa>';
        $xml .= '<emprendedor28>' . $datos["emprendedor28"] . '</emprendedor28>';
        $xml .= '<pemprendedor28>' . $datos["pemprendedor28"] . '</pemprendedor28>';
        $xml .= '<empresafamiliar>' . $datos["empresafamiliar"] . '</empresafamiliar>';
        $xml .= '<procesosinnovacion>' . $datos["procesosinnovacion"] . '</procesosinnovacion>';
        $xml .= '<estadocapturado>' . $datos["estadocapturado"] . '</estadocapturado>';
        $xml .= '<estadocapturadootros>' . $datos["estadocapturadootros"] . '</estadocapturadootros>';
        $xml .= '<cantest>' . $datos["cantest"] . '</cantest>';
        $xml .= '<idetripaiori>' . $datos["idetripaiori"] . '</idetripaiori>';
        $xml .= '<paiori>' . $datos["paiori"] . '</paiori>';
        $xml .= '<idetriextep>' . $datos["idetriextep"] . '</idetriextep>';

        $xml .= '<organizacion>' . $datos["organizacion"] . '</organizacion>';
        $xml .= '<categoria>' . $datos["categoria"] . '</categoria>';
        $xml .= '<naturaleza>' . $datos["naturaleza"] . '</naturaleza>';
        $xml .= '<imppredil>' . $datos["imppredil"] . '</imppredil>';

        //
        $xml .= '<tipogruemp>' . $datos["tipogruemp"] . '</tipogruemp>';
        $xml .= '<nombregruemp>' . $datos["nombregruemp"] . '</nombregruemp>';
        $xml .= '<impexp>' . $datos["impexp"] . '</impexp>';
        $xml .= '<tipopropiedad>' . $datos["tipopropiedad"] . '</tipopropiedad>';
        $xml .= '<tipolocal>' . $datos["tipolocal"] . '</tipolocal>';

        // Informacion de ESADL
        $xml .= '<vigcontrol>' . $datos["vigcontrol"] . '</vigcontrol>';
        $xml .= '<fecperj>' . $datos["fecperj"] . '</fecperj>';
        $xml .= '<idorigenperj>' . $datos["idorigenperj"] . '</idorigenperj>';
        if (isset($datos["origendocconst"])) {
            $xml .= '<origendocconst>' . $datos["origendocconst"] . '</origendocconst>';
        } else {
            $xml .= '<origendocconst></origendocconst>';
        }
        $xml .= '<numperj>' . $datos["numperj"] . '</numperj>';
        $xml .= '<vigifecini>' . $datos["vigifecini"] . '</vigifecini>';
        $xml .= '<vigifecfin>' . $datos["vigifecfin"] . '</vigifecfin>';
        $xml .= '<patrimonio>' . $datos["patrimonio"] . '</patrimonio>';
        $xml .= '<clasegenesadl>' . $datos["clasegenesadl"] . '</clasegenesadl>';
        $xml .= '<claseespesadl>' . $datos["claseespesadl"] . '</claseespesadl>';
        $xml .= '<claseeconsoli>' . $datos["claseeconsoli"] . '</claseeconsoli>';

        $xml .= '<ctrderpub>' . $datos["ctrderpub"] . '</ctrderpub>';
        $xml .= '<ctrcodcoop>' . $datos["ctrcodcoop"] . '</ctrcodcoop>';
        $xml .= '<ctrcodotras>' . $datos["ctrcodotras"] . '</ctrcodotras>';
        $xml .= '<ctresacntasociados>' . $datos["ctresacntasociados"] . '</ctresacntasociados>';
        $xml .= '<ctresacntmujeres>' . $datos["ctresacntmujeres"] . '</ctresacntmujeres>';
        $xml .= '<ctresacnthombres>' . $datos["ctresacnthombres"] . '</ctresacnthombres>';
        $xml .= '<ctresapertgremio>' . $datos["ctresapertgremio"] . '</ctresapertgremio>';
        $xml .= '<ctresagremio><![CDATA[' . $datos["ctresagremio"] . ']]></ctresagremio>';
        $xml .= '<ctresaacredita><![CDATA[' . $datos["ctresaacredita"] . ']]></ctresaacredita>';
        $xml .= '<ctresaivc><![CDATA[' . $datos["ctresaivc"] . ']]></ctresaivc>';
        $xml .= '<ctresainfoivc>' . $datos["ctresainfoivc"] . '</ctresainfoivc>';
        $xml .= '<ctresaautregistro>' . $datos["ctresaautregistro"] . '</ctresaautregistro>';
        $xml .= '<ctresaentautoriza><![CDATA[' . $datos["ctresaentautoriza"] . ']]></ctresaentautoriza>';
        $xml .= '<ctresacodnat>' . $datos["ctresacodnat"] . '</ctresacodnat>';
        $xml .= '<ctresadiscap>' . $datos["ctresadiscap"] . '</ctresadiscap>';
        $xml .= '<ctresaetnia>' . $datos["ctresaetnia"] . '</ctresaetnia>';
        $xml .= '<ctresacualetnia><![CDATA[' . $datos["ctresacualetnia"] . ']]></ctresacualetnia>';
        $xml .= '<ctresadespvictreins>' . $datos["ctresadespvictreins"] . '</ctresadespvictreins>';
        $xml .= '<ctresacualdespvictreins><![CDATA[' . $datos["ctresacualdespvictreins"] . ']]></ctresacualdespvictreins>';
        $xml .= '<ctresaindgest>' . $datos["ctresaindgest"] . '</ctresaindgest>';
        $xml .= '<ctresalgbti>' . $datos["ctresalgbti"] . '</ctresalgbti>';

        //Datos de afiliacion
        $xml .= '<afiliado>' . $datos["afiliado"] . '</afiliado>';
        $xml .= '<fechaafiliacion>' . $datos["fechaafiliacion"] . '</fechaafiliacion>';
        $xml .= '<ultanorenafi>' . $datos["ultanorenafi"] . '</ultanorenafi>';
        $xml .= '<fechaultpagoafi>' . $datos["fechaultpagoafi"] . '</fechaultpagoafi>';
        $xml .= '<valorultpagoafi>' . $datos["valorultpagoafi"] . '</valorultpagoafi>';
        (isset($datos["saldoafiliado"])) ? $xml .= '<saldoafiliado>' . $datos["saldoafiliado"] . '</saldoafiliado>' : $xml .= '<saldoafiliado></saldoafiliado>';
        (isset($datos["telaflia"])) ? $xml .= '<telaflia>' . $datos["telaflia"] . '</telaflia>' : $xml .= '<telaflia></telaflia>';
        (isset($datos["diraflia"])) ? $xml .= '<diraflia>' . str_replace("#", "Nro.", $datos["diraflia"]) . '</diraflia>' : $xml .= '<diraflia></diraflia>';
        (isset($datos["munaflia"])) ? $xml .= '<munaflia>' . $datos["munaflia"] . '</munaflia>' : $xml .= '<munaflia></munaflia>';
        (isset($datos["profaflia"])) ? $xml .= '<profaflia>' . $datos["profaflia"] . '</profaflia>' : $xml .= '<profaflia></profaflia>';
        (isset($datos["contaflia"])) ? $xml .= '<contaflia>' . $datos["contaflia"] . '</contaflia>' : $xml .= '<contaflia></contaflia>';
        (isset($datos["dircontaflia"])) ? $xml .= '<dircontaflia>' . str_replace("#", "Nro.", $datos["dircontaflia"]) . '</dircontaflia>' : $xml .= '<dircontaflia></dircontaflia>';
        (isset($datos["muncontaflia"])) ? $xml .= '<muncontaflia>' . $datos["muncontaflia"] . '</muncontaflia>' : $xml .= '<muncontaflia></muncontaflia>';
        (isset($datos["numactaaflia"])) ? $xml .= '<numactaaflia>' . $datos["numactaaflia"] . '</numactaaflia>' : $xml .= '<numactaaflia></numactaaflia>';
        (isset($datos["fecactaaflia"])) ? $xml .= '<fecactaaflia>' . $datos["fecactaaflia"] . '</fecactaaflia>' : $xml .= '<fecactaaflia></fecactaaflia>';
        (isset($datos["numactaafliacan"])) ? $xml .= '<numactaafliacan>' . $datos["numactaafliacan"] . '</numactaafliacan>' : $xml .= '<numactaafliacan></numactaafliacan>';
        (isset($datos["fecactaafliacan"])) ? $xml .= '<fecactaafliacan>' . $datos["fecactaafliacan"] . '</fecactaafliacan>' : $xml .= '<fecactaafliacan></fecactaafliacan>';
        (isset($datos["fecexafiliacion"])) ? $xml .= '<fecexafiliacion>' . $datos["fecexafiliacion"] . '</fecexafiliacion>' : $xml .= '<fecexafiliacion></fecexafiliacion>';

        if (isset($datos["periodicoafiliados"])) {
            foreach ($datos["periodicoafiliados"] as $pagafi) {
                $xml .= '<pagosafiliado>';
                $xml .= '<perafiano>' . $pagafi["ano"] . '</perafiano>';
                $xml .= '<perafifecha>' . $pagafi["fecha"] . '</perafifecha>';
                $xml .= '<perafitipo>' . $pagafi["tipo"] . '</perafitipo>';
                $xml .= '<perafirecibo>' . $pagafi["recibo"] . '</perafirecibo>';
                $xml .= '<perafivalor>' . sprintf("%015s", str_replace(array(",", "."), "", $pagafi["valor"])) . '</perafivalor>';
                $xml .= '</pagosafiliado>';
            }
        }

        // Datos de ubicaci&oacute;n
        $xml .= '<lggr>' . $datos["lggr"] . '</lggr>';
        $xml .= '<nombrecomercial><![CDATA[' . $datos["nombrecomercial"] . ']]></nombrecomercial>';
        if ($reemplazar == 'si') {
            $xml .= '<dircom><![CDATA[' . \funcionesSii2::reemplazarEspeciales(str_replace("#", "Nro.", $datos["dircom"])) . ']]></dircom>';
        } else {
            $xml .= '<dircom><![CDATA[' . str_replace("#", "Nro.", $datos["dircom"]) . ']]></dircom>';
        }
        $xml .= '<dircom_tipovia><![CDATA[' . $datos["dircom_tipovia"] . ']]></dircom_tipovia>';
        $xml .= '<dircom_numvia><![CDATA[' . $datos["dircom_numvia"] . ']]></dircom_numvia>';
        $xml .= '<dircom_apevia><![CDATA[' . $datos["dircom_apevia"] . ']]></dircom_apevia>';
        $xml .= '<dircom_orivia><![CDATA[' . $datos["dircom_orivia"] . ']]></dircom_orivia>';
        $xml .= '<dircom_numcruce><![CDATA[' . $datos["dircom_numcruce"] . ']]></dircom_numcruce>';
        $xml .= '<dircom_apecruce><![CDATA[' . $datos["dircom_apecruce"] . ']]></dircom_apecruce>';
        $xml .= '<dircom_oricruce><![CDATA[' . $datos["dircom_oricruce"] . ']]></dircom_oricruce>';
        $xml .= '<dircom_numplaca><![CDATA[' . $datos["dircom_numplaca"] . ']]></dircom_numplaca>';
        if ($reemplazar == 'si') {
            $xml .= '<dircom_complemento><![CDATA[' . \funcionesSii2::reemplazarEspeciales($datos["dircom_complemento"]) . ']]></dircom_complemento>';
        } else {
            $xml .= '<dircom_complemento><![CDATA[' . $datos["dircom_complemento"] . ']]></dircom_complemento>';
        }
        $xml .= '<muncom>' . $datos["muncom"] . '</muncom>';
        $xml .= '<paicom>' . $datos["paicom"] . '</paicom>';
        $xml .= '<telcom1>' . $datos["telcom1"] . '</telcom1>';
        $xml .= '<telcom2>' . $datos["telcom2"] . '</telcom2>';
        $xml .= '<celcom>' . $datos["celcom"] . '</celcom>';
        $xml .= '<faxcom>' . $datos["faxcom"] . '</faxcom>';
        $xml .= '<aacom>' . $datos["aacom"] . '</aacom>';
        $xml .= '<zonapostalcom>' . $datos["zonapostalcom"] . '</zonapostalcom>';
        $xml .= '<barriocom>' . $datos["barriocom"] . '</barriocom>';
        $xml .= '<numpredial>' . $datos["numpredial"] . '</numpredial>';
        if ($reemplazar == 'si') {
            $xml .= '<emailcom><![CDATA[' . \funcionesSii2::reemplazarEspeciales($datos["emailcom"]) . ']]></emailcom>';
            $xml .= '<emailcom2><![CDATA[' . \funcionesSii2::reemplazarEspeciales($datos["emailcom2"]) . ']]></emailcom2>';
            $xml .= '<emailcom3><![CDATA[' . \funcionesSii2::reemplazarEspeciales($datos["emailcom3"]) . ']]></emailcom3>';
            $xml .= '<urlcom><![CDATA[' . \funcionesSii2::reemplazarEspeciales($datos["urlcom"]) . ']]></urlcom>';
        } else {
            $xml .= '<emailcom><![CDATA[' . $datos["emailcom"] . ']]></emailcom>';
            $xml .= '<emailcom2><![CDATA[' . $datos["emailcom2"] . ']]></emailcom2>';
            $xml .= '<emailcom3><![CDATA[' . $datos["emailcom3"] . ']]></emailcom3>';
            $xml .= '<urlcom><![CDATA[' . $datos["urlcom"] . ']]></urlcom>';
        }
        $xml .= '<codigopostalcom>' . $datos["codigopostalcom"] . '</codigopostalcom>';
        $xml .= '<codigozonacom>' . $datos["codigozonacom"] . '</codigozonacom>';

        //
        if ($reemplazar == 'si') {
            $xml .= '<nombresegundocontacto><![CDATA[' . \funcionesSii2::reemplazarEspeciales($datos["nombresegundocontacto"]) . ']]></nombresegundocontacto>';
            $xml .= '<cargosegundocontacto><![CDATA[' . \funcionesSii2::reemplazarEspeciales($datos["cargosegundocontacto"]) . ']]></cargosegundocontacto>';
        } else {
            $xml .= '<nombresegundocontacto><![CDATA[' . $datos["nombresegundocontacto"] . ']]></nombresegundocontacto>';
            $xml .= '<cargosegundocontacto><![CDATA[' . $datos["cargosegundocontacto"] . ']]></cargosegundocontacto>';
        }

        // Datos de ubicaci&oacute;n geogr&aacute;fica (latitud y longitud)
        if (isset($datos["latitudgrados"])) {
            $xml .= '<latitudgrados>' . $datos["latitudgrados"] . '</latitudgrados>';
        }
        if (isset($datos["latitudminutos"])) {
            $xml .= '<latitudminutos>' . $datos["latitudminutos"] . '</latitudminutos>';
        }
        if (isset($datos["latitudsegundos"])) {
            $xml .= '<latitudsegundos>' . $datos["latitudsegundos"] . '</latitudsegundos>';
        }
        if (isset($datos["latitudorientacion"])) {
            $xml .= '<latitudorientacion>' . $datos["latitudorientacion"] . '</latitudorientacion>';
        }
        if (isset($datos["longitudgrados"])) {
            $xml .= '<longitudgrados>' . $datos["longitudgrados"] . '</longitudgrados>';
        }
        if (isset($datos["longitudminutos"])) {
            $xml .= '<longitudminutos>' . $datos["longitudminutos"] . '</longitudminutos>';
        }
        if (isset($datos["longitudsegundos"])) {
            $xml .= '<longitudsegundos>' . $datos["longitudsegundos"] . '</longitudsegundos>';
        }
        if (isset($datos["longitudorientacion"])) {
            $xml .= '<longitudorientacion>' . $datos["longitudorientacion"] . '</longitudorientacion>';
        }

        // Direcci&oacute;n de notificaci&oacute;n
        if ($reemplazar == 'si') {
            $xml .= '<dirnot><![CDATA[' . \funcionesSii2::reemplazarEspeciales(str_replace("#", "Nro.", $datos["dirnot"])) . ']]></dirnot>';
        } else {
            $xml .= '<dirnot><![CDATA[' . str_replace("#", "Nro.", $datos["dirnot"]) . ']]></dirnot>';
        }
        $xml .= '<dirnot_tipovia><![CDATA[' . $datos["dirnot_tipovia"] . ']]></dirnot_tipovia>';
        $xml .= '<dirnot_numvia><![CDATA[' . $datos["dirnot_numvia"] . ']]></dirnot_numvia>';
        $xml .= '<dirnot_apevia><![CDATA[' . $datos["dirnot_apevia"] . ']]></dirnot_apevia>';
        $xml .= '<dirnot_orivia><![CDATA[' . $datos["dirnot_orivia"] . ']]></dirnot_orivia>';
        $xml .= '<dirnot_numcruce><![CDATA[' . $datos["dirnot_numcruce"] . ']]></dirnot_numcruce>';
        $xml .= '<dirnot_apecruce><![CDATA[' . $datos["dirnot_apecruce"] . ']]></dirnot_apecruce>';
        $xml .= '<dirnot_oricruce><![CDATA[' . $datos["dirnot_oricruce"] . ']]></dirnot_oricruce>';
        $xml .= '<dirnot_numplaca><![CDATA[' . $datos["dirnot_numplaca"] . ']]></dirnot_numplaca>';
        if ($reemplazar == 'si') {
            $xml .= '<dirnot_complemento><![CDATA[' . \funcionesSii2::reemplazarEspeciales($datos["dirnot_complemento"]) . ']]></dirnot_complemento>';
        } else {
            $xml .= '<dirnot_complemento><![CDATA[' . $datos["dirnot_complemento"] . ']]></dirnot_complemento>';
        }
        $xml .= '<munnot>' . $datos["munnot"] . '</munnot>';
        $xml .= '<painot>' . $datos["painot"] . '</painot>';
        $xml .= '<telnot>' . $datos["telnot"] . '</telnot>';
        $xml .= '<telnot2>' . $datos["telnot2"] . '</telnot2>';
        $xml .= '<celnot>' . $datos["celnot"] . '</celnot>';
        $xml .= '<faxnot>' . $datos["faxnot"] . '</faxnot>';
        $xml .= '<aanot>' . $datos["aanot"] . '</aanot>';
        $xml .= '<zonapostalnot>' . $datos["zonapostalnot"] . '</zonapostalnot>';
        $xml .= '<barrionot>' . $datos["barrionot"] . '</barrionot>';
        if ($reemplazar == 'si') {
            $xml .= '<emailnot><![CDATA[' . \funcionesSii2::reemplazarEspeciales($datos["emailnot"]) . ']]></emailnot>';
            $xml .= '<urlnot><![CDATA[' . \funcionesSii2::reemplazarEspeciales($datos["urlnot"]) . ']]></urlnot>';
            $xml .= '<dircor><![CDATA[' . \funcionesSii2::reemplazarEspeciales($datos["dircor"]) . ']]></dircor>';
        } else {
            $xml .= '<emailnot><![CDATA[' . $datos["emailnot"] . ']]></emailnot>';
            $xml .= '<urlnot><![CDATA[' . $datos["urlnot"] . ']]></urlnot>';
            $xml .= '<dircor><![CDATA[' . $datos["dircor"] . ']]></dircor>';
        }
        $xml .= '<telcor><![CDATA[' . $datos["telcor"] . ']]></telcor>';
        $xml .= '<muncor><![CDATA[' . $datos["muncor"] . ']]></muncor>';
        $xml .= '<codigopostalnot>' . $datos["codigopostalnot"] . '</codigopostalnot>';
        $xml .= '<codigozonanot>' . $datos["codigozonanot"] . '</codigozonanot>';
        $xml .= '<tiposedeadm>' . $datos["tiposedeadm"] . '</tiposedeadm>';

        // Ciius
        $xml .= '<ciius>';
        if (trim($datos["ciius"][1]) != '') {
            $xml .= '<ciiu>' . $datos["ciius"][1] . '</ciiu>';
        }
        if (trim($datos["ciius"][2]) != '') {
            $xml .= '<ciiu>' . $datos["ciius"][2] . '</ciiu>';
        }
        if (trim($datos["ciius"][3]) != '') {
            $xml .= '<ciiu>' . $datos["ciius"][3] . '</ciiu>';
        }
        if (trim($datos["ciius"][4]) != '') {
            $xml .= '<ciiu>' . $datos["ciius"][4] . '</ciiu>';
        }
        $xml .= '</ciius>';

        //
        if (trim($datos["versionciiu"]) != '') {
            $xml .= '<versionciiu>' . $datos["versionciiu"] . '</versionciiu>';
        } else {
            $xml .= '<versionciiu></versionciiu>';
        }

        // shd
        $xml .= '<shds>';
        if (trim($datos["shd"][1]) != '') {
            $xml .= '<shd>' . $datos["shd"][1] . '</shd>';
        }
        if (trim($datos["shd"][2]) != '') {
            $xml .= '<shd>' . $datos["shd"][2] . '</shd>';
        }
        if (trim($datos["shd"][3]) != '') {
            $xml .= '<shd>' . $datos["shd"][3] . '</shd>';
        }
        if (trim($datos["shd"][4]) != '') {
            $xml .= '<shd>' . $datos["shd"][4] . '</shd>';
        }
        $xml .= '</shds>';


        //
        $xml .= '<feciniact1>' . $datos["feciniact1"] . '</feciniact1>';
        $xml .= '<feciniact2>' . $datos["feciniact2"] . '</feciniact2>';
        $xml .= '<codaduaneros>' . $datos["codaduaneros"] . '</codaduaneros>';
        $xml .= '<gruponiif>' . $datos["gruponiif"] . '</gruponiif>';
        $xml .= '<niifconciliacion>' . $datos["niifconciliacion"] . '</niifconciliacion>';
        $xml .= '<aportantesegsocial>' . $datos["aportantesegsocial"] . '</aportantesegsocial>';
        $xml .= '<tipoaportantesegsocial>' . $datos["tipoaportantesegsocial"] . '</tipoaportantesegsocial>';
        if (isset($datos["desactiv"])) {
            $xml .= '<desactiv>' . trim($datos["desactiv"]) . '</desactiv>';
        } else {
            $xml .= '<desactiv></desactiv>';
        }

        // Porcentajes de capitales
        if (isset($datos["cap_porcnaltot"])) {
            $xml .= '<cap_porcnaltot>' . $datos["cap_porcnaltot"] . '</cap_porcnaltot>';
        } else {
            $xml .= '<cap_porcnaltot></cap_porcnaltot>';
        }
        if (isset($datos["cap_porcnalpri"])) {
            $xml .= '<cap_porcnalpri>' . $datos["cap_porcnalpri"] . '</cap_porcnalpri>';
        } else {
            $xml .= '<cap_porcnalpri></cap_porcnalpri>';
        }
        if (isset($datos["cap_porcnalpub"])) {
            $xml .= '<cap_porcnalpub>' . $datos["cap_porcnalpub"] . '</cap_porcnalpub>';
        } else {
            $xml .= '<cap_porcnalpub></cap_porcnalpub>';
        }
        if (isset($datos["cap_porcexttot"])) {
            $xml .= '<cap_porcexttot>' . $datos["cap_porcexttot"] . '</cap_porcexttot>';
        } else {
            $xml .= '<cap_porcexttot></cap_porcexttot>';
        }
        if (isset($datos["cap_porcextpri"])) {
            $xml .= '<cap_porcextpri>' . $datos["cap_porcextpri"] . '</cap_porcextpri>';
        } else {
            $xml .= '<cap_porcextpri></cap_porcextpri>';
        }
        if (isset($datos["cap_porcextpub"])) {
            $xml .= '<cap_porcextpub>' . $datos["cap_porcextpub"] . '</cap_porcextpub>';
        } else {
            $xml .= '<cap_porcextpub></cap_porcextpub>';
        }

        // Capitales de asociativas de trabajo
        if (!isset($datos["cap_apolab"])) {
            $datos["cap_apolab"] = 0;
        }
        if (!isset($datos["cap_apolabadi"])) {
            $datos["cap_apolabadi"] = 0;
        }
        if (!isset($datos["cap_apodin"])) {
            $datos["cap_apodin"] = 0;
        }
        if (!isset($datos["cap_apoact"])) {
            $datos["cap_apoact"] = 0;
        }
        $xml .= '<cap_apolab>' . $datos["cap_apolab"] . '</cap_apolab>';
        $xml .= '<cap_apolabadi>' . $datos["cap_apolabadi"] . '</cap_apolabadi>';
        $xml .= '<cap_apodin>' . $datos["cap_apodin"] . '</cap_apodin>';
        $xml .= '<cap_apoact>' . $datos["cap_apoact"] . '</cap_apoact>';
        // $xml.='<cap_apotot>' . ($datos["cap_apolab"] +  $datos["cap_apolabadi"] + $datos["cap_apodin"] + $datos["cap_apoact"]) . '</cap_apotot>';
        // Cantidad de establecimientos
        if (isset($datos["cntestab01"])) {
            $xml .= '<cntestab01>' . $datos["cntestab01"] . '</cntestab01>';
            $xml .= '<cntestab02>' . $datos["cntestab02"] . '</cntestab02>';
            $xml .= '<cntestab03>' . $datos["cntestab03"] . '</cntestab03>';
            $xml .= '<cntestab04>' . $datos["cntestab04"] . '</cntestab04>';
            $xml .= '<cntestab05>' . $datos["cntestab05"] . '</cntestab05>';
            $xml .= '<cntestab06>' . $datos["cntestab06"] . '</cntestab06>';
            $xml .= '<cntestab07>' . $datos["cntestab07"] . '</cntestab07>';
            $xml .= '<cntestab08>' . $datos["cntestab08"] . '</cntestab08>';
            $xml .= '<cntestab09>' . $datos["cntestab09"] . '</cntestab09>';
            $xml .= '<cntestab10>' . $datos["cntestab10"] . '</cntestab10>';
            $xml .= '<cntestab11>' . $datos["cntestab11"] . '</cntestab11>';
        } else {
            $xml .= '<cntestab01></cntestab01>';
            $xml .= '<cntestab02></cntestab02>';
            $xml .= '<cntestab03></cntestab03>';
            $xml .= '<cntestab04></cntestab04>';
            $xml .= '<cntestab05></cntestab05>';
            $xml .= '<cntestab06></cntestab06>';
            $xml .= '<cntestab07></cntestab07>';
            $xml .= '<cntestab08></cntestab08>';
            $xml .= '<cntestab09></cntestab09>';
            $xml .= '<cntestab10></cntestab10>';
            $xml .= '<cntestab11></cntestab11>';
        }

        // Referencias
        $xml .= '<refcrenom1><![CDATA[' . $datos["refcrenom1"] . ']]></refcrenom1>';
        $xml .= '<refcreofi1><![CDATA[' . $datos["refcreofi1"] . ']]></refcreofi1>';
        $xml .= '<refcretel1><![CDATA[' . $datos["refcretel1"] . ']]></refcretel1>';
        $xml .= '<refcrenom2><![CDATA[' . $datos["refcrenom2"] . ']]></refcrenom2>';
        $xml .= '<refcreofi2><![CDATA[' . $datos["refcreofi2"] . ']]></refcreofi2>';
        $xml .= '<refcretel2><![CDATA[' . $datos["refcretel2"] . ']]></refcretel2>';
        $xml .= '<refcomnom1><![CDATA[' . $datos["refcomnom1"] . ']]></refcomnom1>';
        $xml .= '<refcomdir1><![CDATA[' . $datos["refcomdir1"] . ']]></refcomdir1>';
        $xml .= '<refcomtel1>' . $datos["refcomtel1"] . '</refcomtel1>';
        $xml .= '<refcomnom2><![CDATA[' . $datos["refcomnom2"] . ']]></refcomnom2>';
        $xml .= '<refcomdir2><![CDATA[' . $datos["refcomdir2"] . ']]></refcomdir2>';
        $xml .= '<refcomtel2>' . $datos["refcomtel2"] . '</refcomtel2>';

        // informacion financiera historica
        if (isset($datos["hf"])) {
            foreach ($datos["hf"] as $hf) {
                if ($datos["organizacion"] == '01' ||
                        ($datos["organizacion"] > '02' && $datos["categoria"] == '1')
                ) {
                    $xml .= '<hf>';
                    $xml .= '<hf_anodatos>' . $hf["anodatos"] . '</hf_anodatos>';
                    $xml .= '<hf_feccredat>' . $hf["fechadatos"] . '</hf_feccredat>';
                    $xml .= '<hf_actcte>' . $hf["actcte"] . '</hf_actcte>';
                    $xml .= '<hf_actnocte>' . $hf["actnocte"] . '</hf_actnocte>';
                    $xml .= '<hf_actfij>' . $hf["actfij"] . '</hf_actfij>';
                    $xml .= '<hf_fijnet>' . $hf["fijnet"] . '</hf_fijnet>';
                    $xml .= '<hf_actval>' . $hf["actval"] . '</hf_actval>';
                    $xml .= '<hf_actotr>' . $hf["actotr"] . '</hf_actotr>';
                    $xml .= '<hf_acttot>' . $hf["acttot"] . '</hf_acttot>';
                    $xml .= '<hf_actsin>' . $hf["actsinaju"] . '</hf_actsin>';
                    $xml .= '<hf_invent>' . $hf["invent"] . '</hf_invent>';
                    $xml .= '<hf_pascte>' . $hf["pascte"] . '</hf_pascte>';
                    $xml .= '<hf_paslar>' . $hf["paslar"] . '</hf_paslar>';
                    $xml .= '<hf_pastot>' . $hf["pastot"] . '</hf_pastot>';
                    $xml .= '<hf_patliq>' . $hf["pattot"] . '</hf_patliq>';
                    $xml .= '<hf_paspat>' . $hf["paspat"] . '</hf_paspat>';
                    $xml .= '<hf_balsoc>' . $hf["balsoc"] . '</hf_balsoc>';
                    $xml .= '<hf_ingope>' . $hf["ingope"] . '</hf_ingope>';
                    $xml .= '<hf_ingnoope>' . $hf["ingnoope"] . '</hf_ingnoope>';
                    $xml .= '<hf_cosven>' . $hf["cosven"] . '</hf_cosven>';
                    $xml .= '<hf_gasint>' . $hf["gasint"] . '</hf_gasint>';
                    $xml .= '<hf_gasimp>' . $hf["gasimp"] . '</hf_gasimp>';
                    $xml .= '<hf_gasadm>' . $hf["gtoadm"] . '</hf_gasadm>';
                    $xml .= '<hf_gasope>' . $hf["gtoven"] . '</hf_gasope>';
                    $xml .= '<hf_utiope>' . $hf["utiope"] . '</hf_utiope>';
                    $xml .= '<hf_utinet>' . $hf["utinet"] . '</hf_utinet>';
                    $xml .= '<hf_person>' . $hf["personal"] . '</hf_person>';
                    $xml .= '<hf_pcttem>' . $hf["personaltemp"] . '</hf_pcttem>';
                    $xml .= '<hf_depamo>' . $hf["depamo"] . '</hf_depamo>';
                    $xml .= '</hf>';
                } else {
                    if ($hf["anodatos"] != '') {
                        $xml .= '<hf>';
                        $xml .= '<hf_anodatos>' . $hf["anodatos"] . '</hf_anodatos>';
                        if (isset($hf["feccredat"])) {
                            $xml .= '<hf_feccredat>' . $hf["feccredat"] . '</hf_feccredat>';
                        } else {
                            $xml .= '<hf_feccredat></hf_feccredat>';
                        }
                        if (isset($hf["valest"])) {
                            $xml .= '<hf_valest>' . $hf["actvin"] . '</hf_valest>';
                        } else {
                            $xml .= '<hf_valest></hf_valest>';
                        }
                        if (isset($hf["person"])) {
                            $xml .= '<hf_person>' . $hf["personal"] . '</hf_person>';
                        } else {
                            $xml .= '<hf_person></hf_person>';
                        }
                        $xml .= '</hf>';
                    }
                }
            }
        }

        // informacion financiera
        $xml .= '<anodatosactual>' . $datos["anodatos"] . '</anodatosactual>';
        $xml .= '<fechadatosactual>' . $datos["fechadatos"] . '</fechadatosactual>';
        $xml .= '<personalactual>' . $datos["personal"] . '</personalactual>';
        $xml .= '<personaltempactual>' . $datos["personaltemp"] . '</personaltempactual>';
        $xml .= '<actvinactual>' . $datos["actvin"] . '</actvinactual>';
        $xml .= '<actcteactual>' . $datos["actcte"] . '</actcteactual>';
        $xml .= '<actnocteactual>' . $datos["actnocte"] . '</actnocteactual>';
        $xml .= '<actfijactual>' . $datos["actfij"] . '</actfijactual>';
        $xml .= '<fijnetactual>' . $datos["fijnet"] . '</fijnetactual>';
        $xml .= '<actotractual>' . $datos["actotr"] . '</actotractual>';
        $xml .= '<actvalactual>' . $datos["actval"] . '</actvalactual>';
        $xml .= '<acttotactual>' . $datos["acttot"] . '</acttotactual>';
        $xml .= '<actsinajuactual>' . $datos["acttot"] . '</actsinajuactual>';
        $xml .= '<inventactual>' . $datos["invent"] . '</inventactual>';
        $xml .= '<pascteactual>' . $datos["pascte"] . '</pascteactual>';
        $xml .= '<paslaractual>' . $datos["paslar"] . '</paslaractual>';
        $xml .= '<pastotactual>' . $datos["pastot"] . '</pastotactual>';
        $xml .= '<pattotactual>' . $datos["pattot"] . '</pattotactual>';
        $xml .= '<paspatactual>' . $datos["paspat"] . '</paspatactual>';
        $xml .= '<balsocactual>' . $datos["balsoc"] . '</balsocactual>';
        $xml .= '<ingopeactual>' . $datos["ingope"] . '</ingopeactual>';
        $xml .= '<ingnoopeactual>' . $datos["ingnoope"] . '</ingnoopeactual>';

        $xml .= '<gtovenactual>' . $datos["gtoven"] . '</gtovenactual>';
        $xml .= '<gtoadmactual>' . $datos["gtoadm"] . '</gtoadmactual>';

        $xml .= '<gasopeactual>' . $datos["gtoven"] . '</gasopeactual>';
        $xml .= '<gasnoopeactual>' . $datos["gtoadm"] . '</gasnoopeactual>';

        $xml .= '<cosvenactual>' . $datos["cosven"] . '</cosvenactual>';
        $xml .= '<depamoactual>' . $datos["depamo"] . '</depamoactual>';
        $xml .= '<gasintactual>' . $datos["gasint"] . '</gasintactual>';
        $xml .= '<gasimpactual>' . $datos["gasimp"] . '</gasimpactual>';
        $xml .= '<utiopeactual>' . $datos["utiope"] . '</utiopeactual>';
        $xml .= '<utinetactual>' . $datos["utinet"] . '</utinetactual>';

        //
        $xml .= '<anodatos>' . $datos["anodatos"] . '</anodatos>';
        $xml .= '<fechadatos>' . $datos["fechadatos"] . '</fechadatos>';
        $xml .= '<personal>' . $datos["personal"] . '</personal>';
        $xml .= '<personaltemp>' . $datos["personaltemp"] . '</personaltemp>';
        $xml .= '<actvin>' . $datos["actvin"] . '</actvin>';
        $xml .= '<actcte>' . $datos["actcte"] . '</actcte>';
        $xml .= '<actnocte>' . $datos["actnocte"] . '</actnocte>';
        $xml .= '<actfij>' . $datos["actfij"] . '</actfij>';
        $xml .= '<fijnet>' . $datos["fijnet"] . '</fijnet>';
        $xml .= '<actotr>' . $datos["actotr"] . '</actotr>';
        $xml .= '<actval>' . $datos["actval"] . '</actval>';
        $xml .= '<acttot>' . $datos["acttot"] . '</acttot>';
        $xml .= '<actsinaju>' . $datos["acttot"] . '</actsinaju>';
        $xml .= '<invent>' . $datos["invent"] . '</invent>';
        $xml .= '<pascte>' . $datos["pascte"] . '</pascte>';
        $xml .= '<paslar>' . $datos["paslar"] . '</paslar>';
        $xml .= '<pastot>' . $datos["pastot"] . '</pastot>';
        $xml .= '<pattot>' . $datos["pattot"] . '</pattot>';
        $xml .= '<paspat>' . $datos["paspat"] . '</paspat>';
        $xml .= '<balsoc>' . $datos["balsoc"] . '</balsoc>';
        $xml .= '<ingope>' . $datos["ingope"] . '</ingope>';
        $xml .= '<ingnoope>' . $datos["ingnoope"] . '</ingnoope>';
        $xml .= '<gtoven>' . $datos["gtoven"] . '</gtoven>';
        $xml .= '<gtoadm>' . $datos["gtoadm"] . '</gtoadm>';

        $xml .= '<gasope>' . $datos["gtoven"] . '</gasope>';
        $xml .= '<gasnoope>' . $datos["gtoadm"] . '</gasnoope>';

        $xml .= '<cosven>' . $datos["cosven"] . '</cosven>';
        $xml .= '<depamo>' . $datos["depamo"] . '</depamo>';
        $xml .= '<gasint>' . $datos["gasint"] . '</gasint>';
        $xml .= '<gasimp>' . $datos["gasimp"] . '</gasimp>';
        $xml .= '<utiope>' . $datos["utiope"] . '</utiope>';
        $xml .= '<utinet>' . $datos["utinet"] . '</utinet>';

        //    
        if (isset($datos["apolab"])) {
            $xml .= '<apolab>' . $datos["apolab"] . '</apolab>';
        }
        if (isset($datos["apolabadi"])) {
            $xml .= '<apolabadi>' . $datos["apolabadi"] . '</apolabadi>';
        }
        if (isset($datos["apoact"])) {
            $xml .= '<apoact>' . $datos["apoact"] . '</apoact>';
        }
        if (isset($datos["apodin"])) {
            $xml .= '<apodin>' . $datos["apodin"] . '</apodin>';
        }
        if (isset($datos["apotot"])) {
            $xml .= '<apotot>' . $datos["apotot"] . '</apotot>';
        }

        //
        if (!isset($datos["anodatospatrimonio"])) {
            $datos["anodatospatrimonio"] = '';
        }
        if (!isset($datos["fechadatospatrimonio"])) {
            $datos["fechadatospatrimonio"] = '';
        }
        if (!isset($datos["patrimonioesadl"])) {
            $datos["patrimonioesadl"] = 0;
        }
        $xml .= '<anodatospatrimonio>' . $datos["anodatospatrimonio"] . '</anodatospatrimonio>';
        $xml .= '<fechadatospatrimonio>' . $datos["fechadatospatrimonio"] . '</fechadatospatrimonio>';
        $xml .= '<patrimonioesadl>' . $datos["patrimonioesadl"] . '</patrimonioesadl>';

        if (isset($datos["f"])) {
            foreach ($datos["f"] as $fin) {
                // informaci&oacute;n financiera
                if (!isset($fin["personaltemp"])) {
                    $fin["personaltemp"] = '';
                }
                if (!isset($fin["actvin"])) {
                    $fin["actvin"] = '0';
                }
                if (!isset($fin["actcte"])) {
                    $fin["actcte"] = '0';
                }
                if (!isset($fin["actnocte"])) {
                    $fin["actnocte"] = '0';
                }
                if (!isset($fin["actfij"])) {
                    $fin["actfij"] = '0';
                }
                if (!isset($fin["fijnet"])) {
                    $fin["fijnet"] = '0';
                }
                if (!isset($fin["actotr"])) {
                    $fin["actotr"] = '0';
                }
                if (!isset($fin["actval"])) {
                    $fin["actval"] = '0';
                }
                if (!isset($fin["acttot"])) {
                    $fin["acttot"] = '0';
                }
                if (!isset($fin["invent"])) {
                    $fin["invent"] = '0';
                }
                if (!isset($fin["pascte"])) {
                    $fin["pascte"] = '0';
                }
                if (!isset($fin["paslar"])) {
                    $fin["paslar"] = '0';
                }
                if (!isset($fin["pastot"])) {
                    $fin["pastot"] = '0';
                }
                if (!isset($fin["pattot"])) {
                    $fin["pattot"] = '0';
                }
                if (!isset($fin["paspat"])) {
                    $fin["paspat"] = '0';
                }
                if (!isset($fin["balsoc"])) {
                    $fin["balsoc"] = '0';
                }
                if (!isset($fin["ingope"])) {
                    $fin["ingope"] = '0';
                }
                if (!isset($fin["ingnoope"])) {
                    $fin["ingnoope"] = '0';
                }
                if (!isset($fin["gtoven"])) {
                    $fin["gtoven"] = '0';
                }
                if (!isset($fin["gtoadm"])) {
                    $fin["gtoadm"] = '0';
                }
                if (!isset($fin["cosven"])) {
                    $fin["cosven"] = '0';
                }
                if (!isset($fin["depamo"])) {
                    $fin["depamo"] = '0';
                }
                if (!isset($fin["gasint"])) {
                    $fin["gasint"] = '0';
                }
                if (!isset($fin["gasimp"])) {
                    $fin["gasimp"] = '0';
                }
                if (!isset($fin["utiope"])) {
                    $fin["utiope"] = '0';
                }
                if (!isset($fin["utinet"])) {
                    $fin["utinet"] = '0';
                }
                if (!isset($fin["personal"])) {
                    $fin["personal"] = '0';
                }
                if (!isset($fin["fechadatos"])) {
                    $fin["fechadatos"] = date("Ymd");
                }
                if ($fin["anodatos"] != '') {
                    $xml .= '<financieraanteriores>';
                    $xml .= '<anodatos>' . $fin["anodatos"] . '</anodatos>';
                    $xml .= '<fechadatos>' . $fin["fechadatos"] . '</fechadatos>';
                    $xml .= '<personal>' . $fin["personal"] . '</personal>';
                    $xml .= '<personaltemp>' . $fin["personaltemp"] . '</personaltemp>';
                    $xml .= '<actvin>' . $fin["actvin"] . '</actvin>';
                    $xml .= '<actcte>' . $fin["actcte"] . '</actcte>';
                    $xml .= '<actnocte>' . $fin["actnocte"] . '</actnocte>';
                    $xml .= '<actfij>' . $fin["actfij"] . '</actfij>';
                    $xml .= '<fijnet>' . $fin["fijnet"] . '</fijnet>';
                    $xml .= '<actotr>' . $fin["actotr"] . '</actotr>';
                    $xml .= '<actval>' . $fin["actval"] . '</actval>';
                    $xml .= '<acttot>' . $fin["acttot"] . '</acttot>';
                    $xml .= '<actsinaju>' . $fin["acttot"] . '</actsinaju>';
                    $xml .= '<invent>' . $fin["invent"] . '</invent>';
                    $xml .= '<pascte>' . $fin["pascte"] . '</pascte>';
                    $xml .= '<paslar>' . $fin["paslar"] . '</paslar>';
                    $xml .= '<pastot>' . $fin["pastot"] . '</pastot>';
                    $xml .= '<pattot>' . $fin["pattot"] . '</pattot>';
                    $xml .= '<paspat>' . $fin["paspat"] . '</paspat>';
                    $xml .= '<balsoc>' . $fin["balsoc"] . '</balsoc>';
                    $xml .= '<ingope>' . $fin["ingope"] . '</ingope>';
                    $xml .= '<ingnoope>' . $fin["ingnoope"] . '</ingnoope>';
                    $xml .= '<gtoven>' . $fin["gtoven"] . '</gtoven>';
                    $xml .= '<gtoadm>' . $fin["gtoadm"] . '</gtoadm>';
                    $xml .= '<cosven>' . $fin["cosven"] . '</cosven>';
                    $xml .= '<depamo>' . $fin["depamo"] . '</depamo>';
                    $xml .= '<gasint>' . $fin["gasint"] . '</gasint>';
                    $xml .= '<gasimp>' . $fin["gasimp"] . '</gasimp>';
                    $xml .= '<utiope>' . $fin["utiope"] . '</utiope>';
                    $xml .= '<utinet>' . $fin["utinet"] . '</utinet>';
                    $xml .= '</financieraanteriores>';
                }
            }
        }

        //
        if (!isset($datos["benley1780"])) {
            $datos["benley1780"] = '';
        }
        if (!isset($datos["ctrdepuracion1727"])) {
            $datos["ctrdepuracion1727"] = '';
        }
        if (!isset($datos["ctrfechadepuracion1727"])) {
            $datos["ctrfechadepuracion1727"] = '';
        }

        if (!isset($datos["ctrben658"])) {
            $datos["ctrben658"] = '';
        }

        // Campos adicionados en mayo 20 de 2011
        $xml .= '<ctrmen>' . $datos["ctrmen"] . '</ctrmen>';
        $xml .= '<ctrmennot>' . $datos["ctrmennot"] . '</ctrmennot>';
        $xml .= '<ctrubi>' . $datos["ctrubi"] . '</ctrubi>';
        $xml .= '<ctrfun>' . $datos["ctrfun"] . '</ctrfun>';
        $xml .= '<art4>' . $datos["art4"] . '</art4>';
        $xml .= '<art7>' . $datos["art7"] . '</art7>';
        $xml .= '<art50>' . $datos["art50"] . '</art50>';
        $xml .= '<benley1780>' . $datos["benley1780"] . '</benley1780>';
        $xml .= '<cumplerequisitos1780>' . $datos["cumplerequisitos1780"] . '</cumplerequisitos1780>';
        $xml .= '<renunciabeneficios1780>' . $datos["renunciabeneficios1780"] . '</renunciabeneficios1780>';
        $xml .= '<cumplerequisitos1780primren>' . $datos["cumplerequisitos1780primren"] . '</cumplerequisitos1780primren>';
        $xml .= '<matriculaanterior>' . $datos["matriculaanterior"] . '</matriculaanterior>';
        $xml .= '<ctrcancelacion1429>' . $datos["ctrcancelacion1429"] . '</ctrcancelacion1429>';
        $xml .= '<ctrdepuracion1727>' . $datos["ctrdepuracion1727"] . '</ctrdepuracion1727>';
        $xml .= '<ctrfechadepuracion1727>' . $datos["ctrfechadepuracion1727"] . '</ctrfechadepuracion1727>';
        $xml .= '<ctrben658>' . $datos["ctrben658"] . '</ctrben658>';
        $xml .= '<personaltemp>' . $datos["personaltemp"] . '</personaltemp>';
        $xml .= '<ivcenvio>' . $datos["ivcenvio"] . '</ivcenvio>';
        $xml .= '<ivcsuelos>' . $datos["ivcsuelos"] . '</ivcsuelos>';
        $xml .= '<ivcarea>' . $datos["ivcarea"] . '</ivcarea>';
        $xml .= '<ivcver>' . $datos["ivcver"] . '</ivcver>';
        $xml .= '<ivccretip>' . $datos["ivccretip"] . '</ivccretip>';
        $xml .= '<ivcali>' . $datos["ivcali"] . '</ivcali>';
        $xml .= '<ivcqui>' . $datos["ivcqui"] . '</ivcqui>';
        $xml .= '<ivcriesgo>' . $datos["ivcriesgo"] . '</ivcriesgo>';
        $xml .= '<ctrbic>' . $datos["ctrbic"] . '</ctrbic>';

        //
        foreach ($datos["codigoscae"] as $key => $dat) {
            $xml .= '<' . $key . '>' . trim($dat) . '</' . $key . '>';
        }

        //
        foreach ($datos["informacionadicional"] as $key => $dat) {
            $xml .= '<' . $key . '>' . trim($dat) . '</' . $key . '>';
        }

        /*
          // Incluidas en mayo 23 de 2014
          $xml.='<alc_cedcat>' . $datos["alc_cedcat"] . '</alc_cedcat>';
          $xml.='<alc_feciniact>' . $datos["alc_feciniact"] . '</alc_feciniact>';
          $xml.='<alc_ingresos>' . $datos["alc_ingresos"] . '</alc_ingresos>';
          $xml.='<alc_codica1>' . $datos["alc_codica1"] . '</alc_codica1>';
          $xml.='<alc_codica2>' . $datos["alc_codica2"] . '</alc_codica2>';
          $xml.='<alc_codica3>' . $datos["alc_codica3"] . '</alc_codica3>';
          $xml.='<alc_codica4>' . $datos["alc_codica4"] . '</alc_codica4>';
          $xml.='<alc_codica5>' . $datos["alc_codica5"] . '</alc_codica5>';
          $xml.='<alc_areatot>' . $datos["alc_areatot"] . '</alc_areatot>';
          $xml.='<alc_areauti>' . $datos["alc_areauti"] . '</alc_areauti>';
          $xml.='<alc_respiyc>' . $datos["alc_respiyc"] . '</alc_respiyc>';
          $xml.='<alc_respretiyc>' . $datos["alc_respretiyc"] . '</alc_respretiyc>';
          $xml.='<alc_respmedmag>' . $datos["alc_respmedmag"] . '</alc_respmedmag>';
          $xml.='<alc_respotros>' . $datos["alc_respotros"] . '</alc_respotros>';
          $xml.='<alc_regimen>' . $datos["alc_regimen"] . '</alc_regimen>';
          $xml.='<alc_grancon>' . $datos["alc_grancon"] . '</alc_grancon>';
          $xml.='<alc_lugpre>' . $datos["alc_lugpre"] . '</alc_lugpre>';
          $xml.='<alc_estienda>' . $datos["alc_estienda"] . '</alc_estienda>';
          $xml.='<alc_tieneav>' . $datos["alc_tieneav"] . '</alc_tieneav>';
          $xml.='<alc_barrio>' . $datos["alc_barrio"] . '</alc_barrio>';
          $xml.='<alc_predio>' . $datos["alc_predio"] . '</alc_predio>';
         */

        // Representacion legal y administracion
        $xml .= '<representanteslegales>';
        if (!empty($datos["repleg"])) {
            foreach ($datos["replegal"] as $rep) {
                $xml .= '<representantelegal>';
                $xml .= '<idtipoidentificacionreplegal>' . $rep["idtipoidentificacionreplegal"] . '</idtipoidentificacionreplegal>';
                $xml .= '<identificacionreplegal>' . $rep["identificacionreplegal"] . '</identificacionreplegal>';
                if ($reemplazar == 'si') {
                    $xml .= '<nombrereplegal><![CDATA[' . \funcionesSii2::reemplazarEspeciales($rep["nombrereplegal"]) . ']]></nombrereplegal>';
                    $xml .= '<cargoreplegal><![CDATA[' . \funcionesSii2::reemplazarEspeciales($rep["cargoreplegal"]) . ']]></cargoreplegal>';
                } else {
                    $xml .= '<nombrereplegal><![CDATA[' . $rep["nombrereplegal"] . ']]></nombrereplegal>';
                    $xml .= '<cargoreplegal><![CDATA[' . $rep["cargoreplegal"] . ']]></cargoreplegal>';
                }
                $xml .= '</representantelegal>';
            }
        }
        $xml .= '</representanteslegales>';

        // Administrador    
        $xml .= '<idtipoidentificacionadministrador>' . $datos["idtipoidentificacionadministrador"] . '</idtipoidentificacionadministrador>';
        $xml .= '<identificacionadministrador>' . $datos["identificacionadministrador"] . '</identificacionadministrador>';
        if ($reemplazar == 'si') {
            $xml .= '<nombreadministrador><![CDATA[' . \funcionesSii2::reemplazarEspeciales($datos["nombreadministrador"]) . ']]></nombreadministrador>';
        } else {
            $xml .= '<nombreadministrador><![CDATA[' . $datos["nombreadministrador"] . ']]></nombreadministrador>';
        }

        // Bienes
        $xml .= '<bienes>';
        if (!empty($datos["bienes"])) {
            foreach ($datos["bienes"] as $bien) {
                $xml .= '<bien>';
                $xml .= '<matinmo>' . $bien["matinmo"] . '</matinmo>';
                $xml .= '<dir><![CDATA[' . $bien["dir"] . ']]></dir>';
                $xml .= '<barrio><![CDATA[' . $bien["barrio"] . ']]></barrio>';
                $xml .= '<muni><![CDATA[' . $bien["muni"] . ']]></muni>';
                $xml .= '<dpto><![CDATA[' . $bien["dpto"] . ']]></dpto>';
                $xml .= '<pais><![CDATA[' . $bien["pais"] . ']]></pais>';
                $xml .= '</bien>';
            }
        }
        $xml .= '</bienes>';

        // Propietarios
        $xml .= '<propietarios>';
        if (
                ($datos["organizacion"] == '02')
        ) {
            if (!empty($datos["propietarios"])) {
                foreach ($datos["propietarios"] as $prop) {

                    if (!isset($prop["nom1propietario"])) {
                        $prop["nom1propietario"] = '';
                    }
                    if (!isset($prop["nom2propietario"])) {
                        $prop["nom2propietario"] = '';
                    }
                    if (!isset($prop["ape1propietario"])) {
                        $prop["ape1propietario"] = '';
                    }
                    if (!isset($prop["ape2propietario"])) {
                        $prop["ape2propietario"] = '';
                    }
                    if (!isset($prop["fecmatripropietario"])) {
                        $prop["fecmatripropietario"] = '';
                    }
                    if (!isset($prop["estadodatospropietario"])) {
                        $prop["estadodatospropietario"] = '';
                    }

                    $xml .= '<propietario>';

                    $xml .= '<idclase>' . $prop["idtipoidentificacionpropietario"] . '</idclase>';
                    $xml .= '<numid>' . ltrim($prop["identificacionpropietario"], '0') . '</numid>';
                    $xml .= '<nit>' . ltrim($prop["nitpropietario"], '0') . '</nit>';
                    if ($reemplazar == 'si') {
                        $xml .= '<nombre><![CDATA[' . \funcionesSii2::reemplazarEspeciales($prop["nombrepropietario"]) . ']]></nombre>';
                    } else {
                        $xml .= '<nombre><![CDATA[' . $prop["nombrepropietario"] . ']]></nombre>';
                    }
                    $xml .= '<camara>' . $prop["camarapropietario"] . '</camara>';
                    $xml .= '<matricula>' . ltrim($prop["matriculapropietario"], '0') . '</matricula>';

                    $xml .= '<camarapropietario>' . $prop["camarapropietario"] . '</camarapropietario>';
                    $xml .= '<matriculapropietario>' . ltrim($prop["matriculapropietario"], '0') . '</matriculapropietario>';
                    $xml .= '<idtipoidentificacionpropietario>' . $prop["idtipoidentificacionpropietario"] . '</idtipoidentificacionpropietario>';
                    $xml .= '<identificacionpropietario>' . ltrim($prop["identificacionpropietario"], '0') . '</identificacionpropietario>';
                    $xml .= '<nitpropietario>' . ltrim($prop["nitpropietario"], '0') . '</nitpropietario>';
                    if ($reemplazar == 'si') {
                        $xml .= '<nombrepropietario><![CDATA[' . \funcionesSii2::reemplazarEspeciales($prop["nombrepropietario"]) . ']]></nombrepropietario>';
                        $xml .= '<nom1propietario><![CDATA[' . \funcionesSii2::reemplazarEspeciales($prop["nom1propietario"]) . ']]></nom1propietario>';
                        $xml .= '<nom2propietario><![CDATA[' . \funcionesSii2::reemplazarEspeciales($prop["nom2propietario"]) . ']]></nom2propietario>';
                        $xml .= '<ape1propietario><![CDATA[' . \funcionesSii2::reemplazarEspeciales($prop["ape1propietario"]) . ']]></ape1propietario>';
                        $xml .= '<ape2propietario><![CDATA[' . \funcionesSii2::reemplazarEspeciales($prop["ape2propietario"]) . ']]></ape2propietario>';
                        $xml .= '<direccionpropietario><![CDATA[' . \funcionesSii2::reemplazarEspeciales(str_replace("#", "Nro.", $prop["direccionpropietario"])) . ']]></direccionpropietario>';
                        $xml .= '<direccionnotpropietario><![CDATA[' . \funcionesSii2::reemplazarEspeciales(str_replace("#", "Nro.", $prop["direccionnotpropietario"])) . ']]></direccionnotpropietario>';
                        $xml .= '<nomreplegpropietario><![CDATA[' . \funcionesSii2::reemplazarEspeciales($prop["nomreplegpropietario"]) . ']]></nomreplegpropietario>';
                    } else {
                        $xml .= '<nombrepropietario><![CDATA[' . $prop["nombrepropietario"] . ']]></nombrepropietario>';
                        $xml .= '<nom1propietario><![CDATA[' . $prop["nom1propietario"] . ']]></nom1propietario>';
                        $xml .= '<nom2propietario><![CDATA[' . $prop["nom2propietario"] . ']]></nom2propietario>';
                        $xml .= '<ape1propietario><![CDATA[' . $prop["ape1propietario"] . ']]></ape1propietario>';
                        $xml .= '<ape2propietario><![CDATA[' . $prop["ape2propietario"] . ']]></ape2propietario>';
                        $xml .= '<direccionpropietario><![CDATA[' . str_replace("#", "Nro.", $prop["direccionpropietario"]) . ']]></direccionpropietario>';
                        $xml .= '<direccionnotpropietario><![CDATA[' . str_replace("#", "Nro.", $prop["direccionnotpropietario"]) . ']]></direccionnotpropietario>';
                        $xml .= '<nomreplegpropietario><![CDATA[' . $prop["nomreplegpropietario"] . ']]></nomreplegpropietario>';
                    }
                    $xml .= '<municipiopropietario>' . $prop["municipiopropietario"] . '</municipiopropietario>';
                    $xml .= '<municipionotpropietario>' . $prop["municipionotpropietario"] . '</municipionotpropietario>';
                    $xml .= '<telefonopropietario>' . $prop["telefonopropietario"] . '</telefonopropietario>';
                    $xml .= '<telefono2propietario>' . $prop["telefono2propietario"] . '</telefono2propietario>';
                    $xml .= '<celularpropietario>' . $prop["celularpropietario"] . '</celularpropietario>';
                    $xml .= '<numidreplegpropietario>' . $prop["numidreplegpropietario"] . '</numidreplegpropietario>';
                    $xml .= '<tipoidreplegpropietario>' . $prop["tipoidreplegpropietario"] . '</tipoidreplegpropietario>';
                    $xml .= '<fecmatripropietario>' . $prop["fecmatripropietario"] . '</fecmatripropietario>';
                    $xml .= '<ultanorenpropietario>' . $prop["ultanorenpropietario"] . '</ultanorenpropietario>';
                    $xml .= '<organizacionpropietario>' . $prop["organizacionpropietario"] . '</organizacionpropietario>';
                    $xml .= '<estadodatospropietario>' . $prop["estadodatospropietario"] . '</estadodatospropietario>';
                    $xml .= '</propietario>';
                }
            }
        }
        $xml .= '</propietarios>';

        // Establecimientos
        if ($extendido == 'si') {
            $xml .= '<establecimientos>';
            if (
                    ($datos["organizacion"] != '02') &&
                    (($datos["categoria"] == '0') || ($datos["categoria"] == '1'))
            ) {
                if (!empty($datos["establecimientos"])) {
                    foreach ($datos["establecimientos"] as $est) {
                        $xml .= '<establecimiento>';
                        $xml .= '<matriculaestablecimiento>' . ltrim($est["matriculaestablecimiento"], '0') . '</matriculaestablecimiento>';
                        if ($reemplazar == 'si') {
                            $xml .= '<nombreestablecimiento><![CDATA[' . \funcionesSii2::reemplazarEspeciales($est["nombreestablecimiento"]) . ']]></nombreestablecimiento>';
                        } else {
                            $xml .= '<nombreestablecimiento><![CDATA[' . $est["nombreestablecimiento"] . ']]></nombreestablecimiento>';
                        }
                        $xml .= '<estadodatosestablecimiento><![CDATA[' . $est["estadodatosestablecimiento"] . ']]></estadodatosestablecimiento>';
                        $xml .= '<estadomatricula><![CDATA[' . $est["estadomatricula"] . ']]></estadomatricula>';
                        $xml .= '<dircom><![CDATA[' . $est["dircom"] . ']]></dircom>';
                        $xml .= '<telcom1><![CDATA[' . $est["telcom1"] . ']]></telcom1>';
                        $xml .= '<telcom2><![CDATA[' . $est["telcom2"] . ']]></telcom2>';
                        $xml .= '<telcom3><![CDATA[' . $est["telcom3"] . ']]></telcom3>';
                        $xml .= '<muncom><![CDATA[' . $est["muncom"] . ']]></muncom>';
                        $xml .= '<emailcom><![CDATA[' . $est["emailcom"] . ']]></emailcom>';
                        $xml .= '<fechamatricula><![CDATA[' . $est["fechamatricula"] . ']]></fechamatricula>';
                        $xml .= '<fecharenovacion><![CDATA[' . $est["fecharenovacion"] . ']]></fecharenovacion>';
                        $xml .= '<ultanorenovado><![CDATA[' . $est["ultanoren"] . ']]></ultanorenovado>';
                        $xml .= '<actvin><![CDATA[' . $est["actvin"] . ']]></actvin>';
                        $xml .= '<ciiu1><![CDATA[' . $est["ciiu1"] . ']]></ciiu1>';
                        $xml .= '<ciiu2><![CDATA[' . $est["ciiu2"] . ']]></ciiu2>';
                        $xml .= '<ciiu3><![CDATA[' . $est["ciiu3"] . ']]></ciiu3>';
                        $xml .= '<ciiu4><![CDATA[' . $est["ciiu4"] . ']]></ciiu4>';
                        $xml .= '<embargado><![CDATA[' . $est["embargado"] . ']]></embargado>';
                        $xml .= '</establecimiento>';
                    }
                }
            }
            $xml .= '</establecimientos>';
        }

        // Sucuarsales y agencias
        if ($extendido == 'si') {
            $xml .= '<sucursalesagencias>';
            if (
                    ($datos["organizacion"] != '02') &&
                    (($datos["categoria"] == '0') || ($datos["categoria"] == '1'))
            ) {
                if (!empty($datos["sucursalesagencias"])) {
                    foreach ($datos["sucursalesagencias"] as $est) {
                        $xml .= '<sucage>';
                        $xml .= '<matriculasucage>' . ltrim($est["matriculasucage"], '0') . '</matriculasucage>';
                        if ($reemplazar == 'si') {
                            $xml .= '<nombresucage><![CDATA[' . \funcionesSii2::reemplazarEspeciales($est["nombresucage"]) . ']]></nombresucage>';
                        } else {
                            $xml .= '<nombresucage><![CDATA[' . $est["nombresucage"] . ']]></nombresucage>';
                        }
                        $xml .= '<categoria><![CDATA[' . $est["categoria"] . ']]></categoria>';
                        $xml .= '<estado><![CDATA[' . $est["estado"] . ']]></estado>';
                        $xml .= '<dircom><![CDATA[' . $est["dircom"] . ']]></dircom>';
                        $xml .= '<telcom1><![CDATA[' . $est["telcom1"] . ']]></telcom1>';
                        $xml .= '<telcom2><![CDATA[' . $est["telcom2"] . ']]></telcom2>';
                        $xml .= '<telcom3><![CDATA[' . $est["telcom3"] . ']]></telcom3>';
                        $xml .= '<muncom><![CDATA[' . $est["muncom"] . ']]></muncom>';
                        $xml .= '<emailcom><![CDATA[' . $est["emailcom"] . ']]></emailcom>';
                        $xml .= '<fechamatricula><![CDATA[' . $est["fechamatricula"] . ']]></fechamatricula>';
                        $xml .= '<fecharenovacion><![CDATA[' . $est["fecharenovacion"] . ']]></fecharenovacion>';
                        $xml .= '<ultanorenovado><![CDATA[' . $est["ultanoren"] . ']]></ultanorenovado>';
                        $xml .= '<actvin><![CDATA[' . $est["actvin"] . ']]></actvin>';
                        $xml .= '<ciiu1><![CDATA[' . $est["ciiu1"] . ']]></ciiu1>';
                        $xml .= '<ciiu2><![CDATA[' . $est["ciiu2"] . ']]></ciiu2>';
                        $xml .= '<ciiu3><![CDATA[' . $est["ciiu3"] . ']]></ciiu3>';
                        $xml .= '<ciiu4><![CDATA[' . $est["ciiu4"] . ']]></ciiu4>';
                        $xml .= '<embargado><![CDATA[' . $est["embargado"] . ']]></embargado>';

                        $xml .= '</sucage>';
                    }
                }
            }
            $xml .= '</sucursalesagencias>';
        }

        // Referencia a casa principal
        if (
                ($datos["organizacion"] > '02') &&
                (($datos["categoria"] == '2') || ($datos["categoria"] == '3'))
        ) {
            if (!isset($datos["cpcodcam"])) {
                $datos["cpcodcam"] = '';
            }
            if (!isset($datos["cpnummat"])) {
                $datos["cpnummat"] = '';
            }
            if (!isset($datos["cprazsoc"])) {
                $datos["cprazsoc"] = '';
            }
            if (!isset($datos["cpnumnit"])) {
                $datos["cpnumnit"] = '';
            }
            if (!isset($datos["cpdircom"])) {
                $datos["cpdircom"] = '';
            }
            if (!isset($datos["cpdirnot"])) {
                $datos["cpdirnot"] = '';
            }
            if (!isset($datos["cpnumtel"])) {
                $datos["cpnumtel"] = '';
            }
            if (!isset($datos["cpnumfax"])) {
                $datos["cpnumfax"] = '';
            }
            if (!isset($datos["cpcodmun"])) {
                $datos["cpcodmun"] = '';
            }
            if (!isset($datos["cpmunnot"])) {
                $datos["cpmunnot"] = '';
            }
            $xml .= '<cpcodcam>' . trim($datos["cpcodcam"]) . '</cpcodcam>';
            $xml .= '<cpnummat>' . sprintf("%08s", trim($datos["cpnummat"])) . '</cpnummat>';
            if ($reemplazar == 'si') {
                $xml .= '<cprazsoc><![CDATA[' . \funcionesSii2::reemplazarEspeciales(trim($datos["cprazsoc"])) . ']]></cprazsoc>';
            } else {
                $xml .= '<cprazsoc><![CDATA[' . trim($datos["cprazsoc"]) . ']]></cprazsoc>';
            }
            $xml .= '<cpnumnit>' . sprintf("%011s", trim($datos["cpnumnit"])) . '</cpnumnit>';
            if ($reemplazar == 'si') {
                $xml .= '<cpdircom><![CDATA[' . \funcionesSii2::reemplazarEspeciales(trim($datos["cpdircom"])) . ']]></cpdircom>';
            } else {
                $xml .= '<cpdircom><![CDATA[' . trim($datos["cpdircom"]) . ']]></cpdircom>';
            }
            $xml .= '<cpdirnot><![CDATA[' . trim($datos["cpdirnot"]) . ']]></cpdirnot>';
            $xml .= '<cpnumtel>' . trim($datos["cpnumtel"]) . '</cpnumtel>';
            $xml .= '<cpnumfax>' . trim($datos["cpnumfax"]) . '</cpnumfax>';
            $xml .= '<cpcodmun>' . sprintf("%05s", trim($datos["cpcodmun"])) . '</cpcodmun>';
            $xml .= '<cpmunnot>' . sprintf("%05s", trim($datos["cpmunnot"])) . '</cpmunnot>';
        } else {
            $xml .= '<cpcodcam></cpcodcam>';
            $xml .= '<cpnummat></cpnummat>';
            $xml .= '<cprazsoc></cprazsoc>';
            $xml .= '<cpnumnit></cpnumnit>';
            $xml .= '<cpdircom></cpdircom>';
            $xml .= '<cpdirnot></cpdirnot>';
            $xml .= '<cpnumtel></cpnumtel>';
            $xml .= '<cpnumfax></cpnumfax>';
            $xml .= '<cpcodmun></cpcodmun>';
            $xml .= '<cpmunnot></cpmunnot>';
        }

        if ($extendido == 'si') {
            if (isset($datos["vinculos"])) {
                if (!empty($datos["vinculos"])) {
                    foreach ($datos["vinculos"] as $v) {
                        $xml .= '<vinculo>';
                        $xml .= '<idtipoidentificacionotros>' . $v["idtipoidentificacionotros"] . '</idtipoidentificacionotros>';
                        $xml .= '<identificacionotros>' . $v["identificacionotros"] . '</identificacionotros>';
                        if ($reemplazar == 'si') {
                            $xml .= '<nombreotros><![CDATA[' . \funcionesSii2::reemplazarEspeciales($v["nombreotros"]) . ']]></nombreotros>';
                        } else {
                            $xml .= '<nombreotros>' . $v["nombreotros"] . '</nombreotros>';
                        }
                        $xml .= '<vinculootros>' . $v["vinculootros"] . '</vinculootros>';
                        $xml .= '</vinculo>';
                    }
                }
            }
        }

        if ($extendido == 'si') {
            if (isset($datos["vincuprop"])) {
                if (!empty($datos["vincuprop"])) {
                    foreach ($datos["vincuprop"] as $v) {
                        $xml .= '<vp>';
                        $xml .= '<idclase>' . $v["idclase"] . '</idclase>';
                        $xml .= '<numid>' . $v["numid"] . '</numid>';
                        if ($reemplazar == 'si') {
                            $xml .= '<nombre><![CDATA[' . \funcionesSii2::reemplazarEspeciales($v["nombre"]) . ']]></nombre>';
                        } else {
                            $xml .= '<nombre><![CDATA[' . $v["nombre"] . ']]></nombre>';
                        }
                        $xml .= '<vinculo>' . $v["vinculo"] . '</vinculo>';
                        if ($reemplazar == 'si') {
                            $xml .= '<cargo><![CDATA[' . \funcionesSii2::reemplazarEspeciales($v["cargo"]) . ']]></cargo>';
                        } else {
                            $xml .= '<cargo><![CDATA[' . $v["cargo"] . ']]></cargo>';
                        }
                        $xml .= '</vp>';
                    }
                }
            }
        }



        // Inscripciones
        if ($extendido == 'si') {
            if (isset($datos["inscripciones"])) {
                if (!empty($datos["inscripciones"])) {
                    foreach ($datos["inscripciones"] as $ins) {
                        $xml .= '<li>';
                        foreach ($ins as $key => $valor) {
                            if ($key == 'not' || $key == 'not2' || $key == 'not3' || $key == 'txoridoc') {
                                $xml .= '<' . $key . '><![CDATA[' . trim($valor) . ']]></' . $key . '>';
                            } else {
                                $xml .= '<' . $key . '>' . trim($valor) . '</' . $key . '>';
                            }
                        }
                        $xml .= '</li>';
                    }
                }
            }
        }

        // Nombres anteriores
        // if ($extendido == 'si') {
        if (isset($datos["nomant"])) {
            if (!empty($datos["nomant"])) {
                foreach ($datos["nomant"] as $ins) {
                    $xml .= '<na>';
                    $xml .= '<sec>' . $ins["sec"] . "</sec>";
                    $xml .= '<lib>' . $ins["lib"] . "</lib>";
                    $xml .= '<nreg>' . $ins["nreg"] . "</nreg>";
                    $xml .= '<freg>' . $ins["freg"] . "</freg>";
                    $xml .= '<nom><![CDATA[' . \funcionesSii2::reemplazarEspeciales($ins["nom"]) . "]]></nom>";
                    $xml .= '<ope>' . $ins["ope"] . "</ope>";
                    $xml .= '<fcre>' . $ins["fcre"] . "</fcre>";
                    $xml .= '</na>';
                }
            }
        }
        // }
        // Embargos
        // if ($extendido == 'si') {
        if (isset($datos["ctrembargos"])) {
            if (!empty($datos["ctrembargos"])) {
                foreach ($datos["ctrembargos"] as $ins) {
                    $xml .= '<emb>';
                    foreach ($ins as $key => $valor) {
                        $xml .= '<' . $key . '>' . $valor . '</' . $key . '>';
                    }
                    $xml .= '</emb>';
                }
            }
        }
        // }
        //
        $xml .= '</expediente>';
        $xml .= '</expedientes>';

        $f = fopen("../../../tmp/" . ltrim($datos["matricula"], '0') . "-serializacionExpedienteMatricula." . date("Ymd") . '-' . date("His") . ".xml", "w");
        fwrite($f, $xml);
        fclose($f);
        return $xml;
    }

    public static function serializarExpedienteProponente($dbx, $data = '') {
        $xml = '<?xml version="1.0" encoding="utf-8" ?>' . chr(13);
        $xml .= '<expedientes>' . chr(13);
        $xml .= '<expediente>' . chr(13);

        //
        if ($data != '') {

            //
            $xml .= '<tipotramite></tipotramite>' . chr(13);
            $xml .= '<numerorecuperacion></numerorecuperacion>' . chr(13);
            $xml .= '<numeroliquidacion></numeroliquidacion>' . chr(13);
            $xml .= '<numeroradicacion></numeroradicacion>' . chr(13);
            $xml .= '<proponente>' . ltrim($data["proponente"], '0') . '</proponente>' . chr(13);
            $xml .= '<matricula>' . ltrim($data["matricula"], '0') . '</matricula>' . chr(13);
            $xml .= '<nombre><![CDATA[' . \funcionesSii2::reemplazarEspeciales(trim($data["nombre"])) . ']]></nombre>' . chr(13);
            $xml .= '<ape1><![CDATA[' . \funcionesSii2::reemplazarEspeciales(trim($data["ape1"])) . ']]></ape1>' . chr(13);
            $xml .= '<ape2><![CDATA[' . \funcionesSii2::reemplazarEspeciales(trim($data["ape2"])) . ']]></ape2>' . chr(13);
            $xml .= '<nom1><![CDATA[' . \funcionesSii2::reemplazarEspeciales(trim($data["nom1"])) . ']]></nom1>' . chr(13);
            $xml .= '<nom2><![CDATA[' . \funcionesSii2::reemplazarEspeciales(trim($data["nom2"])) . ']]></nom2>' . chr(13);
            $xml .= '<sigla><![CDATA[' . \funcionesSii2::reemplazarEspeciales(trim($data["sigla"])) . ']]></sigla>' . chr(13);
            $xml .= '<idtipoidentificacion>' . $data["idtipoidentificacion"] . '</idtipoidentificacion>' . chr(13);
            $xml .= '<identificacion>' . ltrim($data["identificacion"], '0') . '</identificacion>' . chr(13);
            $xml .= '<idpaisidentificacion>' . $data["idpaisidentificacion"] . '</idpaisidentificacion>' . chr(13);
            $xml .= '<nit>' . ltrim($data["nit"], '0') . '</nit>' . chr(13);
            $xml .= '<nacionalidad><![CDATA[' . trim($data["nacionalidad"]) . ']]></nacionalidad>' . chr(13);
            $xml .= '<organizacion>' . $data["organizacion"] . '</organizacion>' . chr(13);
            $xml .= '<tamanoempresa>' . $data["tamanoempresa"] . '</tamanoempresa>' . chr(13);
            $xml .= '<emprendedor28>' . $data["emprendedor28"] . '</emprendedor28>' . chr(13);
            $xml .= '<pemprendedor28>' . $data["pemprendedor28"] . '</pemprendedor28>' . chr(13);
            $xml .= '<vigcontrol>' . $data["vigcontrol"] . '</vigcontrol>' . chr(13);
            $xml .= '<idestadoproponente>' . $data["idestadoproponente"] . '</idestadoproponente>' . chr(13);
            $xml .= '<certificardesde>' . $data["certificardesde"] . '</certificardesde>' . chr(13);
            $xml .= '<fechaultimainscripcion>' . $data["fechaultimainscripcion"] . '</fechaultimainscripcion>' . chr(13);
            $xml .= '<fechaultimarenovacion>' . $data["fechaultimarenovacion"] . '</fechaultimarenovacion>' . chr(13);
            $xml .= '<fechacancelacion>' . $data["fechacancelacion"] . '</fechacancelacion>' . chr(13);

            // Cambio de domicilio
            $xml .= '<cambidom_idmunicipioorigen>' . $data["cambidom_idmunicipioorigen"] . '</cambidom_idmunicipioorigen>' . chr(13);
            $xml .= '<cambidom_idmunicipiodestino>' . $data["cambidom_idmunicipiodestino"] . '</cambidom_idmunicipiodestino>' . chr(13);
            $xml .= '<cambidom_fechaultimainscripcion>' . $data["cambidom_fechaultimainscripcion"] . '</cambidom_fechaultimainscripcion>' . chr(13);
            $xml .= '<cambidom_fechaultimarenovacion>' . $data["cambidom_fechaultimarenovacion"] . '</cambidom_fechaultimarenovacion>' . chr(13);
            if (isset($data["propcamaraorigen"])) {
                $xml .= '<propcamaraorigen>' . $data["propcamaraorigen"] . '</propcamaraorigen>' . chr(13);
            } else {
                $xml .= '<propcamaraorigen></propcamaraorigen>' . chr(13);
            }
            if (isset($data["propcamaradestino"])) {
                $xml .= '<propcamaradestino>' . $data["propcamaradestino"] . '</propcamaradestino>' . chr(13);
            } else {
                $xml .= '<propcamaradestino></propcamaradestino>' . chr(13);
            }

            // Datos de personer&iacute;a jur&iacute;dica
            $xml .= '<idtipodocperjur>' . $data["idtipodocperjur"] . '</idtipodocperjur>' . chr(13); // A02
            $xml .= '<numdocperjur>' . $data["numdocperjur"] . '</numdocperjur>' . chr(13); // A20
            $xml .= '<fecdocperjur>' . $data["fecdocperjur"] . '</fecdocperjur>' . chr(13); // (D)
            $xml .= '<origendocperjur><![CDATA[' . $data["origendocperjur"] . ']]></origendocperjur>' . chr(13); // A128
            $xml .= '<fechaconstitucion>' . $data["fechaconstitucion"] . '</fechaconstitucion>' . chr(13); // (D)
            $xml .= '<fechavencimiento>' . $data["fechavencimiento"] . '</fechavencimiento>' . chr(13); // (D)
            // Datos de ubicacion
            $xml .= '<dircom><![CDATA[' . \funcionesSii2::reemplazarEspeciales($data["dircom"]) . ']]></dircom>' . chr(13); // A128
            $xml .= '<dircom_tipovia></dircom_tipovia>' . chr(13); //A5
            $xml .= '<dircom_numvia></dircom_numvia>' . chr(13); //A3
            $xml .= '<dircom_apevia></dircom_apevia>' . chr(13); //A5
            $xml .= '<dircom_orivia></dircom_orivia>' . chr(13); //A5
            $xml .= '<dircom_numcruce></dircom_numcruce>' . chr(13); //A3
            $xml .= '<dircom_apecruce></dircom_apecruce>' . chr(13); //A5
            $xml .= '<dircom_oricruce></dircom_oricruce>' . chr(13); //A5
            $xml .= '<dircom_numplaca></dircom_numplaca>' . chr(13); //A3
            $xml .= '<dircom_complemento><![CDATA[]]></dircom_complemento>' . chr(13); //A20
            $xml .= '<muncom>' . $data["muncom"] . '</muncom>' . chr(13);
            $xml .= '<telcom1>' . $data["telcom1"] . '</telcom1>' . chr(13);
            $xml .= '<telcom2>' . $data["telcom2"] . '</telcom2>' . chr(13);
            $xml .= '<celcom>' . $data["celcom"] . '</celcom>' . chr(13);
            $xml .= '<faxcom>' . $data["faxcom"] . '</faxcom>' . chr(13);
            $xml .= '<emailcom><![CDATA[' . $data["emailcom"] . ']]></emailcom>' . chr(13);
            $xml .= '<enviarint>' . $data["enviarint"] . '</enviarint>' . chr(13);
            $xml .= '<dirnot><![CDATA[' . \funcionesSii2::reemplazarEspeciales($data["dirnot"]) . ']]></dirnot>' . chr(13);
            $xml .= '<dirnot_tipovia></dirnot_tipovia>' . chr(13);
            $xml .= '<dirnot_numvia></dirnot_numvia>' . chr(13);
            $xml .= '<dirnot_apevia></dirnot_apevia>' . chr(13);
            $xml .= '<dirnot_orivia></dirnot_orivia>' . chr(13);
            $xml .= '<dirnot_numcruce></dirnot_numcruce>' . chr(13);
            $xml .= '<dirnot_apecruce></dirnot_apecruce>' . chr(13);
            $xml .= '<dirnot_oricruce></dirnot_oricruce>' . chr(13);
            $xml .= '<dirnot_numplaca></dirnot_numplaca>' . chr(13);
            $xml .= '<dirnot_complemento><![CDATA[]]></dirnot_complemento>' . chr(13);
            $xml .= '<munnot>' . $data["munnot"] . '</munnot>' . chr(13);
            $xml .= '<telnot>' . $data["telnot"] . '</telnot>' . chr(13);
            $xml .= '<telnot2>' . $data["telnot2"] . '</telnot2>' . chr(13);
            $xml .= '<celnot>' . $data["celnot"] . '</celnot>' . chr(13);
            $xml .= '<faxnot>' . $data["faxnot"] . '</faxnot>' . chr(13);
            $xml .= '<emailnot><![CDATA[' . $data["emailnot"] . ']]></emailnot>' . chr(13);
            $xml .= '<enviarnot>' . $data["enviarnot"] . '</enviarnot>' . chr(13);


            // Representantes legales
            $xml .= '<representanteslegales>' . chr(13);
            if (!empty($data["representanteslegales"])) {
                foreach ($data["representanteslegales"] as $rep) {
                    $xml .= '<representantelegal>' . chr(13);
                    $xml .= '<idtipoidentificacionrepleg>' . $rep["idtipoidentificacionrepleg"] . "</idtipoidentificacionrepleg>";
                    $xml .= '<identificacionrepleg>' . $rep["identificacionrepleg"] . "</identificacionrepleg>";
                    $xml .= '<nombrerepleg><![CDATA[' . \funcionesSii2::reemplazarEspeciales($rep["nombrerepleg"]) . "]]></nombrerepleg>";
                    $xml .= '<cargorepleg><![CDATA[' . \funcionesSii2::reemplazarEspeciales($rep["cargorepleg"]) . "]]></cargorepleg>";
                    $xml .= '</representantelegal>' . chr(13);
                }
            }
            $xml .= '</representanteslegales>' . chr(13);


            // Facultades
            if (isset($data["facultades"])) {
                $xml .= '<facultades><![CDATA[' . \funcionesSii2::reemplazarEspeciales(trim($data["facultades"])) . ']]></facultades>' . chr(13);
            } else {
                $data["facultades"] = '';
                $xml .= '<facultades><![CDATA[' . \funcionesSii2::reemplazarEspeciales(trim($data["facultades"])) . ']]></facultades>' . chr(13);
            }


            // Situaciones de control
            if (!empty($data["sitcontrol"])) {
                foreach ($data["sitcontrol"] as $rep) {
                    $xml .= '<sitcontrol>' . chr(13);
                    $xml .= '<nombre><![CDATA[' . $rep["nombre"] . ']]></nombre>';
                    $xml .= '<identificacion>' . $rep["identificacion"] . '</identificacion>';
                    $xml .= '<domicilio>' . $rep["domicilio"] . '</domicilio>';
                    $xml .= '<tipo>' . $rep["tipo"] . '</tipo>';
                    $xml .= '</sitcontrol>' . chr(13);
                }
            }

            // Informacion financiera - Decreto 1510
            $xml .= '<inffin1510_fechacorte>' . $data["inffin1510_fechacorte"] . '</inffin1510_fechacorte>' . chr(13);
            $xml .= '<inffin1510_actcte>' . $data["inffin1510_actcte"] . '</inffin1510_actcte>' . chr(13);
            if (isset($data["inffin1510_actnocte"])) {
                $xml .= '<inffin1510_actnocte>' . $data["inffin1510_actnocte"] . '</inffin1510_actnocte>' . chr(13);
            } else {
                $xml .= '<inffin1510_actnocte>0</inffin1510_actnocte>' . chr(13);
            }
            $xml .= '<inffin1510_fijnet>' . $data["inffin1510_fijnet"] . '</inffin1510_fijnet>' . chr(13);
            $xml .= '<inffin1510_actotr>' . $data["inffin1510_actotr"] . '</inffin1510_actotr>' . chr(13);
            $xml .= '<inffin1510_actval>' . $data["inffin1510_actval"] . '</inffin1510_actval>' . chr(13);
            $xml .= '<inffin1510_acttot>' . $data["inffin1510_acttot"] . '</inffin1510_acttot>' . chr(13);

            $xml .= '<inffin1510_pascte>' . $data["inffin1510_pascte"] . '</inffin1510_pascte>' . chr(13);
            $xml .= '<inffin1510_paslar>' . $data["inffin1510_paslar"] . '</inffin1510_paslar>' . chr(13);
            $xml .= '<inffin1510_pastot>' . $data["inffin1510_pastot"] . '</inffin1510_pastot>' . chr(13);
            $xml .= '<inffin1510_patnet>' . $data["inffin1510_patnet"] . '</inffin1510_patnet>' . chr(13);
            $xml .= '<inffin1510_paspat>' . $data["inffin1510_paspat"] . '</inffin1510_paspat>' . chr(13);
            if (isset($data["inffin1510_balsoc"])) {
                $xml .= '<inffin1510_balsoc>' . $data["inffin1510_balsoc"] . '</inffin1510_balsoc>' . chr(13);
            } else {
                $xml .= '<inffin1510_balsoc>0</inffin1510_balsoc>' . chr(13);
            }
            $xml .= '<inffin1510_ingope>' . $data["inffin1510_ingope"] . '</inffin1510_ingope>' . chr(13);
            $xml .= '<inffin1510_ingnoope>' . $data["inffin1510_ingnoope"] . '</inffin1510_ingnoope>' . chr(13);
            $xml .= '<inffin1510_gasope>' . $data["inffin1510_gasope"] . '</inffin1510_gasope>' . chr(13);
            $xml .= '<inffin1510_gasnoope>' . $data["inffin1510_gasnoope"] . '</inffin1510_gasnoope>' . chr(13);
            $xml .= '<inffin1510_cosven>' . $data["inffin1510_cosven"] . '</inffin1510_cosven>' . chr(13);
            $xml .= '<inffin1510_utiope>' . $data["inffin1510_utiope"] . '</inffin1510_utiope>' . chr(13);
            $xml .= '<inffin1510_utinet>' . $data["inffin1510_utinet"] . '</inffin1510_utinet>' . chr(13);
            $xml .= '<inffin1510_gasint>' . $data["inffin1510_gasint"] . '</inffin1510_gasint>' . chr(13);
            if (isset($data["inffin1510_gasimp"])) {
                $xml .= '<inffin1510_gasimp>' . $data["inffin1510_gasimp"] . '</inffin1510_gasimp>' . chr(13);
            } else {
                $xml .= '<inffin1510_gasimp>0</inffin1510_gasimp>' . chr(13);
            }

            $xml .= '<inffin1510_indliq>' . $data["inffin1510_indliq"] . '</inffin1510_indliq>' . chr(13);
            $xml .= '<inffin1510_nivend>' . $data["inffin1510_nivend"] . '</inffin1510_nivend>' . chr(13);
            $xml .= '<inffin1510_razcob>' . $data["inffin1510_razcob"] . '</inffin1510_razcob>' . chr(13);
            $xml .= '<inffin1510_renpat>' . $data["inffin1510_renpat"] . '</inffin1510_renpat>' . chr(13);
            $xml .= '<inffin1510_renact>' . $data["inffin1510_renact"] . '</inffin1510_renact>' . chr(13);
            if (!isset($data["inffin1510_gruponiif"])) {
                $data["inffin1510_gruponiif"] = '';
            }
            $xml .= '<inffin1510_gruponiif>' . $data["inffin1510_gruponiif"] . '</inffin1510_gruponiif>' . chr(13);


            // Experiencia decreto 1510
            $i = 0;
            if (isset($data["exp1510"])) {
                if (count($data["exp1510"]) > 0) {
                    foreach ($data["exp1510"] as $cnt) {
                        if (trim($cnt["nombrecontratante"]) != '') {
                            $i++;
                            $xml .= '<exp1510>';
                            if (strlen(ltrim(trim($cnt["secuencia"]), "0")) <= 3) {
                                $xml .= '<secuencia>' . sprintf("%03s", $cnt["secuencia"]) . '</secuencia>';
                            } else {
                                $xml .= '<secuencia>' . $cnt["secuencia"] . '</secuencia>';
                            }
                            $xml .= '<clavecontrato>' . $cnt["clavecontrato"] . '</clavecontrato>';
                            $xml .= '<celebradopor>' . $cnt["celebradopor"] . '</celebradopor>';
                            $xml .= '<nombrecontratista><![CDATA[' . (\funcionesSii2::reemplazarEspeciales($cnt["nombrecontratista"])) . ']]></nombrecontratista>';
                            $xml .= '<nombrecontratante><![CDATA[' . (\funcionesSii2::reemplazarEspeciales($cnt["nombrecontratante"])) . ']]></nombrecontratante>';
                            if (isset($cnt["fecejecucion"])) {
                                $xml .= '<fecejecucion>' . $cnt["fecejecucion"] . '</fecejecucion>';
                            } else {
                                $xml .= '<fecejecucion></fecejecucion>';
                            }
                            if (isset($cnt["valorpesos"])) {
                                $xml .= '<valorpesos>' . $cnt["valorpesos"] . '</valorpesos>';
                            } else {
                                $xml .= '<valorpesos></valorpesos>';
                            }
                            $xml .= '<valor>' . $cnt["valor"] . '</valor>';
                            $xml .= '<porcentaje>' . $cnt["porcentaje"] . '</porcentaje>';
                            if (isset($cnt["clasif"])) {
                                foreach ($cnt["clasif"] as $c) {
                                    $xml .= '<clasif>' . trim($c) . '</clasif>';
                                }
                            }
                            $xml .= '<generardeclaracion>' . $cnt["generardeclaracion"] . '</generardeclaracion>' . chr(13);
                            $xml .= '</exp1510>';
                        }
                    }
                }
            }

            //
            if (isset($data["clasi1510"])) {
                asort($data["clasi1510"]);
                foreach ($data["clasi1510"] as $c) {
                    $xml .= '<cla1510>' . trim($c) . '</cla1510>';
                }
            }


            // Bienes
            $xml .= '<bienes>';
            if (!empty($data["bienes"])) {
                foreach ($data["bienes"] as $bien) {
                    $xml .= '<bien>';
                    $xml .= '<matinmo>' . $bien["matinmo"] . '</matinmo>';
                    $xml .= '<dir>' . $bien["dir"] . '</dir>';
                    $xml .= '<barrio>' . $bien["barrio"] . '</barrio>';
                    $xml .= '<muni>' . $bien["muni"] . '</muni>';
                    $xml .= '<dpto>' . $bien["muni"] . '</dpto>';
                    $xml .= '<pais>' . $bien["pais"] . '</pais>';
                    $xml .= '</bien>';
                }
            }
            $xml .= '</bienes>';

            foreach ($data["contratos"] as $cnt) {

                if (!isset($cnt["isn"])) {
                    $cnt["isn"] = '';
                }
                if (!isset($cnt["codcamara"])) {
                    $cnt["codcamara"] = '';
                }
                if (!isset($cnt["numradic"])) {
                    $cnt["numradic"] = '';
                }
                if (!isset($cnt["fecradic"])) {
                    $cnt["fecradic"] = '';
                }
                if (!isset($cnt["horradic"])) {
                    $cnt["horradic"] = '';
                }
                if (!isset($cnt["fecreporte"])) {
                    $cnt["fecreporte"] = '';
                }
                if (!isset($cnt["nitentidad"])) {
                    $cnt["nitentidad"] = '';
                }
                if (!isset($cnt["nombreentidad"])) {
                    $cnt["nombreentidad"] = '';
                }
                if (!isset($cnt["idmunientidad"])) {
                    $cnt["idmunientidad"] = '';
                }
                if (!isset($cnt["divarea"])) {
                    $cnt["divarea"] = '';
                }
                if (!isset($cnt["idefun"])) {
                    $cnt["idefun"] = '';
                }
                if (!isset($cnt["nomfun"])) {
                    $cnt["nomfun"] = '';
                }
                if (!isset($cnt["carfun"])) {
                    $cnt["carfun"] = '';
                }
                if (!isset($cnt["numcontrato"])) {
                    $cnt["numcontrato"] = '';
                }
                if (!isset($cnt["numcontratosecop"])) {
                    $cnt["numcontratosecop"] = '';
                }

                if (!isset($cnt["fechaadj"])) {
                    $cnt["fechaadj"] = '';
                }
                if (!isset($cnt["fechaper"])) {
                    $cnt["fechaper"] = '';
                }
                if (!isset($cnt["fechaini"])) {
                    $cnt["fechaini"] = '';
                }
                if (!isset($cnt["fechater"])) {
                    $cnt["fechater"] = '';
                }
                if (!isset($cnt["fechaeje"])) {
                    $cnt["fechaeje"] = '';
                }
                if (!isset($cnt["fechasus"])) {
                    $cnt["fechasus"] = '';
                }
                if (!isset($cnt["fechaliq"])) {
                    $cnt["fechaliq"] = '';
                }
                if (!isset($cnt["fechaterant"])) {
                    $cnt["fechaterant"] = '';
                }
                if (!isset($cnt["fechaces"])) {
                    $cnt["fechaces"] = '';
                }

                if (!isset($cnt["codigoact"])) {
                    $cnt["codigoact"] = '';
                }
                if (!isset($cnt["ciiu1"])) {
                    $cnt["ciiu1"] = '';
                }
                if (!isset($cnt["ciiu2"])) {
                    $cnt["ciiu2"] = '';
                }
                if (!isset($cnt["ciiu3"])) {
                    $cnt["ciiu3"] = '';
                }
                if (!isset($cnt["ciiu4"])) {
                    $cnt["ciiu4"] = '';
                }
                if (!isset($cnt["objeto"])) {
                    $cnt["objeto"] = '';
                }
                if (!isset($cnt["tipocont"])) {
                    $cnt["tipocont"] = '';
                }
                if (!isset($cnt["valorcont"])) {
                    $cnt["valorcont"] = '';
                }
                if (!isset($cnt["valorcontpag"])) {
                    $cnt["valorcontpag"] = '';
                }
                if (!isset($cnt["indcump"])) {
                    $cnt["indcump"] = '';
                }
                if (!isset($cnt["estadocont"])) {
                    $cnt["estadocont"] = '';
                }
                if (!isset($cnt["motivoter"])) {
                    $cnt["motivoter"] = '';
                }
                if (!isset($cnt["motivoces"])) {
                    $cnt["motivoces"] = '';
                }
                if (!isset($cnt["observaciones"])) {
                    $cnt["observaciones"] = '';
                }
                if (!isset($cnt["numlibro"])) {
                    $cnt["numlibro"] = '';
                }
                if (!isset($cnt["numreglib"])) {
                    $cnt["numreglib"] = '';
                }
                if (!isset($cnt["fecreglib"])) {
                    $cnt["fecreglib"] = '';
                }
                if (!isset($cnt["codigocamaraorigen"])) {
                    $cnt["codigocamaraorigen"] = '';
                }
                if (!isset($cnt["numregistrocamaraorigen"])) {
                    $cnt["numregistrocamaraorigen"] = '';
                }
                if (!isset($cnt["fecregistrocamaraorigen"])) {
                    $cnt["fecregistrocamaraorigen"] = '';
                }

                $xml .= '<contrato>' . chr(13);
                $xml .= '<isn>' . $cnt["isn"] . '</isn>' . chr(13);
                $xml .= '<codcamara>' . $cnt["codcamara"] . '</codcamara>' . chr(13);
                $xml .= '<numradic>' . $cnt["numradic"] . '</numradic>' . chr(13);
                $xml .= '<fecradic>' . $cnt["fecradic"] . '</fecradic>' . chr(13);
                $xml .= '<horradic>' . $cnt["horradic"] . '</horradic>' . chr(13);
                $xml .= '<fecreporte>' . $cnt["fecreporte"] . '</fecreporte>' . chr(13);
                $xml .= '<nitentidad>' . $cnt["nitentidad"] . '</nitentidad>' . chr(13);
                $xml .= '<nombreentidad>' . $cnt["nombreentidad"] . '</nombreentidad>' . chr(13);
                $xml .= '<idmunientidad>' . $cnt["idmunientidad"] . '</idmunientidad>' . chr(13);
                $xml .= '<divarea>' . $cnt["divarea"] . '</divarea>' . chr(13);
                $xml .= '<idefun>' . $cnt["idefun"] . '</idefun>' . chr(13);
                $xml .= '<nomfun>' . $cnt["nomfun"] . '</nomfun>' . chr(13);
                $xml .= '<carfun>' . $cnt["carfun"] . '</carfun>' . chr(13);
                $xml .= '<numcontrato>' . $cnt["numcontrato"] . '</numcontrato>' . chr(13);
                $xml .= '<numcontratosecop>' . $cnt["numcontratosecop"] . '</numcontratosecop>' . chr(13);
                $xml .= '<fechaadj>' . $cnt["fechaadj"] . '</fechaadj>' . chr(13);
                $xml .= '<fechaper>' . $cnt["fechaper"] . '</fechaper>' . chr(13);
                $xml .= '<fechaini>' . $cnt["fechaini"] . '</fechaini>' . chr(13);
                $xml .= '<fechater>' . $cnt["fechater"] . '</fechater>' . chr(13);
                $xml .= '<fechaeje>' . $cnt["fechaeje"] . '</fechaeje>' . chr(13);
                $xml .= '<fechaliq>' . $cnt["fechaliq"] . '</fechaliq>' . chr(13);
                $xml .= '<fechaterant>' . $cnt["fechaterant"] . '</fechaterant>' . chr(13);
                $xml .= '<fechaces>' . $cnt["fechaces"] . '</fechaces>' . chr(13);
                $xml .= '<codigoact>' . $cnt["codigoact"] . '</codigoact>' . chr(13);
                $xml .= '<ciiu1>' . $cnt["ciiu1"] . '</ciiu1>' . chr(13);
                $xml .= '<ciiu2>' . $cnt["ciiu2"] . '</ciiu2>' . chr(13);
                $xml .= '<ciiu3>' . $cnt["ciiu3"] . '</ciiu3>' . chr(13);
                $xml .= '<ciiu4>' . $cnt["ciiu4"] . '</ciiu4>' . chr(13);
                $xml .= '<tipocont>' . $cnt["tipocont"] . '</tipocont>' . chr(13);
                $xml .= '<valorcont>' . $cnt["valorcont"] . '</valorcont>' . chr(13);
                $xml .= '<valorcontpag>' . $cnt["valorcontpag"] . '</valorcontpag>' . chr(13);
                $xml .= '<indcump>' . $cnt["indcump"] . '</indcump>' . chr(13);
                $xml .= '<estadocont>' . $cnt["estadocont"] . '</estadocont>' . chr(13);
                $xml .= '<motivoter>' . $cnt["motivoter"] . '</motivoter>' . chr(13);
                $xml .= '<motivoces>' . $cnt["motivoces"] . '</motivoces>' . chr(13);
                $xml .= '<observaciones>' . $cnt["observaciones"] . '</observaciones>' . chr(13);
                $xml .= '<numlibro>' . $cnt["numlibro"] . '</numlibro>' . chr(13);
                $xml .= '<numreglib>' . $cnt["numreglib"] . '</numreglib>' . chr(13);
                $xml .= '<fecreglib>' . $cnt["fecreglib"] . '</fecreglib>' . chr(13);
                if (isset($cnt["clasificaciones"])) {
                    if (!empty($cnt["clasificaciones"])) {
                        foreach ($cnt["clasificaciones"] as $clasicon) {
                            $xml .= '<clasicon>' . $clasicon . '</clasicon>' . chr(13);
                        }
                    }
                }
                if (isset($cnt["unspsc"])) {
                    if (!empty($cnt["unspsc"])) {
                        foreach ($cnt["unspsc"] as $clasicon) {
                            $xml .= '<unspsc>' . $clasicon . '</unspsc>' . chr(13);
                        }
                    }
                }
                $xml .= '<codigocamaraorigen>' . $cnt["codigocamaraorigen"] . '</codigocamaraorigen>' . chr(13);
                $xml .= '<numregistrocamaraorigen>' . $cnt["numregistrocamaraorigen"] . '</numregistrocamaraorigen>' . chr(13);
                $xml .= '<fecregistrocamaraorigen>' . $cnt["fecregistrocamaraorigen"] . '</fecregistrocamaraorigen>' . chr(13);
                $xml .= '</contrato>' . chr(13);
            }

            foreach ($data["multas"] as $cnt) {

                if (!isset($cnt["isn"])) {
                    $cnt["isn"] = '';
                }
                if (!isset($cnt["codcamara"])) {
                    $cnt["codcamara"] = '';
                }
                if (!isset($cnt["numradic"])) {
                    $cnt["numradic"] = '';
                }
                if (!isset($cnt["fecradic"])) {
                    $cnt["fecradic"] = '';
                }
                if (!isset($cnt["horradic"])) {
                    $cnt["horradic"] = '';
                }
                if (!isset($cnt["fecreporte"])) {
                    $cnt["fecreporte"] = '';
                }
                if (!isset($cnt["nitentidad"])) {
                    $cnt["nitentidad"] = '';
                }
                if (!isset($cnt["nombreentidad"])) {
                    $cnt["nombreentidad"] = '';
                }
                if (!isset($cnt["idmunientidad"])) {
                    $cnt["idmunientidad"] = '';
                }
                if (!isset($cnt["divarea"])) {
                    $cnt["divarea"] = '';
                }
                if (!isset($cnt["idefun"])) {
                    $cnt["idefun"] = '';
                }
                if (!isset($cnt["nomfun"])) {
                    $cnt["nomfun"] = '';
                }
                if (!isset($cnt["carfun"])) {
                    $cnt["carfun"] = '';
                }
                if (!isset($cnt["numcontrato"])) {
                    $cnt["numcontrato"] = '';
                }
                if (!isset($cnt["numcontratosecop"])) {
                    $cnt["numcontratosecop"] = '';
                }
                if (!isset($cnt["numacto"])) {
                    $cnt["numacto"] = '';
                }
                if (!isset($cnt["fechaacto"])) {
                    $cnt["fechaacto"] = '';
                }
                if (!isset($cnt["fechaeje"])) {
                    $cnt["fechaeje"] = '';
                }
                if (!isset($cnt["valormult"])) {
                    $cnt["valormult"] = '';
                }
                if (!isset($cnt["valormultpag"])) {
                    $cnt["valormultpag"] = '';
                }
                if (!isset($cnt["numsus"])) {
                    $cnt["numsus"] = '';
                }
                if (!isset($cnt["fechasus"])) {
                    $cnt["fechasus"] = '';
                }
                if (!isset($cnt["numconf"])) {
                    $cnt["numconf"] = '';
                }
                if (!isset($cnt["fechaconf"])) {
                    $cnt["fechaconf"] = '';
                }
                if (!isset($cnt["estadomult"])) {
                    $cnt["estadomult"] = '';
                }
                if (!isset($cnt["numrev"])) {
                    $cnt["numrev"] = '';
                }
                if (!isset($cnt["fechanumrev"])) {
                    $cnt["fechanumrev"] = '';
                }
                if (!isset($cnt["numlibro"])) {
                    $cnt["numlibro"] = '';
                }
                if (!isset($cnt["numreglib"])) {
                    $cnt["numreglib"] = '';
                }
                if (!isset($cnt["fecreglib"])) {
                    $cnt["fecreglib"] = '';
                }
                if (!isset($cnt["codigocamaraorigen"])) {
                    $cnt["codigocamaraorigen"] = '';
                }
                if (!isset($cnt["numregistrocamaraorigen"])) {
                    $cnt["numregistrocamaraorigen"] = '';
                }
                if (!isset($cnt["fecregistrocamaraorigen"])) {
                    $cnt["fecregistrocamaraorigen"] = '';
                }


                $xml .= '<multa>' . chr(13);
                $xml .= '<isn>' . $cnt["isn"] . '</isn>' . chr(13);
                $xml .= '<codcamara>' . $cnt["codcamara"] . '</codcamara>' . chr(13);
                $xml .= '<numradic>' . $cnt["numradic"] . '</numradic>' . chr(13);
                $xml .= '<fecradic>' . $cnt["fecradic"] . '</fecradic>' . chr(13);
                $xml .= '<horradic>' . $cnt["horradic"] . '</horradic>' . chr(13);
                $xml .= '<fecreporte>' . $cnt["fecreporte"] . '</fecreporte>' . chr(13);
                $xml .= '<nitentidad>' . $cnt["nitentidad"] . '</nitentidad>' . chr(13);
                $xml .= '<nombreentidad>' . $cnt["nombreentidad"] . '</nombreentidad>' . chr(13);
                $xml .= '<idmunientidad>' . $cnt["idmunientidad"] . '</idmunientidad>' . chr(13);
                $xml .= '<divarea>' . $cnt["divarea"] . '</divarea>' . chr(13);
                $xml .= '<idefun>' . $cnt["idefun"] . '</idefun>' . chr(13);
                $xml .= '<nomfun>' . $cnt["nomfun"] . '</nomfun>' . chr(13);
                $xml .= '<carfun>' . $cnt["carfun"] . '</carfun>' . chr(13);
                $xml .= '<numcontrato>' . $cnt["numcontrato"] . '</numcontrato>' . chr(13);
                $xml .= '<numcontratosecop>' . $cnt["numcontratosecop"] . '</numcontratosecop>' . chr(13);
                $xml .= '<numacto>' . $cnt["numacto"] . '</numacto>' . chr(13);
                $xml .= '<fechaacto>' . $cnt["fechaacto"] . '</fechaacto>' . chr(13);
                $xml .= '<fechaeje>' . $cnt["fechaeje"] . '</fechaeje>' . chr(13);
                $xml .= '<valormult>' . $cnt["valormult"] . '</valormult>' . chr(13);
                $xml .= '<valormultpag>' . $cnt["valormultpag"] . '</valormultpag>' . chr(13);
                $xml .= '<numsus>' . $cnt["numsus"] . '</numsus>' . chr(13);
                $xml .= '<fechasus>' . $cnt["fechasus"] . '</fechasus>' . chr(13);
                $xml .= '<numconf>' . $cnt["numconf"] . '</numconf>' . chr(13);
                $xml .= '<fechaconf>' . $cnt["fechaconf"] . '</fechaconf>' . chr(13);
                $xml .= '<estadomult>' . $cnt["estadomult"] . '</estadomult>' . chr(13);
                $xml .= '<numrev>' . $cnt["numrev"] . '</numrev>' . chr(13);
                $xml .= '<fechanumrev>' . $cnt["fechanumrev"] . '</fechanumrev>' . chr(13);
                $xml .= '<numlibro>' . $cnt["numlibro"] . '</numlibro>' . chr(13);
                $xml .= '<numreglib>' . $cnt["numreglib"] . '</numreglib>' . chr(13);
                $xml .= '<fecreglib>' . $cnt["fecreglib"] . '</fecreglib>' . chr(13);
                $xml .= '<codigocamaraorigen>' . $cnt["codigocamaraorigen"] . '</codigocamaraorigen>' . chr(13);
                $xml .= '<numregistrocamaraorigen>' . $cnt["numregistrocamaraorigen"] . '</numregistrocamaraorigen>' . chr(13);
                $xml .= '<fecregistrocamaraorigen>' . $cnt["fecregistrocamaraorigen"] . '</fecregistrocamaraorigen>' . chr(13);
                $xml .= '</multa>' . chr(13);
            }

            foreach ($data["sanciones"] as $cnt) {
                if (!isset($cnt["isn"])) {
                    $cnt["isn"] = '';
                }
                if (!isset($cnt["codcamara"])) {
                    $cnt["codcamara"] = '';
                }
                if (!isset($cnt["numradic"])) {
                    $cnt["numradic"] = '';
                }
                if (!isset($cnt["fecradic"])) {
                    $cnt["fecradic"] = '';
                }
                if (!isset($cnt["horradic"])) {
                    $cnt["horradic"] = '';
                }
                if (!isset($cnt["fecreporte"])) {
                    $cnt["fecreporte"] = '';
                }
                if (!isset($cnt["nitentidad"])) {
                    $cnt["nitentidad"] = '';
                }
                if (!isset($cnt["nombreentidad"])) {
                    $cnt["nombreentidad"] = '';
                }
                if (!isset($cnt["idmunientidad"])) {
                    $cnt["idmunientidad"] = '';
                }
                if (!isset($cnt["divarea"])) {
                    $cnt["divarea"] = '';
                }
                if (!isset($cnt["idefun"])) {
                    $cnt["idefun"] = '';
                }
                if (!isset($cnt["nomfun"])) {
                    $cnt["nomfun"] = '';
                }
                if (!isset($cnt["carfun"])) {
                    $cnt["carfun"] = '';
                }
                if (!isset($cnt["numcontrato"])) {
                    $cnt["numcontrato"] = '';
                }
                if (!isset($cnt["numcontratosecop"])) {
                    $cnt["numcontratosecop"] = '';
                }
                if (!isset($cnt["numacto"])) {
                    $cnt["numacto"] = '';
                }
                if (!isset($cnt["fechaacto"])) {
                    $cnt["fechaacto"] = '';
                }
                if (!isset($cnt["fechaeje"])) {
                    $cnt["fechaeje"] = '';
                }
                if (!isset($cnt["numsus"])) {
                    $cnt["numsus"] = '';
                }
                if (!isset($cnt["fechasus"])) {
                    $cnt["fechasus"] = '';
                }
                if (!isset($cnt["numconf"])) {
                    $cnt["numconf"] = '';
                }
                if (!isset($cnt["fechaconf"])) {
                    $cnt["fechaconf"] = '';
                }
                if (!isset($cnt["estadosanc"])) {
                    $cnt["estadosanc"] = '';
                }
                if (!isset($cnt["condinc"])) {
                    $cnt["condinc"] = '';
                }
                if (!isset($cnt["cumsanc"])) {
                    $cnt["cumsanc"] = '';
                }
                if (!isset($cnt["numrev"])) {
                    $cnt["numrev"] = '';
                }
                if (!isset($cnt["fechanumrev"])) {
                    $cnt["fechanumrev"] = '';
                }
                if (!isset($cnt["descripcion"])) {
                    $cnt["descripcion"] = '';
                }
                if (!isset($cnt["fundamento"])) {
                    $cnt["fundamento"] = '';
                }
                if (!isset($cnt["vigencia"])) {
                    $cnt["vigencia"] = '';
                }
                if (!isset($cnt["numlibro"])) {
                    $cnt["numlibro"] = '';
                }
                if (!isset($cnt["numreglib"])) {
                    $cnt["numreglib"] = '';
                }
                if (!isset($cnt["fecreglib"])) {
                    $cnt["fecreglib"] = '';
                }
                if (!isset($cnt["codigocamaraorigen"])) {
                    $cnt["codigocamaraorigen"] = '';
                }
                if (!isset($cnt["numregistrocamaraorigen"])) {
                    $cnt["numregistrocamaraorigen"] = '';
                }
                if (!isset($cnt["fecregistrocamaraorigen"])) {
                    $cnt["fecregistrocamaraorigen"] = '';
                }


                $xml .= '<sancion>' . chr(13);
                $xml .= '<isn>' . $cnt["isn"] . '</isn>' . chr(13);
                $xml .= '<codcamara>' . $cnt["codcamara"] . '</codcamara>' . chr(13);
                $xml .= '<numradic>' . $cnt["numradic"] . '</numradic>' . chr(13);
                $xml .= '<fecradic>' . $cnt["fecradic"] . '</fecradic>' . chr(13);
                $xml .= '<horradic>' . $cnt["horradic"] . '</horradic>' . chr(13);
                $xml .= '<fecreporte>' . $cnt["fecreporte"] . '</fecreporte>' . chr(13);
                $xml .= '<nitentidad>' . $cnt["nitentidad"] . '</nitentidad>' . chr(13);
                $xml .= '<nombreentidad>' . $cnt["nombreentidad"] . '</nombreentidad>' . chr(13);
                $xml .= '<idmunientidad>' . $cnt["idmunientidad"] . '</idmunientidad>' . chr(13);
                $xml .= '<divarea>' . $cnt["divarea"] . '</divarea>' . chr(13);
                $xml .= '<idefun>' . $cnt["idefun"] . '</idefun>' . chr(13);
                $xml .= '<nomfun>' . $cnt["nomfun"] . '</nomfun>' . chr(13);
                $xml .= '<carfun>' . $cnt["carfun"] . '</carfun>' . chr(13);
                $xml .= '<numcontrato>' . $cnt["numcontrato"] . '</numcontrato>' . chr(13);
                $xml .= '<numcontratosecop>' . $cnt["numcontratosecop"] . '</numcontratosecop>' . chr(13);
                $xml .= '<numacto>' . $cnt["numacto"] . '</numacto>' . chr(13);
                $xml .= '<fechaacto>' . $cnt["fechaacto"] . '</fechaacto>' . chr(13);
                $xml .= '<fechaeje>' . $cnt["fechaeje"] . '</fechaeje>' . chr(13);
                $xml .= '<numsus>' . $cnt["numsus"] . '</numsus>' . chr(13);
                $xml .= '<fechasus>' . $cnt["fechasus"] . '</fechasus>' . chr(13);
                $xml .= '<numconf>' . $cnt["numconf"] . '</numconf>' . chr(13);
                $xml .= '<fechaconf>' . $cnt["fechaconf"] . '</fechaconf>' . chr(13);
                $xml .= '<estadosanc>' . $cnt["estadosanc"] . '</estadosanc>' . chr(13);
                $xml .= '<condinc>' . $cnt["condinc"] . '</condinc>' . chr(13);
                $xml .= '<cumsanc>' . $cnt["cumsanc"] . '</cumsanc>' . chr(13);
                $xml .= '<numrev>' . $cnt["numrev"] . '</numrev>' . chr(13);
                $xml .= '<dessanc>' . $cnt["descripcion"] . '</dessanc>' . chr(13);
                $xml .= '<fundamento>' . $cnt["fundamento"] . '</fundamento>' . chr(13);
                $xml .= '<vigencia>' . $cnt["vigencia"] . '</vigencia>' . chr(13);
                $xml .= '<fechanumrev>' . $cnt["fechanumrev"] . '</fechanumrev>' . chr(13);
                $xml .= '<numlibro>' . $cnt["numlibro"] . '</numlibro>' . chr(13);
                $xml .= '<numreglib>' . $cnt["numreglib"] . '</numreglib>' . chr(13);
                $xml .= '<fecreglib>' . $cnt["fecreglib"] . '</fecreglib>' . chr(13);
                $xml .= '<codigocamaraorigen>' . $cnt["codigocamaraorigen"] . '</codigocamaraorigen>' . chr(13);
                $xml .= '<numregistrocamaraorigen>' . $cnt["numregistrocamaraorigen"] . '</numregistrocamaraorigen>' . chr(13);
                $xml .= '<fecregistrocamaraorigen>' . $cnt["fecregistrocamaraorigen"] . '</fecregistrocamaraorigen>' . chr(13);
                $xml .= '</sancion>' . chr(13);
            }

            foreach ($data["sandis"] as $cnt) {
                if (!isset($cnt["isn"])) {
                    $cnt["isn"] = '';
                }
                if (!isset($cnt["codcamara"])) {
                    $cnt["codcamara"] = '';
                }
                if (!isset($cnt["numradic"])) {
                    $cnt["numradic"] = '';
                }
                if (!isset($cnt["fecradic"])) {
                    $cnt["fecradic"] = '';
                }
                if (!isset($cnt["horradic"])) {
                    $cnt["horradic"] = '';
                }
                if (!isset($cnt["fecreporte"])) {
                    $cnt["fecreporte"] = '';
                }
                if (!isset($cnt["nitentidad"])) {
                    $cnt["nitentidad"] = '';
                }
                if (!isset($cnt["nombreentidad"])) {
                    $cnt["nombreentidad"] = '';
                }
                if (!isset($cnt["idmunientidad"])) {
                    $cnt["idmunientidad"] = '';
                }
                if (!isset($cnt["divarea"])) {
                    $cnt["divarea"] = '';
                }
                if (!isset($cnt["idefun"])) {
                    $cnt["idefun"] = '';
                }
                if (!isset($cnt["nomfun"])) {
                    $cnt["nomfun"] = '';
                }
                if (!isset($cnt["carfun"])) {
                    $cnt["carfun"] = '';
                }
                if (!isset($cnt["numcontratosecop"])) {
                    $cnt["numcontratosecop"] = '';
                }
                if (!isset($cnt["numacto"])) {
                    $cnt["numacto"] = '';
                }
                if (!isset($cnt["fechaacto"])) {
                    $cnt["fechaacto"] = '';
                }
                if (!isset($cnt["fechaeje"])) {
                    $cnt["fechaeje"] = '';
                }
                if (!isset($cnt["numsus"])) {
                    $cnt["numsus"] = '';
                }
                if (!isset($cnt["fechasus"])) {
                    $cnt["fechasus"] = '';
                }
                if (!isset($cnt["numconf"])) {
                    $cnt["numconf"] = '';
                }
                if (!isset($cnt["fechaconf"])) {
                    $cnt["fechaconf"] = '';
                }
                if (!isset($cnt["estadosanc"])) {
                    $cnt["estadosanc"] = '';
                }
                if (!isset($cnt["numrev"])) {
                    $cnt["numrev"] = '';
                }
                if (!isset($cnt["fechanumrev"])) {
                    $cnt["fechanumrev"] = '';
                }
                if (!isset($cnt["descripcion"])) {
                    $cnt["descripcion"] = '';
                }
                if (!isset($cnt["fundamento"])) {
                    $cnt["fundamento"] = '';
                }
                if (!isset($cnt["vigencia"])) {
                    $cnt["vigencia"] = '';
                }
                if (!isset($cnt["numlibro"])) {
                    $cnt["numlibro"] = '';
                }
                if (!isset($cnt["numreglib"])) {
                    $cnt["numreglib"] = '';
                }
                if (!isset($cnt["fecreglib"])) {
                    $cnt["fecreglib"] = '';
                }
                if (!isset($cnt["codigocamaraorigen"])) {
                    $cnt["codigocamaraorigen"] = '';
                }
                if (!isset($cnt["numregistrocamaraorigen"])) {
                    $cnt["numregistrocamaraorigen"] = '';
                }
                if (!isset($cnt["fecregistrocamaraorigen"])) {
                    $cnt["fecregistrocamaraorigen"] = '';
                }

                $xml .= '<sandis>' . chr(13);
                $xml .= '<isn>' . $cnt["isn"] . '</isn>' . chr(13);
                $xml .= '<codcamara>' . $cnt["codcamara"] . '</codcamara>' . chr(13);
                $xml .= '<numradic>' . $cnt["numradic"] . '</numradic>' . chr(13);
                $xml .= '<fecradic>' . $cnt["fecradic"] . '</fecradic>' . chr(13);
                $xml .= '<horradic>' . $cnt["horradic"] . '</horradic>' . chr(13);
                $xml .= '<fecreporte>' . $cnt["fecreporte"] . '</fecreporte>' . chr(13);
                $xml .= '<nitentidad>' . $cnt["nitentidad"] . '</nitentidad>' . chr(13);
                $xml .= '<nombreentidad>' . $cnt["nombreentidad"] . '</nombreentidad>' . chr(13);
                $xml .= '<idmunientidad>' . $cnt["idmunientidad"] . '</idmunientidad>' . chr(13);
                $xml .= '<divarea>' . $cnt["divarea"] . '</divarea>' . chr(13);
                $xml .= '<idefun>' . $cnt["idefun"] . '</idefun>' . chr(13);
                $xml .= '<nomfun>' . $cnt["nomfun"] . '</nomfun>' . chr(13);
                $xml .= '<carfun>' . $cnt["carfun"] . '</carfun>' . chr(13);
                $xml .= '<numcontratosecop>' . $cnt["numcontratosecop"] . '</numcontratosecop>' . chr(13);
                $xml .= '<numacto>' . $cnt["numacto"] . '</numacto>' . chr(13);
                $xml .= '<fechaacto>' . $cnt["fechaacto"] . '</fechaacto>' . chr(13);
                $xml .= '<fechaeje>' . $cnt["fechaeje"] . '</fechaeje>' . chr(13);
                $xml .= '<numsus>' . $cnt["numsus"] . '</numsus>' . chr(13);
                $xml .= '<fechasus>' . $cnt["fechasus"] . '</fechasus>' . chr(13);
                $xml .= '<numconf>' . $cnt["numconf"] . '</numconf>' . chr(13);
                $xml .= '<fechaconf>' . $cnt["fechaconf"] . '</fechaconf>' . chr(13);
                $xml .= '<estadosanc>' . $cnt["estadosanc"] . '</estadosanc>' . chr(13);
                $xml .= '<numrev>' . $cnt["numrev"] . '</numrev>' . chr(13);
                $xml .= '<dessanc>' . $cnt["descripcion"] . '</dessanc>' . chr(13);
                $xml .= '<fundamento>' . $cnt["fundamento"] . '</fundamento>' . chr(13);
                $xml .= '<vigencia>' . $cnt["vigencia"] . '</vigencia>' . chr(13);
                $xml .= '<fechanumrev>' . $cnt["fechanumrev"] . '</fechanumrev>' . chr(13);
                $xml .= '<numlibro>' . $cnt["numlibro"] . '</numlibro>' . chr(13);
                $xml .= '<numreglib>' . $cnt["numreglib"] . '</numreglib>' . chr(13);
                $xml .= '<fecreglib>' . $cnt["fecreglib"] . '</fecreglib>' . chr(13);
                $xml .= '<codigocamaraorigen>' . $cnt["codigocamaraorigen"] . '</codigocamaraorigen>' . chr(13);
                $xml .= '<numregistrocamaraorigen>' . $cnt["numregistrocamaraorigen"] . '</numregistrocamaraorigen>' . chr(13);
                $xml .= '<fecregistrocamaraorigen>' . $cnt["fecregistrocamaraorigen"] . '</fecregistrocamaraorigen>' . chr(13);
                $xml .= '</sancion>' . chr(13);
            }

            $xml .= '</expediente>' . chr(13);
            $xml .= '</expedientes>' . chr(13);
            return $xml;
        }

        //
        if (!isset($_SESSION["formulario"]["tipotramite"])) {
            $_SESSION["formulario"]["tipotramite"] = '';
        }
        if (!isset($_SESSION["formulario"]["numerorecuperacion"])) {
            $_SESSION["formulario"]["numerorecuperacion"] = '';
        }
        if (!isset($_SESSION["formulario"]["liquidacion"])) {
            $_SESSION["formulario"]["liquidacion"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["tamanoempresa"])) {
            $_SESSION["formulario"]["datos"]["tamanoempresa"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["emprendedor28"])) {
            $_SESSION["formulario"]["datos"]["emprendedor28"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["pemprendedor28"])) {
            $_SESSION["formulario"]["datos"]["pemprendedor28"] = 0;
        }
        if (!isset($_SESSION["formulario"]["datos"]["vigcontrol"])) {
            $_SESSION["formulario"]["datos"]["vigcontrol"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["fechatermestudios"])) {
            $_SESSION["formulario"]["datos"]["fechatermestudios"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["celcom"])) {
            $_SESSION["formulario"]["datos"]["celcom"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["celnot"])) {
            $_SESSION["formulario"]["datos"]["celnot"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["idtipoidentificacion"])) {
            $_SESSION["formulario"]["datos"]["idtipoidentificacion"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["certificardesde"])) {
            $_SESSION["formulario"]["datos"]["certificardesde"] = '';
        }

        //
        if (!isset($_SESSION["formulario"]["cambidom_idmunicipioorigen"])) {
            $_SESSION["formulario"]["cambidom_idmunicipioorigen"] = '';
        }
        if (!isset($_SESSION["formulario"]["cambidom_idmunicipiodestino"])) {
            $_SESSION["formulario"]["cambidom_idmunicipiodestino"] = '';
        }
        if (!isset($_SESSION["formulario"]["cambidom_fechaultimainscripcion"])) {
            $_SESSION["formulario"]["cambidom_fechaultimainscripcion"] = '';
        }
        if (!isset($_SESSION["formulario"]["cambidom_fechaultimarenovacion"])) {
            $_SESSION["formulario"]["cambidom_fechaultimarenovacion"] = '';
        }

        //
        if (!isset($_SESSION["formulario"]["datos"]["sitcontrol"])) {
            $_SESSION["formulario"]["datos"]["sitcontrol"] = array();
        }

        //
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_fechacorte"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_fechacorte"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_actcte"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_actcte"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_fijnet"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_fijnet"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_actotr"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_actotr"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_actval"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_actval"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_acttot"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_acttot"] = '';
        }

        //
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_pascte"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_pascte"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_paslar"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_paslar"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_pastot"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_pastot"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_patnet"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_patnet"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_paspat"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_paspat"] = '';
        }

        //
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_ingope"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_ingope"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_ingnoope"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_ingnoope"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_gasope"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_gasope"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_gasnoope"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_gasnoope"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_cosven"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_cosven"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_utinet"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_utinet"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_utiope"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_utiope"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_gasint"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_gasint"] = '';
        }

        //
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_indliq"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_indliq"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_nivend"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_nivend"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_razcob"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_razcob"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_renpat"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_renpat"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_renact"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_renact"] = '';
        }

        //
        if (!isset($_SESSION["formulario"]["datos"]["clasi1510"])) {
            $_SESSION["formulario"]["datos"]["clasi1510"] = array();
        }

        //
        if (!isset($_SESSION["formulario"]["datos"]["exp1510"])) {
            $_SESSION["formulario"]["datos"]["exp1510"] = array();
        }

        //
        $xml .= '<tipotramite>' . trim($_SESSION["formulario"]["tipotramite"]) . '</tipotramite>' . chr(13);
        $xml .= '<numerorecuperacion>' . trim($_SESSION["formulario"]["numerorecuperacion"]) . '</numerorecuperacion>' . chr(13);
        $xml .= '<numeroliquidacion>' . trim($_SESSION["formulario"]["liquidacion"]) . '</numeroliquidacion>' . chr(13);
        $xml .= '<numeroradicacion>' . trim($_SESSION["formulario"]["numeroradicacion"]) . '</numeroradicacion>' . chr(13);
        $xml .= '<proponente>' . ltrim($_SESSION["formulario"]["datos"]["proponente"], '0') . '</proponente>' . chr(13);
        $xml .= '<matricula>' . ltrim($_SESSION["formulario"]["datos"]["matricula"], '0') . '</matricula>' . chr(13);
        $xml .= '<nombre><![CDATA[' . \funcionesSii2::reemplazarEspeciales(trim($_SESSION["formulario"]["datos"]["nombre"])) . ']]></nombre>' . chr(13);
        $xml .= '<ape1><![CDATA[' . \funcionesSii2::reemplazarEspeciales(trim($_SESSION["formulario"]["datos"]["ape1"])) . ']]></ape1>' . chr(13);
        $xml .= '<ape2><![CDATA[' . \funcionesSii2::reemplazarEspeciales(trim($_SESSION["formulario"]["datos"]["ape2"])) . ']]></ape2>' . chr(13);
        $xml .= '<nom1><![CDATA[' . \funcionesSii2::reemplazarEspeciales(trim($_SESSION["formulario"]["datos"]["nom1"])) . ']]></nom1>' . chr(13);
        $xml .= '<nom2><![CDATA[' . \funcionesSii2::reemplazarEspeciales(trim($_SESSION["formulario"]["datos"]["nom2"])) . ']]></nom2>' . chr(13);
        $xml .= '<sigla><![CDATA[' . \funcionesSii2::reemplazarEspeciales(trim($_SESSION["formulario"]["datos"]["sigla"])) . ']]></sigla>' . chr(13);
        $xml .= '<idtipoidentificacion>' . $_SESSION["formulario"]["datos"]["idtipoidentificacion"] . '</idtipoidentificacion>' . chr(13);
        $xml .= '<identificacion>' . ltrim($_SESSION["formulario"]["datos"]["identificacion"], '0') . '</identificacion>' . chr(13);
        $xml .= '<idpaisidentificacion>' . $_SESSION["formulario"]["datos"]["idpaisidentificacion"] . '</idpaisidentificacion>' . chr(13);
        $xml .= '<nit>' . ltrim($_SESSION["formulario"]["datos"]["nit"], '0') . '</nit>' . chr(13);
        $xml .= '<nacionalidad><![CDATA[' . trim($_SESSION["formulario"]["datos"]["nacionalidad"]) . ']]></nacionalidad>' . chr(13);
        $xml .= '<organizacion>' . $_SESSION["formulario"]["datos"]["organizacion"] . '</organizacion>' . chr(13);
        $xml .= '<tamanoempresa>' . $_SESSION["formulario"]["datos"]["tamanoempresa"] . '</tamanoempresa>' . chr(13);
        $xml .= '<emprendedor28>' . $_SESSION["formulario"]["datos"]["emprendedor28"] . '</emprendedor28>' . chr(13);
        $xml .= '<pemprendedor28>' . $_SESSION["formulario"]["datos"]["pemprendedor28"] . '</pemprendedor28>' . chr(13);
        $xml .= '<vigcontrol>' . $_SESSION["formulario"]["datos"]["vigcontrol"] . '</vigcontrol>' . chr(13);
        $xml .= '<idestadoproponente>' . $_SESSION["formulario"]["datos"]["idestadoproponente"] . '</idestadoproponente>' . chr(13);
        $xml .= '<certificardesde>' . $_SESSION["formulario"]["datos"]["certificardesde"] . '</certificardesde>' . chr(13);
        $xml .= '<fechaultimainscripcion>' . $_SESSION["formulario"]["datos"]["fechaultimainscripcion"] . '</fechaultimainscripcion>' . chr(13);
        $xml .= '<fechaultimarenovacion>' . $_SESSION["formulario"]["datos"]["fechaultimarenovacion"] . '</fechaultimarenovacion>' . chr(13);
        $xml .= '<fechacancelacion>' . $_SESSION["formulario"]["datos"]["fechacancelacion"] . '</fechacancelacion>' . chr(13);

        // Cambio de domicilio
        $xml .= '<cambidom_idmunicipioorigen>' . $_SESSION["formulario"]["datos"]["cambidom_idmunicipioorigen"] . '</cambidom_idmunicipioorigen>' . chr(13);
        $xml .= '<cambidom_idmunicipiodestino>' . $_SESSION["formulario"]["datos"]["cambidom_idmunicipiodestino"] . '</cambidom_idmunicipiodestino>' . chr(13);
        $xml .= '<cambidom_fechaultimainscripcion>' . $_SESSION["formulario"]["datos"]["cambidom_fechaultimainscripcion"] . '</cambidom_fechaultimainscripcion>' . chr(13);
        $xml .= '<cambidom_fechaultimarenovacion>' . $_SESSION["formulario"]["datos"]["cambidom_fechaultimarenovacion"] . '</cambidom_fechaultimarenovacion>' . chr(13);
        if (isset($_SESSION["formulario"]["datos"]["propcamaraorigen"])) {
            $xml .= '<propcamaraorigen>' . $_SESSION["formulario"]["datos"]["propcamaraorigen"] . '</propcamaraorigen>' . chr(13);
        } else {
            $xml .= '<propcamaraorigen></propcamaraorigen>' . chr(13);
        }
        if (isset($_SESSION["formulario"]["datos"]["propcamaradestino"])) {
            $xml .= '<propcamaradestino>' . $_SESSION["formulario"]["datos"]["propcamaradestino"] . '</propcamaradestino>' . chr(13);
        } else {
            $xml .= '<propcamaradestino></propcamaradestino>' . chr(13);
        }

        // Datos de personer&iacute;a jur&iacute;dica
        $xml .= '<idtipodocperjur>' . $_SESSION["formulario"]["datos"]["idtipodocperjur"] . '</idtipodocperjur>' . chr(13); // A02
        $xml .= '<numdocperjur>' . $_SESSION["formulario"]["datos"]["numdocperjur"] . '</numdocperjur>' . chr(13); // A20
        $xml .= '<fecdocperjur>' . $_SESSION["formulario"]["datos"]["fecdocperjur"] . '</fecdocperjur>' . chr(13); // (D)
        $xml .= '<origendocperjur><![CDATA[' . $_SESSION["formulario"]["datos"]["origendocperjur"] . ']]></origendocperjur>' . chr(13); // A128
        $xml .= '<fechaconstitucion>' . $_SESSION["formulario"]["datos"]["fechaconstitucion"] . '</fechaconstitucion>' . chr(13); // (D)
        $xml .= '<fechavencimiento>' . $_SESSION["formulario"]["datos"]["fechavencimiento"] . '</fechavencimiento>' . chr(13); // (D)
        // Datos de ubicaci&oacute;n
        $xml .= '<dircom><![CDATA[' . \funcionesSii2::reemplazarEspeciales($_SESSION["formulario"]["datos"]["dircom"]) . ']]></dircom>' . chr(13); // A128
        $xml .= '<dircom_tipovia></dircom_tipovia>' . chr(13); //A5
        $xml .= '<dircom_numvia></dircom_numvia>' . chr(13); //A3
        $xml .= '<dircom_apevia></dircom_apevia>' . chr(13); //A5
        $xml .= '<dircom_orivia></dircom_orivia>' . chr(13); //A5
        $xml .= '<dircom_numcruce></dircom_numcruce>' . chr(13); //A3
        $xml .= '<dircom_apecruce></dircom_apecruce>' . chr(13); //A5
        $xml .= '<dircom_oricruce></dircom_oricruce>' . chr(13); //A5
        $xml .= '<dircom_numplaca></dircom_numplaca>' . chr(13); //A3
        $xml .= '<dircom_complemento><![CDATA[]]></dircom_complemento>' . chr(13); //A20
        $xml .= '<muncom>' . $_SESSION["formulario"]["datos"]["muncom"] . '</muncom>' . chr(13);
        $xml .= '<telcom1>' . $_SESSION["formulario"]["datos"]["telcom1"] . '</telcom1>' . chr(13);
        $xml .= '<telcom2>' . $_SESSION["formulario"]["datos"]["telcom2"] . '</telcom2>' . chr(13);
        $xml .= '<celcom>' . $_SESSION["formulario"]["datos"]["celcom"] . '</celcom>' . chr(13);
        $xml .= '<faxcom>' . $_SESSION["formulario"]["datos"]["faxcom"] . '</faxcom>' . chr(13);
        $xml .= '<emailcom><![CDATA[' . $_SESSION["formulario"]["datos"]["emailcom"] . ']]></emailcom>' . chr(13);
        $xml .= '<enviarint>' . $_SESSION["formulario"]["datos"]["enviarint"] . '</enviarint>' . chr(13);
        $xml .= '<dirnot><![CDATA[' . \funcionesSii2::reemplazarEspeciales($_SESSION["formulario"]["datos"]["dirnot"]) . ']]></dirnot>' . chr(13);
        $xml .= '<dirnot_tipovia></dirnot_tipovia>' . chr(13);
        $xml .= '<dirnot_numvia></dirnot_numvia>' . chr(13);
        $xml .= '<dirnot_apevia></dirnot_apevia>' . chr(13);
        $xml .= '<dirnot_orivia></dirnot_orivia>' . chr(13);
        $xml .= '<dirnot_numcruce></dirnot_numcruce>' . chr(13);
        $xml .= '<dirnot_apecruce></dirnot_apecruce>' . chr(13);
        $xml .= '<dirnot_oricruce></dirnot_oricruce>' . chr(13);
        $xml .= '<dirnot_numplaca></dirnot_numplaca>' . chr(13);
        $xml .= '<dirnot_complemento><![CDATA[]]></dirnot_complemento>' . chr(13);
        $xml .= '<munnot>' . $_SESSION["formulario"]["datos"]["munnot"] . '</munnot>' . chr(13);
        $xml .= '<telnot>' . $_SESSION["formulario"]["datos"]["telnot"] . '</telnot>' . chr(13);
        $xml .= '<telnot2>' . $_SESSION["formulario"]["datos"]["telnot2"] . '</telnot2>' . chr(13);
        $xml .= '<celnot>' . $_SESSION["formulario"]["datos"]["celnot"] . '</celnot>' . chr(13);
        $xml .= '<faxnot>' . $_SESSION["formulario"]["datos"]["faxnot"] . '</faxnot>' . chr(13);
        $xml .= '<emailnot><![CDATA[' . $_SESSION["formulario"]["datos"]["emailnot"] . ']]></emailnot>' . chr(13);
        $xml .= '<enviarnot>' . $_SESSION["formulario"]["datos"]["enviarnot"] . '</enviarnot>' . chr(13);


        // Representantes legales
        $xml .= '<representanteslegales>' . chr(13);
        if (!empty($_SESSION["formulario"]["datos"]["representanteslegales"])) {
            foreach ($_SESSION["formulario"]["datos"]["representanteslegales"] as $rep) {
                $xml .= '<representantelegal>' . chr(13);
                $xml .= '<idtipoidentificacionrepleg>' . $rep["idtipoidentificacionrepleg"] . "</idtipoidentificacionrepleg>";
                $xml .= '<identificacionrepleg>' . $rep["identificacionrepleg"] . "</identificacionrepleg>";
                $xml .= '<nombrerepleg><![CDATA[' . \funcionesSii2::reemplazarEspeciales($rep["nombrerepleg"]) . "]]></nombrerepleg>";
                $xml .= '<cargorepleg><![CDATA[' . \funcionesSii2::reemplazarEspeciales($rep["cargorepleg"]) . "]]></cargorepleg>";
                $xml .= '</representantelegal>' . chr(13);
            }
        }
        $xml .= '</representanteslegales>' . chr(13);


        // Facultades
        if (isset($_SESSION["formulario"]["datos"]["facultades"])) {
            $xml .= '<facultades><![CDATA[' . \funcionesSii2::reemplazarEspeciales(trim($_SESSION["formulario"]["datos"]["facultades"])) . ']]></facultades>' . chr(13);
        } else {
            $_SESSION["formulario"]["datos"]["facultades"] = '';
            $xml .= '<facultades><![CDATA[' . \funcionesSii2::reemplazarEspeciales(trim($_SESSION["formulario"]["datos"]["facultades"])) . ']]></facultades>' . chr(13);
        }


        // Situaciones de control
        if (!empty($_SESSION["formulario"]["datos"]["sitcontrol"])) {
            foreach ($_SESSION["formulario"]["datos"]["sitcontrol"] as $rep) {
                $xml .= '<sitcontrol>' . chr(13);
                $xml .= '<nombre><![CDATA[' . $rep["nombre"] . ']]></nombre>';
                $xml .= '<identificacion>' . $rep["identificacion"] . '</identificacion>';
                $xml .= '<domicilio>' . $rep["domicilio"] . '</domicilio>';
                $xml .= '<tipo>' . $rep["tipo"] . '</tipo>';
                $xml .= '</sitcontrol>' . chr(13);
            }
        }

        // Informacion financiera - Decreto 1510
        $xml .= '<inffin1510_fechacorte>' . $_SESSION["formulario"]["datos"]["inffin1510_fechacorte"] . '</inffin1510_fechacorte>' . chr(13);
        $xml .= '<inffin1510_actcte>' . $_SESSION["formulario"]["datos"]["inffin1510_actcte"] . '</inffin1510_actcte>' . chr(13);
        $xml .= '<inffin1510_actnocte>' . $_SESSION["formulario"]["datos"]["inffin1510_actnocte"] . '</inffin1510_actnocte>' . chr(13);
        $xml .= '<inffin1510_fijnet>' . $_SESSION["formulario"]["datos"]["inffin1510_fijnet"] . '</inffin1510_fijnet>' . chr(13);
        $xml .= '<inffin1510_actotr>' . $_SESSION["formulario"]["datos"]["inffin1510_actotr"] . '</inffin1510_actotr>' . chr(13);
        $xml .= '<inffin1510_actval>' . $_SESSION["formulario"]["datos"]["inffin1510_actval"] . '</inffin1510_actval>' . chr(13);
        $xml .= '<inffin1510_acttot>' . $_SESSION["formulario"]["datos"]["inffin1510_acttot"] . '</inffin1510_acttot>' . chr(13);

        $xml .= '<inffin1510_pascte>' . $_SESSION["formulario"]["datos"]["inffin1510_pascte"] . '</inffin1510_pascte>' . chr(13);
        $xml .= '<inffin1510_paslar>' . $_SESSION["formulario"]["datos"]["inffin1510_paslar"] . '</inffin1510_paslar>' . chr(13);
        $xml .= '<inffin1510_pastot>' . $_SESSION["formulario"]["datos"]["inffin1510_pastot"] . '</inffin1510_pastot>' . chr(13);
        $xml .= '<inffin1510_patnet>' . $_SESSION["formulario"]["datos"]["inffin1510_patnet"] . '</inffin1510_patnet>' . chr(13);
        $xml .= '<inffin1510_paspat>' . $_SESSION["formulario"]["datos"]["inffin1510_paspat"] . '</inffin1510_paspat>' . chr(13);
        $xml .= '<inffin1510_balsoc>' . $_SESSION["formulario"]["datos"]["inffin1510_balsoc"] . '</inffin1510_balsoc>' . chr(13);

        $xml .= '<inffin1510_ingope>' . $_SESSION["formulario"]["datos"]["inffin1510_ingope"] . '</inffin1510_ingope>' . chr(13);
        $xml .= '<inffin1510_ingnoope>' . $_SESSION["formulario"]["datos"]["inffin1510_ingnoope"] . '</inffin1510_ingnoope>' . chr(13);
        $xml .= '<inffin1510_gasope>' . $_SESSION["formulario"]["datos"]["inffin1510_gasope"] . '</inffin1510_gasope>' . chr(13);
        $xml .= '<inffin1510_gasnoope>' . $_SESSION["formulario"]["datos"]["inffin1510_gasnoope"] . '</inffin1510_gasnoope>' . chr(13);
        $xml .= '<inffin1510_cosven>' . $_SESSION["formulario"]["datos"]["inffin1510_cosven"] . '</inffin1510_cosven>' . chr(13);
        $xml .= '<inffin1510_utiope>' . $_SESSION["formulario"]["datos"]["inffin1510_utiope"] . '</inffin1510_utiope>' . chr(13);
        $xml .= '<inffin1510_utinet>' . $_SESSION["formulario"]["datos"]["inffin1510_utinet"] . '</inffin1510_utinet>' . chr(13);
        $xml .= '<inffin1510_gasint>' . $_SESSION["formulario"]["datos"]["inffin1510_gasint"] . '</inffin1510_gasint>' . chr(13);
        $xml .= '<inffin1510_gasimp>' . $_SESSION["formulario"]["datos"]["inffin1510_gasimp"] . '</inffin1510_gasimp>' . chr(13);

        $xml .= '<inffin1510_indliq>' . $_SESSION["formulario"]["datos"]["inffin1510_indliq"] . '</inffin1510_indliq>' . chr(13);
        $xml .= '<inffin1510_nivend>' . $_SESSION["formulario"]["datos"]["inffin1510_nivend"] . '</inffin1510_nivend>' . chr(13);
        $xml .= '<inffin1510_razcob>' . $_SESSION["formulario"]["datos"]["inffin1510_razcob"] . '</inffin1510_razcob>' . chr(13);
        $xml .= '<inffin1510_renpat>' . $_SESSION["formulario"]["datos"]["inffin1510_renpat"] . '</inffin1510_renpat>' . chr(13);
        $xml .= '<inffin1510_renact>' . $_SESSION["formulario"]["datos"]["inffin1510_renact"] . '</inffin1510_renact>' . chr(13);

        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_gruponiif"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_gruponiif"] = '';
        }
        $xml .= '<inffin1510_gruponiif>' . $_SESSION["formulario"]["datos"]["inffin1510_gruponiif"] . '</inffin1510_gruponiif>' . chr(13);

        // Experiencia decreto 1510
        $i = 0;
        if (isset($_SESSION["formulario"]["datos"]["exp1510"])) {
            if (count($_SESSION["formulario"]["datos"]["exp1510"]) > 0) {
                foreach ($_SESSION["formulario"]["datos"]["exp1510"] as $cnt) {
                    if (trim($cnt["nombrecontratante"]) != '') {
                        $i++;
                        $xml .= '<exp1510>';
                        if (strlen(ltrim(trim($cnt["secuencia"]), "0")) <= 3) {
                            $xml .= '<secuencia>' . sprintf("%03s", $cnt["secuencia"]) . '</secuencia>';
                        } else {
                            $xml .= '<secuencia>' . $cnt["secuencia"] . '</secuencia>';
                        }
                        $xml .= '<clavecontrato>' . $cnt["clavecontrato"] . '</clavecontrato>';
                        $xml .= '<celebradopor>' . $cnt["celebradopor"] . '</celebradopor>';
                        $xml .= '<nombrecontratista><![CDATA[' . (\funcionesSii2::reemplazarEspeciales($cnt["nombrecontratista"])) . ']]></nombrecontratista>';
                        $xml .= '<nombrecontratante><![CDATA[' . (\funcionesSii2::reemplazarEspeciales($cnt["nombrecontratante"])) . ']]></nombrecontratante>';
                        if (isset($cnt["fecejecucion"])) {
                            $xml .= '<fecejecucion>' . $cnt["fecejecucion"] . '</fecejecucion>';
                        } else {
                            $xml .= '<fecejecucion></fecejecucion>';
                        }
                        if (isset($cnt["valorpesos"])) {
                            $xml .= '<valorpesos>' . $cnt["valorpesos"] . '</valorpesos>';
                        } else {
                            $xml .= '<valorpesos></valorpesos>';
                        }
                        $xml .= '<valor>' . $cnt["valor"] . '</valor>';
                        $xml .= '<porcentaje>' . $cnt["porcentaje"] . '</porcentaje>';
                        if (isset($cnt["clasif"])) {
                            foreach ($cnt["clasif"] as $c) {
                                $xml .= '<clasif>' . trim($c) . '</clasif>';
                            }
                        }
                        $xml .= '<generardeclaracion>' . $cnt["generardeclaracion"] . '</generardeclaracion>' . chr(13);
                        $xml .= '</exp1510>';
                    }
                }
            }
        }

        //
        if (isset($_SESSION["formulario"]["datos"]["clasi1510"])) {
            asort($_SESSION["formulario"]["datos"]["clasi1510"]);
            foreach ($_SESSION["formulario"]["datos"]["clasi1510"] as $c) {
                $xml .= '<cla1510>' . trim($c) . '</cla1510>';
            }
        }


        // Bienes
        $xml .= '<bienes>';
        if (!empty($_SESSION["formulario"]["datos"]["bienes"])) {
            foreach ($_SESSION["formulario"]["datos"]["bienes"] as $bien) {
                $xml .= '<bien>';
                $xml .= '<matinmo>' . $bien["matinmo"] . '</matinmo>';
                $xml .= '<dir>' . $bien["dir"] . '</dir>';
                $xml .= '<barrio>' . $bien["barrio"] . '</barrio>';
                $xml .= '<muni>' . $bien["muni"] . '</muni>';
                $xml .= '<dpto>' . $bien["muni"] . '</dpto>';
                $xml .= '<pais>' . $bien["pais"] . '</pais>';
                $xml .= '</bien>';
            }
        }
        $xml .= '</bienes>';

        foreach ($_SESSION["formulario"]["datos"]["contratos"] as $cnt) {

            if (!isset($cnt["isn"])) {
                $cnt["isn"] = '';
            }
            if (!isset($cnt["codcamara"])) {
                $cnt["codcamara"] = '';
            }
            if (!isset($cnt["numradic"])) {
                $cnt["numradic"] = '';
            }
            if (!isset($cnt["fecradic"])) {
                $cnt["fecradic"] = '';
            }
            if (!isset($cnt["horradic"])) {
                $cnt["horradic"] = '';
            }
            if (!isset($cnt["fecreporte"])) {
                $cnt["fecreporte"] = '';
            }
            if (!isset($cnt["nitentidad"])) {
                $cnt["nitentidad"] = '';
            }
            if (!isset($cnt["nombreentidad"])) {
                $cnt["nombreentidad"] = '';
            }
            if (!isset($cnt["idmunientidad"])) {
                $cnt["idmunientidad"] = '';
            }
            if (!isset($cnt["divarea"])) {
                $cnt["divarea"] = '';
            }
            if (!isset($cnt["idefun"])) {
                $cnt["idefun"] = '';
            }
            if (!isset($cnt["nomfun"])) {
                $cnt["nomfun"] = '';
            }
            if (!isset($cnt["carfun"])) {
                $cnt["carfun"] = '';
            }
            if (!isset($cnt["numcontrato"])) {
                $cnt["numcontrato"] = '';
            }
            if (!isset($cnt["numcontratosecop"])) {
                $cnt["numcontratosecop"] = '';
            }

            if (!isset($cnt["fechaadj"])) {
                $cnt["fechaadj"] = '';
            }
            if (!isset($cnt["fechaper"])) {
                $cnt["fechaper"] = '';
            }
            if (!isset($cnt["fechaini"])) {
                $cnt["fechaini"] = '';
            }
            if (!isset($cnt["fechater"])) {
                $cnt["fechater"] = '';
            }
            if (!isset($cnt["fechaeje"])) {
                $cnt["fechaeje"] = '';
            }
            if (!isset($cnt["fechasus"])) {
                $cnt["fechasus"] = '';
            }
            if (!isset($cnt["fechaliq"])) {
                $cnt["fechaliq"] = '';
            }
            if (!isset($cnt["fechaterant"])) {
                $cnt["fechaterant"] = '';
            }
            if (!isset($cnt["fechaces"])) {
                $cnt["fechaces"] = '';
            }

            if (!isset($cnt["codigoact"])) {
                $cnt["codigoact"] = '';
            }
            if (!isset($cnt["ciiu1"])) {
                $cnt["ciiu1"] = '';
            }
            if (!isset($cnt["ciiu2"])) {
                $cnt["ciiu2"] = '';
            }
            if (!isset($cnt["ciiu3"])) {
                $cnt["ciiu3"] = '';
            }
            if (!isset($cnt["ciiu4"])) {
                $cnt["ciiu4"] = '';
            }
            if (!isset($cnt["objeto"])) {
                $cnt["objeto"] = '';
            }
            if (!isset($cnt["tipocont"])) {
                $cnt["tipocont"] = '';
            }
            if (!isset($cnt["valorcont"])) {
                $cnt["valorcont"] = '';
            }
            if (!isset($cnt["valorcontpag"])) {
                $cnt["valorcontpag"] = '';
            }
            if (!isset($cnt["indcump"])) {
                $cnt["indcump"] = '';
            }
            if (!isset($cnt["estadocont"])) {
                $cnt["estadocont"] = '';
            }
            if (!isset($cnt["motivoter"])) {
                $cnt["motivoter"] = '';
            }
            if (!isset($cnt["motivoces"])) {
                $cnt["motivoces"] = '';
            }
            if (!isset($cnt["observaciones"])) {
                $cnt["observaciones"] = '';
            }
            if (!isset($cnt["numlibro"])) {
                $cnt["numlibro"] = '';
            }
            if (!isset($cnt["numreglib"])) {
                $cnt["numreglib"] = '';
            }
            if (!isset($cnt["fecreglib"])) {
                $cnt["fecreglib"] = '';
            }
            if (!isset($cnt["codigocamaraorigen"])) {
                $cnt["codigocamaraorigen"] = '';
            }
            if (!isset($cnt["numregistrocamaraorigen"])) {
                $cnt["numregistrocamaraorigen"] = '';
            }
            if (!isset($cnt["fecregistrocamaraorigen"])) {
                $cnt["fecregistrocamaraorigen"] = '';
            }

            $xml .= '<contrato>' . chr(13);
            $xml .= '<isn>' . $cnt["isn"] . '</isn>' . chr(13);
            $xml .= '<codcamara>' . $cnt["codcamara"] . '</codcamara>' . chr(13);
            $xml .= '<numradic>' . $cnt["numradic"] . '</numradic>' . chr(13);
            $xml .= '<fecradic>' . $cnt["fecradic"] . '</fecradic>' . chr(13);
            $xml .= '<horradic>' . $cnt["horradic"] . '</horradic>' . chr(13);
            $xml .= '<fecreporte>' . $cnt["fecreporte"] . '</fecreporte>' . chr(13);
            $xml .= '<nitentidad>' . $cnt["nitentidad"] . '</nitentidad>' . chr(13);
            $xml .= '<nombreentidad>' . $cnt["nombreentidad"] . '</nombreentidad>' . chr(13);
            $xml .= '<idmunientidad>' . $cnt["idmunientidad"] . '</idmunientidad>' . chr(13);
            $xml .= '<divarea>' . $cnt["divarea"] . '</divarea>' . chr(13);
            $xml .= '<idefun>' . $cnt["idefun"] . '</idefun>' . chr(13);
            $xml .= '<nomfun>' . $cnt["nomfun"] . '</nomfun>' . chr(13);
            $xml .= '<carfun>' . $cnt["carfun"] . '</carfun>' . chr(13);
            $xml .= '<numcontrato>' . $cnt["numcontrato"] . '</numcontrato>' . chr(13);
            $xml .= '<numcontratosecop>' . $cnt["numcontratosecop"] . '</numcontratosecop>' . chr(13);
            $xml .= '<fechaadj>' . $cnt["fechaadj"] . '</fechaadj>' . chr(13);
            $xml .= '<fechaper>' . $cnt["fechaper"] . '</fechaper>' . chr(13);
            $xml .= '<fechaini>' . $cnt["fechaini"] . '</fechaini>' . chr(13);
            $xml .= '<fechater>' . $cnt["fechater"] . '</fechater>' . chr(13);
            $xml .= '<fechaeje>' . $cnt["fechaeje"] . '</fechaeje>' . chr(13);
            $xml .= '<fechaliq>' . $cnt["fechaliq"] . '</fechaliq>' . chr(13);
            $xml .= '<fechaterant>' . $cnt["fechaterant"] . '</fechaterant>' . chr(13);
            $xml .= '<fechaces>' . $cnt["fechaces"] . '</fechaces>' . chr(13);
            $xml .= '<codigoact>' . $cnt["codigoact"] . '</codigoact>' . chr(13);
            $xml .= '<ciiu1>' . $cnt["ciiu1"] . '</ciiu1>' . chr(13);
            $xml .= '<ciiu2>' . $cnt["ciiu2"] . '</ciiu2>' . chr(13);
            $xml .= '<ciiu3>' . $cnt["ciiu3"] . '</ciiu3>' . chr(13);
            $xml .= '<ciiu4>' . $cnt["ciiu4"] . '</ciiu4>' . chr(13);
            $xml .= '<tipocont>' . $cnt["tipocont"] . '</tipocont>' . chr(13);
            $xml .= '<valorcont>' . $cnt["valorcont"] . '</valorcont>' . chr(13);
            $xml .= '<valorcontpag>' . $cnt["valorcontpag"] . '</valorcontpag>' . chr(13);
            $xml .= '<indcump>' . $cnt["indcump"] . '</indcump>' . chr(13);
            $xml .= '<estadocont>' . $cnt["estadocont"] . '</estadocont>' . chr(13);
            $xml .= '<motivoter>' . $cnt["motivoter"] . '</motivoter>' . chr(13);
            $xml .= '<motivoces>' . $cnt["motivoces"] . '</motivoces>' . chr(13);
            $xml .= '<observaciones>' . $cnt["observaciones"] . '</observaciones>' . chr(13);
            $xml .= '<numlibro>' . $cnt["numlibro"] . '</numlibro>' . chr(13);
            $xml .= '<numreglib>' . $cnt["numreglib"] . '</numreglib>' . chr(13);
            $xml .= '<fecreglib>' . $cnt["fecreglib"] . '</fecreglib>' . chr(13);
            if (isset($cnt["clasificaciones"])) {
                if (!empty($cnt["clasificaciones"])) {
                    foreach ($cnt["clasificaciones"] as $clasicon) {
                        $xml .= '<clasicon>' . $clasicon . '</clasicon>' . chr(13);
                    }
                }
            }
            if (isset($cnt["unspsc"])) {
                if (!empty($cnt["unspsc"])) {
                    foreach ($cnt["unspsc"] as $clasicon) {
                        $xml .= '<unspsc>' . $clasicon . '</unspsc>' . chr(13);
                    }
                }
            }
            $xml .= '<codigocamaraorigen>' . $cnt["codigocamaraorigen"] . '</codigocamaraorigen>' . chr(13);
            $xml .= '<numregistrocamaraorigen>' . $cnt["numregistrocamaraorigen"] . '</numregistrocamaraorigen>' . chr(13);
            $xml .= '<fecregistrocamaraorigen>' . $cnt["fecregistrocamaraorigen"] . '</fecregistrocamaraorigen>' . chr(13);
            $xml .= '</contrato>' . chr(13);
        }

        foreach ($_SESSION["formulario"]["datos"]["multas"] as $cnt) {

            if (!isset($cnt["isn"])) {
                $cnt["isn"] = '';
            }
            if (!isset($cnt["codcamara"])) {
                $cnt["codcamara"] = '';
            }
            if (!isset($cnt["numradic"])) {
                $cnt["numradic"] = '';
            }
            if (!isset($cnt["fecradic"])) {
                $cnt["fecradic"] = '';
            }
            if (!isset($cnt["horradic"])) {
                $cnt["horradic"] = '';
            }
            if (!isset($cnt["fecreporte"])) {
                $cnt["fecreporte"] = '';
            }
            if (!isset($cnt["nitentidad"])) {
                $cnt["nitentidad"] = '';
            }
            if (!isset($cnt["nombreentidad"])) {
                $cnt["nombreentidad"] = '';
            }
            if (!isset($cnt["idmunientidad"])) {
                $cnt["idmunientidad"] = '';
            }
            if (!isset($cnt["divarea"])) {
                $cnt["divarea"] = '';
            }
            if (!isset($cnt["idefun"])) {
                $cnt["idefun"] = '';
            }
            if (!isset($cnt["nomfun"])) {
                $cnt["nomfun"] = '';
            }
            if (!isset($cnt["carfun"])) {
                $cnt["carfun"] = '';
            }
            if (!isset($cnt["numcontrato"])) {
                $cnt["numcontrato"] = '';
            }
            if (!isset($cnt["numcontratosecop"])) {
                $cnt["numcontratosecop"] = '';
            }
            if (!isset($cnt["numacto"])) {
                $cnt["numacto"] = '';
            }
            if (!isset($cnt["fechaacto"])) {
                $cnt["fechaacto"] = '';
            }
            if (!isset($cnt["fechaeje"])) {
                $cnt["fechaeje"] = '';
            }
            if (!isset($cnt["valormult"])) {
                $cnt["valormult"] = '';
            }
            if (!isset($cnt["valormultpag"])) {
                $cnt["valormultpag"] = '';
            }
            if (!isset($cnt["numsus"])) {
                $cnt["numsus"] = '';
            }
            if (!isset($cnt["fechasus"])) {
                $cnt["fechasus"] = '';
            }
            if (!isset($cnt["numconf"])) {
                $cnt["numconf"] = '';
            }
            if (!isset($cnt["fechaconf"])) {
                $cnt["fechaconf"] = '';
            }
            if (!isset($cnt["estadomult"])) {
                $cnt["estadomult"] = '';
            }
            if (!isset($cnt["numrev"])) {
                $cnt["numrev"] = '';
            }
            if (!isset($cnt["fechanumrev"])) {
                $cnt["fechanumrev"] = '';
            }
            if (!isset($cnt["numlibro"])) {
                $cnt["numlibro"] = '';
            }
            if (!isset($cnt["numreglib"])) {
                $cnt["numreglib"] = '';
            }
            if (!isset($cnt["fecreglib"])) {
                $cnt["fecreglib"] = '';
            }
            if (!isset($cnt["codigocamaraorigen"])) {
                $cnt["codigocamaraorigen"] = '';
            }
            if (!isset($cnt["numregistrocamaraorigen"])) {
                $cnt["numregistrocamaraorigen"] = '';
            }
            if (!isset($cnt["fecregistrocamaraorigen"])) {
                $cnt["fecregistrocamaraorigen"] = '';
            }


            $xml .= '<multa>' . chr(13);
            $xml .= '<isn>' . $cnt["isn"] . '</isn>' . chr(13);
            $xml .= '<codcamara>' . $cnt["codcamara"] . '</codcamara>' . chr(13);
            $xml .= '<numradic>' . $cnt["numradic"] . '</numradic>' . chr(13);
            $xml .= '<fecradic>' . $cnt["fecradic"] . '</fecradic>' . chr(13);
            $xml .= '<horradic>' . $cnt["horradic"] . '</horradic>' . chr(13);
            $xml .= '<fecreporte>' . $cnt["fecreporte"] . '</fecreporte>' . chr(13);
            $xml .= '<nitentidad>' . $cnt["nitentidad"] . '</nitentidad>' . chr(13);
            $xml .= '<nombreentidad>' . $cnt["nombreentidad"] . '</nombreentidad>' . chr(13);
            $xml .= '<idmunientidad>' . $cnt["idmunientidad"] . '</idmunientidad>' . chr(13);
            $xml .= '<divarea>' . $cnt["divarea"] . '</divarea>' . chr(13);
            $xml .= '<idefun>' . $cnt["idefun"] . '</idefun>' . chr(13);
            $xml .= '<nomfun>' . $cnt["nomfun"] . '</nomfun>' . chr(13);
            $xml .= '<carfun>' . $cnt["carfun"] . '</carfun>' . chr(13);
            $xml .= '<numcontrato>' . $cnt["numcontrato"] . '</numcontrato>' . chr(13);
            $xml .= '<numcontratosecop>' . $cnt["numcontratosecop"] . '</numcontratosecop>' . chr(13);
            $xml .= '<numacto>' . $cnt["numacto"] . '</numacto>' . chr(13);
            $xml .= '<fechaacto>' . $cnt["fechaacto"] . '</fechaacto>' . chr(13);
            $xml .= '<fechaeje>' . $cnt["fechaeje"] . '</fechaeje>' . chr(13);
            $xml .= '<valormult>' . $cnt["valormult"] . '</valormult>' . chr(13);
            $xml .= '<valormultpag>' . $cnt["valormultpag"] . '</valormultpag>' . chr(13);
            $xml .= '<numsus>' . $cnt["numsus"] . '</numsus>' . chr(13);
            $xml .= '<fechasus>' . $cnt["fechasus"] . '</fechasus>' . chr(13);
            $xml .= '<numconf>' . $cnt["numconf"] . '</numconf>' . chr(13);
            $xml .= '<fechaconf>' . $cnt["fechaconf"] . '</fechaconf>' . chr(13);
            $xml .= '<estadomult>' . $cnt["estadomult"] . '</estadomult>' . chr(13);
            $xml .= '<numrev>' . $cnt["numrev"] . '</numrev>' . chr(13);
            $xml .= '<fechanumrev>' . $cnt["fechanumrev"] . '</fechanumrev>' . chr(13);
            $xml .= '<numlibro>' . $cnt["numlibro"] . '</numlibro>' . chr(13);
            $xml .= '<numreglib>' . $cnt["numreglib"] . '</numreglib>' . chr(13);
            $xml .= '<fecreglib>' . $cnt["fecreglib"] . '</fecreglib>' . chr(13);
            $xml .= '<codigocamaraorigen>' . $cnt["codigocamaraorigen"] . '</codigocamaraorigen>' . chr(13);
            $xml .= '<numregistrocamaraorigen>' . $cnt["numregistrocamaraorigen"] . '</numregistrocamaraorigen>' . chr(13);
            $xml .= '<fecregistrocamaraorigen>' . $cnt["fecregistrocamaraorigen"] . '</fecregistrocamaraorigen>' . chr(13);
            $xml .= '</multa>' . chr(13);
        }

        foreach ($_SESSION["formulario"]["datos"]["sanciones"] as $cnt) {
            if (!isset($cnt["isn"])) {
                $cnt["isn"] = '';
            }
            if (!isset($cnt["codcamara"])) {
                $cnt["codcamara"] = '';
            }
            if (!isset($cnt["numradic"])) {
                $cnt["numradic"] = '';
            }
            if (!isset($cnt["fecradic"])) {
                $cnt["fecradic"] = '';
            }
            if (!isset($cnt["horradic"])) {
                $cnt["horradic"] = '';
            }
            if (!isset($cnt["fecreporte"])) {
                $cnt["fecreporte"] = '';
            }
            if (!isset($cnt["nitentidad"])) {
                $cnt["nitentidad"] = '';
            }
            if (!isset($cnt["nombreentidad"])) {
                $cnt["nombreentidad"] = '';
            }
            if (!isset($cnt["idmunientidad"])) {
                $cnt["idmunientidad"] = '';
            }
            if (!isset($cnt["divarea"])) {
                $cnt["divarea"] = '';
            }
            if (!isset($cnt["idefun"])) {
                $cnt["idefun"] = '';
            }
            if (!isset($cnt["nomfun"])) {
                $cnt["nomfun"] = '';
            }
            if (!isset($cnt["carfun"])) {
                $cnt["carfun"] = '';
            }
            if (!isset($cnt["numcontrato"])) {
                $cnt["numcontrato"] = '';
            }
            if (!isset($cnt["numcontratosecop"])) {
                $cnt["numcontratosecop"] = '';
            }
            if (!isset($cnt["numacto"])) {
                $cnt["numacto"] = '';
            }
            if (!isset($cnt["fechaacto"])) {
                $cnt["fechaacto"] = '';
            }
            if (!isset($cnt["fechaeje"])) {
                $cnt["fechaeje"] = '';
            }
            if (!isset($cnt["numsus"])) {
                $cnt["numsus"] = '';
            }
            if (!isset($cnt["fechasus"])) {
                $cnt["fechasus"] = '';
            }
            if (!isset($cnt["numconf"])) {
                $cnt["numconf"] = '';
            }
            if (!isset($cnt["fechaconf"])) {
                $cnt["fechaconf"] = '';
            }
            if (!isset($cnt["estadosanc"])) {
                $cnt["estadosanc"] = '';
            }
            if (!isset($cnt["condinc"])) {
                $cnt["condinc"] = '';
            }
            if (!isset($cnt["cumsanc"])) {
                $cnt["cumsanc"] = '';
            }
            if (!isset($cnt["numrev"])) {
                $cnt["numrev"] = '';
            }
            if (!isset($cnt["fechanumrev"])) {
                $cnt["fechanumrev"] = '';
            }
            if (!isset($cnt["descripcion"])) {
                $cnt["descripcion"] = '';
            }
            if (!isset($cnt["fundamento"])) {
                $cnt["fundamento"] = '';
            }
            if (!isset($cnt["vigencia"])) {
                $cnt["vigencia"] = '';
            }
            if (!isset($cnt["numlibro"])) {
                $cnt["numlibro"] = '';
            }
            if (!isset($cnt["numreglib"])) {
                $cnt["numreglib"] = '';
            }
            if (!isset($cnt["fecreglib"])) {
                $cnt["fecreglib"] = '';
            }
            if (!isset($cnt["codigocamaraorigen"])) {
                $cnt["codigocamaraorigen"] = '';
            }
            if (!isset($cnt["numregistrocamaraorigen"])) {
                $cnt["numregistrocamaraorigen"] = '';
            }
            if (!isset($cnt["fecregistrocamaraorigen"])) {
                $cnt["fecregistrocamaraorigen"] = '';
            }


            $xml .= '<sancion>' . chr(13);
            $xml .= '<isn>' . $cnt["isn"] . '</isn>' . chr(13);
            $xml .= '<codcamara>' . $cnt["codcamara"] . '</codcamara>' . chr(13);
            $xml .= '<numradic>' . $cnt["numradic"] . '</numradic>' . chr(13);
            $xml .= '<fecradic>' . $cnt["fecradic"] . '</fecradic>' . chr(13);
            $xml .= '<horradic>' . $cnt["horradic"] . '</horradic>' . chr(13);
            $xml .= '<fecreporte>' . $cnt["fecreporte"] . '</fecreporte>' . chr(13);
            $xml .= '<nitentidad>' . $cnt["nitentidad"] . '</nitentidad>' . chr(13);
            $xml .= '<nombreentidad>' . $cnt["nombreentidad"] . '</nombreentidad>' . chr(13);
            $xml .= '<idmunientidad>' . $cnt["idmunientidad"] . '</idmunientidad>' . chr(13);
            $xml .= '<divarea>' . $cnt["divarea"] . '</divarea>' . chr(13);
            $xml .= '<idefun>' . $cnt["idefun"] . '</idefun>' . chr(13);
            $xml .= '<nomfun>' . $cnt["nomfun"] . '</nomfun>' . chr(13);
            $xml .= '<carfun>' . $cnt["carfun"] . '</carfun>' . chr(13);
            $xml .= '<numcontrato>' . $cnt["numcontrato"] . '</numcontrato>' . chr(13);
            $xml .= '<numcontratosecop>' . $cnt["numcontratosecop"] . '</numcontratosecop>' . chr(13);
            $xml .= '<numacto>' . $cnt["numacto"] . '</numacto>' . chr(13);
            $xml .= '<fechaacto>' . $cnt["fechaacto"] . '</fechaacto>' . chr(13);
            $xml .= '<fechaeje>' . $cnt["fechaeje"] . '</fechaeje>' . chr(13);
            $xml .= '<numsus>' . $cnt["numsus"] . '</numsus>' . chr(13);
            $xml .= '<fechasus>' . $cnt["fechasus"] . '</fechasus>' . chr(13);
            $xml .= '<numconf>' . $cnt["numconf"] . '</numconf>' . chr(13);
            $xml .= '<fechaconf>' . $cnt["fechaconf"] . '</fechaconf>' . chr(13);
            $xml .= '<estadosanc>' . $cnt["estadosanc"] . '</estadosanc>' . chr(13);
            $xml .= '<condinc>' . $cnt["condinc"] . '</condinc>' . chr(13);
            $xml .= '<cumsanc>' . $cnt["cumsanc"] . '</cumsanc>' . chr(13);
            $xml .= '<numrev>' . $cnt["numrev"] . '</numrev>' . chr(13);
            $xml .= '<dessanc>' . $cnt["descripcion"] . '</dessanc>' . chr(13);
            $xml .= '<fundamento>' . $cnt["fundamento"] . '</fundamento>' . chr(13);
            $xml .= '<vigencia>' . $cnt["vigencia"] . '</vigencia>' . chr(13);
            $xml .= '<fechanumrev>' . $cnt["fechanumrev"] . '</fechanumrev>' . chr(13);
            $xml .= '<numlibro>' . $cnt["numlibro"] . '</numlibro>' . chr(13);
            $xml .= '<numreglib>' . $cnt["numreglib"] . '</numreglib>' . chr(13);
            $xml .= '<fecreglib>' . $cnt["fecreglib"] . '</fecreglib>' . chr(13);
            $xml .= '<codigocamaraorigen>' . $cnt["codigocamaraorigen"] . '</codigocamaraorigen>' . chr(13);
            $xml .= '<numregistrocamaraorigen>' . $cnt["numregistrocamaraorigen"] . '</numregistrocamaraorigen>' . chr(13);
            $xml .= '<fecregistrocamaraorigen>' . $cnt["fecregistrocamaraorigen"] . '</fecregistrocamaraorigen>' . chr(13);
            $xml .= '</sancion>' . chr(13);
        }

        foreach ($_SESSION["formulario"]["datos"]["sandis"] as $cnt) {
            if (!isset($cnt["isn"])) {
                $cnt["isn"] = '';
            }
            if (!isset($cnt["codcamara"])) {
                $cnt["codcamara"] = '';
            }
            if (!isset($cnt["numradic"])) {
                $cnt["numradic"] = '';
            }
            if (!isset($cnt["fecradic"])) {
                $cnt["fecradic"] = '';
            }
            if (!isset($cnt["horradic"])) {
                $cnt["horradic"] = '';
            }
            if (!isset($cnt["fecreporte"])) {
                $cnt["fecreporte"] = '';
            }
            if (!isset($cnt["nitentidad"])) {
                $cnt["nitentidad"] = '';
            }
            if (!isset($cnt["nombreentidad"])) {
                $cnt["nombreentidad"] = '';
            }
            if (!isset($cnt["idmunientidad"])) {
                $cnt["idmunientidad"] = '';
            }
            if (!isset($cnt["divarea"])) {
                $cnt["divarea"] = '';
            }
            if (!isset($cnt["idefun"])) {
                $cnt["idefun"] = '';
            }
            if (!isset($cnt["nomfun"])) {
                $cnt["nomfun"] = '';
            }
            if (!isset($cnt["carfun"])) {
                $cnt["carfun"] = '';
            }
            if (!isset($cnt["numcontratosecop"])) {
                $cnt["numcontratosecop"] = '';
            }
            if (!isset($cnt["numacto"])) {
                $cnt["numacto"] = '';
            }
            if (!isset($cnt["fechaacto"])) {
                $cnt["fechaacto"] = '';
            }
            if (!isset($cnt["fechaeje"])) {
                $cnt["fechaeje"] = '';
            }
            if (!isset($cnt["numsus"])) {
                $cnt["numsus"] = '';
            }
            if (!isset($cnt["fechasus"])) {
                $cnt["fechasus"] = '';
            }
            if (!isset($cnt["numconf"])) {
                $cnt["numconf"] = '';
            }
            if (!isset($cnt["fechaconf"])) {
                $cnt["fechaconf"] = '';
            }
            if (!isset($cnt["estadosanc"])) {
                $cnt["estadosanc"] = '';
            }
            if (!isset($cnt["numrev"])) {
                $cnt["numrev"] = '';
            }
            if (!isset($cnt["fechanumrev"])) {
                $cnt["fechanumrev"] = '';
            }
            if (!isset($cnt["descripcion"])) {
                $cnt["descripcion"] = '';
            }
            if (!isset($cnt["fundamento"])) {
                $cnt["fundamento"] = '';
            }
            if (!isset($cnt["vigencia"])) {
                $cnt["vigencia"] = '';
            }
            if (!isset($cnt["numlibro"])) {
                $cnt["numlibro"] = '';
            }
            if (!isset($cnt["numreglib"])) {
                $cnt["numreglib"] = '';
            }
            if (!isset($cnt["fecreglib"])) {
                $cnt["fecreglib"] = '';
            }
            if (!isset($cnt["codigocamaraorigen"])) {
                $cnt["codigocamaraorigen"] = '';
            }
            if (!isset($cnt["numregistrocamaraorigen"])) {
                $cnt["numregistrocamaraorigen"] = '';
            }
            if (!isset($cnt["fecregistrocamaraorigen"])) {
                $cnt["fecregistrocamaraorigen"] = '';
            }

            $xml .= '<sandis>' . chr(13);
            $xml .= '<isn>' . $cnt["isn"] . '</isn>' . chr(13);
            $xml .= '<codcamara>' . $cnt["codcamara"] . '</codcamara>' . chr(13);
            $xml .= '<numradic>' . $cnt["numradic"] . '</numradic>' . chr(13);
            $xml .= '<fecradic>' . $cnt["fecradic"] . '</fecradic>' . chr(13);
            $xml .= '<horradic>' . $cnt["horradic"] . '</horradic>' . chr(13);
            $xml .= '<fecreporte>' . $cnt["fecreporte"] . '</fecreporte>' . chr(13);
            $xml .= '<nitentidad>' . $cnt["nitentidad"] . '</nitentidad>' . chr(13);
            $xml .= '<nombreentidad>' . $cnt["nombreentidad"] . '</nombreentidad>' . chr(13);
            $xml .= '<idmunientidad>' . $cnt["idmunientidad"] . '</idmunientidad>' . chr(13);
            $xml .= '<divarea>' . $cnt["divarea"] . '</divarea>' . chr(13);
            $xml .= '<idefun>' . $cnt["idefun"] . '</idefun>' . chr(13);
            $xml .= '<nomfun>' . $cnt["nomfun"] . '</nomfun>' . chr(13);
            $xml .= '<carfun>' . $cnt["carfun"] . '</carfun>' . chr(13);
            $xml .= '<numcontratosecop>' . $cnt["numcontratosecop"] . '</numcontratosecop>' . chr(13);
            $xml .= '<numacto>' . $cnt["numacto"] . '</numacto>' . chr(13);
            $xml .= '<fechaacto>' . $cnt["fechaacto"] . '</fechaacto>' . chr(13);
            $xml .= '<fechaeje>' . $cnt["fechaeje"] . '</fechaeje>' . chr(13);
            $xml .= '<numsus>' . $cnt["numsus"] . '</numsus>' . chr(13);
            $xml .= '<fechasus>' . $cnt["fechasus"] . '</fechasus>' . chr(13);
            $xml .= '<numconf>' . $cnt["numconf"] . '</numconf>' . chr(13);
            $xml .= '<fechaconf>' . $cnt["fechaconf"] . '</fechaconf>' . chr(13);
            $xml .= '<estadosanc>' . $cnt["estadosanc"] . '</estadosanc>' . chr(13);
            $xml .= '<numrev>' . $cnt["numrev"] . '</numrev>' . chr(13);
            $xml .= '<dessanc>' . $cnt["descripcion"] . '</dessanc>' . chr(13);
            $xml .= '<fundamento>' . $cnt["fundamento"] . '</fundamento>' . chr(13);
            $xml .= '<vigencia>' . $cnt["vigencia"] . '</vigencia>' . chr(13);
            $xml .= '<fechanumrev>' . $cnt["fechanumrev"] . '</fechanumrev>' . chr(13);
            $xml .= '<numlibro>' . $cnt["numlibro"] . '</numlibro>' . chr(13);
            $xml .= '<numreglib>' . $cnt["numreglib"] . '</numreglib>' . chr(13);
            $xml .= '<fecreglib>' . $cnt["fecreglib"] . '</fecreglib>' . chr(13);
            $xml .= '<codigocamaraorigen>' . $cnt["codigocamaraorigen"] . '</codigocamaraorigen>' . chr(13);
            $xml .= '<numregistrocamaraorigen>' . $cnt["numregistrocamaraorigen"] . '</numregistrocamaraorigen>' . chr(13);
            $xml .= '<fecregistrocamaraorigen>' . $cnt["fecregistrocamaraorigen"] . '</fecregistrocamaraorigen>' . chr(13);
            $xml .= '</sancion>' . chr(13);
        }

        $xml .= '</expediente>' . chr(13);
        $xml .= '</expedientes>' . chr(13);
        return $xml;
    }

    public static function tamano80SentarPagoSii($txt) {
        $salida = '';
        if (strlen($txt) > 78) {
            $salida = substr($txt, 0, 78);
        } else {
            $salida = sprintf("%-78s", $txt);
        }
        return $salida;
    }

    //
    public static function tamanoArchivo($file) {
        if (!file_exists($file)) {
            return 0;
        } else {
            return (filesize($file));
        }
    }

    public static function truncateFloat($number, $digitos, $pd = '.', $pm = ',') {
        $raiz = 10;
        $multiplicador = pow($raiz, $digitos);
        $resultado = ((int) ($number * $multiplicador)) / $multiplicador;
        $x = number_format($resultado, $digitos, $pd, $pm);
        $x = str_replace(",", "", $x);
        return $x;
    }

    public static function truncateFloatForm($number, $digitos, $pd = '.', $pm = ',') {
        $raiz = 10;
        $multiplicador = pow($raiz, $digitos);
        $resultado = ((int) ($number * $multiplicador)) / $multiplicador;
        $x = number_format($resultado, $digitos, $pd, $pm);
        return $x;
    }

    public static function truncateFinancialIndexes($number) {
        $sep = explode(",", $number);
        if (isset($sep[1])) {
            if (strlen($sep[1]) == 1) {
                $number = $sep[0] . ',' . $sep[1] . '0';
            }
            if (strlen($sep[1]) > 2) {
                $number = $sep[0] . ',' . substr($sep[1], 0, 2);
            }
        }
        return $number;
    }

    public static function retornarExpedienteProponenteSii($dbx = null, $prop, $mat = '', $tipotramite = '', $proceso = 'Sin identificar la rutina', $origen = '', $retornarInhabilidad = 'si', $retornarRee = 'si') {

        require_once ('LogSii2.class.php');
        require_once ('generales.php');
        require_once ('funcionesSii2_desserializaciones.php');

        // Instancia la BD si no existe
        // ********************************************************************************** //
        if ($dbx === null) {
            $mysqli = new mysqli(DB_HOST, DB_USUARIO, DB_PASSWORD, DB_NAME, DB_PORT);
            if (mysqli_connect_error()) {
                $_SESSION["generales"]["mensajerror"] = 'Error conectando con la BD';
                return false;
            }
        } else {
            $mysqli = $dbx;
        }


        $fecultinsc = '';
        $estadoultimainscripcion = '';
        $estadoultimoacto = '';
        $cantidadnofirme = 0;
        $cantidadnopublicadasrues = 0;
        $fecultren = '';
        $fecultact = '';
        $fecultcanc = '';


        //
        if (ltrim($prop, "0") != '') {
            $arrTemIns = retornarRegistroMysqli2($mysqli, 'mreg_est_inscritos', "proponente='" . ltrim($prop, "0") . "'");
            if ($arrTemIns === false || empty($arrTemIns)) {
                $_SESSION["generales"]["mensajeerror"] = '(1) Proponente no encontrado en mreg_est_inscritos';
                return false;
            } else {
                $arrTem = retornarRegistroMysqli2($mysqli, 'mreg_est_proponentes', "proponente='" . ltrim($prop, "0") . "'");
                if ($arrTem === false || empty($arrTem)) {
                    $_SESSION["generales"]["mensajeerror"] = '(2) Proponente no encontrado en mreg_est_proponentes';
                    return false;
                }
            }
        }

        if (ltrim($prop, "0") != '') {
            if (ltrim($arrTemIns["matricula"], "0") != '') {
                if ($arrTemIns["ctrestmatricula"] != 'MA' && $arrTemIns["ctrestmatricula"] != 'MI' && $arrTemIns["ctrestmatricula"] != 'IA' && $arrTemIns["ctrestmatricula"] != 'II') {
                    $arrTemMer = false;
                } else {
                    $arrTemMer = $arrTemIns;
                }
            } else {
                $arrTemMer = false;
            }
        } else {
            $arrTem = false;
            $arrTemIns = false;
            if (ltrim($mat, "0") != '') {
                $arrTemMer = retornarRegistroMysqli2($mysqli, 'mreg_est_inscritos', "matricula='" . ltrim($mat, "0") . "'");
                if ($arrTemMer["ctrestmatricula"] != 'MA' && $arrTemMer["ctrestmatricula"] != 'MI' && $arrTemMer["ctrestmatricula"] != 'IA' && $arrTemMer["ctrestmatricula"] != 'II') {
                    $arrTemMer = false;
                }
            }
        }

        //
        $retorno["tipotramite"] = $tipotramite;
        $retorno["numerorecuperacion"] = '';
        $retorno["numeroliquidacion"] = '';

        // Inicializa arreglos generales
        $retorno["enfirme"] = array();        
        $retorno["sitcontrol"] = array();
        $retorno["exp1510"] = array();
        $retorno["clasi1510"] = array();
        $retorno["bienes"] = array();
        $retorno["contratos"] = array();
        $retorno["multas"] = array();
        $retorno["sanciones"] = array();
        $retorno["sandis"] = array();
        $retorno["inscripciones"] = array();
        $retorno["observaciones"] = '';
        $retorno["lcodigosbarras"] = array();
        $retorno["codigosbarraspendientes"] = '';
        $retorno["codigosbarras"] = 0;
        $retorno["recursostramite"] = '';
        $retorno["reeentramite"] = '';
        $retorno["representanteslegales"] = array();
        $retorno["inhabilidad"] = array();

        // ***************************************************************************** //
        // Relación de códigos de barras pendientes
        // ***************************************************************************** //
        if (ltrim($prop, "0") != '') {
            $arrX = retornarRegistrosMysqli2($mysqli, 'mreg_est_codigosbarras', "proponente='" . $prop . "'", "codigobarras");
            $ix = 0;
            if ($arrX && !empty($arrX)) {
                foreach ($arrX as $x) {
                    if ($x["actoreparto"] == '09' || // Trámites de proponentes locales
                            $x["actoreparto"] == '27' || // Recursos de reposición
                            $x["actoreparto"] == '53' // Trámites RUES de proponentes
                    ) {
                        if ($x["estadofinal"] == '01' || // Radicado
                                $x["estadofinal"] == '04' || // En estudio
                                $x["estadofinal"] == '09' || // Reingresado
                                $x["estadofinal"] == '10' || // Devuelto a reparto
                                $x["estadofinal"] == '11' || // Inscrito
                                $x["estadofinal"] == '13' || // Asignado a estudio
                                $x["estadofinal"] == '22' || // Registrado - proponentes
                                $x["estadofinal"] == '23' || // En digitacion
                                $x["estadofinal"] == '34' || // Para firma
                                $x["estadofinal"] == '35' || // Firmado
                                $x["estadofinal"] == '38' // Control de calidad
                        ) {
                            $ix++;
                            $retorno["lcodigosbarras"][$ix]["cbar"] = $x["codigobarras"];
                            $retorno["lcodigosbarras"][$ix]["frad"] = $x["fecharadicacion"];
                            $retorno["lcodigosbarras"][$ix]["ttra"] = $x["actoreparto"];
                            $retorno["lcodigosbarras"][$ix]["esta"] = $x["estadofinal"];
                            $retorno["lcodigosbarras"][$ix]["nesta"] = '';
                            $retorno["lcodigosbarras"][$ix]["ntra"] = retornarRegistroMysqli2($mysqli, 'mreg_tablassirep', "idtabla='01' and idcodigo='" . $retorno["lcodigosbarras"][$ix]["ttra"] . "'", "descripcion");
                            $retorno["lcodigosbarras"][$ix]["sist"] = retornarRegistroMysqli2($mysqli, 'mreg_tablassirep', "idtabla='01' and idcodigo='" . $retorno["lcodigosbarras"][$ix]["ttra"] . "'", "tipo");
                            $retorno["lcodigosbarras"][$ix]["nesta"] = retornarRegistroMysqli2($mysqli, 'mreg_tablassirep', "idtabla='82' and idcodigo='" . $retorno["lcodigosbarras"][$ix]["esta"] . "'", "descripcion");
                            $retorno["codigosbarras"] ++;
                        }
                    }

                    // Si la ruta es un recurso en trámite
                    if ($x["actoreparto"] == '19' || $x["actoreparto"] == '23' || $x["actoreparto"] == '54') {
                        $retorno["recursostramite"] = 'S';
                    }
                }
            }
        }

        // ***************************************************************************** //
        // ARMA LISTA COMPLETA DE INSCRIPCIONES
        // Encuentra ultimas fechas de cada acto de control
        // Encuentra el estado de la ultima inscripcion
        // ***************************************************************************** //
        // ****************************************************************************** //
        // Busca si existen reportes que no hayan sido inscritos
        // mreg_reportescontratos
        // mreg_reportesmultas
        // mreg_reportessanciones
        // mreg_reportessancionesdisciplinarias
        $where = '';
        if ($arrTemIns && trim($arrTemIns["numid"], "0") != '') {
            $where = "nitproponente='" . $arrTemIns["numid"] . "'";
        }
        if ($arrTemIns && trim($arrTemIns["nit"], "0") != '') {
            if ($where != '') {
                $where .= " or ";
            }
            $where .= "nitproponente='" . $arrTemIns["numid"] . "'";
        }
        if (ltrim(trim($prop), "0") != '') {
            if ($where != '') {
                $where .= " or ";
            }
            $where .= "numeroproponente='" . trim(trim($prop), "0") . "'";
        }
        if ($where != '') {
            $temx = retornarRegistrosMysqli2($mysqli, 'mreg_reportescontratos', $where, "id");
        } else {
            $temx = false;
        }
        if ($temx && !empty($temx)) {
            foreach ($temx as $tx) {
                if (ltrim(trim($tx["numeroregistro"]), "0") == '') {
                    $retorno["reeentramite"] = 'si';
                }
            }
        }
        if ($retorno["reeentramite"] != 'si') {
            if ($where != '') {
                $temx = retornarRegistrosMysqli2($mysqli, 'mreg_reportesmultas', $where, "id");
            } else {
                $temx = false;
            }
            if ($temx && !empty($temx)) {
                foreach ($temx as $tx) {
                    if (ltrim(trim($tx["numeroregistro"]), "0") == '') {
                        $retorno["reeentramite"] = 'si';
                    }
                }
            }
        }
        if ($retorno["reeentramite"] != 'si') {
            if ($where != '') {
                $temx = retornarRegistrosMysqli2($mysqli, 'mreg_reportessanciones', $where, "id");
            } else {
                $temx = false;
            }
            if ($temx && !empty($temx)) {
                foreach ($temx as $tx) {
                    if (ltrim(trim($tx["numeroregistro"]), "0") == '') {
                        $retorno["reeentramite"] = 'si';
                    }
                }
            }
        }
        if ($retorno["reeentramite"] != 'si') {
            if ($where != '') {
                $temx = retornarRegistrosMysqli2($mysqli, 'mreg_reportessancionesdisciplinarias', $where, "id");
            } else {
                $temx = false;
            }
            if ($temx && !empty($temx)) {
                foreach ($temx as $tx) {
                    if (ltrim(trim($tx["numeroregistro"]), "0") == '') {
                        $retorno["reeentramite"] = 'si';
                    }
                }
            }
        }

        // ***************************************************************************** //
        // ARMA LISTA COMPLETA DE INSCRIPCIONES
        // Encuentra ultimas fechas de cada acto de control
        // Encuentra el estado de la ultima inscripcion
        // ***************************************************************************** //

        $iInsc = 0;
        if (ltrim($prop, "0") != '') {
            $arrTemInsc = retornarRegistrosMysqli2($mysqli, 'mreg_est_inscripciones_proponentes', "proponente='" . $arrTem["proponente"] . "'", "fecharegistro,horaregistro");
            if ($arrTemInsc && !empty($arrTemInsc)) {
                foreach ($arrTemInsc as $insc) {
                    $iInsc++;
                    $retorno["inscripciones"][$iInsc] = array(
                        'libro' => $insc["libro"],
                        'registro' => $insc["registro"],
                        'fecharegistro' => $insc["fecharegistro"],
                        'horaregistro' => $insc["horaregistro"],
                        'fechadocumento' => $insc["fechadocumento"],
                        'tipodocumento' => $insc["tipodocumento"],
                        'acto' => $insc["acto"],
                        'fecpublicacionrue' => $insc["fecpublicacionrue"],
                        'idpublicacionrue' => $insc["idpublicacionrue"],
                        'estado' => $insc["estado"],
                        'texto' => $insc["texto"],
                        'ctrrevoca' => $insc["ctrrevoca"],
                        'registrorevocacion' => $insc["registrorevocacion"],
                        'fecharegistrorevocacion' => '' // Ojo calcular - 2017 08 22
                    );
                    if (trim($insc["acto"]) == '01') { // Ultima inscripcion
                        $cantidadnopublicadasrues = 0;
                        $cantidadnofirme = 0;
                        $fecultinsc = $insc["fecharegistro"];
                        $estadoultimainscripcion = $insc["estado"];
                        $estadoultimoacto = $insc["estado"];
                        $fecultren = '';
                        $fecultact = '';
                        $fecultcanc = '';
                        if ($insc["estado"] == '00') {
                            $cantidadnopublicadasrues++;
                        }
                        if ($insc["estado"] != '04') {
                            $cantidadnofirme++;
                        }
                    }
                    if (trim($insc["acto"]) == '16') { // Ultima inscripcion por cambio de domicilio
                        $cantidadnopublicadasrues = 0;
                        $cantidadnofirme = 0;
                        $fecultinsc = $insc["fecharegistro"];
                        $estadoultimainscripcion = '04';
                        $estadoultimoacto = '04'; // Automaticamente queda en firme
                        $fecultren = '';
                        $fecultact = '';
                        $fecultcanc = '';
                        if ($insc["estado"] == '00') {
                            $cantidadnopublicadasrues++;
                        }
                        /*
                          if ($insc["estado"] != '04') {
                          $cantidadnofirme++;
                          }
                         */
                    }
                    if (trim($insc["acto"]) == '02') { // Ultima renovacion
                        $fecultren = $insc["fecharegistro"];
                        $estadoultimoacto = $insc["estado"];
                        if ($insc["estado"] == '00') {
                            $cantidadnopublicadasrues++;
                        }
                        if ($insc["estado"] != '04') {
                            $cantidadnofirme++;
                        }
                    }
                    if (trim($insc["acto"]) == '03') { // Ultima actualización
                        $fecultact = $insc["fecharegistro"];
                        $estadoultimoacto = $insc["estado"];
                        if ($insc["estado"] == '00') {
                            $cantidadnopublicadasrues++;
                        }
                        if ($insc["estado"] != '04') {
                            $cantidadnofirme++;
                        }
                    }
                    if (trim($insc["acto"]) == '04' || trim($insc["acto"]) == '05') { // Ultima cancelacion - cesacion
                        // if ($insc["estado"] == '00') {
                        //     $cantidadnopublicadasrues++;
                        // }
                        $fecultcanc = $insc["fecharegistro"];
                    }
                }
            }

            $retorno["observaciones"] = '';
            if ($cantidadnopublicadasrues > 0) {
                $retorno["observaciones"] .= '!!! CUIDADO !!! Existen inscripciones en libros que no han sido publicadas al RUES';
            }
            if ($cantidadnofirme > 0) {
                if ($retorno["observaciones"] != '') {
                    $retorno["observaciones"] .= '<br><br>';
                }
                $retorno["observaciones"] .= '!!! CUIDADO !!! Existen inscripciones en libros que aún no han adquirido firmeza';
            }
        }

        // ***************************************************************************** //
        // ARMA DATOS ACTUALIZADOS DEL EXPEDIENTE
        // ES LA INFORMACIÓN ACTUAL, INCLUSIVE SI NO ESTÁ EN FIRME
        // ***************************************************************************** //
        // Datos de Identificacion del expediente
        if ($arrTemIns) {
            $retorno["proponente"] = ltrim(trim($arrTemIns["proponente"]), "0");
            $retorno["matricula"] = ltrim(trim($arrTemIns["matricula"]), "0");
            $retorno["ctrestmatricula"] = trim($arrTemIns["ctrestmatricula"]);
            $retorno["fecmatricula"] = trim($arrTemIns["fecmatricula"]);
            $retorno["nombre"] = trim($arrTemIns["razonsocial"]);
            $retorno["ape1"] = trim($arrTemIns["apellido1"]);
            $retorno["ape2"] = trim($arrTemIns["apellido2"]);
            $retorno["nom1"] = trim($arrTemIns["nombre1"]);
            $retorno["nom2"] = trim($arrTemIns["nombre2"]);
            $retorno["sigla"] = trim($arrTemIns["sigla"]);
            $retorno["idtipoidentificacion"] = $arrTemIns["idclase"];
            $retorno["categoria"] = $arrTemIns["categoria"];
            $retorno["identificacion"] = ltrim(trim($arrTemIns["numid"]), "0");

            $retorno["idpaisidentificacion"] = ''; // 20170607 - Nuevo campo por circular única
            $retorno["idmunidoc"] = ''; // 20170607 - Nuevo campo por circular única
            $retorno["fecexpdoc"] = ''; // 20170607 - Nuevo campo por circular única

            $retorno["nit"] = ltrim(trim($arrTemIns["nit"]), "0");
            $retorno["nacionalidad"] = trim($arrTemIns["nacionalidad"]);
            $retorno["organizacion"] = trim($arrTemIns["organizacion"]);
            if ($arrTem) {
                $retorno["tamanoempresa"] = trim($arrTem["tamanoempresa"]);
                $retorno["emprendedor28"] = trim($arrTem["emprendedor28"]);
                $retorno["pemprendedor28"] = trim($arrTem["pemprendedor28"]);
                $retorno["vigcontrol"] = trim($arrTem["vigcontrol"]);
                $retorno["certificardesde"] = trim($arrTem["certificardesde"]);
            }

            // Datos de cambio de domicilio
            $retorno["propcamaraorigen"] = '';
            if ($arrTem) {
                $retorno["cambidom_idmunicipioorigen"] = trim($arrTem["cambidom_idmunicipioorigen"]);
                $retorno["cambidom_idmunicipiodestino"] = trim($arrTem["cambidom_idmunicipiodestino"]);
                $retorno["cambidom_fechaultimainscripcion"] = trim($arrTem["cambidom_fechaultimainscripcion"]);
                $retorno["cambidom_fechaultimarenovacion"] = trim($arrTem["cambidom_fechaultimarenovacion"]);
            }

            // Datos de catalogacion del registro
            $retorno["idestadoproponente"] = trim($arrTemIns["ctrestproponente"]);
            $retorno["fechaultimainscripcion"] = $fecultinsc;
            $retorno["fechaultimarenovacion"] = $fecultren;
            $retorno["fechaultimaactualizacion"] = $fecultact;
            $retorno["fechacancelacion"] = $fecultcanc;

            //LLENA CON INFORMACION DE mreg_est_proponentes
            if ($arrTem) {
                $retorno["idtipodocperjur"] = trim($arrTem["idtipodocperjur"]);
                $retorno["numdocperjur"] = trim($arrTem["numdocperjur"]);
                $retorno["fecdocperjur"] = trim($arrTem["fechaconstitucion"]);
                $retorno["origendocperjur"] = trim($arrTem["origendocperjur"]);
                $retorno["fechaconstitucion"] = trim($arrTem["fechaconstitucion"]);
                $retorno["fechavencimiento"] = trim($arrTem["fechavencimiento"]);
            }

            // informacion de ubicacion comercial en el registro mercantil
            if ($arrTem) {
                $retorno["dircom"] = trim($arrTem["dircom"]);
                $retorno["dircom_tipovia"] = '';
                $retorno["dircom_numvia"] = '';
                $retorno["dircom_apevia"] = '';
                $retorno["dircom_orivia"] = '';
                $retorno["dircom_numcruce"] = '';
                $retorno["dircom_apecruce"] = '';
                $retorno["dircom_oricruce"] = '';
                $retorno["dircom_numplaca"] = '';
                $retorno["dircom_complemento"] = '';
                $retorno["muncom"] = trim($arrTem["muncom"]);
                $retorno["paicom"] = '';  // Nuevo campo circular 002
                $retorno["telcom1"] = trim($arrTem["telcom1"]);
                $retorno["telcom2"] = trim($arrTem["telcom2"]);
                $retorno["faxcom"] = trim($arrTem["faxcom"]);
                $retorno["celcom"] = trim($arrTem["celcom"]);
                $retorno["emailcom"] = trim($arrTem["emailcom"]);
                $retorno["enviarint"] = trim($arrTem["enviarint"]);
                $retorno["codigopostalcom"] = ''; // Nuevo campo circular 002
                $retorno["codigozonacom"] = ''; // Nuevo campo circular 002 R/U
                // informacion de ubicacion de notificacion
                $retorno["dirnot"] = trim($arrTem["dirnot"]);
                $retorno["dirnot_tipovia"] = '';
                $retorno["dirnot_numvia"] = '';
                $retorno["dirnot_apevia"] = '';
                $retorno["dirnot_orivia"] = '';
                $retorno["dirnot_numcruce"] = '';
                $retorno["dirnot_apecruce"] = '';
                $retorno["dirnot_oricruce"] = '';
                $retorno["dirnot_numplaca"] = '';
                $retorno["dirnot_complemento"] = '';
                $retorno["munnot"] = trim($arrTem["munnot"]);
                $retorno["painot"] = '';  // Nuevo campo circular 002
                $retorno["telnot"] = trim($arrTem["telnot"]);
                $retorno["telnot2"] = trim($arrTem["telnot2"]);
                $retorno["faxnot"] = trim($arrTem["faxnot"]);
                $retorno["celnot"] = trim($arrTem["celnot"]);
                $retorno["emailnot"] = trim($arrTem["emailnot"]);
                $retorno["enviarnot"] = trim($arrTem["enviarnot"]);
                $retorno["codigopostalnot"] = ''; // Nuevo campo circular 002
                $retorno["codigozonanot"] = ''; // Nuevo campo circular 002 R/U
                $retorno["facultades"] = trim($arrTem["facultades"]);
            }

            // Informacion financiera decreto 1510
            if ($arrTem) {
                $retorno["gruponiif"] = ''; // Nuevo campo circular 002 - (pagina 2 del formulario)
                $retorno["gruponiiftextual"] = ''; // Nuevo campo circular 002 - (Anexo 2 hoja 1)
                $retorno["marcotecnicoanterior"] = ''; // Nuevo campo circular 002 - (Anexo 2 hoja 1)
                $retorno["inffin1510_fechacorte"] = trim($arrTem["inffin1510_fechacorte"]);
                $retorno["inffin1510_actcte"] = trim($arrTem["inffin1510_actcte"]);
                $retorno["inffin1510_actnocte"] = trim($arrTem["inffin1510_actnocte"]);
                $retorno["inffin1510_fijnet"] = trim($arrTem["inffin1510_fijnet"]);
                $retorno["inffin1510_actotr"] = trim($arrTem["inffin1510_actotr"]);
                $retorno["inffin1510_actval"] = trim($arrTem["inffin1510_actval"]);
                $retorno["inffin1510_acttot"] = trim($arrTem["inffin1510_acttot"]);

                $retorno["inffin1510_pascte"] = trim($arrTem["inffin1510_pascte"]);
                $retorno["inffin1510_paslar"] = trim($arrTem["inffin1510_paslar"]);
                $retorno["inffin1510_pastot"] = trim($arrTem["inffin1510_pastot"]);
                $retorno["inffin1510_patnet"] = trim($arrTem["inffin1510_patnet"]);
                $retorno["inffin1510_paspat"] = trim($arrTem["inffin1510_paspat"]);
                $retorno["inffin1510_balsoc"] = trim($arrTem["inffin1510_balsoc"]);

                $retorno["inffin1510_ingope"] = trim($arrTem["inffin1510_ingope"]);
                $retorno["inffin1510_ingnoope"] = trim($arrTem["inffin1510_ingnoope"]);
                $retorno["inffin1510_gasope"] = trim($arrTem["inffin1510_gasope"]);
                $retorno["inffin1510_gasnoope"] = trim($arrTem["inffin1510_gasnoope"]);
                $retorno["inffin1510_cosven"] = trim($arrTem["inffin1510_cosven"]);
                $retorno["inffin1510_utinet"] = trim($arrTem["inffin1510_utinet"]);
                $retorno["inffin1510_utiope"] = trim($arrTem["inffin1510_utiope"]);
                $retorno["inffin1510_gasint"] = trim($arrTem["inffin1510_gasint"]);
                $retorno["inffin1510_gasimp"] = trim($arrTem["inffin1510_gasimp"]);

                $retorno["inffin1510_indliq"] = trim($arrTem["inffin1510_indliq"]);
                $retorno["inffin1510_nivend"] = trim($arrTem["inffin1510_nivend"]);
                $retorno["inffin1510_razcob"] = trim($arrTem["inffin1510_razcob"]);
                $retorno["inffin1510_renpat"] = trim($arrTem["inffin1510_renpat"]);
                $retorno["inffin1510_renact"] = trim($arrTem["inffin1510_renact"]);

                // 2017-04-17: JINT: COn  el animo de mitigar el problema de los decimales en el certificado
                if (doubleval($retorno["inffin1510_patnet"]) != 0) {
                    $retorno["inffin1510_renpat"] = $retorno["inffin1510_utiope"] / $retorno["inffin1510_patnet"];
                }

                if (doubleval($retorno["inffin1510_acttot"]) != 0) {
                    $retorno["inffin1510_renact"] = $retorno["inffin1510_utiope"] / $retorno["inffin1510_acttot"];
                }

                //
                $retorno["inffin1510_actnocte"] = $retorno["inffin1510_actnocte"] +
                        $retorno["inffin1510_fijnet"] +
                        $retorno["inffin1510_actotr"] +
                        $retorno["inffin1510_actval"];

                $retorno["inffin1510_gruponiif"] = trim($arrTem["gruponiif"]);
            }
        }

        //
        if ($arrTemMer) {
            $arrTemx = \funcionesSii2::retornarExpedienteMercantilSii(null, $arrTemMer["matricula"],'','','','N');
            $retorno["nombre"] = trim($arrTemMer["razonsocial"]);
            $retorno["ape1"] = trim($arrTemMer["apellido1"]);
            $retorno["ape2"] = trim($arrTemMer["apellido2"]);
            $retorno["nom1"] = trim($arrTemMer["nombre1"]);
            $retorno["nom2"] = trim($arrTemMer["nombre2"]);
            $retorno["sigla"] = trim($arrTemMer["sigla"]);

            $retorno["tipoidentificacion"] = $arrTemMer["idclase"];
            $retorno["categoria"] = $arrTemMer["categoria"];

            $retorno["identificacion"] = ltrim(trim($arrTemMer["numid"]), "0");
            $retorno["idpaisidentificacion"] = '';
            $retorno["nit"] = ltrim(trim($arrTemMer["nit"]), "0");
            $retorno["nacionalidad"] = trim($arrTemMer["nacionalidad"]);
            $retorno["organizacion"] = trim($arrTemMer["organizacion"]);
            // $retorno["tamanoempresa"] = trim($arrTemMer["tamanoempresa"]);
            $retorno["emprendedor28"] = trim($arrTemMer["emprendedor28"]);
            $retorno["pemprendedor28"] = trim($arrTemMer["pemprendedor28"]);
            $retorno["vigcontrol"] = trim($arrTemMer["vigcontrol"]);

            //LLENA CON INFORMACION DE mreg_est_proponentes
            $retorno["idtipodocperjur"] = '';
            $retorno["numdocperjur"] = '';
            $retorno["fecdocperjur"] = '';
            $retorno["origendocperjur"] = '';
            $retorno["fechaconstitucion"] = trim($arrTemx["fechaconstitucion"]);
            $retorno["fechavencimiento"] = trim($arrTemx["fechavencimiento"]);
            if (trim($retorno["fechavencimiento"]) == '99999999') {
                $retorno["fechavencimiento"] = '';
            }

            //
            if ($retorno["organizacion"] > '02') {
                foreach ($arrTemx["inscripciones"] as $ix) {
                    if ($ix["grupoacto"] == '005') {
                        $retorno["idtipodocperjur"] = $ix["tdoc"];
                        $retorno["numdocperjur"] = $ix["ndoc"];
                        $retorno["fecdocperjur"] = $ix["fdoc"];
                        $retorno["origendocperjur"] = $ix["txoridoc"];
                    }
                }
                if ($retorno["idtipodocperjur"] == '') {
                    $retorno["numdocperjur"] = $arrTemx["numperj"];
                    $retorno["fecdocperjur"] = $arrTemx["fecperj"];
                }
            }


            //
            $retorno["dircom"] = trim($arrTemMer["dircom"]);
            $retorno["dircom_tipovia"] = '';
            $retorno["dircom_numvia"] = '';
            $retorno["dircom_apevia"] = '';
            $retorno["dircom_orivia"] = '';
            $retorno["dircom_numcruce"] = '';
            $retorno["dircom_apecruce"] = '';
            $retorno["dircom_oricruce"] = '';
            $retorno["dircom_numplaca"] = '';
            $retorno["dircom_complemento"] = '';
            $retorno["muncom"] = trim($arrTemMer["muncom"]);
            $retorno["paicom"] = trim($arrTemMer["paicom"]);
            $retorno["telcom1"] = trim($arrTemMer["telcom1"]);
            $retorno["telcom2"] = trim($arrTemMer["telcom2"]);
            $retorno["faxcom"] = trim($arrTemMer["faxcom"]);
            $retorno["celcom"] = trim($arrTemMer["telcom3"]);
            $retorno["emailcom"] = trim($arrTemMer["emailcom"]);
            $retorno["enviarint"] = trim($arrTemMer["ctrnotemail"]);
            $retorno["codigopostalcom"] = trim($arrTemMer["codigopostalcom"]);
            $retorno["codigozonacom"] = trim($arrTemMer["codigozonacom"]);


            // informacion de ubicacion de notificacion
            $retorno["dirnot"] = trim($arrTemMer["dirnot"]);
            $retorno["dirnot_tipovia"] = '';
            $retorno["dirnot_numvia"] = '';
            $retorno["dirnot_apevia"] = '';
            $retorno["dirnot_orivia"] = '';
            $retorno["dirnot_numcruce"] = '';
            $retorno["dirnot_apecruce"] = '';
            $retorno["dirnot_oricruce"] = '';
            $retorno["dirnot_numplaca"] = '';
            $retorno["dirnot_complemento"] = '';
            $retorno["munnot"] = trim($arrTemMer["munnot"]);
            $retorno["painot"] = trim($arrTemMer["painot"]);
            $retorno["telnot"] = trim($arrTemMer["telnot"]);
            $retorno["telnot2"] = trim($arrTemMer["telnot2"]);
            $retorno["faxnot"] = trim($arrTemMer["faxnot"]);
            $retorno["celnot"] = trim($arrTemMer["telnot3"]);
            $retorno["emailnot"] = trim($arrTemMer["emailnot"]);
            $retorno["enviarnot"] = trim($arrTemMer["ctrnotsms"]);
            $retorno["codigopostalnot"] = trim($arrTemMer["codigopostalnot"]);
            $retorno["codigozonanot"] = ''; // Adicionado con circular 002

            if (isset($arrTemx["crtsii"]["0041"]) && trim($arrTemx["crtsii"]["0041"]) != '') {
                $retorno["crt0041"] = $arrTemx["crtsii"]["0041"]; // Adicionado con circular 002
            } else {
                if (isset($arrTemx["crt"]["0041"]) && trim($arrTemx["crt"]["0041"]) != '') {
                    $retorno["crt0041"] = $arrTemx["crt"]["0041"]; // Adicionado con circular 
                }
            }

            if (isset($arrTemx["crtsii"]["1121"]) && trim($arrTemx["crtsii"]["1121"]) != '') {
                $retorno["crt1121"] = $arrTemx["crtsii"]["1121"]; // Adicionado con circular 002
            } else {
                if (isset($arrTemx["crt"]["1121"]) && trim($arrTemx["crt"]["1121"]) != '') {
                    $retorno["crt1121"] = $arrTemx["crt"]["1121"]; // Adicionado con circular 
                }
            }

            // Localiza vínculos de representación legal
            $i = 0;
            if (!empty($arrTemx["vinculos"])) {
                foreach ($arrTemx["vinculos"] as $v) {
                    if ($v["tipovinculo"] == 'RLP' ||
                            $v["tipovinculo"] == 'RLS' ||
                            $v["tipovinculo"] == 'RLS1' ||
                            $v["tipovinculo"] == 'RLS2' ||
                            $v["tipovinculo"] == 'RLS3' ||
                            $v["tipovinculo"] == 'RLS4') {
                        $i++;
                        $retorno["representanteslegales"][$i]["idtipoidentificacionrepleg"] = $v["idtipoidentificacionotros"];
                        $retorno["representanteslegales"][$i]["identificacionrepleg"] = $v["identificacionotros"];
                        $retorno["representanteslegales"][$i]["paisrepleg"] = $v["paisotros"];
                        $retorno["representanteslegales"][$i]["nombrerepleg"] = $v["nombreotros"];
                        $retorno["representanteslegales"][$i]["cargorepleg"] = $v["cargootros"];
                        $retorno["representanteslegales"][$i]["nom1"] = $v["nombre1otros"];
                        $retorno["representanteslegales"][$i]["nom2"] = $v["nombre2otros"];
                        $retorno["representanteslegales"][$i]["ape1"] = $v["apellido1otros"];
                        $retorno["representanteslegales"][$i]["ape2"] = $v["apellido2otros"];
                    }
                }
            }

            // Localiza facultades de los comerciantes
            $retorno["facultades"] = '';
            $certs = retornarRegistrosMysqli2($mysqli, 'mreg_codigos_certificas', "clase IN ('CRT-FACULTADES','CRT-ORGADM')", "id");
            if ($certs && !empty($certs)) {
                foreach ($certs as $cr) {
                    if (isset($arrTemx["crtsii"][$cr["id"]]) && trim($arrTemx["crtsii"][$cr["id"]]) != '') {
                        if ($retorno["facultades"] != '') {
                            $retorno["facultades"] .= "\r\n";
                        }
                        $retorno["facultades"] .= \funcionesSii2::reemplazarAcutesSii2($arrTemx["crtsii"][$cr["id"]]);
                    }
                }
                if (trim($retorno["facultades"]) == '') {
                    foreach ($certs as $cr) {
                        if (isset($arrTemx["crt"][$cr["id"]]) && trim($arrTemx["crt"][$cr["id"]]) != '') {
                            if ($retorno["facultades"] != '') {
                                $retorno["facultades"] .= "\r\n";
                            }
                            $retorno["facultades"] .= str_replace(array("||", "|"), array(chr(13), chr(10), " "), $arrTemx["crt"][$cr["id"]]);
                        }
                    }
                }
            }


            //
            unset($arrTemx);
        }

        //
        // Certificas que se han grabado en el SII
        $retorno["crtsii"] = array();
        $arrTemC = retornarRegistrosMysqli2($mysqli, 'mreg_certificas_sii', "registro='REGPRO' and expediente='" . ltrim($prop, "0") . "'", "idcertifica");
        if ($arrTemC && !empty($arrTemC)) {
            foreach ($arrTemC as $tx) {
                if (!isset($retorno["crtsii"][$tx["idcertifica"]])) {
                    $retorno["crtsii"][$tx["idcertifica"]] = '';
                }
                $retorno["crtsii"][$tx["idcertifica"]] .= \funcionesSii2::reemplazarAcutesSii2(trim($tx["contenido"]));
            }
        }
        unset($arrTemC);

        // Busca Representantes Legales - Cuando no es comerciante
        $i = 0;
        if ($arrTemMer === false && $arrTem) {
            $arrTemVin = retornarRegistrosMysqli2($mysqli, 'mreg_est_proponentes_representacion', "proponente='" . $arrTem["proponente"] . "'", "id");
            foreach ($arrTemVin as $v) {
                $i++;
                $retorno["representanteslegales"][$i]["idtipoidentificacionrepleg"] = $v["tipoidentificacion"];
                $retorno["representanteslegales"][$i]["identificacionrepleg"] = $v["identificacion"];
                $retorno["representanteslegales"][$i]["paisrepleg"] = ''; // nace con circular 002
                $retorno["representanteslegales"][$i]["nombrerepleg"] = $v["nombre"];
                $retorno["representanteslegales"][$i]["cargorepleg"] = $v["cargo"];
                $retorno["representanteslegales"][$i]["nom1"] = '';
                $retorno["representanteslegales"][$i]["nom2"] = '';
                $retorno["representanteslegales"][$i]["ape1"] = '';
                $retorno["representanteslegales"][$i]["ape2"] = '';
            }
        }

        // Busca Situaciones de control
        if (ltrim($prop, "0") != '') {
            $i = 0;
            $arrTemCer = retornarRegistrosMysqli2($mysqli, 'mreg_est_proponentes_sitcontrol', "proponente='" . ltrim($prop, "0") . "'", "secuencia");
            foreach ($arrTemCer as $c) {
                $i++;
                $retorno["sitcontrol"][$i]["nombre"] = $c["nombre"];
                $retorno["sitcontrol"][$i]["identificacion"] = $c["identificacion"];
                $retorno["sitcontrol"][$i]["domicilio"] = $c["domicilio"];
                $retorno["sitcontrol"][$i]["tipo"] = $c["tipo"];
            }
        }

        // Busca clasificaciones
        if (ltrim($prop, "0") != '') {
            $i = 0;
            $retorno["clasi1510"] = array();
            $arrTemCer = retornarRegistrosMysqli2($mysqli, 'mreg_est_proponentes_unspsc', "proponente='" . ltrim($prop, "0") . "'", "unspsc");
            foreach ($arrTemCer as $c) {
                $i++;
                $retorno["clasi1510"][$i] = $c["unspsc"];
            }
        }

        // Busca experiencia
        if (ltrim($prop, "0") != '') {
            $i = 0;
            $retorno["exp1510"] = array();
            $arrTemCer = retornarRegistrosMysqli2($mysqli, 'mreg_est_proponentes_experiencia', "proponente='" . ltrim($prop, "0") . "'", "secuencia");
            foreach ($arrTemCer as $c) {
                $i++;
                $retorno["exp1510"][$i]["secuencia"] = $c["secuencia"];
                $retorno["exp1510"][$i]["clavecontrato"] = '';
                $retorno["exp1510"][$i]["celebradopor"] = $c["celebradopor"];
                $retorno["exp1510"][$i]["nombrecontratista"] = \funcionesSii2::restaurarEspeciales(str_replace("?", "", trim($c["nombrecontratista"])));
                $retorno["exp1510"][$i]["nombrecontratante"] = \funcionesSii2::restaurarEspeciales(str_replace("?", "", trim($c["nombrecontratante"])));
                $retorno["exp1510"][$i]["fecejecucion"] = $c["fecejecucion"];
                $retorno["exp1510"][$i]["valor"] = $c["valor"];
                $retorno["exp1510"][$i]["porcentaje"] = $c["porcentaje"];
                $retorno["exp1510"][$i]["clasif"] = array();
                $arrx = explode(",", $c["clasificaciones"]);
                $iCla = 0;
                $tx = array();
                if (trim($c["clasificaciones"]) != '') {
                    if (!empty($arrx)) {
                        foreach ($arrx as $x) {
                            $x = trim($x);
                            if (!isset($tx[$x])) {
                                $iCla++;
                                $retorno["exp1510"][$i]["clasif"][$iCla] = trim($x);
                                $tx[$x] = $x;
                            }
                        }
                    }
                }
                unset($tx);
                $retorno["exp1510"][$i]["soportedeclaracion"] = '';
                $retorno["exp1510"][$i]["soportecontrato"] = '';
                $retorno["exp1510"][$i]["generardeclaracion"] = '';
                $retorno["exp1510"][$i]["revisado"] = '';
            }
        }

        // ***************************************************************************** //
        // ARMA ARREGLO DE DATOS EN FIRME
        // ***************************************************************************** //
        $retorno["enfirme"]["proponente"] = $retorno["proponente"];
        $retorno["enfirme"]["matricula"] = $retorno["matricula"];
        $retorno["enfirme"]["fecmatricula"] = $retorno["fecmatricula"];
        $retorno["enfirme"]["ctrestmatricula"] = $retorno["ctrestmatricula"];
        $retorno["enfirme"]["nombre"] = $retorno["nombre"];
        $retorno["enfirme"]["ape1"] = $retorno["ape1"];
        $retorno["enfirme"]["ape2"] = $retorno["ape2"];
        $retorno["enfirme"]["nom1"] = $retorno["nom1"];
        $retorno["enfirme"]["nom2"] = $retorno["nom2"];
        $retorno["enfirme"]["sigla"] = $retorno["sigla"];
        $retorno["enfirme"]["idtipoidentificacion"] = $retorno["idtipoidentificacion"];
        $retorno["enfirme"]["categoria"] = $retorno["categoria"];
        $retorno["enfirme"]["identificacion"] = $retorno["identificacion"];
        $retorno["enfirme"]["idpaisidentificacion"] = $retorno["idpaisidentificacion"];
        $retorno["enfirme"]["nit"] = $retorno["nit"];
        $retorno["enfirme"]["nacionalidad"] = $retorno["nacionalidad"];
        $retorno["enfirme"]["organizacion"] = $retorno["organizacion"];
        $retorno["enfirme"]["tamanoempresa"] = $retorno["tamanoempresa"];
        $retorno["enfirme"]["emprendedor28"] = $retorno["emprendedor28"];
        $retorno["enfirme"]["pemprendedor28"] = $retorno["pemprendedor28"];
        $retorno["enfirme"]["vigcontrol"] = $retorno["vigcontrol"];

        $retorno["enfirme"]["idestadoproponente"] = $retorno["idestadoproponente"];
        $retorno["enfirme"]["fechaultimainscripcion"] = $retorno["fechaultimainscripcion"];
        $retorno["enfirme"]["fechaultimarenovacion"] = $retorno["fechaultimarenovacion"];
        $retorno["enfirme"]["fechaultimaactualizacion"] = $retorno["fechaultimaactualizacion"];
        $retorno["enfirme"]["fechacancelacion"] = $retorno["fechacancelacion"];

        // Datos de cambio de domicilio
        $retorno["enfirme"]["propcamaraorigen"] = $retorno["propcamaraorigen"];
        $retorno["enfirme"]["cambidom_idmunicipioorigen"] = $retorno["cambidom_idmunicipioorigen"];
        $retorno["enfirme"]["cambidom_idmunicipiodestino"] = $retorno["cambidom_idmunicipiodestino"];
        $retorno["enfirme"]["cambidom_fechaultimainscripcion"] = $retorno["cambidom_fechaultimainscripcion"];
        $retorno["enfirme"]["cambidom_fechaultimarenovacion"] = $retorno["cambidom_fechaultimarenovacion"];

        $retorno["enfirme"]["dircom"] = $retorno["dircom"];
        $retorno["enfirme"]["muncom"] = $retorno["muncom"];
        $retorno["enfirme"]["telcom1"] = $retorno["telcom1"];
        $retorno["enfirme"]["telcom2"] = $retorno["telcom2"];
        $retorno["enfirme"]["faxcom"] = $retorno["faxcom"];
        $retorno["enfirme"]["celcom"] = $retorno["celcom"];
        $retorno["enfirme"]["emailcom"] = $retorno["emailcom"];
        $retorno["enfirme"]["enviarint"] = $retorno["enviarint"];

        // informacion de ubicacion de notificacion
        $retorno["enfirme"]["dirnot"] = $retorno["dirnot"];
        $retorno["enfirme"]["munnot"] = $retorno["munnot"];
        $retorno["enfirme"]["telnot"] = $retorno["telnot"];
        $retorno["enfirme"]["telnot2"] = $retorno["telnot2"];
        $retorno["enfirme"]["faxnot"] = $retorno["faxnot"];
        $retorno["enfirme"]["celnot"] = $retorno["celnot"];
        $retorno["enfirme"]["emailnot"] = $retorno["emailnot"];
        $retorno["enfirme"]["enviarnot"] = $retorno["enviarnot"];

        //
        $retorno["enfirme"]["inffin1510_fechacorte"] = $retorno["inffin1510_fechacorte"];
        $retorno["enfirme"]["inffin1510_actcte"] = $retorno["inffin1510_actcte"];
        $retorno["enfirme"]["inffin1510_actnocte"] = $retorno["inffin1510_actnocte"];
        $retorno["enfirme"]["inffin1510_fijnet"] = $retorno["inffin1510_fijnet"];
        $retorno["enfirme"]["inffin1510_actotr"] = $retorno["inffin1510_actotr"];
        $retorno["enfirme"]["inffin1510_actval"] = $retorno["inffin1510_actval"];
        $retorno["enfirme"]["inffin1510_acttot"] = $retorno["inffin1510_acttot"];
        $retorno["enfirme"]["inffin1510_pascte"] = $retorno["inffin1510_pascte"];
        $retorno["enfirme"]["inffin1510_paslar"] = $retorno["inffin1510_paslar"];
        $retorno["enfirme"]["inffin1510_pastot"] = $retorno["inffin1510_pastot"];
        $retorno["enfirme"]["inffin1510_patnet"] = $retorno["inffin1510_patnet"];
        $retorno["enfirme"]["inffin1510_paspat"] = $retorno["inffin1510_paspat"];
        $retorno["enfirme"]["inffin1510_balsoc"] = $retorno["inffin1510_balsoc"];
        $retorno["enfirme"]["inffin1510_ingope"] = $retorno["inffin1510_ingope"];
        $retorno["enfirme"]["inffin1510_ingnoope"] = $retorno["inffin1510_ingnoope"];


        //
        $retorno["enfirme"]["inffin1510_gasope"] = $retorno["inffin1510_gasope"];
        $retorno["enfirme"]["inffin1510_gasnoope"] = $retorno["inffin1510_gasnoope"];
        $retorno["enfirme"]["inffin1510_cosven"] = $retorno["inffin1510_cosven"];
        $retorno["enfirme"]["inffin1510_utinet"] = $retorno["inffin1510_utinet"];
        $retorno["enfirme"]["inffin1510_utiope"] = $retorno["inffin1510_utiope"];
        $retorno["enfirme"]["inffin1510_gasint"] = $retorno["inffin1510_gasint"];
        $retorno["enfirme"]["inffin1510_gasimp"] = $retorno["inffin1510_gasimp"];
        $retorno["enfirme"]["inffin1510_indliq"] = $retorno["inffin1510_indliq"];
        $retorno["enfirme"]["inffin1510_nivend"] = $retorno["inffin1510_nivend"];

        //
        $retorno["enfirme"]["inffin1510_razcob"] = $retorno["inffin1510_razcob"];
        $retorno["enfirme"]["inffin1510_renpat"] = $retorno["inffin1510_renpat"];
        $retorno["enfirme"]["inffin1510_renact"] = $retorno["inffin1510_renact"];

        // 2017-04-17: JINT: COn  el animo de mitigar el problema de los decimales en el certificado
        if (doubleval($retorno["enfirme"]["inffin1510_patnet"]) != 0) {
            $retorno["enfirme"]["inffin1510_renpat"] = $retorno["enfirme"]["inffin1510_utiope"] / $retorno["enfirme"]["inffin1510_patnet"];
        }

        if (doubleval($retorno["enfirme"]["inffin1510_acttot"]) != 0) {
            $retorno["enfirme"]["inffin1510_renact"] = $retorno["enfirme"]["inffin1510_utiope"] / $retorno["enfirme"]["inffin1510_acttot"];
        }

        $retorno["enfirme"]["inffin1510_gruponiif"] = $retorno["inffin1510_gruponiif"];

        //
        $retorno["enfirme"]["representanteslegales"] = $retorno["representanteslegales"];
        $retorno["enfirme"]["sitcontrol"] = $retorno["sitcontrol"];
        $retorno["enfirme"]["clasi1510"] = $retorno["clasi1510"];
        $retorno["enfirme"]["exp1510"] = $retorno["exp1510"];

        // 2017-09-20: JINT: Para no invocar dos veces a retornarExpedienteMercantil
        $retorno["enfirme"]["idtipodocperjur"] = $retorno["idtipodocperjur"];
        $retorno["enfirme"]["numdocperjur"] = $retorno["numdocperjur"];
        $retorno["enfirme"]["fecdocperjur"] = $retorno["fecdocperjur"];
        $retorno["enfirme"]["origendocperjur"] = $retorno["origendocperjur"];
        $retorno["enfirme"]["fechaconstitucion"] = $retorno["fechaconstitucion"];
        $retorno["enfirme"]["fechavencimiento"] = $retorno["fechavencimiento"];
        $retorno["enfirme"]["facultades"] = $retorno["facultades"];
        $retorno["enfirme"]["crt0041"] = isset($retorno["crt0041"]) ? $retorno["crt0041"] : "";
        $retorno["enfirme"]["crt1121"] = isset($retorno["crt1121"]) ? $retorno["crt1121"] : "";

        //Si el proponente es matriculado y se encuentra activo. 
        /*
          if ($arrTemMer) {
          //Aqui incluir lógica para proponente matriculado
          $datosMatriculado = retornarExpedienteMercantil($retorno["matricula"]);
          foreach ($datosMatriculado["inscripciones"] as $reg) {
          if ($reg["acto"] == '0040') {
          $retorno["enfirme"]["idtipodocperjur"] = $reg["tdoc"];
          $retorno["enfirme"]["numdocperjur"] = $reg["ndoc"];
          $retorno["enfirme"]["fecdocperjur"] = $reg["fdoc"];
          $retorno["enfirme"]["origendocperjur"] = $reg["txoridoc"];
          $retorno["enfirme"]["fechaconstitucion"] = $datosMatriculado["fechaconstitucion"];
          $retorno["enfirme"]["fechavencimiento"] = $datosMatriculado["fechavencimiento"];
          }
          }
          $retorno["enfirme"]["facultades"] = $retorno["facultades"];
          $retorno["enfirme"]["representanteslegales"] = $retorno["representanteslegales"];
          }
         */

        // En caso que la última inscripción no esté en firme
        if ($arrTemMer === false && $estadoultimainscripcion != '04') {
            unset($retorno["enfirme"]["tamanoempresa"]);
            unset($retorno["enfirme"]["idtipodocperjur"]);
            unset($retorno["enfirme"]["numdocperjur"]);
            unset($retorno["enfirme"]["fecdocperjur"]);
            unset($retorno["enfirme"]["origendocperjur"]);
            unset($retorno["enfirme"]["fechaconstitucion"]);
            unset($retorno["enfirme"]["fechavencimiento"]);
            unset($retorno["enfirme"]["facultades"]);
            unset($retorno["enfirme"]["representanteslegales"]);
        }
        if ($estadoultimainscripcion != '' && $estadoultimainscripcion != '04') {
            unset($retorno["enfirme"]["sitcontrol"]);
            unset($retorno["enfirme"]["exp1510"]);
            unset($retorno["enfirme"]["inffin1510_fechacorte"]);
            unset($retorno["enfirme"]["inffin1510_actcte"]);
            unset($retorno["enfirme"]["inffin1510_actnocte"]);
            unset($retorno["enfirme"]["inffin1510_fijnet"]);
            unset($retorno["enfirme"]["inffin1510_actotr"]);
            unset($retorno["enfirme"]["inffin1510_actval"]);
            unset($retorno["enfirme"]["inffin1510_acttot"]);
            unset($retorno["enfirme"]["inffin1510_pascte"]);
            unset($retorno["enfirme"]["inffin1510_paslar"]);
            unset($retorno["enfirme"]["inffin1510_pastot"]);
            unset($retorno["enfirme"]["inffin1510_patnet"]);
            unset($retorno["enfirme"]["inffin1510_paspat"]);
            unset($retorno["enfirme"]["inffin1510_balsoc"]);
            unset($retorno["enfirme"]["inffin1510_ingope"]);
            unset($retorno["enfirme"]["inffin1510_ingnoope"]);
            unset($retorno["enfirme"]["inffin1510_gasope"]);
            unset($retorno["enfirme"]["inffin1510_gasnoope"]);
            unset($retorno["enfirme"]["inffin1510_cosven"]);
            unset($retorno["enfirme"]["inffin1510_utinet"]);
            unset($retorno["enfirme"]["inffin1510_utiope"]);
            unset($retorno["enfirme"]["inffin1510_gasint"]);
            unset($retorno["enfirme"]["inffin1510_gasimp"]);
            unset($retorno["enfirme"]["inffin1510_indliq"]);
            unset($retorno["enfirme"]["inffin1510_nivend"]);
            unset($retorno["enfirme"]["inffin1510_razcob"]);
            unset($retorno["enfirme"]["inffin1510_renpat"]);
            unset($retorno["enfirme"]["inffin1510_renact"]);
            unset($retorno["enfirme"]["inffin1510_gruponiif"]);
            unset($retorno["enfirme"]["representanteslegales"]);
        }

        // ************************************************************************* //
        // Si el estado del ultimo acto es diferente a en firme (04)
        // Busca las inscripciones que no estan en firme
        // Si el expediente se recupera para una actualización especial solamente
        // recupera la información que está en firme
        // ************************************************************************* //
        if ($tipotramite != 'actualizacionespecial' && $arrTem) {
            if ($estadoultimoacto != '04') {
                $inscnofirme = 0;
                // Busca inscripciones que no estén en firme 
                // Para actualizar la información del proponente
                // Solo tiene en cuenta:
                // - Datos de constitución - si no es comerciante
                // - Facultades - si no es comerciante
                // - Representantes Legales - Si no es comerciante
                // - Financiera
                // - Experiencia - Solo los contratos que hubieren cambiado
                // - Situaciones de control
                $arrTemInsc = retornarRegistrosMysqli2($mysqli, 'mreg_est_inscripciones_proponentes', "proponente='" . $arrTem["proponente"] . "' and fecharegistro >= '20160101'", "fecharegistro,horaregistro");
                if ($arrTemInsc && !empty($arrTemInsc)) {
                    foreach ($arrTemInsc as $insc) {
                        if (trim($insc["acto"]) == '01' && ($insc["estado"] == '00' || $insc["estado"] == '01')) {
                            $inscnofirme++;
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["datosmodificados"] = 'si';
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["libro"] = $insc["libro"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["registro"] = $insc["registro"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["fecharegistro"] = $insc["fecharegistro"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["fecpublicacionrue"] = $insc["fecpublicacionrue"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["acto"] = $insc["acto"];
                            $arrXml = \funcionesSii2_desserializaciones::desserializarExpedienteProponente($dbx, $insc["xml"]);
                            if ($arrTemMer === false) {
                                $retorno["idtipodocperjur"] = $arrXml["idtipodocperjur"];
                                $retorno["numdocperjur"] = $arrXml["numdocperjur"];
                                $retorno["fecdocperjur"] = $arrXml["fecdocperjur"];
                                $retorno["origendocperjur"] = $arrXml["origendocperjur"];
                                $retorno["fechaconstitucion"] = $arrXml["fechaconstitucion"];
                                $retorno["fechavencimiento"] = $arrXml["fechavencimiento"];
                                $retorno["facultades"] = $arrXml["facultades"];
                                $retorno["representanteslegales"] = $arrXml["representanteslegales"];

                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["idtipodocperjur"] = $arrXml["idtipodocperjur"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["numdocperjur"] = $arrXml["numdocperjur"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["fecdocperjur"] = $arrXml["fecdocperjur"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["origendocperjur"] = $arrXml["origendocperjur"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["fechaconstitucion"] = $arrXml["fechaconstitucion"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["fechavencimiento"] = $arrXml["fechavencimiento"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["facultades"] = $arrXml["facultades"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["representanteslegales"] = $arrXml["representanteslegales"];
                            }

                            $retorno["tamanoempresa"] = $arrXml["tamanoempresa"];
                            $retorno["sitcontrol"] = $arrXml["sitcontrol"];
                            $retorno["exp1510"] = $arrXml["exp1510"];
                            $retorno["inffin1510_fechacorte"] = $arrXml["inffin1510_fechacorte"];
                            $retorno["inffin1510_actcte"] = $arrXml["inffin1510_actcte"];
                            $retorno["inffin1510_actnocte"] = $arrXml["inffin1510_actnocte"];
                            $retorno["inffin1510_fijnet"] = $arrXml["inffin1510_fijnet"];
                            $retorno["inffin1510_actotr"] = $arrXml["inffin1510_actotr"];
                            $retorno["inffin1510_actval"] = $arrXml["inffin1510_actval"];
                            $retorno["inffin1510_acttot"] = $arrXml["inffin1510_acttot"];
                            $retorno["inffin1510_pascte"] = $arrXml["inffin1510_pascte"];
                            $retorno["inffin1510_paslar"] = $arrXml["inffin1510_paslar"];
                            $retorno["inffin1510_pastot"] = $arrXml["inffin1510_pastot"];
                            $retorno["inffin1510_patnet"] = $arrXml["inffin1510_patnet"];
                            $retorno["inffin1510_paspat"] = $arrXml["inffin1510_paspat"];
                            $retorno["inffin1510_balsoc"] = $arrXml["inffin1510_balsoc"];
                            $retorno["inffin1510_ingope"] = $arrXml["inffin1510_ingope"];
                            $retorno["inffin1510_ingnoope"] = $arrXml["inffin1510_ingnoope"];
                            $retorno["inffin1510_gasope"] = $arrXml["inffin1510_gasope"];
                            $retorno["inffin1510_gasnoope"] = $arrXml["inffin1510_gasnoope"];
                            $retorno["inffin1510_cosven"] = $arrXml["inffin1510_cosven"];
                            $retorno["inffin1510_utinet"] = $arrXml["inffin1510_utinet"];
                            $retorno["inffin1510_utiope"] = $arrXml["inffin1510_utiope"];
                            $retorno["inffin1510_gasint"] = $arrXml["inffin1510_gasint"];
                            $retorno["inffin1510_gasimp"] = $arrXml["inffin1510_gasimp"];
                            $retorno["inffin1510_indliq"] = $arrXml["inffin1510_indliq"];
                            $retorno["inffin1510_nivend"] = $arrXml["inffin1510_nivend"];
                            $retorno["inffin1510_razcob"] = $arrXml["inffin1510_razcob"];
                            $retorno["inffin1510_renpat"] = $arrXml["inffin1510_renpat"];
                            $retorno["inffin1510_renact"] = $arrXml["inffin1510_renact"];

                            // 2017-04-17: JINT: COn  el animo de mitigar el problema de los decimales en el certificado
                            if (doubleval($retorno["inffin1510_patnet"]) != 0) {
                                $retorno["inffin1510_renpat"] = $retorno["inffin1510_utiope"] / $retorno["inffin1510_patnet"];
                            }

                            if (doubleval($retorno["inffin1510_acttot"]) != 0) {
                                $retorno["inffin1510_renact"] = $retorno["inffin1510_utiope"] / $retorno["inffin1510_acttot"];
                            }


                            $retorno["inffin1510_actnocte"] = $retorno["inffin1510_actnocte"] +
                                    $retorno["inffin1510_fijnet"] +
                                    $retorno["inffin1510_actotr"] +
                                    $retorno["inffin1510_actval"];

                            $retorno["inffin1510_gruponiif"] = $arrXml["inffin1510_gruponiif"];


                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["tamanoempresa"] = $arrXml["tamanoempresa"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["sitcontrol"] = $arrXml["sitcontrol"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["exp1510"] = $arrXml["exp1510"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_fechacorte"] = $arrXml["inffin1510_fechacorte"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actcte"] = $arrXml["inffin1510_actcte"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actnocte"] = $arrXml["inffin1510_actnocte"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_fijnet"] = $arrXml["inffin1510_fijnet"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actotr"] = $arrXml["inffin1510_actotr"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actval"] = $arrXml["inffin1510_actval"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_acttot"] = $arrXml["inffin1510_acttot"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_pascte"] = $arrXml["inffin1510_pascte"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_paslar"] = $arrXml["inffin1510_paslar"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_pastot"] = $arrXml["inffin1510_pastot"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_patnet"] = $arrXml["inffin1510_patnet"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_paspat"] = $arrXml["inffin1510_paspat"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_balsoc"] = $arrXml["inffin1510_balsoc"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_ingope"] = $arrXml["inffin1510_ingope"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_ingnoope"] = $arrXml["inffin1510_ingnoope"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_gasope"] = $arrXml["inffin1510_gasope"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_gasnoope"] = $arrXml["inffin1510_gasnoope"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_cosven"] = $arrXml["inffin1510_cosven"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_utinet"] = $arrXml["inffin1510_utinet"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_utiope"] = $arrXml["inffin1510_utiope"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_gasint"] = $arrXml["inffin1510_gasint"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_gasimp"] = $arrXml["inffin1510_gasimp"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_indliq"] = $arrXml["inffin1510_indliq"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_nivend"] = $arrXml["inffin1510_nivend"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_razcob"] = $arrXml["inffin1510_razcob"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_renpat"] = $arrXml["inffin1510_renpat"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_renact"] = $arrXml["inffin1510_renact"];

                            // 2017-04-17: JINT: COn  el animo de mitigar el problema de los decimales en el certificado
                            if (doubleval($retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_patnet"]) != 0) {
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_renpat"] = $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_utiope"] / $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_patnet"];
                            }

                            if (doubleval($retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_acttot"]) != 0) {
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_renact"] = $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_utiope"] / $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_acttot"];
                            }


                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actnocte"] = $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actnocte"] +
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_fijnet"] +
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actotr"] +
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actval"];

                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_gruponiif"] = $arrXml["inffin1510_gruponiif"];
                        }

                        if ((trim($insc["acto"]) == '02' || trim($insc["acto"]) == '03') && ($insc["estado"] == '00' || $insc["estado"] == '01')) {
                            $inscnofirme++;
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["datosmodificados"] = 'no';
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["libro"] = $insc["libro"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["registro"] = $insc["registro"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["fecharegistro"] = $insc["fecharegistro"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["fecpublicacionrue"] = $insc["fecpublicacionrue"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["acto"] = $insc["acto"];
                            $arrXml = \funcionesSii2_desserializaciones::desserializarExpedienteProponente($dbx, $insc["xml"]);
                            if ($arrTemMer === false) {
                                if (isset($arrXml["gruposmodificados"]["perjur"])) {
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["datosmodificados"] = 'si';
                                    $retorno["idtipodocperjur"] = $arrXml["idtipodocperjur"];
                                    $retorno["numdocperjur"] = $arrXml["numdocperjur"];
                                    $retorno["fecdocperjur"] = $arrXml["fecdocperjur"];
                                    $retorno["origendocperjur"] = $arrXml["origendocperjur"];
                                    $retorno["fechaconstitucion"] = $arrXml["fechaconstitucion"];
                                    $retorno["fechavencimiento"] = $arrXml["fechavencimiento"];

                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["idtipodocperjur"] = $arrXml["idtipodocperjur"];
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["numdocperjur"] = $arrXml["numdocperjur"];
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["fecdocperjur"] = $arrXml["fecdocperjur"];
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["origendocperjur"] = $arrXml["origendocperjur"];
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["fechaconstitucion"] = $arrXml["fechaconstitucion"];
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["fechavencimiento"] = $arrXml["fechavencimiento"];
                                }
                                if (isset($arrXml["gruposmodificados"]["facultades"])) {
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["datosmodificados"] = 'si';
                                    $retorno["facultades"] = $arrXml["facultades"];
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["facultades"] = $arrXml["facultades"];
                                }
                                if (isset($arrXml["gruposmodificados"]["repleg"])) {
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["datosmodificados"] = 'si';
                                    $retorno["representanteslegales"] = $arrXml["representanteslegales"];
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["representanteslegales"] = $arrXml["representanteslegales"];
                                }
                            }
                            if (isset($arrXml["gruposmodificados"]["datosbasicos"])) {
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["datosmodificados"] = 'si';
                                $retorno["tamanoempresa"] = $arrXml["tamanoempresa"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["tamanoempresa"] = $arrXml["tamanoempresa"];
                            }

                            if (isset($arrXml["gruposmodificados"]["sitcontrol"])) {
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["datosmodificados"] = 'si';
                                $retorno["sitcontrol"] = $arrXml["sitcontrol"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["sitcontrol"] = $arrXml["sitcontrol"];
                            }
                            if (isset($arrXml["gruposmodificados"]["inffin1510"])) {
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["datosmodificados"] = 'si';
                                $retorno["inffin1510_fechacorte"] = $arrXml["inffin1510_fechacorte"];
                                $retorno["inffin1510_actcte"] = $arrXml["inffin1510_actcte"];
                                $retorno["inffin1510_actnocte"] = $arrXml["inffin1510_actnocte"];
                                $retorno["inffin1510_fijnet"] = $arrXml["inffin1510_fijnet"];
                                $retorno["inffin1510_actotr"] = $arrXml["inffin1510_actotr"];
                                $retorno["inffin1510_actval"] = $arrXml["inffin1510_actval"];
                                $retorno["inffin1510_acttot"] = $arrXml["inffin1510_acttot"];
                                $retorno["inffin1510_pascte"] = $arrXml["inffin1510_pascte"];
                                $retorno["inffin1510_paslar"] = $arrXml["inffin1510_paslar"];
                                $retorno["inffin1510_pastot"] = $arrXml["inffin1510_pastot"];
                                $retorno["inffin1510_patnet"] = $arrXml["inffin1510_patnet"];
                                $retorno["inffin1510_paspat"] = $arrXml["inffin1510_paspat"];
                                $retorno["inffin1510_balsoc"] = $arrXml["inffin1510_balsoc"];
                                $retorno["inffin1510_ingope"] = $arrXml["inffin1510_ingope"];
                                $retorno["inffin1510_ingnoope"] = $arrXml["inffin1510_ingnoope"];
                                $retorno["inffin1510_gasope"] = $arrXml["inffin1510_gasope"];
                                $retorno["inffin1510_gasnoope"] = $arrXml["inffin1510_gasnoope"];
                                $retorno["inffin1510_cosven"] = $arrXml["inffin1510_cosven"];
                                $retorno["inffin1510_utinet"] = $arrXml["inffin1510_utinet"];
                                $retorno["inffin1510_utiope"] = $arrXml["inffin1510_utiope"];
                                $retorno["inffin1510_gasint"] = $arrXml["inffin1510_gasint"];
                                $retorno["inffin1510_gasimp"] = $arrXml["inffin1510_gasimp"];
                                $retorno["inffin1510_indliq"] = $arrXml["inffin1510_indliq"];
                                $retorno["inffin1510_nivend"] = $arrXml["inffin1510_nivend"];
                                $retorno["inffin1510_razcob"] = $arrXml["inffin1510_razcob"];
                                $retorno["inffin1510_renpat"] = $arrXml["inffin1510_renpat"];
                                $retorno["inffin1510_renact"] = $arrXml["inffin1510_renact"];

                                // 2017-04-17: JINT: COn  el animo de mitigar el problema de los decimales en el certificado
                                /*
                                  if (doubleval($retorno["inffin1510_patnet"]) != 0) {
                                  $retorno["inffin1510_renpat"] = $retorno["inffin1510_utiope"] / $retorno["inffin1510_patnet"];
                                  }
                                 */

                                /*
                                  if (doubleval($retorno["inffin1510_acttot"]) != 0) {
                                  $retorno["inffin1510_renact"] = $retorno["inffin1510_utiope"] / $retorno["inffin1510_acttot"];
                                  }
                                 */

                                $retorno["inffin1510_actnocte"] = $retorno["inffin1510_actnocte"] +
                                        $retorno["inffin1510_fijnet"] +
                                        $retorno["inffin1510_actotr"] +
                                        $retorno["inffin1510_actval"];

                                $retorno["inffin1510_gruponiif"] = $arrXml["inffin1510_gruponiif"];

                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_fechacorte"] = $arrXml["inffin1510_fechacorte"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actcte"] = $arrXml["inffin1510_actcte"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actnocte"] = $arrXml["inffin1510_actnocte"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_fijnet"] = $arrXml["inffin1510_fijnet"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actotr"] = $arrXml["inffin1510_actotr"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actval"] = $arrXml["inffin1510_actval"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_acttot"] = $arrXml["inffin1510_acttot"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_pascte"] = $arrXml["inffin1510_pascte"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_paslar"] = $arrXml["inffin1510_paslar"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_pastot"] = $arrXml["inffin1510_pastot"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_patnet"] = $arrXml["inffin1510_patnet"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_paspat"] = $arrXml["inffin1510_paspat"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_balsoc"] = $arrXml["inffin1510_balsoc"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_ingope"] = $arrXml["inffin1510_ingope"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_ingnoope"] = $arrXml["inffin1510_ingnoope"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_gasope"] = $arrXml["inffin1510_gasope"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_gasnoope"] = $arrXml["inffin1510_gasnoope"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_cosven"] = $arrXml["inffin1510_cosven"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_utinet"] = $arrXml["inffin1510_utinet"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_utiope"] = $arrXml["inffin1510_utiope"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_gasint"] = $arrXml["inffin1510_gasint"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_gasimp"] = $arrXml["inffin1510_gasimp"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_indliq"] = $arrXml["inffin1510_indliq"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_nivend"] = $arrXml["inffin1510_nivend"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_razcob"] = $arrXml["inffin1510_razcob"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_renpat"] = $arrXml["inffin1510_renpat"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_renact"] = $arrXml["inffin1510_renact"];

                                // 2017-04-17: JINT: COn  el animo de mitigar el problema de los decimales en el certificado
                                if (doubleval($retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_patnet"]) != 0) {
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_renpat"] = $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_utiope"] / $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_patnet"];
                                }

                                if (doubleval($retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_acttot"]) != 0) {
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_renact"] = $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_utiope"] / $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_acttot"];
                                }

                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actnocte"] = $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actnocte"] +
                                        $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_fijnet"] +
                                        $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actotr"] +
                                        $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actval"];

                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_gruponiif"] = $arrXml["inffin1510_gruponiif"];
                            }

                            if (isset($arrXml["gruposmodificados"]["exp1510"])) {
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["datosmodificados"] = 'si';
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["exp1510"] = array();
                            }
                            $iExp = 0;
                            foreach ($arrXml["gruposmodificados"] as $exp) {
                                if (substr($exp, 0, 8) == 'exp1510-') {
                                    $subs = substr($exp, 8);
                                    if (strlen($subs) == 5) {
                                        $ind = (substr($exp, 8, 3));
                                        $mod = (substr($exp, 12, 1));
                                    }
                                    if (strlen($subs) == 6) {
                                        $ind = (substr($exp, 8, 4));
                                        $mod = (substr($exp, 13, 1));
                                    }
                                    if ($mod == 'S') {
                                        foreach ($arrXml["exp1510"] as $key => $rep) {
                                            if ($rep["secuencia"] == $ind) {
                                                $iExp++;
                                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["exp1510"][$iExp] = $rep;
                                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["exp1510"][$iExp]["soportedeclaracion"] = '';
                                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["exp1510"][$iExp]["soportecontrato"] = '';
                                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["exp1510"][$iExp]["generardeclaracion"] = '';
                                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["exp1510"][$iExp]["revisado"] = '';



                                                //
                                                $encontro = 'no';
                                                $ultexp = 0;
                                                foreach ($retorno["exp1510"] as $key => $repx) {
                                                    if ($repx["secuencia"] == $ind) {
                                                        $retorno["exp1510"][$key] = $rep;
                                                        $retorno["exp1510"][$key]["soportedeclaracion"] = '';
                                                        $retorno["exp1510"][$key]["soportecontrato"] = '';
                                                        $retorno["exp1510"][$key]["generardeclaracion"] = '';
                                                        $retorno["exp1510"][$key]["revisado"] = '';
                                                        $encontro = 'si';
                                                    }
                                                    // $ultexp = $key;
                                                }
                                                if ($encontro == 'no') {
                                                    $ultexp = count($retorno["exp1510"]) + 1;
                                                    // $ultexp++;
                                                    $retorno["exp1510"][$ultexp] = $rep;
                                                    $retorno["exp1510"][$ultexp]["soportedeclaracion"] = '';
                                                    $retorno["exp1510"][$ultexp]["soportecontrato"] = '';
                                                    $retorno["exp1510"][$ultexp]["generardeclaracion"] = '';
                                                    $retorno["exp1510"][$ultexp]["revisado"] = '';
                                                }
                                            }
                                        }
                                    }
                                    if ($mod == 'E') {
                                        $cnt = 0;
                                        foreach ($retorno["exp1510"] as $key => $rep) {
                                            if ($rep["secuencia"] == $ind) {
                                                $cnt = $key;
                                            }
                                        }
                                        if ($cnt != 0) {
                                            unset($retorno["exp1510"][$cnt]);
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }

        // ***************************************************************************** //
        // ARMA CONTRATOS MULTAS Y SANCIONES
        // ***************************************************************************** //
        // Busca contratos
        if ($retornarRee == 'si') {
            $i = 0;
            if ($arrTem) {
                $arrTemCer = retornarRegistrosMysqli2($mysqli, 'mreg_est_proponentes_contratos', "proponente='" . $arrTem["proponente"] . "'", "secuencia");
                foreach ($arrTemCer as $c) {
                    if ($c["estadocont"] != '9') {
                        $i++;
                        $retorno["contratos"][$i]["codcamara"] = $c["codcamara"];
                        $retorno["contratos"][$i]["numradic"] = $c["numradic"];
                        $retorno["contratos"][$i]["fecradic"] = $c["fecradic"];
                        $retorno["contratos"][$i]["horradic"] = $c["horradic"];
                        $retorno["contratos"][$i]["fecreporte"] = $c["fecreporte"];
                        $retorno["contratos"][$i]["nitentidad"] = $c["nitentidad"];
                        $retorno["contratos"][$i]["nombreentidad"] = \funcionesSii2::restaurarEspeciales($c["nombreentidad"]);
                        $retorno["contratos"][$i]["idmunientidad"] = $c["idmunientidad"];
                        $retorno["contratos"][$i]["divarea"] = \funcionesSii2::restaurarEspeciales($c["divarea"]);
                        $retorno["contratos"][$i]["idefun"] = $c["idefun"];
                        $retorno["contratos"][$i]["nomfun"] = \funcionesSii2::restaurarEspeciales($c["nomfun"]);
                        $retorno["contratos"][$i]["carfun"] = \funcionesSii2::restaurarEspeciales($c["carfun"]);
                        $retorno["contratos"][$i]["numcontrato"] = $c["numcontrato"];
                        $retorno["contratos"][$i]["numcontratosecop"] = $c["numcontratosecop"];
                        $retorno["contratos"][$i]["fechaadj"] = $c["fechaadj"];
                        $retorno["contratos"][$i]["fechaper"] = $c["fechaper"];
                        $retorno["contratos"][$i]["fechaini"] = $c["fechaini"];
                        $retorno["contratos"][$i]["fechater"] = $c["fechater"];
                        $retorno["contratos"][$i]["fechaeje"] = $c["fechaeje"];
                        $retorno["contratos"][$i]["fechaliq"] = $c["fechaliq"];
                        $retorno["contratos"][$i]["codigoact"] = $c["codigoact"];
                        $retorno["contratos"][$i]["ciiu1"] = $c["ciiu1"];
                        $retorno["contratos"][$i]["ciiu2"] = $c["ciiu2"];
                        $retorno["contratos"][$i]["ciiu3"] = $c["ciiu3"];
                        $retorno["contratos"][$i]["ciiu4"] = $c["ciiu4"];
                        $retorno["contratos"][$i]["tipocont"] = $c["tipocont"];
                        $retorno["contratos"][$i]["valorcont"] = $c["valorcont"];
                        $retorno["contratos"][$i]["valorcontpag"] = $c["valorcontpag"];
                        $retorno["contratos"][$i]["indcump"] = $c["indcump"];
                        $retorno["contratos"][$i]["estadocont"] = $c["estadocont"];
                        $retorno["contratos"][$i]["contratorelacionadoconstruccion"] = $c["contratorelacionadoconstruccion"];
                        $retorno["contratos"][$i]["motivoter"] = \funcionesSii2::restaurarEspeciales($c["motivoter"]);
                        $retorno["contratos"][$i]["fechaterant"] = $c["fechaterant"];
                        $retorno["contratos"][$i]["motivoces"] = \funcionesSii2::restaurarEspeciales($c["motivoces"]);
                        $retorno["contratos"][$i]["fechaces"] = $c["fechaces"];
                        $retorno["contratos"][$i]["observaciones"] = \funcionesSii2::restaurarEspeciales($c["observaciones"]);
                        $retorno["contratos"][$i]["numlibro"] = $c["numlibro"];
                        $retorno["contratos"][$i]["numreglib"] = $c["numreglib"];
                        $retorno["contratos"][$i]["fecreglib"] = $c["fecreglib"];
                        $retorno["contratos"][$i]["clasificaciones"] = array();
                        $retorno["contratos"][$i]["unspsc"] = array();
                        if (trim($c["clasificaciones"]) != '') {
                            $iCla = 0;
                            $arrx = explode(",", $c["clasificaciones"]);
                            foreach ($arrx as $x) {
                                $iCla++;
                                $retorno["contratos"][$i]["clasificaciones"][$iCla] = $x;
                            }
                        }
                        if (trim($c["unspsc"]) != '') {
                            $iCla = 0;
                            $arrx = explode(",", $c["unspsc"]);
                            foreach ($arrx as $x) {
                                $iCla++;
                                $retorno["contratos"][$i]["unspsc"][$iCla] = $x;
                            }
                        }
                        $retorno["contratos"][$i]["objeto"] = \funcionesSii2::restaurarEspeciales($c["objeto"]);
                        $retorno["contratos"][$i]["codigocamaraorigen"] = $c["codigocamaraorigen"];
                        $retorno["contratos"][$i]["numregistrocamaraorigen"] = $c["numregistrocamaraorigen"];
                        $retorno["contratos"][$i]["fecregistrocamaraorigen"] = $c["fecregistrocamaraorigen"];
                        $retorno["contratos"][$i]["indicadorenvio"] = '0';
                    }
                }

                // Busca multas
                $i = 0;
                $arrTemCer = retornarRegistrosMysqli2($mysqli, 'mreg_est_proponentes_multas', "proponente='" . $arrTem["proponente"] . "'", "secuencia");
                foreach ($arrTemCer as $c) {
                    $i++;
                    $retorno["multas"][$i]["codcamara"] = $c["codcamara"];
                    $retorno["multas"][$i]["numradic"] = $c["numradic"];
                    $retorno["multas"][$i]["fecradic"] = $c["fecradic"];
                    $retorno["multas"][$i]["horradic"] = $c["horradic"];
                    $retorno["multas"][$i]["fecreporte"] = $c["fecreporte"];
                    $retorno["multas"][$i]["nitentidad"] = $c["nitentidad"];
                    $retorno["multas"][$i]["nombreentidad"] = \funcionesSii2::restaurarEspeciales($c["nombreentidad"]);
                    $retorno["multas"][$i]["idmunientidad"] = $c["idmunientidad"];
                    $retorno["multas"][$i]["divarea"] = \funcionesSii2::restaurarEspeciales($c["divarea"]);
                    $retorno["multas"][$i]["idefun"] = $c["idefun"];
                    $retorno["multas"][$i]["nomfun"] = \funcionesSii2::restaurarEspeciales($c["nomfun"]);
                    $retorno["multas"][$i]["carfun"] = \funcionesSii2::restaurarEspeciales($c["carfun"]);
                    $retorno["multas"][$i]["numcontrato"] = $c["numcontrato"];
                    $retorno["multas"][$i]["numcontratosecop"] = $c["numcontratosecop"];
                    $retorno["multas"][$i]["numacto"] = $c["numacto"];
                    $retorno["multas"][$i]["fechaacto"] = $c["fechaacto"];
                    $retorno["multas"][$i]["fechaeje"] = $c["fechaeje"];
                    $retorno["multas"][$i]["valormult"] = $c["valormult"];
                    $retorno["multas"][$i]["valormultpag"] = $c["valormultpag"];
                    $retorno["multas"][$i]["numsus"] = $c["numsus"];
                    $retorno["multas"][$i]["fechasus"] = $c["fechasus"];
                    $retorno["multas"][$i]["numconf"] = $c["numconf"];
                    $retorno["multas"][$i]["fechaconf"] = $c["fechaconf"];
                    $retorno["multas"][$i]["estadomult"] = $c["estadomult"];
                    $retorno["multas"][$i]["numrev"] = $c["numrev"];
                    $retorno["multas"][$i]["fechanumrev"] = $c["fechanumrev"];
                    $retorno["multas"][$i]["numlibro"] = $c["numlibro"];
                    $retorno["multas"][$i]["numreglib"] = $c["numreglib"];
                    $retorno["multas"][$i]["fecreglib"] = $c["fecreglib"];
                    $retorno["multas"][$i]["codigocamaraorigen"] = $c["codigocamaraorigen"];
                    $retorno["multas"][$i]["numregistrocamaraorigen"] = $c["numregistrocamaraorigen"];
                    $retorno["multas"][$i]["fecregistrocamaraorigen"] = $c["fecregistrocamaraorigen"];
                    $retorno["multas"][$i]["indicadorenvio"] = '0';
                    $retorno["multas"][$i]["observaciones"] = '';
                }

                // Busca sanciones
                $i = 0;
                $arrTemCer = retornarRegistrosMysqli2($mysqli, 'mreg_est_proponentes_sanciones', "proponente='" . $arrTem["proponente"] . "'", "secuencia");
                foreach ($arrTemCer as $c) {
                    $i++;
                    $retorno["sanciones"][$i]["codcamara"] = $c["codcamara"];
                    $retorno["sanciones"][$i]["numradic"] = $c["numradic"];
                    $retorno["sanciones"][$i]["fecradic"] = $c["fecradic"];
                    $retorno["sanciones"][$i]["horradic"] = $c["horradic"];
                    $retorno["sanciones"][$i]["fecreporte"] = $c["fecreporte"];
                    $retorno["sanciones"][$i]["nitentidad"] = $c["nitentidad"];
                    $retorno["sanciones"][$i]["nombreentidad"] = \funcionesSii2::restaurarEspeciales($c["nombreentidad"]);
                    $retorno["sanciones"][$i]["idmunientidad"] = $c["idmunientidad"];
                    $retorno["sanciones"][$i]["divarea"] = \funcionesSii2::restaurarEspeciales($c["divarea"]);
                    $retorno["sanciones"][$i]["idefun"] = $c["idefun"];
                    $retorno["sanciones"][$i]["nomfun"] = \funcionesSii2::restaurarEspeciales($c["nomfun"]);
                    $retorno["sanciones"][$i]["carfun"] = \funcionesSii2::restaurarEspeciales($c["carfun"]);
                    $retorno["sanciones"][$i]["numcontrato"] = $c["numcontrato"];
                    $retorno["sanciones"][$i]["numcontratosecop"] = $c["numcontratosecop"];
                    $retorno["sanciones"][$i]["numacto"] = $c["numacto"];
                    $retorno["sanciones"][$i]["fechaacto"] = $c["fechaacto"];
                    $retorno["sanciones"][$i]["fechaeje"] = $c["fechaeje"];
                    $retorno["sanciones"][$i]["numsus"] = $c["numsus"];
                    $retorno["sanciones"][$i]["fechasus"] = $c["fechasus"];
                    $retorno["sanciones"][$i]["numconf"] = $c["numconf"];
                    $retorno["sanciones"][$i]["fechaconf"] = $c["fechaconf"];
                    $retorno["sanciones"][$i]["condinc"] = $c["condinc"];
                    $retorno["sanciones"][$i]["contratorelacionadoconstruccion"] = $c["contratorelacionadoconstruccion"];
                    $retorno["sanciones"][$i]["incumplimientoviviendainteressocial"] = $c["incumplimientoviviendainteressocial"];
                    $retorno["sanciones"][$i]["cumsanc"] = $c["cumsanc"];
                    $retorno["sanciones"][$i]["estadosanc"] = $c["estadosanc"];
                    $retorno["sanciones"][$i]["numrev"] = $c["numrev"];
                    $retorno["sanciones"][$i]["fechanumrev"] = $c["fechanumrev"];
                    $retorno["sanciones"][$i]["descripcion"] = \funcionesSii2::restaurarEspeciales($c["descripcion"]);
                    $retorno["sanciones"][$i]["fundamento"] = \funcionesSii2::restaurarEspeciales($c["fundamento"]);
                    $retorno["sanciones"][$i]["vigencia"] = $c["vigencia"];
                    $retorno["sanciones"][$i]["numlibro"] = $c["numlibro"];
                    $retorno["sanciones"][$i]["numreglib"] = $c["numreglib"];
                    $retorno["sanciones"][$i]["fecreglib"] = $c["fecreglib"];
                    $retorno["sanciones"][$i]["codigocamaraorigen"] = $c["codigocamaraorigen"];
                    $retorno["sanciones"][$i]["numregistrocamaraorigen"] = $c["numregistrocamaraorigen"];
                    $retorno["sanciones"][$i]["fecregistrocamaraorigen"] = $c["fecregistrocamaraorigen"];
                    $retorno["sanciones"][$i]["indicadorenvio"] = '0';
                    $retorno["sanciones"][$i]["observaciones"] = '';
                }

                // Busca sanciones disciplinarias
                $i = 0;
                $arrTemCer = retornarRegistrosMysqli2($mysqli, 'mreg_est_proponentes_sandis', "proponente='" . $arrTem["proponente"] . "'", "secuencia");
                foreach ($arrTemCer as $c) {
                    $i++;
                    $retorno["sandis"][$i]["codcamara"] = $c["codcamara"];
                    $retorno["sandis"][$i]["numradic"] = $c["numradic"];
                    $retorno["sandis"][$i]["fecradic"] = $c["fecradic"];
                    $retorno["sandis"][$i]["horradic"] = $c["horradic"];
                    $retorno["sandis"][$i]["fecreporte"] = $c["fecreporte"];
                    $retorno["sandis"][$i]["nitentidad"] = $c["nitentidad"];
                    $retorno["sandis"][$i]["nombreentidad"] = \funcionesSii2::restaurarEspeciales($c["nombreentidad"]);
                    $retorno["sandis"][$i]["idmunientidad"] = $c["idmunientidad"];
                    $retorno["sandis"][$i]["divarea"] = \funcionesSii2::restaurarEspeciales($c["divarea"]);
                    $retorno["sandis"][$i]["idefun"] = $c["idefun"];
                    $retorno["sandis"][$i]["nomfun"] = \funcionesSii2::restaurarEspeciales($c["nomfun"]);
                    $retorno["sandis"][$i]["carfun"] = \funcionesSii2::restaurarEspeciales($c["carfun"]);
                    $retorno["sandis"][$i]["numcontratosecop"] = $c["numcontratosecop"];
                    $retorno["sandis"][$i]["numacto"] = $c["numacto"];
                    $retorno["sandis"][$i]["fechaacto"] = $c["fechaacto"];
                    $retorno["sandis"][$i]["fechaeje"] = $c["fechaeje"];
                    $retorno["sandis"][$i]["numsus"] = $c["numsus"];
                    $retorno["sandis"][$i]["fechasus"] = $c["fechasus"];
                    $retorno["sandis"][$i]["numconf"] = $c["numconf"];
                    $retorno["sandis"][$i]["fechaconf"] = $c["fechaconf"];
                    $retorno["sandis"][$i]["condinc"] = $c["condinc"];
                    $retorno["sandis"][$i]["cumsanc"] = $c["cumsanc"];
                    $retorno["sandis"][$i]["estadosanc"] = $c["estadosanc"];
                    $retorno["sandis"][$i]["numrev"] = $c["numrev"];
                    $retorno["sandis"][$i]["fechanumrev"] = $c["fechanumrev"];
                    $retorno["sandis"][$i]["descripcion"] = \funcionesSii2::restaurarEspeciales($c["descripcion"]);
                    $retorno["sandis"][$i]["fundamento"] = \funcionesSii2::restaurarEspeciales($c["fundamento"]);
                    $retorno["sandis"][$i]["vigencia"] = $c["vigencia"];
                    $retorno["sandis"][$i]["numlibro"] = $c["numlibro"];
                    $retorno["sandis"][$i]["numreglib"] = $c["numreglib"];
                    $retorno["sandis"][$i]["fecreglib"] = $c["fecreglib"];
                    $retorno["sandis"][$i]["codigocamaraorigen"] = $c["codigocamaraorigen"];
                    $retorno["sandis"][$i]["numregistrocamaraorigen"] = $c["numregistrocamaraorigen"];
                    $retorno["sandis"][$i]["fecregistrocamaraorigen"] = $c["fecregistrocamaraorigen"];
                    $retorno["sandis"][$i]["indicadorenvio"] = '0';
                    $retorno["sandis"][$i]["observaciones"] = '';
                }
            }
        }


        // Busca inhabilidad por incumplimiento reiterado
        // arreglo
        // $retorno["inhabilidad"]["inhabilidad"] = 'no/si';
        // $retorno["inhabilidad"]["ano"] = 'Año para el cual se detrermina la inhabilidad';
        // $retorno["inhabilidad"]["multas"] = array de multas
        // $retorno["inhabilidad"]["sanciones"] = array de sanciones
        // $retorno["inhabilidad"]["sinindicador"] = array de sanciones sin indicador
        // $retorno["inhabilidad"]["texto"] = array - texto en líneas de 65 para sirep
        // $retorno["inhabilidad"]["textosii"] = array - [0][1][2][3][4]


        if ($retornarInhabilidad != 'no') {
            $retorno["inhabilidad"] = \funcionesSii2::validarInhabilidad($mysqli, $retorno["nit"], $retorno["proponente"], $retorno["nombre"], "CALCULO EN LINEA DE LA INHABILIDAD");
        }


        return $retorno;
    }

    //

    /**
     * 
     * @param type $dbx
     * @param type $mat
     * @param type $idclase
     * @param type $numid
     * @param type $namex
     * @param type $tipodata
     * @param type $tipoconsulta
     * @return boolean|int
     */
    public static function retornarExpedienteMercantilSii($dbx = null, $mat = '', $idclase = '', $numid = '', $namex = '', $tipodata = 'E', $tipoconsulta = 'T') {
        require_once ('LogSii2.class.php');
        require_once ('generales.php');
        require_once ('myErrorHandler_retornarExpedienteMercantil.php');
        set_error_handler('myErrorHandler_retornarExpedienteMercantil');

        $nameLog = 'retornarExpedienteMercantil_' . $mat;

        // ********************************************************************************** //
        // Instancia la BD si no existe
        // ********************************************************************************** //
        if ($dbx === null) {
            $mysqli = new mysqli(DB_HOST, DB_USUARIO, DB_PASSWORD, DB_NAME, DB_PORT);
            if (mysqli_connect_error()) {
                $_SESSION["generales"]["mensajerror"] = 'Error coenctando con la BD';
                return false;
            }
        } else {
            $mysqli = $dbx;
        }

        // ********************************************************************************** //
        // carga maestro de actos
        // ********************************************************************************** //
        $_SESSION["maestroactos"] = array();
        $temx = retornarRegistrosMysqli2($mysqli, "mreg_actos", "1=1", "idlibro,idacto");
        foreach ($temx as $x) {
            $ind = $x["idlibro"] . '-' . $x["idacto"];
            $_SESSION["maestroactos"][$ind] = $x;
        }
        unset($temx);

        // ********************************************************************************** //
        // carga maestro de vínculos
        // ********************************************************************************** //
        $_SESSION["maestrovinculos"] = array();
        $temx = retornarRegistrosMysqli2($mysqli, "mreg_codvinculos", "1=1", "id");
        foreach ($temx as $x) {
            $_SESSION["maestrovinculos"][$x["id"]] = $x;
        }
        unset($temx);

        // ********************************************************************************** //
        // carga maestro de clases de vínculos
        // ********************************************************************************** //
        $_SESSION["clasevinculo"] = array();
        $temx = retornarRegistrosMysqli2($mysqli, "mreg_clasevinculos", "1=1", "id");
        foreach ($temx as $x) {
            $_SESSION["clasevinculo"][$x["id"]] = $x["descripcion"];
        }
        unset($temx);

        // ************************************************************************************** //
        // Si el sistema registro es SII
        // ************************************************************************************** //
        // Configuracion del QUERY Inicial
        $query = '';
        if ($mat != '') {
            $query = "matricula='" . ltrim($mat, "0") . "'";
        }
        if ($idclase != '') {
            $query = "idclase='" . $idclase . "' and ";
            $query .= "numid='" . trim($numid) . "'";
            if ($tipoconsulta == 'A') {
                $query .= " and ctrestmatricula IN ('MA','IA','MI','II')";
            }
            if ($tipoconsulta == 'C') {
                $query .= " and ctrestmatricula NOT IN ('MA','IA','MI','II')";
            }
        }
        if ($numid != '') {
            $query .= "numid='" . ltrim($numid, "0") . "'";
            if ($tipoconsulta == 'A') {
                $query .= " and ctrestmatricula IN ('MA','IA','MI','II')";
            }
            if ($tipoconsulta == 'C') {
                $query .= " and ctrestmatricula NOT IN ('MA','IA','MI','II')";
            }
        }

        if ($namex != '') {
            $query = "razonsocial='" . $namex . "'";
        }


        // Lectura del registro principal
        $reg = retornarRegistroMysqli2($mysqli, 'mreg_est_inscritos', $query);
        if ($reg === false) {
            if ($dbx == null) {
                $mysqli->close();
            }
            $_SESSION["generales"]["mensajerror"] = '1.- Error leyendo la tabla mreg_est_inscritos';
            return false;
        }
        if (empty($reg)) {
            if ($dbx == null) {
                $mysqli->close();
            }
            $_SESSION["generales"]["mensajerror"] = '';
            return 0;
        }

        // Armado del arreglo de respuesta
        $retorno = array();
        $retorno["matricula"] = $reg["matricula"];
        $retorno["proponente"] = $reg["proponente"];
        $retorno["complementorazonsocial"] = '';
        if (isset($reg["complementorazonsocial"])) {
            $retorno["complementorazonsocial"] = stripslashes(\funcionesSii2::restaurarEspeciales($reg["complementorazonsocial"]));
        }
        $retorno["nombre"] = str_replace("¥", "Ñ", stripslashes(\funcionesSii2::restaurarEspeciales($reg["razonsocial"])));
        $retorno["nombre"] = \funcionesSii2::borrarPalabrasAutomaticas($retorno["nombre"], $retorno["complementorazonsocial"]);
        $retorno["nombre"] = trim($retorno["nombre"]);
        $retorno["nuevonombre"] = '';
        $retorno["ape1"] = str_replace("¥", "Ñ", stripslashes(\funcionesSii2::restaurarEspeciales($reg["apellido1"])));
        $retorno["ape2"] = str_replace("¥", "Ñ", stripslashes(\funcionesSii2::restaurarEspeciales($reg["apellido2"])));
        $retorno["nom1"] = str_replace("¥", "Ñ", stripslashes(\funcionesSii2::restaurarEspeciales($reg["nombre1"])));
        $retorno["nom2"] = str_replace("¥", "Ñ", stripslashes(\funcionesSii2::restaurarEspeciales($reg["nombre2"])));
        $retorno["sigla"] = str_replace("¥", "Ñ", stripslashes(\funcionesSii2::restaurarEspeciales($reg["sigla"])));
        $retorno["tipoidentificacion"] = $reg["idclase"];
        $retorno["identificacion"] = $reg["numid"];
        $retorno["idmunidoc"] = $reg["idmunidoc"];
        $retorno["fechanacimiento"] = $reg["fechanacimiento"];
        $retorno["fecexpdoc"] = $reg["fecexpdoc"];
        $retorno["paisexpdoc"] = $reg["paisexpdoc"];
        $retorno["nit"] = $reg["nit"];
        $retorno["estadonit"] = $reg["estadonit"];
        $retorno["admondian"] = $reg["admondian"];
        $retorno["prerut"] = $reg["prerut"];
        $retorno["nacionalidad"] = $reg["nacionalidad"];

        // 2017-05-31
        $retorno["idetripaiori"] = $reg["idetripaiori"]; // Nuevo campo circular 002
        $retorno["paiori"] = $reg["paiori"]; // Nuevo campo circular 002
        $retorno["idetriextep"] = $reg["idetriextep"]; // Nuevo campo circular 002


        $retorno["fechamatricula"] = trim($reg["fecmatricula"]);
        $retorno["fecharenovacion"] = trim($reg["fecrenovacion"]);
        $retorno["fechavencimiento"] = trim($reg["fecvigencia"]);
        $retorno["ultanoren"] = trim($reg["ultanoren"]);

        // 2019-07-09: JINT: Calculo de fechas de renovación y afiliación
        $histopagos = encontrarHistoricoPagosMysqliSii($mysqli, $reg["matricula"], array(), array());
        if ($histopagos["fecultren"] != '') {
            $retorno["fecharenovacion"] = $histopagos["fecultren"];
            $retorno["ultanoren"] = $histopagos["ultanoren"];
        }

        // Se encuentran al momento de armar la lista de inscripciones        
        $retorno["fechaconstitucion"] = $reg["fecconstitucion"];
        $retorno["fechadisolucion"] = $reg["fecdisolucion"];
        $retorno["fechacancelacion"] = $reg["feccancelacion"];
        $retorno["motivocancelacion"] = $reg["motivocancelacion"]; // Nuevo campo circular 002   
        $retorno["fechaliquidacion"] = $reg["fecliquidacion"];
        $retorno["disueltaporvencimiento"] = '';
        $retorno["disueltaporacto510"] = '';
        $retorno["fechaacto510"] = '';
        $retorno["perdidacalidadcomerciante"] = '';
        $retorno["fechaperdidacalidadcomerciante"] = '';
        $retorno["estadotipoliquidacion"] = $reg["estadotipoliquidacion"]; // Nuevo campo circular 002 
        $retorno["empresafamiliar"] = $reg["empresafamiliar"]; // Nuevo campo circular 002 
        $retorno["procesosinnovacion"] = $reg["procesosinnovacion"]; // Nuevo campo circular 002 
        // 
        if (trim($retorno["fechavencimiento"]) != '' &&
                $retorno["fechavencimiento"] != '99999999' && $retorno["fechavencimiento"] != '99999998'
        ) {
            if ($retorno["fechavencimiento"] < date("Ymd")) {
                $retorno["disueltaporvencimiento"] = 'si';
            }
        }

        //
        $retorno["certificardesde"] = $reg["ctrcertificardesde"];
        $retorno["estadomatricula"] = $reg["ctrestmatricula"];
        $retorno["estadoactiva"] = $reg["ctrestadoactiva"];
        $retorno["estadopreoperativa"] = $reg["ctrestadopreoperativa"];
        $retorno["estadoconcordato"] = $reg["ctrconcordato"];
        $retorno["estadointervenida"] = $reg["ctrestadointervenida"];
        $retorno["estadodisuelta"] = $reg["ctrestadodisuelta"];
        $retorno["estadoreestructuracion"] = $reg["ctrestadoenreestructuracion"];
        $retorno["estadodatosmatricula"] = $reg["ctrestdatos"];
        $retorno["estadoproponente"] = trim($reg["ctrestproponente"]);
        $retorno["estadocapturado"] = trim($reg["ctrestadocapturado"]);
        $retorno["estadocapturadootros"] = trim($reg["ctrestadocapturadootros"]);
        $retorno["cantest"] = intval($reg["cantest"]);

        //
        if (!isset($reg["pendiente_ajuste_nuevo_formato"])) {
            $reg["pendiente_ajuste_nuevo_formato"] = '';
        }
        if (!isset($reg["fecha_pendiente_ajuste_nuevo_formato"])) {
            $reg["fecha_pendiente_ajuste_nuevo_formato"] = '';
        }

        //
        $retorno["codigosbarras"] = 0; // Se arma al encontrar la lista de códigos de barras
        $retorno["pendiente_ajuste_nuevo_formato"] = $reg["pendiente_ajuste_nuevo_formato"];
        $retorno["fecha_pendiente_ajuste_nuevo_formato"] = $reg["fecha_pendiente_ajuste_nuevo_formato"];

        $retorno["embargos"] = ''; // Se arma al encontrar la lista de embargos
        $retorno["embargostramite"] = ''; // Se arma al encontrar la lista de embargos
        $retorno["recursostramite"] = ''; // Sea arma al encontrar la lista de códigos de barras
        $retorno["tamanoempresa"] = $reg["tamanoempresa"];
        $retorno["emprendedor28"] = $reg["emprendedor28"];
        $retorno["pemprendedor28"] = doubleval($reg["pemprendedor28"]);
        $retorno["organizacion"] = $reg["organizacion"];
        $retorno["organizaciontexto"] = retornarRegistroMysqli2($mysqli, 'bas_organizacionjuridica', "id='" . $reg["organizacion"] . "'", "descripcion");
        $retorno["categoria"] = $reg["categoria"];
        $retorno["categoriatexto"] = retornarRegistroMysqli2($mysqli, 'bas_categorias', "id='" . $reg["categoria"] . "'", "descripcion");
        $retorno["naturaleza"] = $reg["naturaleza"];
        if ($reg["naturaleza"] == '') {
            $retorno["naturaleza"] = '0';
        }
        $retorno["imppredil"] = '';
        $retorno["impexp"] = $reg["ctrimpexp"];
        $retorno["tipopropiedad"] = $reg["ctrtipopropiedad"];
        $retorno["tipolocal"] = $reg["ctrtipolocal"];
        $retorno["tipogruemp"] = $reg["tipogruemp"]; // Nuevo campo circular 002  
        $retorno["nombregruemp"] = $reg["nombregruemp"]; // Nuevo campo circular 002 
        //
        $retorno["vigcontrol"] = $reg["vigcontrol"];
        $retorno["fecperj"] = $reg["fecperj"];
        $retorno["idorigenperj"] = $reg["otorgaperj"];
        $retorno["origendocconst"] = $reg["origendocconst"];
        $retorno["numperj"] = $reg["numperj"];
        $retorno["patrimonio"] = $reg["patrimonio"];
        $retorno["vigifecini"] = $reg["vigifecini"];
        $retorno["vigifecfin"] = $reg["vigifecfin"];
        $retorno["clasegenesadl"] = $reg["ctrclasegenesadl"];
        $retorno["claseespesadl"] = $reg["ctrclaseespeesadl"];
        $retorno["claseeconsoli"] = $reg["ctrclaseeconsoli"];
        $retorno["econmixta"] = $reg["ctreconmixta"];

        $retorno["ctrderpub"] = $reg["ctrderpub"]; // Nuevo campo circular 002
        $retorno["ctrcodcoop"] = $reg["ctrcodcoop"]; // Nuevo campo circular 002
        $retorno["ctrcodotras"] = $reg["ctrcodotras"]; // Nuevo campo circular 002

        $retorno["ctresacntasociados"] = $reg["ctresacntasociados"]; // Nuevo campo circular 002  
        $retorno["ctresacntmujeres"] = $reg["ctresacntmujeres"]; // Nuevo campo circular 002  
        $retorno["ctresacnthombres"] = $reg["ctresacnthombres"]; // Nuevo campo circular 002  
        $retorno["ctresapertgremio"] = $reg["ctresapertgremio"]; // Nuevo campo circular 002  
        $retorno["ctresagremio"] = $reg["ctresagremio"]; // Nuevo campo circular 002  
        $retorno["ctresaacredita"] = $reg["ctresaacredita"]; // Nuevo campo circular 002  
        $retorno["ctresaivc"] = $reg["ctresaivc"]; // Nuevo campo circular 002
        $retorno["ctresainfoivc"] = $reg["ctresainfoivc"]; // Nuevo campo circular 002
        $retorno["ctresaautregistro"] = $reg["ctresaautregistro"]; // Nuevo campo circular 002  
        $retorno["ctresaentautoriza"] = $reg["ctresaentautoriza"];  // Nuevo campo circular 002  
        $retorno["ctresacodnat"] = $reg["ctresacodnat"]; // Nuevo campo circular 002     1.- Asoc, 2.- Corporacion, 3.- Fundación
        $retorno["ctresadiscap"] = $reg["ctresadiscap"]; // Nuevo campo circular 002     
        $retorno["ctresaetnia"] = $reg["ctresaetnia"]; // Nuevo campo circular 002     
        $retorno["ctresacualetnia"] = $reg["ctresacualetnia"];  // Nuevo campo circular 002     
        $retorno["ctresadespvictreins"] = $reg["ctresadespvictreins"];  // Nuevo campo circular 002     
        $retorno["ctresacualdespvictreins"] = $reg["ctresacualdespvictreins"]; // Nuevo campo circular 002     
        $retorno["ctresaindgest"] = $reg["ctresaindgest"];  // Nuevo campo circular 002            
        $retorno["ctresalgbti"] = $reg["ctresalgbti"]; // Nuevo campo circular 002            
        //
        $retorno["afiliado"] = $reg["ctrafiliacion"];
        $retorno["fechaafiliacion"] = $reg["fecaflia"];
        $retorno["ultanorenafi"] = $reg["anorenaflia"];
        $retorno["fechaultpagoafi"] = $reg["fecrenaflia"];
        $retorno["valorultpagoafi"] = $reg["valpagaflia"];
        $retorno["saldoafiliado"] = $reg["saldoaflia"];
        $retorno["telaflia"] = $reg["telaflia"];
        $retorno["diraflia"] = $reg["diraflia"];
        $retorno["munaflia"] = $reg["munaflia"];
        $retorno["profaflia"] = $reg["profaflia"];
        $retorno["contaflia"] = $reg["contaflia"];
        $retorno["dircontaflia"] = $reg["dircontaflia"];
        $retorno["muncontaflia"] = $reg["muncontaflia"];
        $retorno["numactaaflia"] = $reg["numactaaflia"];
        $retorno["fecactaaflia"] = $reg["fecactaaflia"];
        $retorno["numactaafliacan"] = $reg["numactacanaflia"];
        $retorno["fecactaafliacan"] = $reg["fecactacanaflia"];
        $retorno["fecexafiliacion"] = $reg["fecexafiliacion"];

        // informacion de ubicacion comercial en el registro mercantil
        $retorno["lggr"] = $reg["lggr"];
        $retorno["nombrecomercial"] = $reg["nombrecomercial"];
        $retorno["dircom"] = $reg["dircom"];
        $retorno["dircom_tipovia"] = '';
        $retorno["dircom_numvia"] = '';
        $retorno["dircom_apevia"] = '';
        $retorno["dircom_orivia"] = '';
        $retorno["dircom_numcruce"] = '';
        $retorno["dircom_apecruce"] = '';
        $retorno["dircom_oricruce"] = '';
        $retorno["dircom_numplaca"] = '';
        $retorno["dircom_complemento"] = '';
        $retorno["barriocom"] = $reg["barriocom"];
        $retorno["barriocomnombre"] = retornarRegistroMysqli2($mysqli, "mreg_barriosmuni", "idmunicipio='" . $reg["muncom"] . "' and idbarrio='" . $reg["barriocom"] . "'", "nombre");
        $retorno["muncom"] = $reg["muncom"];
        $retorno["paicom"] = $reg["paicom"]; // Nuevo 002
        $retorno["muncomnombre"] = retornarRegistroMysqli2($mysqli, "bas_municipios", "codigomunicipio='" . $reg["muncom"] . "'", "ciudad");
        $retorno["telcom1"] = $reg["telcom1"];
        $retorno["telcom2"] = $reg["telcom2"];
        $retorno["celcom"] = $reg["telcom3"];
        $retorno["telcomant1"] = '';
        $retorno["telcomant2"] = '';
        $retorno["telcomant3"] = '';
        $retorno["faxcom"] = $reg["faxcom"];
        $retorno["aacom"] = $reg["aacom"];
        $retorno["zonapostalcom"] = '';
        $retorno["emailcom"] = $reg["emailcom"];
        $retorno["emailcom2"] = $reg["emailcom2"];
        $retorno["emailcom3"] = $reg["emailcom3"];
        $retorno["emailcomant"] = '';
        $retorno["nombresegundocontacto"] = $reg["nomsegcon"];
        $retorno["cargosegundocontacto"] = $reg["carsegcon"];
        $retorno["urlcom"] = $reg["urlcom"];
        $retorno["numpredial"] = $reg["numpredial"];
        $retorno["codigopostalcom"] = $reg["codigopostalcom"]; // Nuevo campo circular 002
        $retorno["codigozonacom"] = $reg["codigozonacom"]; // Nuevo campo circular 002 - Urbao o rural
        // informacion de ubicacion de notificacion
        $retorno["dirnot"] = $reg["dirnot"];
        $retorno["dirnot_tipovia"] = '';
        $retorno["dirnot_numvia"] = '';
        $retorno["dirnot_apevia"] = '';
        $retorno["dirnot_orivia"] = '';
        $retorno["dirnot_numcruce"] = '';
        $retorno["dirnot_apecruce"] = '';
        $retorno["dirnot_oricruce"] = '';
        $retorno["dirnot_numplaca"] = '';
        $retorno["dirnot_complemento"] = '';
        $retorno["barrionot"] = $reg["barrionot"];
        $retorno["barrionotnombre"] = '';
        $retorno["munnot"] = $reg["munnot"];
        $retorno["painot"] = $reg["painot"]; // Nuevo 002
        $retorno["munnotnombre"] = retornarRegistroMysqli2($mysqli, "bas_municipios", "codigomunicipio='" . $reg["munnot"] . "'", "ciudad");
        $retorno["telnot"] = $reg["telnot"];
        $retorno["telnot2"] = $reg["telnot2"];
        $retorno["telnotant1"] = '';
        $retorno["telnotant2"] = '';
        $retorno["telnotant3"] = '';
        $retorno["celnot"] = $reg["telnot3"];
        $retorno["faxnot"] = $reg["faxnot"];
        $retorno["aanot"] = $reg["aanot"];
        $retorno["zonapostalnot"] = '';
        $retorno["emailnot"] = $reg["emailnot"];
        $retorno["emailnotant"] = '';
        $retorno["urlnot"] = $reg["urlnot"];
        $retorno["codigopostalnot"] = $reg["codigopostalnot"]; // Nuevo campo circular 002
        $retorno["codigozonanot"] = $reg["codigozonanot"]; // Nuevo campo circular 002 - Urbano o rural
        $retorno["tiposedeadm"] = $reg["tiposedeadm"]; // Nuevo campo circular 002 - 1,2,3,4
        //
        //2017-06-201: JINT: No utilizados
        $retorno["latitudgrados"] = "";
        $retorno["latitudminutos"] = "";
        $retorno["latitudsegundos"] = "";
        $retorno["latitudorientacion"] = "";
        $retorno["longitudgrados"] = "";
        $retorno["longitudminutos"] = "";
        $retorno["longitudsegundos"] = "";
        $retorno["longitudorientacion"] = "";

        // 2017-06-21: JINT - Se alimenta desde la tabla mreg_geolocalizacion
        $retorno["latitud"] = "";
        $retorno["longitud"] = "";
        $ax1 = retornarRegistrosMysqli2($mysqli, 'mreg_geolocalizacion', "matricula='" . $reg["matricula"] . "'", 'fecha asc, hora asc');
        if ($ax1 && !empty($ax1)) {
            foreach ($ax1 as $x1) {
                if ($x1["latitud"] != 'undefined' && $x1["longitud"] != 'undefined') {
                    $retorno["latitud"] = $x1["latitud"];
                    $retorno["longitud"] = $x1["longitud"];
                }
            }
        }
        unset($x1);
        unset($ax1);

        // Localiza emails y celulars anteriores
        // if ($tipodata == 'E') {
        if (trim($reg["matricula"]) != '') {
            $retorno["telcomant1"] = localizarCampoAnteriorSii2($mysqli, $reg["matricula"], 'telcom1');
            $retorno["telcomant2"] = localizarCampoAnteriorSii2($mysqli, $reg["matricula"], 'telcom2');
            $retorno["telcomant3"] = localizarCampoAnteriorSii2($mysqli, $reg["matricula"], 'celcom');
            $retorno["telnotant1"] = localizarCampoAnteriorSii2($mysqli, $reg["matricula"], 'telnot');
            $retorno["telnotant2"] = localizarCampoAnteriorSii2($mysqli, $reg["matricula"], 'telnot2');
            $retorno["telnotant3"] = localizarCampoAnteriorSii2($mysqli, $reg["matricula"], 'celnot');
            $retorno["emailcomant"] = localizarCampoAnteriorSii2($mysqli, $reg["matricula"], 'emailcom');
            $retorno["emailnotant"] = localizarCampoAnteriorSii2($mysqli, $reg["matricula"], 'emailnot');
        }
        // }
        // Datos de correspondencia
        $retorno["dircor"] = $reg["dircor"];
        $retorno["telcor"] = $reg["telcor"];
        $retorno["telcor2"] = $reg["telcor2"];
        $retorno["muncor"] = $reg["muncor"];

        // informacion ed actividad economica
        $retorno["ciius3"] = array();
        if (isset($reg["ciiu31"])) {
            $retorno["ciius3"][1] = $reg["ciiu31"];
            $retorno["ciius3"][2] = $reg["ciiu32"];
            $retorno["ciius3"][3] = $reg["ciiu33"];
            $retorno["ciius3"][4] = $reg["ciiu34"];
        }

        // informacion de actividad economica
        $retorno["ciius"] = array();
        $retorno["ciius"][1] = $reg["ciiu1"];
        $retorno["ciius"][2] = $reg["ciiu2"];
        $retorno["ciius"][3] = $reg["ciiu3"];
        $retorno["ciius"][4] = $reg["ciiu4"];
        $retorno["ciius"][5] = $reg["ciiu5"];

        // 2017-10-13: JINT: Para resolver problemas de letras incorrectas en el CIIU
        if (trim($retorno["ciius"][1]) != '') {
            $ciiux = retornarRegistroMysqli2($mysqli, 'bas_ciius', "idciiunum='" . substr($retorno["ciius"][1], 1) . "'");
            if ($ciiux && !empty($ciiux)) {
                $retorno["ciius"][1] = $ciiux["idciiu"];
            }
        }
        if (trim($retorno["ciius"][2]) != '') {
            $ciiux = retornarRegistroMysqli2($mysqli, 'bas_ciius', "idciiunum='" . substr($retorno["ciius"][2], 1) . "'");
            if ($ciiux && !empty($ciiux)) {
                $retorno["ciius"][2] = $ciiux["idciiu"];
            }
        }
        if (trim($retorno["ciius"][3]) != '') {
            $ciiux = retornarRegistroMysqli2($mysqli, 'bas_ciius', "idciiunum='" . substr($retorno["ciius"][3], 1) . "'");
            if ($ciiux && !empty($ciiux)) {
                $retorno["ciius"][3] = $ciiux["idciiu"];
            }
        }
        if (trim($retorno["ciius"][4]) != '') {
            $ciiux = retornarRegistroMysqli2($mysqli, 'bas_ciius', "idciiunum='" . substr($retorno["ciius"][4], 1) . "'");
            if ($ciiux && !empty($ciiux)) {
                $retorno["ciius"][4] = $ciiux["idciiu"];
            }
        }


        //
        $retorno["versionciiu"] = $reg["versionciiu"];
        $retorno["desactiv"] = stripslashes($reg["actividad"]); // Nuevo campo circular 002
        $retorno["feciniact1"] = $reg["feciniact1"]; // Nuevo campo circular 002
        $retorno["feciniact2"] = $reg["feciniact2"]; // Nuevo campo circular 002
        $retorno["codaduaneros"] = $reg["codaduaneros"]; // Nuevo campo circular 002
        $retorno["gruponiif"] = $reg["gruponiif"]; // Nuevo campo circular 002
        $retorno["niifconciliacion"] = $reg["niifconciliacion"]; // Nuevo campo circular 002
        $retorno["aportantesegsocial"] = $reg["aportantesegsocial"]; // Nuevo campo circular 002
        $retorno["tipoaportantesegsocial"] = $reg["tipoaportantesegsocial"]; // Nuevo campo circular 002
        $retorno["ingesperados"] = 0;
        if (isset($reg["ingesperados"])) {
            $retorno["ingesperados"] = $reg["ingesperados"];
        }
        if ($retorno["ingesperados"] == '') {
            $retorno["ingesperados"] = 0;
        }
        //
        // informacion de porcentajes de capital
        $retorno["cap_porcnaltot"] = $reg["pornaltot"];
        $retorno["cap_porcnalpri"] = $reg["pornalpri"];
        $retorno["cap_porcnalpub"] = $reg["pornalpub"];
        $retorno["cap_porcexttot"] = $reg["porexttot"];
        $retorno["cap_porcextpri"] = $reg["porextpri"];
        $retorno["cap_porcextpub"] = $reg["porextpub"];

        $retorno["cap_apolab"] = 0;
        $retorno["cap_apolabadi"] = 0;
        $retorno["cap_apoact"] = 0;
        $retorno["cap_apodin"] = 0;

        $retorno["capsoc"] = 0;
        $retorno["capaut"] = 0;
        $retorno["capsus"] = 0;
        $retorno["cappag"] = 0;
        $retorno["cuosoc"] = 0;
        $retorno["cuoaut"] = 0;
        $retorno["cuosus"] = 0;
        $retorno["cuopag"] = 0;
        $retorno["capsuc"] = 0;


        // información de Establecimientos de comercio asociados
        $retorno["cntestab01"] = $reg["cntest01"];
        $retorno["cntestab02"] = $reg["cntest02"];
        $retorno["cntestab03"] = $reg["cntest03"];
        $retorno["cntestab04"] = $reg["cntest04"];
        $retorno["cntestab05"] = $reg["cntest05"];
        $retorno["cntestab06"] = $reg["cntest06"];
        $retorno["cntestab07"] = $reg["cntest07"];
        $retorno["cntestab08"] = $reg["cntest08"];
        $retorno["cntestab09"] = $reg["cntest09"];
        $retorno["cntestab10"] = $reg["cntest10"];
        $retorno["cntestab11"] = $reg["cntest11"];

        // información de referencias comerciales y bancarias
        $retorno["refcrenom1"] = $reg["refcrenom1"];
        $retorno["refcreofi1"] = $reg["refcreofi1"];
        $retorno["refcretel1"] = $reg["refcretel1"];
        $retorno["refcrenom2"] = $reg["refcrenom2"];
        $retorno["refcreofi2"] = $reg["refcreofi2"];
        $retorno["refcretel2"] = $reg["refcretel2"];
        $retorno["refcomnom1"] = $reg["refcomnom1"];
        $retorno["refcomdir1"] = $reg["refcomdir1"];
        $retorno["refcomtel1"] = $reg["refcomtel1"];
        $retorno["refcomnom2"] = $reg["refcomnom2"];
        $retorno["refcomdir2"] = $reg["refcomdir2"];
        $retorno["refcomtel2"] = $reg["refcomtel2"];

        $retorno["anodatos"] = '';
        $retorno["fechadatos"] = '';
        $retorno["personal"] = 0;
        $retorno["personaltemp"] = 0;
        $retorno["actvin"] = 0;
        $retorno["valest"] = 0;
        $retorno["actcte"] = 0;
        $retorno["actnocte"] = 0;
        $retorno["actfij"] = 0;
        $retorno["fijnet"] = 0;
        $retorno["actotr"] = 0;
        $retorno["actval"] = 0;
        $retorno["acttot"] = 0;
        $retorno["actsinaju"] = 0;
        $retorno["invent"] = 0;
        $retorno["pascte"] = 0;
        $retorno["paslar"] = 0;
        $retorno["pastot"] = 0;
        $retorno["pattot"] = 0;
        $retorno["paspat"] = 0;
        $retorno["balsoc"] = 0;
        $retorno["ingope"] = 0;
        $retorno["ingnoope"] = 0;
        $retorno["gtoven"] = 0;
        $retorno["gtoadm"] = 0;
        $retorno["cosven"] = 0;
        $retorno["depamo"] = 0;
        $retorno["gasint"] = 0;
        $retorno["gasimp"] = 0;
        $retorno["utiope"] = 0;
        $retorno["utinet"] = 0;

        $retorno["apolab"] = $reg["apolab"];
        $retorno["apolabadi"] = $reg["apolabadi"];
        $retorno["apoact"] = $reg["apoact"];
        $retorno["apodin"] = $reg["apodin"];
        $retorno["apotra"] = $reg["apotra"];
        $retorno["apotot"] = $reg["apotot"];

        $retorno["anodatospatrimonio"] = '';
        $retorno["fechadatospatrimonio"] = '';
        $retorno["patrimonioesadl"] = 0;

        // información financiera
        $ax1 = retornarRegistrosMysqli2($mysqli, 'mreg_est_financiera', "matricula='" . $reg["matricula"] . "'", 'anodatos asc, fechadatos asc');
        if ($ax1 && !empty($ax1)) {
            foreach ($ax1 as $x1) {
                $retorno["anodatos"] = $x1["anodatos"];
                $retorno["fechadatos"] = $x1["fechadatos"];
                $retorno["personal"] = $x1["personal"];
                $retorno["personaltemp"] = $x1["pcttemp"];
                $retorno["patrimonio"] = $x1["patrimonio"];
                $retorno["actvin"] = $x1["actvin"];
                $retorno["valest"] = $x1["actvin"];
                $retorno["actcte"] = $x1["actcte"];
                $retorno["actnocte"] = $x1["actnocte"];
                $retorno["actfij"] = $x1["actfij"];
                $retorno["fijnet"] = $x1["fijnet"];
                $retorno["actotr"] = $x1["actotr"];
                $retorno["actval"] = $x1["actval"];
                $retorno["acttot"] = $x1["acttot"];
                $retorno["actsinaju"] = 0;
                $retorno["invent"] = 0;
                $retorno["pascte"] = $x1["pascte"];
                $retorno["paslar"] = $x1["paslar"];
                $retorno["pastot"] = $x1["pastot"];
                $retorno["pattot"] = $x1["patnet"];
                $retorno["paspat"] = $x1["paspat"];
                $retorno["balsoc"] = $x1["balsoc"];
                $retorno["ingope"] = $x1["ingope"];
                $retorno["ingnoope"] = $x1["ingnoope"];
                $retorno["gtoven"] = $x1["gtoven"];
                $retorno["gtoadm"] = $x1["gasadm"];
                $retorno["cosven"] = $x1["cosven"];
                $retorno["depamo"] = 0;
                $retorno["gasint"] = $x1["gasint"];
                $retorno["gasimp"] = $x1["gasimp"];
                $retorno["utiope"] = $x1["utiope"];
                $retorno["utinet"] = $x1["utinet"];
            }
            unset($x1);
            unset($ax1);
        }

        $ax1 = retornarRegistrosMysqli2($mysqli, 'mreg_est_patrimonios', "matricula='" . $reg["matricula"] . "'", 'anodatos asc, fechadatos asc');
        if ($ax1 && !empty($ax1)) {
            foreach ($ax1 as $x1) {
                $retorno["anodatospatrimonio"] = $x1["anodatos"];
                $retorno["fechadatospatrimonio"] = $x1["fechadatos"];
                $retorno["patrimonioesadl"] = $x1["patrimonio"];
            }
            unset($x1);
            unset($ax1);
        }

        // Campos adicionados en mayo 20 de 2011     
        $retorno["ctrmen"] = $reg["ctrnotemail"];
        $retorno["ctrmennot"] = $reg["ctrnotsms"];
        $retorno["ctrubi"] = $reg["ctrubi"];
        $retorno["ctrfun"] = $reg["ctrfun"];
        $retorno["art4"] = $reg["ctrbenart4"];
        $retorno["art7"] = $reg["ctrbenart7"];
        $retorno["art50"] = $reg["ctrbenart50"];
        $retorno["ctrcancelacion1429"] = $reg["ctrcance1429"];
        $retorno["ctrdepuracion1727"] = $reg["ctrdepuracion1727"];
        $retorno["ctrfechadepuracion1727"] = $reg["ctrfechadepuracion1727"];
        $retorno["ctrben658"] = $reg["ctrben658"];
        $retorno["benley1780"] = $reg["ctrbenley1780"];
        $retorno["cumplerequisitos1780"] = $reg["cumplerequisitos1780"];  // Nuevo campo circular 002
        $retorno["renunciabeneficios1780"] = $reg["renunciabeneficios1780"]; // Nuevo campo circular 002
        $retorno["cumplerequisitos1780primren"] = $reg["cumplerequisitos1780primren"]; // Nuevo campo circular 002


        $retorno["fecmatant"] = $reg["fecmatant"];
        $retorno["fecrenant"] = $reg["fecrenant"];
        $retorno["matriculaanterior"] = $reg["matant"];
        $retorno["matant"] = $reg["matant"];
        $retorno["camant"] = $reg["camant"];
        $retorno["munant"] = $reg["munant"];
        $retorno["ultanorenant"] = $reg["ultanorenant"];
        $retorno["benart7ant"] = $reg["benart7ant"];
        $retorno["benley1780ant"] = $reg["benley1780ant"];

        //
        $retorno["ivcenvio"] = $reg["ctrivcenvio"];
        $retorno["ivcsuelos"] = $reg["ctrivcsuelos"];
        $retorno["ivcarea"] = $reg["ctrivcarea"];
        $retorno["ivcver"] = $reg["ctrivcver"];
        $retorno["ivccretip"] = $reg["ctrivccretip"];
        $retorno["ivcali"] = $reg["ctrivcali"];
        $retorno["ivcqui"] = $reg["ctrivcqui"];
        $retorno["ivcriesgo"] = $reg["ctrivcriesgo"];

        // Representacion legal y administracion
        $retorno["idtipoidentificacionreplegal"] = '';
        $retorno["identificacionreplegal"] = '';
        $retorno["nombrereplegal"] = '';
        $retorno["idtipoidentificacionadministrador"] = '';
        $retorno["identificacionadministrador"] = '';
        $retorno["nombreadministrador"] = '';

        // Casa principal
        $retorno["cpcodcam"] = $reg["cpcodcam"];
        $retorno["cpnummat"] = $reg["cpnummat"];
        $retorno["cprazsoc"] = $reg["cprazsoc"];
        $retorno["cpnumnit"] = $reg["cpnumnit"];
        $retorno["cpdircom"] = $reg["cpdircom"];
        $retorno["cpdirnot"] = $reg["cpdirnot"];
        $retorno["cpnumtel"] = $reg["cpnumtel"];
        $retorno["cpnumtel2"] = ''; // Nacen con circular 002
        $retorno["cpnumtel3"] = ''; // Nacen con circular 002
        $retorno["cpnumfax"] = $reg["cpnumfax"];
        $retorno["cpcodmun"] = $reg["cpcodmun"];
        $retorno["cpmunnot"] = $reg["cpmunnot"];

        // Bienes
        $retorno["bienes"] = array();
        $bienes = retornarRegistrosMysqli2($mysqli, 'mreg_est_bienes', "matricula='" . $reg["matricula"] . "'", "matinmo");
        if ($bienes) {
            if (!empty($bienes)) {
                $i = 0;
                foreach ($bienes as $bien) {
                    $i++;
                    $retorno["bienes"][$i]["matinmo"] = $bien["matinmo"];
                    $retorno["bienes"][$i]["dir"] = stripslashes($bien["dir"]);
                    $retorno["bienes"][$i]["barrio"] = stripslashes($bien["barrio"]);
                    $retorno["bienes"][$i]["muni"] = stripslashes($bien["muni"]);
                    $retorno["bienes"][$i]["dpto"] = stripslashes($bien["dpto"]);
                    $retorno["bienes"][$i]["pais"] = stripslashes($bien["pais"]);
                }
            }
        }

        //
        $retorno["clasevinculo"] = $_SESSION["clasevinculo"];

        // Vinculos 
        // Vinculos históricos
        // Representantes legales
        $retorno["replegal"] = array();
        $retorno["vinculos"] = array();
        $retorno["vinculosh"] = array();
        $vincs = retornarRegistrosMysqli2($mysqli, 'mreg_est_vinculos', "matricula='" . ltrim(trim($reg["matricula"]), "0") . "'", "estado,vinculo,idcargo,fecha,idclase,numid");
        $iVincs = 0;
        $iVincsh = 0;
        $iReps = 0;
        $primerRep = 0;
        if ($vincs) {
            if (!empty($vincs)) {
                foreach ($vincs as $vin) {
                    if ($vin["estado"] == 'V') {
                        $iVincs++;
                        $retorno["vinculos"][$iVincs]["idtipoidentificacionotros"] = $vin["idclase"];
                        $retorno["vinculos"][$iVincs]["identificacionotros"] = $vin["numid"];
                        $retorno["vinculos"][$iVincs]["nombreotros"] = stripslashes($vin["nombre"]);
                        $retorno["vinculos"][$iVincs]["apellido1otros"] = stripslashes($vin["ape1"]);
                        $retorno["vinculos"][$iVincs]["apellido2otros"] = stripslashes($vin["ape2"]);
                        $retorno["vinculos"][$iVincs]["nombre1otros"] = stripslashes($vin["nom1"]);
                        $retorno["vinculos"][$iVincs]["nombre2otros"] = stripslashes($vin["nom2"]);
                        $retorno["vinculos"][$iVincs]["direccionotros"] = stripslashes($vin["direccion"]);
                        $retorno["vinculos"][$iVincs]["municipiootros"] = stripslashes($vin["municipio"]);
                        $retorno["vinculos"][$iVincs]["paisotros"] = stripslashes($vin["pais"]);
                        $retorno["vinculos"][$iVincs]["emailotros"] = stripslashes($vin["email"]);
                        $retorno["vinculos"][$iVincs]["celularotros"] = ($vin["celular"]);
                        $retorno["vinculos"][$iVincs]["fechanacimientootros"] = ($vin["fechanacimiento"]);
                        $retorno["vinculos"][$iVincs]["idcargootros"] = ($vin["idcargo"]);
                        $retorno["vinculos"][$iVincs]["cargootros"] = stripslashes($vin["descargo"]);
                        $retorno["vinculos"][$iVincs]["vinculootros"] = ($vin["vinculo"]);
                        $retorno["vinculos"][$iVincs]["numtarprofotros"] = stripslashes($vin["tarjprof"]);
                        $retorno["vinculos"][$iVincs]["idclaseemp"] = ($vin["tirepresenta"]);
                        $retorno["vinculos"][$iVincs]["numidemp"] = ($vin["idrepresenta"]);
                        $retorno["vinculos"][$iVincs]["nombreemp"] = stripslashes($vin["nmrepresenta"]);
                        $retorno["vinculos"][$iVincs]["idvindianpnat"] = ($vin["vinculodianpnat"]);
                        $retorno["vinculos"][$iVincs]["idvindianpjur"] = ($vin["vinculodianpjur"]);
                        $retorno["vinculos"][$iVincs]["cuotasconst"] = ($vin["cuotasconst"]);
                        $retorno["vinculos"][$iVincs]["cuotasref"] = ($vin["cuotasref"]);
                        $retorno["vinculos"][$iVincs]["valorconst"] = ($vin["valorconst"]);
                        $retorno["vinculos"][$iVincs]["valorref"] = ($vin["valorref"]);
                        $retorno["vinculos"][$iVincs]["va1"] = ($vin["valorasociativa1"]);
                        $retorno["vinculos"][$iVincs]["va2"] = ($vin["valorasociativa2"]);
                        $retorno["vinculos"][$iVincs]["va3"] = ($vin["valorasociativa3"]);
                        $retorno["vinculos"][$iVincs]["va4"] = ($vin["valorasociativa4"]);
                        $retorno["vinculos"][$iVincs]["va5"] = ($vin["valorasociativa5"]);
                        $retorno["vinculos"][$iVincs]["va6"] = ($vin["valorasociativa6"]);
                        $retorno["vinculos"][$iVincs]["va7"] = ($vin["valorasociativa7"]);
                        $retorno["vinculos"][$iVincs]["va8"] = ($vin["valorasociativa8"]);
                        $retorno["vinculos"][$iVincs]["librootros"] = ($vin["idlibro"]);
                        $retorno["vinculos"][$iVincs]["inscripcionotros"] = ($vin["numreg"]);
                        $retorno["vinculos"][$iVincs]["dupliotros"] = ($vin["dupli"]);
                        $retorno["vinculos"][$iVincs]["fechaotros"] = ($vin["fecha"]);
                        $retorno["vinculos"][$iVincs]["ciiu1"] = ($vin["ciiu1"]);
                        $retorno["vinculos"][$iVincs]["ciiu2"] = ($vin["ciiu2"]);
                        $retorno["vinculos"][$iVincs]["ciiu3"] = ($vin["ciiu3"]);
                        $retorno["vinculos"][$iVincs]["ciiu4"] = ($vin["ciiu4"]);
                        $retorno["vinculos"][$iVincs]["tipositcontrol"] = ($vin["tipositcontrol"]);
                        $retorno["vinculos"][$iVincs]["desactiv"] = ($vin["desactiv"]);
                        $retorno["vinculos"][$iVincs]["fechaconfiguracion"] = ($vin["fechaconfiguracion"]);
                        $retorno["vinculos"][$iVincs]["codcertifica"] = ($vin["codcertifica"]);
                        $retorno["vinculos"][$iVincs]["tipovinculo"] = $_SESSION["maestrovinculos"][$vin["vinculo"]]["tipovinculo"];
                    }
                    if ($vin["estado"] == 'H') {
                        $iVincsh++;
                        $retorno["vinculosh"][$iVincsh]["idtipoidentificacionotros"] = $vin["idclase"];
                        $retorno["vinculosh"][$iVincsh]["identificacionotros"] = $vin["numid"];
                        $retorno["vinculosh"][$iVincsh]["nombreotros"] = stripslashes($vin["nombre"]);
                        $retorno["vinculosh"][$iVincsh]["apellido1otros"] = stripslashes($vin["ape1"]);
                        $retorno["vinculosh"][$iVincsh]["apellido2otros"] = stripslashes($vin["ape2"]);
                        $retorno["vinculosh"][$iVincsh]["nombre1otros"] = stripslashes($vin["nom1"]);
                        $retorno["vinculosh"][$iVincsh]["nombre2otros"] = stripslashes($vin["nom2"]);
                        $retorno["vinculosh"][$iVincsh]["direccionotros"] = stripslashes($vin["direccion"]);
                        $retorno["vinculosh"][$iVincsh]["municipiootros"] = stripslashes($vin["municipio"]);
                        $retorno["vinculosh"][$iVincsh]["paisotros"] = stripslashes($vin["pais"]);
                        $retorno["vinculosh"][$iVincsh]["emailotros"] = stripslashes($vin["email"]);
                        $retorno["vinculosh"][$iVincsh]["celularotros"] = ($vin["celular"]);
                        $retorno["vinculosh"][$iVincsh]["fechanacimientootros"] = ($vin["fechanacimiento"]);
                        $retorno["vinculosh"][$iVincsh]["idcargootros"] = ($vin["idcargo"]);
                        $retorno["vinculosh"][$iVincsh]["cargootros"] = stripslashes($vin["descargo"]);
                        $retorno["vinculosh"][$iVincsh]["vinculootros"] = ($vin["vinculo"]);
                        $retorno["vinculosh"][$iVincsh]["numtarprofotros"] = stripslashes($vin["tarjprof"]);
                        $retorno["vinculosh"][$iVincsh]["idclaseemp"] = ($vin["tirepresenta"]);
                        $retorno["vinculosh"][$iVincsh]["numidemp"] = ($vin["idrepresenta"]);
                        $retorno["vinculosh"][$iVincsh]["nombreemp"] = stripslashes($vin["nmrepresenta"]);
                        $retorno["vinculosh"][$iVincsh]["idvindianpnat"] = ($vin["vinculodianpnat"]);
                        $retorno["vinculosh"][$iVincsh]["idvindianpjur"] = ($vin["vinculodianpjur"]);
                        $retorno["vinculosh"][$iVincsh]["cuotasconst"] = ($vin["cuotasconst"]);
                        $retorno["vinculosh"][$iVincsh]["cuotasref"] = ($vin["cuotasref"]);
                        $retorno["vinculosh"][$iVincsh]["valorconst"] = ($vin["valorconst"]);
                        $retorno["vinculosh"][$iVincsh]["valorref"] = ($vin["valorref"]);
                        $retorno["vinculosh"][$iVincsh]["va1"] = ($vin["valorasociativa1"]);
                        $retorno["vinculosh"][$iVincsh]["va2"] = ($vin["valorasociativa2"]);
                        $retorno["vinculosh"][$iVincsh]["va3"] = ($vin["valorasociativa3"]);
                        $retorno["vinculosh"][$iVincsh]["va4"] = ($vin["valorasociativa4"]);
                        $retorno["vinculosh"][$iVincsh]["va5"] = ($vin["valorasociativa5"]);
                        $retorno["vinculosh"][$iVincsh]["va6"] = ($vin["valorasociativa6"]);
                        $retorno["vinculosh"][$iVincsh]["va7"] = ($vin["valorasociativa7"]);
                        $retorno["vinculosh"][$iVincsh]["va8"] = ($vin["valorasociativa8"]);
                        $retorno["vinculosh"][$iVincsh]["librootros"] = ($vin["idlibro"]);
                        $retorno["vinculosh"][$iVincsh]["inscripcionotros"] = ($vin["numreg"]);
                        $retorno["vinculosh"][$iVincsh]["dupliotros"] = ($vin["dupli"]);
                        $retorno["vinculosh"][$iVincsh]["fechaotros"] = ($vin["fecha"]);
                        $retorno["vinculosh"][$iVincsh]["ciiu1"] = ($vin["ciiu1"]);
                        $retorno["vinculosh"][$iVincsh]["ciiu2"] = ($vin["ciiu2"]);
                        $retorno["vinculosh"][$iVincsh]["ciiu3"] = ($vin["ciiu3"]);
                        $retorno["vinculosh"][$iVincsh]["ciiu4"] = ($vin["ciiu4"]);
                        $retorno["vinculosh"][$iVincsh]["tipositcontrol"] = ($vin["tipositcontrol"]);
                        $retorno["vinculosh"][$iVincsh]["desactiv"] = ($vin["desactiv"]);
                        $retorno["vinculosh"][$iVincsh]["fechaconfiguracion"] = ($vin["fechaconfiguracion"]);
                    }

                    if ($_SESSION["maestrovinculos"][$vin["vinculo"]]["tipovinculo"] == 'RLP' ||
                            $_SESSION["maestrovinculos"][$vin["vinculo"]]["tipovinculo"] == 'RLS1' ||
                            $_SESSION["maestrovinculos"][$vin["vinculo"]]["tipovinculo"] == 'RLS2' ||
                            $_SESSION["maestrovinculos"][$vin["vinculo"]]["tipovinculo"] == 'RLS3' ||
                            $_SESSION["maestrovinculos"][$vin["vinculo"]]["tipovinculo"] == 'RLS4' ||
                            $_SESSION["maestrovinculos"][$vin["vinculo"]]["tipovinculo"] == 'GER') {
                        if ($vin["estado"] == 'V') {
                            $iReps++;
                            $retorno["replegal"][$iReps]["idtipoidentificacionreplegal"] = $vin["idclase"];
                            $retorno["replegal"][$iReps]["identificacionreplegal"] = $vin["numid"];
                            $retorno["replegal"][$iReps]["nombrereplegal"] = stripslashes($vin["nombre"]);
                            $retorno["replegal"][$iReps]["nombre1replegal"] = stripslashes($vin["nom1"]);
                            $retorno["replegal"][$iReps]["nombre2replegal"] = stripslashes($vin["nom2"]);
                            $retorno["replegal"][$iReps]["apellido1replegal"] = stripslashes($vin["ape1"]);
                            $retorno["replegal"][$iReps]["apellido2replegal"] = stripslashes($vin["ape2"]);
                            $retorno["replegal"][$iReps]["emailreplegal"] = stripslashes($vin["email"]);
                            $retorno["replegal"][$iReps]["celularreplegal"] = ($vin["celular"]);
                            $retorno["replegal"][$iReps]["cargoreplegal"] = stripslashes($vin["descargo"]);
                            $retorno["replegal"][$iReps]["vinculoreplegal"] = ($vin["vinculo"]);
                            $retorno["replegal"][$iReps]["libroreplegal"] = ($vin["idlibro"]);
                            $retorno["replegal"][$iReps]["inscripcionreplegal"] = ($vin["numreg"]);
                            $retorno["replegal"][$iReps]["fechareplegal"] = ($vin["fecha"]);
                        }
                    }

                    // Primer representante legal y administrador
                    if ($vin["estado"] == 'V') {
                        if ($_SESSION["maestrovinculos"][$vin["vinculo"]]["tipovinculo"] == 'RLP' ||
                                $_SESSION["maestrovinculos"][$vin["vinculo"]]["tipovinculo"] == 'GER') {
                            $primerRep++;
                            if ($primerRep == 1) {
                                $retorno["idtipoidentificacionreplegal"] = $vin["idclase"];
                                $retorno["identificacionreplegal"] = $vin["numid"];
                                $retorno["nombrereplegal"] = stripslashes($vin["nombre"]);
                            }
                        }
                        if ($_SESSION["maestrovinculos"][$vin["vinculo"]]["tipovinculo"] == 'ADMP') {
                            $retorno["idtipoidentificacionadministrador"] = $vin["idclase"];
                            $retorno["identificacionadministrador"] = $vin["numid"];
                            $retorno["nombreadministrador"] = stripslashes($vin["nombre"]);
                        }
                    }
                }
            }
        }

        $retorno["vincuprop"] = array();
        $iVinProp = 0;

        // Propietarios
        $retorno["propietarios"] = array();
        if ($retorno["organizacion"] == '02') {
            $props = retornarRegistrosMysqli2($mysqli, 'mreg_est_propietarios', "matricula='" . $retorno["matricula"] . "'", "id");
            /* if ($props === false) {
              echo $_SESSION["generales"]["mensajeerror"];
              } */
            $iProp = 0;
            if ($props) {
                if (!empty($props)) {
                    foreach ($props as $prop) {
                        if ($prop["estado"] == 'V') {
                            $iProp++;
                            if (ltrim($prop["matriculapropietario"], "0") != '') {
                                if (ltrim($prop["codigocamara"], "0") == '') {
                                    $prop["codigocamara"] = CODIGO_EMPRESA;
                                }
                            }

                            $prop["fecmatprop"] = '';
                            $prop["fecrenprop"] = '';
                            $prop["ultanorenprop"] = '';
                            $prop["organizacionprop"] = '';
                            $prop["estadodatosprop"] = '';
                            $prop["estadomatriculaprop"] = '';
                            $prop["afiliacionprop"] = '';
                            $prop["ultanorenafliaprop"] = '';
                            $prop["saldoafliaprop"] = 0;
                            $prop["nombrereplegal"] = '';
                            $prop["identificacionreplegal"] = '';
                            $prop["tipoidentificacionreplegal"] = '';

                            if ($prop["codigocamara"] == CODIGO_EMPRESA) {
                                if (ltrim(trim($prop["matriculapropietario"]), "0") != '') {
                                    $xprop = retornarRegistroMysqli2($mysqli, 'mreg_est_inscritos', "matricula='" . ltrim(trim($prop["matriculapropietario"]), "0") . "'");
                                    if ($xprop === false || empty($xprop)) {
                                        $prop["tipoidentificacion"] = '';
                                        $prop["identificacion"] = '';
                                        $prop["nit"] = '';
                                        $prop["razonsocial"] = '';
                                        $prop["nombre1"] = '';
                                        $prop["nombre2"] = '';
                                        $prop["apellido1"] = '';
                                        $prop["apellido2"] = '';
                                        $prop["dircom"] = '';
                                        $prop["muncom"] = '';
                                        $prop["dirnot"] = '';
                                        $prop["munnot"] = '';
                                        $prop["telcom1"] = '';
                                        $prop["telcom2"] = '';
                                        $prop["telcom3"] = '';
                                        $prop["fecmatprop"] = '';
                                        $prop["fecrenprop"] = '';
                                        $prop["ultanorenprop"] = '';
                                        $prop["organizacionprop"] = '';
                                        $prop["estadodatosprop"] = '';
                                        $prop["estadomatriculaprop"] = '';
                                        $prop["afiliacionprop"] = '';
                                        $prop["ultanorenafliaprop"] = '';
                                        $prop["saldoafliaprop"] = '';
                                        $prop["nombrereplegal"] = '';
                                        $prop["identificacionreplegal"] = '';
                                        $prop["tipoidentificacionreplegal"] = '';
                                    } else {
                                        $prop["tipoidentificacion"] = $xprop["idclase"];
                                        $prop["identificacion"] = $xprop["numid"];
                                        $prop["nit"] = $xprop["nit"];
                                        $prop["razonsocial"] = $xprop["razonsocial"];
                                        $prop["nombre1"] = $xprop["nombre1"];
                                        $prop["nombre2"] = $xprop["nombre2"];
                                        $prop["apellido1"] = $xprop["apellido1"];
                                        $prop["apellido2"] = $xprop["apellido2"];
                                        $prop["dircom"] = $xprop["dircom"];
                                        $prop["muncom"] = $xprop["muncom"];
                                        $prop["dirnot"] = $xprop["dirnot"];
                                        $prop["munnot"] = $xprop["munnot"];
                                        $prop["telcom1"] = $xprop["telcom1"];
                                        $prop["telcom2"] = $xprop["telcom2"];
                                        $prop["telcom3"] = $xprop["telcom3"];
                                        $prop["fecmatprop"] = $xprop["fecmatricula"];
                                        $prop["fecrenprop"] = $xprop["fecrenovacion"];
                                        $prop["ultanorenprop"] = $xprop["ultanoren"];
                                        $prop["organizacionprop"] = $xprop["organizacion"];
                                        $prop["estadodatosprop"] = $xprop["ctrestdatos"];
                                        $prop["estadomatriculaprop"] = $xprop["ctrestmatricula"];
                                        $prop["afiliacionprop"] = $xprop["ctrafiliacion"];
                                        $prop["ultanorenafliaprop"] = $xprop["anorenaflia"];
                                        $prop["saldoafliaprop"] = $xprop["saldoaflia"];

                                        $iXvincs = 0;
                                        $xvincs = retornarRegistrosMysqli2($mysqli, 'mreg_est_vinculos', "matricula='" . $xprop["matricula"] . "' and estado = 'V'", "id");
                                        if ($xvincs) {
                                            if (!empty($xvincs)) {
                                                foreach ($xvincs as $xvin) {
                                                    if ($_SESSION["maestrovinculos"][$xvin["vinculo"]]["tipovinculo"] == 'RLP' ||
                                                            $_SESSION["maestrovinculos"][$xvin["vinculo"]]["tipovinculo"] == 'GER') {
                                                        $iXvincs++;
                                                        if ($iXvincs == 1) {
                                                            $prop["nombrereplegal"] = stripslashes($xvin["nombre"]);
                                                            $prop["identificacionreplegal"] = $xvin["idclase"];
                                                            $prop["tipoidentificacionreplegal"] = $xvin["numid"];
                                                        }
                                                        $iVinProp++;
                                                        $retorno["vincuprop"][$iVinProp] = array();
                                                        $retorno["vincuprop"][$iVinProp]["idclase"] = $xvin["idclase"];
                                                        $retorno["vincuprop"][$iVinProp]["numid"] = $xvin["numid"];
                                                        $retorno["vincuprop"][$iVinProp]["nombre"] = $xvin["nombre"];
                                                        $retorno["vincuprop"][$iVinProp]["vinculo"] = $xvin["vinculo"];
                                                        $retorno["vincuprop"][$iVinProp]["cargo"] = $xvin["descargo"];
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }

                            $retorno["propietarios"][$iProp]["camarapropietario"] = $prop["codigocamara"];
                            $retorno["propietarios"][$iProp]["matriculapropietario"] = ltrim($prop["matriculapropietario"], '0');
                            $retorno["propietarios"][$iProp]["idtipoidentificacionpropietario"] = trim($prop["tipoidentificacion"]);
                            $retorno["propietarios"][$iProp]["identificacionpropietario"] = ltrim($prop["identificacion"], '0');
                            $retorno["propietarios"][$iProp]["nitpropietario"] = ltrim($prop["nit"], '0');
                            $retorno["propietarios"][$iProp]["nombrepropietario"] = ($prop["razonsocial"]);
                            $retorno["propietarios"][$iProp]["nom1propietario"] = ($prop["nombre1"]);
                            $retorno["propietarios"][$iProp]["nom2propietario"] = ($prop["nombre2"]);
                            $retorno["propietarios"][$iProp]["ape1propietario"] = ($prop["apellido1"]);
                            $retorno["propietarios"][$iProp]["ape2propietario"] = ($prop["apellido2"]);
                            $retorno["propietarios"][$iProp]["tipopropiedad"] = ($prop["tipopropiedad"]);
                            $retorno["propietarios"][$iProp]["direccionpropietario"] = ($prop["dircom"]);
                            $retorno["propietarios"][$iProp]["municipiopropietario"] = ($prop["muncom"]);
                            $retorno["propietarios"][$iProp]["direccionnotpropietario"] = ($prop["dirnot"]);
                            $retorno["propietarios"][$iProp]["municipionotpropietario"] = ($prop["munnot"]);
                            $retorno["propietarios"][$iProp]["telefonopropietario"] = ($prop["telcom1"]);
                            $retorno["propietarios"][$iProp]["telefono2propietario"] = ($prop["telcom2"]);
                            $retorno["propietarios"][$iProp]["celularpropietario"] = ($prop["telcom3"]);
                            $retorno["propietarios"][$iProp]["nomreplegpropietario"] = ($prop["nombrereplegal"]);
                            $retorno["propietarios"][$iProp]["numidreplegpropietario"] = ($prop["identificacionreplegal"]);
                            $retorno["propietarios"][$iProp]["tipoidreplegpropietario"] = ($prop["tipoidentificacionreplegal"]);

                            $retorno["propietarios"][$iProp]["fecmatripropietario"] = '';
                            $retorno["propietarios"][$iProp]["fecrenovpropietario"] = '';
                            $retorno["propietarios"][$iProp]["ultanorenpropietario"] = '';
                            $retorno["propietarios"][$iProp]["organizacionpropietario"] = '';
                            $retorno["propietarios"][$iProp]["estadodatospropietario"] = '';
                            $retorno["propietarios"][$iProp]["estadomatriculapropietario"] = '';
                            $retorno["propietarios"][$iProp]["afiliacionpropietario"] = '';
                            $retorno["propietarios"][$iProp]["ultanorenafipropietario"] = '';
                            $retorno["propietarios"][$iProp]["saldoafiliadopropietario"] = '';

                            if (isset($prop["fecmatprop"])) {
                                $retorno["propietarios"][$iProp]["fecmatripropietario"] = ($prop["fecmatprop"]);
                            }
                            if (isset($prop["fecrenprop"])) {
                                $retorno["propietarios"][$iProp]["fecrenovpropietario"] = ($prop["fecrenprop"]);
                            }
                            if (isset($prop["ultanorenprop"])) {
                                $retorno["propietarios"][$iProp]["ultanorenpropietario"] = ($prop["ultanorenprop"]);
                            }
                            if (isset($prop["organizacionprop"])) {
                                $retorno["propietarios"][$iProp]["organizacionpropietario"] = ($prop["organizacionprop"]);
                            }
                            if (isset($prop["estadodatosprop"])) {
                                $retorno["propietarios"][$iProp]["estadodatospropietario"] = ($prop["estadodatosprop"]);
                            }
                            if (isset($prop["estadomatriculaprop"])) {
                                $retorno["propietarios"][$iProp]["estadomatriculapropietario"] = ($prop["estadomatriculaprop"]);
                            }
                            if (isset($prop["afiliacionprop"])) {
                                $retorno["propietarios"][$iProp]["afiliacionpropietario"] = ($prop["afiliacionprop"]);
                            }
                            if (isset($prop["ultanorenafliaprop"])) {
                                $retorno["propietarios"][$iProp]["ultanorenafipropietario"] = ($prop["ultanorenafliaprop"]);
                            }
                            if (isset($prop["saldoafliaprop"])) {
                                $retorno["propietarios"][$iProp]["saldoafiliadopropietario"] = ($prop["saldoafliaprop"]);
                            }
                        }
                    }
                }
            }
        }

        // Propietarios historicos
        $retorno["propietariosh"] = array();
        if ($retorno["organizacion"] == '02') {
            $props = retornarRegistrosMysqli2($mysqli, 'mreg_est_propietarios', "matricula='" . $retorno["matricula"] . "'", "id");
            $iProp = 0;
            if ($props) {
                if (!empty($props)) {
                    foreach ($props as $prop) {
                        if ($prop["estado"] == 'H') {
                            $iProp++;
                            if (ltrim($prop["matriculapropietario"], "0") != '') {
                                if (ltrim($prop["codigocamara"], "0") == '') {
                                    $prop["codigocamara"] = CODIGO_EMPRESA;
                                }
                            }

                            //
                            $prop["fecmatprop"] = '';
                            $prop["fecrenprop"] = '';
                            $prop["ultanorenprop"] = '';
                            $prop["organizacionprop"] = '';
                            $prop["estadodatosprop"] = '';
                            $prop["estadomatriculaprop"] = '';
                            $prop["afiliacionprop"] = '';
                            $prop["ultanorenafliaprop"] = '';
                            $prop["saldoafliaprop"] = 0;
                            $prop["nombrereplegal"] = '';
                            $prop["identificacionreplegal"] = '';
                            $prop["tipoidentificacionreplegal"] = '';

                            //
                            if ($prop["codigocamara"] == CODIGO_EMPRESA) {
                                if (ltrim(trim($prop["matriculapropietario"]), "0") != '') {
                                    $xprop = retornarRegistroMysqli2($mysqli, 'mreg_est_inscritos', "matricula='" . ltrim($prop["matriculapropietario"], "0") . "'");
                                    if ($xprop === false || empty($xprop)) {
                                        $prop["tipoidentificacion"] = '';
                                        $prop["identificacion"] = '';
                                        $prop["nit"] = '';
                                        $prop["razonsocial"] = '';
                                        $prop["nombre1"] = '';
                                        $prop["nombre2"] = '';
                                        $prop["apellido1"] = '';
                                        $prop["apellido2"] = '';
                                        $prop["dircom"] = '';
                                        $prop["muncom"] = '';
                                        $prop["dirnot"] = '';
                                        $prop["munnot"] = '';
                                        $prop["telcom1"] = '';
                                        $prop["telcom2"] = '';
                                        $prop["telcom3"] = '';
                                        $prop["fecmatprop"] = '';
                                        $prop["fecrenprop"] = '';
                                        $prop["ultanorenprop"] = '';
                                        $prop["organizacionprop"] = '';
                                        $prop["estadodatosprop"] = '';
                                        $prop["estadomatriculaprop"] = '';
                                        $prop["afiliacionprop"] = '';
                                        $prop["ultanorenafliaprop"] = '';
                                        $prop["saldoafliaprop"] = '';
                                        $prop["nombrereplegal"] = '';
                                        $prop["identificacionreplegal"] = '';
                                        $prop["tipoidentificacionreplegal"] = '';
                                    } else {
                                        $prop["tipoidentificacion"] = $xprop["idclase"];
                                        $prop["identificacion"] = $xprop["numid"];
                                        $prop["nit"] = $xprop["nit"];
                                        $prop["razonsocial"] = $xprop["razonsocial"];
                                        $prop["nombre1"] = $xprop["nombre1"];
                                        $prop["nombre2"] = $xprop["nombre2"];
                                        $prop["apellido1"] = $xprop["apellido1"];
                                        $prop["apellido2"] = $xprop["apellido2"];
                                        $prop["dircom"] = $xprop["dircom"];
                                        $prop["muncom"] = $xprop["muncom"];
                                        $prop["dirnot"] = $xprop["dirnot"];
                                        $prop["munnot"] = $xprop["munnot"];
                                        $prop["telcom1"] = $xprop["telcom1"];
                                        $prop["telcom2"] = $xprop["telcom2"];
                                        $prop["telcom3"] = $xprop["telcom3"];
                                        $prop["fecmatprop"] = $xprop["fecmatricula"];
                                        $prop["fecrenprop"] = $xprop["fecrenovacion"];
                                        $prop["ultanorenprop"] = $xprop["ultanoren"];
                                        $prop["organizacionprop"] = $xprop["organizacion"];
                                        $prop["estadodatosprop"] = $xprop["ctrestdatos"];
                                        $prop["estadomatriculaprop"] = $xprop["ctrestmatricula"];
                                        $prop["afiliacionprop"] = $xprop["ctrafiliacion"];
                                        $prop["ultanorenafliaprop"] = $xprop["anorenaflia"];
                                        $prop["saldoafliaprop"] = $xprop["saldoaflia"];

                                        $iXvincs = 0;
                                        $xvincs = retornarRegistrosMysqli2($mysqli, 'mreg_est_vinculos', "matricula='" . $xprop["matricula"] . "' and estado = 'V'", "id");
                                        if ($xvincs) {
                                            if (!empty($xvincs)) {
                                                foreach ($xvincs as $xvin) {
                                                    if ($_SESSION["maestrovinculos"][$xvin["vinculo"]]["tipovinculo"] == 'RLP' ||
                                                            $_SESSION["maestrovinculos"][$xvin["vinculo"]]["tipovinculo"] == 'GER') {
                                                        $iXvincs++;
                                                        if ($iXvincs == 1) {
                                                            $prop["nombrereplegal"] = stripslashes($xvin["nombre"]);
                                                            $prop["identificacionreplegal"] = $xvin["idclase"];
                                                            $prop["tipoidentificacionreplegal"] = $xvin["numid"];
                                                        }
                                                        $iVinProp++;
                                                        $retorno["vincuprop"][$iVinProp] = array();
                                                        $retorno["vincuprop"][$iVinProp]["idclase"] = $xvin["idclase"];
                                                        $retorno["vincuprop"][$iVinProp]["numid"] = $xvin["numid"];
                                                        $retorno["vincuprop"][$iVinProp]["nombre"] = $xvin["nombre"];
                                                        $retorno["vincuprop"][$iVinProp]["vinculo"] = $xvin["vinculo"];
                                                        $retorno["vincuprop"][$iVinProp]["cargo"] = $xvin["descargo"];
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }

                            $retorno["propietariosh"][$iProp]["camarapropietario"] = $prop["codigocamara"];
                            $retorno["propietariosh"][$iProp]["matriculapropietario"] = ltrim($prop["matriculapropietario"], '0');
                            $retorno["propietariosh"][$iProp]["idtipoidentificacionpropietario"] = trim($prop["tipoidentificacion"]);
                            $retorno["propietariosh"][$iProp]["identificacionpropietario"] = ltrim($prop["identificacion"], '0');
                            $retorno["propietariosh"][$iProp]["nitpropietario"] = ltrim($prop["nit"], '0');
                            $retorno["propietariosh"][$iProp]["nombrepropietario"] = ($prop["razonsocial"]);
                            $retorno["propietariosh"][$iProp]["nom1propietario"] = ($prop["nombre1"]);
                            $retorno["propietariosh"][$iProp]["nom2propietario"] = ($prop["nombre2"]);
                            $retorno["propietariosh"][$iProp]["ape1propietario"] = ($prop["apellido1"]);
                            $retorno["propietariosh"][$iProp]["ape2propietario"] = ($prop["apellido2"]);
                            $retorno["propietariosh"][$iProp]["tipopropiedad"] = ($prop["tipopropiedad"]);
                            $retorno["propietariosh"][$iProp]["direccionpropietario"] = ($prop["dircom"]);
                            $retorno["propietariosh"][$iProp]["municipiopropietario"] = ($prop["muncom"]);
                            $retorno["propietariosh"][$iProp]["direccionnotpropietario"] = ($prop["dirnot"]);
                            $retorno["propietariosh"][$iProp]["municipionotpropietario"] = ($prop["munnot"]);
                            $retorno["propietariosh"][$iProp]["telefonopropietario"] = ($prop["telcom1"]);
                            $retorno["propietariosh"][$iProp]["telefono2propietario"] = ($prop["telcom2"]);
                            $retorno["propietariosh"][$iProp]["celularpropietario"] = ($prop["telcom3"]);
                            $retorno["propietariosh"][$iProp]["nomreplegpropietario"] = ($prop["nombrereplegal"]);
                            $retorno["propietariosh"][$iProp]["numidreplegpropietario"] = ($prop["identificacionreplegal"]);
                            $retorno["propietariosh"][$iProp]["tipoidreplegpropietario"] = ($prop["tipoidentificacionreplegal"]);

                            $retorno["propietariosh"][$iProp]["fecmatripropietario"] = '';
                            $retorno["propietariosh"][$iProp]["fecrenovpropietario"] = '';
                            $retorno["propietariosh"][$iProp]["ultanorenpropietario"] = '';
                            $retorno["propietariosh"][$iProp]["organizacionpropietario"] = '';
                            $retorno["propietariosh"][$iProp]["estadodatospropietario"] = '';
                            $retorno["propietariosh"][$iProp]["estadomatriculapropietario"] = '';
                            $retorno["propietariosh"][$iProp]["afiliacionpropietario"] = '';
                            $retorno["propietariosh"][$iProp]["ultanorenafipropietario"] = '';
                            $retorno["propietariosh"][$iProp]["saldoafiliadopropietario"] = '';

                            if (isset($prop["fecmatprop"])) {
                                $retorno["propietariosh"][$iProp]["fecmatripropietario"] = ($prop["fecmatprop"]);
                            }
                            if (isset($prop["fecrenprop"])) {
                                $retorno["propietariosh"][$iProp]["fecrenovpropietario"] = ($prop["fecrenprop"]);
                            }
                            if (isset($prop["ultanorenprop"])) {
                                $retorno["propietariosh"][$iProp]["ultanorenpropietario"] = ($prop["ultanorenprop"]);
                            }
                            if (isset($prop["organizacionprop"])) {
                                $retorno["propietariosh"][$iProp]["organizacionpropietario"] = ($prop["organizacionprop"]);
                            }
                            if (isset($prop["estadodatosprop"])) {
                                $retorno["propietariosh"][$iProp]["estadodatospropietario"] = ($prop["estadodatosprop"]);
                            }
                            if (isset($prop["estadomatriculaprop"])) {
                                $retorno["propietariosh"][$iProp]["estadomatriculapropietario"] = ($prop["estadomatriculaprop"]);
                            }
                            if (isset($prop["afiliacionprop"])) {
                                $retorno["propietariosh"][$iProp]["afiliacionpropietario"] = ($prop["afiliacionprop"]);
                            }
                            if (isset($prop["ultanorenafliaprop"])) {
                                $retorno["propietariosh"][$iProp]["ultanorenafipropietario"] = ($prop["ultanorenafliaprop"]);
                            }
                            if (isset($prop["saldoafliaprop"])) {
                                $retorno["propietariosh"][$iProp]["saldoafiliadopropietario"] = ($prop["saldoafliaprop"]);
                            }
                        }
                    }
                }
            }
        }

        // Vinculos de la casa principal, en caso de sucursales o agencias
        if ($retorno["organizacion"] > '02' && $retorno["categoria"] == '1') {
            if ($retorno["cpcodcam"] == '' || $retorno["cpcodcam"] == CODIGO_EMPRESA) {
                $iXvincs = 0;
                $xvincs = retornarRegistrosMysqli2($mysqli, 'mreg_est_vinculos', "matricula='" . $retorno["cpnummat"] . "' and estado = 'V'", "id");
                if ($xvincs) {
                    if (!empty($xvincs)) {
                        foreach ($xvincs as $xvin) {
                            if ($_SESSION["maestrovinculos"][$xvin["vinculo"]]["tipovinculo"] == 'RLP' ||
                                    $_SESSION["maestrovinculos"][$xvin["vinculo"]]["tipovinculo"] == 'GER') {
                                $iXvincs++;
                                if ($iXvincs == 1) {
                                    $prop["nombrereplegal"] = stripslashes($xvin["nombre"]);
                                    $prop["identificacionreplegal"] = $xvin["idclase"];
                                    $prop["tipoidentificacionreplegal"] = $xvin["numid"];
                                }
                                $iVinProp++;
                                $retorno["vincuprop"][$iVinProp] = array();
                                $retorno["vincuprop"][$iVinProp]["idclase"] = $xvin["idclase"];
                                $retorno["vincuprop"][$iVinProp]["numid"] = $xvin["numid"];
                                $retorno["vincuprop"][$iVinProp]["nombre"] = $xvin["nombre"];
                                $retorno["vincuprop"][$iVinProp]["vinculo"] = $xvin["vinculo"];
                                $retorno["vincuprop"][$iVinProp]["cargo"] = $xvin["descargo"];
                            }
                        }
                    }
                }
            }
        }

        // \logSii2::general2($nameLog, $retorno["matricula"], 'Entró a relación establecimientos : ' . date("His"));
        // Relación de establecimientos
        $retorno["establecimientos"] = array();
        if ($retorno["organizacion"] != '02' && (trim($retorno["categoria"]) == '' || $retorno["categoria"] == '0' || $retorno["categoria"] == '1')) {
            $in = "'" . ltrim(trim($retorno["matricula"]), "0") . "'";
            $in .= ",'" . sprintf("%08s", ltrim(trim($retorno["matricula"]), "0")) . "'";
            $arrX = retornarRegistrosMysqli2($mysqli, 'mreg_est_propietarios', "matriculapropietario IN (" . $in . ")", "matricula");
            if ($arrX === false) {
                echo $_SESSION["generales"]["mensajeerror"];
            }
            if ($arrX && !empty($arrX)) {
                $ix = 0;
                foreach ($arrX as $x) {
                    if (ltrim(trim($x["matricula"]), "0") != '') {
                        if ($x["estado"] != 'H') {
                            if ($x["codigocamara"] == '' || $x["codigocamara"] == CODIGO_EMPRESA) {
                                $temEst = retornarRegistroMysqli2($mysqli, 'mreg_est_inscritos', "matricula='" . $x["matricula"] . "'");
                                if ($temEst["ctrestmatricula"] == 'MA' || $temEst["ctrestmatricula"] == 'MI') {
                                    if ($temEst["organizacion"] == '02') {
                                        $ix++;
                                        $retorno["establecimientos"][$ix]["matriculaestablecimiento"] = $x["matricula"];
                                        $retorno["establecimientos"][$ix]["nombreestablecimiento"] = $temEst["razonsocial"];
                                        $retorno["establecimientos"][$ix]["estadodatosestablecimiento"] = $temEst["ctrestmatricula"];
                                        $retorno["establecimientos"][$ix]["estadomatricula"] = $temEst["ctrestmatricula"];
                                        $retorno["establecimientos"][$ix]["dircom"] = $temEst["dircom"];
                                        $retorno["establecimientos"][$ix]["barriocom"] = $temEst["barriocom"];
                                        $retorno["establecimientos"][$ix]["telcom1"] = $temEst["telcom1"];
                                        $retorno["establecimientos"][$ix]["telcom2"] = $temEst["telcom2"];
                                        $retorno["establecimientos"][$ix]["telcom3"] = $temEst["telcom3"];
                                        $retorno["establecimientos"][$ix]["muncom"] = $temEst["muncom"];
                                        $retorno["establecimientos"][$ix]["emailcom"] = $temEst["emailcom"];
                                        $retorno["establecimientos"][$ix]["fechamatricula"] = $temEst["fecmatricula"];
                                        $retorno["establecimientos"][$ix]["fecharenovacion"] = $temEst["fecrenovacion"];
                                        $retorno["establecimientos"][$ix]["ultanoren"] = $temEst["ultanoren"];
                                        $retorno["establecimientos"][$ix]["actvin"] = $temEst["actvin"];
                                        $retorno["establecimientos"][$ix]["ciiu1"] = $temEst["ciiu1"];
                                        $retorno["establecimientos"][$ix]["ciiu2"] = $temEst["ciiu2"];
                                        $retorno["establecimientos"][$ix]["ciiu3"] = $temEst["ciiu3"];
                                        $retorno["establecimientos"][$ix]["ciiu4"] = $temEst["ciiu4"];
                                        $retorno["establecimientos"][$ix]["embargado"] = 'NO';
                                        $retorno["establecimientos"][$ix]["embargos"] = array();

                                        $temE = retornarRegistrosMysqli2($mysqli, 'mreg_est_embargos', "matricula='" . trim($x["matricula"]) . "' and acto IN ('0900','0940','0991','1000','1040') and ctrestadoembargo='1'");
                                        if ($temE && !empty($temE)) {
                                            $iEmb = 0;
                                            foreach ($temE as $e) {
                                                $retorno["establecimientos"][$ix]["embargado"] = 'SI';
                                                $iEmb++;
                                                $retorno["establecimientos"][$ix]["embargos"][$iEmb]["libroembargo"] = $e["libro"];
                                                $retorno["establecimientos"][$ix]["embargos"][$iEmb]["registroembargo"] = $e["numreg"];
                                                $retorno["establecimientos"][$ix]["embargos"][$iEmb]["fechaembargo"] = $e["fecinscripcion"];
                                                $retorno["establecimientos"][$ix]["embargos"][$iEmb]["txtorigenembargo"] = $e["txtorigen"];
                                                $retorno["establecimientos"][$ix]["embargos"][$iEmb]["noticiaembargo"] = stripslashes($e["noticia"]);
                                            }
                                        }

                                        $retorno["establecimientos"][$ix]["valest"] = $temEst["actvin"];
                                        $retorno["establecimientos"][$ix]["tipopropiedad"] = '';
                                        $retorno["establecimientos"][$ix]["ideadministrador"] = '';
                                        $retorno["establecimientos"][$ix]["nombreadministrador"] = '';
                                        $retorno["establecimientos"][$ix]["idearrendatario"] = '';
                                        $retorno["establecimientos"][$ix]["nombrearrendatario"] = '';

                                        $temE = retornarRegistrosMysqli2($mysqli, 'mreg_est_vinculos', "matricula='" . $x["matricula"] . "' and estado='V'", "vinculo");
                                        if ($temE && !empty($temE)) {
                                            foreach ($temE as $tx) {
                                                if ($_SESSION["maestrovinculos"][$tx["vinculo"]]["tipovinculo"] == 'ADMP') {
                                                    $retorno["establecimientos"][$ix]["ideadministrador"] = $tx["numid"];
                                                    $retorno["establecimientos"][$ix]["nombreadministrador"] = $tx["nombre"];
                                                }
                                                if ($_SESSION["maestrovinculos"][$tx["vinculo"]]["tipovinculo"] == 'ARR') {
                                                    $retorno["establecimientos"][$ix]["idearrendatario"] = $tx["numid"];
                                                    $retorno["establecimientos"][$ix]["nombrearrendatario"] = $tx["nombre"];
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            unset($arrX);
        }
        // \logSii2::general2($nameLog, $retorno["matricula"], 'Salió de relación establecimientos : ' . date("His"));
        //2017-11-22 WSIERRA:         
        //Establecimientos que ha tenido una matricula propietaria
        // \logSii2::general2($nameLog, $retorno["matricula"], 'Entró a relación establecimientosh : ' . date("His"));
        $retorno["establecimientosh"] = array();

        if ($retorno["organizacion"] != '02' && (trim($retorno["categoria"]) == '' || $retorno["categoria"] == '0' || $retorno["categoria"] == '1')) {
            $in = "'" . ltrim(trim($retorno["matricula"]), "0") . "'";
            $in .= ",'" . sprintf("%08s", ltrim(trim($retorno["matricula"]), "0")) . "'";
            $arrX = retornarRegistrosMysqli2($mysqli, 'mreg_est_propietarios', "matriculapropietario IN (" . $in . ")", "matricula");
            if ($arrX === false) {
                echo $_SESSION["generales"]["mensajeerror"];
            }
            if ($arrX && !empty($arrX)) {
                $ix = 0;
                foreach ($arrX as $x) {
                    if (ltrim(trim($x["matricula"]), "0") != '') {
                        if ($x["estado"] != 'H') {
                            if ($x["codigocamara"] == '' || $x["codigocamara"] == CODIGO_EMPRESA) {
                                $temEst = retornarRegistroMysqli2($mysqli, 'mreg_est_inscritos', "matricula='" . $x["matricula"] . "'");
                                if ($temEst["ctrestmatricula"] == 'MC' || $temEst["ctrestmatricula"] == 'MF') {
                                    if ($temEst["organizacion"] == '02') {
                                        $ix++;
                                        $retorno["establecimientosh"][$ix]["matriculaestablecimiento"] = $x["matricula"];
                                        $retorno["establecimientosh"][$ix]["nombreestablecimiento"] = $temEst["razonsocial"];
                                        $retorno["establecimientosh"][$ix]["estadodatosestablecimiento"] = $temEst["ctrestmatricula"];
                                        $retorno["establecimientosh"][$ix]["estadomatricula"] = $temEst["ctrestmatricula"];
                                        $retorno["establecimientosh"][$ix]["dircom"] = $temEst["dircom"];
                                        $retorno["establecimientosh"][$ix]["barriocom"] = $temEst["barriocom"];
                                        $retorno["establecimientosh"][$ix]["telcom1"] = $temEst["telcom1"];
                                        $retorno["establecimientosh"][$ix]["telcom2"] = $temEst["telcom2"];
                                        $retorno["establecimientosh"][$ix]["telcom3"] = $temEst["telcom3"];
                                        $retorno["establecimientosh"][$ix]["muncom"] = $temEst["muncom"];
                                        $retorno["establecimientosh"][$ix]["emailcom"] = $temEst["emailcom"];
                                        $retorno["establecimientosh"][$ix]["fechamatricula"] = $temEst["fecmatricula"];
                                        $retorno["establecimientosh"][$ix]["fecharenovacion"] = $temEst["fecrenovacion"];
                                        $retorno["establecimientosh"][$ix]["fechacancelacion"] = $temEst["feccancelacion"];
                                        $retorno["establecimientosh"][$ix]["ultanoren"] = $temEst["ultanoren"];
                                        $retorno["establecimientosh"][$ix]["actvin"] = $temEst["actvin"];
                                        $retorno["establecimientosh"][$ix]["ciiu1"] = $temEst["ciiu1"];
                                        $retorno["establecimientosh"][$ix]["ciiu2"] = $temEst["ciiu2"];
                                        $retorno["establecimientosh"][$ix]["ciiu3"] = $temEst["ciiu3"];
                                        $retorno["establecimientosh"][$ix]["ciiu4"] = $temEst["ciiu4"];
                                    }
                                }
                            }
                        }
                    }
                }
            }
            unset($arrX);
        }
        // \logSii2::general2($nameLog, $retorno["matricula"], 'Salió de relación establecimientosh : ' . date("His"));
        // Relación de sucursales y agencias
        // // \logSii2::general2($nameLog, $retorno["matricula"], 'Entró a relación suc/age : ' . date("His"));
        $retorno["sucursalesagencias"] = array();
        if ($retorno["organizacion"] == '01' ||
                ($retorno["organizacion"] > '02' && $retorno["categoria"] == '1')) {
            $camposRequeridos = 'matricula,razonsocial,categoria,ctrestmatricula,fecmatricula,fecrenovacion,ultanoren,dircom,muncom,telcom1,telcom2,telcom3,emailcom,ciiu1,ciiu2,ciiu3,ciiu4,actvin';

            $arrX = retornarRegistrosMysqli2($mysqli, 'mreg_est_inscritos', "cpcodcam='" . CODIGO_EMPRESA . "' and cpnummat IN ('" . sprintf("%08s", $reg["matricula"]) . "','" . ltrim($reg["matricula"], "0") . "')", "matricula", $camposRequeridos);
            if ($arrX && !empty($arrX)) {
                $ix = 0;
                foreach ($arrX as $x) {
                    $ix++;
                    $retorno["sucursalesagencias"][$ix]["matriculasucage"] = $x["matricula"];
                    $retorno["sucursalesagencias"][$ix]["nombresucage"] = $x["razonsocial"];
                    $retorno["sucursalesagencias"][$ix]["categoria"] = $x["categoria"];
                    $retorno["sucursalesagencias"][$ix]["estado"] = $x["ctrestmatricula"];
                    $retorno["sucursalesagencias"][$ix]["fechamatricula"] = $x["fecmatricula"];
                    $retorno["sucursalesagencias"][$ix]["fecharenovacion"] = $x["fecrenovacion"];
                    $retorno["sucursalesagencias"][$ix]["ultanoren"] = $x["ultanoren"];
                    $retorno["sucursalesagencias"][$ix]["dircom"] = $x["dircom"];
                    $retorno["sucursalesagencias"][$ix]["muncom"] = $x["muncom"];
                    $retorno["sucursalesagencias"][$ix]["telcom1"] = $x["telcom1"];
                    $retorno["sucursalesagencias"][$ix]["telcom2"] = $x["telcom2"];
                    $retorno["sucursalesagencias"][$ix]["telcom3"] = $x["telcom3"];
                    $retorno["sucursalesagencias"][$ix]["emailcom"] = $x["emailcom"];
                    $retorno["sucursalesagencias"][$ix]["ciiu1"] = $x["ciiu1"];
                    $retorno["sucursalesagencias"][$ix]["ciiu2"] = $x["ciiu2"];
                    $retorno["sucursalesagencias"][$ix]["ciiu3"] = $x["ciiu3"];
                    $retorno["sucursalesagencias"][$ix]["ciiu4"] = $x["ciiu4"];
                    $retorno["sucursalesagencias"][$ix]["embargado"] = 'NO';

                    $retorno["sucursalesagencias"][$ix]["libro1embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["registro1embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["fecha1embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["txtorigen1embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["libro2embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["registro2embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["fecha2embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["txtorigen2embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["libro3embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["registro3embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["fecha3embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["txtorigen3embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["libro4embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["registro4embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["fecha4embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["txtorigen4embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["libro5embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["registro5embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["fecha5embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["txtorigen5embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["embargado"] = 'NO';
                    $retorno["sucursalesagencias"][$ix]["embargos"] = array();

                    $temE = retornarRegistrosMysqli2($mysqli, 'mreg_est_embargos', "matricula='" . trim($x["matricula"]) . "' and acto IN ('0900','0940','0991','1000','1040') and ctrestadoembargo='1'");
                    if ($temE && !empty($temE)) {
                        $iEmb = 0;
                        foreach ($temE as $e) {
                            $retorno["sucursalesagencias"][$ix]["embargado"] = 'SI';
                            $iEmb++;
                            $retorno["sucursalesagencias"][$ix]["embargos"][$iEmb]["libroembargo"] = $e["libro"];
                            $retorno["sucursalesagencias"][$ix]["embargos"][$iEmb]["registroembargo"] = $e["numreg"];
                            $retorno["sucursalesagencias"][$ix]["embargos"][$iEmb]["fechaembargo"] = $e["fecinscripcion"];
                            $retorno["sucursalesagencias"][$ix]["embargos"][$iEmb]["txtorigenembargo"] = $e["txtorigen"];
                        }
                    }

                    $retorno["sucursalesagencias"][$ix]["actvin"] = $x["actvin"];
                }
            }
            unset($arrX);
        }
        // // \logSii2::general2($nameLog, $retorno["matricula"], 'Salió de relación suc/age : ' . date("His"));
        // Relación de establecimientos arrendados
        // // \logSii2::general2($nameLog, $retorno["matricula"], 'Entró a establecimientos arrendados : ' . date("His"));
        $retorno["establecimientosarrendados"] = array();
        if ($retorno["organizacion"] != '02' && (trim($retorno["categoria"]) == '' || $retorno["categoria"] == '0' || $retorno["categoria"] == '1')) {
            if ($retorno["identificacion"] != '') {
                $arrX = retornarRegistrosMysqli2($mysqli, 'mreg_est_vinculos', "numid='" . $retorno["identificacion"] . "'", "matricula");
                if ($arrX === false) {
                    echo $_SESSION["generales"]["mensajeerror"];
                }
                if ($arrX && !empty($arrX)) {
                    $ix = 0;
                    foreach ($arrX as $x) {
                        if ($_SESSION["maestrovinculos"][$x["vinculo"]]["tipovinculo"] == 'ARR') {
                            if (ltrim(trim($x["matricula"]), "0") != '') {
                                if ($x["estado"] != 'H') {
                                    $temEst = retornarRegistroMysqli2($mysqli, 'mreg_est_inscritos', "matricula='" . $x["matricula"] . "'");
                                    if ($temEst["ctrestmatricula"] == 'MA' || $temEst["ctrestmatricula"] == 'MI') {
                                        if ($temEst["organizacion"] == '02') {
                                            $ix++;
                                            $retorno["establecimientosarrendados"][$ix]["matricula"] = $x["matricula"];
                                            $retorno["establecimientosarrendados"][$ix]["nombre"] = $temEst["razonsocial"];
                                            $retorno["establecimientosarrendados"][$ix]["estadodatos"] = $temEst["ctrestmatricula"];
                                            $retorno["establecimientosarrendados"][$ix]["estadomatricula"] = $temEst["ctrestmatricula"];
                                            $retorno["establecimientosarrendados"][$ix]["dircom"] = $temEst["dircom"];
                                            $retorno["establecimientosarrendados"][$ix]["barriocom"] = $temEst["barriocom"];
                                            $retorno["establecimientosarrendados"][$ix]["telcom1"] = $temEst["telcom1"];
                                            $retorno["establecimientosarrendados"][$ix]["telcom2"] = $temEst["telcom2"];
                                            $retorno["establecimientosarrendados"][$ix]["telcom3"] = $temEst["telcom3"];
                                            $retorno["establecimientosarrendados"][$ix]["muncom"] = $temEst["muncom"];
                                            $retorno["establecimientosarrendados"][$ix]["emailcom"] = $temEst["emailcom"];
                                            $retorno["establecimientosarrendados"][$ix]["fechamatricula"] = $temEst["fecmatricula"];
                                            $retorno["establecimientosarrendados"][$ix]["fecharenovacion"] = $temEst["fecrenovacion"];
                                            $retorno["establecimientosarrendados"][$ix]["ultanoren"] = $temEst["ultanoren"];
                                            $retorno["establecimientosarrendados"][$ix]["actvin"] = $temEst["actvin"];
                                            $retorno["establecimientosarrendados"][$ix]["ciiu1"] = $temEst["ciiu1"];
                                            $retorno["establecimientosarrendados"][$ix]["ciiu2"] = $temEst["ciiu2"];
                                            $retorno["establecimientosarrendados"][$ix]["ciiu3"] = $temEst["ciiu3"];
                                            $retorno["establecimientosarrendados"][$ix]["ciiu4"] = $temEst["ciiu4"];
                                            $retorno["establecimientosarrendados"][$ix]["valest"] = $temEst["actvin"];
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            unset($arrX);
        }

        $retorno["establecimientosnacionales"] = array();
        //
        if ($tipodata == 'E') {
            if ($retorno["organizacion"] == '01' || $retorno["organizacion"] > '02' && $retorno["categoria"] == '1') {
                $ests = \funcionesSii2::consultarEstablecimientosNacionales($mysqli, $retorno["tipoidentificacion"], $retorno["identificacion"]);
                if (!empty($ests)) {
                    $ix = 0;

                    foreach ($ests as $x) {
                        if ($x["codigo_estado_matricula"] == '01') { // Solo establecimientos activos
                            if ($x["codigo_camara"] != CODIGO_EMPRESA) { // Solo si son de una cámara diferente
                                $ix++;

                                //
                                $retorno["establecimientosnacionales"][$ix]["cc"] = trim($x["codigo_camara"]);
                                $retorno["establecimientosnacionales"][$ix]["matriculaestablecimiento"] = ltrim($x["matricula"], "0");
                                $retorno["establecimientosnacionales"][$ix]["nombreestablecimiento"] = trim($x["razon_social"]);
                                $retorno["establecimientosnacionales"][$ix]["estadodatosestablecimiento"] = '6';
                                $retorno["establecimientosnacionales"][$ix]["estadomatricula"] = 'MA';
                                $retorno["establecimientosnacionales"][$ix]["organizacion"] = trim($x["codigo_organizacion_juridica"]);
                                $retorno["establecimientosnacionales"][$ix]["categoria"] = trim($x["codigo_categoria_matricula"]);

                                //
                                $retorno["establecimientosnacionales"][$ix]["dircom"] = trim($x["direccion_comercial"]);
                                $retorno["establecimientosnacionales"][$ix]["barriocom"] = '';
                                if (isset($x["codigo_barrio_comercial"])) {
                                    $retorno["establecimientosnacionales"][$ix]["barriocom"] = trim($x["codigo_barrio_comercial"]);
                                }
                                $retorno["establecimientosnacionales"][$ix]["nbarriocom"] = '';
                                if (isset($x["codigo_barrio_comercial"])) {
                                    $retorno["establecimientosnacionales"][$ix]["nbarriocom"] = trim($x["barrio_comercial"]);
                                }

                                //
                                $retorno["establecimientosnacionales"][$ix]["telcom1"] = trim($x["telefono_comercial_1"]);
                                $retorno["establecimientosnacionales"][$ix]["telcom2"] = trim($x["telefono_comercial_2"]);
                                $retorno["establecimientosnacionales"][$ix]["telcom3"] = trim($x["telefono_comercial_3"]);
                                $retorno["establecimientosnacionales"][$ix]["muncom"] = trim($x["municipio_comercial"]);
                                $retorno["establecimientosnacionales"][$ix]["nmuncom"] = trim($x["nombre_municipio_comercial"]);
                                $retorno["establecimientosnacionales"][$ix]["emailcom"] = trim($x["correo_electronico_comercial"]);
                                $retorno["establecimientosnacionales"][$ix]["codpostalcom"] = trim($x["codigo_postal_comercial"]);

                                //
                                $retorno["establecimientosnacionales"][$ix]["dirnot"] = trim($x["direccion_fiscal"]);
                                $retorno["establecimientosnacionales"][$ix]["barrionot"] = '';
                                if (isset($x["codigo_barrio_fiscal"])) {
                                    $retorno["establecimientosnacionales"][$ix]["barrionot"] = trim($x["codigo_barrio_fiscal"]);
                                }
                                $retorno["establecimientosnacionales"][$ix]["nbarrionot"] = '';
                                if (isset($x["barrio_fiscal"])) {
                                    $retorno["establecimientosnacionales"][$ix]["nbarrionot"] = trim($x["barrio_fiscal"]);
                                }

                                //
                                $retorno["establecimientosnacionales"][$ix]["telnot1"] = '';
                                $retorno["establecimientosnacionales"][$ix]["telnot2"] = '';
                                $retorno["establecimientosnacionales"][$ix]["telnot3"] = '';
                                $retorno["establecimientosnacionales"][$ix]["munnot"] = trim($x["municipio_fiscal"]);
                                $retorno["establecimientosnacionales"][$ix]["nmunnot"] = '';
                                if (isset($x["nombre_municipio_fiscal"])) {
                                    $retorno["establecimientosnacionales"][$ix]["nmunnot"] = trim($x["nombre_municipio_fiscal"]);
                                }
                                $retorno["establecimientosnacionales"][$ix]["emailnor"] = trim($x["correo_electronico_fiscal"]);
                                $retorno["establecimientosnacionales"][$ix]["codpostalnot"] = trim($x["codigo_postal_fiscal"]);

                                //
                                $retorno["establecimientosnacionales"][$ix]["fechamatricula"] = trim($x["fecha_matricula"]);
                                $retorno["establecimientosnacionales"][$ix]["fecharenovacion"] = trim($x["fecha_renovacion"]);
                                $retorno["establecimientosnacionales"][$ix]["fechacancelacion"] = '';
                                $retorno["establecimientosnacionales"][$ix]["ultanoren"] = trim($x["ultimo_ano_renovado"]);
                                $retorno["establecimientosnacionales"][$ix]["actvin"] = doubleval($x["valor_est_ag_suc"]);
                                $retorno["establecimientosnacionales"][$ix]["empleados"] = doubleval($x["empleados"]);

                                //
                                $retorno["establecimientosnacionales"][$ix]["ciiu1"] = '';
                                $retorno["establecimientosnacionales"][$ix]["ciiu2"] = '';
                                $retorno["establecimientosnacionales"][$ix]["ciiu3"] = '';
                                $retorno["establecimientosnacionales"][$ix]["ciiu4"] = '';
                                $retorno["establecimientosnacionales"][$ix]["shd1"] = '';
                                $retorno["establecimientosnacionales"][$ix]["shd2"] = '';
                                $retorno["establecimientosnacionales"][$ix]["shd3"] = '';
                                $retorno["establecimientosnacionales"][$ix]["shd4"] = '';
                                if (trim($x["ciiu1"]) != '') {
                                    $retorno["establecimientosnacionales"][$ix]["ciiu1"] = retornarRegistroMysqli2($mysqli, "bas_ciius", "idciiunum='" . trim($x["ciiu1"]) . "'", "idciiu");
                                }
                                if (trim($x["ciiu2"]) != '') {
                                    $retorno["establecimientosnacionales"][$ix]["ciiu2"] = retornarRegistroMysqli2($mysqli, "bas_ciius", "idciiunum='" . trim($x["ciiu2"]) . "'", "idciiu");
                                }
                                if (trim($x["ciiu3"]) != '') {
                                    $retorno["establecimientosnacionales"][$ix]["ciiu3"] = retornarRegistroMysqli2($mysqli, "bas_ciius", "idciiunum='" . trim($x["ciiu3"]) . "'", "idciiu");
                                }
                                if (trim($x["ciiu4"]) != '') {
                                    $retorno["establecimientosnacionales"][$ix]["ciiu4"] = retornarRegistroMysqli2($mysqli, "bas_ciius", "idciiunum='" . trim($x["ciiu4"]) . "'", "idciiu");
                                }
                                if (trim($x["shd1"]) != '') {
                                    $retorno["establecimientosnacionales"][$ix]["shd1"] = $x["shd1"];
                                }
                                if (trim($x["shd2"]) != '') {
                                    $retorno["establecimientosnacionales"][$ix]["shd2"] = $x["shd2"];
                                }
                                if (trim($x["shd3"]) != '') {
                                    $retorno["establecimientosnacionales"][$ix]["shd3"] = $x["shd3"];
                                }
                                if (trim($x["shd4"]) != '') {
                                    $retorno["establecimientosnacionales"][$ix]["shd4"] = $x["shd4"];
                                }
                                $retorno["establecimientosnacionales"][$ix]["desactiv"] = trim($x["desc_Act_Econ"]);

                                //
                                $retorno["establecimientosnacionales"][$ix]["afiliado"] = trim($x["afiliado"]);
                                $retorno["establecimientosnacionales"][$ix]["tipolocal"] = trim($x["codigo_tipo_local"]);
                                $retorno["establecimientosnacionales"][$ix]["ctrubi"] = trim($x["codigo_ubicacion_empresa"]);
                            }
                        }
                    }
                }
            }
        }

        $retorno["lcodigosbarras"] = array();
        $arrX = retornarRegistrosMysqli2($mysqli, 'mreg_est_codigosbarras', "matricula='" . $reg["matricula"] . "'", "codigobarras");
        $ix = 0;
        if ($arrX && !empty($arrX)) {
            foreach ($arrX as $x) {
                if ($x["estadofinal"] == '01' || // Radicado
                        $x["estadofinal"] == '04' || // En estudio
                        $x["estadofinal"] == '09' || // Reingresado
                        $x["estadofinal"] == '10' || // Devuelto a reparto
                        $x["estadofinal"] == '11' || // Inscrito
                        $x["estadofinal"] == '13' || // Asignado a estudio
                        $x["estadofinal"] == '22' || // Registrado - proponentes
                        $x["estadofinal"] == '23' || // En digitacion
                        $x["estadofinal"] == '34' || // Para firma
                        $x["estadofinal"] == '35' || // Firmado
                        $x["estadofinal"] == '38' // Control de calidad
                ) {
                    $ix++;
                    $retorno["lcodigosbarras"][$ix]["cbar"] = $x["codigobarras"];
                    $retorno["lcodigosbarras"][$ix]["frad"] = $x["fecharadicacion"];
                    $retorno["lcodigosbarras"][$ix]["ttra"] = $x["actoreparto"];
                    $retorno["lcodigosbarras"][$ix]["esta"] = $x["estadofinal"];
                    $retorno["lcodigosbarras"][$ix]["nesta"] = '';
                    $retorno["lcodigosbarras"][$ix]["ntra"] = retornarRegistroMysqli2($mysqli, 'mreg_codrutas', "id='" . $retorno["lcodigosbarras"][$ix]["ttra"] . "'", "descripcion");
                    $retorno["lcodigosbarras"][$ix]["sist"] = retornarRegistroMysqli2($mysqli, 'mreg_codrutas', "id='" . $retorno["lcodigosbarras"][$ix]["ttra"] . "'", "tipo");
                    if (($retorno["lcodigosbarras"][$ix]["sist"] == 'ME') || ($retorno["lcodigosbarras"][$ix]["sist"] == 'ES') ||
                            ($retorno["lcodigosbarras"][$ix]["sist"] == 'RM') || ($retorno["lcodigosbarras"][$ix]["sist"] == 'RE')) {
                        $retorno["lcodigosbarras"][$ix]["nesta"] = retornarRegistroMysqli2($mysqli, 'mreg_codestados_rutamercantil', "id='" . $retorno["lcodigosbarras"][$ix]["esta"] . "'", "descripcion");
                    }
                    if ($retorno["lcodigosbarras"][$ix]["sist"] == 'PR') {
                        $retorno["lcodigosbarras"][$ix]["nesta"] = retornarRegistroMysqli2($mysqli, 'mreg_codestados_rutaproponentes', "id='" . $retorno["lcodigosbarras"][$ix]["esta"] . "'", "descripcion");
                    }
                    $retorno["codigosbarras"] ++;

                    // Si la ruta es un embargo
                    if ($x["actoreparto"] == '07') {
                        $retorno["embargostramite"] = 'S';
                    }

                    // Si la ruta es un recurso en trámite
                    if ($x["actoreparto"] == '19' || $x["actoreparto"] == '23' || $x["actoreparto"] == '54') {
                        $retorno["recursostramite"] = 'S';
                    }
                }
            }
        }

        // // \logSii2::general2($nameLog, $retorno["matricula"], 'Salió de codbarras pendientes : ' . date("His"));
        // Relación de inscripciones
        // // \logSii2::general2($nameLog, $retorno["matricula"], 'Entró a inscripciones : ' . date("His"));
        $retorno["inscripciones"] = array();
        $retorno["inscripcioneslibros"] = array();

        //
        $retorno["fechaperdidacalidadcomerciante"] = '';
        $retorno["perdidacalidadcomerciante"] = '';
        $retorno["reactivadaacto511"] = '';
        $retorno["fechaacto511"] = '';
        $retorno["fechadisolucion"] = '';
        $retorno["disueltaporacto510"] = '';
        $retorno["fechaacto510"] = '';
        $retorno["liquidada"] = '';

        //
        $ix = 0;
        $ixl = 0;

        //
        $enliquidacion = 'no';
        $enreestructuracion = 'no';
        $enreorganizacion = 'no';
        $enliquidacionjudicial = 'no';
        $enliquidacionforsoza = 'no';

        //

        $encontroconstitucion = 'NO';
        $arrX = retornarRegistrosMysqli2($mysqli, 'mreg_est_inscripciones', "matricula='" . ltrim(trim($reg["matricula"]), "0") . "'", "fecharegistro,libro,registro,dupli");
        if ($arrX && !empty($arrX)) {
            foreach ($arrX as $x) {
                $ix++;
                // 2017-11-08: JINT: Se incluye control de revocación solo a partir del 2017
                // dado que en SIREP este no está bien manejado y pone problemas con
                // inscripciones antiguas
                if ($x["fecharegistro"] < '20170101' && $x["ctrrevoca"] == '1') {
                    $x["ctrrevoca"] = '0';
                }
                if ($x["ctrrevoca"] != '1') {
                    $retorno["inscripciones"][$ix] = array();
                    $retorno["inscripciones"][$ix]["lib"] = $x["libro"];
                    $retorno["inscripciones"][$ix]["nreg"] = $x["registro"];
                    $retorno["inscripciones"][$ix]["dupli"] = $x["dupli"];
                    $retorno["inscripciones"][$ix]["freg"] = $x["fecharegistro"];
                    $retorno["inscripciones"][$ix]["hreg"] = $x["horaregistro"];
                    $retorno["inscripciones"][$ix]["frad"] = $x["fecharadicacion"];
                    $retorno["inscripciones"][$ix]["cb"] = $x["idradicacion"];
                    $retorno["inscripciones"][$ix]["rec"] = $x["recibo"];
                    $retorno["inscripciones"][$ix]["nope"] = $x["numerooperacion"];
                    $retorno["inscripciones"][$ix]["ope"] = $x["operador"];
                    $retorno["inscripciones"][$ix]["acto"] = $x["acto"];
                    $retorno["inscripciones"][$ix]["idclase"] = $x["tipoidentificacion"];
                    $retorno["inscripciones"][$ix]["numid"] = $x["identificacion"];
                    $retorno["inscripciones"][$ix]["nombre"] = $x["nombre"];
                    $retorno["inscripciones"][$ix]["ndocext"] = $x["numdocextenso"];
                    $retorno["inscripciones"][$ix]["ndoc"] = $x["numerodocumento"];
                    $retorno["inscripciones"][$ix]["tdoc"] = $x["tipodocumento"];
                    $retorno["inscripciones"][$ix]["fdoc"] = $x["fechadocumento"];
                    $retorno["inscripciones"][$ix]["idoridoc"] = $x["idorigendoc"];
                    $retorno["inscripciones"][$ix]["txoridoc"] = $x["origendocumento"];
                    $retorno["inscripciones"][$ix]["idmunidoc"] = $x["municipiodocumento"];
                    $retorno["inscripciones"][$ix]["idpaidoc"] = $x["paisdocumento"];
                    $retorno["inscripciones"][$ix]["tipolibro"] = $x["tipolibro"];
                    $retorno["inscripciones"][$ix]["idlibvii"] = $x["idcodlibro"];
                    $retorno["inscripciones"][$ix]["codlibcom"] = $x["codigolibro"];
                    $retorno["inscripciones"][$ix]["deslib"] = $x["descripcionlibro"];
                    $retorno["inscripciones"][$ix]["paginainicial"] = $x["paginainicial"];
                    $retorno["inscripciones"][$ix]["numhojas"] = $x["numeropaginas"];
                    $retorno["inscripciones"][$ix]["not"] = $x["noticia"];
                    $retorno["inscripciones"][$ix]["aclaratoria"] = '';
                    if (isset($x["aclaratoria"])) {
                        $retorno["inscripciones"][$ix]["aclaratoria"] = $x["aclaratoria"];
                    }
                    $retorno["inscripciones"][$ix]["not2"] = '';
                    $retorno["inscripciones"][$ix]["not3"] = '';
                    $retorno["inscripciones"][$ix]["crecu"] = $x["ctrrecurso"];
                    $retorno["inscripciones"][$ix]["cimg"] = '';
                    $retorno["inscripciones"][$ix]["cver"] = '';
                    $retorno["inscripciones"][$ix]["crot"] = $x["ctrrotulo"];
                    $retorno["inscripciones"][$ix]["crev"] = $x["ctrrevoca"];
                    $retorno["inscripciones"][$ix]["regrev"] = $x["registrorevocacion"];
                    $retorno["inscripciones"][$ix]["cnat"] = '';
                    $retorno["inscripciones"][$ix]["fir"] = $x["firma"];
                    $retorno["inscripciones"][$ix]["cfir"] = $x["clavefirmado"];
                    $retorno["inscripciones"][$ix]["uins"] = $x["usuarioinscribe"];
                    $retorno["inscripciones"][$ix]["ufir"] = $x["usuariofirma"];
                    $retorno["inscripciones"][$ix]["tnotemail"] = $x["timestampnotificacionemail"];
                    $retorno["inscripciones"][$ix]["tnotsms"] = $x["timestampnotificacionsms"];
                    $retorno["inscripciones"][$ix]["tnotemail"] = $x["idnotificacionemail"];
                    $retorno["inscripciones"][$ix]["tnotsms"] = $x["idnotificacionsms"];
                    $retorno["inscripciones"][$ix]["ipubrue"] = $x["idpublicacionrue"];
                    $retorno["inscripciones"][$ix]["fpubrue"] = $x["fecpublicacionrue"];

                    //
                    $retorno["inscripciones"][$ix]["camant"] = $x["camaraanterior"];
                    $retorno["inscripciones"][$ix]["libant"] = $x["libroanterior"];
                    $retorno["inscripciones"][$ix]["regant"] = $x["registroanterior"];
                    $retorno["inscripciones"][$ix]["fecant"] = $x["fecharegistroanterior"];

                    //
                    $retorno["inscripciones"][$ix]["camant2"] = $x["camaraanterior2"];
                    $retorno["inscripciones"][$ix]["libant2"] = $x["libroanterior2"];
                    $retorno["inscripciones"][$ix]["regant2"] = $x["registroanterior2"];
                    $retorno["inscripciones"][$ix]["fecant2"] = $x["fecharegistroanterior2"];

                    //
                    $retorno["inscripciones"][$ix]["camant3"] = $x["camaraanterior3"];
                    $retorno["inscripciones"][$ix]["libant3"] = $x["libroanterior3"];
                    $retorno["inscripciones"][$ix]["regant3"] = $x["registroanterior3"];
                    $retorno["inscripciones"][$ix]["fecant3"] = $x["fecharegistroanterior3"];

                    //
                    $retorno["inscripciones"][$ix]["est"] = $x["estado"];
                    if ($retorno["inscripciones"][$ix]["not"] == '') {
                        if (defined('CAMARA_SUR_OCCIDENTE') && CAMARA_SUR_OCCIDENTE == 'S') {
                            $retorno["inscripciones"][$ix]["not"] = construirNoticiaSurOccidenteSii2($mysqli, $x);
                        }
                        if ($retorno["inscripciones"][$ix]["not"] == '') {
                            $ind = $x["libro"] . '-' . $x["acto"];
                            $retorno["inscripciones"][$ix]["not"] = $_SESSION["maestroactos"][$ind]["nombre"];
                        }
                    }
                    $ind = $x["libro"] . '-' . $x["acto"];

                    $retorno["inscripciones"][$ix]["grupoacto"] = '';
                    $retorno["inscripciones"][$ix]["esreforma"] = '';
                    $retorno["inscripciones"][$ix]["esreformaespecial"] = '';
                    $retorno["inscripciones"][$ix]["actosistemaanterior"] = '';
                    if (isset($_SESSION["maestroactos"][$ind]) && isset($_SESSION["maestroactos"][$ind]["idgrupoacto"])) {
                        $retorno["inscripciones"][$ix]["grupoacto"] = $_SESSION["maestroactos"][$ind]["idgrupoacto"];
                        $retorno["inscripciones"][$ix]["esreforma"] = $_SESSION["maestroactos"][$ind]["controlreforma"];
                        $retorno["inscripciones"][$ix]["esreformaespecial"] = $_SESSION["maestroactos"][$ind]["controlreformaespecial"];
                        $retorno["inscripciones"][$ix]["actosistemaanterior"] = $x["actosistemaanterior"];
                    }

                    //
                    $retorno["inscripciones"][$ix]["actosistemaanterior"] = $x["actosistemaanterior"];

                    //
                    // Perdida de calidad de comerciante
                    if (isset($_SESSION["maestroactos"][$ind]) && $_SESSION["maestroactos"][$ind]["idgrupoacto"] == '071') {
                        $retorno["fechaperdidacalidadcomerciante"] = $x["fecharegistro"];
                        $retorno["perdidacalidadcomerciante"] = 'si';
                        if (ltrim(trim($x["fecharadicacion"]), "0") != '') {
                            $retorno["fechaperdidacalidadcomerciante"] = $x["fecharadicacion"];
                        } else {
                            $retorno["fechaperdidacalidadcomerciante"] = $x["fecharegistro"];
                        }
                    }

                    // Reactivación como comerciante 
                    if (isset($_SESSION["maestroactos"][$ind]) && $_SESSION["maestroactos"][$ind]["idgrupoacto"] == '073') {
                        $retorno["fechaperdidacalidadcomerciante"] = '';
                        $retorno["perdidacalidadcomerciante"] = '';
                    }

                    //
                    // Disolucion
                    if (
                            (isset($_SESSION["maestroactos"][$ind]) && isset($_SESSION["maestroactos"][$ind]["idgrupoacto"]) && $_SESSION["maestroactos"][$ind]["idgrupoacto"] == '009') ||
                            (isset($_SESSION["maestroactos"][$ind]) && $_SESSION["maestroactos"][$ind]["controldisolucion"] == 'S') ||
                            (isset($_SESSION["maestroactos"][$ind]) && $_SESSION["maestroactos"][$ind]["textoenliquidacion"] == 'L') ||
                            (isset($_SESSION["maestroactos"][$ind]) && $_SESSION["maestroactos"][$ind]["textoenliquidacion"] == 'S')
                    ) {
                        $retorno["reactivadaacto511"] = '';
                        $retorno["fechaacto511"] = '';
                        $retorno["fechadisolucion"] = $x["fecharegistro"];
                        $retorno["disueltaporacto510"] = 'si';
                        if ($x["fecharegistroanterior"] != '') {
                            $retorno["fechaacto510"] = $x["fecharegistroanterior"];
                        } else {
                            if (ltrim(trim($x["fecharadicacion"]), "0") != '') {
                                $retorno["fechaacto510"] = $x["fecharadicacion"];
                            } else {
                                $retorno["fechaacto510"] = $x["fecharegistro"];
                            }
                        }
                    }


                    // Reactivacion 
                    if (
                            (isset($_SESSION["maestroactos"][$ind]) && isset($_SESSION["maestroactos"][$ind]["idgrupoacto"]) && $_SESSION["maestroactos"][$ind]["idgrupoacto"] == '011') ||
                            (isset($_SESSION["maestroactos"][$ind]) && $_SESSION["maestroactos"][$ind]["controldisolucion"] == 'R') ||
                            (isset($_SESSION["maestroactos"][$ind]) && $_SESSION["maestroactos"][$ind]["textoenliquidacion"] == 'F') ||
                            (isset($_SESSION["maestroactos"][$ind]) && $_SESSION["maestroactos"][$ind]["textoenliquidacion"] == 'Q')
                    ) {
                        $retorno["fechadisolucion"] = '';
                        $retorno["disueltaporacto510"] = '';
                        $retorno["fechaacto510"] = '';
                        $retorno["reactivadaacto511"] = 'si';
                        $retorno["fechaacto511"] = $x["fecharegistro"];
                    }


                    // Constitucion      
                    if ($encontroconstitucion == 'NO') {
                        if (isset($_SESSION["maestroactos"][$ind]["idgrupoacto"]) && $_SESSION["maestroactos"][$ind]["idgrupoacto"] == '005') {
                            if ($x["tipodocumento"] == '06') {
                                if ($x["fecharegistroanterior"] != '') {
                                    $retorno["fechaconstitucion"] = $x["fecharegistroanterior"];
                                } else {
                                    $retorno["fechaconstitucion"] = $x["fecharegistro"];
                                }
                            } else {
                                $retorno["fechaconstitucion"] = $x["fechadocumento"];
                            }
                            $encontroconstitucion = 'SI';
                        }
                    }

                    // Cancelacion            
                    if ($retorno["estadomatricula"] == 'MC' || $retorno["estadomatricula"] == 'MF' || $retorno["estadomatricula"] == 'MG') {
                        if (isset($_SESSION["maestroactos"][$ind]) && $_SESSION["maestroactos"][$ind]["idgrupoacto"] == '002') {
                            $retorno["fechacancelacion"] = $x["fecharegistro"];
                        }
                    }

                    // liquidacion            
                    if (isset($_SESSION["maestroactos"][$ind]["idgrupoacto"]) && $_SESSION["maestroactos"][$ind]["idgrupoacto"] == '010') {
                        $retorno["fechaliquidacion"] = $x["fecharegistro"];
                        $retorno["liquidada"] = 'si';
                    }


                    // Libros de comercio
                    $eslib = 'no';
                    if ($x["libro"] == 'RM07' || $x["libro"] == 'RE52') {
                        if (ltrim(trim($x["acto"]), "0") == '') {
                            $eslib = 'si';
                        } else {
                            if (isset($_SESSION["maestroactos"][$ind]) && ($_SESSION["maestroactos"][$ind]["idgrupoacto"] == '004' ||
                                    $_SESSION["maestroactos"][$ind]["idgrupoacto"] == '059')) {
                                $eslib = 'si';
                            }
                        }
                    }
                    if ($x["libro"] == 'RM22') {
                        if (trim($x["acto"]) == '0003') {
                            if (isset($_SESSION["maestroactos"][$ind]) && ($_SESSION["maestroactos"][$ind]["idgrupoacto"] == '004' ||
                                    $_SESSION["maestroactos"][$ind]["idgrupoacto"] == '059')) {
                                $eslib = 'si';
                            }
                        }
                    }
                    if ($eslib == 'si') {
                        $ixl++;
                        $retorno["inscripcioneslibros"][$ixl] = array();
                        $retorno["inscripcioneslibros"][$ixl]["lib"] = $x["libro"];
                        $retorno["inscripcioneslibros"][$ixl]["nreg"] = $x["registro"];
                        $retorno["inscripcioneslibros"][$ixl]["dupli"] = $x["dupli"];
                        $retorno["inscripcioneslibros"][$ixl]["freg"] = $x["fecharegistro"];
                        $retorno["inscripcioneslibros"][$ixl]["hreg"] = $x["horaregistro"];
                        $retorno["inscripcioneslibros"][$ixl]["tipolibro"] = $x["tipolibro"];
                        $retorno["inscripcioneslibros"][$ixl]["idlibvii"] = $x["idcodlibro"];
                        $retorno["inscripcioneslibros"][$ixl]["codlibcom"] = $x["codigolibro"];
                        $retorno["inscripcioneslibros"][$ixl]["deslib"] = $x["descripcionlibro"];
                        $retorno["inscripcioneslibros"][$ixl]["paginainicial"] = $x["paginainicial"];
                        $retorno["inscripcioneslibros"][$ixl]["numhojas"] = $x["numeropaginas"];
                        $retorno["inscripcioneslibros"][$ixl]["not"] = $x["noticia"];
                        $retorno["inscripcioneslibros"][$ixl]["camant"] = $x["camaraanterior"];
                        $retorno["inscripcioneslibros"][$ixl]["libant"] = $x["libroanterior"];
                        $retorno["inscripcioneslibros"][$ixl]["regant"] = $x["registroanterior"];
                        $retorno["inscripcioneslibros"][$ixl]["fecant"] = $x["fecharegistroanterior"];
                        $retorno["inscripcioneslibros"][$ixl]["est"] = $x["estado"];
                        if ($retorno["inscripcioneslibros"][$ixl]["not"] == '') {
                            $retorno["inscripcioneslibros"][$ixl]["not"] = $_SESSION["maestroactos"][$x["libro"] . '-' . '0003']["nombre"];
                        }
                    }

                    //
                    if (isset($_SESSION["maestroactos"][$ind])) {
                        if ($_SESSION["maestroactos"][$ind]["textoenliquidacion"] == 'S') {
                            $enliquidacion = 'si';
                            $enreestructuracion = 'no';
                            $enreorganizacion = 'no';
                            $enliquidacionjudicial = 'no';
                            $enliquidacionforsoza = 'no';
                        }
                        if ($_SESSION["maestroactos"][$ind]["textoenliquidacion"] == 'L') {
                            $enliquidacionjudicial = 'si';
                            $enliquidacion = 'no';
                            $enreorganizacion = 'no';
                            $enreestructuracion = 'no';
                            $enliquidacionforsoza = 'no';
                        }
                        if ($_SESSION["maestroactos"][$ind]["textoenliquidacion"] == 'F') {
                            $enliquidacionforsoza = 'si';
                            $enliquidacion = 'no';
                            $enreorganizacion = 'no';
                            $enliquidacionjudicial = 'no';
                            $enreestructuracion = 'no';
                        }

                        if ($_SESSION["maestroactos"][$ind]["textoenliquidacion"] == 'Q') {
                            $enliquidacion = 'no';
                            $enliquidacionjudicial = 'no';
                            $enreestructuracion = 'no';
                            $enreorganizacion = 'no';
                            $enliquidacionforsoza = 'no';
                        }

                        if ($_SESSION["maestroactos"][$ind]["textoenreestructuracion"] == 'S') {
                            $enliquidacion = 'no';
                            $enliquidacionjudicial = 'no';
                            $enreestructuracion = 'si';
                            $enreorganizacion = 'no';
                        }
                        if ($_SESSION["maestroactos"][$ind]["textoenreestructuracion"] == 'L') {
                            $enliquidacion = 'no';
                            $enliquidacionjudicial = 'si';
                            $enreestructuracion = 'no';
                            $enreorganizacion = 'no';
                        }
                        if ($_SESSION["maestroactos"][$ind]["textoenreestructuracion"] == 'R') {
                            $enliquidacion = 'no';
                            $enliquidacionjudicial = 'no';
                            $enreestructuracion = 'no';
                            $enreorganizacion = 'si';
                        }

                        if ($_SESSION["maestroactos"][$ind]["textoenreestructuracion"] == 'Q') {
                            $enliquidacion = 'no';
                            $enliquidacionjudicial = 'no';
                            $enreestructuracion = 'no';
                            $enreorganizacion = 'no';
                        }
                    }
                }
            }
        }

        // 2017-08-21: JINT: Pone automáticamente la palabra EN LIQUIDACION y EN RESTRUCTURACION
        // Bien sea porque se vencieron los términos de duracion (Vigencia) o porque
        // encontro algún acto que indique que se debe colocar o no dicha palabra
        // Aplica solo para personas jurídica sprincipales
        // 2017-11-18: si debe adicionar palabras a la razón social, revisa primero
        // si existe contenido en el campo "complentorazonsocial"

        if ($retorno["estadomatricula"] != 'MC' && $retorno["estadomatricula"] != 'IC') {
            if ($retorno["organizacion"] == '01' ||
                    ($retorno["organizacion"] > '02' && $retorno["categoria"] == '1')) {
                $ya = 'no';
                if ($enliquidacion == 'si' ||
                        $enreestructuracion == 'si' ||
                        $enreorganizacion == 'si' ||
                        $enliquidacionjudicial == 'si' ||
                        $enliquidacionforsoza == 'si'
                ) {
                    if ($retorno["complementorazonsocial"] != '') {
                        $retorno["nombre"] .= ' ' . $retorno["complementorazonsocial"];
                        $ya = 'si';
                    }
                }
                if ($ya == 'no') {
                    if ($enliquidacion == 'si') {
                        $retorno["nombre"] .= ' EN LIQUIDACION';
                        $ya = 'si';
                    }
                    if ($enreestructuracion == 'si') {
                        $retorno["nombre"] .= ' EN REESTRUCTURACION';
                        $ya = 'si';
                    }
                    if ($enreorganizacion == 'si') {
                        $retorno["nombre"] .= ' EN REORGANIZACION';
                        $ya = 'si';
                    }
                    if ($enliquidacionjudicial == 'si') {
                        $retorno["nombre"] .= ' EN LIQUIDACION JUDICIAL';
                        $ya = 'si';
                    }
                    if ($enliquidacionforsoza == 'si') {
                        $retorno["nombre"] .= ' EN LIQUIDACION FORZOSA';
                        $ya = 'si';
                    }
                }
                if ($ya == 'no') {
                    if (trim($retorno["fechavencimiento"]) != '' && $retorno["fechavencimiento"] != '99999999') {
                        if (trim($retorno["fechavencimiento"]) < date("Ymd")) {
                            $retorno["nombre"] .= ' EN LIQUIDACION';
                            $ya = 'si';
                        }
                    }
                }
            }
        }

        // Relación de nombres anteriores
        // // \logSii2::general2($nameLog, $retorno["matricula"], 'Entró a nombres anteriores : ' . date("His"));
        $retorno["nomant"] = array();

        $arrX = retornarRegistrosMysqli2($mysqli, 'mreg_est_nombresanteriores', "matricula='" . $retorno["matricula"] . "'", "secuencia");
        $ix = 0;
        if ($arrX && !empty($arrX)) {
            foreach ($arrX as $x) {
                $ix++;
                $retorno["nomant"][$ix] = array();
                $retorno["nomant"][$ix]["sec"] = $ix;
                $retorno["nomant"][$ix]["lib"] = $x["libro"];
                $retorno["nomant"][$ix]["nreg"] = $x["registro"];
                $retorno["nomant"][$ix]["dup"] = $x["dupli"];
                $retorno["nomant"][$ix]["freg"] = $x["fechareg"];
                $retorno["nomant"][$ix]["nom"] = $x["nombre"];
                $retorno["nomant"][$ix]["ope"] = $x["operador"];
                $retorno["nomant"][$ix]["fcre"] = $x["fechacreacion"];
            }
        }
        // // \logSii2::general2($nameLog, $retorno["matricula"], 'Salió de nombres anteriores : ' . date("His"));
        // Relación de capitales
        // // \logSii2::general2($nameLog, $retorno["matricula"], 'Entró a capitales : ' . date("His"));
        $retorno["capitales"] = array();
        $arrX = retornarRegistrosMysqli2($mysqli, 'mreg_est_capitales', "matricula='" . ltrim(trim($retorno["matricula"]), "0") . "'", "anodatos,fechadatos");
        $icap = 0;
        if ($arrX && !empty($arrX)) {
            foreach ($arrX as $hcap) {
                $icap++;
                $retorno["capitales"][$icap]["anodatos"] = $hcap["anodatos"];
                $retorno["capitales"][$icap]["fechadatos"] = $hcap["fechadatos"];
                $retorno["capitales"][$icap]["libro"] = $hcap["libro"];
                $retorno["capitales"][$icap]["registro"] = $hcap["registro"];
                $retorno["capitales"][$icap]["tipoeconomia"] = $hcap["tipoeconomia"];
                $retorno["capitales"][$icap]["pornaltot"] = $hcap["pornaltot"];
                $retorno["capitales"][$icap]["pornalpri"] = $hcap["pornalpri"];
                $retorno["capitales"][$icap]["pornalpub"] = $hcap["pornalpub"];
                $retorno["capitales"][$icap]["porexttot"] = $hcap["porexttot"];
                $retorno["capitales"][$icap]["porextpri"] = $hcap["porextpri"];
                $retorno["capitales"][$icap]["porextpub"] = $hcap["porextpub"];
                $retorno["capitales"][$icap]["apoact"] = $hcap["aporteactivos"];
                $retorno["capitales"][$icap]["apodin"] = $hcap["aportedinero"];
                $retorno["capitales"][$icap]["apolab"] = $hcap["aportelaboral"];
                $retorno["capitales"][$icap]["apolabadi"] = $hcap["aportelaboraladi"];
                $retorno["capitales"][$icap]["suscrito"] = $hcap["valorsuscrito"];
                $retorno["capitales"][$icap]["autorizado"] = $hcap["valorautorizado"];
                $retorno["capitales"][$icap]["pagado"] = $hcap["valorpagado"];
                $retorno["capitales"][$icap]["social"] = $hcap["valorsocial"];
                $retorno["capitales"][$icap]["asigsuc"] = $hcap["capsucursal"];
                $retorno["capitales"][$icap]["cuosuscrito"] = $hcap["cuotassuscrito"];
                $retorno["capitales"][$icap]["cuoautorizado"] = $hcap["cuotasautorizado"];
                $retorno["capitales"][$icap]["cuopagado"] = $hcap["cuotaspagado"];
                $retorno["capitales"][$icap]["cuosocial"] = $hcap["cuotassocial"];

                // información de porcentajes de capital
                // $retorno["cap_porcnaltot"] = $hcap["pornaltot"];
                // $retorno["cap_porcnalpri"] = $hcap["pornalpri"];
                // $retorno["cap_porcnalpub"] = $hcap["pornalpub"];
                // $retorno["cap_porcexttot"] = $hcap["porexttot"];
                // $retorno["cap_porcextpri"] = $hcap["porextpri"];
                // $retorno["cap_porcextpub"] = $hcap["porextpub"];

                $retorno["cap_apolab"] = doubleval($hcap["aportelaboral"]);
                $retorno["cap_apolabadi"] = doubleval($hcap["aportelaboraladi"]);
                $retorno["cap_apoact"] = doubleval($hcap["aporteactivos"]);
                $retorno["cap_apodin"] = doubleval($hcap["aportedinero"]);

                $retorno["capsoc"] = $hcap["valorsocial"];
                $retorno["capaut"] = $hcap["valorautorizado"];
                $retorno["capsus"] = $hcap["valorsuscrito"];
                $retorno["cappag"] = $hcap["valorpagado"];
                $retorno["cuosoc"] = $hcap["cuotassocial"];
                $retorno["cuoaut"] = $hcap["cuotasautorizado"];
                $retorno["cuosus"] = $hcap["cuotassuscrito"];
                $retorno["cuopag"] = $hcap["cuotaspagado"];
                $retorno["capsuc"] = $hcap["capsucursal"];
            }
        }
        // // \logSii2::general2($nameLog, $retorno["matricula"], 'Salió de capitales : ' . date("His"));
        // Relación de capitales
        // // \logSii2::general2($nameLog, $retorno["matricula"], 'Entró a patrimonios : ' . date("His"));
        $retorno["patrimoniosesadl"] = array();
        $arrX = retornarRegistrosMysqli2($mysqli, 'mreg_est_patrimonios', "matricula='" . $retorno["matricula"] . "'", "anodatos,fechadatos");
        $icap = 0;
        if ($arrX && !empty($arrX)) {
            foreach ($arrX as $hcap) {
                $icap++;
                $retorno["patrimoniosesadl"][$icap]["anodatos"] = $hcap["anodatos"];
                $retorno["patrimoniosesadl"][$icap]["fechadatos"] = $hcap["fechadatos"];
                $retorno["patrimoniosesadl"][$icap]["patrimonio"] = $hcap["patrimonio"];
            }
        }
        // // \logSii2::general2($nameLog, $retorno["matricula"], 'Salió de patrimonios : ' . date("His"));
        // Información financiera histórica
        // // \logSii2::general2($nameLog, $retorno["matricula"], 'Entró histórico financiera : ' . date("His"));
        $retorno["hf"] = array();
        $ix = 0;
        $arrX = retornarRegistrosMysqli2($mysqli, 'mreg_est_financiera', "matricula='" . $retorno["matricula"] . "'", "anodatos,fechadatos");
        if ($arrX && !empty($arrX)) {
            foreach ($arrX as $regf) {
                $ix++;
                $retorno["hf"][$ix]["anodatos"] = $regf["anodatos"];
                $retorno["hf"][$ix]["fechadatos"] = $regf["fechadatos"];
                $retorno["hf"][$ix]["personal"] = $regf["personal"];
                $retorno["hf"][$ix]["personaltemp"] = $regf["pcttemp"];
                $retorno["hf"][$ix]["actvin"] = $regf["actvin"];
                $retorno["hf"][$ix]["actcte"] = $regf["actcte"];
                $retorno["hf"][$ix]["actnocte"] = $regf["actnocte"];
                $retorno["hf"][$ix]["actfij"] = $regf["actfij"];
                $retorno["hf"][$ix]["fijnet"] = $regf["fijnet"];
                $retorno["hf"][$ix]["actotr"] = $regf["actotr"];
                $retorno["hf"][$ix]["actval"] = $regf["actval"];
                $retorno["hf"][$ix]["acttot"] = $regf["acttot"];
                $retorno["hf"][$ix]["actsinaju"] = 0;
                $retorno["hf"][$ix]["invent"] = 0;
                $retorno["hf"][$ix]["pascte"] = $regf["pascte"];
                $retorno["hf"][$ix]["paslar"] = $regf["paslar"];
                $retorno["hf"][$ix]["pastot"] = $regf["pastot"];
                $retorno["hf"][$ix]["pattot"] = $regf["patnet"];
                $retorno["hf"][$ix]["paspat"] = $regf["paspat"];
                $retorno["hf"][$ix]["balsoc"] = $regf["balsoc"];
                $retorno["hf"][$ix]["ingope"] = $regf["ingope"];
                $retorno["hf"][$ix]["ingnoope"] = $regf["ingnoope"];
                $retorno["hf"][$ix]["gtoven"] = $regf["gasope"];
                $retorno["hf"][$ix]["gtoadm"] = $regf["gasadm"];
                $retorno["hf"][$ix]["cosven"] = $regf["cosven"];
                $retorno["hf"][$ix]["depamo"] = 0;
                $retorno["hf"][$ix]["gasint"] = $regf["gasint"];
                $retorno["hf"][$ix]["gasimp"] = $regf["gasimp"];
                $retorno["hf"][$ix]["utiope"] = $regf["utiope"];
                $retorno["hf"][$ix]["utinet"] = $regf["utinet"];
            }
        }
        unset($arrX);

        // // \logSii2::general2($nameLog, $retorno["matricula"], 'Salió histórico financiera : ' . date("His"));
        // Carga códigos CAE
        // // \logSii2::general2($nameLog, $retorno["matricula"], 'Entró a información CAE : ' . date("His"));
        $retorno["codigoscae"] = array();
        $arrY = retornarRegistrosMysqli2($mysqli, 'mreg_anexoscae', "1=1", "codigocae");
        if ($arrY && !empty($arrY)) {
            foreach ($arrY as $y) {
                $retorno["codigoscae"][$y["codigocae"]] = retornarRegistroMysqli2($mysqli, 'mreg_est_campostablas', "tabla='200' and registro='" . $retorno["matricula"] . "' and campo='" . $y["codigocae"] . "'", "contenido");
            }
        }

        // Carga información adicional
        $retorno["informacionadicional"] = array();
        $arrY = retornarRegistrosMysqli2($mysqli, 'mreg_campos_adicionales_camara', "1=1", "orden");
        if ($arrY && !empty($arrY)) {
            foreach ($arrY as $y) {
                $retorno["informacionadicional"][$y["codigoadicional"]] = retornarRegistroMysqli2($mysqli, 'mreg_est_campostablas', "tabla='200' and registro='" . $retorno["matricula"] . "' and campo='" . $y["codigoadicional"] . "'", "contenido");
            }
        }
        // // \logSii2::general2($nameLog, $retorno["matricula"], 'Salió de información CAE : ' . date("His"));
        // Certificas que se importaron del SIREP
        // // \logSii2::general2($nameLog, $retorno["matricula"], 'Entró a certificas SIREP: ' . date("His"));
        $retorno["crt"] = array();
        $arrTemC = retornarRegistrosMysqli2($mysqli, 'mreg_est_certificas', "matricula='" . ltrim($retorno["matricula"], "0") . "'", "idcertifica,id");
        if ($arrTemC && !empty($arrTemC)) {
            foreach ($arrTemC as $tx) {
                if (trim($tx["texto"]) != '') {
                    if (trim($tx["idcertifica"]) != '') {
                        if (!isset($retorno["crt"][trim($tx["idcertifica"])])) {
                            $retorno["crt"][trim($tx["idcertifica"])] = '';
                        }
                        $txt1 = \funcionesSii2::reemplazarAcutesSii2(\funcionesSii2::restaurarEspeciales(trim(str_replace("&rdquo;", '"', $tx["texto"]))));
                        $txt1 = str_replace("||", CHR(13) . CHR(10) . CHR(13) . CHR(10), $txt1);
                        $txt1 = str_replace("|", " ", $txt1);
                        $retorno["crt"][$tx["idcertifica"]] .= $txt1;
                    }
                }
            }
        }
        unset($arrTemC);
        // \logSii2::general2($nameLog, $retorno["matricula"], 'Salió de certificas SIREP: ' . date("His"));
        // Certificas que se han grabado en el SII
        // \logSii2::general2($nameLog, $retorno["matricula"], 'Entró a certificas SII: ' . date("His"));
        $retorno["crtsii"] = array();
        $arrTemC = retornarRegistrosMysqli2($mysqli, 'mreg_certificas_sii', "registro='REGMER' and expediente='" . ltrim($retorno["matricula"], "0") . "'", "idcertifica,id");
        if ($arrTemC && !empty($arrTemC)) {
            foreach ($arrTemC as $tx) {
                if (trim($tx["contenido"]) != '') {
                    if (!isset($retorno["crtsii"][$tx["idcertifica"]])) {
                        $retorno["crtsii"][$tx["idcertifica"]] = '';
                    }
                    $txt1 = \funcionesSii2::reemplazarAcutesSii2(\funcionesSii2::restaurarEspeciales(trim(str_replace("&rdquo;", '"', $tx["contenido"]))));
                    $txt1 = str_replace("||", CHR(13) . CHR(10) . CHR(13) . CHR(10), $txt1);
                    $txt1 = str_replace("|", " ", $txt1);
                    $retorno["crtsii"][$tx["idcertifica"]] .= $txt1;
                }
            }
        }
        unset($arrTemC);
        // \logSii2::general2($nameLog, $retorno["matricula"], 'Salió de certificas SII: ' . date("His"));
        // Carga relación de embargos
        // \logSii2::general2($nameLog, $retorno["matricula"], 'Entró a embargos: ' . date("His"));
        $retorno["embargos"] = 0;
        $retorno["ctrembargos"] = array();
        $i = 0;
        $arrTemE = retornarRegistrosMysqli2($mysqli, 'mreg_est_embargos', "matricula='" . $retorno["matricula"] . "'", "libro,numreg");
        if ($arrTemE === false) {
            echo $_SESSION["generales"]["mensajeerror"];
        }
        if ($arrTemE && !empty($arrTemE)) {
            foreach ($arrTemE as $e) {
                $i++;
                $retorno["ctrembargos"][$i] = array();
                $retorno["ctrembargos"][$i]["acto"] = $e["acto"];
                $retorno["ctrembargos"][$i]["idclase"] = $e["idclase"];
                $retorno["ctrembargos"][$i]["numid"] = $e["numid"];
                $retorno["ctrembargos"][$i]["nombre"] = stripslashes($e["nombredemandante"]);
                $retorno["ctrembargos"][$i]["idclasedemandante"] = $e["idclasedemandante"];
                $retorno["ctrembargos"][$i]["numiddemandante"] = $e["numiddemandante"];
                $retorno["ctrembargos"][$i]["nombredemandante"] = stripslashes($e["nombredemandante"]);
                $retorno["ctrembargos"][$i]["tipdoc"] = $e["tipdoc"];
                $retorno["ctrembargos"][$i]["numdoc"] = $e["numdoc"];
                $retorno["ctrembargos"][$i]["fecdoc"] = $e["fecdoc"];
                $retorno["ctrembargos"][$i]["idorigen"] = $e["idorigen"];
                $retorno["ctrembargos"][$i]["txtorigen"] = stripslashes($e["txtorigen"]);
                $retorno["ctrembargos"][$i]["fecrad"] = $e["fecradica"];
                $retorno["ctrembargos"][$i]["estado"] = $e["ctrestadoembargo"];
                if (strlen($e["libro"]) == 2) {
                    if (trim($e["libro"]) < '50') {
                        $retorno["ctrembargos"][$i]["libro"] = 'RM' . $e["libro"];
                    } else {
                        $retorno["ctrembargos"][$i]["libro"] = 'RE' . $e["libro"];
                    }
                } else {
                    $retorno["ctrembargos"][$i]["libro"] = $e["libro"];
                }
                $retorno["ctrembargos"][$i]["numreg"] = $e["numreg"];
                $retorno["ctrembargos"][$i]["codbarras"] = $e["codbarras"];
                $retorno["ctrembargos"][$i]["noticia"] = stripslashes($e["noticia"]);
                $retorno["ctrembargos"][$i]["fecinscripcion"] = $e["fecinscripcion"];
                $retorno["ctrembargos"][$i]["esembargo"] = '';

                $ind = $retorno["ctrembargos"][$i]["libro"] . '-' . $e["acto"];
                if (isset($_SESSION["maestroactos"][$ind])) {
                    if ($_SESSION["maestroactos"][$ind]["idgrupoacto"] == '018') {
                        $retorno["ctrembargos"][$i]["esembargo"] = 'S';
                        if ($e["ctrestadoembargo"] != '2') {
                            $retorno["embargos"] ++;
                        }
                    }
                }
            }
        }
        // echo count ($retornos["ctrembargos"]);
        unset($arrTemE);
        // \logSii2::general2($nameLog, $retorno["matricula"], 'Salió de embargos: ' . date("His"));
        // Relación de pagos de afiliacion
        // \logSii2::general2($nameLog, $retorno["matricula"], 'Entró a historico afiliacion: ' . date("His"));
        $retorno["periodicoafiliados"] = array(); // Calcular
        $arrX = retornarRegistrosMysqli2($mysqli, 'mreg_est_afiliados_pagos', "matricula='" . $retorno["matricula"] . "'", "fec_pago");
        $ix = 0;
        if ($arrX && !empty($arrX)) {
            foreach ($arrX as $x) {
                $ix++;
                $retorno["periodicoafiliados"][$ix] = array();
                $retorno["periodicoafiliados"][$ix]["fec_pago"] = $x["fec_pago"];
                $retorno["periodicoafiliados"][$ix]["tip_pago"] = $x["tip_pago"];
                $retorno["periodicoafiliados"][$ix]["ano_pagado"] = $x["ano_pagado"];
                $retorno["periodicoafiliados"][$ix]["recibo"] = $x["recibo"];
                $retorno["periodicoafiliados"][$ix]["operacion"] = $x["operacion"];
                $retorno["periodicoafiliados"][$ix]["valor"] = $x["valor"];
                $retorno["periodicoafiliados"][$ix]["eliminado"] = $x["eliminado"];
            }
        }
        unset($arrX);
        // \logSii2::general2($nameLog, $retorno["matricula"], 'Salió de  historico afiliacion: ' . date("His"));
        // Relacion de anexos documentales
        // \logSii2::general2($nameLog, $retorno["matricula"], 'Entró a imagenes: ' . date("His"));
        $retorno["imagenes"] = array();
        if ($tipodata == 'E') {
            $imgs = array();
            if ($retorno["tipoidentificacion"] == '7') {
                $idex = '';
            } else {
                $idex = ltrim(trim($retorno["identificacion"]), "0");
                if (strlen($idex) < 5) {
                    $idex = '';
                }
            }
            // \logSii2::general2($nameLog, $retorno["matricula"], 'Entró buscar imagenes: ' . date("His"));
            if ($idex != '') {
                $imgs = retornarRegistrosMysqli2($mysqli, 'mreg_radicacionesanexos', "eliminado<>'SI' and (matricula='" . ltrim($retorno["matricula"], "0") . "' or identificacion like '" . $idex . "%')", "idanexo");
            } else {
                if (ltrim($retorno["matricula"], "0") != '') {
                    $imgs = retornarRegistrosMysqli2($mysqli, 'mreg_radicacionesanexos', "eliminado<>'SI' and matricula='" . ltrim($retorno["matricula"], "0") . "'", "idanexo");
                }
            }
            // \logSii2::general2($nameLog, $retorno["matricula"], 'Salió de buscar imagenes: ' . date("His"));
            if ($imgs) {
                if (!empty($imgs)) {
                    $i = 0;
                    foreach ($imgs as $img) {
                        if ($img["tipoanexo"] != '509' && $img["eliminado"] != 'SI') {
                            $i++;
                            $retorno["imagenes"][$i] = $img;

                            if (trim($img["bandeja"]) == '') {
                                $tx = retornarRegistroMysqli2($mysqli, 'bas_tipodoc', "idtipodoc='" . $img["idtipodoc"] . "'");
                                if ($tx === false || empty($tx)) {
                                    $retorno["imagenes"][$i]["bandeja"] = '';
                                } else {
                                    $retorno["imagenes"][$i]["bandeja"] = $tx["bandejadigitalizacion"];
                                }
                            }
                            if (trim($img["bandeja"]) == '') {
                                if (trim($img["libro"]) != '') {
                                    if (strlen(trim($img["libro"])) < 3) {
                                        if (sprintf("%02s", $img["libro"]) < '50') {
                                            $retorno["imagenes"][$i]["bandeja"] = '4.-REGMER';
                                        } else {
                                            $retorno["imagenes"][$i]["bandeja"] = '5.-REGESADL';
                                        }
                                    } else {
                                        if (substr($img["libro"], 2, 2) < '50') {
                                            $retorno["imagenes"][$i]["bandeja"] = '4.-REGMER';
                                        } else {
                                            $retorno["imagenes"][$i]["bandeja"] = '5.-REGESADL';
                                        }
                                    }
                                }
                            }
                            $obs = '';
                            $fechamostrar = '';

                            if (trim($img["libro"]) != '' && trim($img["registro"]) != '') {
                                if (strlen(trim($img["libro"])) < 3) {
                                    if (sprintf("%02s", $img["libro"]) < '50') {
                                        $txLib = 'RM' . sprintf("%02s", trim($img["libro"]));
                                    } else {
                                        $txLib = 'RE' . sprintf("%02s", trim($img["libro"]));
                                    }
                                } else {
                                    $txLib = trim($img["libro"]);
                                }
                                $condic = "libro='" . $txLib . "' and registro='" . ltrim($img["registro"], "0") . "'";
                                $temIns = retornarRegistroMysqli2($mysqli, 'mreg_est_inscripciones', $condic);
                                if ($temIns && !empty($temIns)) {
                                    $obs = '<strong>Inscripción No. </strong>' . $txLib . '-' . $img["registro"];
                                    if ($temIns["noticia"] != '') {
                                        if (trim($obs) != '') {
                                            $obs .= '<br>';
                                        }
                                        $obs .= $temIns["noticia"];
                                    }
                                    $fechamostrar = $temIns["fecharegistro"];
                                }
                            } else {
                                if (ltrim($img["idradicacion"], "0") != '') {
                                    $fechamostrar = retornarRegistroMysqli2($mysqli, 'mreg_est_codigosbarras', "codigobarras='" . ltrim($img["idradicacion"], "0") . "'", "fecharadicacion");
                                    $actorep = retornarRegistroMysqli2($mysqli, 'mreg_est_codigosbarras', "codigobarras='" . ltrim($img["idradicacion"], "0") . "'", "actoreparto");
                                    if ($actorep != '') {
                                        if (trim($obs) != '') {
                                            $obs .= '<br>';
                                        }
                                        $obs .= retornarRegistroMysqli2($mysqli, 'mreg_codrutas', "id='" . $actorep . "'", "descripcion");
                                    }
                                } else {
                                    if (trim($img["numerorecibo"]) != '') {
                                        $fechamostrar = retornarRegistroMysqli2($mysqli, 'mreg_est_recibos', "numerorecibo='" . trim($img["numerorecibo"]) . "'", "fecoperacion");
                                        $actorep = retornarRegistroMysqli2($mysqli, 'mreg_est_recibos', "numerorecibo='" . trim($img["numerorecibo"]) . "'", "servicio");
                                        if ($actorep != '') {
                                            if (trim($obs) != '') {
                                                $obs .= '<br>';
                                            }
                                            $obs .= retornarRegistroMysqli2($mysqli, 'mreg_servicios', "idservicio='" . $actorep . "'", "nombre");
                                        }
                                    }
                                }
                            }

                            if (trim($img["idtipodoc"]) != '') {
                                if ($obs != '') {
                                    $obs .= '<br>';
                                }
                                $obs .= '<strong>Tipo documental : </strong>(' . $img["idtipodoc"] . ') ' . utf8_encode(retornarRegistroMysqli2($mysqli, 'bas_tipodoc', "idtipodoc='" . trim($img["idtipodoc"]) . "'", "descripcion"));
                            }

                            if (trim($img["libro"]) == '') {
                                if (trim($img["observaciones"]) != '') {
                                    if ($obs != '') {
                                        $obs .= '<br>';
                                    }
                                    $obs .= $img["observaciones"];
                                }
                            }
                            if ($fechamostrar == '') {
                                $fechamostrar = $img["fechadoc"];
                            }
                            $retorno["imagenes"][$i]["obs"] = $obs;
                            $retorno["imagenes"][$i]["fmostrar"] = $fechamostrar;
                        }
                    }
                    $retorno["imagenes"] = \funcionesSii2::ordenarMatriz($retorno["imagenes"], "fmostrar", true);
                }
            }
        }
        // \logSii2::general2($nameLog, $retorno["matricula"], 'Salió de imagenes: ' . date("His"));
        // Confirma si tiene o no beneficio de la Ley 1780
        // Aplica para el 2017
        if (date("Y") == '2017') {
            if ($retorno["organizacion"] == '01' || ($retorno["organizacion"] > '02' && $retorno["categoria"] == '1')) {
                if ($retorno["fechamatricula"] >= '20160502') {
                    if ($retorno["benley1780"] == '') {
                        if (contarRegistrosMysqli2($mysqli, 'mreg_est_recibos', "matricula='" . $retorno["matricula"] . "' and servicio='01090110' and (fecoperacion between '20160101' and '20161231')") > 0) {
                            $retorno["benley1780"] = 'S';
                        }
                    }
                }
            }
        }

        // Aplica para el 2018
        if (date("Y") == '2018') {
            if ($retorno["organizacion"] == '01' || ($retorno["organizacion"] > '02' && $retorno["categoria"] == '1')) {
                if ($retorno["fechamatricula"] >= '20170101') {
                    if ($retorno["benley1780"] == '') {
                        if (contarRegistrosMysqli2($mysqli, 'mreg_est_recibos', "matricula='" . $retorno["matricula"] . "' and (servicio IN ('01090110','01090111')) and (fecoperacion between '20170101' and '20171231')") > 0) {
                            $retorno["benley1780"] = 'S';
                        }
                    }
                }
            }
        }


        // 2017-09-26: jint : DATOS DEL CAE
        $retorno["placaalcaldia"] = '';
        $retorno["placaalcaldiafecha"] = '';
        $retorno["reportealcaldia"] = '';

        $temx = retornarRegistroMysqli2($mysqli, 'mreg_alcaldias', "idmunicipio='" . trim($retorno["muncom"]) . "'");
        if ($temx && !empty($temx)) {
            if ($temx["eliminado"] != 'SI') {
                if ($temx["fechainicio"] <= $retorno["fechamatricula"]) {
                    $retorno["reportealcaldia"] = 'si';
                }
            }
        }
        unset($temx);

        if ($retorno["reportealcaldia"] == 'si') {
            $temx = retornarRegistroMysqli2($mysqli, 'mreg_matriculasalcaldia', "idmatricula='" . ltrim($retorno["matricula"], "0") . "'");
            if ($temx && !empty($temx)) {
                $retorno["placaalcaldia"] = trim($temx["matriculaic"]);
                $retorno["placaalcaldiafecha"] = trim($temx["fechamatriculaic"]);
            }
            unset($temx);
        }

        //
        unset($reg);


        // Cierra la conexión con MYSQL
        if ($dbx === null) {
            $mysqli->close();
        }

        // Retorna la respuesta
        if ($mat != '') {
            $_SESSION["expedienteactual"][ltrim(trim($mat), "0")] = $retorno;
        }
        return $retorno;
    }

    public static function retornarDescripcionCiiu($dbx, $ciiu = '', $version = '*') {
        if ($version == '*' || $version == '4') {
            $result = retornarRegistroMysqli2($dbx, 'bas_ciius', "idciiu='" . trim($ciiu) . "'");
        }
        if ($version == '3.1') {
            $result = retornarRegistroMysqli2($dbx, 'bas_ciius_3_1', "idciiu='" . trim($ciiu) . "'");
        }

        $retornar = '';
        if ($result && !empty($result)) {
            $retornar = $result["descripcion"];
        }
        unset($result);
        return $retornar;
    }

    public static function retornarGrupoNiifFormulario($dbx, $id) {
        $res = retornarRegistroMysqli2($dbx, 'bas_gruponiif', "id='" . $id . "'");
        return $res["idformulario"];
    }

    public static function retornarGrupoNiifFormularioDescripcion($dbx, $id) {
        $res = retornarRegistroMysqli2($dbx, 'bas_gruponiif', "id='" . $id . "'");
        return str_replace(array("1.- ", "2.- ", "3.- ", "4.- ", "5.- ", "6.- ", "7.- "), "", $res["descripcion"]);
    }

    public static function imprimeArray($arreglo = array(), $finaliza = true) {
        echo "<pre>";
        print_r($arreglo);
        echo "</pre>";

        if ($finaliza) {
            die();
        }
    }

    public static function retornarMregLiquidacionSii($dbx, $numliq, $tipo = 'L') {

        // Inicializa las variables del tr&aacute;mite
        $respuesta = array();
        $respuesta["idliquidacion"] = 0;
        $respuesta["numeroliquidacion"] = 0;
        $respuesta["fecha"] = '';
        $respuesta["hora"] = '';
        $respuesta["idusuario"] = '';
        $respuesta["sede"] = '';
        $respuesta["tipotramite"] = '';
        $respuesta["subtipotramite"] = '';
        $respuesta["tiporenovacion"] = '';
        $respuesta["origen"] = '';
        $respuesta["iptramite"] = '';
        $respuesta["idestado"] = '';
        $respuesta["txtestado"] = '';
        $respuesta["idexpedientebase"] = '';
        $respuesta["idmatriculabase"] = '';
        $respuesta["idproponentebase"] = '';
        $respuesta["tipoproponente"] = '';
        $respuesta["tipoidentificacionbase"] = '';
        $respuesta["identificacionbase"] = '';
        $respuesta["nombrebase"] = '';
        $respuesta["nom1base"] = '';
        $respuesta["nom2base"] = '';
        $respuesta["ape1base"] = '';
        $respuesta["ape2base"] = '';
        $respuesta["organizacionbase"] = '';
        $respuesta["categoriabase"] = '';
        $respuesta["afiliadobase"] = '';
        $respuesta["matriculabase"] = '';
        $respuesta["proponentebase"] = '';

        $respuesta["numeromatriculapnat"] = '';
        $respuesta["camarapnat"] = '';
        $respuesta["orgpnat"] = '';
        $respuesta["tipoidepnat"] = '';
        $respuesta["idepnat"] = '';
        $respuesta["nombrepnat"] = '';

        //
        $respuesta["nombreest"] = '';
        $respuesta["nombrepjur"] = '';
        $respuesta["nombresuc"] = '';
        $respuesta["nombreage"] = '';

        $respuesta["orgpjur"] = '';
        $respuesta["orgsuc"] = '';
        $respuesta["orgage"] = '';

        $respuesta["actpnat"] = '';
        $respuesta["actpjur"] = '';
        $respuesta["actest"] = '';
        $respuesta["actsuc"] = '';
        $respuesta["actage"] = '';

        $respuesta["perpnat"] = '';
        $respuesta["perpjur"] = '';

        $respuesta["munpnat"] = '';
        $respuesta["munest"] = '';
        $respuesta["munpjur"] = '';
        $respuesta["munsuc"] = '';
        $respuesta["munage"] = '';

        $respuesta["ultanoren"] = '';
        $respuesta["domicilioorigen"] = '';
        $respuesta["domiciliodestino"] = '';


        $respuesta["tipocliente"] = '';
        $respuesta["idtipoidentificacioncliente"] = '';
        $respuesta["identificacioncliente"] = '';
        $respuesta["nombrecliente"] = '';
        $respuesta["apellidocliente"] = '';

        $respuesta["razonsocialcliente"] = '';
        $respuesta["nombre1cliente"] = '';
        $respuesta["nombre2cliente"] = '';
        $respuesta["apellido1cliente"] = '';
        $respuesta["apellido2cliente"] = '';

        $respuesta["email"] = '';
        $respuesta["direccion"] = '';
        $respuesta["idmunicipio"] = '';
        $respuesta["telefono"] = '';
        $respuesta["movil"] = '';

        $respuesta["tipopagador"] = '';
        $respuesta["nombrepagador"] = '';
        $respuesta["apellidopagador"] = '';

        $respuesta["razonsocialpagador"] = '';
        $respuesta["nombre1pagador"] = '';
        $respuesta["nombre2pagador"] = '';
        $respuesta["apellido1pagador"] = '';
        $respuesta["apellido2pagador"] = '';

        $respuesta["tipoidentificacionpagador"] = '';
        $respuesta["identificacionpagador"] = '';
        $respuesta["direccionpagador"] = '';
        $respuesta["telefonopagador"] = '';
        $respuesta["movilpagador"] = '';
        $respuesta["municipiopagador"] = '';
        $respuesta["emailpagador"] = '';

        $respuesta["valorbruto"] = 0;
        $respuesta["valorbaseiva"] = 0;
        $respuesta["valoriva"] = 0;
        $respuesta["valortotal"] = 0;
        $respuesta["idsolicitudpago"] = 0;
        $respuesta["pagoefectivo"] = 0;
        $respuesta["pagocheque"] = 0;
        $respuesta["pagoconsignacion"] = 0;
        $respuesta["pagovisa"] = 0;
        $respuesta["pagoach"] = 0;
        $respuesta["pagomastercard"] = 0;
        $respuesta["pagoamerican"] = 0;
        $respuesta["pagocredencial"] = 0;
        $respuesta["pagodiners"] = 0;
        $respuesta["pagotdebito"] = 0;
        $respuesta["pagoprepago"] = 0;
        $respuesta["pagoafiliado"] = 0;
        $respuesta["idformapago"] = '';
        $respuesta["numerorecibo"] = '';
        $respuesta["numerooperacion"] = '';
        $respuesta["fecharecibo"] = '';
        $respuesta["horarecibo"] = '';
        $respuesta["idfranquicia"] = '';
        $respuesta["nombrefranquicia"] = '';
        $respuesta["numeroautorizacion"] = '';
        $respuesta["idcodban"] = '';
        $respuesta["nombrebanco"] = '';
        $respuesta["numerocheque"] = '';
        $respuesta["numerorecuperacion"] = '';
        $respuesta["numeroradicacion"] = '';
        $respuesta["alertaid"] = 0;
        $respuesta["alertaservicio"] = '';
        $respuesta["alertavalor"] = 0;
        $respuesta["ctrcancelacion"] = '';
        $respuesta["idasesor"] = '';
        $respuesta["numeroempleados"] = 0;
        $respuesta["pagoafiliacion"] = '';
        $respuesta["numerofactura"] = '';

        $respuesta["incluirformularios"] = '';
        $respuesta["incluircertificados"] = '';
        $respuesta["incluirdiploma"] = '';
        $respuesta["incluircartulina"] = '';
        $respuesta["matricularpnat"] = '';
        $respuesta["matricularest"] = '';
        $respuesta["regimentributario"] = '';
        $respuesta["tipomatricula"] = '';
        $respuesta["camaracambidom"] = '';
        $respuesta["matriculacambidom"] = '';
        $respuesta["municipiocambidom"] = '';
        $respuesta["fecmatcambidom"] = '';
        $respuesta["fecrencambidom"] = '';
        $respuesta["benart7"] = 'N';
        $respuesta["benley1780"] = 'N';
        $respuesta["controlfirma"] = 'N';
        $respuesta["actualizacionciiuversion4"] = '';
        $respuesta["reliquidacion"] = '';
        $respuesta["cumplorequisitosbenley1780"] = '';
        $respuesta["mantengorequisitosbenley1780"] = '';
        $respuesta["renunciobeneficiosley1780"] = '';
        $respuesta["multadoponal"] = '';
        $respuesta["controlaactividadaltoimpacto"] = '';

        $respuesta["capital"] = 0;
        $respuesta["tipodoc"] = '';
        $respuesta["numdoc"] = '';
        $respuesta["fechadoc"] = '';
        $respuesta["origendoc"] = '';
        $respuesta["mundoc"] = '';
        $respuesta["organizacion"] = '';
        $respuesta["categoria"] = '';

        $respuesta["tipoiderepleg"] = '';
        $respuesta["iderepleg"] = '';
        $respuesta["nombre1repleg"] = '';
        $respuesta["nombre2repleg"] = '';
        $respuesta["apellido1repleg"] = '';
        $respuesta["apellido2repleg"] = '';
        $respuesta["cargorepleg"] = ''; //
        $respuesta["emailrepleg"] = ''; //
        $respuesta["firmorepleg"] = ''; //
        $respuesta["celularrepleg"] = ''; //

        $respuesta["tipoideradicador"] = '';
        $respuesta["ideradicador"] = '';
        $respuesta["nombreradicador"] = '';
        $respuesta["fechaexpradicador"] = '';
        $respuesta["emailradicador"] = '';
        $respuesta["telefonoradicador"] = '';
        $respuesta["celularradicador"] = '';

        $respuesta["tipolibro"] = ''; //
        $respuesta["codigolibro"] = ''; //
        $respuesta["primeravez"] = ''; //
        $respuesta["confirmadigital"] = ''; //

        $respuesta["iderevfis"] = ''; //
        $respuesta["nombre1revfis"] = ''; //
        $respuesta["nombre2revfis"] = ''; //
        $respuesta["apellido1revfis"] = ''; //
        $respuesta["apellido2revfis"] = ''; //
        $respuesta["cargorevfis"] = ''; //
        $respuesta["emailrevfis"] = ''; //
        $respuesta["firmorevfis"] = ''; //
        $respuesta["celularrevfis"] = ''; //

        $respuesta["idepreasa"] = ''; //
        $respuesta["nombre1preasa"] = ''; //
        $respuesta["nombre2preasa"] = ''; //
        $respuesta["apellido1preasa"] = ''; //
        $respuesta["apellido2preasa"] = ''; //
        $respuesta["cargopreasa"] = ''; //
        $respuesta["emailpreasa"] = ''; //
        $respuesta["firmopreasa"] = ''; //
        $respuesta["celularpreasa"] = ''; //

        $respuesta["idesecasa"] = ''; //
        $respuesta["nombre1secasa"] = ''; //
        $respuesta["nombre2secasa"] = ''; //    
        $respuesta["apellido1secasa"] = ''; //
        $respuesta["apellido2secasa"] = ''; //
        $respuesta["cargosecasa"] = ''; //
        $respuesta["emailsecasa"] = ''; //
        $respuesta["firmosecasa"] = ''; //
        $respuesta["celularsecasa"] = ''; //

        $respuesta["tipoidentificacionaceptante"] = '';
        $respuesta["identificacionaceptante"] = '';
        $respuesta["nombre1aceptante"] = '';
        $respuesta["nombre2aceptante"] = '';
        $respuesta["apellido1aceptante"] = '';
        $respuesta["apellido2aceptante"] = '';
        $respuesta["direccionaceptante"] = '';
        $respuesta["municipioaceptante"] = '';
        $respuesta["emailaceptante"] = '';
        $respuesta["telefonoaceptante"] = '';
        $respuesta["celularaceptante"] = '';
        $respuesta["cargoaceptante"] = '';
        $respuesta["fechadocideaceptante"] = '';

        $respuesta["motivocorreccion"] = '';
        $respuesta["tipoerror1"] = '';
        $respuesta["tipoerror2"] = '';
        $respuesta["tipoerror3"] = '';
        $respuesta["tipoidentificacioncor"] = '';
        $respuesta["nombre1cor"] = '';
        $respuesta["nombre2cor"] = '';
        $respuesta["apellido1cor"] = '';
        $respuesta["apellido2cor"] = '';
        $respuesta["direccioncor"] = '';
        $respuesta["municipiocor"] = '';
        $respuesta["emailcor"] = '';
        $respuesta["telefonocor"] = '';
        $respuesta["celularcor"] = '';


        $respuesta["descripcionembargo"] = '';
        $respuesta["descripciondesembargo"] = '';
        $respuesta["tipoidentificaciondemandante"] = '';
        $respuesta["identificaciondemandante"] = '';
        $respuesta["nombredemandante"] = '';
        $respuesta["libro"] = '';
        $respuesta["numreg"] = '';

        $respuesta["descripcionpqr"] = '';
        $respuesta["tipoidentificacionpqr"] = '';
        $respuesta["nombre1pqr"] = '';
        $respuesta["nombre2pqr"] = '';
        $respuesta["apellido1pqr"] = '';
        $respuesta["apellido2pqr"] = '';
        $respuesta["direccionpqr"] = '';
        $respuesta["municipiopqr"] = '';
        $respuesta["emailpqr"] = '';
        $respuesta["telefonopqr"] = '';
        $respuesta["celularpqr"] = '';

        $respuesta["descripcionrr"] = '';
        $respuesta["tipoidentificacionrr"] = '';
        $respuesta["nombre1rr"] = '';
        $respuesta["nombre2rr"] = '';
        $respuesta["apellido1rr"] = '';
        $respuesta["apellido2rr"] = '';
        $respuesta["direccionrr"] = '';
        $respuesta["municipiorr"] = '';
        $respuesta["emailrr"] = '';
        $respuesta["telefonorr"] = '';
        $respuesta["celularrr"] = '';

        $respuesta["tipocertificado"] = '';
        $respuesta["explicacion"] = '';
        $respuesta["textolibre"] = '';

        $respuesta["proyectocaja"] = '001';
        $respuesta["cargoafiliacion"] = 'NO';
        $respuesta["cargogastoadministrativo"] = 'NO';
        $respuesta["cargoentidadoficial"] = 'NO';
        $respuesta["cargoconsulta"] = 'NO';

        $respuesta["opcionafiliado"] = '';
        $respuesta["saldoafiliado"] = 0;
        $respuesta["matriculaafiliado"] = '';
        $respuesta["ultanorenafi"] = '';

        // Mutaciones
        $respuesta["modcom"] = '';
        $respuesta["modnot"] = '';
        $respuesta["modciiu"] = '';
        $respuesta["modnombre"] = '';

        $respuesta["nombreanterior"] = '';
        $respuesta["nombrenuevo"] = '';

        $respuesta["ant_versionciiu"] = '';
        $respuesta["ant_ciiu11"] = '';
        $respuesta["ant_ciiu12"] = '';
        $respuesta["ant_ciiu13"] = '';
        $respuesta["ant_ciiu14"] = '';
        $respuesta["ant_ciiu21"] = '';
        $respuesta["ant_ciiu22"] = '';
        $respuesta["ant_ciiu23"] = '';
        $respuesta["ant_ciiu24"] = '';
        $respuesta["ant_dircom"] = '';
        $respuesta["ant_telcom1"] = '';
        $respuesta["ant_telcom2"] = '';
        $respuesta["ant_faxcom"] = '';
        $respuesta["ant_celcom"] = '';
        $respuesta["ant_muncom"] = '';
        $respuesta["ant_barriocom"] = '';
        $respuesta["ant_numpredial"] = '';
        $respuesta["ant_emailcom"] = '';
        $respuesta["ant_emailcom2"] = '';
        $respuesta["ant_emailcom3"] = '';
        $respuesta["ant_dirnot"] = '';
        $respuesta["ant_telnot1"] = '';
        $respuesta["ant_telnot2"] = '';
        $respuesta["ant_faxnot"] = '';
        $respuesta["ant_celnot"] = '';
        $respuesta["ant_munnot"] = '';
        $respuesta["ant_barrionot"] = '';
        $respuesta["ant_emailnot"] = '';

        $respuesta["versionciiu"] = '';
        $respuesta["ciiu11"] = '';
        $respuesta["ciiu12"] = '';
        $respuesta["ciiu13"] = '';
        $respuesta["ciiu14"] = '';
        $respuesta["ciiu21"] = '';
        $respuesta["ciiu22"] = '';
        $respuesta["ciiu23"] = '';
        $respuesta["ciiu24"] = '';
        $respuesta["dircom"] = '';
        $respuesta["telcom1"] = '';
        $respuesta["telcom2"] = '';
        $respuesta["faxcom"] = '';
        $respuesta["celcom"] = '';
        $respuesta["muncom"] = '';
        $respuesta["barriocom"] = '';
        $respuesta["numpredial"] = '';
        $respuesta["emailcom"] = '';
        $respuesta["emailcom2"] = '';
        $respuesta["emailcom3"] = '';
        $respuesta["dirnot"] = '';
        $respuesta["telnot1"] = '';
        $respuesta["telnot2"] = '';
        $respuesta["faxnot"] = '';
        $respuesta["celnot"] = '';
        $respuesta["munnot"] = '';
        $respuesta["barrionot"] = '';
        $respuesta["emailnot"] = '';

        // En caso de trámites rues
        $respuesta["rues_numerointerno"] = "";
        $respuesta["rues_numerounico"] = "";
        $respuesta["rues_camarareceptora"] = "";
        $respuesta["rues_camararesponsable"] = "";
        $respuesta["rues_matricula"] = "";
        $respuesta["rues_proponente"] = "";
        $respuesta["rues_nombreregistrado"] = "";
        $respuesta["rues_claseidentificacion"] = "";
        $respuesta["rues_numeroidentificacion"] = "";
        $respuesta["rues_dv"] = "";
        $respuesta["rues_estado_liquidacion"] = "";
        $respuesta["rues_estado_transaccion"] = "";
        $respuesta["rues_nombrepagador"] = "";
        $respuesta["rues_origendocumento"] = "";
        $respuesta["rues_fechadocumento"] = "";
        $respuesta["rues_fechapago"] = "";
        $respuesta["rues_numerofactura"] = "";
        $respuesta["rues_referenciaoperacion"] = "";
        $respuesta["rues_totalpagado"] = 0;
        $respuesta["rues_formapago"] = "";
        $respuesta["rues_indicadororigen"] = "";
        $respuesta["rues_empleados"] = "";
        $respuesta["rues_indicadorbeneficio"] = "";
        $respuesta["rues_fecharespuesta"] = "";
        $respuesta["rues_horarespuesta"] = "";
        $respuesta["rues_codigoerror"] = "";
        $respuesta["rues_mensajeerror"] = "";
        $respuesta["rues_firmadigital"] = "";
        $respuesta["rues_firmadigital"] = "";
        $respuesta["rues_caracteres_por_linea"] = "";


        $respuesta["expedientes"] = array();
        $respuesta["liquidacion"] = array();
        $respuesta["rues_servicios"] = array();
        $respuesta["rues_textos"] = array();
        $respuesta["transacciones"] = array();

        //
        $respuesta["nrocontrolsipref"] = '';
        $respuesta["foto"] = '../../images/sii/people.png';
        $respuesta["fotoabsoluta"] = 'images/sii/people.png';
        $respuesta["cedula1"] = '../../images/sii/people.png';
        $respuesta["cedula1absoluta"] = 'images/sii/people.png';
        $respuesta["cedula2"] = '../../images/sii/people.png';
        $respuesta["cedula2absoluta"] = 'images/sii/people.png';

        //
        $respuesta["firmadoelectronicamente"] = '';
        $respuesta["firmadomanuscrita"] = '';
        $respuesta["tipoidefirmante"] = '';
        $respuesta["identificacionfirmante"] = '';
        $respuesta["fechaexpfirmante"] = '';
        $respuesta["apellido1firmante"] = '';
        $respuesta["apellido2firmante"] = '';
        $respuesta["nombre1firmante"] = '';
        $respuesta["nombre2firmante"] = '';
        $respuesta["emailfirmante"] = '';
        $respuesta["emailfirmanteseguimiento"] = '';
        $respuesta["celularfirmante"] = '';
        $respuesta["direccionfirmante"] = '';
        $respuesta["municipiofirmante"] = '';

        //
        $respuesta["emailcontactoasesoria"] = '';
        $respuesta["comentariosasesoria"] = '';

        //
        $respuesta["pedirbalance"] = '';
        $respuesta["incrementocupocertificados"] = 0;
        $respuesta["cobrarmutacion"] = '';

        $respuesta["propcamaraorigen"] = '';
        $respuesta["propproponenteorigen"] = '';
        $respuesta["propfechaultimainscripcion"] = '';
        $respuesta["propfechaultimarenovacion"] = '';
        $respuesta["propdircom"] = '';
        $respuesta["propmuncom"] = '';
        $respuesta["proptelcom1"] = '';
        $respuesta["proptelcom2"] = '';
        $respuesta["proptelcom3"] = '';
        $respuesta["propemailcom"] = '';
        $respuesta["propdirnot"] = '';
        $respuesta["propmunnot"] = '';
        $respuesta["proptelnot1"] = '';
        $respuesta["proptelnot2"] = '';
        $respuesta["proptelnot3"] = '';
        $respuesta["propemailnot"] = '';

        //
        $respuesta["activosbase"] = '';
        $respuesta["personalbase"] = '';

        // 2016-04-08: JINT:
        // Asigna el tipo de trámite inicial
        // 
        // 2016-07-31 : JINT
        // Asocia la sede al trámite
        $respuesta["tramitepresencial"] = '';
        $respuesta["sede"] = '01';
        if (!isset($_SESSION["generales"]["codigousuario"]) || $_SESSION["generales"]["codigousuario"] == 'USUPUBXX') {
            $respuesta["sede"] = '99'; // Sede virtual
            $respuesta["tramitepresencial"] = '1'; // Tramite virtual
        } else {
            $respuesta["tramitepresencial"] = '4'; // Trámite presencial
            if (!isset($_SESSION["generales"]["sedeusuario"])) {
                $_SESSION["generales"]["sedeusuario"] = '01';
            }
            $respuesta["sede"] = $_SESSION["generales"]["sedeusuario"];
        }

        //
        if ($tipo == 'VC') {
            return $respuesta;
        }

        //
        $arrLiq = array();

        //
        if ($tipo == 'L') {
            $arrLiq = retornarRegistroMysqli2($dbx, 'mreg_liquidacion', "idliquidacion=" . $numliq);
        }

        //
        if ($tipo == 'NR') {
            $arrLiq = retornarRegistroMysqli2($dbx, 'mreg_liquidacion', "numerorecuperacion='" . $numliq . "'");
            if (($arrLiq) && (!empty($arrLiq))) {
                $_SESSION["entrada"]["idliquidacion"] = $arrLiq["idliquidacion"];
            }
        }

        if ($tipo == 'CB') {
            $arrLiq = false;
            if (ltrim(trim($numliq), "0") != '') {
                $arrLiq = retornarRegistroMysqli2($dbx, 'mreg_liquidacion', "numeroradicacion='" . $numliq . "'");
            }
            if (($arrLiq) && (!empty($arrLiq))) {
                $numliq = $arrLiq["idliquidacion"];
            }
        }

        if (empty($arrLiq)) {
            return false;
        }

        // 2016-07-31 : JINT
        // Asocia la sede al trámite
        if (!isset($arrLiq["sede"]) || $arrLiq["sede"] == '') {
            $arrLiq["sede"] = '99';
            if ($arrLiq["idusuario"] != 'USUPUBXX') {
                if ($arrLiq["idusuario"] == 'RUE') {
                    $arrLiq["sede"] = '90';
                } else {
                    $arrusu = retornarRegistroMysqli2($dbx, 'usuarios', "idusuario='" . $arrLiq["idusuario"] . "'");
                    if ($arrusu === false || $arrusu["idsede"] == '') {
                        $arrLiq["sede"] = '01';
                    } else {
                        $arrLiq["sede"] = $arrusu["idsede"];
                    }
                }
            }
            if ($arrLiq["sede"] == '') {
                $arrLiq["sede"] = '01';
            }
        }

        if (!isset($arrLiq["pagoconsignacion"])) {
            $arrLiq["pagoconsignacion"] = 0;
        }
        if (!isset($arrLiq["proyectocaja"])) {
            $arrLiq["proyectocaja"] = '001';
        }
        if (!isset($arrLiq["cargoafiliacion"])) {
            $arrLiq["cargoafiliacion"] = 'NO';
        }
        if (!isset($arrLiq["cargogastoadministrativo"])) {
            $arrLiq["cargogastoadministrativo"] = 'NO';
        }
        if (!isset($arrLiq["cargoentidadoficial"])) {
            $arrLiq["cargoentidadoficial"] = 'NO';
        }
        if (!isset($arrLiq["cargoconsulta"])) {
            $arrLiq["cargoconsulta"] = 'NO';
        }
        if (!isset($arrLiq["domicilioorigen"])) {
            $arrLiq["domicilioorigen"] = '';
        }
        if (!isset($arrLiq["domiciliodestino"])) {
            $arrLiq["domiciliodestino"] = '';
        }
        if (!isset($arrLiq["benart7"])) {
            $arrLiq["benart7"] = 'N';
        }
        if (!isset($arrLiq["controlfirma"])) {
            $arrLiq["controlfirma"] = 'N';
        }
        if (!isset($arrLiq["ultanoren"])) {
            $arrLiq["ultanoren"] = '';
        }
        if (!isset($arrLiq["idmatriculabase"])) {
            $arrLiq["idmatriculabase"] = '';
        }
        if (!isset($arrLiq["idproponentebase"])) {
            $arrLiq["idproponentebase"] = '';
        }

        // $respuesta = array();
        $respuesta["idliquidacion"] = $arrLiq["idliquidacion"];
        $respuesta["numeroliquidacion"] = $arrLiq["idliquidacion"];
        $respuesta["fecha"] = $arrLiq["fecha"];
        $respuesta["hora"] = $arrLiq["hora"];
        $respuesta["fechaultimamodificacion"] = $arrLiq["fechaultimamodificacion"];
        $respuesta["idusuario"] = $arrLiq["idusuario"];
        $respuesta["tipotramite"] = $arrLiq["tipotramite"];
        $respuesta["iptramite"] = $arrLiq["iptramite"];
        $respuesta["idestado"] = $arrLiq["idestado"];
        $respuesta["txtestado"] = retornarRegistroMysqli2($dbx, "mreg_liquidacionestados", "id='" . $arrLiq["idestado"] . "'", "descripcion");

        $respuesta["idexpedientebase"] = $arrLiq["idexpedientebase"];
        $respuesta["idmatriculabase"] = $arrLiq["idmatriculabase"];
        $respuesta["idproponentebase"] = $arrLiq["idproponentebase"];

        $respuesta["identificacionbase"] = $arrLiq["identificacionbase"];
        $respuesta["tipoidentificacionbase"] = $arrLiq["tipoidentificacionbase"];
        $respuesta["nombrebase"] = $arrLiq["nombrebase"];
        $respuesta["organizacionbase"] = $arrLiq["organizacionbase"];
        $respuesta["categoriabase"] = $arrLiq["categoriabase"];

        $respuesta["tipoidepnat"] = $arrLiq["tipoidepnat"];
        $respuesta["idepnat"] = $arrLiq["idepnat"];

        $respuesta["nombrepnat"] = $arrLiq["nombrepnat"];
        $respuesta["nombreest"] = $arrLiq["nombreest"];

        $respuesta["actpnat"] = $arrLiq["actpnat"];
        $respuesta["actest"] = $arrLiq["actest"];

        $respuesta["perpnat"] = $arrLiq["perpnat"];

        $respuesta["numeromatriculapnat"] = $arrLiq["numeromatriculapnat"];
        $respuesta["camarapnat"] = $arrLiq["camarapnat"];

        $respuesta["ultanoren"] = $arrLiq["ultanoren"];
        $respuesta["domicilioorigen"] = $arrLiq["domicilioorigen"];
        $respuesta["domiciliodestino"] = $arrLiq["domiciliodestino"];

        $respuesta["idtipoidentificacioncliente"] = $arrLiq["idtipoidentificacioncliente"];
        $respuesta["identificacioncliente"] = $arrLiq["identificacioncliente"];
        $respuesta["nombrecliente"] = $arrLiq["nombrecliente"];
        $respuesta["apellidocliente"] = $arrLiq["apellidocliente"];
        $respuesta["email"] = $arrLiq["email"];
        $respuesta["direccion"] = $arrLiq["direccion"];
        $respuesta["idmunicipio"] = $arrLiq["idmunicipio"];
        $respuesta["telefono"] = $arrLiq["telefono"];
        $respuesta["movil"] = $arrLiq["movil"];

        $respuesta["nombrepagador"] = $arrLiq["nombrepagador"];
        $respuesta["apellidopagador"] = $arrLiq["apellidopagador"];
        $respuesta["tipoidentificacionpagador"] = $arrLiq["tipoidentificacionpagador"];
        $respuesta["identificacionpagador"] = $arrLiq["identificacionpagador"];
        $respuesta["direccionpagador"] = $arrLiq["direccionpagador"];
        $respuesta["telefonopagador"] = $arrLiq["telefonopagador"];
        $respuesta["movilpagador"] = $arrLiq["movilpagador"];
        $respuesta["municipiopagador"] = $arrLiq["municipiopagador"];
        $respuesta["emailpagador"] = $arrLiq["emailpagador"];

        $respuesta["valorbruto"] = $arrLiq["valorbruto"];
        $respuesta["valorbaseiva"] = $arrLiq["valorbaseiva"];
        $respuesta["valoriva"] = $arrLiq["valoriva"];
        $respuesta["valortotal"] = $arrLiq["valortotal"];
        $respuesta["idsolicitudpago"] = $arrLiq["idsolicitudpago"];

        $respuesta["pagoefectivo"] = $arrLiq["pagoefectivo"];
        $respuesta["pagocheque"] = $arrLiq["pagocheque"];
        $respuesta["pagoconsignacion"] = $arrLiq["pagoconsignacion"];
        $respuesta["pagovisa"] = $arrLiq["pagovisa"];
        $respuesta["pagoach"] = $arrLiq["pagoach"];
        $respuesta["pagomastercard"] = $arrLiq["pagomastercard"];
        $respuesta["pagoamerican"] = $arrLiq["pagoamerican"];
        $respuesta["pagocredencial"] = $arrLiq["pagocredencial"];
        $respuesta["pagodiners"] = $arrLiq["pagodiners"];
        $respuesta["pagotdebito"] = $arrLiq["pagotdebito"];
        $respuesta["pagoprepago"] = $arrLiq["pagoprepago"];
        $respuesta["pagoafiliado"] = $arrLiq["pagoafiliado"];

        $respuesta["idformapago"] = $arrLiq["idformapago"];
        $respuesta["numerorecibo"] = $arrLiq["numerorecibo"];
        $respuesta["numerooperacion"] = $arrLiq["numerooperacion"];
        $respuesta["fecharecibo"] = $arrLiq["fecharecibo"];
        $respuesta["horarecibo"] = $arrLiq["horarecibo"];
        $respuesta["idfranquicia"] = $arrLiq["idfranquicia"];
        $respuesta["nombrefranquicia"] = $arrLiq["nombrefranquicia"];
        $respuesta["numeroautorizacion"] = $arrLiq["numeroautorizacion"];
        $respuesta["idcodban"] = $arrLiq["idcodban"];
        $respuesta["nombrebanco"] = $arrLiq["nombrebanco"];
        $respuesta["numerocheque"] = $arrLiq["numerocheque"];
        $respuesta["numerorecuperacion"] = $arrLiq["numerorecuperacion"];
        $respuesta["numeroradicacion"] = $arrLiq["numeroradicacion"];
        $respuesta["alertaid"] = $arrLiq["alertaid"];
        $respuesta["alertaservicio"] = $arrLiq["alertaservicio"];
        $respuesta["alertavalor"] = $arrLiq["alertavalor"];
        $respuesta["ctrcancelacion"] = $arrLiq["ctrcancelacion"];
        $respuesta["idasesor"] = $arrLiq["idasesor"];
        $respuesta["numeroempleados"] = $arrLiq["numeroempleados"];
        $respuesta["pagoafiliacion"] = $arrLiq["pagoafiliacion"];
        $respuesta["numerofactura"] = $arrLiq["numerofactura"];

        $respuesta["incluirformularios"] = $arrLiq["incluirformularios"];
        $respuesta["incluircertificados"] = $arrLiq["incluircertificados"];
        $respuesta["incluirdiploma"] = $arrLiq["incluirdiploma"];
        $respuesta["incluircartulina"] = $arrLiq["incluircartulina"];
        $respuesta["matricularpnat"] = $arrLiq["matricularpnat"];
        $respuesta["matricularest"] = $arrLiq["matricularest"];
        $respuesta["regimentributario"] = $arrLiq["regimentributario"];
        $respuesta["tipomatricula"] = $arrLiq["tipomatricula"];
        $respuesta["camaracambidom"] = $arrLiq["camaracambidom"];
        $respuesta["matriculacambidom"] = $arrLiq["matriculacambidom"];
        $respuesta["municipiocambidom"] = $arrLiq["municipiocambidom"];
        $respuesta["fecmatcambidom"] = $arrLiq["fecmatcambidom"];
        $respuesta["benart7"] = $arrLiq["benart7"];
        $respuesta["controlfirma"] = $arrLiq["controlfirma"];
        $respuesta["actualizacionciiuversion4"] = $arrLiq["actualizacionciiuversion4"];
        $respuesta["reliquidacion"] = $arrLiq["reliquidacion"];

        $respuesta["capital"] = $arrLiq["capital"];
        $respuesta["tipodoc"] = $arrLiq["tipodoc"];
        $respuesta["numdoc"] = $arrLiq["numdoc"];
        $respuesta["fechadoc"] = $arrLiq["fechadoc"];
        $respuesta["origendoc"] = $arrLiq["origendoc"];
        $respuesta["mundoc"] = $arrLiq["mundoc"];
        $respuesta["organizacion"] = $arrLiq["organizacion"];
        $respuesta["categoria"] = $arrLiq["categoria"];

        $respuesta["tipoiderepleg"] = $arrLiq["tipoiderepleg"];
        $respuesta["iderepleg"] = $arrLiq["iderepleg"];
        $respuesta["nombrerepleg"] = $arrLiq["nombrerepleg"];

        $respuesta["tipoideradicador"] = $arrLiq["tipoideradicador"];
        $respuesta["ideradicador"] = $arrLiq["ideradicador"];
        $respuesta["nombreradicador"] = $arrLiq["nombreradicador"];
        $respuesta["fechaexpradicador"] = $arrLiq["fechaexpradicador"];
        $respuesta["emailradicador"] = $arrLiq["emailradicador"];
        $respuesta["telefonoradicador"] = $arrLiq["telefonoradicador"];
        $respuesta["celularradicador"] = $arrLiq["celularradicador"];

        $respuesta["proyectocaja"] = $arrLiq["proyectocaja"];
        $respuesta["cargoafiliacion"] = $arrLiq["cargoafiliacion"];
        $respuesta["cargogastoadministrativo"] = $arrLiq["cargogastoadministrativo"];
        $respuesta["cargoentidadoficial"] = $arrLiq["cargoentidadoficial"];
        $respuesta["cargoconsulta"] = $arrLiq["cargoconsulta"];

        // 2016-04-08: JINT
        $respuesta["tramitepresencial"] = $arrLiq["tramitepresencial"];
        if ($respuesta["tramitepresencial"] == '') {
            if (!isset($_SESSION["generales"]["codigousuario"]) || $_SESSION["generales"]["codigousuario"] == 'USUPUBXX') {
                $respuesta["tramitepresencial"] = '1'; // Tramite virtual
            } else {
                $respuesta["tramitepresencial"] = '4'; // Trámite presencial
            }
        }

        // 2016-09-07: JINT
        $respuesta["firmadoelectronicamente"] = $arrLiq["firmadoelectronicamente"];
        $respuesta["firmadomanuscrita"] = $arrLiq["firmadomanuscrita"];

        $respuesta["cumplorequisitosbenley1780"] = $arrLiq["cumplorequisitosbenley1780"];
        $respuesta["mantengorequisitosbenley1780"] = $arrLiq["mantengorequisitosbenley1780"];
        $respuesta["renunciobeneficiosley1780"] = $arrLiq["renunciobeneficiosley1780"];
        $respuesta["controlactividadaltoimpacto"] = $arrLiq["controlactividadaltoimpacto"];
        $respuesta["multadoponal"] = $arrLiq["multadoponal"];

        //
        $respuesta["rues_claseidentificacion "] = '';

        /*
         * LLena los siguientes campos a partir de mreg_liquidacion_campos
         * 
         * - subtipotramite
         * - origen
         * - tipoproponente
         * - benley1780
         * 
         * - tipocliente
         * - razonsocialcliente
         * - nombre1cliente
         * - nombre2cliente
         * - apellido1cliente
         * - apellido2cliente
         * 
         * - tipopagador
         * - razonsocialpagador
         * - nombre1pagador
         * - nombre2pagador
         * - apellido1pagador
         * - apellido2pagador
         * 
         * - nombrepjur
         * - nombresuc
         * - nombreage
         * 
         * - actpjur
         * - actsuc
         * - actage
         * 
         * - perpejur
         * 
         * - munpnat
         * - munest
         * - munpjur
         * - munsuc
         * - munage
         * 
         * - orgpnat
         * - orgpjur
         * - orgsuc
         * - orgage
         * 
         * - fecrencambidom
         * 
         * - opcionafiliado
         * - saldoafiliado
         * - matriculaafiliado
         * - ultanorenafi
         * 
         * - nombre1repleg
         * - nombre2repleg
         * - apellido1repleg
         * - apellido2repleg
         * - cargorepleg
         * - emailrepleg
         * - firmarepleg
         * - celularrepleg
         * 
         * - tipolibro
         * - codigolibro
         * - primeravez
         * - confirmadigital
         * 
         * - iderevfis
         * - nombre1revfis
         * - nombre2revfis
         * - apellido1revfis
         * - apellido2revfis
         * - cargorevfis
         * - emailrevfis
         * - firmarevfis
         * - celularrevfis
         *
         * - idepreasa
         * - nombre1preasa
         * - nombre2preasa
         * - apellido1preasa
         * - apellido2preasa
         * - cargopreasa
         * - emailpreasa
         * - firmopreasa
         * - celularpreasa
         * 
         * - idesecasa
         * - nombre1secasa
         * - nombre2secasa
         * - apellido1secasa
         * - apellido2secasa
         * - cargosecasa
         * - emailsecasa
         * - firmosecasa
         * - celularsecasa
         * 
         * - tipoidentificacionaceptante
         * - identificacionaceptante
         * - nombreaceptante
         * - cargoaceptante
         * - fechadocideaceptante
         * 
         * - motivocorreccion
         * - tipoerror1
         * - tipoerror2
         * - tipoerror3
         * 
         * - descripcionembargo
         * - descripciondesembargo
         * - tipoidentificaciondemandante
         * - identificaciondemandante
         * - nombredemandante
         * - libro
         * - numreg
         * 
         * - descripcionpqr
         * - tipoidentificacionpqr
         * - nombrepqr
         * - emailpqr
         * - telefonopqr
         * - celularpqr
         * 
         * - descripcionrr
         * - tipoidentificacionrr
         * - nombrerr
         * - emailrr
         * - telefonorr
         * - celularrr    
         * 
         * - tipocertificado
         * - explicacion
         * - textolibre
         * 
         * - modcom
         * - modnot
         * - modciiu
         * - modnombre
         * - matriculabase
         * - nom1base
         * - nom2base
         * - ape1base
         * - ape2base
         * - matriculabase
         * 
         * - ant_dircom
         * - ant_telcom1
         * - ant_telcom2
         * - ant_faxcom
         * - ant_celcom
         * - ant_muncom
         * - ant_barriocom
         * - ant_numpredialcom
         * - ant_emailcom
         * - ant_emailcom2
         * - ant_emailcom3
         * - ant_dirnot
         * - ant_telnot1
         * - ant_telnot2
         * - ant_faxnot
         * - ant_celnot
         * - ant_munnot
         * - ant_barrionot
         * - ant_emailnot
         * - ant_vesionciiu
         * - ant_ciiu11
         * - ant_ciiu12
         * - ant_ciiu13
         * - ant_ciiu14
         * - ant_ciiu21
         * - ant_ciiu22
         * - ant_ciiu23
         * - ant_ciiu24
         * 
         * - dircom
         * - telcom1
         * - telcom2
         * - faxcom
         * - celcom
         * - muncom
         * - barriocom
         * - numpredialcom
         * - emailcom
         * - emailcom2
         * - emailcom3
         * - dirnot
         * - telnot1
         * - telnot2
         * - faxnot
         * - celnot
         * - munnot
         * - barrionot
         * - emailnot
         * - nombreanterior
         * - nombrenuevo
         * - vesionciiu
         * - ciiu11
         * - ciiu12
         * - ciiu13
         * - ciiu14
         * - ciiu21
         * - ciiu22
         * - ciiu23
         * - ciiu24
         * 
         * - rues_numerointerno
         * - rues_numerounico
         * - rues_camarareceptora
         * - rues_camararesponsable
         * - rues_matricula
         * - rues_proponente
         * - rues_nombreregistrado
         * - rues_claseidentificacion
         * - rues_numeroidentificacion
         * - rues_dv
         * - rues_estado_liquidacion
         * - rues_estado_transaccion
         * - rues_nombrepagador
         * - rues_origendocumento
         * - rues_fechadocumento
         * - rues_fechapago
         * - rues_numerofactura
         * - rues_referenciaoperacion
         * - rues_totalpagado
         * - rues_formapago
         * - rues_indicadororigen
         * - rues_empleados
         * - rues_indicadorbeneficio
         * - rues_fecharespuesta
         * - rues_horarespuesta
         * - rues_codigoerror
         * - rues_mensajeerror
         * - rues_firmadigital
         * - rues_caracteres_por_linea
         * 
         * - firmadoelectronicamente (Se excluye de esta lista)
         * - tipoidefirmante
         * - identificacionfirmante
         * - apellido1firmante
         * - apellido2firmante
         * - nombre1firmante
         * - nombre2firmante
         * - emailfirmante
         * - emailfirmanteseguimiento
         * - celularfirmante
         * - direccionfirmante
         * - municipiofirmante
         * 
         * - emailcontactoasesoria
         * - comentariosasesoria
         * 
         * - incrementocupocertificados
         * - cobrarmutacion
         */
        $temCampos = retornarRegistrosMysqli2($dbx, 'mreg_liquidacion_campos', "idliquidacion=" . $numliq);

        if (!empty($temCampos)) {
            foreach ($temCampos as $c) {
                if ($c["campo"] == 'incrementocupocertificados') {
                    $respuesta[$c["campo"]] = intval(trim($c["contenido"]));
                } else {
                    if ($c["campo"] != 'firmadoelectronicamente') {
                        $respuesta[$c["campo"]] = trim($c["contenido"]);
                    }
                }
            }
        }

        unset($temCampos);


        //
        // En caso de tr&aacute;mites rues	
        $temx = retornarRegistrosMysqli2($dbx, 'mreg_liquidacion_textos_rues', "idliquidacion='" . $numliq . "'", "id");
        $ix = 0;
        foreach ($temx as $x) {
            $ix++;
            $respuesta["rues_textos"][$ix] = stripslashes($x);
        }
        unset($temx);

        //	
        //
        $respuesta["matriculabase"] = '';
        $respuesta["proponentebase"] = '';
        $respuesta["nrocontrolsipref"] = $arrLiq["nrocontrolsipref"];

        //
        $arrTem1 = retornarRegistroMysqli2($dbx, 'bas_tipotramites', "id='" . $respuesta["tipotramite"] . "'");
        if ($arrTem1 && !empty($arrTem1)) {
            if ($arrTem1["tiporegistro"] == 'RegMer' || $arrTem1["tiporegistro"] == 'RegEsadl') {
                $respuesta["matriculabase"] = $respuesta["idexpedientebase"];
            }
            if ($arrTem1["tiporegistro"] == 'RegPro') {
                $respuesta["proponentebase"] = $respuesta["idexpedientebase"];
            }
        }

        //
        unset($arrLiq);

        //
        $respuesta["expedientes"] = array();
        $respuesta["transacciones"] = array();
        $respuesta["liquidacion"] = array();


        // Arma arreglo de la liquidación
        $arrDet = retornarRegistrosMysqli2($dbx, "mreg_liquidaciondetalle", "idliquidacion=" . $_SESSION["entrada"]["idliquidacion"], "idsec");
        foreach ($arrDet as $lin) {
            $renglon = array();
            $renglon["idsec"] = sprintf("%03s", $lin["idsec"]);
            $renglon["idservicio"] = $lin["idservicio"];
            $renglon["txtservicio"] = retornarRegistroMysqli2($dbx, "mreg_servicios", "idservicio='" . $lin["idservicio"] . "'", "nombre");
            if (!isset($lin["cc"])) {
                $lin["cc"] = '';
            }
            $renglon["cc"] = $lin["cc"];
            //$renglon["expediente"] = $lin["cc"].' - '.$lin["expediente"];
            $renglon["expediente"] = $lin["expediente"];
            $renglon["nombre"] = $lin["nombre"];
            $renglon["ano"] = $lin["ano"];
            $renglon["cantidad"] = $lin["cantidad"];
            $renglon["valorbase"] = $lin["valorbase"];
            $renglon["porcentaje"] = $lin["porcentaje"];
            $renglon["valorservicio"] = $lin["valorservicio"];
            $renglon["benart7"] = $lin["benart7"];
            $renglon["benley1780"] = $lin["benley1780"];
            $renglon["reliquidacion"] = $lin["reliquidacion"];
            $renglon["serviciobase"] = $lin["serviciobase"];
            $renglon["pagoafiliacion"] = $lin["pagoafiliacion"];
            $renglon["ir"] = $lin["ir"];
            $renglon["iva"] = $lin["iva"];
            $renglon["idalerta"] = $lin["idalerta"];
            $respuesta["liquidacion"][] = $renglon;
        }
        unset($arrDet);

        // Arma arreglo de la liquidación RUES
        $arrDet = retornarRegistrosMysqli2($dbx, "mreg_liquidaciondetalle_rues", "idliquidacion=" . $_SESSION["entrada"]["idliquidacion"], "secuencia");
        foreach ($arrDet as $lin) {
            $renglon = array();
            $renglon["codigo_servicio"] = $lin["codigo_servicio"];
            $renglon["descripcion_servicio"] = $lin["descripcion_servicio"];
            $renglon["orden_servicio"] = $lin["orden_servicio"];
            $renglon["orden_servicio_asociado"] = $lin["orden_servicio_asociado"];
            $renglon["nombre_base"] = $lin["nombre_base"];
            $renglon["valor_base"] = $lin["valor_base"];
            $renglon["valor_liquidacion"] = $lin["valor_liquidacion"];
            $renglon["cantidad_servicio"] = $lin["cantidad_servicio"];
            $renglon["indicador_base"] = $lin["indicador_base"];
            $renglon["indicador_renovacion"] = $lin["indicador_renovacion"];
            $renglon["matricula_servicio"] = $lin["matricula_servicio"];
            $renglon["nombre_matriculado"] = $lin["nombre_matriculado"];
            $renglon["ano_renovacion"] = $lin["ano_renovacion"];
            $renglon["valor_activos_sin_ajustes"] = $lin["valor_activos_sin_ajustes"];
            $respuesta["rues_servicios"][] = $renglon;
        }
        unset($arrDet);

        // Arma arreglo de expedientes
        $temx = retornarRegistrosMysqli2($dbx, "mreg_liquidacionexpedientes", "idliquidacion=" . $_SESSION["entrada"]["idliquidacion"]);
        if ($temx === false) {
            $arrExp = false;
        } else {
            $arrExp = array();
            $i = -1;
            foreach ($temx as $res) {
                $i++;
                $arrExp[$i] = $res;
                if ($arrExp[$i]["registrobase"] == 'S') {
                    if (trim($arrExp[$i]["primeranorenovado"]) == '') {
                        $arrExp[$i]["primeranorenovado"] = $arrExp[$i]["ultimoanorenovado"];
                    }
                }
            }
        }
        unset($temx);


        if ($arrExp) {
            $i = 0;
            foreach ($arrExp as $lin) {
                $renglon = array();
                $i++;
                if (!isset($lin["cc"])) {
                    $lin["cc"] = '';
                }
                $renglon["cc"] = $lin["cc"];
                $renglon["matricula"] = $lin["matricula"];
                $renglon["proponente"] = $lin["proponente"];
                $renglon["numrue"] = $lin["numrue"];
                $renglon["idtipoidentificacion"] = $lin["idtipoidentificacion"];
                $renglon["identificacion"] = $lin["identificacion"];
                $renglon["razonsocial"] = $lin["razonsocial"];
                $renglon["ape1"] = $lin["ape1"];
                $renglon["ape2"] = $lin["ape2"];
                $renglon["nom1"] = $lin["nom1"];
                $renglon["nom2"] = $lin["nom2"];
                $renglon["organizacion"] = $lin["organizacion"];
                $renglon["txtorganizacion"] = retornarRegistroMysqli2($dbx, "bas_organizacionjuridica", "id='" . $lin["organizacion"] . "'", "descripcion");
                $renglon["categoria"] = $lin["categoria"];
                $renglon["txtcategoria"] = '';
                if ($lin ["organizacion"] != '01' && $lin ["organizacion"] != '02') {
                    $renglon["txtcategoria"] = retornarRegistroMysqli2($dbx, "bas_categorias", "id='" . $lin["categoria"] . "'", "descripcion");
                }
                $renglon["afiliado"] = $lin["afiliado"];
                $renglon["propietariojurisdiccion"] = $lin["propietariojurisdiccion"];
                $renglon["ultimoanoafiliado"] = $lin["ultimoanoafiliado"];
                $renglon["primeranorenovado"] = $lin["primeranorenovado"];
                $renglon["ultimoanorenovado"] = $lin["ultimoanorenovado"];
                $renglon["ultimosactivos"] = $lin["ultimosactivos"];
                $renglon["nuevosactivos"] = $lin["nuevosactivos"];
                $renglon["actividad"] = $lin["actividad"];
                $renglon["registrobase"] = $lin["registrobase"];
                $renglon["benart7"] = $lin["benart7"];
                $renglon["benley1780"] = $lin["benley1780"];
                $renglon["fechanacimiento"] = $lin["fechanacimiento"];
                $renglon["renovaresteano"] = $lin["renovaresteano"];
                $renglon["fechamatricula"] = $lin["fechamatricula"];
                $renglon["fecmatant"] = $lin["fecmatant"];
                $renglon["reliquidacion"] = $lin["reliquidacion"];
                $renglon["controlpot"] = $lin["controlpot"];
                $respuesta["expedientes"][] = $renglon;
            }
        }
        unset($arrExp);

        // Arma arreglo de transacciones
        $arrTra = retornarRegistrosMysqli2($dbx, 'mreg_liquidacion_transacciones', "idliquidacion=" . $respuesta["numeroliquidacion"], "idsecuencia");
        foreach ($arrTra as $tra) {
            $respuesta["transacciones"][] = $tra;
        }
        unset($arrTra);

        //
        $respuesta["iLin"] = $i;

        //
        if ($respuesta["numerorecuperacion"] != '') {
            if (file_exists('../../' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/fotoEvidencias/' . substr($respuesta["numerorecuperacion"], 0, 3) . '/' . $respuesta["numerorecuperacion"] . '-Foto.jpg')) {
                $respuesta["foto"] = '../../' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/fotoEvidencias/' . substr($respuesta["numerorecuperacion"], 0, 3) . '/' . $respuesta["numerorecuperacion"] . '-Foto.jpg';
                $respuesta["fotoabsoluta"] = PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/fotoEvidencias/' . substr($respuesta["numerorecuperacion"], 0, 3) . '/' . $respuesta["numerorecuperacion"] . '-Foto.jpg';
            } else {
                $respuesta["fotoabsoluta"] = 'images/sii/people.png';
                $respuesta["foto"] = '../../images/sii/people.png';
            }

            if (file_exists('../../' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/fotoEvidencias/' . substr($respuesta["numerorecuperacion"], 0, 3) . '/' . $respuesta["numerorecuperacion"] . '-Cedula1.jpg')) {
                $respuesta["cedula1"] = '../../' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/fotoEvidencias/' . substr($respuesta["numerorecuperacion"], 0, 3) . '/' . $respuesta["numerorecuperacion"] . '-Cedula1.jpg';
                $respuesta["cedula1absoluta"] = PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/fotoEvidencias/' . substr($respuesta["numerorecuperacion"], 0, 3) . '/' . $respuesta["numerorecuperacion"] . '-Cedula1.jpg';
            } else {
                $respuesta["cedula1absoluta"] = 'images/sii/people.png';
                $respuesta["cedula1"] = '../../images/sii/people.png';
            }

            if (file_exists('../../' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/fotoEvidencias/' . substr($respuesta["numerorecuperacion"], 0, 3) . '/' . $respuesta["numerorecuperacion"] . '-Cedula2.jpg')) {
                $respuesta["cedula2"] = '../../' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/fotoEvidencias/' . substr($respuesta["numerorecuperacion"], 0, 3) . '/' . $respuesta["numerorecuperacion"] . '-Cedula2.jpg';
                $respuesta["cedula2absoluta"] = PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/fotoEvidencias/' . substr($respuesta["numerorecuperacion"], 0, 3) . '/' . $respuesta["numerorecuperacion"] . '-Cedula2.jpg';
            } else {
                $respuesta["cedula2absoluta"] = 'images/sii/people.png';
                $respuesta["cedula2"] = '../../images/sii/people.png';
            }
        }


        return $respuesta;
    }

    public static function retornarMregSecuencia($dbx, $clave) {
        $arrTem = retornarRegistroMysqli2($dbx, 'mreg_secuencias', "id='" . $clave . "'");
        if ($arrTem === false || empty($arrTem)) {
            return 0;
        } else {
            return $arrTem["secuencia"];
        }
    }

    public static function retornarMregSecuenciaMaxAsentarReciboSii($dbx, $clave) {

        //
        if ($clave == 'RECIBOS-NORMALES') {
            $query = "select max(recibo) as a from mreg_recibosgenerados where substring(recibo,1,1) = 'S'";
        }
        if ($clave == 'RECIBOS-NOTAS') {
            $query = "select max(recibo) as a from mreg_recibosgenerados where substring(recibo,1,1) = 'M'";
        }
        if ($clave == 'RECIBOS-GA') {
            $query = "select max(recibo) as a from mreg_recibosgenerados where substring(recibo,1,1) = 'H'";
        }
        if ($clave == 'RECIBOS-CO') {
            $query = "select max(recibo) as a from mreg_recibosgenerados where substring(recibo,1,1) = 'D'";
        }

        //
        $temx = ejecutarQueryMysqli2($dbx, $query);
        $siguiente = ltrim(substr($temx[1]["a"], 1), "0");

        //
        return $siguiente;
    }

    public static function retornarNombrePais($dbx, $id) {

        if (is_numeric($id)) {
            $reg = retornarRegistroMysqli2($dbx, 'bas_paises', "codnumpais='" . $id . "'");
            if ($reg && !empty($reg)) {
                return $reg["nombrepais"];
            } else {
                return "";
            }
        } else {
            $reg = retornarRegistroMysqli2($dbx, 'bas_paises', "idpais='" . $id . "'");
            if ($reg && !empty($reg)) {
                return $reg["nombrepais"];
            } else {
                return "";
            }
        }
    }

    public static function retornarNombrePaisAbreviado($dbx, $id) {

        if (is_numeric($id)) {
            $reg = retornarRegistroMysqli2($dbx, 'bas_paises', "codnumpais='" . $id . "'");
            if ($reg && !empty($reg)) {
                return $reg["idpais"];
            } else {
                return "";
            }
        } else {
            return $id;
        }
    }

    public static function validarFecha($dsfecha) {

        if (strlen($dsfecha) < 8) {
            return false;
        } else {
            if (substr($dsfecha, 0, 4) < "1800") {
                return false;
            } else {
                $ano = substr($dsfecha, 0, 4);
                if ((substr($dsfecha, 4, 2) < "01") || (substr($dsfecha, 4, 2) > "12")) {
                    return false;
                } else {
                    $mal = "0";
                    if ((substr($dsfecha, 4, 2) == "01") ||
                            (substr($dsfecha, 4, 2) == "03") ||
                            (substr($dsfecha, 4, 2) == "05") ||
                            (substr($dsfecha, 4, 2) == "07") ||
                            (substr($dsfecha, 4, 2) == "08") ||
                            (substr($dsfecha, 4, 2) == "10") ||
                            (substr($dsfecha, 4, 2) == "12")) {
                        if ((substr($dsfecha, 6, 2) < "01") || (substr($dsfecha, 6, 2) > "31")) {
                            $mal = "1";
                        }
                    }
                    if ((substr($dsfecha, 4, 2) == "04") ||
                            (substr($dsfecha, 4, 2) == "06") ||
                            (substr($dsfecha, 4, 2) == "09") ||
                            (substr($dsfecha, 4, 2) == "11")) {
                        if ((substr($dsfecha, 6, 2) < "01") || (substr($dsfecha, 6, 2) > "30")) {
                            $mal = "1";
                        }
                    }
                    if (substr($dsfecha, 4, 2) == "02") {
                        if (($ano % 4 == 0) && (($ano % 100 != 0) || ($ano % 400 == 0))) {
                            if ((substr($dsfecha, 6, 2) < "01") || (substr($dsfecha, 6, 2) > "29")) {
                                $mal = "1";
                            }
                        } else {
                            if ((substr($dsfecha, 6, 2) < "01") || (substr($dsfecha, 6, 2) > "28")) {
                                $mal = "1";
                            }
                        }
                    }
                    if ($mal == "1") {
                        return false;
                    } else {
                        return true;
                    }
                }
            }
        }
    }

    public static function encomillar($cadenaBusq = '') {
        if (trim($cadenaBusq) != '') {
            $arrBusqueda = explode(",", $cadenaBusq);

            $arrSal = array();
            foreach ($arrBusqueda as $reg) {
                $arrSal[] = "'" . $reg . "'";
            }
            return implode(",", $arrSal);
        } else {
            return '';
        }
    }

    public static function validacionFormularioGrabado($dbx, $mat) {
        $temValid = retornarRegistroMysqli2($dbx, 'mreg_liquidaciondatos', "idliquidacion=" . $_SESSION ["tramite"] ["numeroliquidacion"] . " and expediente='" . $mat . "'");
        if ($temValid === false || empty($temValid)) {
            return false;
        } else {
            $datos = \funcionesSii2_desserializaciones::desserializarExpedienteMatricula($dbx, $temValid["xml"]);
            if ($datos["organizacion"] == '02' || $datos["categoria"] == '2' || $datos["categoria"] == '3') {
                return true;
            } else {
                if (floatval($datos["acttot"]) != floatval($datos["paspat"])) {
                    return false;
                } else {
                    return true;
                }
            }
        }
    }

    public static function consumirWsConsultarRutaSii2($dbx, $codbarras) {

        if (trim($codbarras) == '') {
            return false;
        }

        //
        $arrTem = retornarRegistroMysqli2($dbx, 'mreg_est_codigosbarras', "codigobarras='" . $codbarras . "'");
        $arrTemRec = retornarRegistroMysqli2($dbx, 'mreg_recibosgenerados', "codigobarras='" . $codbarras . "'");
        $arrTemRad = retornarRegistroMysqli2($dbx, 'mreg_rue_radicacion', "codigobarras='" . $codbarras . "'");
        if (ltrim(trim($codbarras), "0") != '') {
            $arrTemliq = retornarRegistroMysqli2($dbx, 'mreg_liquidacion', "numeroradicacion='" . $codbarras . "'");
        } else {
            $arrTemliq = false;
        }
        //
        $emails = array();
        $tels = array();

        $emailRadicado = '';
        $celularRadicado = '';
        if (($arrTem["actoreparto"] == '07') || ($arrTem["actoreparto"] == '29')) {
            $emailRadicado = $arrTemRec["email"];
            $celularRadicado = $arrTemRec["telefono2"];
        }

        //
        if ($arrTemRec["email"] != '') {
            $emails[$arrTemRec["email"]] = $arrTemRec["email"];
        }
        if ($arrTemRec["telefono1"] != '' && strlen($arrTemRec["telefono1"]) == 10 && substr($arrTemRec["telefono1"], 0, 1) == '3') {
            $tels[$arrTemRec["telefono1"]] = $arrTemRec["telefono1"];
        }
        if ($arrTemRec["telefono2"] != '' && strlen($arrTemRec["telefono2"]) == 10 && substr($arrTemRec["telefono2"], 0, 1) == '3') {
            if (!in_array($arrTemRec["telefono2"], $tels)) {
                $tels[$arrTemRec["telefono2"]] = $arrTemRec["telefono2"];
            }
        }

        if (ltrim(trim($arrTem["matricula"]), "0") != '') {
            $arrTemMat = retornarRegistroMysqli2($dbx, 'mreg_est_inscritos', "matricula='" . ltrim(trim($arrTem["matricula"]), "0") . "'");
            if ($arrTemMat && !empty($arrTemMat)) {
                if (trim($arrTemMat["emailcom"]) != '') {
                    $emails[$arrTemMat["emailcom"]] = $arrTemMat["emailcom"];
                }
                if (trim($arrTemMat["emailcom2"]) != '') {
                    $emails[$arrTemMat["emailcom2"]] = $arrTemMat["emailcom2"];
                }
                if (trim($arrTemMat["emailcom3"]) != '') {
                    $emails[$arrTemMat["emailcom3"]] = $arrTemMat["emailcom3"];
                }
                if (trim($arrTemMat["emailnot"]) != '') {
                    $emails[$arrTemMat["emailnot"]] = $arrTemMat["emailnot"];
                }
                if (trim($arrTemMat["telcom1"]) != '' && strlen($arrTemMat["telcom1"]) == 10 && substr($arrTemMat["telcom1"], 0, 1) == '3') {
                    $tels[$arrTemMat["telcom1"]] = $arrTemMat["telcom1"];
                }
                if (trim($arrTemMat["telcom2"]) != '' && strlen($arrTemMat["telcom2"]) == 10 && substr($arrTemMat["telcom2"], 0, 1) == '3') {
                    $tels[$arrTemMat["telcom2"]] = $arrTemMat["telcom2"];
                }
                if (trim($arrTemMat["telcom3"]) != '' && strlen($arrTemMat["telcom3"]) == 10 && substr($arrTemMat["telcom3"], 0, 1) == '3') {
                    $tels[$arrTemMat["telcom3"]] = $arrTemMat["telcom3"];
                }
                if (trim($arrTemMat["telnot"]) != '' && strlen($arrTemMat["telnot"]) == 10 && substr($arrTemMat["telnot"], 0, 1) == '3') {
                    $tels[$arrTemMat["telnot"]] = $arrTemMat["telnot"];
                }
                if (trim($arrTemMat["telnot2"]) != '' && strlen($arrTemMat["telnot2"]) == 10 && substr($arrTemMat["telnot2"], 0, 1) == '3') {
                    $tels[$arrTemMat["telnot2"]] = $arrTemMat["telnot2"];
                }
                if (trim($arrTemMat["telnot3"]) != '' && strlen($arrTemMat["telnot3"]) == 10 && substr($arrTemMat["telnot3"], 0, 1) == '3') {
                    $tels[$arrTemMat["telnot3"]] = $arrTemMat["telnot3"];
                }
            }

            $arrTemCC = retornarRegistrosMysqli2($dbx, 'mreg_est_campostablas', "tabla='200' and registro='" . ltrim(trim($arrTem["matricula"]), "0") . "'", "id");
            foreach ($arrTemCC as $cc) {
                if ($cc["campo"] == "EMAILNOT-ANTERIOR" && trim($cc["contenido"]) != '') {
                    $emails[$cc["contenido"]] = $cc["contenido"];
                    $emailnotant = trim($cc["contenido"]);
                }
                if ($cc["campo"] == "EMAILCOM-ANTERIOR" && trim($cc["contenido"]) != '') {
                    $emails[$cc["contenido"]] = $cc["contenido"];
                    $emailcomant = trim($cc["contenido"]);
                }
            }

            // Incluir la búsqueda sobre mreg_campos_historicos_AAAA
        }

        //
        $retorno = array();
        $retorno["codbarras"] = $codbarras;
        $retorno["operacion"] = $arrTem["operacion"];
        $retorno["matricula"] = $arrTem["matricula"];
        $retorno["proponente"] = $arrTem["proponente"];
        $retorno["idclase"] = $arrTem["idclase"];
        $retorno["numid"] = $arrTem["numid"];
        $retorno["nombre"] = $arrTem["nombre"];
        $retorno["organizacion"] = '';
        $retorno["tipotramite"] = $arrTemliq["tipotramite"];
        $retorno["idliquidacion"] = $arrTemliq["idliquidacion"];
        $retorno["fecha"] = $arrTem["fecharadicacion"];
        $retorno["tipodoc"] = $arrTem["tipdoc"];
        $retorno["numdoc"] = $arrTem["numdoc"];
        $retorno["fechadoc"] = $arrTem["fecdoc"];
        $retorno["mundoc"] = $arrTem["mundoc"];
        $retorno["txtorigendoc"] = $arrTem["oridoc"];
        $retorno["tramite"] = $arrTem["actoreparto"];
        $retorno["estado"] = $arrTem["estadofinal"];
        $retorno["festado"] = $arrTem["fechaestadofinal"];
        $retorno["usuario"] = $arrTem["operadorfinal"];
        $retorno["recibo"] = $arrTem["recibo"];
        $retorno["erecibo"] = '0'; // Normal
        if ($arrTemRec["estado"] == '03') {
            $retorno["erecibo"] = '2'; // Reversado
        }
        if ($arrTemRec["estado"] == '99') {
            $retorno["erecibo"] = '1'; // Anulado
        }
        $retorno["fecopera"] = '';
        $retorno["horpago"] = '';
        if ($arrTemRec && !empty($arrTemRec)) {
            $retorno["fecopera"] = $arrTemRec["fecha"];
            $retorno["horpago"] = $arrTemRec["hora"];
        }
        $retorno["escaneocompleto"] = $arrTem["escaneocompleto"];
        $retorno["nin"] = '';
        $retorno["nuc"] = '';
        if ($arrTemRad && !empty($arrTemRad)) {
            $retorno["nin"] = $arrTemRad["numerointernorue"];
            $retorno["nuc"] = $arrTemRad["numerounicoconsulta"];
        }
        $retorno["emails"] = $emails;
        if ($emailRadicado != '') {
            $retorno["emailradicado"] = $emailRadicado;
            $retorno["celradicado"] = $celularRadicado;
        }

        $retorno["telefonos"] = $tels;
        $retorno["detalle"] = $arrTem["detalle"];
        $retorno["emailnot1"] = $arrTem["emailnot1"];
        $retorno["emailnot2"] = $arrTem["emailnot2"];
        $retorno["emailnot3"] = $arrTem["emailnot3"];
        $retorno["celnot1"] = $arrTem["celnot1"];
        $retorno["celnot2"] = $arrTem["celnot2"];
        $retorno["celnot3"] = $arrTem["celnot3"];

        //
        $i = 0;
        $retorno["pasosruta"] = array();
        $arrTemEst = retornarRegistrosMysqli2($dbx, 'mreg_est_codigosbarras_documentos', "codigobarras='" . $codbarras . "'", "fecha,hora");
        foreach ($arrTemEst as $reg) {
            $i++;
            $retorno["pasosruta"][$i]["fecha"] = $reg["fecha"];
            $retorno["pasosruta"][$i]["hora"] = $reg["hora"];
            $retorno["pasosruta"][$i]["codigoruta"] = $reg["estado"];
            if ($arrTem["actoreparto"] == '09' || $arrTem["actoreparto"] == '53') {
                $retorno["pasosruta"][$i]["estado"] = retornarNombreTablaBasicaMysqli2($dbx, 'mreg_codestados_rutaproponentes', $reg["estado"]);
            } else {
                $retorno["pasosruta"][$i]["estado"] = retornarNombreTablaBasicaMysqli2($dbx, 'mreg_codestados_rutamercantil', $reg["estado"]);
            }
            if (trim($reg["sucursal"]) == '') {
                $retorno["pasosruta"][$i]["idusuario"] = $reg["operador"];
            } else {
                $retorno["pasosruta"][$i]["idusuario"] = $reg["sucursal"] . '-' . $reg["operador"];
            }

            $retorno["pasosruta"][$i]["usuario"] = \funcionesGenerales::utf8_decode(retornarNombreUsuarioMysqli2($dbx, $reg["operador"]));
            if (trim($retorno["pasosruta"][$i]["usuario"]) == '') {
                $retorno["pasosruta"][$i]["usuario"] = \funcionesGenerales::utf8_decode(retornarNombreUsuarioSirepMysqli2($dbx, $reg["operador"]));
            }

            if ($retorno["pasosruta"][$i]["idusuario"] == 'BAT') {
                $retorno["pasosruta"][$i]["usuario"] = 'PROCESOS AUTOMATICOS';
            }
        }

        //
        $i = 0;
        $retorno["codbarrasacto"] = array();
        $arrTemEst = retornarRegistrosMysqli2($dbx, 'mreg_est_codigosbarras_libros', "codigobarras='" . $codbarras . "'", "id");
        foreach ($arrTemEst as $reg) {
            $i++;
            if ($retorno["tramite"] != '09' && $retorno["tramite"] != '33' && $retorno["tramite"] != '53') {
                $temx = retornarRegistroMysqli2($dbx, 'mreg_est_inscripciones', "libro='" . $reg["libro"] . "' and registro='" . ltrim(trim($reg["registro"]), "0") . "'");
                $retorno["codbarrasacto"][$i]["libro"] = $reg["libro"];
                $retorno["codbarrasacto"][$i]["registro"] = ltrim(trim($reg["registro"]), "0");
                $retorno["codbarrasacto"][$i]["certif"] = retornarNombreActosRegistroMysqli2($dbx, $reg["libro"], $reg["acto"]);
                $retorno["codbarrasacto"][$i]["fechareg"] = $temx["fecharegistro"];
                $retorno["codbarrasacto"][$i]["horareg"] = $temx["horaregistro"];
                $retorno["codbarrasacto"][$i]["acto"] = $reg["acto"];
                $retorno["codbarrasacto"][$i]["noticia"] = $temx["noticia"];
                if ($reg["libro"] == 'RM07' || $reg["libro"] == 'RM22' || $reg["libro"] == 'RE52') {
                    if ($reg["acto"] == '' || $reg["acto"] == '0003') {
                        if ($temx["descripcionlibro"] != '') {
                            $retorno["codbarrasacto"][$i]["noticia"] = $temx["descripcionlibro"] . ' - ' . $temx["numeropaginas"];
                        } else {
                            $retorno["codbarrasacto"][$i]["noticia"] = $temx["codigolibro"] . ' - ' . $temx["numeropaginas"];
                        }
                    }
                }
                $retorno["codbarrasacto"][$i]["expediente"] = $temx["matricula"];
                $retorno["codbarrasacto"][$i]["nombre"] = $temx["nombre"];
                $retorno["codbarrasacto"][$i]["email"] = ''; // Completar
                $retorno["codbarrasacto"][$i]["firma"] = $temx["firma"];
            } else {
                $temx = retornarRegistroMysqli2($dbx, 'mreg_est_inscripciones_proponentes', "libro='" . $reg["libro"] . "' and registro='" . $reg["registro"] . "'");
                $retorno["codbarrasacto"][$i]["libro"] = $reg["libro"];
                $retorno["codbarrasacto"][$i]["registro"] = $reg["registro"];
                $retorno["codbarrasacto"][$i]["certif"] = retornarNombreActosProponentesMysqli2($dbx, $reg["acto"]);
                $retorno["codbarrasacto"][$i]["fechareg"] = $temx["fecharegistro"];
                $retorno["codbarrasacto"][$i]["horareg"] = $temx["horaregistro"];
                $retorno["codbarrasacto"][$i]["acto"] = $reg["acto"];
                $retorno["codbarrasacto"][$i]["noticia"] = $temx["texto"];
                $retorno["codbarrasacto"][$i]["expediente"] = $temx["proponente"];
                $retorno["codbarrasacto"][$i]["nombre"] = $temx["nombre"];
                $retorno["codbarrasacto"][$i]["email"] = ''; // Completar
                $retorno["codbarrasacto"][$i]["firma"] = $temx["firma"];
            }
        }

        //        
        $retorno["servicios"] = array();
        if (trim($arrTem["recibo"]) != '') {
            $arrTemSer = retornarRegistrosMysqli2($dbx, 'mreg_recibosgenerados_detalle', "recibo='" . $arrTem["recibo"] . "'", "id");
            $i = 0;
            foreach ($arrTemSer as $reg) {
                $i++;
                $retorno["servicios"][$i]["ser"] = $reg["idservicio"];
                $retorno["servicios"][$i]["can"] = $reg["cantidad"];
                $retorno["servicios"][$i]["val"] = $reg["valorservicio"];
                $retorno["servicios"][$i]["mat"] = $reg["matricula"];
                $retorno["servicios"][$i]["pro"] = $reg["proponente"];
                $retorno["servicios"][$i]["ano"] = $reg["ano"];
                $retorno["servicios"][$i]["act"] = $reg["valorbase"];
            }
        }

        return $retorno;
    }

    public static function consumirANI2($dbx, $tide, $ide) {

        $nameLog = 'validacionANI2_' . date("Ymd");

        $buscartoken = true;
        $name = '../../../tmp/' . CODIGO_EMPRESA . '-tokenrues.txt';
        if (file_exists($name)) {
            $x = file_get_contents('../../../tmp/' . CODIGO_EMPRESA . '-tokenrues.txt');
            list($access_token, $expira) = explode("|", $x);
            $act = date("Y-m-d H:i:s");
            if ($access_token != '') {
                if ($act <= $expira) {
                    $buscartoken = false;
                }
            }
        }

        //
        $urlapirues = '';
        $userapirues = '';
        $passwordapirues = '';
        if (!defined('RUES_API_URL') || RUES_API_URL == '') {
            $urlapirues = 'https://ruesapi.rues.org.co';
            if (TIPO_AMBIENTE == 'PRUEBAS') {
                $urlapirues = 'http://pruebasruesapi.rues.org.co';
            }
        }
        if (!defined('RUES_API_USER') || RUES_API_USER == '') {
            $userapirues = 'SIIUser';
            if (TIPO_AMBIENTE == 'PRUEBAS') {
                $userapirues = 'pruebassii';
            }
        }
        if (!defined('RUES_API_PASSWORD') || RUES_API_PASSWORD == '') {
            $passwordapirues = 'Webapi2017*';
            if (TIPO_AMBIENTE == 'PRUEBAS') {
                $passwordapirues = 'Webapi2018*';
            }
        }

        if ($buscartoken) {
            $ch = curl_init();
            curl_setopt($ch, CURLOPT_URL, $urlapirues . '/Token');
            curl_setopt($ch, CURLOPT_POST, true);
            curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-Type: application/x-www-form-urlencoded'));
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
            curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 10);
            curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
            curl_setopt($ch, CURLOPT_POSTFIELDS, "username=" . $userapirues . "&password=" . $passwordapirues . "&grant_type=password");
            $result = curl_exec($ch);
            curl_close($ch);
            $resultado = json_decode($result, true);
            $access_token = $resultado['access_token'];

            //
            $txt = '';
            if (!is_array($resultado)) {
                $txt = $resultado;
            } else {
                foreach ($resultado as $key => $valor) {
                    $txt .= $key . ' => ' . $valor . "\r\n";
                }
            }
            \logSii2::general2($nameLog, $tide . '-' . $ide, $txt);

            //
            $fecha = date('Y-m-d H:i:s', (strtotime("+20 Hours")));
            $f = fopen($name, "w");
            fwrite($f, $access_token . '|' . $fecha);
            fclose($f);
        }

        //
        if ($access_token == '') {
            $_SESSION["generales"]["mensajeerror"] = 'No encontro token para continuar';
            return false;
        }

        //
        if (file_exists($name)) {
            $x = file_get_contents('../../../tmp/' . CODIGO_EMPRESA . '-tokenrues.txt');
            list($access_token, $expira) = explode("|", $x);
        }

        //    
        if ($tide != '2') {
            $ide1 = $ide;
            $ide2 = '';
        } else {
            $sep = separarDv($ide);
            $ide1 = $sep["identificacion"];
            $ide2 = $sep["dv"];
        }

        $json = '{
            "codigoCamara":"' . CODIGO_EMPRESA . '",
            "usuarioCamara":"' . CODIGO_EMPRESA . '-' . $_SESSION["generales"]["codigousuario"] . '",
            "cedulas":["' . $ide1 . '"]        
        }';

        $url = $urlapirues . '/api/ConsultaANI/ConsultarCedula';
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-Type: application/json', 'Authorization: Bearer ' . $access_token));
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 10);
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
        curl_setopt($ch, CURLOPT_POSTFIELDS, $json);
        curl_setopt($ch, CURLOPT_POST, TRUE);
        curl_setopt($ch, CURLOPT_HTTPGET, FALSE);
        $result = curl_exec($ch);
        curl_close($ch);

        //
        \logSii2::general2($nameLog, $tide . '-' . $ide, '****** PETICION : ' . $url . ' *** RESPUESTA : ' . $result);
        \logSii2::general2($nameLog, '', '');

        //
        $arrCampos = array(
            'fecha',
            'hora',
            'identificacion',
            'estadoconsulta',
            'xml'
        );

        //
        $estadoConsulta = '0';
        $error = 'no';
        $xml = '';

        //
        if (!isJson($result)) {
            \logSii2::general2($nameLog, $tide . '-' . $ide, 'La respuesta del servicio web no es un Json (1) - ' . $result);
            $estadoConsulta = '1';
            $xml = 'No se obtuvo respuesta del servicio web de ANI2 (1)';
            $_SESSION["generales"]["mensajeerror"] = 'No se obtuvo respuesta del servicio web de ANI2 (1)';
            $error = 'si';
        }

        if ($error == 'no') {
            $resultado = json_decode($result, true);
        }

        if ($error == 'no') {
            if (!isset($resultado["return"])) {
                \logSii2::general2($nameLog, $tide . '-' . $ide, 'Respuesta erronea de ANI2 (2) - ' . $result);
                $estadoConsulta = '1';
                $xml = 'Respuesta erronea de ANI2 (2) - ' . $result;
                $_SESSION["generales"]["mensajeerror"] = 'Respuesta erronea de ANI2 (2) - ' . $result;
                $error = 'si';
            }
        }

        //
        if ($error == 'no') {
            if (!isset($resultado["return"]["estadoConsulta"])) {
                \logSii2::general2($nameLog, $tide . '-' . $ide, 'Respuesta erronea de ANI2 (3) - ' . $result);
                $estadoConsulta = '1';
                $xml = 'Respuesta erronea de ANI2 (3) - ' . $result;
                $_SESSION["generales"]["mensajeerror"] = 'Respuesta erronea de ANI2 (3) - ' . $result;
                $error = 'si';
            }
        }

        //
        if ($error == 'no') {
            if (!isset($resultado["return"]["estadoConsulta"]["codError"])) {
                \logSii2::general2($nameLog, $tide . '-' . $ide, 'Respuesta erronea de ANI2 (4) - ' . $result);
                $estadoConsulta = '1';
                $xml = 'Respuesta erronea de ANI2 (4) - ' . $result;
                $_SESSION["generales"]["mensajeerror"] = 'Respuesta erronea de ANI2 (4) - ' . $result;
                $error = 'si';
            }
        }

        //
        if ($error == 'no') {
            if ($resultado["return"]["estadoConsulta"]["codError"] != '0') {
                \logSii2::general2($nameLog, $tide . '-' . $ide, 'Error en la consulta ANI (5) - ' . $resultado["return"]["estadoConsulta"]["descripcionError"] . ' - ' . $result);
                $estadoConsulta = '1';
                if ($resultado["return"]["estadoConsulta"]["codError"] == '1') {
                    $estadoConsulta = '2';
                }
                $xml = 'Error en la repsuesta del servicio ANI2 (5) - ' . $resultado["return"]["estadoConsulta"]["descripcionError"] . ' - ' . $result;
                $_SESSION["generales"]["mensajeerror"] = 'Error en la repsuesta del servicio ANI2 (5) - ' . $resultado["return"]["estadoConsulta"]["descripcionError"] . ' - ' . $result;
                $error = 'si';
            }
        }

        //
        if ($error == 'no') {
            $xml = $result;
            $salida1 = array();
            $salida1["nuip"] = '';
            $salida1["codError"] = '';
            $salida1["primerApellido"] = '';
            $salida1["particula"] = '';
            $salida1["segundoApellido"] = '';
            $salida1["primerNombre"] = '';
            $salida1["segundoNombre"] = '';
            $salida1["municipioExpedicion"] = '';
            $salida1["departamentoExpedicion"] = '';
            $salida1["fechaExpedicion"] = '';
            $salida1["estadoCedula"] = '';
            $salida1["numResolucion"] = '';
            $salida1["anoResolucion"] = '';
            $salida1["genero"] = '';
            $salida1["fechaNacimiento"] = '';
            $salida1["lugarNacimiento"] = '';
            $salida1["informante"] = '';
            $salida1["serial"] = '';
            $salida1["fechaDefuncion"] = '';
            $salida1["lugarNovedad"] = '';
            $salida1["lugarPreparacion"] = '';
            $salida1["grupoSanguineo"] = '';
            $salida1["estatura"] = '';
        }

        //
        if ($error == 'no') {
            foreach ($resultado["return"]["datosCedulas"] as $ced) {
                $salida1["codError"] = $ced["codError"];
                $salida1["nuip"] = $ced["nuip"];
                $salida1["primerApellido"] = $ced["primerApellido"];
                $salida1["particula"] = $ced["particula"];
                $salida1["segundoApellido"] = $ced["segundoApellido"];
                $salida1["primerNombre"] = $ced["primerNombre"];
                $salida1["segundoNombre"] = $ced["segundoNombre"];
                $salida1["municipioExpedicion"] = $ced["municipioExpedicion"];
                $salida1["departamentoExpedicion"] = $ced["departamentoExpedicion"];
                if (trim($ced["fechaExpedicion"]) != '' && $ced["fechaExpedicion"] != 'null') {
                    $salida1["fechaExpedicion"] = substr($ced["fechaExpedicion"], 6, 4) . substr($ced["fechaExpedicion"], 3, 2) . substr($ced["fechaExpedicion"], 0, 2);
                }
                $salida1["estadoCedula"] = $ced["estadoCedula"];
                $salida1["numResolucion"] = $ced["numResolucion"];
                $salida1["anoResolucion"] = $ced["anoResolucion"];

                if (trim($ced["genero"]) != '' && $ced["genero"] != 'null') {
                    $salida1["genero"] = $ced["genero"];
                }
                if (trim($ced["fechaNacimiento"]) != '' && $ced["fechaNacimiento"] != 'null') {
                    $salida1["fechaNacimiento"] = substr($ced["fechaNacimiento"], 6, 4) . substr($ced["fechaNacimiento"], 3, 2) . substr($ced["fechaNacimiento"], 0, 2);
                }
                if (trim($ced["lugarNacimiento"]) != '' && $ced["lugarNacimiento"] != 'null') {
                    $salida1["lugarNacimiento"] = $ced["lugarNacimiento"];
                }
                if (trim($ced["informante"]) != '' && $ced["informante"] != 'null') {
                    $salida1["informante"] = $ced["informante"];
                }
                if (trim($ced["serial"]) != '' && $ced["serial"] != 'null') {
                    $salida1["serial"] = $ced["serial"];
                }
                if (trim($ced["fechaDefuncion"]) != '' && $ced["fechaDefuncion"] != 'null') {
                    $salida1["fechaDefuncion"] = substr($ced["fechaDefuncion"], 6, 4) . substr($ced["fechaDefuncion"], 3, 2) . substr($ced["fechaDefuncion"], 0, 2);
                }
                if (trim($ced["lugarNovedad"]) != '' && $ced["lugarNovedad"] != 'null') {
                    $salida1["lugarNovedad"] = $ced["lugarNovedad"];
                }
                if (trim($ced["lugarPreparacion"]) != '' && $ced["lugarPreparacion"] != 'null') {
                    $salida1["lugarPreparacion"] = $ced["lugarPreparacion"];
                }
                if (trim($ced["grupoSanguineo"]) != '' && $ced["grupoSanguineo"] != 'null') {
                    $salida1["grupoSanguineo"] = $ced["grupoSanguineo"];
                }
                if (trim($ced["estatura"]) != '' && $ced["estatura"] != 'null') {
                    $salida1["estatura"] = $ced["estatura"];
                }
            }
        }

        //
        $arrValores = array(
            "'" . date("Ymd") . "'",
            "'" . date("His") . "'",
            "'" . $tide . '-' . $ide . "'",
            "'" . $estadoConsulta . "'",
            "'" . addslashes($xml) . "'",
        );

        //
        insertarRegistrosMysqli2($dbx, 'mreg_ani_log', $arrCampos, $arrValores);

        //
        if ($error == 'no') {
            return $salida1;
        } else {
            return false;
        }
    }

    public static function convertirStringNumero($valx) {
        $valx = trim($valx);
        $val = 0;
        $signo = '+';
        $valx = str_replace(",", "", $valx);
        $valx = ltrim(trim($valx), "0");
        if ($valx == '' || $valx == '0.00' || $valx == '.00') {
            $val = 0;
        } else {
            if (substr($valx, 0, 1) == '-') {
                $signo = '-';
                $valx = str_replace("-", "", $valx);
            }
            $a = explode(".", $valx);
            $val = doubleval($a[0]);
            if (isset($a[1])) {
                $len = strlen($a[1]);
                switch ($len) {
                    case 1: $val = $val + intval($a[1]) / 10;
                        break;
                    case 2: $val = $val + intval($a[1]) / 100;
                        break;
                    case 3: $val = $val + intval($a[1]) / 1000;
                        break;
                    case 4: $val = $val + intval($a[1]) / 10000;
                        break;
                    case 5: $val = $val + intval($a[1]) / 100000;
                        break;
                }
            }
        }
        if ($signo == '-') {
            $val = $val * -1;
        }
        return $val;
    }

    public static function validarInhabilidad($mysqli, $nit, $proponente = '', $nombre = '', $observaciones = '') {

        require_once ('../../../configuracion/common.php');

        $fechabase = '20110712'; // Fecha de la entrada en vigencia de la Ley 1474
        $sepIde = \funcionesSii2::separarDv($nit);
        $identificacion = $sepIde["identificacion"];
        $dv = $sepIde["dv"];

        //
        $numinterno = date("Ymd") . date("His") . '001' . CODIGO_EMPRESA . '00' . '00000000';
        $usuario = $_SESSION["generales"]["codigousuario"];
        $res = \funcionesSii2::consultarReportes($mysqli, $numinterno, $usuario, $identificacion, $dv);

        // En caso de error 
        if ($res["codigoError"] != '0000') {
            $_SESSION["generales"]["mensajeerror"] = 'No es posible determinar la inhabilidad - ' . $res["msgError"];
            \funcionesSii2::validarInhabilidadGrabarLog($mysqli, $nit, $proponente, $nombre, '', '', $observaciones, $_SESSION["generales"]["mensajeerror"]);
            return false;
        }

        $arrAnos = array();

        // 2016-04-06: JINT: Verifica que cada multa sea contada solo una vez
        // Toma el último registro reportado por el RUES para cada caso.
        if (!empty($res["multas"])) {
            $multas = array();
            foreach ($res["multas"] as $m) {
                $ind = ltrim($m["nit_proponente"], "0") . '-' . ltrim($m["nit_entidad"], "0") . '-' . $m["municipio_entidad"] . '-' . ltrim($m["numero_contrato"] . '-' . $m["numero_acto_administrativo"], "0");
                $multas[$ind] = $m;
            }
            $res["multas"] = $multas;
        }

        // 2016-04-06: JINT: Verifica que cada sanción sea contada solo una vez
        // Toma el último registro reportado por el RUES para cada caso.
        if (!empty($res["sanciones"])) {
            $sanciones = array();
            foreach ($res["sanciones"] as $m) {
                $ind = ltrim($m["nit_proponente"], "0") . '-' . ltrim($m["nit_entidad"], "0") . '-' . $m["municipio_entidad"] . '-' . ltrim($m["numero_contrato"] . '-' . $m["numero_acto_administrativo"], "0");
                $sanciones[$ind] = $m;
            }
            $res["sanciones"] = $sanciones;
        }

        //
        if (!empty($res["multas"])) {
            foreach ($res["multas"] as $mul) {
                $fechacontrol = '';
                $anocontrol = '';
                if (ltrim($mul["fecha_ejecutoria"], "0") != '') {
                    $fechacontrol = $mul["fecha_ejecutoria"];
                    $anocontrol = substr($mul["fecha_ejecutoria"], 0, 4);
                } else {
                    $fechacontrol = $mul["fecha_acto_administrativo"];
                    $anocontrol = substr($mul["fecha_acto_administrativo"], 0, 4);
                }
                if (($mul["cod_estado"] == '0') || ($mul["cod_estado"] == '2')) {
                    if ($fechacontrol >= $fechabase) {
                        if (!isset($arrAnos[$anocontrol])) {
                            $arrAnos[$anocontrol]["anocontrol"] = $anocontrol;
                            $arrAnos[$anocontrol]["multas"] = 0;
                            $arrAnos[$anocontrol]["sanciones"] = 0;
                            $arrAnos[$anocontrol]["sinindicador"] = 0;
                            $arrAnos[$anocontrol]["fechaultimainscripcion"] = '';
                        }
                        $arrAnos[$anocontrol]["multas"] = $arrAnos[$anocontrol]["multas"] + 1;
                        if ($mul["fecha_inscripcion_camara"] > $arrAnos[$anocontrol]["fechaultimainscripcion"]) {
                            $arrAnos[$anocontrol]["fechaultimainscripcion"] = $mul["fecha_inscripcion_camara"];
                        }
                    }
                }
            }
        }

        //
        if (!empty($res["sanciones"])) {
            foreach ($res["sanciones"] as $san) {
                $fechacontrol = '';
                $anocontrol = '';
                if (ltrim($san["fecha_ejecutoria"], "0") != '') {
                    $fechacontrol = $san["fecha_ejecutoria"];
                    $anocontrol = substr($san["fecha_ejecutoria"], 0, 4);
                } else {
                    $fechacontrol = $san["fecha_acto_administrativo"];
                    $anocontrol = substr($san["fecha_acto_administrativo"], 0, 4);
                }
                if (($san["cod_estado"] == '0') || ($san["cod_estado"] == '2')) {
                    if (!isset($arrAnos[$anocontrol])) {
                        $arrAnos[$anocontrol]["anocontrol"] = $anocontrol;
                        $arrAnos[$anocontrol]["multas"] = 0;
                        $arrAnos[$anocontrol]["sanciones"] = 0;
                        $arrAnos[$anocontrol]["sinindicador"] = 0;
                        $arrAnos[$anocontrol]["fechaultimainscripcion"] = '';
                    }
                    if ($fechacontrol >= $fechabase) {
                        if (($san["condicion_incumplimiento"] == 'S') || ($san["condicion_incumplimiento"] == 's')) {
                            $arrAnos[$anocontrol]["sanciones"] = $arrAnos[$anocontrol]["sanciones"] + 1;
                            if ($san["fecha_inscripcion_camara"] > $arrAnos[$anocontrol]["fechaultimainscripcion"]) {
                                $arrAnos[$anocontrol]["fechaultimainscripcion"] = $san["fecha_inscripcion_camara"];
                            }
                        }
                        if ((trim($san["condicion_incumplimiento"]) == '') || ($san["condicion_incumplimiento"] == 'I') || ($san["condicion_incumplimiento"] == 'i')) {
                            $arrAnos[$anocontrol]["sinindicador"] = $arrAnos[$anocontrol]["sinindicador"] + 1;
                            if ($san["fecha_inscripcion_camara"] > $arrAnos[$anocontrol]["fechaultimainscripcion"]) {
                                $arrAnos[$anocontrol]["fechaultimainscripcion"] = $san["fecha_inscripcion_camara"];
                            }
                        }
                    }
                }
            }
        }

        //
        $resultado = array();
        $resultado["inhabilidad"] = 'no';
        $resultado["tipoinhabilidad"] = '';
        $resultado["ano"] = '';
        $resultado["multas"] = array();
        $resultado["sanciones"] = array();
        $resultado["sinindicador"] = array();
        $resultado["texto"] = array();
        $resultado["textosii"] = array();

        if (empty($arrAnos)) {
            return $resultado;
        }

        //
        $inhabilidad = 'no';
        $anoinhabilidad = '';
        foreach ($arrAnos as $an) {
            $hoy = date("Ymd");
            $anoini = intval(substr($hoy, 0, 4)) - 3;
            $fecini = sprintf("%04s", $anoini) . substr($hoy, 4, 4);
            if ($an["fechaultimainscripcion"] >= $fecini) {
                if ($an["multas"] >= 5) {
                    $inhabilidad = 'si1';
                    $anoinhabilidad = $an["anocontrol"];
                } else {
                    if (($an["multas"] >= 0) && ($an["sanciones"] >= 2)) {
                        $inhabilidad = 'si2';
                        $anoinhabilidad = $an["anocontrol"];
                    } else {
                        if (($an["multas"] >= 2) && ($an["sanciones"] >= 1)) {
                            $inhabilidad = 'si3';
                            $anoinhabilidad = $an["anocontrol"];
                        }
                    }
                }
                if ($inhabilidad == 'no') {
                    if (($an["multas"] >= 0) && (($an["sanciones"] + $an["sinindicador"]) >= 2)) {
                        $inhabilidad = 'duda2';
                        $anoinhabilidad = $an["anocontrol"];
                    }
                    if (($an["multas"] >= 2) && (($an["sanciones"] + $an["sinindicador"]) >= 1)) {
                        $inhabilidad = 'duda3';
                        $anoinhabilidad = $an["anocontrol"];
                    }
                }
            }
        }

        if (($inhabilidad == 'si1') || ($inhabilidad == 'si2') || ($inhabilidad == 'si3')) {
            $resultado["inhabilidad"] = 'si';
            $resultado["ano"] = $anoinhabilidad;
            foreach ($res["multas"] as $mul) {
                $fechacontrol = '';
                $anocontrol = '';
                if (ltrim($mul["fecha_ejecutoria"], "0") != '') {
                    $fechacontrol = $mul["fecha_ejecutoria"];
                    $anocontrol = substr($mul["fecha_ejecutoria"], 0, 4);
                } else {
                    $fechacontrol = $mul["fecha_acto_administrativo"];
                    $anocontrol = substr($mul["fecha_acto_administrativo"], 0, 4);
                }
                if (($mul["cod_estado"] == '0') || ($mul["cod_estado"] == '2')) {
                    if ($fechacontrol >= $fechabase) {
                        if (substr($fechacontrol, 0, 4) == $anoinhabilidad) {
                            $resultado["multas"][] = $mul;
                        }
                    }
                }
            }
            foreach ($res["sanciones"] as $san) {
                $fechacontrol = '';
                $anocontrol = '';
                if (ltrim($san["fecha_ejecutoria"], "0") != '') {
                    $fechacontrol = $san["fecha_ejecutoria"];
                    $anocontrol = substr($san["fecha_ejecutoria"], 0, 4);
                } else {
                    $fechacontrol = $san["fecha_acto_administrativo"];
                    $anocontrol = substr($san["fecha_acto_administrativo"], 0, 4);
                }
                if (($san["cod_estado"] == '0') || ($san["cod_estado"] == '2')) {
                    if ($fechacontrol >= $fechabase) {
                        if (substr($fechacontrol, 0, 4) == $anoinhabilidad) {
                            if (($san["condicion_incumplimiento"] == 'S') || ($san["condicion_incumplimiento"] == 's')) {
                                $resultado["sanciones"][] = $san;
                            }
                        }
                        if ((trim($san["condicion_incumplimiento"]) == '') || ($san["condicion_incumplimiento"] == 'I') || ($san["condicion_incumplimiento"] == 'i')) {
                            $resultado["sinindicador"][] = $san;
                        }
                    }
                }
            }
        }

        if (($inhabilidad == 'duda2') || ($inhabilidad == 'duda3')) {
            $resultado["inhabilidad"] = 'duda';
            $resultado["ano"] = $anoinhabilidad;
            foreach ($res["multas"] as $mul) {
                $fechacontrol = '';
                $anocontrol = '';
                if (ltrim($mul["fechaejecutoria"], "0") != '') {
                    $fechacontrol = $mul["fechaejecutoria"];
                    $anocontrol = substr($mul["fechaejecutoria"], 0, 4);
                } else {
                    $fechacontrol = $mul["fecha_acto_administrativo"];
                    $anocontrol = substr($mul["fecha_acto_administrativo"], 0, 4);
                }
                if (($mul["codestado"] == '0') || ($mul["codestado"] == '2')) {
                    if ($fechacontrol >= $fechabase) {
                        if (substr($fechacontrol, 0, 4) == $anoinhabilidad) {
                            $resultado["multas"][] = $mul;
                        }
                    }
                }
            }
            foreach ($res["sanciones"] as $san) {
                $fechacontrol = '';
                $anocontrol = '';
                if (ltrim($san["fechaejecutoria"], "0") != '') {
                    $fechacontrol = $san["fechaejecutoria"];
                    $anocontrol = substr($san["fechaejecutoria"], 0, 4);
                } else {
                    $fechacontrol = $san["fecha_acto_administrativo"];
                    $anocontrol = substr($san["fecha_acto_administrativo"], 0, 4);
                }
                if (($san["codestado"] == '0') || ($san["codestado"] == '2')) {
                    if ($fechacontrol >= $fechabase) {
                        if (substr($fechacontrol, 0, 4) == $anoinhabilidad) {
                            if (($san["condicion_incumplimiento"] == 'S') || ($san["condicion_incumplimiento"] == 's')) {
                                $resultado["sanciones"][] = $san;
                            }
                        }
                        if ((trim($san["condicion_incumplimiento"]) == '') || ($san["condicion_incumplimiento"] == 'I') || ($san["condicion_incumplimiento"] == 'i')) {
                            $resultado["sinindicador"][] = $san;
                        }
                    }
                }
            }
        }

        if ($resultado["inhabilidad"] == 'si') {
            $resultado["tipoinhabilidad"] = $inhabilidad;
            // 			 12345678901234567890123456789012345678901234567890123456789012345
            $resultado["texto"][] = '        CERTIFICACION DE INCUMPLIMIENTO REITERADO';
            $resultado["texto"][] = '';
            $resultado["texto"][] = 'QUE DE ACUERDO CON LO DISPUESTO EN EL ARTICULO 90 DE LA  LEY 1474';
            $resultado["texto"][] = 'DE JULIO 12 DE 2011 Y CON LO DISPUESTO EN LOS PARAGRAFOS 2-4  DEL';
            $resultado["texto"][] = 'ARTICULO 6.1.3.5 DEL DECRETO 734 DE 2012:';
            $resultado["texto"][] = '';
            $resultado["texto"][] = 'EL INSCRITO REGISTRA MULTAS E INCUMPLIMIENTOS, REPORTADOS POR LAS';
            $resultado["texto"][] = 'ENTIDADES ESTATALES, DURANTE LA VIGENCIA FISCAL DEL A&ntilde;O ' . $resultado["ano"] . ' Y EN';
            $resultado["texto"][] = 'CONSECUENCIA SE ENCUENTRA INCURSO EN INHABILIDAD POR INCUMPLIMIEN';
            $resultado["texto"][] = 'TO REITERADO, POR EL TERMINO DE TRES (3) A&ntilde;OS CONTADOS  A  PARTIR';
            $resultado["texto"][] = 'DE LA INSCRIPCION DEL ULTIMO ACTO QUE IMPONE LA MULTA  O  DECLARA';
            $resultado["texto"][] = 'TORIA DE INCUMPLIMIENTO.';
            $resultado["texto"][] = '';
            $resultado["texto"][] = 'LA   INHABILIDAD   POR  INCUMPLIMIENTO  REITERADO  SE  CONSTITUYO';
            $resultado["texto"][] = 'TENIENDO EN CUENTA LAS SIGUIENTES MULTAS E INCUMPLIMIENTOS:';
            $resultado["texto"][] = '';

            // 			 12345678901234567890123456789012345678901234567890123456789012345
            $resultado["textosii"][0] = 'CERTIFICACION DE INCUMPLIMIENTO REITERADO';

            //
            $resultado["textosii"][1] = 'QUE DE ACUERDO CON LO DISPUESTO EN EL ARTICULO 90 DE LA  LEY 1474 ';
            $resultado["textosii"][1] .= 'DE JULIO 12 DE 2011 Y CON LO DISPUESTO EN LOS PARAGRAFOS 2-4 DEL ';
            $resultado["textosii"][1] .= 'ARTICULO 6.1.3.5 DEL DECRETO 734 DE 2012:<br><br>';
            $resultado["textosii"][1] .= 'EL INSCRITO REGISTRA MULTAS E INCUMPLIMIENTOS, REPORTADOS POR LAS ';
            $resultado["textosii"][1] .= 'ENTIDADES ESTATALES, DURANTE LA VIGENCIA FISCAL DEL A&ntilde;O ' . $resultado["ano"] . ' Y EN ';
            $resultado["textosii"][1] .= 'CONSECUENCIA SE ENCUENTRA INCURSO EN INHABILIDAD POR INCUMPLIMIENTO ';
            $resultado["textosii"][1] .= 'REITERADO, POR EL TERMINO DE TRES (3) A&ntilde;OS CONTADOS  A  PARTIR ';
            $resultado["textosii"][1] .= 'DE LA INSCRIPCION DEL ULTIMO ACTO QUE IMPONE LA MULTA  O  DECLARATORIA ';
            $resultado["textosii"][1] .= 'DE INCUMPLIMIENTO.<br><br>';
            $resultado["textosii"][1] .= 'LA INHABILIDAD POR INCUMPLIMIENTO REITERADO SE CONSTITUYO ';
            $resultado["textosii"][1] .= 'TENIENDO EN CUENTA LAS SIGUIENTES MULTAS E INCUMPLIMIENTOS:<br><br>';
        }

        //if (($resultado["inhabilidad"]=='si')  || ($resultado["inhabilidad"]=='duda')) {
        if ($resultado["inhabilidad"] == 'si') {
            if (!empty($resultado["multas"])) {
                $resultado["textosii"][2] = '';
            }
            foreach ($resultado["multas"] as $mul) {
                $resultado["texto"][] = '*** MULTA:';
                $resultado["texto"][] = 'NIT ENTIDAD : ' . $mul["nit_entidad"] . '-' . $mul["dv_entidad"];
                $resultado["texto"][] = 'NOMBRE : ' . substr($mul["nombre_entidad"], 0, 57);
                $resultado["texto"][] = 'MUNICIPIO : ' . retornarNombreMunicipioMysqli2($mysqli, $mul["municipio_entidad"]);
                $resultado["texto"][] = 'SECCIONAL : ' . $mul["seccional_entidad"];
                $resultado["texto"][] = 'NUMERO CONTRATO : ' . $mul["numero_contrato"];
                $resultado["texto"][] = 'ACTO ADMINISTRATIVO : ' . $mul["numero_acto_administrativo"];
                $resultado["texto"][] = 'FECHA ACTO ADMINISTRATIVO : ' . $mul["fecha_acto_administrativo"];
                $resultado["texto"][] = 'FECHA EJECUTORIA : ' . $mul["fecha_ejecutoria"];
                $resultado["texto"][] = 'VALOR MULTA : ' . $mul["valor_multa"];
                $resultado["texto"][] = 'INSCRITA EN LA CAMARA DE COMERCIO NO. : ' . $mul["codigo_camara"];
                $resultado["texto"][] = 'EN FECHA : ' . $mul["fecha_inscripcion_camara"];
                $resultado["texto"][] = 'NUMERO DE INSCRIPCION : ' . $mul["numero_inscripcion_libro"];
                $resultado["texto"][] = '';

                //
                $resultado["textosii"][2] .= '<strong>*** MULTA:</strong><br>';
                $resultado["textosii"][2] .= 'NIT ENTIDAD : ' . $mul["nit_entidad"] . '-' . $mul["dv_entidad"] . '<br>';
                $resultado["textosii"][2] .= 'NOMBRE : ' . substr($mul["nombre_entidad"], 0, 57) . '<br>';
                $resultado["textosii"][2] .= 'MUNICIPIO : ' . retornarNombreMunicipioMysqli2($mysqli, $mul["municipio_entidad"]) . '<br>';
                $resultado["textosii"][2] .= 'SECCIONAL : ' . $mul["seccional_entidad"] . '<br>';
                $resultado["textosii"][2] .= 'NUMERO CONTRATO : ' . $mul["numero_contrato"] . '<br>';
                $resultado["textosii"][2] .= 'ACTO ADMINISTRATIVO : ' . $mul["numero_acto_administrativo"] . '<br>';
                $resultado["textosii"][2] .= 'FECHA ACTO ADMINISTRATIVO : ' . $mul["fecha_acto_administrativo"] . '<br>';
                $resultado["textosii"][2] .= 'FECHA EJECUTORIA : ' . $mul["fecha_ejecutoria"] . '<br>';
                $resultado["textosii"][2] .= 'VALOR MULTA : ' . $mul["valor_multa"] . '<br>';
                $resultado["textosii"][2] .= 'INSCRITA EN LA CAMARA DE COMERCIO NO. : ' . $mul["codigo_camara"] . '<br>';
                $resultado["textosii"][2] .= 'EN FECHA : ' . $mul["fecha_inscripcion_camara"] . '<br>';
                $resultado["textosii"][2] .= 'NUMERO DE INSCRIPCION : ' . $mul["numero_inscripcion_libro"] . '<br><br>';
            }

            if (!empty($resultado["sanciones"])) {
                $resultado["textosii"][3] = '';
            }
            foreach ($resultado["sanciones"] as $san) {

                //
                $san["descripcion"] = sprintf("%-600s", $san["descripcion"]);
                $resultado["texto"][] = '*** SANCION :';
                $resultado["texto"][] = 'NIT ENTIDAD : ' . $san["nit_entidad"] . '-' . $san["dv_entidad"];
                $resultado["texto"][] = 'NOMBRE : ' . substr($san["nombre_entidad"], 0, 57);
                $resultado["texto"][] = 'MUNICIPIO : ' . retornarNombreMunicipioMysqli2($mysqli, $san["municipio_entidad"]);
                $resultado["texto"][] = 'SECCIONAL : ' . $san["seccional_entidad"];
                $resultado["texto"][] = 'NUMERO CONTRATO : ' . $san["numero_contrato"];
                $resultado["texto"][] = 'ACTO ADMINISTRATIVO : ' . $san["numero_acto_administrativo"];
                $resultado["texto"][] = 'FECHA ACTO ADMINISTRATIVO : ' . $san["fecha_acto_administrativo"];
                $resultado["texto"][] = 'FECHA EJECUTORIA : ' . $san["fecha_ejecutoria"];
                $resultado["texto"][] = 'DESCRIPCION SANCION : ' . substr($san["descripcion_sancion"], 0, 44);
                if (trim(substr($san["descripcion"], 44, 65)) != '') {
                    $resultado["texto"][] = substr($san["descripcion"], 44, 65);
                }
                if (trim(substr($san["descripcion"], 109, 65)) != '') {
                    $resultado["texto"][] = substr($san["descripcion"], 109, 65);
                }
                if (trim(substr($san["descripcion"], 174, 65)) != '') {
                    $resultado["texto"][] = substr($san["descripcion"], 174, 65);
                }
                if (trim(substr($san["descripcion"], 239, 65)) != '') {
                    $resultado["texto"][] = substr($san["descripcion"], 239, 65);
                }
                if (trim(substr($san["descripcion"], 304, 65)) != '') {
                    $resultado["texto"][] = substr($san["descripcion"], 304, 65);
                }
                if (trim(substr($san["descripcion"], 369, 65)) != '') {
                    $resultado["texto"][] = substr($san["descripcion"], 369, 65);
                }
                $resultado["texto"][] = 'INSCRITA EN LA CAMARA DE COMERCIO NO. : ' . $san["codigo_camara"];
                $resultado["texto"][] = 'EN FECHA : ' . $san["fecha_inscripcion_camara"];
                $resultado["texto"][] = 'NUMERO DE INSCRIPCION : ' . $san["numero_inscripcion_libro"];
                $resultado["texto"][] = '';

                //
                $resultado["textosii"][3] .= '<strong>*** SANCION :</strong><br>';
                $resultado["textosii"][3] .= 'NIT ENTIDAD : ' . $san["nit_entidad"] . '-' . $san["dv_entidad"] . '<br>';
                $resultado["textosii"][3] .= 'NOMBRE : ' . substr($san["nombre_entidad"], 0, 57) . '<br>';
                $resultado["textosii"][3] .= 'MUNICIPIO : ' . retornarNombreMunicipioMysqli2($mysqli, $san["municipio_entidad"]) . '<br>';
                $resultado["textosii"][3] .= 'SECCIONAL : ' . $san["seccional_entidad"] . '<br>';
                $resultado["textosii"][3] .= 'NUMERO CONTRATO : ' . $san["numero_contrato"] . '<br>';
                $resultado["textosii"][3] .= 'ACTO ADMINISTRATIVO : ' . $san["numero_acto_administrativo"] . '<br>';
                $resultado["textosii"][3] .= 'FECHA ACTO ADMINISTRATIVO : ' . $san["fecha_acto_administrativo"] . '<br>';
                $resultado["textosii"][3] .= 'FECHA EJECUTORIA : ' . $san["fecha_ejecutoria"] . '<br>';
                $resultado["textosii"][3] .= 'DESCRIPCION SANCION : ' . trim($san["descripcion_sancion"]) . '<br>';
                $resultado["textosii"][3] .= 'INSCRITA EN LA CAMARA DE COMERCIO NO. : ' . $san["codigo_camara"] . '<br>';
                $resultado["textosii"][3] .= 'EN FECHA : ' . $san["fecha_inscripcion_camara"] . '<br>';
                $resultado["textosii"][3] .= 'NUMERO DE INSCRIPCION : ' . $san["numero_inscripcion_libro"] . '<br><br>';
            }

            if (!empty($resultado["sinindicador"])) {
                $resultado["textosii"][4] = '';
            }
            foreach ($resultado["sinindicador"] as $san) {
                $san["descripcion"] = sprintf("%-600s", $san["descripcion"]);
                $resultado["texto"][] = '*** SANCION SIN INDICADOR DE INCUMPLIMIENTO :';
                $resultado["texto"][] = 'NIT ENTIDAD : ' . $san["nit_entidad"] . '-' . $san["dv_entidad"];
                $resultado["texto"][] = 'NOMBRE : ' . substr($san["nombre_entidad"], 0, 57);
                $resultado["texto"][] = 'MUNICIPIO : ' . retornarNombreMunicipioMysqli2($mysqli, $san["municipio_entidad"]);
                $resultado["texto"][] = 'NUMERO CONTRATO : ' . $san["numero_contrato"];
                $resultado["texto"][] = 'ACTO ADMINISTRATIVO : ' . $san["numero_acto_administrativo"];
                $resultado["texto"][] = 'SECCIONAL : ' . $san["seccional_entidad"];
                $resultado["texto"][] = 'FECHA ACTO ADMINISTRATIVO : ' . $san["fecha_acto_administrativo"];
                $resultado["texto"][] = 'FECHA EJECUTORIA : ' . $san["fecha_ejecutoria"];
                $resultado["texto"][] = 'DESCRIPCION SANCION: ' . substr($san["descripcion"], 0, 44);
                if (trim(substr($san["descripcion"], 44, 65)) != '') {
                    $resultado["texto"][] = substr($san["descripcion"], 44, 65);
                }
                if (trim(substr($san["descripcion"], 109, 65)) != '') {
                    $resultado["texto"][] = substr($san["descripcion"], 109, 65);
                }
                if (trim(substr($san["descripcion"], 174, 65)) != '') {
                    $resultado["texto"][] = substr($san["descripcion"], 174, 65);
                }
                if (trim(substr($san["descripcion"], 239, 65)) != '') {
                    $resultado["texto"][] = substr($san["descripcion"], 239, 65);
                }
                if (trim(substr($san["descripcion"], 304, 65)) != '') {
                    $resultado["texto"][] = substr($san["descripcion"], 304, 65);
                }
                if (trim(substr($san["descripcion"], 369, 65)) != '') {
                    $resultado["texto"][] = substr($san["descripcion"], 369, 65);
                }
                $resultado["texto"][] = 'INSCRITA EN LA CAMARA DE COMERCIO NO. : ' . $san["codigo_camara"];
                $resultado["texto"][] = 'EN FECHA : ' . $san["fecha_inscripcion_camara"];
                $resultado["texto"][] = 'NUMERO DE INSCRIPCION : ' . $san["numero_inscripcion_libro"];
                $resultado["texto"][] = '';

                //
                $resultado["textosii"][4] .= '<strong>*** SANCION SIN INDICADOR DE INCUMPLIMIENTO :</strong><br>';
                $resultado["textosii"][4] .= 'NIT ENTIDAD : ' . $san["nit_entidad"] . '-' . $san["dv_entidad"] . '<br>';
                $resultado["textosii"][4] .= 'NOMBRE : ' . substr($san["nombre_entidad"], 0, 57) . '<br>';
                $resultado["textosii"][4] .= 'MUNICIPIO : ' . retornarNombreMunicipioMysqli2($mysqli, $san["municipio_entidad"]) . '<br>';
                $resultado["textosii"][4] .= 'ACTO ADMINISTRATIVO : ' . $san["numero_acto_administrativo"] . '<br>';
                $resultado["textosii"][4] .= 'SECCIONAL : ' . $san["seccional_entidad"] . '<br>';
                $resultado["textosii"][4] .= 'NUMERO CONTRATO : ' . $san["numero_contrato"] . '<br>';
                $resultado["textosii"][4] .= 'FECHA ACTO ADMINISTRATIVO : ' . $san["fecha_acto_administrativo"] . '<br>';
                $resultado["textosii"][4] .= 'FECHA EJECUTORIA : ' . $san["fecha_ejecutoria"] . '<br>';
                $resultado["textosii"][4] .= 'DESCRIPCION SANCION: ' . trim($san["descripcion"]) . '<br>';
                $resultado["textosii"][4] .= 'INSCRITA EN LA CAMARA DE COMERCIO NO. : ' . $san["codigo_camara"] . '<br>';
                $resultado["textosii"][4] .= 'EN FECHA : ' . $san["fecha_inscripcion_camara"] . '<br>';
                $resultado["textosii"][4] .= 'NUMERO DE INSCRIPCION : ' . $san["numero_inscripcion_libro"] . '<br><br>';
            }
        }

        // 2018-02-05: JINT: Almacena el log del cálculo de la inhabilidad del proponente
        $txt = '';
        foreach ($resultado["textosii"] as $tx) {
            $txt .= $tx . '<br><br>';
        }
        \funcionesSii2::validarInhabilidadGrabarLog($mysqli, $nit, $proponente, $nombre, $resultado["inhabilidad"], $txt, $observaciones, 'OK');

        //
        return $resultado;
    }

    // 2018-02-05: JINT: Graba log con el resultado del cálculo de la inhabilidad
    public static function validarInhabilidadGrabarLog($mysqli, $nit, $proponente, $nombre, $inh, $txt, $observaciones, $complemento) {
        $arrCampos = array(
            'fecha',
            'hora',
            'nit',
            'proponente',
            'nombre',
            'inhabilidad',
            'texto',
            'estadosirep'
        );
        $arrValores = array(
            "'" . date("Ymd") . "'",
            "'" . date("His") . "'",
            "'" . $nit . "'",
            "'" . $proponente . "'",
            "'" . addslashes($nombre) . "'",
            "'" . $inh . "'",
            "'" . addslashes($txt) . "'",
            "'" . addslashes($observaciones . ' : ' . $complemento) . "'"
        );
        insertarRegistrosMysqli2($mysqli, 'mreg_log_control_inhabilidades_proponentes', $arrCampos, $arrValores);
    }

    public static function separarDv($id) {
        $id = str_replace(",", "", ltrim(trim($id), "0"));
        $id = str_replace(".", "", $id);
        $id = str_replace("-", "", $id);
        $entrada = sprintf("%016s", $id);
        $dv = substr($entrada, 15, 1);
        return array(
            'identificacion' => ltrim(substr($entrada, 0, 15), "0"),
            'dv' => $dv);
    }

    public static function consultarReportes($numinterno, $usuario, $numid, $dv) {


        require_once ('../../../configuracion/common.php');

        $respuesta = array();
        $respuesta["codigoError"] = '0000';
        $respuesta["msgError"] = '';

        $RUE_ConsultaHistoriaProponente_BC = array(
            "numero_interno" => $numinterno,
            'usuario' => $usuario,
            'nit_proponente' => $numid,
            'dv_proponente' => $dv
        );

        $wsdl = URL_RUE_WS . "_DL/RR17N.asmx?WSDL";

        // Instancia el servicio web
        try {
            $client = new SoapClient($wsdl, array('trace' => true, 'exceptions' => true, 'encoding' => 'ISO-8859-1'));
            if (is_soap_fault($client)) {
                $respuesta["codigoError"] = '0001';
                $respuesta["msgError"] = 'No fue posible crear la conexi&oacute;n con el servicio web  de consulta historia de proponentes ';
                \logSii2::general2('consultarReportesRue', 'Error Soap ', 'Error consultando el proponente ' . $numid . ' - ' . $respuesta["msgError"]);
                return $respuesta;
            }
        } catch (Exception $e) {
            $respuesta["codigoError"] = '0002';
            $respuesta["msgError"] = 'Error de excepci&oacute;n instanciando el servico web :  ' . $e->getMessage();
            \logSii2::general2('consultarReportesRue', 'Error de excepci&oacute;n instanciando el servico web ', 'Error consultando el proponente ' . $numid . ' - ' . $e->getMessage());
            return $respuesta;
        } catch (SoapFault $fault) {
            $respuesta["codigoError"] = '0003';
            \logSii2::general2('consultarReportesRue', 'Error Soap Fault ', 'Error consultando el proponente ' . $numid . ' - ' . $e->getMessage());
            return $respuesta;
        }

        try {
            $result = $client->consultaHistoriaProponente(array("consultaHistorialProponente" => $RUE_ConsultaHistoriaProponente_BC));
            if ($result === false) {
                $respuesta["codigoError"] = '0004';
                $respuesta["msgError"] = 'Error en la respuesta del servico web ' . $result;
                \logSii2::general2('consultarReportesRue', 'Client Error ', 'Error consultando el proponente ' . $numid . ' - ' . $result);
                return $respuesta;
            }
        } catch (Exception $e) {
            $respuesta["codigoError"] = '0002';
            \logSii2::general2('consultarReportesRue', 'Client Exception Error', 'Error consultando el proponente ' . $numid . ' - ' . $e->getMessage());
            return $respuesta;
        }

        $t = (array) $result;
        \logSii2::general2('consultarReportesRue', 'Respuesta correcta', 'Proponente ' . $numid . ' - ' . print_r($t, true));
        if (ltrim($t["RUE_ConsultaHistoriaProponente_BC"]->codigo_error, "0") != '') {
            $respuesta["codigoError"] = $t["RUE_ConsultaHistoriaProponente_BC"]->codigo_error;
            $respuesta["msgError"] = $t["RUE_ConsultaHistoriaProponente_BC"]->mensaje_error;
            \logSii2::general2('consultarReportesRue', 'Error en Respuesta', 'Error consultando el proponente ' . $numid . ' - ' . $respuesta["codigoError"] . ' - ' . $respuesta["msgError"]);
        } else {
            $iCnt = 0;
            $respuesta["contratos"] = array();
            $respuesta["multas"] = array();
            $respuesta["sanciones"] = array();

            if (isset($t["RUE_ConsultaHistoriaProponente_BC"]->contratos)) {
                if (is_array($t["RUE_ConsultaHistoriaProponente_BC"]->contratos)) {
                    foreach ($t["RUE_ConsultaHistoriaProponente_BC"]->contratos as $cnt) {
                        $iCnt++;
                        $respuesta["contratos"][$iCnt]["cod_indicador_envio"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->cod_indicador_envio);
                        $respuesta["contratos"][$iCnt]["nit_proponente"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->nit_proponente);
                        $respuesta["contratos"][$iCnt]["dv_proponente"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->dv_proponente);
                        $respuesta["contratos"][$iCnt]["nit_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->nit_entidad);
                        $respuesta["contratos"][$iCnt]["dv_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->dv_entidad);
                        $respuesta["contratos"][$iCnt]["municipio_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->municipio_entidad);
                        $respuesta["contratos"][$iCnt]["numero_contrato"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->numero_contrato);
                        $respuesta["contratos"][$iCnt]["nombre_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->nombre_entidad);
                        $respuesta["contratos"][$iCnt]["nombre_proponente"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->nombre_proponente);
                        $respuesta["contratos"][$iCnt]["seccional_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->seccional_entidad);
                        $respuesta["contratos"][$iCnt]["fecha_adjudicacion"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->fecha_adjudicacion);
                        $respuesta["contratos"][$iCnt]["fecha_perfeccionamiento"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->fecha_perfeccionamiento);
                        $respuesta["contratos"][$iCnt]["fecha_inicio"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->fecha_inicio);
                        $respuesta["contratos"][$iCnt]["fecha_terminacion"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->fecha_terminacion);
                        $respuesta["contratos"][$iCnt]["fecha_liquidacion"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->fecha_liquidacion);
                        $respuesta["contratos"][$iCnt]["valor_contrato"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->valor_contrato);
                        $respuesta["contratos"][$iCnt]["valor_pagado"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->valor_pagado);
                        $respuesta["contratos"][$iCnt]["cod_estado_contrato"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->cod_estado_contrato);
                        $respuesta["contratos"][$iCnt]["cod_tipo_contratista"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->cod_tipo_contratista);
                        $respuesta["contratos"][$iCnt]["motivo_terminacion_anticipada"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->motivo_terminacion_anticipada);
                        $respuesta["contratos"][$iCnt]["fecha_terminacion_anticipada"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->fecha_terminacion_anticipada);
                        $respuesta["contratos"][$iCnt]["cod_actividad"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->cod_actividad);
                        $respuesta["contratos"][$iCnt]["observaciones"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->observaciones);
                        $respuesta["contratos"][$iCnt]["codigo_camara"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->codigo_camara);
                        $respuesta["contratos"][$iCnt]["codigo_libro_registro"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->codigo_libro_registro);
                        $respuesta["contratos"][$iCnt]["numero_inscripcion_camara"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->numero_inscripcion_camara);
                        $respuesta["contratos"][$iCnt]["fecha_inscripcion_camara"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->fecha_inscripcion_camara);
                        $respuesta["contratos"][$iCnt]["clasificasiones1464"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->clasificasiones1464);
                        $respuesta["contratos"][$iCnt]["numero_radicacion_rue"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->numero_radicacion_rue);
                        $respuesta["contratos"][$iCnt]["nueva_fechareporte"] = '';
                        $respuesta["contratos"][$iCnt]["nueva_libro"] = '';
                        $respuesta["contratos"][$iCnt]["nueva_inscripcion"] = '';
                        $respuesta["contratos"][$iCnt]["nueva_fechainscripcion"] = '';
                    }
                } else {
                    $iCnt++;
                    $respuesta["contratos"][$iCnt]["cod_indicador_envio"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->cod_indicador_envio);
                    $respuesta["contratos"][$iCnt]["nit_proponente"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->nit_proponente);
                    $respuesta["contratos"][$iCnt]["dv_proponente"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->dv_proponente);
                    $respuesta["contratos"][$iCnt]["nit_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->nit_entidad);
                    $respuesta["contratos"][$iCnt]["dv_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->dv_entidad);
                    $respuesta["contratos"][$iCnt]["municipio_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->municipio_entidad);
                    $respuesta["contratos"][$iCnt]["numero_contrato"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->numero_contrato);
                    $respuesta["contratos"][$iCnt]["nombre_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->nombre_entidad);
                    $respuesta["contratos"][$iCnt]["nombre_proponente"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->nombre_proponente);
                    $respuesta["contratos"][$iCnt]["seccional_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->seccional_entidad);
                    $respuesta["contratos"][$iCnt]["fecha_adjudicacion"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->fecha_adjudicacion);
                    $respuesta["contratos"][$iCnt]["fecha_perfeccionamiento"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->fecha_perfeccionamiento);
                    $respuesta["contratos"][$iCnt]["fecha_inicio"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->fecha_inicio);
                    $respuesta["contratos"][$iCnt]["fecha_terminacion"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->fecha_terminacion);
                    $respuesta["contratos"][$iCnt]["fecha_liquidacion"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->fecha_liquidacion);
                    $respuesta["contratos"][$iCnt]["valor_contrato"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->valor_contrato);
                    $respuesta["contratos"][$iCnt]["valor_pagado"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->valor_pagado);
                    $respuesta["contratos"][$iCnt]["cod_estado_contrato"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->cod_estado_contrato);
                    $respuesta["contratos"][$iCnt]["cod_tipo_contratista"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->cod_tipo_contratista);
                    $respuesta["contratos"][$iCnt]["motivo_terminacion_anticipada"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->motivo_terminacion_anticipada);
                    $respuesta["contratos"][$iCnt]["fecha_terminacion_anticipada"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->fecha_terminacion_anticipada);
                    $respuesta["contratos"][$iCnt]["cod_actividad"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->cod_actividad);
                    $respuesta["contratos"][$iCnt]["observaciones"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->observaciones);
                    $respuesta["contratos"][$iCnt]["codigo_camara"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->codigo_camara);
                    $respuesta["contratos"][$iCnt]["codigo_libro_registro"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->codigo_libro_registro);
                    $respuesta["contratos"][$iCnt]["numero_inscripcion_camara"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->numero_inscripcion_camara);
                    $respuesta["contratos"][$iCnt]["fecha_inscripcion_camara"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->fecha_inscripcion_camara);
                    $respuesta["contratos"][$iCnt]["clasificasiones1464"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->clasificasiones1464);
                    $respuesta["contratos"][$iCnt]["numero_radicacion_rue"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->contratos->numero_radicacion_rue);
                    $respuesta["contratos"][$iCnt]["nueva_fechareporte"] = '';
                    $respuesta["contratos"][$iCnt]["nueva_libro"] = '';
                    $respuesta["contratos"][$iCnt]["nueva_inscripcion"] = '';
                    $respuesta["contratos"][$iCnt]["nueva_fechainscripcion"] = '';
                }
            }
            $iCnt = 0;
            if (isset($t["RUE_ConsultaHistoriaProponente_BC"]->multas)) {
                if (is_array($t["RUE_ConsultaHistoriaProponente_BC"]->multas)) {
                    foreach ($t["RUE_ConsultaHistoriaProponente_BC"]->multas as $cnt) {
                        $iCnt++;
                        $respuesta["multas"][$iCnt]["cod_indicador_envio"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->cod_indicador_envio);
                        $respuesta["multas"][$iCnt]["nit_proponente"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->nit_proponente);
                        $respuesta["multas"][$iCnt]["dv_proponente"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->dv_proponente);
                        $respuesta["multas"][$iCnt]["nit_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->nit_entidad);
                        $respuesta["multas"][$iCnt]["dv_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->dv_entidad);
                        $respuesta["multas"][$iCnt]["municipio_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->municipio_entidad);
                        $respuesta["multas"][$iCnt]["numero_contrato"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->numero_contrato);
                        $respuesta["multas"][$iCnt]["nombre_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->nombre_entidad);
                        $respuesta["multas"][$iCnt]["nombre_proponente"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->nombre_proponente);
                        $respuesta["multas"][$iCnt]["seccional_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->seccional_entidad);
                        $respuesta["multas"][$iCnt]["numero_acto_administrativo"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->numero_acto_administrativo);
                        $respuesta["multas"][$iCnt]["fecha_acto_administrativo"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->fecha_acto_administrativo);
                        $respuesta["multas"][$iCnt]["fecha_ejecutoria"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->fecha_ejecutoria);
                        $respuesta["multas"][$iCnt]["valor_multa"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->valor_multa);
                        $respuesta["multas"][$iCnt]["valor_pagado_multa"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->valor_pagado_multa);
                        $respuesta["multas"][$iCnt]["cod_estado"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->cod_estado);
                        $respuesta["multas"][$iCnt]["numero_acto_suspension"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->numero_acto_suspension);
                        $respuesta["multas"][$iCnt]["fecha_acto_suspension"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->fecha_acto_suspension);
                        $respuesta["multas"][$iCnt]["numero_acto_confirmacion"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->numero_acto_confirmacion);
                        $respuesta["multas"][$iCnt]["fecha_acto_confirmacion"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->fecha_acto_confirmacion);
                        $respuesta["multas"][$iCnt]["numero_acto_revocacion"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->numero_acto_revocacion);
                        $respuesta["multas"][$iCnt]["fecha_acto_revocacion"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->fecha_acto_revocacion);
                        $respuesta["multas"][$iCnt]["observaciones"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->observaciones);
                        $respuesta["multas"][$iCnt]["codigo_camara"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->codigo_camara);
                        $respuesta["multas"][$iCnt]["codigo_libro_registro"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->codigo_libro_registro);
                        $respuesta["multas"][$iCnt]["numero_inscripcion_libro"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->numero_inscripcion_libro);
                        $respuesta["multas"][$iCnt]["fecha_inscripcion_camara"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->fecha_inscripcion_camara);
                        $respuesta["multas"][$iCnt]["numero_radicacion_rue"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->numero_radicacion_rue);
                        $respuesta["multas"][$iCnt]["nueva_fechareporte"] = '';
                        $respuesta["multas"][$iCnt]["nueva_libro"] = '';
                        $respuesta["multas"][$iCnt]["nueva_inscripcion"] = '';
                        $respuesta["multas"][$iCnt]["nueva_fechainscripcion"] = '';
                    }
                } else {
                    $respuesta["multas"][$iCnt]["cod_indicador_envio"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->cod_indicador_envio);
                    $respuesta["multas"][$iCnt]["nit_proponente"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->nit_proponente);
                    $respuesta["multas"][$iCnt]["dv_proponente"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->dv_proponente);
                    $respuesta["multas"][$iCnt]["nit_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->nit_entidad);
                    $respuesta["multas"][$iCnt]["dv_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->dv_entidad);
                    $respuesta["multas"][$iCnt]["municipio_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->municipio_entidad);
                    $respuesta["multas"][$iCnt]["numero_contrato"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->numero_contrato);
                    $respuesta["multas"][$iCnt]["nombre_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->nombre_entidad);
                    $respuesta["multas"][$iCnt]["nombre_proponente"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->nombre_proponente);
                    $respuesta["multas"][$iCnt]["seccional_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->seccional_entidad);
                    $respuesta["multas"][$iCnt]["numero_acto_administrativo"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->numero_acto_administrativo);
                    $respuesta["multas"][$iCnt]["fecha_acto_administrativo"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->fecha_acto_administrativo);
                    $respuesta["multas"][$iCnt]["fecha_ejecutoria"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->fecha_ejecutoria);
                    $respuesta["multas"][$iCnt]["valor_multa"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->valor_multa);
                    $respuesta["multas"][$iCnt]["valor_pagado_multa"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->valor_pagado_multa);
                    $respuesta["multas"][$iCnt]["cod_estado"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->cod_estado);
                    $respuesta["multas"][$iCnt]["numero_acto_suspension"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->numero_acto_suspension);
                    $respuesta["multas"][$iCnt]["fecha_acto_suspension"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->fecha_acto_suspension);
                    $respuesta["multas"][$iCnt]["numero_acto_confirmacion"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->numero_acto_confirmacion);
                    $respuesta["multas"][$iCnt]["fecha_acto_confirmacion"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->fecha_acto_confirmacion);
                    $respuesta["multas"][$iCnt]["numero_acto_revocacion"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->numero_acto_revocacion);
                    $respuesta["multas"][$iCnt]["fecha_acto_revocacion"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->fecha_acto_revocacion);
                    $respuesta["multas"][$iCnt]["observaciones"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->observaciones);
                    $respuesta["multas"][$iCnt]["codigo_camara"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->codigo_camara);
                    $respuesta["multas"][$iCnt]["codigo_libro_registro"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->codigo_libro_registro);
                    $respuesta["multas"][$iCnt]["numero_inscripcion_libro"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->numero_inscripcion_libro);
                    $respuesta["multas"][$iCnt]["fecha_inscripcion_camara"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->fecha_inscripcion_camara);
                    $respuesta["multas"][$iCnt]["numero_radicacion_rue"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->multas->numero_radicacion_rue);
                    $respuesta["multas"][$iCnt]["nueva_fechareporte"] = '';
                    $respuesta["multas"][$iCnt]["nueva_libro"] = '';
                    $respuesta["multas"][$iCnt]["nueva_inscripcion"] = '';
                    $respuesta["multas"][$iCnt]["nueva_fechainscripcion"] = '';
                }
            }

            $iCnt = 0;
            if (isset($t["RUE_ConsultaHistoriaProponente_BC"]->sanciones)) {
                if (is_array($t["RUE_ConsultaHistoriaProponente_BC"]->sanciones)) {
                    foreach ($t["RUE_ConsultaHistoriaProponente_BC"]->sanciones as $cnt) {
                        $iCnt++;
                        $respuesta["sanciones"][$iCnt]["cod_indicador_envio"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->cod_indicador_envio);
                        $respuesta["sanciones"][$iCnt]["nit_proponente"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->nit_proponente);
                        $respuesta["sanciones"][$iCnt]["dv_proponente"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->dv_proponente);
                        $respuesta["sanciones"][$iCnt]["nit_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->nit_entidad);
                        $respuesta["sanciones"][$iCnt]["dv_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->dv_entidad);
                        $respuesta["sanciones"][$iCnt]["municipio_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->municipio_entidad);
                        $respuesta["sanciones"][$iCnt]["numero_contrato"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->numero_contrato);
                        $respuesta["sanciones"][$iCnt]["nombre_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->nombre_entidad);
                        $respuesta["sanciones"][$iCnt]["nombre_proponente"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->nombre_proponente);
                        $respuesta["sanciones"][$iCnt]["seccional_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->seccional_entidad);
                        $respuesta["sanciones"][$iCnt]["numero_acto_administrativo"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->numero_acto_administrativo);
                        $respuesta["sanciones"][$iCnt]["fecha_acto_administrativo"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->fecha_acto_administrativo);
                        $respuesta["sanciones"][$iCnt]["fecha_ejecutoria"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->fecha_ejecutoria);
                        $respuesta["sanciones"][$iCnt]["descripcion_sancion"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->descripcion_sancion);
                        $respuesta["sanciones"][$iCnt]["condicion_incumplimiento"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->condicion_incumplimiento);
                        $respuesta["sanciones"][$iCnt]["cod_estado"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->cod_estado);
                        $respuesta["sanciones"][$iCnt]["numero_acto_suspension"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->numero_acto_suspension);
                        $respuesta["sanciones"][$iCnt]["fecha_acto_suspension"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->fecha_acto_suspension);
                        $respuesta["sanciones"][$iCnt]["numero_acto_confirmacion"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->numero_acto_confirmacion);
                        $respuesta["sanciones"][$iCnt]["fecha_acto_confirmacion"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->fecha_acto_confirmacion);
                        $respuesta["sanciones"][$iCnt]["numero_acto_revocacion"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->numero_acto_revocacion);
                        $respuesta["sanciones"][$iCnt]["fecha_acto_revocacion"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->fecha_acto_revocacion);
                        $respuesta["sanciones"][$iCnt]["observaciones"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->observaciones);
                        $respuesta["sanciones"][$iCnt]["codigo_camara"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->codigo_camara);
                        $respuesta["sanciones"][$iCnt]["codigo_libro_registro"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->codigo_libro_registro);
                        $respuesta["sanciones"][$iCnt]["numero_inscripcion_libro"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->numero_inscripcion_libro);
                        $respuesta["sanciones"][$iCnt]["fecha_inscripcion_camara"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->fecha_inscripcion_camara);
                        $respuesta["sanciones"][$iCnt]["numero_radicacion_rue"] = str_replace(array("<![CDATA[", "]]>"), "", $cnt->numero_radicacion_rue);
                        $respuesta["sanciones"][$iCnt]["nueva_fechareporte"] = '';
                        $respuesta["sanciones"][$iCnt]["nueva_libro"] = '';
                        $respuesta["sanciones"][$iCnt]["nueva_inscripcion"] = '';
                        $respuesta["sanciones"][$iCnt]["nueva_fechainscripcion"] = '';
                    }
                } else {
                    $respuesta["sanciones"][$iCnt]["cod_indicador_envio"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->cod_indicador_envio);
                    $respuesta["sanciones"][$iCnt]["nit_proponente"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->nit_proponente);
                    $respuesta["sanciones"][$iCnt]["dv_proponente"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->dv_proponente);
                    $respuesta["sanciones"][$iCnt]["nit_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->nit_entidad);
                    $respuesta["sanciones"][$iCnt]["dv_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->dv_entidad);
                    $respuesta["sanciones"][$iCnt]["municipio_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->municipio_entidad);
                    $respuesta["sanciones"][$iCnt]["numero_contrato"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->numero_contrato);
                    $respuesta["sanciones"][$iCnt]["nombre_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->nombre_entidad);
                    $respuesta["sanciones"][$iCnt]["nombre_proponente"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->nombre_proponente);
                    $respuesta["sanciones"][$iCnt]["seccional_entidad"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->seccional_entidad);
                    $respuesta["sanciones"][$iCnt]["numero_acto_administrativo"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->numero_acto_administrativo);
                    $respuesta["sanciones"][$iCnt]["fecha_acto_administrativo"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->fecha_acto_administrativo);
                    $respuesta["sanciones"][$iCnt]["fecha_ejecutoria"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->fecha_ejecutoria);
                    $respuesta["sanciones"][$iCnt]["descripcion_sancion"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->descripcion_sancion);
                    $respuesta["sanciones"][$iCnt]["condicion_incumplimiento"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->condicion_incumplimiento);
                    $respuesta["sanciones"][$iCnt]["cod_estado"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->cod_estado);
                    $respuesta["sanciones"][$iCnt]["numero_acto_suspension"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->numero_acto_suspension);
                    $respuesta["sanciones"][$iCnt]["fecha_acto_suspension"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->fecha_acto_suspension);
                    $respuesta["sanciones"][$iCnt]["numero_acto_confirmacion"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->numero_acto_confirmacion);
                    $respuesta["sanciones"][$iCnt]["fecha_acto_confirmacion"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->fecha_acto_confirmacion);
                    $respuesta["sanciones"][$iCnt]["numero_acto_revocacion"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->numero_acto_revocacion);
                    $respuesta["sanciones"][$iCnt]["fecha_acto_revocacion"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->fecha_acto_revocacion);
                    $respuesta["sanciones"][$iCnt]["observaciones"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->observaciones);
                    $respuesta["sanciones"][$iCnt]["codigo_camara"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->codigo_camara);
                    $respuesta["sanciones"][$iCnt]["codigo_libro_registro"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->codigo_libro_registro);
                    $respuesta["sanciones"][$iCnt]["numero_inscripcion_libro"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->numero_inscripcion_libro);
                    $respuesta["sanciones"][$iCnt]["fecha_inscripcion_camara"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->fecha_inscripcion_camara);
                    $respuesta["sanciones"][$iCnt]["numero_radicacion_rue"] = str_replace(array("<![CDATA[", "]]>"), "", $t["RUE_ConsultaHistoriaProponente_BC"]->sanciones->numero_radicacion_rue);
                    $respuesta["sanciones"][$iCnt]["nueva_fechareporte"] = '';
                    $respuesta["sanciones"][$iCnt]["nueva_libro"] = '';
                    $respuesta["sanciones"][$iCnt]["nueva_inscripcion"] = '';
                    $respuesta["sanciones"][$iCnt]["nueva_fechainscripcion"] = '';
                }
            }
        }
        return $respuesta;
    }

    public static function reemplazarAcutesSii2($txt) {
        $txt = str_replace("&amp;", "&", $txt);
        $txt = str_replace("&AMP;", "&", $txt);
        $txt = str_replace("&aacute;", "á", $txt);
        $txt = str_replace("&eacute;", "é", $txt);
        $txt = str_replace("&iacute;", "í", $txt);
        $txt = str_replace("&oacute;", "ó", $txt);
        $txt = str_replace("&uacute;", "ú", $txt);
        $txt = str_replace("&Aacute;", "Á", $txt);
        $txt = str_replace("&Eacute;", "É", $txt);
        $txt = str_replace("&Iacute;", "Í", $txt);
        $txt = str_replace("&Oacute;", "Ó", $txt);
        $txt = str_replace("&Uacute;", "Ú", $txt);
        $txt = str_replace("&AACUTE;", "Á", $txt);
        $txt = str_replace("&EACUTE;", "É", $txt);
        $txt = str_replace("&IACUTE;", "Í", $txt);
        $txt = str_replace("&OACUTE;", "Ó", $txt);
        $txt = str_replace("&UACUTE;", "Ú", $txt);
        $txt = str_replace("&ntilde;", "ñ", $txt);
        $txt = str_replace("&Ntilde;", "Ñ", $txt);
        $txt = str_replace("&NTILDE;", "Ñ", $txt);
        $txt = str_replace("&NBSP;", " ", $txt);
        $txt = str_replace("&nbsp;", " ", $txt);
        return $txt;
    }

    public static function construirJson($mysqli, $exp, $tiporeporte, $sistemadestino) {

        $arrJson = array();
        $arrJson["idenvio"] = '';
        $arrJson["tiporeporte"] = $tiporeporte;
        $arrJson["matricula"] = $exp["matricula"];
        $arrJson["idclase"] = $exp["tipoidentificacion"];
        $arrJson["numid"] = $exp["identificacion"];
        $arrJson["nit"] = $exp["nit"];
        $arrJson["razonsocial"] = $exp["nombre"];
        $arrJson["sigla"] = $exp["sigla"];

        $arrJson["apellido1"] = $exp["ape1"];
        $arrJson["apellido2"] = $exp["ape2"];
        $arrJson["nombre1"] = $exp["nom1"];
        $arrJson["nombre2"] = $exp["nom2"];
        $arrJson["organizacion"] = $exp["organizacion"];
        $arrJson["categoria"] = $exp["categoria"];

        $arrJson["estado"] = 'MA';
        switch ($exp["estadomatricula"]) {
            case "MC" :
            case "IC" :
            case "MF" :
            case "MG" :
            case "IF" :
            case "IG" :
                $arrJson["estado"] = 'MC';
                break;
        }

        $arrJson["fecmatricula"] = $exp["fechamatricula"];
        $arrJson["fecrenovacion"] = $exp["fecharenovacion"];
        $arrJson["ultanoren"] = $exp["ultanoren"];
        $arrJson["feccancelacion"] = $exp["fechacancelacion"];

        $arrJson["dircom"] = $exp["dircom"];
        $arrJson["telcom1"] = $exp["telcom1"];
        $arrJson["telcom2"] = $exp["telcom2"];
        $arrJson["telcom3"] = $exp["celcom"];
        $arrJson["emailcom"] = $exp["emailcom"];
        $arrJson["muncom"] = $exp["muncom"];

        $arrJson["dirnot"] = '';
        $arrJson["telnot1"] = '';
        $arrJson["telnot2"] = '';
        $arrJson["telnot3"] = '';
        $arrJson["emailnot"] = '';
        $arrJson["munnot"] = '';

        //
        if ($exp["organizacion"] != '02' && $exp["categoria"] != '2' && $exp["categoria"] != '3') {
            $arrJson["dirnot"] = $exp["dirnot"];
            $arrJson["telnot1"] = $exp["telnot"];
            $arrJson["telnot2"] = $exp["telnot2"];
            $arrJson["telnot3"] = $exp["celnot"];
            $arrJson["emailnot"] = $exp["emailnot"];
            $arrJson["munnot"] = $exp["munnot"];
        }

        //
        $arrJson["ingresosesperados"] = $exp["ingesperados"];
        $arrJson["activosvinculados"] = $exp["actvin"];
        if ($exp["organizacion"] != '02' && $exp["categoria"] != '2' && $exp["categoria"] != '3') {
            $arrJson["activosvinculados"] = $exp["acttot"];
        }
        $arrJson["personalvinculado"] = $exp["personal"];

        $arrJson["ciiu1"] = '';
        $arrJson["ciiu2"] = '';
        $arrJson["ciiu3"] = '';
        $arrJson["ciiu4"] = '';

        //
        $arrJson["ciiu1"] = substr($exp["ciius"][1], 1);
        if ($exp["ciius"][2] != '') {
            $arrJson["ciiu2"] = substr($exp["ciius"][2], 1);
        }
        if ($exp["ciius"][3] != '') {
            $arrJson["ciiu3"] = substr($exp["ciius"][3], 1);
        }
        if ($exp["ciius"][4] != '') {
            $arrJson["ciiu4"] = substr($exp["ciius"][4], 1);
        }

        //
        $arrJson["ciiu1consector"] = $exp["ciius"][1];
        $arrJson["ciiu2consector"] = $exp["ciius"][2];
        $arrJson["ciiu3consector"] = $exp["ciius"][3];
        $arrJson["ciiu4consector"] = $exp["ciius"][4];

        $arrJson["feciniact1"] = $exp["feciniact1"];
        $arrJson["feciniact2"] = $exp["feciniact2"];
        $arrJson["actividad"] = $exp["desactiv"];
        if ($exp["organizacion"] > '02' && $exp["categoria"] == '1') {
            $arrJson["actividad"] = strip_tags($exp["crtsii"]["0740"]);
            if (trim($arrJson["actividad"]) == '') {
                $arrJson["actividad"] = strip_tags($exp["crt"]["0740"]);
            }
        }

        // propietarios
        $arrJson["propietario"] = array();

        // Si es establecimiento
        if ($exp["organizacion"] == '02') {
            foreach ($exp["propietarios"] as $p) {
                $prop = array();
                $encontroprop = 'no';
                if ($p["matriculapropietario"] != '' && ($p["camarapropietario"] == '' || $p["camarapropietario"] == CODIGO_EMPRESA)) {
                    $p1 = \funcionesSii2::retornarExpedienteMercantilSii($mysqli, $p["matriculapropietario"]);
                    if ($p1 && !empty($p1)) {
                        $encontroprop = 'si';
                        $prop["camara"] = CODIGO_EMPRESA;
                        $prop["matricula"] = $p1["matricula"];
                        $prop["idclase"] = $p1["tipoidentificacion"];
                        $prop["numid"] = $p1["identificacion"];
                        $prop["nit"] = $p1["nit"];
                        $prop["razonsocial"] = $p1["nombre"];
                        $prop["dircom"] = $p1["dircom"];
                        $prop["telcom1"] = $p1["telcom1"];
                        $prop["telcom2"] = $p1["telcom2"];
                        $prop["telcom3"] = $p1["celcom"];
                        $prop["emailcom"] = $p1["emailcom"];
                        $prop["muncom"] = $p1["muncom"];
                        $prop["dirnot"] = $p1["dirnot"];
                        $prop["telnot1"] = $p1["telnot"];
                        $prop["telnot2"] = $p1["telnot2"];
                        $prop["telnot3"] = $p1["celnot"];
                        $prop["emailnot"] = $p1["emailnot"];
                        $prop["munnot"] = $p1["munnot"];
                        $prop["idclasereplegal"] = '';
                        $prop["numidreplegal"] = '';
                        $prop["nombrereplegal"] = '';
                        if ($p1["organizacion"] > '02' && $p1["categoria"] == '1') {
                            foreach ($p1["vinculos"] as $v) {
                                if ($v["tipovinculo"] == 'RLP') {
                                    if ($prop["idclasereplegal"] == '') {
                                        $prop["idclasereplegal"] = $v["idtipoidentificacionotros"];
                                        $prop["numidreplegal"] = $v["identificacionotros"];
                                        $prop["nombrereplegal"] = $v["nombreotros"];
                                    }
                                }
                            }
                        }
                    }
                }
                if ($encontroprop == 'no') {
                    $prop["camara"] = $p["camarapropietario"];
                    $prop["matricula"] = $p["matriculapropietario"];
                    $prop["idclase"] = $p["idtipoidentificacionpropietario"];
                    $prop["numid"] = $p["identificacionpropietario"];
                    $prop["nit"] = $p["nitpropietario"];
                    $prop["razonsocial"] = $p["nombrepropietario"];
                    $prop["dircom"] = $p["direccionpropietario"];
                    $prop["telcom1"] = $p["telefonopropietario"];
                    $prop["telcom2"] = $p["telefono2propietario"];
                    $prop["telcom3"] = $p["celularpropietario"];
                    $prop["emailcom"] = '';
                    $prop["muncom"] = $p["municipiopropietario"];
                    $prop["dirnot"] = $p["direccionnotpropietario"];
                    $prop["telnot1"] = $p["telefononotpropietario"];
                    $prop["telnot2"] = $p["telefononot2propietario"];
                    $prop["telnot3"] = $p["celularnotpropietario"];
                    $prop["emailnot"] = '';
                    $prop["munnot"] = $p["municipionotpropietario"];
                    $prop["idclasereplegal"] = $p["tipoidreplegpropietario"];
                    $prop["numidreplegal"] = $p["numidreplegpropietario"];
                    $prop["nombrereplegal"] = $p["nomreplegpropietario"];
                }
                $arrJson["propietario"][] = $prop;
            }
        }

        // Falta propietarios sucursales y agencias
        // Representantes legales
        $arrJson["representantelegal"] = array();

        // Si se trata de personas jurídicas principales
        if ($exp["organizacion"] > '02' && $exp["categoria"] == '1') {
            foreach ($exp["vinculos"] as $v) {
                if ($v["tipovinculo"] == 'RLP') {
                    $rl = array();
                    $rl["idclasereplegal"] = $v["idtipoidentificacionotros"];
                    $rl["numidreplegal"] = $v["identificacionotros"];
                    $rl["nombrereplegal"] = $v["nombreotros"];
                    $arrJson["representantelegal"][] = $rl;
                }
            }
        }

        // Información financiera
        $arrJson["informacionfinanciera"] = array();
        $arrJson["informacionfinanciera"]["acttot"] = 0;
        $arrJson["informacionfinanciera"]["actcte"] = 0;
        $arrJson["informacionfinanciera"]["actnocte"] = 0;
        $arrJson["informacionfinanciera"]["pascte"] = 0;
        $arrJson["informacionfinanciera"]["paslar"] = 0;
        $arrJson["informacionfinanciera"]["pattot"] = 0;
        $arrJson["informacionfinanciera"]["ingope"] = 0;
        $arrJson["informacionfinanciera"]["ingnoope"] = 0;
        $arrJson["informacionfinanciera"]["utiope"] = 0;
        $arrJson["informacionfinanciera"]["utinet"] = 0;
        $arrJson["informacionfinanciera"]["gruponiif"] = '';
        if ($exp["organizacion"] != '02' && $exp["categoria"] != '2' && $exp["categoria"] != '3') {
            $arrJson["informacionfinanciera"] = array();
            $arrJson["informacionfinanciera"]["acttot"] = $exp["acttot"];
            $arrJson["informacionfinanciera"]["actcte"] = $exp["actcte"];
            $arrJson["informacionfinanciera"]["actnocte"] = $exp["actnocte"];
            $arrJson["informacionfinanciera"]["pascte"] = $exp["pascte"];
            $arrJson["informacionfinanciera"]["paslar"] = $exp["paslar"];
            $arrJson["informacionfinanciera"]["pattot"] = $exp["pattot"];
            $arrJson["informacionfinanciera"]["ingope"] = $exp["ingope"];
            $arrJson["informacionfinanciera"]["ingnoope"] = $exp["ingnoope"];
            $arrJson["informacionfinanciera"]["utiope"] = $exp["utiope"];
            $arrJson["informacionfinanciera"]["utinet"] = $exp["utinet"];
            $arrJson["informacionfinanciera"]["gruponiif"] = $exp["gruponiif"];
        }

        //
        $arrJson["idenvio"] = \funcionesSii2::generarAleatorioAlfanumerico20($mysqli, $validar = 'mreg_envio_matriculas_api');
        $txtJson = json_encode($arrJson);
        $hash = hash('sha256', $txtJson);

        // Crea el registro en la tabla mreg_envio_matriculas_api compo pendiente
        $arrCampos = array(
            'idenvio',
            'sistemadestino',
            'tiporeporte',
            'matricula',
            'fechahoraultimoenvio',
            'json',
            'hashcontrol',
            'estadoenvio',
            'fechahorarespuesta',
            'codigoasignadorespuesta',
            'observaciones'
        );
        $arrValores = array(
            "'" . $arrJson["idenvio"] . "'",
            "'" . $sistemadestino . "'",
            "'" . $tiporeporte . "'",
            "'" . $arrJson["matricula"] . "'",
            "'" . date("Ymd") . ' ' . date("His") . "'",
            "'" . addslashes($txtJson) . "'",
            "'" . $hash . "'",
            "'PE'",
            "''",
            "''",
            "''"
        );
        insertarRegistrosMysqli2($mysqli, 'mreg_envio_matriculas_api', $arrCampos, $arrValores);

        //
        return $arrJson;
    }

    public static function encontrarNuevas($mysqli, $control) {
        $matriculas = array();
        $mats = retornarRegistrosMysqli2($mysqli, 'mreg_est_inscritos', "fecmatricula>='" . $control["fechainicial"] . "' and fecmatricula <= '" . $_SESSION["entrada"]["fechafinal"] . "' and muncom='" . $_SESSION["entrada"]["municipio"] . "'", "matricula");
        if ($mats && !empty($mats)) {
            foreach ($mats as $m) {
                if ($m["ctrestmatricula"] != 'NA' && $m["ctrestmatricula"] != 'NM') {
                    $env = retornarRegistroMysqli2($mysqli, 'mreg_envio_matriculas_api', "sistemadestino='" . $control["sistemadestino"] . "' and tiporeporte='2' and matricula='" . $m["matricula"] . "'");
                    if ($env === false || empty($env) || $env["estadoenvio"] == '' || $env["estadoenvio"] == 'PE' || $env["estadoenvio"] == 'ER') {
                        $matriculas[] = $m["matricula"];
                    }
                }
            }
        }
        return $matriculas;
    }

    public static function encontrarModificaciones($mysqli, $control) {
        $modificaciones = array();
        $condicion = "(fecha >= '" . $_SESSION["entrada"]["fechainicial"] . "') and fecha <= '" . $_SESSION["entrada"]["fechafinal"] . ")";
        $mats = retornarRegistrosMysqli2($mysqli, 'mreg_campos_historicos_' . substr($_SESSION["entrada"]["fechainicial"], 0, 4), $condicion, "matricula");
        if ($mats && !empty($mats)) {
            foreach ($mats as $m) {
                if (($m["fecha"] == $_SESSION["entrada"]["fechainicial"] && $m["hora"] >= $_SESSION["entrada"]["horainicial"]) ||
                        $m["fecha"] > $_SESSION["entrada"]["fechainicial"]) {
                    if (($m["fecha"] == $_SESSION["entrada"]["fechafinal"] && $m["hora"] <= $_SESSION["entrada"]["horafinal"]) ||
                            $m["fecha"] < $_SESSION["entrada"]["fechafinal"]) {
                        $modificaciones[$m["matricula"]] = $m["matricula"];
                    }
                }
            }
        }
        return $modificaciones;
    }

    public static function encontrarCancelaciones($mysqli, $control) {
        $cancelaciones = array();
        $mats = retornarRegistrosMysqli2($mysqli, 'mreg_est_inscritos', "feccancelacion>='" . $control["fechainicial"] . "' and muncom='" . $_SESSION["entrada"]["municipio"] . "'", "matricula");
        if ($mats && !empty($mats)) {
            foreach ($mats as $m) {
                if ($m["ctrestmatricula"] != 'NA' && $m["ctrestmatricula"] != 'NM') {
                    $env = retornarRegistroMysqli2($mysqli, 'mreg_envio_matriculas_api', "sistemadestino='" . $control["sistemadestino"] . "' and tiporeporte='4' and matricula='" . $m["matricula"] . "'");
                    if ($env === false || empty($env) || $env["estadoenvio"] == '' || $env["estadoenvio"] == 'PE' || $env["estadoenvio"] == 'ER') {
                        $cancelaciones[] = $m["matricula"];
                    }
                }
            }
        }
        return $cancelaciones;
    }

}
