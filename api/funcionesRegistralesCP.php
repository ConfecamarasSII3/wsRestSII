<?php

class funcionesRegistrales {

    public static function actualizarMregEstInscritos($mysqli, $data, $codbarras = '', $tt = '', $rec = '') {

        $nameLog = 'actualizarMregEstInscritos_' . date("Ymd");

        // Valida que el expediente tenga diferencias
        if (ltrim($data["matricula"], "0") == '' && ltrim($data["proponente"], "0") == '') {
            return true;
        }

        if (!isset($data["latitud"])) {
            $data["latitud"] = '';
        }
        if (!isset($data["longitud"])) {
            $data["longitud"] = '';
        }
        if (!isset($data["econmixta"])) {
            $data["econmixta"] = '';
        }
        if (!isset($data["desactiv"])) {
            $data["desactiv"] = '';
        }
        if (!isset($data["telcor2"])) {
            $data["telcor2"] = '';
        }
        if (!isset($data["cap_apotra"])) {
            $data["cap_apotra"] = 0;
        }
        if (!isset($data["apolab"])) {
            $data["apolab"] = 0;
        }
        if (!isset($data["apolabadi"])) {
            $data["apolabadi"] = 0;
        }
        if (!isset($data["apodin"])) {
            $data["apodin"] = 0;
        }
        if (!isset($data["apotot"])) {
            $data["apotot"] = 0;
        }
        if (!isset($data["apotra"])) {
            $data["apotra"] = 0;
        }
        if (!isset($data["apoact"])) {
            $data["apoact"] = 0;
        }
        if (!isset($data["patnet"])) {
            $data["patnet"] = 0;
        }

        if (!isset($data["cap_porcnalpub"]) || ltrim($data["cap_porcnalpub"], "0") == '') {
            $data["cap_porcnalpub"] = 0;
        }
        if (!isset($data["cap_porcnalpri"]) || ltrim($data["cap_porcnalpri"], "0") == '') {
            $data["cap_porcnalpri"] = 0;
        }
        if (!isset($data["cap_porcextpub"]) || ltrim($data["cap_porcextpub"], "0") == '') {
            $data["cap_porcextpub"] = 0;
        }
        if (!isset($data["cap_porcextpri"]) || ltrim($data["cap_porcextpri"], "0") == '') {
            $data["cap_porcextpri"] = 0;
        }

        if (!isset($data["codigopostalcom"])) {
            $data["codigopostalcom"] = '';
        }
        if (!isset($data["codigopostalnot"])) {
            $data["codigopostalnot"] = '';
        }
        if (!isset($data["fechainiact1"])) {
            $data["fechainiact1"] = '';
        }
        if (!isset($data["fechainiact2"])) {
            $data["fechainiact2"] = '';
        }
        if (!isset($data["codaduaneros"])) {
            $data["codaduaneros"] = '';
        }
        if (!isset($data["gruponiif"])) {
            $data["gruponiif"] = '';
        }
        if (!isset($data["niifconciliacion"])) {
            $data["niifconciliacion"] = '';
        }
        if (!isset($data["ctrderpub"])) {
            $data["ctrderpub"] = '';
        }
        if (!isset($data["ctrcodcoop"])) {
            $data["ctrcodcoop"] = '';
        }
        if (!isset($data["ctrcodotras"])) {
            $data["ctrcodotras"] = '';
        }
        if (!isset($data["cumplerequisitos1780"])) {
            $data["cumplerequisitos1780"] = '';
        }
        if (!isset($data["renunciabeneficios1780"])) {
            $data["renunciabeneficios1780"] = '';
        }
        if (!isset($data["cumplerequisitos1780primren"])) {
            $data["cumplerequisitos1780primren"] = '';
        }

        if (!isset($data["vigcontrol"])) {
            $data["vigcontrol"] = '';
        }
        if (!isset($data["idorigenperj"])) {
            $data["idorigenperj"] = '';
        }
        if (!isset($data["origendocconst"])) {
            $data["origendocconst"] = '';
        }
        if (!isset($data["numperj"])) {
            $data["numperj"] = '';
        }
        if (!isset($data["fecperj"])) {
            $data["fecperj"] = '';
        }
        if (!isset($data["vigifecini"])) {
            $data["vigifecini"] = '';
        }
        if (!isset($data["vigifecfin"])) {
            $data["vigifecfin"] = '';
        }

        if (!isset($data["nrocontrolreactivacion"])) {
            $data["nrocontrolreactivacion"] = '';
        }
        if (!isset($data["fechanacimiento"])) {
            $data["fechanacimiento"] = '';
        }
        if (!isset($data["ideext"])) {
            $data["ideext"] = '';
        }
        if (!isset($data["anodatoscap"])) {
            $data["anodatoscap"] = '';
        }
        if (!isset($data["fechadatoscap"])) {
            $data["fechadatoscap"] = '';
        }
        if (!isset($data["cpafili"])) {
            $data["cpafili"] = '';
        }
        if (!isset($data["cpsaldo"])) {
            $data["cpsaldo"] = 0;
        }
        if (!isset($data["cpurenafi"])) {
            $data["cpurenafi"] = '';
        }
        if (!isset($data["feciniact1"])) {
            $data["feciniact1"] = '';
        }
        if (!isset($data["feciniact2"])) {
            $data["feciniact2"] = '';
        }
        if (!isset($data["estadocapturado"])) {
            $data["estadocapturado"] = '';
        }
        if (!isset($data["estadocapturadootros"])) {
            $data["estadocapturadootros"] = '';
        }
        if (!isset($data["cantest"])) {
            $data["cantest"] = 0;
        }
        if (!isset($data["certificardesde"])) {
            $data["certificardesde"] = '';
        }
        if (!isset($data["ctrbic"])) {
            $data["ctrbic"] = '';
        }

        if (!isset($data["sexo"])) {
            $data["sexo"] = '';
        }

        if (!isset($data["cantidadmujeres"])) {
            $data["cantidadmujeres"] = 0;
        }
        if (!isset($data["cantidadmujerescargosdirectivos"])) {
            $data["cantidadmujerescargosdirectivos"] = 0;
        }
        if (!isset($data["participacionmujeres"])) {
            $data["participacionmujeres"] = 0;
        }
        if (!isset($data["ciiutamanoempresarial"])) {
            $data["ciiutamanoempresarial"] = '';
        }
        if (!isset($data["ingresostamanoempresarial"])) {
            $data["ingresostamanoempresarial"] = 0;
        }
        if (!isset($data["anodatostamanoempresarial"])) {
            $data["anodatostamanoempresarial"] = '';
        }
        if (!isset($data["fechadatostamanoempresarial"])) {
            $data["fechadatostamanoempresarial"] = '';
        }

        //
        if (!isset($data["pendiente_ajuste_nuevo_formato"])) {
            $data["pendiente_ajuste_nuevo_formato"] = '';
        }
        if (!isset($data["fecha_pendiente_ajuste_nuevo_formato"])) {
            $data["fecha_pendiente_ajuste_nuevo_formato"] = '';
        }

        if (substr($data["matricula"], 0, 1) == 'S') {
            if ($data["estadomatricula"] == 'MA') {
                $data["estadomatricula"] = 'IA';
            }
            if ($data["estadomatricula"] == 'MC') {
                $data["estadomatricula"] = 'IC';
            }
            if ($data["estadomatricula"] == 'MI') {
                $data["estadomatricula"] = 'II';
            }
        }

        //
        $grabarpor = '';
        $dataori = array();
        if ($data["matricula"] != '') {
            $dataori = retornarRegistroMysqliApi($mysqli, 'mreg_est_inscritos', "matricula='" . ltrim($data["matricula"], "0") . "'");
            $grabarpor = 'matricula';
        } else {
            if ($data["proponente"] != '') {
                $dataori = retornarRegistroMysqliApi($mysqli, 'mreg_est_inscritos', "proponente='" . ltrim($data["proponente"], "0") . "'");
                $grabarpor = 'proponente';
            }
        }


        // Control de libros de comercio
        $ctrlibroscomercio = 'N';
        if (!empty($data["libroscomercio"])) {
            if (count($data["libroscomercio"]) > 0) {
                $ctrlibroscomercio = 'S';
            }
        }

        //  Control de embargo
        $ctrembargo = 'N';
        if (!empty($data["ctrembargos"])) {
            foreach ($data["ctrembargos"] as $embx) {
                if ($embx["acto"] == '0900' || $embx["acto"] == '0910' || $embx["acto"] == '1000') {
                    if ($embx["estado"] == '1') {
                        $ctrembargo = 'S';
                    }
                }
            }
        }

        //  Control de embargos en tramite
        $ctrembargotramite = 'N';
        $ctrrecursotramite = 'N';
        if (!empty($data["lcodigosbarras"])) {
            foreach ($data["lcodigosbarras"] as $cbax) {
                if ($cbax["ttra"] == '07') {
                    $ctrembargotramite = 'S';
                }
                if ($cbax["ttra"] == '19' || $cbax["ttra"] == '54') {
                    $ctrrecursotramite = 'S';
                }
            }
        }


        // Localiza primer representante legal
        $idereplegal = '';
        $nomreplegal = '';
        if (!empty($data["replegal"])) {
            foreach ($data["replegal"] as $vinx) {
                if ($idereplegal == '') {
                    if ($vinx["vinculoreplegal"] == '2170' ||
                            $vinx["vinculoreplegal"] == '4170') {
                        $idereplegal = $vinx["identificacionreplegal"];
                        $nomreplegal = $vinx["nombrereplegal"];
                    }
                }
            }
        }

        // Localiza documento de constitucion
        $numdocconst = '';
        $fecdocconst = '';
        $oridocconst = $data["origendocconst"];
        if (trim($oridocconst) == '') {
            if (!empty($data["inscripciones"])) {
                foreach ($data["inscripciones"] as $insx) {
                    if ($insx["acto"] == '0040') {
                        $numdocconst = $insx["ndoc"];
                        $fecdocconst = $insx["fdoc"];
                        $oridocconst = $insx["txoridoc"];
                    }
                }
            }
        }



        $nomsegcon = '';
        $carsegcon = '';
        if (isset($data["nombresegundocontacto"])) {
            $nomsegcon = $data["nombresegundocontacto"];
        }
        if (isset($data["cargosegundocontacto"])) {
            $carsegcon = $data["cargosegundocontacto"];
        }

        $econmixta = '';
        if (isset($data["econmixta"])) {
            $econmixta = $data["econmixta"];
        }

        $capesadl = 0;
        if (isset($data["capesadl"])) {
            $capesadl = $data["capesadl"];
        }

        //
        if (trim($data["nuevonombre"]) != '') {
            if (trim($data["nuevonombre"]) != $data["nombre"]) {
                $data["nombreanterior"] = $data["nombre"];
                $data["nombre"] = $data["nuevonombre"];
            }
        }

        // 2018-04-11 : JINT: Controles que se incluyen para prevenir que al actualizar el expediente
        // se elimine información vital
        if ($data["matricula"] != '') {
            if ($data["afiliado"] == '') {
                if (isset($dataori["ctrafiliacion"]) && $dataori["ctrafiliacion"] != '') {
                    $data["afiliado"] = $dataori["ctrafiliacion"];
                }
            }
            if ($data["dircom"] == '') {
                if (isset($dataori["dircom"]) && $dataori["dircom"] != '') {
                    $data["dircom"] = $dataori["dircom"];
                }
            }
            if ($data["muncom"] == '') {
                if (isset($dataori["muncom"]) && $dataori["muncom"] != '') {
                    $data["muncom"] = $dataori["muncom"];
                }
            }
        }

        // 2019-06-21: JINT: Incluye actualización del campo pendiente_ajuste_nuevo_formato
        if ($data["matricula"] != '') {
            if ($data["pendiente_ajuste_nuevo_formato"] == '') {
                if (isset($dataori["pendiente_ajuste_nuevo_formato"]) && $dataori["pendiente_ajuste_nuevo_formato"] != '') {
                    $data["pendiente_ajuste_nuevo_formato"] = $dataori["pendiente_ajuste_nuevo_formato"];
                }
            }
            if ($data["fecha_pendiente_ajuste_nuevo_formato"] == '') {
                if (isset($dataori["fecha_pendiente_ajuste_nuevo_formato"]) && $dataori["fecha_pendiente_ajuste_nuevo_formato"] != '') {
                    $data["fecha_pendiente_ajuste_nuevo_formato"] = $dataori["fecha_pendiente_ajuste_nuevo_formato"];
                }
            }
        }

        // 
        $arrCampos = array(
            'matricula',
            'proponente',
            'organizacion',
            'categoria',
            'naturaleza',
            'nrocontrolreactivacion',
            'razonsocial',
            'sigla',
            'complementorazonsocial',
            'nombrecomercial',
            'lggr',
            'nombre1',
            'nombre2',
            'apellido1',
            'apellido2',
            'idclase',
            'numid',
            'sexo',
            'numidextenso',
            'idmunidoc',
            'fechanacimiento',
            'fecexpdoc',
            'paisexpdoc',
            'nacionalidad',
            'idetripaiori', // Nuevo
            'paiori', // nuevo
            'idetriextep', // Nuevo
            'prerut',
            'admondian',
            'nit',
            'estadonit',
            'fecmatricula',
            'fecrenovacion',
            'ultanoren',
            'feccancelacion',
            'motivocancelacion', // Nuevo
            'fecconstitucion',
            'fecdisolucion',
            'fecliquidacion',
            'estadotipoliquidacion', // Nuevo
            'fecvigencia',
            'tamanoempresa',
            'emprendedor28',
            'pemprendedor28',
            'empresafamiliar', // Nuevo
            'procesosinnovacion', // Nuevo
            'tipogruemp', // Nuevo
            'nombregruemp', // Nuevo
            'vigcontrol', // Entidad que ejerce la vigilancia y control
            'vigifecini',
            'vigifecfin',
            'numperj',
            'fecperj',
            'otorgaperj',
            'numdocconst',
            'fecdocconst',
            'origendocconst',
            'fecmatant',
            'fecrenant',
            'camant',
            'munant',
            'ultanorenant',
            'matant',
            'benart7ant',
            'benley1780ant',
            'dircom',
            'dircom_tipovia',
            'dircom_numvia',
            'dircom_apevia',
            'dircom_orivia',
            'dircom_numcruce',
            'dircom_apecruce',
            'dircom_oricruce',
            'dircom_numplaca',
            'dircom_complemento',
            'codigopostalcom',
            'codigozonacom', // Nuevo
            'barriocom',
            'muncom',
            'paicom', // Nuevo
            'telcom1',
            'telcom2',
            'telcom3',
            'emailcom',
            'emailcom2',
            'emailcom3',
            'urlcom',
            'aacom',
            'faxcom',
            'numpredial',
            'latitud',
            'longitud',
            'dirnot',
            'dirnot_tipovia',
            'dirnot_numvia',
            'dirnot_apevia',
            'dirnot_orivia',
            'dirnot_numcruce',
            'dirnot_apecruce',
            'dirnot_oricruce',
            'dirnot_numplaca',
            'dirnot_complemento',
            'codigopostalnot',
            'codigozonanot', // Nuevo
            'barrionot',
            'munnot',
            'painot', // Nuevo
            'telnot',
            'telnot2',
            'telnot3',
            'emailnot',
            'urlnot',
            'aanot',
            'faxnot',
            'tiposedeadm',
            'dircor',
            'muncor',
            'telcor',
            'telcor2',
            'ciiu1',
            'ciiu2',
            'ciiu3',
            'ciiu4',
            'ciiu5',
            'versionciiu',
            'feciniact1', // Nuevo
            'feciniact2', // Nuevo
            'ingesperados', // Ingresos esperados
            'codaduaneros', // Nuevo
            'actividad',
            'fecaflia',
            'fecactaaflia',
            'numactaaflia',
            'fecactacanaflia',
            'numactacanaflia',
            'anorenaflia',
            'fecrenaflia',
            'valpagaflia',
            'saldoaflia',
            'telaflia',
            'diraflia',
            'munaflia',
            'profaflia',
            'contaflia',
            'dircontaflia',
            'muncontaflia',
            'fecexafiliacion',
            'ctrexpedienteinactivo',
            'ctrestmatricula',
            'ctrestdatos',
            'ctrcertificardesde',
            // 'ctrestproponente', // 2019-04-25: JINT: No permitir el cambio de este campo al actualizar trámites de registro mercantil
            'ctrtipopropiedad',
            'ctrlibroscomercio',
            'ctrafiliacion',
            'ctrvigilancia',
            'ctrestadoactiva',
            'ctrestadopreoperativa',
            'ctrconcordato',
            'ctrestadointervenida',
            'ctrestadodisuelta',
            'ctrestadoenreestructuracion',
            'ctrestadocapturado', //Nuevo
            'ctrestadocapturadootros', // Nuevo
            'ctrembargo',
            'ctrembargostramite',
            'ctrrecursostramite',
            'ctrimpexp',
            'ctrtipolocal',
            'ctrfun',
            'ctrubi',
            'ctrclasegenesadl',
            'ctrclaseespeesadl',
            'ctrclaseeconsoli',
            'ctrderpub',
            'ctrcodcoop',
            'ctrcodotras',
            'ctreconmixta',
            'ctresacntasociados', // Nuevo
            'ctresacntmujeres', // Nuevo
            'ctresacnthombres', // Nuevo
            'ctresapertgremio', // Nuevo
            'ctresagremio', // Nuevo
            'ctresaacredita', // Nuevo
            'ctresaivc', // Nuevo
            'ctresainfoivc', // Nuevo
            'ctresaautregistro', // Nuevo
            'ctresaentautoriza', // Nuevo
            'ctresacodnat', // Nuevo
            'ctresadiscap', // Nuevo
            'ctresaetnia', // Nuevo
            'ctresacualetnia', // Nuevo
            'ctresadespvictreins', // Nuevo
            'ctresacualdespvictreins', // Nuevo
            'ctresaindgest', // Nuevo
            'ctresalgbti', // Nuevo
            'ctrbenart4',
            'ctrbenart7',
            'ctrbenart50',
            'ctrbenley1780',
            'cumplerequisitos1780',
            'renunciabeneficios1780',
            'cumplerequisitos1780primren',
            'ctrcance1429',
            'ctrdepuracion1727',
            'ctrfechadepuracion1727',
            'ctrben658',
            'ctrnotemail',
            'ctrnotsms',
            'ctrivcarea', // Double
            'ctrivcver',
            'ctrivccretip',
            'ctrivcali',
            'ctrivcqui',
            'ctrivcriesgo',
            'ctrivcenvio',
            'ctrivcsuelos',
            'ctrbic',
            'cantest',
            'idereplegal',
            'nomreplegal',
            'gruponiif', // Nuevo
            'niifconciliacion', // Nuevo
            'aportantesegsocial', // Nuevo
            'tipoaportantesegsocial', // Nuevo
            'anodatos',
            'fecdatos',
            'personal',
            'personaltemp',
            'actcte',
            'actnocte',
            'actfij',
            'fijnet',
            'actval',
            'actotr',
            'acttot',
            'actsinaju',
            'invent',
            'pascte',
            'paslar',
            'pastot',
            'pattot',
            'paspat',
            'balsoc',
            'ingope',
            'ingnoope',
            'gasope',
            'gasnoope',
            'gtoven',
            'gtoadm',
            'utiope',
            'utinet',
            'cosven',
            'depamo',
            'gasint',
            'gasimp',
            'actvin',
            'patrimonio',
            'anodatoscap',
            'fecdatoscap',
            'capaut',
            'capsus',
            'cappag',
            'capsoc',
            'apolab',
            'apolabadi',
            'apodin',
            'apotra',
            'apoact',
            'apotot',
            'capesadl',
            'pornalpri',
            'pornalpub',
            'pornaltot',
            'porextpri',
            'porextpub',
            'porexttot',
            'cantidadmujeres',
            'participacionmujeres',
            'cantidadmujerescargosdirectivos',
            'nomsegcon',
            'carsegcon',
            'cntest01',
            'cntest02',
            'cntest03',
            'cntest04',
            'cntest05',
            'cntest06',
            'cntest07',
            'cntest08',
            'cntest09',
            'cntest10',
            'cntest11',
            'refcrenom1',
            'refcreofi1',
            'refcretel1', // Nuevo
            'refcrenom2',
            'refcreofi2',
            'refcretel2', // Nuevo
            'refcomnom1',
            'refcomdir1',
            'refcomtel1',
            'refcomnom2',
            'refcomdir2',
            'refcomtel2',
            'cpcodcam',
            'cpnummat',
            'cprazsoc',
            'cpnumnit',
            'cpdircom',
            'cpdirnot',
            'cpnumtel',
            'cpnumfax',
            'cpcodmun',
            'cpmunnot',
            'cpafili',
            'cpsaldo', // Double
            'cpurenafi',
            'pendiente_ajuste_nuevo_formato',
            'fecha_pendiente_ajuste_nuevo_formato',
            'fecactualizacion',
            'compite360',
            'rues',
            'ivc'
        );

        // 249
        $arrValores = array(
            "'" . ltrim($data["matricula"], "0") . "'",
            "'" . ltrim($data["proponente"], "0") . "'",
            "'" . $data["organizacion"] . "'",
            "'" . $data["categoria"] . "'",
            "'" . $data["naturaleza"] . "'",
            "'" . $data["nrocontrolreactivacion"] . "'",
            "'" . addslashes(trim($data["nombre"])) . "'",
            "'" . addslashes(trim($data["sigla"])) . "'",
            "'" . addslashes(trim($data["complementorazonsocial"])) . "'",
            "''", // Nombre comercial
            "'" . addslashes(trim($data["lggr"])) . "'",
            "'" . addslashes(trim($data["nom1"])) . "'",
            "'" . addslashes(trim($data["nom2"])) . "'",
            "'" . addslashes(trim($data["ape1"])) . "'",
            "'" . addslashes(trim($data["ape2"])) . "'",
            "'" . trim($data["tipoidentificacion"]) . "'",
            "'" . trim($data["identificacion"]) . "'",
            "'" . trim($data["sexo"]) . "'",
            "'" . trim($data["ideext"]) . "'",
            "'" . trim($data["idmunidoc"]) . "'",
            "'" . trim($data["fechanacimiento"]) . "'",
            "'" . trim($data["fecexpdoc"]) . "'",
            "'" . trim($data["paisexpdoc"]) . "'",
            "'" . trim($data["nacionalidad"]) . "'",
            "'" . trim($data["idetripaiori"]) . "'",
            "'" . trim($data["paiori"]) . "'",
            "'" . trim($data["idetriextep"]) . "'",
            "'" . trim($data["prerut"]) . "'",
            "'" . trim($data["admondian"]) . "'",
            "'" . trim($data["nit"]) . "'",
            "'" . trim($data["estadonit"]) . "'",
            "'" . trim($data["fechamatricula"]) . "'",
            "'" . trim($data["fecharenovacion"]) . "'",
            "'" . trim($data["ultanoren"]) . "'",
            "'" . trim($data["fechacancelacion"]) . "'",
            "'" . trim($data["motivocancelacion"]) . "'",
            "'" . trim($data["fechaconstitucion"]) . "'",
            "'" . trim($data["fechadisolucion"]) . "'",
            "'" . trim($data["fechaliquidacion"]) . "'",
            "'" . trim($data["estadotipoliquidacion"]) . "'",
            "'" . trim($data["fechavencimiento"]) . "'",
            "'" . trim($data["tamanoempresa"]) . "'",
            "'" . trim($data["emprendedor28"]) . "'",
            doubleval($data["pemprendedor28"]),
            "'" . trim($data["empresafamiliar"]) . "'",
            "'" . trim($data["procesosinnovacion"]) . "'",
            "'" . trim($data["tipogruemp"]) . "'",
            "'" . addslashes(trim($data["nombregruemp"])) . "'",
            "'" . addslashes(trim($data["vigcontrol"])) . "'",
            "'" . trim($data["vigifecini"]) . "'",
            "'" . trim($data["vigifecfin"]) . "'",
            "'" . trim($data["numperj"]) . "'",
            "'" . trim($data["fecperj"]) . "'",
            "'" . trim($data["idorigenperj"]) . "'",
            "'" . trim($numdocconst) . "'",
            "'" . trim($fecdocconst) . "'",
            "'" . trim($oridocconst) . "'",
            "'" . trim($data["fecmatant"]) . "'",
            "'" . trim($data["fecrenant"]) . "'",
            "'" . trim($data["camant"]) . "'",
            "'" . trim($data["munant"]) . "'",
            "'" . trim($data["ultanorenant"]) . "'",
            "'" . trim($data["matant"]) . "'",
            "'" . trim($data["benart7ant"]) . "'",
            "'" . trim($data["benley1780ant"]) . "'",
            "'" . addslashes(trim($data["dircom"])) . "'",
            "'" . trim($data["dircom_tipovia"]) . "'",
            "'" . trim($data["dircom_numvia"]) . "'",
            "'" . trim($data["dircom_apevia"]) . "'",
            "'" . trim($data["dircom_orivia"]) . "'",
            "'" . trim($data["dircom_numcruce"]) . "'",
            "'" . trim($data["dircom_apecruce"]) . "'",
            "'" . trim($data["dircom_oricruce"]) . "'",
            "'" . trim($data["dircom_numplaca"]) . "'",
            "'" . trim($data["dircom_complemento"]) . "'",
            "'" . trim($data["codigopostalcom"]) . "'",
            "'" . trim($data["codigozonacom"]) . "'",
            "'" . trim($data["barriocom"]) . "'",
            "'" . trim($data["muncom"]) . "'",
            "'" . trim($data["paicom"]) . "'",
            "'" . trim($data["telcom1"]) . "'",
            "'" . trim($data["telcom2"]) . "'",
            "'" . trim($data["celcom"]) . "'",
            "'" . addslashes(trim($data["emailcom"])) . "'",
            "'" . addslashes(trim($data["emailcom2"])) . "'",
            "'" . addslashes(trim($data["emailcom3"])) . "'",
            "'" . addslashes(trim($data["urlcom"])) . "'",
            "'" . (trim($data["aacom"])) . "'",
            "'" . (trim($data["faxcom"])) . "'",
            "'" . trim($data["numpredial"]) . "'",
            "'" . trim($data["latitud"]) . "'",
            "'" . trim($data["longitud"]) . "'",
            "'" . addslashes(trim($data["dirnot"])) . "'",
            "'" . trim($data["dirnot_tipovia"]) . "'",
            "'" . trim($data["dirnot_numvia"]) . "'",
            "'" . trim($data["dirnot_apevia"]) . "'",
            "'" . trim($data["dirnot_orivia"]) . "'",
            "'" . trim($data["dirnot_numcruce"]) . "'",
            "'" . trim($data["dirnot_apecruce"]) . "'",
            "'" . trim($data["dirnot_oricruce"]) . "'",
            "'" . trim($data["dirnot_numplaca"]) . "'",
            "'" . trim($data["dirnot_complemento"]) . "'",
            "'" . trim($data["codigopostalnot"]) . "'",
            "'" . trim($data["codigozonanot"]) . "'",
            "'" . trim($data["barrionot"]) . "'",
            "'" . trim($data["munnot"]) . "'",
            "'" . trim($data["painot"]) . "'",
            "'" . trim($data["telnot"]) . "'",
            "'" . trim($data["telnot2"]) . "'",
            "'" . trim($data["celnot"]) . "'",
            "'" . addslashes(trim($data["emailnot"])) . "'",
            "'" . addslashes(trim($data["urlnot"])) . "'",
            "'" . (trim($data["aanot"])) . "'",
            "'" . (trim($data["faxnot"])) . "'",
            "'" . (trim($data["tiposedeadm"])) . "'",
            "'" . trim($data["dircor"]) . "'",
            "'" . trim($data["muncor"]) . "'",
            "'" . trim($data["telcor"]) . "'",
            "'" . trim($data["telcor2"]) . "'",
            "'" . trim($data["ciius"][1]) . "'",
            "'" . trim($data["ciius"][2]) . "'",
            "'" . trim($data["ciius"][3]) . "'",
            "'" . trim($data["ciius"][4]) . "'",
            "'" . trim($data["ciius"][5]) . "'",
            "'" . trim($data["versionciiu"]) . "'",
            "'" . trim($data["feciniact1"]) . "'",
            "'" . trim($data["feciniact2"]) . "'",
            doubleval($data["ingesperados"]),
            "'" . trim($data["codaduaneros"]) . "'",
            "'" . addslashes(substr(trim($data["desactiv"]), 0, 1000)) . "'",
            "'" . trim($data["fechaafiliacion"]) . "'",
            "'" . trim($data["fecactaaflia"]) . "'",
            "'" . trim($data["numactaaflia"]) . "'",
            "'" . trim($data["fecactaafliacan"]) . "'",
            "'" . trim($data["numactaafliacan"]) . "'",
            "'" . trim($data["ultanorenafi"]) . "'",
            "'" . trim($data["fechaultpagoafi"]) . "'",
            doubleval($data["valorultpagoafi"]),
            doubleval($data["saldoafiliado"]),
            "'" . trim($data["telaflia"]) . "'",
            "'" . trim($data["diraflia"]) . "'",
            "'" . trim($data["munaflia"]) . "'",
            "'" . trim($data["profaflia"]) . "'",
            "'" . trim($data["contaflia"]) . "'",
            "'" . trim($data["dircontaflia"]) . "'",
            "'" . trim($data["muncontaflia"]) . "'",
            "'" . trim($data["fecexafiliacion"]) . "'",
            "''", // ctrexpedienteinactivo
            "'" . trim($data["estadomatricula"]) . "'",
            "'" . trim($data["estadodatosmatricula"]) . "'",
            "'" . trim($data["certificardesde"]) . "'",
            // "'" . trim($data["estadoproponente"]) . "'", // 2019-04-25: JINT
            "'" . trim($data["tipopropiedad"]) . "'",
            "'" . trim($ctrlibroscomercio) . "'",
            "'" . trim($data["afiliado"]) . "'",
            "''", // ctrvigilancia
            "''", // ctrestadoactiva
            "''", // ctrestadopreoperativa
            "''", // ctrestadoconcordato
            "''", // ctrestadointervenida
            "''", // ctrestadodisuelta
            "''", // ctrestadoenreestructuracion
            "'" . trim($data["estadocapturado"]) . "'",
            "'" . addslashes(trim($data["estadocapturadootros"])) . "'",
            "'" . trim($ctrembargo) . "'",
            "'" . trim($ctrembargotramite) . "'",
            "'" . trim($ctrrecursotramite) . "'",
            "'" . trim($data["impexp"]) . "'",
            "'" . trim($data["tipolocal"]) . "'",
            "'" . trim($data["ctrfun"]) . "'",
            "'" . trim($data["ctrubi"]) . "'",
            "'" . trim($data["clasegenesadl"]) . "'",
            "'" . trim($data["claseespesadl"]) . "'",
            "'" . trim($data["claseeconsoli"]) . "'",
            "'" . trim($data["ctrderpub"]) . "'",
            "'" . trim($data["ctrcodcoop"]) . "'",
            "'" . trim($data["ctrcodotras"]) . "'",
            "'" . trim($econmixta) . "'",
            intval($data["ctresacntasociados"]),
            intval($data["ctresacntmujeres"]),
            intval($data["ctresacnthombres"]),
            "'" . trim($data["ctresapertgremio"]) . "'",
            "'" . addslashes($data["ctresagremio"]) . "'",
            "'" . addslashes($data["ctresaacredita"]) . "'",
            "'" . trim($data["ctresaivc"]) . "'",
            "'" . trim($data["ctresainfoivc"]) . "'",
            "'" . trim($data["ctresaautregistro"]) . "'",
            "'" . addslashes($data["ctresaentautoriza"]) . "'",
            "'" . trim($data["ctresacodnat"]) . "'",
            "'" . trim($data["ctresadiscap"]) . "'",
            "'" . trim($data["ctresaetnia"]) . "'",
            "'" . addslashes($data["ctresacualetnia"]) . "'",
            "'" . trim($data["ctresadespvictreins"]) . "'",
            "'" . addslashes($data["ctresacualdespvictreins"]) . "'",
            "'" . trim($data["ctresaindgest"]) . "'",
            "'" . trim($data["ctresalgbti"]) . "'",
            "'" . trim($data["art4"]) . "'",
            "'" . trim($data["art7"]) . "'",
            "'" . trim($data["art50"]) . "'",
            "'" . trim($data["benley1780"]) . "'",
            "'" . trim($data["cumplerequisitos1780"]) . "'",
            "'" . trim($data["renunciabeneficios1780"]) . "'",
            "'" . trim($data["cumplerequisitos1780primren"]) . "'",
            "'" . trim($data["ctrcancelacion1429"]) . "'",
            "'" . trim($data["ctrdepuracion1727"]) . "'",
            "'" . trim($data["ctrfechadepuracion1727"]) . "'",
            "'" . trim($data["ctrben658"]) . "'",
            "'" . substr(trim($data["ctrmen"]), 0, 1) . "'",
            "'" . substr(trim($data["ctrmennot"]), 0, 1) . "'",
            doubleval($data["ivcarea"]),
            "'" . trim($data["ivcver"]) . "'",
            "'" . trim($data["ivccretip"]) . "'",
            "'" . trim($data["ivcali"]) . "'",
            "'" . trim($data["ivcqui"]) . "'",
            "'" . trim($data["ivcriesgo"]) . "'",
            "'" . trim($data["ivcenvio"]) . "'",
            "'" . trim($data["ivcsuelos"]) . "'",
            "'" . trim($data["ctrbic"]) . "'",
            intval($data["cantest"]),
            "'" . trim($idereplegal) . "'",
            "'" . addslashes($nomreplegal) . "'",
            "'" . trim($data["gruponiif"]) . "'",
            "'" . trim($data["niifconciliacion"]) . "'",
            "'" . trim($data["aportantesegsocial"]) . "'",
            "'" . trim($data["tipoaportantesegsocial"]) . "'",
            "'" . trim($data["anodatos"]) . "'",
            "'" . trim($data["fechadatos"]) . "'",
            intval($data["personal"]),
            doubleval($data["personaltemp"]),
            doubleval($data["actcte"]),
            doubleval($data["actnocte"]),
            doubleval($data["actfij"]),
            doubleval($data["fijnet"]),
            doubleval($data["actval"]),
            doubleval($data["actotr"]),
            doubleval($data["acttot"]),
            doubleval($data["actsinaju"]),
            doubleval($data["invent"]),
            doubleval($data["pascte"]),
            doubleval($data["paslar"]),
            doubleval($data["pastot"]),
            doubleval($data["pattot"]),
            doubleval($data["paspat"]),
            doubleval($data["balsoc"]),
            doubleval($data["ingope"]),
            doubleval($data["ingnoope"]),
            doubleval($data["gtoven"]), //
            doubleval($data["gtoadm"]), //
            doubleval($data["gtoven"]),
            doubleval($data["gtoadm"]),
            doubleval($data["utiope"]),
            doubleval($data["utinet"]),
            doubleval($data["cosven"]), //
            doubleval($data["depamo"]),
            doubleval($data["gasint"]),
            doubleval($data["gasimp"]),
            doubleval($data["actvin"]),
            doubleval($data["patrimonio"]),
            "'" . trim($data["anodatoscap"]) . "'",
            "'" . trim($data["fechadatoscap"]) . "'",
            doubleval($data["capaut"]),
            doubleval($data["capsus"]),
            doubleval($data["cappag"]),
            doubleval($data["capsoc"]),
            doubleval($data["apolab"]),
            doubleval($data["apolabadi"]),
            doubleval($data["apodin"]),
            doubleval($data["apotra"]),
            doubleval($data["apoact"]),
            doubleval($data["apotot"]),
            doubleval($capesadl),
            doubleval($data["cap_porcnalpri"]),
            doubleval($data["cap_porcnalpub"]),
            doubleval($data["cap_porcnaltot"]),
            doubleval($data["cap_porcextpri"]),
            doubleval($data["cap_porcextpub"]),
            doubleval($data["cap_porcexttot"]),
            intval($data["cantidadmujeres"]),
            doubleval($data["participacionmujeres"]),
            intval($data["cantidadmujerescargosdirectivos"]),
            "'" . trim($nomsegcon) . "'",
            "'" . trim($carsegcon) . "'",
            intval($data["cntestab01"]),
            intval($data["cntestab02"]),
            intval($data["cntestab03"]),
            intval($data["cntestab04"]),
            intval($data["cntestab05"]),
            intval($data["cntestab06"]),
            intval($data["cntestab07"]),
            intval($data["cntestab08"]),
            intval($data["cntestab09"]),
            intval($data["cntestab10"]),
            intval($data["cntestab11"]),
            "'" . trim($data["refcrenom1"]) . "'",
            "'" . trim($data["refcreofi1"]) . "'",
            "'" . trim($data["refcretel1"]) . "'",
            "'" . trim($data["refcrenom2"]) . "'",
            "'" . trim($data["refcreofi2"]) . "'",
            "'" . trim($data["refcretel2"]) . "'",
            "'" . trim($data["refcomnom1"]) . "'",
            "'" . trim($data["refcomdir1"]) . "'",
            "'" . trim($data["refcomtel1"]) . "'",
            "'" . trim($data["refcomnom2"]) . "'",
            "'" . trim($data["refcomdir2"]) . "'",
            "'" . trim($data["refcomtel2"]) . "'",
            "'" . trim($data["cpcodcam"]) . "'",
            "'" . trim($data["cpnummat"]) . "'",
            "'" . trim($data["cprazsoc"]) . "'",
            "'" . trim($data["cpnumnit"]) . "'",
            "'" . trim($data["cpdircom"]) . "'",
            "'" . trim($data["cpdirnot"]) . "'",
            "'" . trim($data["cpnumtel"]) . "'",
            "'" . trim($data["cpnumfax"]) . "'",
            "'" . trim($data["cpcodmun"]) . "'",
            "'" . trim($data["cpmunnot"]) . "'",
            "'" . trim($data["cpafili"]) . "'",
            doubleval($data["cpsaldo"]),
            "'" . trim($data["cpurenafi"]) . "'",
            "'" . trim($data["pendiente_ajuste_nuevo_formato"]) . "'",
            "'" . trim($data["fecha_pendiente_ajuste_nuevo_formato"]) . "'",
            "'" . date("Ymd") . "'",
            "'NO'", // Compite360
            "'NO'", // Rues
            "'NO'" // ivc
        );

        // Graba el registro en mreg_est_inscritos
        $idgrabar = 0;

        //
        if ($data["matricula"] != '') {
            $idreg = retornarRegistroMysqliApi($mysqli, 'mreg_est_inscritos', "matricula='" . ltrim($data["matricula"], "0") . "'");
            if ($idreg && !empty($idreg)) {
                $idgrabar = $idreg["id"];
            }
        } else {
            if ($data["proponente"] != '') {
                $idreg = retornarRegistroMysqliApi($mysqli, 'mreg_est_inscritos', "proponente='" . ltrim($data["proponente"], "0") . "'");
                if ($idreg && !empty($idreg)) {
                    $idgrabar = $idreg["id"];
                }
            }
        }

        if ($idgrabar == 0) {
            unset($_SESSION["expedienteactual"]);
            $control = 'insertar';
            $res = insertarRegistrosMysqliApi($mysqli, 'mreg_est_inscritos', $arrCampos, $arrValores);
            if ($res === false) {
                \logApi::general2($nameLog, ltrim($data["matricula"], "0"), 'Error creando matrícula en mreg_est_inscritos : ' . $_SESSION["generales"]["mensajeerror"]);
                return false;
            }
        }
        if ($idgrabar != 0) {
            unset($_SESSION["expedienteactual"]);
            $control = 'regrabar';
            $res = regrabarRegistrosMysqliApi($mysqli, 'mreg_est_inscritos', $arrCampos, $arrValores, "id=" . $idgrabar);
            if ($res === false) {
                \logApi::general2($nameLog, ltrim($data["matricula"], "0"), 'Error regrabando matrícula en mreg_est_inscritos: ' . $_SESSION["generales"]["mensajeerror"]);
                return false;
            }
        }

        //    
        $datafin = array();
        if ($data["matricula"] != '') {
            $datafin = retornarRegistroMysqliApi($mysqli, 'mreg_est_inscritos', "matricula='" . ltrim($data["matricula"], "0") . "'");
        } else {
            if ($data["proponente"] != '') {
                $datafin = retornarRegistroMysqliApi($mysqli, 'mreg_est_inscritos', "proponente='" . ltrim($data["proponente"], "0") . "'");
            }
        }

        // Actualiza mreg_tamano-empresarial
        if ($data["organizacion"] == '01' || ($data["organizacion"] > '01' && $data["categoria"] == '1')) {
            if ($data["organizacion"] != '12' && $data["organizacion"] != '14') {
                $condicion = "matricula='" . $data["matricula"] . "' and anodatos='" . $data["anodatostamanoempresarial"] . "' and fechadatos='" . $data["fechadatostamanoempresarial"] . "'";
                $arrCampos = array(
                    'matricula',
                    'anodatos',
                    'fechadatos',
                    'ciiu',
                    'ingresos'
                );
                $arrValores = array(
                    "'" . $data["matricula"] . "'",
                    "'" . $data["anodatostamanoempresarial"] . "'",
                    "'" . $data["fechadatostamanoempresarial"] . "'",
                    "'" . $data["ciiutamanoempresarial"] . "'",
                    doubleval($data["ingresostamanoempresarial"]),
                );
                if (contarRegistrosMysqliApi($mysqli, 'mreg_tamano_empresarial', $condicion) == 0) {
                    insertarRegistrosMysqliApi($mysqli, 'mreg_tamano_empresarial', $arrCampos, $arrValores);
                } else {
                    regrabarRegistrosMysqliApi($mysqli, 'mreg_tamano_empresarial', $arrCampos, $arrValores, $condicion);
                }
            }
        }

        // Actualiza códigos CAE
        if (ltrim($data["matricula"], "0") != '') {
            $arrY = retornarRegistrosMysqliApi($mysqli, 'mreg_anexoscae', "1=1", "codigocae");
            if ($arrY && !empty($arrY)) {
                $iValores = 0;
                $arrValores = array();
                $arrCampos = array(
                    'tabla',
                    'registro',
                    'campo',
                    'contenido'
                );

                foreach ($arrY as $y) {
                    borrarRegistrosMysqliApi($mysqli, 'mreg_est_campostablas', "tabla='200' and registro='" . ltrim($data["matricula"], "0") . "' and campo='" . $y["codigocae"] . "'");
                    if (isset($data["codigoscae"][$y["codigocae"]]) && trim($data["codigoscae"][$y["codigocae"]]) != '') {
                        $iValores++;
                        $arrValores[$iValores] = array(
                            "'200'",
                            "'" . ltrim($data["matricula"], "0") . "'",
                            "'" . $y["codigocae"] . "'",
                            "'" . trim($data["codigoscae"][$y["codigocae"]]) . "'"
                        );
                    }
                }
                if ($iValores > 0) {
                    insertarRegistrosBloqueMysqliApi($mysqli, 'mreg_est_campostablas', $arrCampos, $arrValores);
                }
            }
        }

        //
        if ($data["matricula"] != '') {
            $arrCampos = array(
                'matricula',
                'campo',
                'fecha',
                'hora',
                'codigobarras',
                'datoanterior',
                'datonuevo',
                'usuario',
                'ip',
                'tipotramite',
                'recibo'
            );
            $arrValores = array();
            $iCambios = 0;
            $fecxact = date("Ymd");
            $horxact = date("His");
            foreach ($datafin as $key => $valor) {
                if ($key != 'id' &&
                        !is_numeric($key) &&
                        $key != 'matricula' &&
                        $key != 'fecactualizacion' &&
                        $key != 'horactualizacion' &&
                        $key != 'fecsincronizacion' &&
                        $key != 'horsincronizacion' &&
                        $key != 'compite360' &&
                        $key != 'rues' &&
                        $key != 'ivc') {

                    if (!isset($dataori[$key])) {
                        $dataori[$key] = '';
                    }
                    if ($dataori[$key] == null) {
                        $dataori[$key] = '';
                    }
                    if ($dataori[$key] == '.00' || $dataori[$key] == '0.00') {
                        $dataori[$key] = '0';
                    }
                    if ($datafin[$key] == '.00' || $datafin[$key] == '0.00') {
                        $datafin[$key] = '0';
                    }

                    if (ltrim(trim($dataori[$key]), "0") != ltrim(trim($datafin[$key]), "0")) {
                        $iCambios++;
                        $arrValores [$iCambios] = array(
                            "'" . ltrim($data["matricula"], "0") . "'",
                            "'" . $key . "'",
                            "'" . $fecxact . "'",
                            "'" . $horxact . "'",
                            "'" . $codbarras . "'",
                            "'" . addslashes(ltrim(trim($dataori[$key]), "0")) . "'",
                            "'" . addslashes(ltrim(trim($datafin[$key]), "0")) . "'",
                            "'" . $_SESSION["generales"]["codigousuario"] . "'",
                            "'" . \funcionesGenerales::localizarIP() . "'",
                            "'" . $tt . "'",
                            "'" . $rec . "'"
                        );
                    }
                }
            }

            //
            if ($iCambios > 0) {
                $res = insertarRegistrosBloqueMysqliApi($mysqli, 'mreg_campos_historicos_' . substr($fecxact, 0, 4), $arrCampos, $arrValores);
                if ($res === false) {
                    \logApi::general2('actualizarMregCamposHistoricos_' . date("Ymd"), ltrim($data["matricula"], "0"), 'Error grabando matrícula en mreg_campos_historicos_AAAA: ' . $_SESSION["generales"]["mensajeerror"]);
                    return false;
                }
            }
        }

        // Revisa información financiera
        if ($data["matricula"] != '') {
            foreach ($data["f"] as $fin) {
                $arrFin = retornarRegistroMysqliApi($mysqli, 'mreg_est_financiera', "matricula='" . ltrim($data["matricula"], "0") . "' and anodatos='" . $fin["anodatos"] . "' and fechadatos='" . $fin["fechadatos"] . "'");
                if ($arrFin === false || empty($arrFin)) {
                    $accion = 'insertar';
                } else {
                    $accion = 'no';
                    if (!isset($fin["patrimonio"])) {
                        $fin["patrimonio"] = 0;
                    }
                    if ($fin["personal"] != $arrFin["personal"] ||
                            $fin["patrimonio"] != $arrFin["patrimonio"] ||
                            $fin["personaltemp"] != $arrFin["pcttemp"] ||
                            $fin["actvin"] != $arrFin["actvin"] ||
                            $fin["actcte"] != $arrFin["actcte"] ||
                            $fin["actnocte"] != $arrFin["actnocte"] ||
                            $fin["actfij"] != $arrFin["actfij"] ||
                            $fin["fijnet"] != $arrFin["fijnet"] ||
                            $fin["actval"] != $arrFin["actval"] ||
                            $fin["actotr"] != $arrFin["actotr"] ||
                            $fin["acttot"] != $arrFin["acttot"] ||
                            $fin["actsinaju"] != $arrFin["actsinaju"] ||
                            $fin["invent"] != $arrFin["invent"] ||
                            $fin["pascte"] != $arrFin["pascte"] ||
                            $fin["paslar"] != $arrFin["paslar"] ||
                            $fin["pastot"] != $arrFin["pastot"] ||
                            $fin["patnet"] != $arrFin["patnet"] ||
                            $fin["paspat"] != $arrFin["paspat"] ||
                            $fin["balsoc"] != $arrFin["balsoc"] ||
                            $fin["ingope"] != $arrFin["ingope"] ||
                            $fin["ingnoope"] != $arrFin["ingnoope"] ||
                            $fin["gtoven"] != $arrFin["gasope"] ||
                            $fin["gtoadm"] != $arrFin["gasadm"] ||
                            $fin["gtoadm"] != $arrFin["gasnoope"] ||
                            $fin["cosven"] != $arrFin["cosven"] ||
                            $fin["gtoven"] != $arrFin["gtoven"] ||
                            $fin["gasint"] != $arrFin["gasint"] ||
                            $fin["gasimp"] != $arrFin["gasimp"] ||
                            $fin["utiope"] != $arrFin["utiope"] ||
                            $fin["utinet"] != $arrFin["utinet"]
                    ) {
                        $accion = 'regrabar';
                    }
                }

                if ($accion == 'insertar' || $accion == 'regrabar') {
                    $arrCampos = array(
                        'matricula',
                        'anodatos',
                        'fechadatos',
                        'personal',
                        'pcttemp',
                        'patrimonio',
                        'actvin',
                        'actcte',
                        'actnocte',
                        'actfij',
                        'fijnet',
                        'actval',
                        'actotr',
                        'acttot',
                        'actsinaju',
                        'invent',
                        'pascte',
                        'paslar',
                        'pastot',
                        'patnet',
                        'paspat',
                        'balsoc',
                        'ingope',
                        'ingnoope',
                        'gasope',
                        'gasadm',
                        'gasnoope',
                        'cosven',
                        'gtoven',
                        'gasint',
                        'gasimp',
                        'utiope',
                        'utinet',
                        'depamo',
                        'fecsincronizacion',
                        'horsincronizacion',
                        'compite360'
                    );
                    $arrValores = array(
                        "'" . ltrim($data["matricula"], "0") . "'",
                        "'" . $fin["anodatos"] . "'",
                        "'" . $fin["fechadatos"] . "'",
                        intval($fin["personal"]),
                        doubleval($fin["personaltemp"]),
                        doubleval($fin["patrimonio"]),
                        doubleval($fin["actvin"]),
                        doubleval($fin["actcte"]),
                        doubleval($fin["actnocte"]),
                        doubleval($fin["actfij"]),
                        doubleval($fin["fijnet"]),
                        doubleval($fin["actval"]),
                        doubleval($fin["actotr"]),
                        doubleval($fin["acttot"]),
                        doubleval($fin["actsinaju"]),
                        doubleval($fin["invent"]),
                        doubleval($fin["pascte"]),
                        doubleval($fin["paslar"]),
                        doubleval($fin["pastot"]),
                        doubleval($fin["pattot"]),
                        doubleval($fin["paspat"]),
                        doubleval($fin["balsoc"]),
                        doubleval($fin["ingope"]),
                        doubleval($fin["ingnoope"]),
                        doubleval($fin["gtoven"]),
                        doubleval($fin["gtoadm"]),
                        doubleval($fin["gtoadm"]), //
                        doubleval($fin["cosven"]), //
                        doubleval($fin["gtoven"]), //
                        doubleval($fin["gasint"]), //
                        doubleval($fin["gasimp"]), //
                        doubleval($fin["utiope"]),
                        doubleval($fin["utinet"]),
                        0, // Depamo
                        "'" . date("Ymd") . "'",
                        "'" . date("His") . "'",
                        "'NO'"
                    );
                    if ($accion == 'insertar') {
                        $res = insertarRegistrosMysqliApi($mysqli, 'mreg_est_financiera', $arrCampos, $arrValores);
                        if ($res === false) {
                            \logApi::general2('actualizarMregEstFinanciera_' . date("Ymd"), ltrim($data["matricula"], "0"), 'Error insertando matrícula en mreg_est_financiera: ' . $_SESSION["generales"]["mensajeerror"]);
                            return false;
                        }
                    }
                    if ($accion == 'regrabar') {
                        $res = regrabarRegistrosMysqliApi($mysqli, 'mreg_est_financiera', $arrCampos, $arrValores, "matricula='" . ltrim($data["matricula"], "0") . "' and anodatos='" . $fin["anodatos"] . "' and fechadatos='" . $fin["fechadatos"] . "'");
                        if ($res === false) {
                            \logApi::general2('actualizarMregEstFinanciera_' . date("Ymd"), ltrim($data["matricula"], "0"), 'Error regrabando matrícula en mreg_est_financiera: ' . $_SESSION["generales"]["mensajeerror"]);
                            return false;
                        }
                    }

                    //
                    $arrCampos = array(
                        'matricula',
                        'campo',
                        'fecha',
                        'hora',
                        'codigobarras',
                        'datoanterior',
                        'datonuevo',
                        'usuario',
                        'ip',
                        'tipotramite',
                        'recibo'
                    );
                    $arrValores = array();
                    $iCambios = 0;
                    $fecxact = date("Ymd");
                    $horxact = date("His");
                    $arrFinFin = retornarRegistroMysqliApi($mysqli, 'mreg_est_financiera', "matricula='" . ltrim($data["matricula"], "0") . "' and anodatos='" . $fin["anodatos"] . "' and fechadatos='" . $fin["fechadatos"] . "'");
                    foreach ($arrFinFin as $key => $valor) {
                        if ($key != 'id' &&
                                !is_numeric($key) &&
                                $key != 'matricula' &&
                                $key != 'anodatos' &&
                                $key != 'fechadatos' &&
                                $key != 'fecsincronizacion' &&
                                $key != 'horsincronizacion' &&
                                $key != 'compite360') {
                            if (!isset($arrFin[$key])) {
                                $arrFin[$key] = '';
                            }
                            if ($arrFin[$key] == null) {
                                $arrFin[$key] = '';
                            }
                            if (ltrim(trim($arrFinFin[$key]), "0") != ltrim(trim($arrFin[$key]), "0")) {
                                $iCambios++;
                                $arrValores [$iCambios] = array(
                                    "'" . ltrim($data["matricula"], "0") . "'",
                                    "'" . $key . '-' . $data["anodatos"] . '-' . $data["fechadatos"] . "'",
                                    "'" . $fecxact . "'",
                                    "'" . $horxact . "'",
                                    "'" . $codbarras . "'",
                                    "'" . addslashes(ltrim(trim($arrFin[$key]), "0")) . "'",
                                    "'" . addslashes(ltrim(trim($arrFinFin[$key]), "0")) . "'",
                                    "'" . $_SESSION["generales"]["codigousuario"] . "'",
                                    "'" . \funcionesGenerales::localizarIP() . "'",
                                    "'" . $tt . "'",
                                    "'" . $rec . "'"
                                );
                            }
                        }
                    }
                    if ($iCambios > 0) {
                        $res = insertarRegistrosBloqueMysqliApi($mysqli, 'mreg_campos_historicos_' . substr($fecxact, 0, 4), $arrCampos, $arrValores);
                        if ($res === false) {
                            \logApi::general2('actualizarMregCamposHistoricos_' . date("Ymd"), ltrim($data["matricula"], "0"), 'Error grabando matrícula en mreg_campos_historicos: ' . $_SESSION["generales"]["mensajeerror"]);
                            return false;
                        }
                    }
                }
            }
        }

        //
        if ($data["matricula"] != '') {
            if ($tt == 'digitacionformulario' || $tt == 'actualizacionmatriculado') {
                if ($data["anodatos"] != '' && $data["fechadatos"] != '') {
                    $condicion = "matricula='" . ltrim($data["matricula"], "0") . "' and anodatos='" . $data["anodatos"] . "' and fechadatos='" . $data["fechadatos"] . "'";
                    $arrFin = retornarRegistroMysqliApi($mysqli, 'mreg_est_financiera', $condicion);
                    $arrCampos = array(
                        'matricula',
                        'anodatos',
                        'fechadatos',
                        'personal',
                        'pcttemp',
                        'patrimonio',
                        'actvin',
                        'actcte',
                        'actnocte',
                        'actfij',
                        'fijnet',
                        'actval',
                        'actotr',
                        'acttot',
                        'actsinaju',
                        'invent',
                        'pascte',
                        'paslar',
                        'pastot',
                        'patnet',
                        'paspat',
                        'balsoc',
                        'ingope',
                        'ingnoope',
                        'gasope',
                        'gasadm',
                        'gasnoope',
                        'cosven',
                        'gtoven',
                        'gasint',
                        'gasimp',
                        'utiope',
                        'utinet',
                        'depamo',
                        'fecsincronizacion',
                        'horsincronizacion',
                        'compite360'
                    );
                    $arrValores = array(
                        "'" . ltrim($data["matricula"], "0") . "'",
                        "'" . $data["anodatos"] . "'",
                        "'" . $data["fechadatos"] . "'",
                        intval($data["personal"]),
                        doubleval($data["personaltemp"]),
                        doubleval($data["patrimonio"]),
                        doubleval($data["actvin"]),
                        doubleval($data["actcte"]),
                        doubleval($data["actnocte"]),
                        doubleval($data["actfij"]),
                        doubleval($data["fijnet"]),
                        doubleval($data["actval"]),
                        doubleval($data["actotr"]),
                        doubleval($data["acttot"]),
                        doubleval($data["actsinaju"]),
                        doubleval($data["invent"]),
                        doubleval($data["pascte"]),
                        doubleval($data["paslar"]),
                        doubleval($data["pastot"]),
                        doubleval($data["pattot"]),
                        doubleval($data["paspat"]),
                        doubleval($data["balsoc"]),
                        doubleval($data["ingope"]),
                        doubleval($data["ingnoope"]),
                        doubleval($data["gtoven"]),
                        doubleval($data["gtoadm"]),
                        doubleval($data["gtoadm"]), //
                        doubleval($data["cosven"]), //
                        doubleval($data["gtoven"]), //
                        doubleval($data["gasint"]), //
                        doubleval($data["gasimp"]), //
                        doubleval($data["utiope"]),
                        doubleval($data["utinet"]),
                        0, // Depamo
                        "'" . date("Ymd") . "'",
                        "'" . date("His") . "'",
                        "'NO'"
                    );
                    if ($arrFin && !empty($arrFin)) {
                        regrabarRegistrosMysqliApi($mysqli, 'mreg_est_financiera', $arrCampos, $arrValores, $condicion);
                    } else {
                        insertarRegistrosMysqliApi($mysqli, 'mreg_est_financiera', $arrCampos, $arrValores);
                    }
                }
            }
        }

        // 2017-08-17 : JINT: Actualiza la información  de patrimonios de esadl 
        if (!isset($data["anodatospatrimonio"])) {
            $data["anodatospatrimonio"] = '';
        }
        if (!isset($data["fechadatospatrimonio"])) {
            $data["fechadatospatrimonio"] = '';
        }
        if (!isset($data["patrimonioesadl"])) {
            $data["patrimonioesadl"] = 0;
        }

        //
        if ($data["matricula"] != '') {
            if ($data["anodatospatrimonio"] != '' && $data["fechadatospatrimonio"] != '' && doubleval($data["patrimonioesadl"]) != 0) {
                $condicion = "matricula='" . ltrim($data["matricula"], "0") . "' and anodatos='" . $data["anodatospatrimonio"] . "' and fechadatos='" . $data["fechadatospatrimonio"] . "'";
                $arrPat = retornarRegistroMysqliApi($mysqli, 'mreg_est_patrimonios', $condicion);
                $arrCampos = array(
                    'matricula',
                    'anodatos',
                    'fechadatos',
                    'patrimonio'
                );
                $arrValores = array(
                    "'" . $data["matricula"] . "'",
                    "'" . $data["anodatospatrimonio"] . "'",
                    "'" . $data["fechadatospatrimonio"] . "'",
                    doubleval($data["patrimonioesadl"])
                );
                if ($arrPat && !empty($arrPat)) {
                    regrabarRegistrosMysqliApi($mysqli, 'mreg_est_patrimonios', $arrCampos, $arrValores, $condicion);
                } else {
                    insertarRegistrosMysqliApi($mysqli, 'mreg_est_patrimonios', $arrCampos, $arrValores);
                }
            }
        }

        // ********************************************************************************************* //
        // 2018-08-31: JINT: Por seguridad actualiza la fecha de mreg_est_inscritos
        // ********************************************************************************************* 
        if ($data["matricula"] != '') {
            $arrCampos = array(
                'fecactualizacion',
                'compite360',
                'rues',
                'ivc'
            );
            $arrValores = array(
                "'" . date("Ymd") . "'",
                "'NO'",
                "'NO'",
                "'NO'"
            );
            regrabarRegistrosMysqliApi($mysqli, 'mreg_est_inscritos', $arrCampos, $arrValores, "matricula='" . $data["matricula"] . "'");
        }

        //
        return true;
    }

    public static function actualizarMregEstInscritosCampo($dbx, $matricula, $campo, $contenido = '', $tipocampo = 'varchar', $codbarras = '', $tipotramite = '', $recibo = '') {


        // Valida que el expedienmte tenga diferencias
        if (ltrim($matricula, "0") == '') {
            return true;
        }

        //
        $datoori = retornarRegistroMysqliApi($dbx, 'mreg_est_inscritos', "matricula='" . $matricula . "'", $campo);
        if (ltrim(trim($datoori), "0") != ltrim(trim($contenido), "0")) {
            $arrCampos = array(
                $campo,
                'fecactualizacion',
                'compite360',
                'rues',
                'ivc'
            );
            if ($tipocampo == 'varchar') {
                $arrValores = array(
                    "'" . trim($contenido) . "'",
                    "'" . date("Ymd") . "'",
                    "'NO'",
                    "'NO'",
                    "'NO'"
                );
            }
            if ($tipocampo == 'int') {
                $arrValores = array(
                    intval($contenido),
                    "'" . date("Ymd") . "'",
                    "'NO'",
                    "'NO'",
                    "'NO'"
                );
            }
            if ($tipocampo == 'double') {
                $arrValores = array(
                    doubleval($contenido),
                    "'" . date("Ymd") . "'",
                    "'NO'",
                    "'NO'",
                    "'NO'"
                );
            }
            unset($_SESSION["expedienteactual"]);
            $res = regrabarRegistrosMysqliApi($dbx, 'mreg_est_inscritos', $arrCampos, $arrValores, "matricula='" . $matricula . "'");
            if ($res === false) {
                \logApi::general2('actualizarMregEstInscritos_' . date("Ymd"), ltrim($matricula, "0"), 'Error regrabando en mreg_est_inscritos: ' . $_SESSION["generales"]["mensajeerror"]);
                return false;
            }

            $arrCampos = array(
                'matricula',
                'campo',
                'fecha',
                'hora',
                'codigobarras',
                'datoanterior',
                'datonuevo',
                'usuario',
                'ip',
                'tipotramite',
                'recibo'
            );
            $arrValores = array(
                "'" . ltrim($matricula, "0") . "'",
                "'" . $campo . "'",
                "'" . date("Ymd") . "'",
                "'" . date("His") . "'",
                "'" . $codbarras . "'",
                "'" . addslashes($datoori) . "'",
                "'" . addslashes($contenido) . "'",
                "'" . $_SESSION["generales"]["codigousuario"] . "'",
                "'" . \funcionesGenerales::localizarIP() . "'",
                "'" . $tipotramite . "'",
                "'" . $recibo . "'"
            );
            $res = insertarRegistrosMysqliApi($dbx, 'mreg_campos_historicos_' . date("Y"), $arrCampos, $arrValores);
            if ($res === false) {
                \logApi::general2('actualizarMregCamposHistoricos_' . date("Ymd"), ltrim($matricula, "0"), 'Error grabando en mreg_campos_historicos: ' . $_SESSION["generales"]["mensajeerror"]);
                return false;
            }
        }

        //
        return true;
    }

    public static function actualizarMregInscritosPendienteNuevoCertificado($mysqli = null, $libro = null, $acto = null, $matricula = null) {
        $acto = retornarRegistroMysqliApi($mysqli, 'mreg_actos', "idlibro='" . $libro . "' and idacto='" . $acto . "'");
        if ($acto["idgrupoacto"] != '002' && // Cancelaciones
                $acto["idgrupoacto"] != '003' && // Mutaciones
                $acto["idgrupoacto"] != '004' && // Libros
                $acto["idgrupoacto"] != '046' && // Sitios web
                $acto["idgrupoacto"] != '047' && // habilitación del servicio de transporte
                $acto["idgrupoacto"] != '052' && // Proponente
                $acto["idgrupoacto"] != '999' // otros
        ) {
            if (ltrim($matricula, "0") != '') {
                $exptx = retornarRegistroMysqliApi($mysqli, 'mreg_est_inscritos', "matricula='" . ltrim($matricula, "0") . "'", "matricula,organizacion,categoria,ctrestmatricula,pendiente_ajuste_nuevo_formato,fecha_pendiente_ajuste_nuevo_formato");
                if ($exptx &&
                        ($exptx["ctrestmatricula"] == 'MA' ||
                        $exptx["ctrestmatricula"] == 'IA' ||
                        $exptx["ctrestmatricula"] == 'MI' ||
                        $exptx["ctrestmatricula"] == 'II' ||
                        $exptx["ctrestmatricula"] == 'MR' ||
                        $exptx["ctrestmatricula"] == 'IR')
                ) {
                    if ($exptx["organizacion"] > '02' && ($exptx["categoria"] == '1' || $exptx["categoria"] == '2')) {
                        $marcar = 'no';
                        if ($exptx["organizacion"] == '12' || $exptx["organizacion"] == '14') {
                            if (defined('FECHA_INICIO_NUEVO_CERTIFICADO_CERESADL') && FECHA_INICIO_NUEVO_CERTIFICADO_CERESADL != '' && FECHA_INICIO_NUEVO_CERTIFICADO_CERESADL <= date("Ymd")) {
                                $marcar = 'si';
                            } else {
                                if (defined('FECHA_INICIO_NUEVO_CERTIFICADO_CEREXI') && FECHA_INICIO_NUEVO_CERTIFICADO_CEREXI != '' && FECHA_INICIO_NUEVO_CERTIFICADO_CEREXI <= date("Ymd")) {
                                    $marcar = 'si';
                                }
                            }
                        }
                        if ($marcar == 'si') {
                            if ($exptx["pendiente_ajuste_nuevo_formato"] == '') {
                                $arrCampos = array(
                                    'pendiente_ajuste_nuevo_formato',
                                    'fecha_pendiente_ajuste_nuevo_formato'
                                );
                                $arrValores = array(
                                    "'P'",
                                    "'" . date("Ymd") . ' ' . date("His") . "'"
                                );
                                regrabarRegistrosMysqliApi($mysqli, 'mreg_est_inscritos', $arrCampos, $arrValores, "matricula='" . ltrim($matricula, "0") . "'");
                            }
                        }
                    }
                }
            }
        }
        return true;
    }

    public static function actualizarMregLiquidacionFlujo($dbx, $tt, $numliq, $idsol, $est, $numrec, $numope, $numrad, $fecrec, $horrec) {
        $arrCampos = array(
            'tipotramite',
            'idliquidacion',
            'idsolicitudpago',
            'idestadoflujo',
            'numerorecibo',
            'numerooperacion',
            'numeroradicacion',
            'fecharecibo',
            'horarecibo'
        );
        $arrValues = array(
            "'" . $tt . "'",
            $numliq,
            "'" . $idsol . "'",
            "'" . $est . "'",
            "'" . $numrec . "'",
            "'" . $numope . "'",
            "'" . $numrad . "'",
            "'" . $fecrec . "'",
            "'" . $horrec . "'"
        );

        insertarRegistrosMysqliApi($dbx, 'mreg_liquidacionflujo', $arrCampos, $arrValues);
    }

    public static function actualizarMregLiquidacionPagoElectronico($dbx, $liqui, $est, $nomcli, $idtipide, $dir, $tel, $mun, $email, $ide, $pagefe, $pagche, $pagvis, $pagach, $pagmas, $pagame, $pagcre, $pagdin, $pagtdeb, $codban, $numche, $numaut, $caj, $numope, $numrec, $fecrec, $horrec, $codbar, $xfra, $xnfra, $formapago = '05') {

        $arrCampos = array(
            'idestado',
            'idtipoidentificacioncliente',
            'identificacioncliente',
            'nombrecliente',
            'email',
            'direccion',
            'idmunicipio',
            'telefono',
            'pagoefectivo',
            'pagocheque',
            'pagovisa',
            'pagomastercard',
            'pagoamerican',
            'pagocredencial',
            'pagodiners',
            'pagotdebito',
            'idformapago',
            'numerorecibo',
            'numerooperacion',
            'fecharecibo',
            'horarecibo',
            'idfranquicia',
            'nombrefranquicia',
            'numeroautorizacion',
            'idcodban',
            'nombrebanco',
            'numerocheque',
            'numeroradicacion'
        );
        $arrValues = array(
            "'" . $est . "'",
            "'" . $idtipide . "'",
            "'" . $ide . "'",
            "'" . $nomcli . "'",
            "'" . $email . "'",
            "'" . addslashes(utf8_encode($dir)) . "'",
            "'" . $mun . "'",
            "'" . $tel . "'",
            $pagefe,
            $pagche,
            $pagvis,
            $pagmas,
            $pagame,
            $pagcre,
            $pagdin,
            $pagtdeb,
            "'" . $formapago . "'", // idformapago (pago electr&oacute;nico)
            "'" . $numrec . "'",
            "'" . $numope . "'",
            "'" . $fecrec . "'",
            "'" . $horrec . "'",
            "'" . $xfra . "'", // idfranquicia
            "'" . $xnfra . "'", // nombre franquicia
            "'" . $numaut . "'",
            "'" . $codban . "'",
            "''", // nombre banco
            "'" . $numche . "'",
            "'" . $codbar . "'"
        );
        regrabarRegistrosMysqliApi($dbx, 'mreg_liquidacion', $arrCampos, $arrValues, "idliquidacion=" . $liqui);
        return true;
    }

    public static function actualizarMregLiquidacionEstado($dbx, $liqui, $est) {
        $arrCampos = array('idestado');
        $arrValores = array("'" . $est . "'");
        $result = regrabarRegistrosMysqliApi($dbx, 'mreg_liquidacion', $arrCampos, $arrValores, "idliquidacion=" . $liqui);
        if ($result === false) {
            return false;
        } else {
            return true;
        }
    }

    public static function actualizarMregRadicacionesDatos($dbx, $numrad, $sec, $tipotra, $exp, $est, $xml) {
        $arrCampos = array(
            'idradicacion',
            'secuencia',
            'tipotramite',
            'expediente',
            'idestado',
            'xml'
        );
        $arrValues = array(
            "'" . ltrim($numrad, "0") . "'",
            "'" . $sec . "'",
            "'" . $tipotra . "'",
            "'" . $exp . "'",
            "'" . $est . "'",
            "'" . addslashes($xml) . "'"
        );
        $query = "idradicacion='" . ltrim($numrad, "0") . "' and secuencia='" . $sec . "'";
        $result = borrarRegistrosMysqliApi($dbx, 'mreg_radicacionesdatos', $query);
        if ($result === false) {
            return false;
        } else {
            $result = insertarRegistrosMysqliApi($dbx, 'mreg_radicacionesdatos', $arrCampos, $arrValues);
            if ($result === false) {
                return false;
            } else {
                return true;
            }
        }
    }

    public static function actualizarMregSecuencia($dbx, $clave, $contenido) {

        $arrTem = retornarRegistroMysqliApi($dbx, 'mreg_secuencias', "id='" . $clave . "'");

        //
        if ($arrTem === false || empty($arrTem)) {

            $arrCampos = array(
                'id',
                'secuencia'
            );
            $arrValores = array(
                "'" . $clave . "'",
                $contenido
            );
            insertarRegistrosMysqliApi($dbx, 'mreg_secuencias', $arrCampos, $arrValores);
        } else {

            $arrCampos = array(
                'id',
                'secuencia'
            );
            $arrValores = array(
                "'" . $clave . "'",
                $contenido
            );
            regrabarRegistrosMysqliApi($dbx, 'mreg_secuencias', $arrCampos, $arrValores, "id='" . $clave . "'");
        }
    }

    public static function actualizarMregSecuenciasAsentarRecibo($mysqli, $clave, $contenido) {

        $arrTem = retornarRegistroMysqliApi($mysqli, 'mreg_secuencias', "id='" . $clave . "'");

        //
        if ($arrTem === false || empty($arrTem)) {

            $arrCampos = array(
                'id',
                'secuencia'
            );
            $arrValores = array(
                "'" . $clave . "'",
                $contenido
            );
            insertarRegistrosMysqliApi($mysqli, 'mreg_secuencias', $arrCampos, $arrValores);
        } else {

            $arrCampos = array(
                'id',
                'secuencia'
            );
            $arrValores = array(
                "'" . $clave . "'",
                $contenido
            );
            regrabarRegistrosMysqliApi($mysqli, 'mreg_secuencias', $arrCampos, $arrValores, "id='" . $clave . "'");
        }
    }

    /**
     * 
     * @param type $mysqli
     * @param type $tnot
     * @param type $rad
     * @param type $dev
     * @param type $ope
     * @param type $rec
     * @param type $lib
     * @param type $reg
     * @param type $dup
     * @param type $idc
     * @param type $ide
     * @param type $mat
     * @param type $pro
     * @param type $nom
     * @param type $ema
     * @param type $det
     * @param type $fpro
     * @param type $hpro
     * @param type $fnot
     * @param type $hnot
     * @param type $est
     * @param type $obs
     * @param type $bandeja
     * @return boolean
     */
    public static function actualizarMregNotificacionesParaEnviarEmail(
            $mysqli, $tnot, $rad, $dev, $ope, $rec, $lib, $reg, $dup, $idc, $ide, $mat, $pro, $nom, $ema, $det, $fpro, $hpro, $fnot, $hnot, $est, $obs = '', $bandeja = ''
    ) {

        //
        require_once ($_SESSION["generales"]["pathabsoluto"] . '/api/genPdfImagenes.php');

        //
        ini_set('memory_limit', '1024M');

        //
        $arrCampos = array(
            'tiponotificacion',
            'radicacion',
            'devolucion',
            'operacion',
            'recibo',
            'libro',
            'registro',
            'dupli',
            'idclase',
            'numid',
            'matricula',
            'proponente',
            'nombre',
            'email',
            'detallenotificacion',
            'fechaprogramacion',
            'horaprogramacion',
            'fechanotificacion',
            'horanotificacion',
            'idestadonotificacion',
            'observaciones'
        );
        $arrValores = array(
            "'" . $tnot . "'",
            "'" . $rad . "'",
            "'" . $dev . "'",
            "'" . $ope . "'",
            "'" . $rec . "'",
            "'" . $lib . "'",
            "'" . $reg . "'",
            "'" . $dup . "'",
            "'" . $idc . "'",
            "'" . $ide . "'",
            "'" . $mat . "'",
            "'" . $pro . "'",
            "'" . addslashes($nom) . "'",
            "'" . addslashes($ema) . "'",
            "'" . addslashes($det) . "'",
            "'" . $fpro . "'",
            "'" . $hpro . "'",
            "'" . $fnot . "'",
            "'" . $hnot . "'",
            "'" . $est . "'",
            "'" . addslashes($obs) . "'"
        );
        insertarRegistrosMysqliApi($mysqli, 'mreg_notificaciones_para_enviar_email', $arrCampos, $arrValores);

        // Crea el pdf de la notifcicación
        $_SESSION["generales"]["idanexogenerado"] = generarPdfNotificacionEmailApi($mysqli, $tnot, $rad, $dev, $ope, $rec, $lib, $reg, $dup, $idc, $ide, $mat, $pro, $nom, $ema, $det, $fpro, $hpro, $fnot, $hnot, $est, $obs, $bandeja);

        // Valida que el pdf haya quedado bien generado
        // Busca en el texto del pdf la secuencia "Fecha y hora de programaci"
        // si la encuentra deuelve true de lo controario false.
        $retornar = true;
        $anx = retornarRegistroMysqliApi($mysqli, 'mreg_radicacionesanexos', "idanexo=" . $_SESSION["generales"]["idanexogenerado"]);
        if (file_exists($_SESSION["generales"]["pathabsoluto"] . '/' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/' . $anx["path"])) {
            $resv = \funcionesGenerales::validarPdf($_SESSION["generales"]["pathabsoluto"] . '/' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/' . $anx["path"], 'Fecha y hora de programaci');
            if (!$resv) {
                $retornar = false;
            }
        }

        //
        return $retornar;
    }

    /**
     * 
     * @param type $mysqli
     * @param type $cel
     * @param type $tip
     * @param type $rec
     * @param type $cba
     * @param type $ins
     * @param type $dev
     * @param type $exp
     * @param type $mat
     * @param type $pro
     * @param type $ide
     * @param type $nom
     * @param type $txt
     * @param type $obs
     * @param type $bandeja
     * @return boolean
     */
    public static function actualizarPilaSms($mysqli, $cel, $tip, $rec, $cba, $ins, $dev, $exp, $mat, $pro, $ide, $nom, $txt, $obs = '', $bandeja = '') {

        //
        require_once ($_SESSION["generales"]["pathabsoluto"] . '/api/genPdfImagenes.php');

        //
        $arrCampos = array(
            'celular',
            'texto',
            'recibo',
            'codigobarras',
            'inscripcion',
            'devolucion',
            'expediente',
            'matricula',
            'proponente',
            'identificacion',
            'nombre',
            'fechaprogramacion',
            'horaprogramacion',
            'tipo',
            'estado',
            'fechaenvio',
            'horaenvio'
        );

        //
        $arrValores = array(
            "'" . $cel . "'",
            "'" . addslashes($txt) . "'",
            "'" . $rec . "'",
            "'" . $cba . "'",
            "'" . $ins . "'",
            "'" . $dev . "'",
            "'" . ltrim($exp, "0") . "'",
            "'" . ltrim($mat, "0") . "'",
            "'" . ltrim($pro, "0") . "'",
            "'" . ltrim($ide, "0") . "'",
            "'" . addslashes($nom) . "'",
            "'" . date("Ymd") . "'",
            "'" . date("His") . "'",
            "'" . $tip . "'",
            "'1'",
            "''",
            "''"
        );

        insertarRegistrosMysqliApi($mysqli, 'pila_sms', $arrCampos, $arrValores);

        // Crea el pdf de la notificación sipref 
        if ($tip != '6' && $tip != '7' && $tip != '90') {
            $id = generarPdfNotificacionSmsApi($mysqli, $cel, $tip, $rec, $cba, $ins, $dev, $exp, $mat, $pro, $ide, $nom, $txt, $obs, $bandeja);
        }
        return true;
    }

    public static function actualizarPrepago($dbx, $cri, $ide, $clave = '', $valor = '', $recibo = '', $numoperacion = '', $servicio = '', $cantidad = '', $detalle = '', $ip = '', $usuario = '', $expediente = '', $email = '', $nombre = '', $celular = '', $direccion = '', $municipio = '', $tipousuario = '', $telefono = '', $nom1 = '', $nom2 = '', $ape1 = '', $ape2 = '') {

        $resultado = array();
        $resultado["codigoError"] = '0000';
        $resultado["msgError"] = '';
        $resultado["identificacion"] = $ide;
        $resultado["nombre"] = '';
        $resultado["nombre1"] = '';
        $resultado["nombre2"] = '';
        $resultado["apellido1"] = '';
        $resultado["apellido2"] = '';
        $resultado["email"] = '';
        $resultado["telefono"] = '';
        $resultado["celular"] = '';
        $resultado["direccion"] = '';
        $resultado["municipio"] = '';
        $resultado["clave"] = '';
        $resultado["saldoprepago"] = '0';
        $resultado["saldoafiliado"] = '0';
        $resultado["kardex"] = array();
        $resultado["saldos"] = array();

        if ($cri == 'S' || $cri == 'R') { // Retorna los datos y el saldo de un prepago
            $prep = retornarRegistroMysqliApi($dbx, 'mreg_prepagos', "identificacion='" . $ide . "'");
            if ($prep && !empty($prep)) {
                $resultado["nombre"] = $prep["nombre"];
                $resultado["nombre1"] = $prep["nombre1"];
                $resultado["nombre2"] = $prep["nombre2"];
                $resultado["apellido1"] = $prep["apellido1"];
                $resultado["apellido2"] = $prep["apellido2"];
                $resultado["email"] = $prep["email"];
                $resultado["telefono"] = $prep["telefono"];
                $resultado["celular"] = $prep["celular"];
                $resultado["direccion"] = $prep["direccion"];
                $resultado["municipio"] = $prep["municipio"];
                $resultado["clave"] = $prep["clave"];
                $resultado["saldoprepago"] = '0';
                $resultado["saldoafiliado"] = '0';
                $preps = retornarRegistrosMysqliApi($dbx, 'mreg_prepagos_uso', "identificacion='" . $ide . "'", "fecha,hora");
                if ($preps && !empty($preps)) {
                    foreach ($preps as $p) {
                        if ($p["tipomov"] == 'C') {
                            $resultado["saldoprepago"] = $resultado["saldoprepago"] + $p["valor"];
                        } else {
                            $resultado["saldoprepago"] = $resultado["saldoprepago"] - $p["valor"];
                        }
                    }
                }
            }
            return $resultado;
        }

        if ($cri == 'K') { // retorna el kardex de un prepago
            $prep = retornarRegistroMysqliApi($dbx, 'mreg_prepagos', "identificacion='" . $ide . "'");
            if ($prep && !empty($prep)) {
                $resultado["nombre"] = $prep["nombre"];
                $resultado["nombre1"] = $prep["nombre1"];
                $resultado["nombre2"] = $prep["nombre2"];
                $resultado["apellido1"] = $prep["apellido1"];
                $resultado["apellido2"] = $prep["apellido2"];
                $resultado["email"] = $prep["email"];
                $resultado["telefono"] = $prep["telefono"];
                $resultado["celular"] = $prep["celular"];
                $resultado["direccion"] = $prep["direccion"];
                $resultado["municipio"] = $prep["municipio"];
                $resultado["clave"] = $prep["clave"];
                $resultado["saldoprepago"] = '0';
                $resultado["saldoafiliado"] = '0';
                $preps = retornarRegistrosMysqliApi($dbx, 'mreg_prepagos_uso', "identificacion='" . $ide . "'", "fecha,hora");
                if ($preps && !empty($preps)) {
                    $ik = 0;
                    foreach ($preps as $p) {
                        if ($p["tipomov"] == 'C') {
                            $resultado["saldoprepago"] = $resultado["saldoprepago"] + $p["valor"];
                        } else {
                            $resultado["saldoprepago"] = $resultado["saldoprepago"] - $p["valor"];
                        }
                        $ik++;
                        $resultado["kardex"][$i]["fecha"] = $p["fecha"];
                        $resultado["kardex"][$i]["hora"] = $p["hora"];
                        $resultado["kardex"][$i]["usuario"] = $p["usuario"];
                        $resultado["kardex"][$i]["operador"] = $p["operador"];
                        $resultado["kardex"][$i]["tipomov"] = $p["tipomov"];
                        $resultado["kardex"][$i]["servicio"] = $p["servicio"];
                        $resultado["kardex"][$i]["expediente"] = $p["expediente"];
                        $resultado["kardex"][$i]["cantidad"] = $p["cantidad"];
                        $resultado["kardex"][$i]["valor"] = $p["valor"];
                        $resultado["kardex"][$i]["recibo"] = $p["recibo"];
                        $resultado["kardex"][$i]["operacion"] = '';
                        $resultado["kardex"][$i]["concepto"] = $p["concepto"];
                    }
                }
            }
            return $resultado;
        }

        if ($cri == 'L') { // retorna la lista de prepagos y su saldo
            $i = 0;
            $prep = retornarRegistrosMysqliApi($dbx, 'mreg_prepagos', "1=1", "identificacion");
            if ($prep && !empty($prep)) {
                foreach ($prep as $p1) {
                    $i++;
                    $resultado["saldos"][$i]["identificacion"] = $p1["identificacion"];
                    $resultado["saldos"][$i]["nombre"] = $p1["nombre"];
                    $resultado["saldos"][$i]["email"] = $p1["email"];
                    $resultado["saldos"][$i]["telefono"] = $p1["telefono"];
                    $resultado["saldos"][$i]["saldo"] = 0;
                    $preps = retornarRegistrosMysqliApi($dbx, 'mreg_prepagos_uso', "identificacion='" . $p1["identificacion"] . "'", "fecha,hora");
                    if ($preps && !empty($preps)) {
                        $ik = 0;
                        foreach ($preps as $p) {
                            if ($p["tipomov"] == 'C') {
                                $resultado["saldos"][$i]["saldo"] = $resultado["saldos"][$i]["saldo"] + $p["valor"];
                            } else {
                                $resultado["saldos"][$i]["saldo"] = $resultado["saldos"][$i]["saldo"] - $p["valor"];
                            }
                        }
                    }
                }
            }
            return $resultado;
        }

        if ($cri == 'A') { // Verifica la clave de un prepago
            $prep = retornarRegistroMysqliApi($dbx, 'mreg_prepagos', "identificacion='" . $ide . "'");
            if (!$prep || empty($prep)) {
                $resultado["codigoError"] = '0020';
                $resultado["msgError"] = 'NO EXISTE PREPAGO PARA LA IDENTIFICACION';
                return $resultado;
            }
            if ($tipousuario != '3') {
                if (md5($clave) != $prep["clave"]) {
                    $resultado["codigoError"] = '0020';
                    $resultado["msgError"] = 'CLAVE NO CORRESPONDE';
                    return $resultado;
                }
            }
            $resultado["nombre"] = $prep["nombre"];
            $resultado["nombre1"] = $prep["nombre1"];
            $resultado["nombre2"] = $prep["nombre2"];
            $resultado["apellido1"] = $prep["apellido1"];
            $resultado["apellido2"] = $prep["apellido2"];
            $resultado["email"] = $prep["email"];
            $resultado["telefono"] = $prep["telefono"];
            $resultado["celular"] = $prep["celular"];
            $resultado["direccion"] = $prep["direccion"];
            $resultado["municipio"] = $prep["municipio"];
            $resultado["clave"] = $prep["clave"];
            $resultado["saldoprepago"] = '0';
            $preps = retornarRegistrosMysqliApi($dbx, 'mreg_prepagos_uso', "identificacion='" . $ide . "'", "fecha,hora");
            if ($preps && !empty($preps)) {
                $ik = 0;
                foreach ($preps as $p) {
                    if ($p["tipomov"] == 'C') {
                        $resultado["saldoprepago"] = $resultado["saldoprepago"] + $p["valor"];
                    } else {
                        $resultado["saldoprepago"] = $resultado["saldoprepago"] - $p["valor"];
                    }
                }
            }
            return $resultado;
        }

        if ($cri == 'P') { // Cambio de clave
            $prep = retornarRegistroMysqliApi($dbx, 'mreg_prepagos', "identificacion='" . $ide . "'");
            if (!$prep || empty($prep)) {
                $resultado["codigoError"] = '0020';
                $resultado["msgError"] = 'NO EXISTE PREPAGO PARA LA IDENTIFICACION';
                return $resultado;
            }
            $arrCampos = array('clave');
            $arrValores = array("'" . md5($clave) . "'");
            regrabarRegistrosMysqliApi($dbx, 'mreg_prepagos', $arrCampos, $arrValores, "identificacion='" . $ide . "'");
            $prep = retornarRegistroMysqliApi($dbx, 'mreg_prepagos', "identificacion='" . $ide . "'");
            $resultado["nombre"] = $prep["nombre"];
            $resultado["nombre1"] = $prep["nombre1"];
            $resultado["nombre2"] = $prep["nombre2"];
            $resultado["apellido1"] = $prep["apellido1"];
            $resultado["apellido2"] = $prep["apellido2"];
            $resultado["email"] = $prep["email"];
            $resultado["telefono"] = $prep["telefono"];
            $resultado["celular"] = $prep["celular"];
            $resultado["direccion"] = $prep["direccion"];
            $resultado["municipio"] = $prep["municipio"];
            $resultado["clave"] = $clave;
            $resultado["saldoprepago"] = '0';
            $preps = retornarRegistrosMysqliApi($dbx, 'mreg_prepagos_uso', "identificacion='" . $ide . "'", "fecha,hora");
            if ($preps && !empty($preps)) {
                $ik = 0;
                foreach ($preps as $p) {
                    if ($p["tipomov"] == 'C') {
                        $resultado["saldoprepago"] = $resultado["saldoprepago"] + $p["valor"];
                    } else {
                        $resultado["saldoprepago"] = $resultado["saldoprepago"] - $p["valor"];
                    }
                }
            }
            return $resultado;
        }

        if ($cri == 'C') { //Carga al prepgo
            $arrCampos = array(
                'identificacion',
                'nombre',
                'nombre1',
                'nombre2',
                'apellido1',
                'apellido2',
                'direccion',
                'telefono',
                'celular',
                'email',
                'municipio',
                'clave'
            );
            $arrValores = array(
                "'" . $ide . "'",
                "'" . addslashes($nombre) . "'",
                "'" . addslashes($nom1) . "'",
                "'" . addslashes($nom2) . "'",
                "'" . addslashes($ape1) . "'",
                "'" . addslashes($ape2) . "'",
                "'" . addslashes($direccion) . "'",
                "'" . $telefono . "'",
                "'" . $celular . "'",
                "'" . addslashes($email) . "'",
                "'" . $municipio . "'",
                "'" . md5($clave) . "'"
            );
            if (contarRegistrosMysqliApi($dbx, 'mreg_prepagos', "identificacion='" . $ide . "'") == 0) {
                insertarRegistrosMysqliApi($dbx, 'mreg_prepagos', $arrCampos, $arrValores);
            } else {
                regrabarRegistrosMysqliApi($dbx, 'mreg_prepagos', $arrCampos, $arrValores, "identificacion='" . $ide . "'");
            }
            $arrCampos = array(
                'identificacion',
                'fecha',
                'hora',
                'ip',
                'operador',
                'usuario',
                'tipomov',
                'servicio',
                'concepto',
                'expediente',
                'recibo',
                'cantidad',
                'valor'
            );
            $arrValores = array(
                "'" . $ide . "'",
                "'" . date("Ymd") . "'",
                "'" . date("His") . "'",
                "'" . $ip . "'",
                "''", // Operador
                "'" . $usuario . "'",
                "'C'",
                "'" . $servicio . "'",
                "'" . $detalle . "'",
                "''",
                "'" . $recibo . "'",
                0,
                $valor
            );
            insertarRegistrosMysqliApi($dbx, 'mreg_prepagos_uso', $arrCampos, $arrValores);
            $prep = retornarRegistroMysqliApi($dbx, 'mreg_prepagos', "identificacion='" . $ide . "'");
            $resultado["nombre"] = $prep["nombre"];
            $resultado["nombre1"] = $prep["nombre1"];
            $resultado["nombre2"] = $prep["nombre2"];
            $resultado["apellido1"] = $prep["apellido1"];
            $resultado["apellido2"] = $prep["apellido2"];
            $resultado["email"] = $prep["email"];
            $resultado["celular"] = $prep["celular"];
            $resultado["telefono"] = $prep["telefono"];
            $resultado["direccion"] = $prep["direccion"];
            $resultado["municipio"] = $prep["municipio"];
            $resultado["clave"] = $prep["clave"];
            $resultado["saldoprepago"] = '0';
            $preps = retornarRegistrosMysqliApi($dbx, 'mreg_prepagos_uso', "identificacion='" . $ide . "'", "fecha,hora");
            if ($preps && !empty($preps)) {
                $ik = 0;
                foreach ($preps as $p) {
                    if ($p["tipomov"] == 'C') {
                        $resultado["saldoprepago"] = $resultado["saldoprepago"] + $p["valor"];
                    } else {
                        $resultado["saldoprepago"] = $resultado["saldoprepago"] - $p["valor"];
                    }
                }
            }
            return $resultado;
        }

        if ($cri == 'D') { //Descuenta del prepgo
            $prep = retornarRegistroMysqliApi($dbx, 'mreg_prepagos', "identificacion='" . $ide . "'");
            if (!$prep || empty($prep)) {
                $resultado["codigoError"] = '0020';
                $resultado["msgError"] = 'NO EXISTE PREPAGO PARA LA IDENTIFICACION';
                return $resultado;
            }
            $resultado["nombre"] = $prep["nombre"];
            $resultado["nombre1"] = $prep["nombre1"];
            $resultado["nombre2"] = $prep["nombre2"];
            $resultado["apellido1"] = $prep["apellido1"];
            $resultado["apellido2"] = $prep["apellido2"];
            $resultado["email"] = $prep["email"];
            $resultado["celular"] = $prep["celular"];
            $resultado["telefono"] = $prep["telefono"];
            $resultado["direccion"] = $prep["direccion"];
            $resultado["municipio"] = $prep["municipio"];
            $resultado["clave"] = $prep["clave"];
            $resultado["saldoprepago"] = '0';
            $preps = retornarRegistrosMysqliApi($dbx, 'mreg_prepagos_uso', "identificacion='" . $ide . "'", "fecha,hora");
            if ($preps && !empty($preps)) {
                $ik = 0;
                foreach ($preps as $p) {
                    if ($p["tipomov"] == 'C') {
                        $resultado["saldoprepago"] = $resultado["saldoprepago"] + $p["valor"];
                    } else {
                        $resultado["saldoprepago"] = $resultado["saldoprepago"] - $p["valor"];
                    }
                }
            }
            if ($resultado["saldoprepago"] < $valor) {
                $resultado["codigoError"] = '0021';
                $resultado["msgError"] = 'NO EXISTE SALDO SUFICIENTE';
                return $resultado;
            }

            $arrCampos = array(
                'identificacion',
                'fecha',
                'hora',
                'ip',
                'operador',
                'usuario',
                'tipomov',
                'servicio',
                'concepto',
                'expediente',
                'recibo',
                'cantidad',
                'valor'
            );
            $arrValores = array(
                "'" . $ide . "'",
                "'" . date("Ymd") . "'",
                "'" . date("His") . "'",
                "'" . $ip . "'",
                "''", // Operador
                "'" . $usuario . "'",
                "'D",
                "'" . $servicio . "'",
                "'" . $detalle . "'",
                "'" . $expediente . "'",
                "'" . $recibo . "'",
                $cantidad,
                $valor
            );
            insertarRegistrosMysqliApi($dbx, 'mreg_prepagos_uso', $arrCampos, $arrValores);
            $prep = retornarRegistroMysqliApi($dbx, 'mreg_prepagos', "identificacion='" . $ide . "'");
            $resultado["nombre"] = $prep["nombre"];
            $resultado["nombre1"] = $prep["nombre1"];
            $resultado["nombre2"] = $prep["nombre2"];
            $resultado["apellido1"] = $prep["apellido1"];
            $resultado["apellido2"] = $prep["apellido2"];
            $resultado["email"] = $prep["email"];
            $resultado["celular"] = $prep["celular"];
            $resultado["telefono"] = $prep["telefono"];
            $resultado["direccion"] = $prep["direccion"];
            $resultado["municipio"] = $prep["municipio"];
            $resultado["clave"] = $prep["clave"];
            $resultado["saldoprepago"] = '0';
            $preps = retornarRegistrosMysqliApi($dbx, 'mreg_prepagos_uso', "identificacion='" . $ide . "'", "fecha,hora");
            if ($preps && !empty($preps)) {
                $ik = 0;
                foreach ($preps as $p) {
                    if ($p["tipomov"] == 'C') {
                        $resultado["saldoprepago"] = $resultado["saldoprepago"] + $p["valor"];
                    } else {
                        $resultado["saldoprepago"] = $resultado["saldoprepago"] - $p["valor"];
                    }
                }
            }
            return $resultado;
        }

        if ($cri == 'X') { // Resta del cupo de afiliado
            $expediente = ltrim($expediente, "0");

            $afil = retornarRegistroMysqliApi($dbx, 'mreg_est_inscritos', "matricula='" . $expediente . "'");
            if ($afil === false || empty($afil)) {
                $resultado["codigoError"] = '0020';
                $resultado["msgError"] = 'NO EXISTE AFILIADO PARA DESCONTAR';
                return $resultado;
            }
            if ($afil["ctrafiliacion"] != '1') {
                $resultado["codigoError"] = '0020';
                $resultado["msgError"] = 'NO EXISTE AFILIADO PARA DESCONTAR';
                return $resultado;
            }
            if ($afil["saldoaflia"] < $valor) {
                $resultado["codigoError"] = '0021';
                $resultado["msgError"] = 'NO EXISTE SALDO SUFICIENTE COMO AFILIADO';
                return $resultado;
            }
            $afil["saldoaflia"] = $afil["saldoaflia"] - $valor;
            $arrCampos = array(
                'saldoaflia'
            );
            $arrValores = array(
                $afil["saldoaflia"]
            );
            unset($_SESSION["expedienteactual"]);
            regrabarRegistrosMysqliApi($dbx, 'mreg_est_inscritos', $arrCampos, $arrValores, "matricula='" . $expediente . "'");

            $resultado["nombre"] = $afil["razonsocial"];
            $resultado["nombre1"] = $afil["nombre1"];
            $resultado["nombre2"] = $afil["nombre2"];
            $resultado["apellido1"] = $afil["apellido1"];
            $resultado["apellido2"] = $afil["apellido2"];
            $resultado["email"] = $afil["emailcom"];
            $resultado["telefono"] = $afil["telcom1"];
            $resultado["celular"] = '';
            $resultado["direccion"] = $prep["dircom"];
            $resultado["municipio"] = $prep["muncom"];
            $resultado["clave"] = '';
            $resultado["saldoprepago"] = '0';
            $resultado["saldoafiliado"] = $afil["saldoaflia"];
            return $resultado;
        }
    }

    public static function adicionarActoEstudioAsentarRecibo($dbx, $ind, $tra, $trans) {
        $arrCampos = array(
            'idradicacion',
            'idliquidacion',
            'idsecuenciatransaccion',
            'idtransaccion',
            'orden',
            'matricula',
            'proponente',
            'idclase',
            'numid',
            'nombre',
            'idclaseacreedor',
            'numidacreedor',
            'nombreacreedor',
            'tipodoc',
            'numdoc',
            'fechadoc',
            'fechavenci',
            'mundoc',
            'txtorigendoc',
            'dirubi',
            'munubi',
            'valor',
            'descripcion',
            'libro',
            'acto',
            'noticia',
            'librocruce',
            'inscripcioncruce',
            'nuevaorganizacion',
            'nuevacategoria',
            'nuevonombre',
            'nuevafechaduracion',
            'camaraanterior',
            'matriculaanterior',
            'fechamatriculaanterior',
            'fecharenovacionanterior',
            'ultimoanorenovadoanterior',
            'municipioanterior',
            'benart7anterior',
            'personal',
            'acttot',
            'pastot',
            'pattot',
            'actvin',
            'clase_libro',
            'tipo_libro',
            'codigo_libro',
            'nombre_libro',
            'email_libro',
            'emailconfirmacion_libro',
            'paginainicial_libro',
            'paginafinal_libro',
            'libeleanot_libro',
            'libeleanot_registro',
            'libeleanot_dupli',
            'libeleanot_nroacta',
            'libeleanot_fechaacta',
            'libeleanot_nropaginas',
            'libeleanot_fechainiinscripciones',
            'libeleanot_fechafininscripciones',
            'libeleanot_nroregistros',
            'actanro_libro',
            'fechaacta_libro',
            'numlibro',
            'numreg',
            'dupli',
            'fechareg',
            'horareg',
            'usuario'
        );

        //
        switch ($ind) {
            case 1 : $lib = substr($trans["idacto1"], 0, 4);
                $act = $trans["idacto1"];
                break;
            case 2 : $lib = substr($trans["idacto2"], 0, 4);
                $act = $trans["idacto2"];
                break;
            case 3 : $lib = substr($trans["idacto3"], 0, 4);
                $act = $trans["idacto3"];
                break;
            case 4 : $lib = substr($trans["idacto4"], 0, 4);
                $act = $trans["idacto4"];
                break;
            case 5 : $lib = substr($trans["idacto5"], 0, 4);
                $act = $trans["idacto5"];
                break;
        }


        //
        if (ltrim($tra["cantidad"], "0") == '') {
            $tra["cantidad"] = 1;
        }

        //
        for ($i = 1; $i <= $tra["cantidad"]; $i++) {

            if (ltrim($tra["paginainicial_libro"], "0") == '') {
                $tra["paginainicial_libro"] = 0;
            }
            if (ltrim($tra["paginafinal_libro"], "0") == '') {
                $tra["paginafinal_libro"] = 0;
            }

            // En caso que sea un trámite de libros de comercio
            if ($tra["clase_libro"] == 'F') {
                $tra["noticia"] = "REGISTRO DEL LIBRO " . $tra["nombre_libro"] .
                        " DE LA PAGINA NO. " . $tra["paginainicial_libro"] .
                        " A LA " . $tra["paginafinal_libro"] . " (TOTAL " .
                        intval($tra["paginafinal_libro"] - $tra["paginainicial_libro"] + 1) . " FOLIOS)";
            }

            // En caso que la noticia mercantil esté vacía
            // Embargos
            // Desembargos        
            if (trim($tra["noticia"]) == '') {
                if (trim($tra["embargo"]) != '') {
                    $tra["noticia"] .= trim($tra["embargo"]);
                }
                if (trim($tra["desembargo"]) != '') {
                    if (trim($tra["noticia"]) != '') {
                        $tra["noticia"] .= chr(13) . chr(10);
                    }
                    $tra["noticia"] .= trim($tra["desembargo"]);
                }
                if (trim($tra["texto"]) != '') {
                    if (trim($tra["noticia"]) != '') {
                        $tra["noticia"] .= chr(13) . chr(10);
                    }
                    $tra["noticia"] .= trim($tra["texto"]);
                }
            }

            //
            if (trim($tra["noticia"]) == '') {
                $tra["noticia"] = retornarRegistroMysqliApi($dbx, 'mreg_actos', "idlibro='" . $lib . "' and idacto='" . substr($act, 5, 4) . "'", "nombre");
            }

            // *************************************************************** //
            // Asigna ls variables del expediente al acto a registrar
            // Por defecto asume los asociados con la matrícula afectada
            // *************************************************************** //
            $matx = $tra["matriculaafectada"];
            $tipoidex = $tra["tipoidentificacion"];
            $idex = $tra["identificacion"];
            $nomx = $tra["razonsocial"];
            $norgx = $tra["organizacion"];
            $ncatx = $tra["categoria"];
            $nnomx = $tra["razonsocial"];
            $perx = $tra["personal"];
            $actix = $tra["activos"];

            // En caso de contratos de compraventa
            if ($trans["idtipotransaccion"] == '022') {
                $actx = retornarRegistroMysqliApi($dbx, 'mreg_actos', "idlibro='" . $lib . "' and idacto='" . substr($act, 5, 4) . "'");
                if ($actx["idgrupoacto"] == '002') { // Si se trata de una cancelacion mueve el vendedor
                    $matx = $tra["matriculavendedor"];
                    $tipoidex = $tra["tipoidentificacionvendedor"];
                    $idex = $tra["identificacionvendedor"];
                    $nomx = $tra["nombrevendedor"];
                    $norgx = '';
                    $ncatx = '';
                    $nnomx = '';
                    $perx = 0;
                    $actix = 0;
                    if ($nomx == '') {
                        $nomx = trim($tra["apellido1vendedor"] . ' ' . $tra["apellido2vendedor"] . ' ' . $tra["nombre1vendedor"] . ' ' . $tra["nombre2vendedor"]);
                    }
                }
                if ($actx["idgrupoacto"] == '001' || $actx["idgrupoacto"] == '024') { // Si se trata de la matrícula mueve el comprador
                    $matx = $tra["matriculacomprador"];
                    $tipoidex = $tra["tipoidentificacioncomprador"];
                    $idex = $tra["identificacioncomprador"];
                    $nomx = $tra["nombrecomprador"];
                    $norgx = $tra["organizacioncomprador"];
                    $ncatx = $tra["categoriacomprador"];
                    $perx = $tra["personalcomprador"];
                    $actix = $tra["activoscomprador"];
                    if ($nomx == '') {
                        $nomx = trim($tra["apellido1comprador"] . ' ' . $tra["apellido2comprador"] . ' ' . $tra["nombre1comprador"] . ' ' . $tra["nombre2comprador"]);
                    }
                    $nnomx = $nomx;
                }
            }

            //
            $_SESSION["generales"]["icontrol"] ++;
            $arrValores = array(
                "'" . ltrim($_SESSION["tramite"]["numeroradicacion"], "0") . "'",
                $tra["idliquidacion"],
                $tra["idsecuencia"],
                "'" . $tra["idtransaccion"] . "'",
                "'" . sprintf("%02s", $_SESSION["generales"]["icontrol"]) . "'",
                "'" . $matx . "'",
                "''", // proponente
                "'" . $tipoidex . "'", // Id clase
                "'" . $idex . "'", // Num id
                "'" . addslashes($nomx) . "'", // Nombre
                "''", // Tipo Id acreedor
                "''", // Num Id clase acreedor
                "''", // Nombre acreedor
                "'" . $tra["tipodoc"] . "'",
                "'" . $tra["numdoc"] . "'",
                "'" . $tra["fechadoc"] . "'",
                "''", // Fecha vencimiento
                "'" . $tra["mundoc"] . "'",
                "'" . $tra["origendoc"] . "'",
                "''", // Direccion ubicacion
                "''", // Municipio ubicacion
                0, // Valor
                "''", // Descripcion
                "'" . $lib . "'",
                "'" . $act . "'",
                "'" . addslashes($tra["noticia"]) . "'",
                "''", // Libro cruce
                "''", //Inscripcion cruce
                "'" . $norgx . "'", // Nueva organizacion
                "'" . $ncatx . "'", // Nueva categoria
                "'" . $nnomx . "'", // Nombre
                "'" . $tra["fechaduracion"] . "'", // Nueva fecha de duracion
                "'" . $tra["camaraanterior"] . "'",
                "'" . $tra["matriculaanterior"] . "'",
                "'" . $tra["fechamatriculaanterior"] . "'",
                "'" . $tra["fecharenovacionanterior"] . "'",
                "'" . $tra["ultimoanorevadoanterior"] . "'",
                "'" . $tra["municipioanterior"] . "'",
                "'" . $tra["benart7anterior"] . "'",
                doubleval($perx), // personal
                doubleval($actix), // acttot
                0, // pasttot
                doubleval($tra["patrimonio"]), // pattot
                doubleval($tra["activos"]), // actvin
                "'" . $tra["clase_libro"] . "'", // Clase de libro (F, E, A)
                "'" . $tra["tipo_libro"] . "'", // tipo de libro
                "'" . $tra["codigo_libro"] . "'", // Código del libro
                "'" . $tra["nombre_libro"] . "'", // Nombre del libro
                "'" . $tra["email_libro"] . "'", // Email del libro
                "'" . $tra["emailconfirmacion_libro"] . "'", // Emailconfirmacion del libro
                "'" . $tra["paginainicial_libro"] . "'", // Pagina inicial
                "'" . $tra["paginafinal_libro"] . "'", // Pagina final
                "'" . $tra["libeleanot_libro"] . "'", // Pagina final
                "'" . $tra["libeleanot_registro"] . "'", // Pagina final
                "'" . $tra["libeleanot_dupli"] . "'", // Pagina final
                "'" . $tra["libeleanot_nroacta"] . "'", // Pagina final
                "'" . $tra["libeleanot_fechaacta"] . "'", // Pagina final
                intval($tra["libeleanot_nropaginas"]), // Pagina final
                "'" . $tra["libeleanot_fechainiinscripciones"] . "'", // Pagina final
                "'" . $tra["libeleanot_fechafininscripciones"] . "'", // Pagina final
                intval($tra["libeleanot_nroregistros"]), // Pagina final
                "'" . $tra["actanro_libro"] . "'", // Acta Nro Libro
                "'" . $tra["fechaacta_libro"] . "'", // Fecha del Acta del Libro
                "''", // Libro
                "''", // Registro
                "''", // Dupli
                "''", // Fecha registro
                "''", // Hora registro
                "''" // Usuario
            );
            $res = insertarRegistrosMysqliApi($dbx, 'mreg_estudio_actos_registro', $arrCampos, $arrValores);
            if ($res === false) {
                $nameLog = 'adicionarActoEstudioAsentarReciboSii_' . date("Ymd");
                \logApi::general2($nameLog, '', utf8_encode('Error creando mreg_estudio_actos_registro : ' . $_SESSION["generales"]["mensajeerror"]));
            }
        }
    }

    public static function adicionarInscripcionCancelacion($dbx, $tramae, $tradat, $tiptra, $numacto) {

        $xActo = '';
        switch ($numacto) {
            case 1 : $xActo = $tramae["idacto1"];
                break;
            case 2 : $xActo = $tramae["idacto2"];
                break;
            case 3 : $xActo = $tramae["idacto3"];
                break;
            case 4 : $xActo = $tramae["idacto4"];
                break;
            case 5 : $xActo = $tramae["idacto5"];
                break;
        }

        $res = array();
        $res ["tiporegistro"] = $tiptra["tiporegistro"];
        $res ["tiposello"] = '90.20.31';
        $res ["libro"] = substr($xActo, 0, 4);
        $res ["numreg"] = '';
        $res ["organizacion"] = $tradat["organizacion"];
        $res ["filesello"] = '';
        $res ["noticia"] = 'CANCELACION MATRICULA MERCANTIL';
        if ($tradat["organizacion"] == '02') {
            $res ["noticia"] = 'CANCELACION MATRICULA MERCANTIL DE ESTABLECIMIENTO DE COMERCIO';
        }
        if (substr($xActo, 5, 4) == '0532') {
            $res ["noticia"] = 'CANCELACION MATRICULA MERCANTIL POR CAMBIO DE DOMICILIO';
            if ($tradat["municipiodestino"] != '') {
                $res["noticia"] .= ' A LA CIUDAD DE ' . retornarRegistroMysqliApi($dbx, 'bas_municipios', "codigomunicipio='" . $tradat["municipiodestino"] . "'", "ciudad");
            }
        }
        $res ["matricula"] = $tradat["matriculaafectada"];
        $res ["proponente"] = '';
        $res ["tipodoc"] = $tradat["tipodoc"];
        $res ["numdoc"] = $tradat["numdoc"];
        $res ["origendoc"] = $tradat["origendoc"];
        $res ["fechadoc"] = $tradat["fechadoc"];
        $res ["municipio"] = $tradat["mundoc"];
        $res ["acto"] = substr($xActo, 5, 4);
        $res ["fecha"] = date("Ymd");
        $res ["hora"] = date("His");
        $res ["tipoidentificacion"] = $tradat["tipoidentificacion"];
        $res ["identificacion"] = $tradat["identificacion"];
        $res ["nombre"] = $tradat["razonsocial"];
        $res ["ope"] = $_SESSION["generales"]["idcodigosirepcaja"]; // 12016-01-12 : JINT : Asigna el registro añ cajero que hce el trámite
        $res ["bandeja"] = $tiptra["bandeja"];

        return $res;
    }

    public static function armarDataBasicaMercantil() {
        $arreglo = array();
        $arreglo[] = array('Nombre o razón social', $_SESSION["expediente"]["nombre"]);
        if (trim($_SESSION["expediente"]["nom1"]) != '')
            $arreglo[] = array('Primer nombre', $_SESSION["expediente"]["nom1"]);
        if (trim($_SESSION["expediente"]["nom2"]) != '')
            $arreglo[] = array('Segundo nombre', $_SESSION["expediente"]["nom2"]);
        if (trim($_SESSION["expediente"]["ape1"]) != '')
            $arreglo[] = array('Primer apellido', $_SESSION["expediente"]["ape1"]);
        if (trim($_SESSION["expediente"]["ape2"]) != '')
            $arreglo[] = array('Segundo apellido', $_SESSION["expediente"]["ape2"]);
        if (trim($_SESSION["expediente"]["sigla"]) != '')
            $arreglo[] = array('Sigla', $_SESSION["expediente"]["sigla"]);
        if (trim($_SESSION["expediente"]["identificacion"]) != '')
            $arreglo[] = array('Identificación', $_SESSION["expediente"]["tipoidentificacion"] . ' - ' . $_SESSION["expediente"]["identificacion"]);
        if (trim($_SESSION["expediente"]["fecexpdoc"]) != '')
            $arreglo[] = array('Fecha de expedición', $_SESSION["expediente"]["fecexpdoc"]);
        if (trim($_SESSION["expediente"]["idmunidoc"]) != '')
            $arreglo[] = array('Municipio de expedición', $_SESSION["expediente"]["idmunidoc"]);
        if (trim($_SESSION["expediente"]["paisexpdoc"]) != '')
            $arreglo[] = array('País de expedición', $_SESSION["expediente"]["paisexpdoc"]);
        if (trim($_SESSION["expediente"]["nacionalidad"]) != '')
            $arreglo[] = array('Nacionalidad', $_SESSION["expediente"]["nacionalidad"]);
        if (trim($_SESSION["expediente"]["prerut"]) != '')
            $arreglo[] = array('Pre-Rut', $_SESSION["expediente"]["prerut"]);
        if (trim($_SESSION["expediente"]["nit"]) != '')
            $arreglo[] = array('Nit', $_SESSION["expediente"]["nit"]);
        if (trim($_SESSION["expediente"]["admondian"]) != '')
            $arreglo[] = array('Administración', $_SESSION["expediente"]["admondian"]);
        if (trim($_SESSION["expediente"]["idetripaiori"]) != '')
            $arreglo[] = array('Ident. Trib en el exterior', $_SESSION["expediente"]["idetripaiori"]);
        if (trim($_SESSION["expediente"]["paiori"]) != '')
            $arreglo[] = array('Pais Ident. Trib.', $_SESSION["expediente"]["paiori"]);
        if (trim($_SESSION["expediente"]["idetriextep"]) != '')
            $arreglo[] = array('Ident. Trib Per. Jurídica', $_SESSION["expediente"]["idetriextep"]);
        $t1 = '';
        switch ($_SESSION["expediente"]["afiliado"]) {
            case "1" : $t1 = 'Afiliado activo';
                break;
            case "2" : $t1 = 'Ex afiliado';
                break;
            case "3" : $t1 = 'Aceptado/Pendiente de pago';
                break;
            case "5" : $t1 = 'Desafiliado temporalmente';
                break;
            case "9" : $t1 = 'Potencial afiliado';
                break;
        }
        if ($t1 != '')
            $arreglo[] = array('Afiliación?', $t1);
        $arreglo[] = array('Estado de la matrícula', $_SESSION["expediente"]["estadomatricula"] . ' - ' . retornarRegistroMysqliApi(null, 'mreg_estadomatriculas', "id='" . $_SESSION["expediente"]["estadomatricula"] . "'", "descripcion"));
        if (trim($_SESSION["expediente"]["organizacion"]) != '')
            $arreglo[] = array('Organización jurídica', retornarRegistroMysqliApi(null, 'bas_organizacionjuridica', "id='" . $_SESSION["expediente"]["organizacion"] . "'", "descripcion"));
        if (ltrim(trim($_SESSION["expediente"]["categoria"]), "0") != '')
            $arreglo[] = array('Categoría', retornarRegistroMysqliApi(null, 'bas_categorias', "id='" . $_SESSION["expediente"]["categoria"] . "'", "descripcion"));
        if ($_SESSION["expediente"]["organizacion"] == '01' || ($_SESSION["expediente"]["organizacion"] > '02' && $_SESSION["expediente"]["organizacion"] != '12' && $_SESSION["expediente"]["organizacion"] != '14' && $_SESSION["expediente"]["categoria"] == '1')) {
            if (trim($_SESSION["expediente"]["naturaleza"]) != '')
                $arreglo[] = array('Naturaleza', retornarRegistroMysqliApi(null, 'bas_naturalezas', "id='" . $_SESSION["expediente"]["naturaleza"] . "'", "descripcion"));
        }
        $arreglo[] = array('Estado de los datos', $_SESSION["expediente"]["estadodatosmatricula"]);
        $arreglo[] = array('Fecha matrícula', \funcionesGenerales::mostrarFecha($_SESSION["expediente"]["fechamatricula"]));
        $arreglo[] = array('Fecha renovación', \funcionesGenerales::mostrarFecha($_SESSION["expediente"]["fecharenovacion"]));
        $arreglo[] = array('Último año renovado', $_SESSION["expediente"]["ultanoren"]);
        if (trim($_SESSION["expediente"]["fechadisolucion"]) != '')
            $arreglo[] = array('Fecha disolución', \funcionesGenerales::mostrarFecha($_SESSION["expediente"]["fecharenovacion"]));
        if (trim($_SESSION["expediente"]["fechaliquidacion"]) != '')
            $arreglo[] = array('Fecha liquidación', \funcionesGenerales::mostrarFecha($_SESSION["expediente"]["fechaliquidacion"]));
        if (trim($_SESSION["expediente"]["estadotipoliquidacion"]) != '')
            $arreglo[] = array('Tipo liquidación', retornarRegistroMysqliApi(null, 'mreg_tipos_liquidacion', "id='" . $_SESSION["expediente"]["estadotipoliquidacion"] . "'", "descripcion"));
        if (trim($_SESSION["expediente"]["fechacancelacion"]) != '')
            $arreglo[] = array('Fecha cancelación', \funcionesGenerales::mostrarFecha($_SESSION["expediente"]["fechacancelacion"]));
        if (trim($_SESSION["expediente"]["motivocancelacion"]) != '')
            $arreglo[] = array('Motivo cancelación', $_SESSION["expediente"]["motivocancelacion"]);
        if (trim($_SESSION["expediente"]["fecperj"]) != '')
            $arreglo[] = array('Fecha personería', \funcionesGenerales::mostrarFecha($_SESSION["expediente"]["fecperj"]));
        if (trim($_SESSION["expediente"]["numperj"]) != '')
            $arreglo[] = array('Número de personería', $_SESSION["expediente"]["numperj"]);
        if (trim($_SESSION["expediente"]["idorigenperj"]) != '')
            $arreglo[] = array('Otorgó personería', $_SESSION["expediente"]["idorigenperj"]);
        if (trim($_SESSION["expediente"]["fechaconstitucion"]) != '')
            $arreglo[] = array('Fecha constitución', \funcionesGenerales::mostrarFecha($_SESSION["expediente"]["fechaconstitucion"]));
        if (trim($_SESSION["expediente"]["origendocconst"]) != '')
            $arreglo[] = array('Origen', $_SESSION["expediente"]["origendocconst"]);
        if (trim($_SESSION["expediente"]["fechavencimiento"]) != '' && $_SESSION["expediente"]["fechavencimiento"] != '99999999')
            $arreglo[] = array('Fecha vencimiento', \funcionesGenerales::mostrarFecha($_SESSION["expediente"]["fechavencimiento"]));
        if (trim($_SESSION["expediente"]["fechavencimiento"]) != '' && $_SESSION["expediente"]["fechavencimiento"] == '99999999')
            $arreglo[] = array('Fecha vencimiento', 'Indefinida');

        $t1 = '';
        switch ($_SESSION["expediente"]["impexp"]) {
            case "1":$t1 = 'Importador';
                break;
            case "2":$t1 = 'Exportador';
                break;
            case "3":$t1 = 'Importador y Exportador';
                break;
        }
        if ($t1 != '')
            $arreglo[] = array('Importa o exporta?', $t1);
        $t1 = '';
        switch ($_SESSION["expediente"]["codaduaneros"]) {
            case "1" : $t1 = 'Usuario aduanero';
                break;
            case "S" : $t1 = 'Usuario aduanero';
                break;
        }
        if ($t1 != '')
            $arreglo[] = array('Control aduanero', $t1);
        $t1 = '';
        switch ($_SESSION["expediente"]["tipolocal"]) {
            case "1" : $t1 = 'Local propio';
                break;
            case "2" : $t1 = 'Local arrendado';
                break;
        }
        if ($t1 != '')
            $arreglo[] = array('El local es?', $t1);
        $t1 = '';
        switch ($_SESSION["expediente"]["tipopropiedad"]) {
            case "1" : $t1 = 'Propietario único';
                break;
            case "2" : $t1 = 'Sociedad de hecho';
                break;
            case "3" : $t1 = 'Coopropiedad';
                break;
        }
        if ($t1 != '')
            $arreglo[] = array('Tipo de propiedad', $t1);
        $t1 = '';
        switch ($_SESSION["expediente"]["empresafamiliar"]) {
            case "1" : $t1 = 'Es empresa familiar';
                break;
            case "S" : $t1 = 'Es empresa familiar';
                break;
        }
        if ($t1 != '')
            $arreglo[] = array('Empresa familiar', $t1);
        $t1 = '';
        switch ($_SESSION["expediente"]["procesosinnovacion"]) {
            case "1" : $t1 = 'Si tiene';
                break;
            case "S" : $t1 = 'Si tiene';
                break;
        }
        if ($t1 != '')
            $arreglo[] = array('Procesos de innovación?', $t1);
        if ($_SESSION["expediente"]["vigcontrol"] != '')
            $arreglo[] = array('Entidad de vigilancia', $_SESSION["expediente"]["vigcontrol"]);

        return $arreglo;
    }

    /**
     * 
     * @param type $dbx
     * @param type $mat
     * @param type $idclase
     * @param type $numid
     * @param type $namex
     * @param type $tipodata
     * @param type $tipoconsulta
     * @return boolean|int
     */
    public static function retornarExpedienteMercantil($dbx = null, $mat = '', $idclase = '', $numid = '', $namex = '', $tipodata = '', $tipoconsulta = 'T') {
        require_once ($_SESSION["generales"]["pathabsoluto"] . '/api/log.php');
        require_once ($_SESSION["generales"]["pathabsoluto"] . '/api/funcionesGenerales.php');
        require_once ($_SESSION["generales"]["pathabsoluto"] . '/api/mysqli.php');
        require_once ($_SESSION["generales"]["pathabsoluto"] . '/api/myErrorHandler.php');

        set_error_handler('myErrorHandler');

        $nameLog = 'retornarExpedienteMercantil_' . $mat;

        // ********************************************************************************** //
        // Instancia la BD si no existe
        // ********************************************************************************** //
        if ($dbx === null) {
            $mysqli = new \mysqli(DB_HOST, DB_USUARIO, DB_PASSWORD, DB_NAME, DB_PORT);
            if (mysqli_connect_error()) {
                $_SESSION["generales"]["mensajerror"] = 'Error coenctando con la BD';
                return false;
            }
        } else {
            $mysqli = $dbx;
        }

        // ********************************************************************************** //
        // carga maestro de actos
        // ********************************************************************************** //
        $_SESSION["maestroactos"] = array();
        $temx = retornarRegistrosMysqliApi($mysqli, "mreg_actos", "1=1", "idlibro,idacto");
        foreach ($temx as $x) {
            $ind = $x["idlibro"] . '-' . $x["idacto"];
            $_SESSION["maestroactos"][$ind] = $x;
        }
        unset($temx);

        // ********************************************************************************** //
        // carga maestro de vínculos
        // ********************************************************************************** //
        $_SESSION["maestrovinculos"] = array();
        $temx = retornarRegistrosMysqliApi($mysqli, "mreg_codvinculos", "1=1", "id");
        foreach ($temx as $x) {
            $_SESSION["maestrovinculos"][$x["id"]] = $x;
        }
        unset($temx);

        // ********************************************************************************** //
        // carga maestro de clases de vínculos
        // ********************************************************************************** //
        $_SESSION["clasevinculo"] = array();
        $temx = retornarRegistrosMysqliApi($mysqli, "mreg_clasevinculos", "1=1", "id");
        foreach ($temx as $x) {
            $_SESSION["clasevinculo"][$x["id"]] = $x["descripcion"];
        }
        unset($temx);

        // ************************************************************************************** //
        // Si el sistema registro es SII
        // ************************************************************************************** //
        // Configuracion del QUERY Inicial
        $query = '';
        if ($mat != '') {
            $query = "matricula='" . ltrim($mat, "0") . "'";
        }
        if ($idclase != '') {
            $query = "idclase='" . $idclase . "' and ";
            $query .= "numid='" . trim($numid) . "'";
            if ($tipoconsulta == 'A') {
                $query .= " and ctrestmatricula IN ('MA','IA','MI','II')";
            }
            if ($tipoconsulta == 'C') {
                $query .= " and ctrestmatricula NOT IN ('MA','IA','MI','II')";
            }
        }
        if ($numid != '') {
            $query .= "numid='" . ltrim($numid, "0") . "'";
            if ($tipoconsulta == 'A') {
                $query .= " and ctrestmatricula IN ('MA','IA','MI','II')";
            }
            if ($tipoconsulta == 'C') {
                $query .= " and ctrestmatricula NOT IN ('MA','IA','MI','II')";
            }
        }

        if ($namex != '') {
            $query = "razonsocial='" . $namex . "'";
        }


        // Lectura del registro principal
        $reg = retornarRegistroMysqliApi($mysqli, 'mreg_est_inscritos', $query);
        if ($reg === false) {
            if ($dbx == null) {
                $mysqli->close();
            }
            $_SESSION["generales"]["mensajerror"] = '1.- Error leyendo la tabla mreg_est_inscritos';
            return false;
        }
        if (empty($reg)) {
            if ($dbx == null) {
                $mysqli->close();
            }
            $_SESSION["generales"]["mensajerror"] = '';
            return 0;
        }

        // Armado del arreglo de respuesta
        $retorno = array();
        $retorno["matricula"] = $reg["matricula"];
        $retorno["proponente"] = $reg["proponente"];
        $retorno["complementorazonsocial"] = '';
        if (isset($reg["complementorazonsocial"])) {
            $retorno["complementorazonsocial"] = stripslashes(\funcionesGenerales::restaurarEspeciales($reg["complementorazonsocial"]));
        }
        $retorno["nombre"] = str_replace("¥", "Ñ", stripslashes(\funcionesGenerales::restaurarEspeciales($reg["razonsocial"])));
        $retorno["nombre"] = \funcionesGenerales::borrarpalabrasAutomaticas($retorno["nombre"], $retorno["complementorazonsocial"]);
        $retorno["nombre"] = trim($retorno["nombre"]);
        $retorno["nuevonombre"] = '';
        $retorno["ape1"] = str_replace("¥", "Ñ", stripslashes(\funcionesGenerales::restaurarEspeciales($reg["apellido1"])));
        $retorno["ape2"] = str_replace("¥", "Ñ", stripslashes(\funcionesGenerales::restaurarEspeciales($reg["apellido2"])));
        $retorno["nom1"] = str_replace("¥", "Ñ", stripslashes(\funcionesGenerales::restaurarEspeciales($reg["nombre1"])));
        $retorno["nom2"] = str_replace("¥", "Ñ", stripslashes(\funcionesGenerales::restaurarEspeciales($reg["nombre2"])));
        $retorno["sigla"] = str_replace("¥", "Ñ", stripslashes(\funcionesGenerales::restaurarEspeciales($reg["sigla"])));
        $retorno["tipoidentificacion"] = $reg["idclase"];
        $retorno["identificacion"] = $reg["numid"];
        $retorno["sexo"] = $reg["sexo"];
        $retorno["idmunidoc"] = $reg["idmunidoc"];
        $retorno["fechanacimiento"] = $reg["fechanacimiento"];
        $retorno["fecexpdoc"] = $reg["fecexpdoc"];
        $retorno["paisexpdoc"] = $reg["paisexpdoc"];
        $retorno["nit"] = $reg["nit"];
        $retorno["estadonit"] = $reg["estadonit"];
        $retorno["admondian"] = $reg["admondian"];
        $retorno["prerut"] = $reg["prerut"];
        $retorno["nacionalidad"] = $reg["nacionalidad"];

        // 2017-05-31
        $retorno["idetripaiori"] = $reg["idetripaiori"]; // Nuevo campo circular 002
        $retorno["paiori"] = $reg["paiori"]; // Nuevo campo circular 002
        $retorno["idetriextep"] = $reg["idetriextep"]; // Nuevo campo circular 002


        $retorno["fechamatricula"] = trim($reg["fecmatricula"]);
        $retorno["fecharenovacion"] = trim($reg["fecrenovacion"]);
        $retorno["fechavencimiento"] = trim($reg["fecvigencia"]);
        $retorno["ultanoren"] = trim($reg["ultanoren"]);

        // Se encuentran al momento de armar la lista de inscripciones        
        $retorno["fechaconstitucion"] = $reg["fecconstitucion"];
        $retorno["fechadisolucion"] = $reg["fecdisolucion"];
        $retorno["fechacancelacion"] = $reg["feccancelacion"];
        $retorno["motivocancelacion"] = $reg["motivocancelacion"]; // Nuevo campo circular 002   
        $retorno["fechaliquidacion"] = $reg["fecliquidacion"];
        $retorno["disueltaporvencimiento"] = '';
        $retorno["disueltaporacto510"] = '';
        $retorno["fechaacto510"] = '';
        $retorno["perdidacalidadcomerciante"] = '';
        $retorno["fechaperdidacalidadcomerciante"] = '';
        $retorno["estadotipoliquidacion"] = $reg["estadotipoliquidacion"]; // Nuevo campo circular 002 
        $retorno["empresafamiliar"] = $reg["empresafamiliar"]; // Nuevo campo circular 002 
        $retorno["procesosinnovacion"] = $reg["procesosinnovacion"]; // Nuevo campo circular 002 
        // 
        if (trim($retorno["fechavencimiento"]) != '' &&
                $retorno["fechavencimiento"] != '99999999' && $retorno["fechavencimiento"] != '99999998'
        ) {
            if ($retorno["fechavencimiento"] < date("Ymd")) {
                $retorno["disueltaporvencimiento"] = 'si';
            }
        }

        //
        $retorno["certificardesde"] = $reg["ctrcertificardesde"];
        $retorno["estadomatricula"] = $reg["ctrestmatricula"];
        $retorno["estadoactiva"] = $reg["ctrestadoactiva"];
        $retorno["estadopreoperativa"] = $reg["ctrestadopreoperativa"];
        $retorno["estadoconcordato"] = $reg["ctrconcordato"];
        $retorno["estadointervenida"] = $reg["ctrestadointervenida"];
        $retorno["estadodisuelta"] = $reg["ctrestadodisuelta"];
        $retorno["estadoreestructuracion"] = $reg["ctrestadoenreestructuracion"];
        $retorno["estadodatosmatricula"] = $reg["ctrestdatos"];
        $retorno["estadoproponente"] = trim($reg["ctrestproponente"]);
        $retorno["estadocapturado"] = trim($reg["ctrestadocapturado"]);
        $retorno["estadocapturadootros"] = trim($reg["ctrestadocapturadootros"]);
        $retorno["cantest"] = intval($reg["cantest"]);

        //
        if (!isset($reg["pendiente_ajuste_nuevo_formato"])) {
            $reg["pendiente_ajuste_nuevo_formato"] = '';
        }
        if (!isset($reg["fecha_pendiente_ajuste_nuevo_formato"])) {
            $reg["fecha_pendiente_ajuste_nuevo_formato"] = '';
        }

        //
        $retorno["codigosbarras"] = 0; // Se arma al encontrar la lista de códigos de barras
        $retorno["pendiente_ajuste_nuevo_formato"] = $reg["pendiente_ajuste_nuevo_formato"];
        $retorno["fecha_pendiente_ajuste_nuevo_formato"] = $reg["fecha_pendiente_ajuste_nuevo_formato"];

        $retorno["embargos"] = ''; // Se arma al encontrar la lista de embargos
        $retorno["embargostramite"] = ''; // Se arma al encontrar la lista de embargos
        $retorno["recursostramite"] = ''; // Sea arma al encontrar la lista de códigos de barras
        $retorno["tamanoempresa"] = $reg["tamanoempresa"];
        $retorno["emprendedor28"] = $reg["emprendedor28"];
        $retorno["pemprendedor28"] = doubleval($reg["pemprendedor28"]);
        $retorno["organizacion"] = $reg["organizacion"];
        $retorno["organizaciontexto"] = retornarRegistroMysqliApi($mysqli, 'bas_organizacionjuridica', "id='" . $reg["organizacion"] . "'", "descripcion");
        $retorno["categoria"] = $reg["categoria"];
        $retorno["categoriatexto"] = retornarRegistroMysqliApi($mysqli, 'bas_categorias', "id='" . $reg["categoria"] . "'", "descripcion");
        $retorno["naturaleza"] = $reg["naturaleza"];
        if ($reg["naturaleza"] == '') {
            $retorno["naturaleza"] = '0';
        }
        $retorno["imppredil"] = '';
        $retorno["impexp"] = $reg["ctrimpexp"];
        $retorno["tipopropiedad"] = $reg["ctrtipopropiedad"];
        $retorno["tipolocal"] = $reg["ctrtipolocal"];
        $retorno["tipogruemp"] = $reg["tipogruemp"]; // Nuevo campo circular 002  
        $retorno["nombregruemp"] = $reg["nombregruemp"]; // Nuevo campo circular 002 
        //
        $retorno["vigcontrol"] = $reg["vigcontrol"];
        $retorno["fecperj"] = $reg["fecperj"];
        $retorno["idorigenperj"] = $reg["otorgaperj"];
        $retorno["origendocconst"] = $reg["origendocconst"];
        $retorno["numperj"] = $reg["numperj"];
        $retorno["patrimonio"] = $reg["patrimonio"];
        $retorno["vigifecini"] = $reg["vigifecini"];
        $retorno["vigifecfin"] = $reg["vigifecfin"];
        $retorno["clasegenesadl"] = $reg["ctrclasegenesadl"];
        $retorno["claseespesadl"] = $reg["ctrclaseespeesadl"];
        $retorno["claseeconsoli"] = $reg["ctrclaseeconsoli"];
        $retorno["econmixta"] = $reg["ctreconmixta"];

        $retorno["ctrderpub"] = $reg["ctrderpub"]; // Nuevo campo circular 002
        $retorno["ctrcodcoop"] = $reg["ctrcodcoop"]; // Nuevo campo circular 002
        $retorno["ctrcodotras"] = $reg["ctrcodotras"]; // Nuevo campo circular 002

        $retorno["ctresacntasociados"] = $reg["ctresacntasociados"]; // Nuevo campo circular 002  
        $retorno["ctresacntmujeres"] = $reg["ctresacntmujeres"]; // Nuevo campo circular 002  
        $retorno["ctresacnthombres"] = $reg["ctresacnthombres"]; // Nuevo campo circular 002  
        $retorno["ctresapertgremio"] = $reg["ctresapertgremio"]; // Nuevo campo circular 002  
        $retorno["ctresagremio"] = $reg["ctresagremio"]; // Nuevo campo circular 002  
        $retorno["ctresaacredita"] = $reg["ctresaacredita"]; // Nuevo campo circular 002  
        $retorno["ctresaivc"] = $reg["ctresaivc"]; // Nuevo campo circular 002
        $retorno["ctresainfoivc"] = $reg["ctresainfoivc"]; // Nuevo campo circular 002
        $retorno["ctresaautregistro"] = $reg["ctresaautregistro"]; // Nuevo campo circular 002  
        $retorno["ctresaentautoriza"] = $reg["ctresaentautoriza"];  // Nuevo campo circular 002  
        $retorno["ctresacodnat"] = $reg["ctresacodnat"]; // Nuevo campo circular 002     1.- Asoc, 2.- Corporacion, 3.- Fundación
        $retorno["ctresadiscap"] = $reg["ctresadiscap"]; // Nuevo campo circular 002     
        $retorno["ctresaetnia"] = $reg["ctresaetnia"]; // Nuevo campo circular 002     
        $retorno["ctresacualetnia"] = $reg["ctresacualetnia"];  // Nuevo campo circular 002     
        $retorno["ctresadespvictreins"] = $reg["ctresadespvictreins"];  // Nuevo campo circular 002     
        $retorno["ctresacualdespvictreins"] = $reg["ctresacualdespvictreins"]; // Nuevo campo circular 002     
        $retorno["ctresaindgest"] = $reg["ctresaindgest"];  // Nuevo campo circular 002            
        $retorno["ctresalgbti"] = $reg["ctresalgbti"]; // Nuevo campo circular 002            
        //
        $retorno["afiliado"] = $reg["ctrafiliacion"];
        $retorno["fechaafiliacion"] = $reg["fecaflia"];
        $retorno["ultanorenafi"] = $reg["anorenaflia"];
        $retorno["fechaultpagoafi"] = $reg["fecrenaflia"];
        $retorno["valorultpagoafi"] = $reg["valpagaflia"];
        $retorno["saldoafiliado"] = $reg["saldoaflia"];
        $retorno["telaflia"] = $reg["telaflia"];
        $retorno["diraflia"] = $reg["diraflia"];
        $retorno["munaflia"] = $reg["munaflia"];
        $retorno["profaflia"] = $reg["profaflia"];
        $retorno["contaflia"] = $reg["contaflia"];
        $retorno["dircontaflia"] = $reg["dircontaflia"];
        $retorno["muncontaflia"] = $reg["muncontaflia"];
        $retorno["numactaaflia"] = $reg["numactaaflia"];
        $retorno["fecactaaflia"] = $reg["fecactaaflia"];
        $retorno["numactaafliacan"] = $reg["numactacanaflia"];
        $retorno["fecactaafliacan"] = $reg["fecactacanaflia"];

        // informacion de ubicacion comercial en el registro mercantil
        $retorno["lggr"] = $reg["lggr"];
        $retorno["nombrecomercial"] = $reg["nombrecomercial"];
        $retorno["dircom"] = $reg["dircom"];
        $retorno["dircom_tipovia"] = '';
        $retorno["dircom_numvia"] = '';
        $retorno["dircom_apevia"] = '';
        $retorno["dircom_orivia"] = '';
        $retorno["dircom_numcruce"] = '';
        $retorno["dircom_apecruce"] = '';
        $retorno["dircom_oricruce"] = '';
        $retorno["dircom_numplaca"] = '';
        $retorno["dircom_complemento"] = '';
        $retorno["barriocom"] = $reg["barriocom"];
        $retorno["barriocomnombre"] = retornarRegistroMysqliApi($mysqli, "mreg_barriosmuni", "idmunicipio='" . $reg["muncom"] . "' and idbarrio='" . $reg["barriocom"] . "'", "nombre");
        $retorno["muncom"] = $reg["muncom"];
        $retorno["paicom"] = $reg["paicom"]; // Nuevo 002
        $retorno["muncomnombre"] = retornarRegistroMysqliApi($mysqli, "bas_municipios", "codigomunicipio='" . $reg["muncom"] . "'", "ciudad");
        $retorno["telcom1"] = $reg["telcom1"];
        $retorno["telcom2"] = $reg["telcom2"];
        $retorno["celcom"] = $reg["telcom3"];
        $retorno["telcomant1"] = '';
        $retorno["telcomant2"] = '';
        $retorno["telcomant3"] = '';
        $retorno["faxcom"] = $reg["faxcom"];
        $retorno["aacom"] = $reg["aacom"];
        $retorno["zonapostalcom"] = '';
        $retorno["emailcom"] = $reg["emailcom"];
        $retorno["emailcom2"] = $reg["emailcom2"];
        $retorno["emailcom3"] = $reg["emailcom3"];
        $retorno["emailcomant"] = '';
        $retorno["nombresegundocontacto"] = $reg["nomsegcon"];
        $retorno["cargosegundocontacto"] = $reg["carsegcon"];
        $retorno["urlcom"] = $reg["urlcom"];
        $retorno["numpredial"] = $reg["numpredial"];
        $retorno["codigopostalcom"] = $reg["codigopostalcom"]; // Nuevo campo circular 002
        $retorno["codigozonacom"] = $reg["codigozonacom"]; // Nuevo campo circular 002 - Urbao o rural
        // informacion de ubicacion de notificacion
        $retorno["dirnot"] = $reg["dirnot"];
        $retorno["dirnot_tipovia"] = '';
        $retorno["dirnot_numvia"] = '';
        $retorno["dirnot_apevia"] = '';
        $retorno["dirnot_orivia"] = '';
        $retorno["dirnot_numcruce"] = '';
        $retorno["dirnot_apecruce"] = '';
        $retorno["dirnot_oricruce"] = '';
        $retorno["dirnot_numplaca"] = '';
        $retorno["dirnot_complemento"] = '';
        $retorno["barrionot"] = $reg["barrionot"];
        $retorno["barrionotnombre"] = '';
        $retorno["munnot"] = $reg["munnot"];
        $retorno["painot"] = $reg["painot"]; // Nuevo 002
        $retorno["munnotnombre"] = retornarRegistroMysqliApi($mysqli, "bas_municipios", "codigomunicipio='" . $reg["munnot"] . "'", "ciudad");
        $retorno["telnot"] = $reg["telnot"];
        $retorno["telnot2"] = $reg["telnot2"];
        $retorno["telnotant1"] = '';
        $retorno["telnotant2"] = '';
        $retorno["telnotant3"] = '';
        $retorno["celnot"] = $reg["telnot3"];
        $retorno["faxnot"] = $reg["faxnot"];
        $retorno["aanot"] = $reg["aanot"];
        $retorno["zonapostalnot"] = '';
        $retorno["emailnot"] = $reg["emailnot"];
        $retorno["emailnotant"] = '';
        $retorno["urlnot"] = $reg["urlnot"];
        $retorno["codigopostalnot"] = $reg["codigopostalnot"]; // Nuevo campo circular 002
        $retorno["codigozonanot"] = $reg["codigozonanot"]; // Nuevo campo circular 002 - Urbano o rural
        $retorno["tiposedeadm"] = $reg["tiposedeadm"]; // Nuevo campo circular 002 - 1,2,3,4
        //
        //2017-06-201: JINT: No utilizados
        $retorno["latitudgrados"] = "";
        $retorno["latitudminutos"] = "";
        $retorno["latitudsegundos"] = "";
        $retorno["latitudorientacion"] = "";
        $retorno["longitudgrados"] = "";
        $retorno["longitudminutos"] = "";
        $retorno["longitudsegundos"] = "";
        $retorno["longitudorientacion"] = "";

        // 2017-06-21: JINT - Se alimenta desde la tabla mreg_geolocalizacion
        $retorno["latitud"] = "";
        $retorno["longitud"] = "";
        $ax1 = retornarRegistrosMysqliApi($mysqli, 'mreg_geolocalizacion', "matricula='" . $reg["matricula"] . "'", 'fecha asc, hora asc');
        if ($ax1 && !empty($ax1)) {
            foreach ($ax1 as $x1) {
                if ($x1["latitud"] != 'undefined' && $x1["longitud"] != 'undefined') {
                    $retorno["latitud"] = $x1["latitud"];
                    $retorno["longitud"] = $x1["longitud"];
                }
            }
        }
        unset($x1);
        unset($ax1);

        // Localiza emails y celulars anteriores
        // if ($tipodata == 'E') {
        if (trim($reg["matricula"]) != '') {
            $retorno["telcomant1"] = \funcionesGenerales::localizarCampoAnterior($mysqli, $reg["matricula"], 'telcom1');
            $retorno["telcomant2"] = \funcionesGenerales::localizarCampoAnterior($mysqli, $reg["matricula"], 'telcom2');
            $retorno["telcomant3"] = \funcionesGenerales::localizarCampoAnterior($mysqli, $reg["matricula"], 'celcom');
            $retorno["telnotant1"] = \funcionesGenerales::localizarCampoAnterior($mysqli, $reg["matricula"], 'telnot');
            $retorno["telnotant2"] = \funcionesGenerales::localizarCampoAnterior($mysqli, $reg["matricula"], 'telnot2');
            $retorno["telnotant3"] = \funcionesGenerales::localizarCampoAnterior($mysqli, $reg["matricula"], 'celnot');
            $retorno["emailcomant"] = \funcionesGenerales::localizarCampoAnterior($mysqli, $reg["matricula"], 'emailcom');
            $retorno["emailnotant"] = \funcionesGenerales::localizarCampoAnterior($mysqli, $reg["matricula"], 'emailnot');
        }
        // }
        // Datos de correspondencia
        $retorno["dircor"] = $reg["dircor"];
        $retorno["telcor"] = $reg["telcor"];
        $retorno["telcor2"] = $reg["telcor2"];
        $retorno["muncor"] = $reg["muncor"];

        // informacion ed actividad economica
        $retorno["ciius3"] = array();
        if (isset($reg["ciiu31"])) {
            $retorno["ciius3"][1] = $reg["ciiu31"];
            $retorno["ciius3"][2] = $reg["ciiu32"];
            $retorno["ciius3"][3] = $reg["ciiu33"];
            $retorno["ciius3"][4] = $reg["ciiu34"];
        }

        // informacion ed actividad economica
        $retorno["ciius"] = array();
        $retorno["ciius"][1] = $reg["ciiu1"];
        $retorno["ciius"][2] = $reg["ciiu2"];
        $retorno["ciius"][3] = $reg["ciiu3"];
        $retorno["ciius"][4] = $reg["ciiu4"];
        $retorno["ciius"][5] = $reg["ciiu5"];

        // 2017-10-13: JINT: Para resolver problemas de letras incorrectas en el CIIU
        if (trim($retorno["ciius"][1]) != '') {
            $ciiux = retornarRegistroMysqliApi($mysqli, 'bas_ciius', "idciiunum='" . substr($retorno["ciius"][1], 1) . "'");
            if ($ciiux && !empty($ciiux)) {
                $retorno["ciius"][1] = $ciiux["idciiu"];
            }
        }
        if (trim($retorno["ciius"][2]) != '') {
            $ciiux = retornarRegistroMysqliApi($mysqli, 'bas_ciius', "idciiunum='" . substr($retorno["ciius"][2], 1) . "'");
            if ($ciiux && !empty($ciiux)) {
                $retorno["ciius"][2] = $ciiux["idciiu"];
            }
        }
        if (trim($retorno["ciius"][3]) != '') {
            $ciiux = retornarRegistroMysqliApi($mysqli, 'bas_ciius', "idciiunum='" . substr($retorno["ciius"][3], 1) . "'");
            if ($ciiux && !empty($ciiux)) {
                $retorno["ciius"][3] = $ciiux["idciiu"];
            }
        }
        if (trim($retorno["ciius"][4]) != '') {
            $ciiux = retornarRegistroMysqliApi($mysqli, 'bas_ciius', "idciiunum='" . substr($retorno["ciius"][4], 1) . "'");
            if ($ciiux && !empty($ciiux)) {
                $retorno["ciius"][4] = $ciiux["idciiu"];
            }
        }


        //
        $retorno["versionciiu"] = $reg["versionciiu"];
        $retorno["desactiv"] = stripslashes($reg["actividad"]); // Nuevo campo circular 002
        $retorno["feciniact1"] = $reg["feciniact1"]; // Nuevo campo circular 002
        $retorno["feciniact2"] = $reg["feciniact2"]; // Nuevo campo circular 002
        $retorno["codaduaneros"] = $reg["codaduaneros"]; // Nuevo campo circular 002
        if (!isset($reg["ingesperados"]) || trim($reg["ingesperados"]) == '') {
            $reg["ingesperados"] = 0;
        }
        $retorno["ingesperados"] = $reg["ingesperados"]; // Nuevo campo circular 002
        $retorno["gruponiif"] = $reg["gruponiif"]; // Nuevo campo circular 002
        $retorno["niifconciliacion"] = $reg["niifconciliacion"]; // Nuevo campo circular 002
        $retorno["aportantesegsocial"] = $reg["aportantesegsocial"]; // Nuevo campo circular 002
        $retorno["tipoaportantesegsocial"] = $reg["tipoaportantesegsocial"]; // Nuevo campo circular 002
        //
        // informacion de porcentajes de capital
        $retorno["cap_porcnaltot"] = $reg["pornaltot"];
        $retorno["cap_porcnalpri"] = $reg["pornalpri"];
        $retorno["cap_porcnalpub"] = $reg["pornalpub"];
        $retorno["cap_porcexttot"] = $reg["porexttot"];
        $retorno["cap_porcextpri"] = $reg["porextpri"];
        $retorno["cap_porcextpub"] = $reg["porextpub"];

        $retorno["cap_apolab"] = 0;
        $retorno["cap_apolabadi"] = 0;
        $retorno["cap_apoact"] = 0;
        $retorno["cap_apodin"] = 0;

        $retorno["capsoc"] = 0;
        $retorno["capaut"] = 0;
        $retorno["capsus"] = 0;
        $retorno["cappag"] = 0;
        $retorno["cuosoc"] = 0;
        $retorno["cuoaut"] = 0;
        $retorno["cuosus"] = 0;
        $retorno["cuopag"] = 0;
        $retorno["capsuc"] = 0;

        // 2019-12-15: JINT: Cantidad de mujeres, participacion y tamaño empresarial
        $retorno["cantidadmujeres"] = $reg["cantidadmujeres"];
        $retorno["cantidadmujerescargosdirectivos"] = $reg["cantidadmujerescargosdirectivos"];
        $retorno["participacionmujeres"] = $reg["participacionmujeres"];
        $retorno["ciiutamanoempresarial"] = '';
        $retorno["ingresostamanoempresarial"] = '';
        $retorno["anodatostamanoempresarial"] = '';
        $retorno["fechadatostamanoempresarial"] = '';
        $tex = retornarRegistrosMysqliApi($mysqli, 'mreg_tamano_empresarial', "matricula='" . $reg["matricula"] . "'", 'anodatos,fechadatos');
        if ($tex && !empty($tex)) {
            foreach ($tex as $tex1) {
                $retorno["ciiutamanoempresarial"] = $tex1["ciiu"];
                $retorno["ingresostamanoempresarial"] = $tex1["ingresos"];
                $retorno["anodatostamanoempresarial"] = $tex1["anodatos"];
                $retorno["fechadatostamanoempresarial"] = $tex1["fechadatos"];
            }
        }
        unset($tex);
        unset($tex1);

        // información de Establecimientos de comercio asociados
        $retorno["cntestab01"] = $reg["cntest01"];
        $retorno["cntestab02"] = $reg["cntest02"];
        $retorno["cntestab03"] = $reg["cntest03"];
        $retorno["cntestab04"] = $reg["cntest04"];
        $retorno["cntestab05"] = $reg["cntest05"];
        $retorno["cntestab06"] = $reg["cntest06"];
        $retorno["cntestab07"] = $reg["cntest07"];
        $retorno["cntestab08"] = $reg["cntest08"];
        $retorno["cntestab09"] = $reg["cntest09"];
        $retorno["cntestab10"] = $reg["cntest10"];
        $retorno["cntestab11"] = $reg["cntest11"];

        // información de referencias comerciales y bancarias
        $retorno["refcrenom1"] = $reg["refcrenom1"];
        $retorno["refcreofi1"] = $reg["refcreofi1"];
        $retorno["refcretel1"] = $reg["refcretel1"];
        $retorno["refcrenom2"] = $reg["refcrenom2"];
        $retorno["refcreofi2"] = $reg["refcreofi2"];
        $retorno["refcretel2"] = $reg["refcretel2"];
        $retorno["refcomnom1"] = $reg["refcomnom1"];
        $retorno["refcomdir1"] = $reg["refcomdir1"];
        $retorno["refcomtel1"] = $reg["refcomtel1"];
        $retorno["refcomnom2"] = $reg["refcomnom2"];
        $retorno["refcomdir2"] = $reg["refcomdir2"];
        $retorno["refcomtel2"] = $reg["refcomtel2"];

        $retorno["anodatos"] = '';
        $retorno["fechadatos"] = '';
        $retorno["personal"] = 0;
        $retorno["personaltemp"] = 0;
        $retorno["actvin"] = 0;
        $retorno["valest"] = 0;
        $retorno["actcte"] = 0;
        $retorno["actnocte"] = 0;
        $retorno["actfij"] = 0;
        $retorno["fijnet"] = 0;
        $retorno["actotr"] = 0;
        $retorno["actval"] = 0;
        $retorno["acttot"] = 0;
        $retorno["actsinaju"] = 0;
        $retorno["invent"] = 0;
        $retorno["pascte"] = 0;
        $retorno["paslar"] = 0;
        $retorno["pastot"] = 0;
        $retorno["pattot"] = 0;
        $retorno["paspat"] = 0;
        $retorno["balsoc"] = 0;
        $retorno["ingope"] = 0;
        $retorno["ingnoope"] = 0;
        $retorno["gtoven"] = 0;
        $retorno["gtoadm"] = 0;
        $retorno["cosven"] = 0;
        $retorno["depamo"] = 0;
        $retorno["gasint"] = 0;
        $retorno["gasimp"] = 0;
        $retorno["utiope"] = 0;
        $retorno["utinet"] = 0;

        $retorno["apolab"] = $reg["apolab"];
        $retorno["apolabadi"] = $reg["apolabadi"];
        $retorno["apoact"] = $reg["apoact"];
        $retorno["apodin"] = $reg["apodin"];
        $retorno["apotra"] = $reg["apotra"];
        $retorno["apotot"] = $reg["apotot"];

        $retorno["anodatospatrimonio"] = '';
        $retorno["fechadatospatrimonio"] = '';
        $retorno["patrimonioesadl"] = 0;

        // información financiera
        $ax1 = retornarRegistrosMysqliApi($mysqli, 'mreg_est_financiera', "matricula='" . $reg["matricula"] . "'", 'anodatos asc, fechadatos asc');
        if ($ax1 && !empty($ax1)) {
            foreach ($ax1 as $x1) {
                $retorno["anodatos"] = $x1["anodatos"];
                $retorno["fechadatos"] = $x1["fechadatos"];
                $retorno["personal"] = $x1["personal"];
                $retorno["personaltemp"] = $x1["pcttemp"];
                $retorno["patrimonio"] = $x1["patrimonio"];
                $retorno["actvin"] = $x1["actvin"];
                $retorno["valest"] = $x1["actvin"];
                $retorno["actcte"] = $x1["actcte"];
                $retorno["actnocte"] = $x1["actnocte"];
                $retorno["actfij"] = $x1["actfij"];
                $retorno["fijnet"] = $x1["fijnet"];
                $retorno["actotr"] = $x1["actotr"];
                $retorno["actval"] = $x1["actval"];
                $retorno["acttot"] = $x1["acttot"];
                $retorno["actsinaju"] = 0;
                $retorno["invent"] = 0;
                $retorno["pascte"] = $x1["pascte"];
                $retorno["paslar"] = $x1["paslar"];
                $retorno["pastot"] = $x1["pastot"];
                $retorno["pattot"] = $x1["patnet"];
                $retorno["paspat"] = $x1["paspat"];
                $retorno["balsoc"] = $x1["balsoc"];
                $retorno["ingope"] = $x1["ingope"];
                $retorno["ingnoope"] = $x1["ingnoope"];
                $retorno["gtoven"] = $x1["gtoven"];
                $retorno["gtoadm"] = $x1["gasadm"];
                $retorno["cosven"] = $x1["cosven"];
                $retorno["depamo"] = 0;
                $retorno["gasint"] = $x1["gasint"];
                $retorno["gasimp"] = $x1["gasimp"];
                $retorno["utiope"] = $x1["utiope"];
                $retorno["utinet"] = $x1["utinet"];
            }
            unset($x1);
            unset($ax1);
        }

        $ax1 = retornarRegistrosMysqliApi($mysqli, 'mreg_est_patrimonios', "matricula='" . $reg["matricula"] . "'", 'anodatos asc, fechadatos asc');
        if ($ax1 && !empty($ax1)) {
            foreach ($ax1 as $x1) {
                $retorno["anodatospatrimonio"] = $x1["anodatos"];
                $retorno["fechadatospatrimonio"] = $x1["fechadatos"];
                $retorno["patrimonioesadl"] = $x1["patrimonio"];
            }
            unset($x1);
            unset($ax1);
        }

        // Campos adicionados en mayo 20 de 2011     
        $retorno["ctrmen"] = $reg["ctrnotemail"];
        $retorno["ctrmennot"] = $reg["ctrnotsms"];
        $retorno["ctrubi"] = $reg["ctrubi"];
        $retorno["ctrfun"] = $reg["ctrfun"];
        $retorno["art4"] = $reg["ctrbenart4"];
        $retorno["art7"] = $reg["ctrbenart7"];
        $retorno["art50"] = $reg["ctrbenart50"];
        $retorno["ctrcancelacion1429"] = $reg["ctrcance1429"];
        $retorno["benley1780"] = $reg["ctrbenley1780"];
        $retorno["cumplerequisitos1780"] = $reg["cumplerequisitos1780"];  // Nuevo campo circular 002
        $retorno["renunciabeneficios1780"] = $reg["renunciabeneficios1780"]; // Nuevo campo circular 002
        $retorno["cumplerequisitos1780primren"] = $reg["cumplerequisitos1780primren"]; // Nuevo campo circular 002
        $retorno["ctrbic"] = $reg["ctrbic"];


        $retorno["fecmatant"] = $reg["fecmatant"];
        $retorno["fecrenant"] = $reg["fecrenant"];
        $retorno["matriculaanterior"] = $reg["matant"];
        $retorno["matant"] = $reg["matant"];
        $retorno["camant"] = $reg["camant"];
        $retorno["munant"] = $reg["munant"];
        $retorno["ultanorenant"] = $reg["ultanorenant"];
        $retorno["benart7ant"] = $reg["benart7ant"];
        $retorno["benley1780ant"] = $reg["benley1780ant"];

        //
        $retorno["ivcenvio"] = $reg["ctrivcenvio"];
        $retorno["ivcsuelos"] = $reg["ctrivcsuelos"];
        $retorno["ivcarea"] = $reg["ctrivcarea"];
        $retorno["ivcver"] = $reg["ctrivcver"];
        $retorno["ivccretip"] = $reg["ctrivccretip"];
        $retorno["ivcali"] = $reg["ctrivcali"];
        $retorno["ivcqui"] = $reg["ctrivcqui"];
        $retorno["ivcriesgo"] = $reg["ctrivcriesgo"];

        // Representacion legal y administracion
        $retorno["idtipoidentificacionreplegal"] = '';
        $retorno["identificacionreplegal"] = '';
        $retorno["nombrereplegal"] = '';
        $retorno["idtipoidentificacionadministrador"] = '';
        $retorno["identificacionadministrador"] = '';
        $retorno["nombreadministrador"] = '';

        // Casa principal
        $retorno["cpcodcam"] = $reg["cpcodcam"];
        $retorno["cpnummat"] = $reg["cpnummat"];
        $retorno["cprazsoc"] = $reg["cprazsoc"];
        $retorno["cpnumnit"] = $reg["cpnumnit"];
        $retorno["cpdircom"] = $reg["cpdircom"];
        $retorno["cpdirnot"] = $reg["cpdirnot"];
        $retorno["cpnumtel"] = $reg["cpnumtel"];
        $retorno["cpnumtel2"] = ''; // Nacen con circular 002
        $retorno["cpnumtel3"] = ''; // Nacen con circular 002
        $retorno["cpnumfax"] = $reg["cpnumfax"];
        $retorno["cpcodmun"] = $reg["cpcodmun"];
        $retorno["cpmunnot"] = $reg["cpmunnot"];

        // Bienes
        $retorno["bienes"] = array();
        $bienes = retornarRegistrosMysqliApi($mysqli, 'mreg_est_bienes', "matricula='" . $reg["matricula"] . "'", "matinmo");
        if ($bienes) {
            if (!empty($bienes)) {
                $i = 0;
                foreach ($bienes as $bien) {
                    $i++;
                    $retorno["bienes"][$i]["matinmo"] = $bien["matinmo"];
                    $retorno["bienes"][$i]["dir"] = stripslashes($bien["dir"]);
                    $retorno["bienes"][$i]["barrio"] = stripslashes($bien["barrio"]);
                    $retorno["bienes"][$i]["muni"] = stripslashes($bien["muni"]);
                    $retorno["bienes"][$i]["dpto"] = stripslashes($bien["dpto"]);
                    $retorno["bienes"][$i]["pais"] = stripslashes($bien["pais"]);
                }
            }
        }

        //
        $retorno["clasevinculo"] = $_SESSION["clasevinculo"];

        // Vinculos 
        // Vinculos históricos
        // Representantes legales
        $retorno["replegal"] = array();
        $retorno["vinculos"] = array();
        $retorno["vinculosh"] = array();
        $vincs = retornarRegistrosMysqliApi($mysqli, 'mreg_est_vinculos', "matricula='" . ltrim(trim($reg["matricula"]), "0") . "'", "estado,vinculo,idcargo,fecha,idclase,numid");
        $iVincs = 0;
        $iVincsh = 0;
        $iReps = 0;
        $primerRep = 0;
        if ($vincs) {
            if (!empty($vincs)) {
                foreach ($vincs as $vin) {
                    if ($vin["estado"] == 'V') {
                        $iVincs++;
                        $retorno["vinculos"][$iVincs]["idtipoidentificacionotros"] = $vin["idclase"];
                        $retorno["vinculos"][$iVincs]["identificacionotros"] = $vin["numid"];
                        $retorno["vinculos"][$iVincs]["nombreotros"] = stripslashes($vin["nombre"]);
                        $retorno["vinculos"][$iVincs]["apellido1otros"] = stripslashes($vin["ape1"]);
                        $retorno["vinculos"][$iVincs]["apellido2otros"] = stripslashes($vin["ape2"]);
                        $retorno["vinculos"][$iVincs]["nombre1otros"] = stripslashes($vin["nom1"]);
                        $retorno["vinculos"][$iVincs]["nombre2otros"] = stripslashes($vin["nom2"]);
                        $retorno["vinculos"][$iVincs]["direccionotros"] = stripslashes($vin["direccion"]);
                        $retorno["vinculos"][$iVincs]["municipiootros"] = stripslashes($vin["municipio"]);
                        $retorno["vinculos"][$iVincs]["paisotros"] = stripslashes($vin["pais"]);
                        $retorno["vinculos"][$iVincs]["emailotros"] = stripslashes($vin["email"]);
                        $retorno["vinculos"][$iVincs]["celularotros"] = ($vin["celular"]);
                        $retorno["vinculos"][$iVincs]["fechanacimientootros"] = ($vin["fechanacimiento"]);
                        $retorno["vinculos"][$iVincs]["idcargootros"] = ($vin["idcargo"]);
                        $retorno["vinculos"][$iVincs]["cargootros"] = stripslashes($vin["descargo"]);
                        $retorno["vinculos"][$iVincs]["vinculootros"] = ($vin["vinculo"]);
                        $retorno["vinculos"][$iVincs]["numtarprofotros"] = stripslashes($vin["tarjprof"]);
                        $retorno["vinculos"][$iVincs]["idclaseemp"] = ($vin["tirepresenta"]);
                        $retorno["vinculos"][$iVincs]["numidemp"] = ($vin["idrepresenta"]);
                        $retorno["vinculos"][$iVincs]["nombreemp"] = stripslashes($vin["nmrepresenta"]);
                        $retorno["vinculos"][$iVincs]["idvindianpnat"] = ($vin["vinculodianpnat"]);
                        $retorno["vinculos"][$iVincs]["idvindianpjur"] = ($vin["vinculodianpjur"]);
                        $retorno["vinculos"][$iVincs]["cuotasconst"] = ($vin["cuotasconst"]);
                        $retorno["vinculos"][$iVincs]["cuotasref"] = ($vin["cuotasref"]);
                        $retorno["vinculos"][$iVincs]["valorconst"] = ($vin["valorconst"]);
                        $retorno["vinculos"][$iVincs]["valorref"] = ($vin["valorref"]);
                        $retorno["vinculos"][$iVincs]["va1"] = ($vin["valorasociativa1"]);
                        $retorno["vinculos"][$iVincs]["va2"] = ($vin["valorasociativa2"]);
                        $retorno["vinculos"][$iVincs]["va3"] = ($vin["valorasociativa3"]);
                        $retorno["vinculos"][$iVincs]["va4"] = ($vin["valorasociativa4"]);
                        $retorno["vinculos"][$iVincs]["va5"] = ($vin["valorasociativa5"]);
                        $retorno["vinculos"][$iVincs]["va6"] = ($vin["valorasociativa6"]);
                        $retorno["vinculos"][$iVincs]["va7"] = ($vin["valorasociativa7"]);
                        $retorno["vinculos"][$iVincs]["va8"] = ($vin["valorasociativa8"]);
                        $retorno["vinculos"][$iVincs]["librootros"] = ($vin["idlibro"]);
                        $retorno["vinculos"][$iVincs]["inscripcionotros"] = ($vin["numreg"]);
                        $retorno["vinculos"][$iVincs]["dupliotros"] = ($vin["dupli"]);
                        $retorno["vinculos"][$iVincs]["fechaotros"] = ($vin["fecha"]);
                        $retorno["vinculos"][$iVincs]["ciiu1"] = ($vin["ciiu1"]);
                        $retorno["vinculos"][$iVincs]["ciiu2"] = ($vin["ciiu2"]);
                        $retorno["vinculos"][$iVincs]["ciiu3"] = ($vin["ciiu3"]);
                        $retorno["vinculos"][$iVincs]["ciiu4"] = ($vin["ciiu4"]);
                        $retorno["vinculos"][$iVincs]["tipositcontrol"] = ($vin["tipositcontrol"]);
                        $retorno["vinculos"][$iVincs]["desactiv"] = ($vin["desactiv"]);
                        $retorno["vinculos"][$iVincs]["fechaconfiguracion"] = ($vin["fechaconfiguracion"]);
                        $retorno["vinculos"][$iVincs]["codcertifica"] = ($vin["codcertifica"]);
                        $retorno["vinculos"][$iVincs]["tipovinculo"] = $_SESSION["maestrovinculos"][$vin["vinculo"]]["tipovinculo"];
                        $retorno["vinculos"][$iVincs]["renrem"] = $vin["renunciaremocion"];
                    }
                    if ($vin["estado"] == 'H') {
                        $iVincsh++;
                        $retorno["vinculosh"][$iVincsh]["idtipoidentificacionotros"] = $vin["idclase"];
                        $retorno["vinculosh"][$iVincsh]["identificacionotros"] = $vin["numid"];
                        $retorno["vinculosh"][$iVincsh]["nombreotros"] = stripslashes($vin["nombre"]);
                        $retorno["vinculosh"][$iVincsh]["apellido1otros"] = stripslashes($vin["ape1"]);
                        $retorno["vinculosh"][$iVincsh]["apellido2otros"] = stripslashes($vin["ape2"]);
                        $retorno["vinculosh"][$iVincsh]["nombre1otros"] = stripslashes($vin["nom1"]);
                        $retorno["vinculosh"][$iVincsh]["nombre2otros"] = stripslashes($vin["nom2"]);
                        $retorno["vinculosh"][$iVincsh]["direccionotros"] = stripslashes($vin["direccion"]);
                        $retorno["vinculosh"][$iVincsh]["municipiootros"] = stripslashes($vin["municipio"]);
                        $retorno["vinculosh"][$iVincsh]["paisotros"] = stripslashes($vin["pais"]);
                        $retorno["vinculosh"][$iVincsh]["emailotros"] = stripslashes($vin["email"]);
                        $retorno["vinculosh"][$iVincsh]["celularotros"] = ($vin["celular"]);
                        $retorno["vinculosh"][$iVincsh]["fechanacimientootros"] = ($vin["fechanacimiento"]);
                        $retorno["vinculosh"][$iVincsh]["idcargootros"] = ($vin["idcargo"]);
                        $retorno["vinculosh"][$iVincsh]["cargootros"] = stripslashes($vin["descargo"]);
                        $retorno["vinculosh"][$iVincsh]["vinculootros"] = ($vin["vinculo"]);
                        $retorno["vinculosh"][$iVincsh]["numtarprofotros"] = stripslashes($vin["tarjprof"]);
                        $retorno["vinculosh"][$iVincsh]["idclaseemp"] = ($vin["tirepresenta"]);
                        $retorno["vinculosh"][$iVincsh]["numidemp"] = ($vin["idrepresenta"]);
                        $retorno["vinculosh"][$iVincsh]["nombreemp"] = stripslashes($vin["nmrepresenta"]);
                        $retorno["vinculosh"][$iVincsh]["idvindianpnat"] = ($vin["vinculodianpnat"]);
                        $retorno["vinculosh"][$iVincsh]["idvindianpjur"] = ($vin["vinculodianpjur"]);
                        $retorno["vinculosh"][$iVincsh]["cuotasconst"] = ($vin["cuotasconst"]);
                        $retorno["vinculosh"][$iVincsh]["cuotasref"] = ($vin["cuotasref"]);
                        $retorno["vinculosh"][$iVincsh]["valorconst"] = ($vin["valorconst"]);
                        $retorno["vinculosh"][$iVincsh]["valorref"] = ($vin["valorref"]);
                        $retorno["vinculosh"][$iVincsh]["va1"] = ($vin["valorasociativa1"]);
                        $retorno["vinculosh"][$iVincsh]["va2"] = ($vin["valorasociativa2"]);
                        $retorno["vinculosh"][$iVincsh]["va3"] = ($vin["valorasociativa3"]);
                        $retorno["vinculosh"][$iVincsh]["va4"] = ($vin["valorasociativa4"]);
                        $retorno["vinculosh"][$iVincsh]["va5"] = ($vin["valorasociativa5"]);
                        $retorno["vinculosh"][$iVincsh]["va6"] = ($vin["valorasociativa6"]);
                        $retorno["vinculosh"][$iVincsh]["va7"] = ($vin["valorasociativa7"]);
                        $retorno["vinculosh"][$iVincsh]["va8"] = ($vin["valorasociativa8"]);
                        $retorno["vinculosh"][$iVincsh]["librootros"] = ($vin["idlibro"]);
                        $retorno["vinculosh"][$iVincsh]["inscripcionotros"] = ($vin["numreg"]);
                        $retorno["vinculosh"][$iVincsh]["dupliotros"] = ($vin["dupli"]);
                        $retorno["vinculosh"][$iVincsh]["fechaotros"] = ($vin["fecha"]);
                        $retorno["vinculosh"][$iVincsh]["ciiu1"] = ($vin["ciiu1"]);
                        $retorno["vinculosh"][$iVincsh]["ciiu2"] = ($vin["ciiu2"]);
                        $retorno["vinculosh"][$iVincsh]["ciiu3"] = ($vin["ciiu3"]);
                        $retorno["vinculosh"][$iVincsh]["ciiu4"] = ($vin["ciiu4"]);
                        $retorno["vinculosh"][$iVincsh]["tipositcontrol"] = ($vin["tipositcontrol"]);
                        $retorno["vinculosh"][$iVincsh]["desactiv"] = ($vin["desactiv"]);
                        $retorno["vinculosh"][$iVincsh]["fechaconfiguracion"] = ($vin["fechaconfiguracion"]);
                    }

                    if ($_SESSION["maestrovinculos"][$vin["vinculo"]]["tipovinculo"] == 'RLP' ||
                            $_SESSION["maestrovinculos"][$vin["vinculo"]]["tipovinculo"] == 'RLS1' ||
                            $_SESSION["maestrovinculos"][$vin["vinculo"]]["tipovinculo"] == 'RLS2' ||
                            $_SESSION["maestrovinculos"][$vin["vinculo"]]["tipovinculo"] == 'RLS3' ||
                            $_SESSION["maestrovinculos"][$vin["vinculo"]]["tipovinculo"] == 'RLS4' ||
                            $_SESSION["maestrovinculos"][$vin["vinculo"]]["tipovinculo"] == 'GER') {
                        if ($vin["estado"] == 'V') {
                            $iReps++;
                            $retorno["replegal"][$iReps]["idtipoidentificacionreplegal"] = $vin["idclase"];
                            $retorno["replegal"][$iReps]["identificacionreplegal"] = $vin["numid"];
                            $retorno["replegal"][$iReps]["nombrereplegal"] = stripslashes($vin["nombre"]);
                            $retorno["replegal"][$iReps]["nombre1replegal"] = stripslashes($vin["nom1"]);
                            $retorno["replegal"][$iReps]["nombre2replegal"] = stripslashes($vin["nom2"]);
                            $retorno["replegal"][$iReps]["apellido1replegal"] = stripslashes($vin["ape1"]);
                            $retorno["replegal"][$iReps]["apellido2replegal"] = stripslashes($vin["ape2"]);
                            $retorno["replegal"][$iReps]["emailreplegal"] = stripslashes($vin["email"]);
                            $retorno["replegal"][$iReps]["celularreplegal"] = ($vin["celular"]);
                            $retorno["replegal"][$iReps]["cargoreplegal"] = stripslashes($vin["descargo"]);
                            $retorno["replegal"][$iReps]["vinculoreplegal"] = ($vin["vinculo"]);
                            $retorno["replegal"][$iReps]["libroreplegal"] = ($vin["idlibro"]);
                            $retorno["replegal"][$iReps]["inscripcionreplegal"] = ($vin["numreg"]);
                            $retorno["replegal"][$iReps]["fechareplegal"] = ($vin["fecha"]);
                        }
                    }

                    // Primer representante legal y administrador
                    if ($vin["estado"] == 'V') {
                        if ($_SESSION["maestrovinculos"][$vin["vinculo"]]["tipovinculo"] == 'RLP' ||
                                $_SESSION["maestrovinculos"][$vin["vinculo"]]["tipovinculo"] == 'GER') {
                            $primerRep++;
                            if ($primerRep == 1) {
                                $retorno["idtipoidentificacionreplegal"] = $vin["idclase"];
                                $retorno["identificacionreplegal"] = $vin["numid"];
                                $retorno["nombrereplegal"] = stripslashes($vin["nombre"]);
                            }
                        }
                        if ($_SESSION["maestrovinculos"][$vin["vinculo"]]["tipovinculo"] == 'ADMP') {
                            $retorno["idtipoidentificacionadministrador"] = $vin["idclase"];
                            $retorno["identificacionadministrador"] = $vin["numid"];
                            $retorno["nombreadministrador"] = stripslashes($vin["nombre"]);
                        }
                    }
                }
            }
        }

        $retorno["vincuprop"] = array();
        $iVinProp = 0;

        // Propietarios
        $retorno["propietarios"] = array();
        if ($retorno["organizacion"] == '02') {
            $props = retornarRegistrosMysqliApi($mysqli, 'mreg_est_propietarios', "matricula='" . $retorno["matricula"] . "'", "id");
            $iProp = 0;
            if ($props) {
                if (!empty($props)) {
                    foreach ($props as $prop) {
                        if ($prop["estado"] == 'V') {
                            $iProp++;
                            if (ltrim($prop["matriculapropietario"], "0") != '') {
                                if (ltrim($prop["codigocamara"], "0") == '') {
                                    $prop["codigocamara"] = CODIGO_EMPRESA;
                                }
                            }

                            $prop["fecmatprop"] = '';
                            $prop["fecrenprop"] = '';
                            $prop["ultanorenprop"] = '';
                            $prop["organizacionprop"] = '';
                            $prop["estadodatosprop"] = '';
                            $prop["estadomatriculaprop"] = '';
                            $prop["afiliacionprop"] = '';
                            $prop["ultanorenafliaprop"] = '';
                            $prop["saldoafliaprop"] = 0;
                            $prop["nombrereplegal"] = '';
                            $prop["identificacionreplegal"] = '';
                            $prop["tipoidentificacionreplegal"] = '';

                            if ($prop["codigocamara"] == CODIGO_EMPRESA) {
                                if (ltrim(trim($prop["matriculapropietario"]), "0") != '') {
                                    $xprop = retornarRegistroMysqliApi($mysqli, 'mreg_est_inscritos', "matricula='" . ltrim(trim($prop["matriculapropietario"]), "0") . "'");
                                    if ($xprop === false || empty($xprop)) {
                                        $prop["tipoidentificacion"] = '';
                                        $prop["identificacion"] = '';
                                        $prop["nit"] = '';
                                        $prop["razonsocial"] = '';
                                        $prop["nombre1"] = '';
                                        $prop["nombre2"] = '';
                                        $prop["apellido1"] = '';
                                        $prop["apellido2"] = '';
                                        $prop["dircom"] = '';
                                        $prop["muncom"] = '';
                                        $prop["dirnot"] = '';
                                        $prop["munnot"] = '';
                                        $prop["telcom1"] = '';
                                        $prop["telcom2"] = '';
                                        $prop["telcom3"] = '';
                                        $prop["fecmatprop"] = '';
                                        $prop["fecrenprop"] = '';
                                        $prop["ultanorenprop"] = '';
                                        $prop["organizacionprop"] = '';
                                        $prop["estadodatosprop"] = '';
                                        $prop["estadomatriculaprop"] = '';
                                        $prop["afiliacionprop"] = '';
                                        $prop["ultanorenafliaprop"] = '';
                                        $prop["saldoafliaprop"] = '';
                                        $prop["nombrereplegal"] = '';
                                        $prop["identificacionreplegal"] = '';
                                        $prop["tipoidentificacionreplegal"] = '';
                                    } else {
                                        $prop["tipoidentificacion"] = $xprop["idclase"];
                                        $prop["identificacion"] = $xprop["numid"];
                                        $prop["nit"] = $xprop["nit"];
                                        $prop["razonsocial"] = $xprop["razonsocial"];
                                        $prop["nombre1"] = $xprop["nombre1"];
                                        $prop["nombre2"] = $xprop["nombre2"];
                                        $prop["apellido1"] = $xprop["apellido1"];
                                        $prop["apellido2"] = $xprop["apellido2"];
                                        $prop["dircom"] = $xprop["dircom"];
                                        $prop["muncom"] = $xprop["muncom"];
                                        $prop["dirnot"] = $xprop["dirnot"];
                                        $prop["munnot"] = $xprop["munnot"];
                                        $prop["telcom1"] = $xprop["telcom1"];
                                        $prop["telcom2"] = $xprop["telcom2"];
                                        $prop["telcom3"] = $xprop["telcom3"];
                                        $prop["fecmatprop"] = $xprop["fecmatricula"];
                                        $prop["fecrenprop"] = $xprop["fecrenovacion"];
                                        $prop["ultanorenprop"] = $xprop["ultanoren"];
                                        $prop["organizacionprop"] = $xprop["organizacion"];
                                        $prop["estadodatosprop"] = $xprop["ctrestdatos"];
                                        $prop["estadomatriculaprop"] = $xprop["ctrestmatricula"];
                                        $prop["afiliacionprop"] = $xprop["ctrafiliacion"];
                                        $prop["ultanorenafliaprop"] = $xprop["anorenaflia"];
                                        $prop["saldoafliaprop"] = $xprop["saldoaflia"];

                                        $iXvincs = 0;
                                        $xvincs = retornarRegistrosMysqliApi($mysqli, 'mreg_est_vinculos', "matricula='" . $xprop["matricula"] . "' and estado = 'V'", "id");
                                        if ($xvincs) {
                                            if (!empty($xvincs)) {
                                                foreach ($xvincs as $xvin) {
                                                    if ($_SESSION["maestrovinculos"][$xvin["vinculo"]]["tipovinculo"] == 'RLP' ||
                                                            $_SESSION["maestrovinculos"][$xvin["vinculo"]]["tipovinculo"] == 'GER') {
                                                        $iXvincs++;
                                                        if ($iXvincs == 1) {
                                                            $prop["nombrereplegal"] = stripslashes($xvin["nombre"]);
                                                            $prop["identificacionreplegal"] = $xvin["idclase"];
                                                            $prop["tipoidentificacionreplegal"] = $xvin["numid"];
                                                        }
                                                        $iVinProp++;
                                                        $retorno["vincuprop"][$iVinProp] = array();
                                                        $retorno["vincuprop"][$iVinProp]["idclase"] = $xvin["idclase"];
                                                        $retorno["vincuprop"][$iVinProp]["numid"] = $xvin["numid"];
                                                        $retorno["vincuprop"][$iVinProp]["nombre"] = $xvin["nombre"];
                                                        $retorno["vincuprop"][$iVinProp]["vinculo"] = $xvin["vinculo"];
                                                        $retorno["vincuprop"][$iVinProp]["cargo"] = $xvin["descargo"];
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }

                            $retorno["propietarios"][$iProp]["camarapropietario"] = $prop["codigocamara"];
                            $retorno["propietarios"][$iProp]["matriculapropietario"] = ltrim($prop["matriculapropietario"], '0');
                            $retorno["propietarios"][$iProp]["idtipoidentificacionpropietario"] = trim($prop["tipoidentificacion"]);
                            $retorno["propietarios"][$iProp]["identificacionpropietario"] = ltrim($prop["identificacion"], '0');
                            $retorno["propietarios"][$iProp]["nitpropietario"] = ltrim($prop["nit"], '0');
                            $retorno["propietarios"][$iProp]["nombrepropietario"] = ($prop["razonsocial"]);
                            $retorno["propietarios"][$iProp]["nom1propietario"] = ($prop["nombre1"]);
                            $retorno["propietarios"][$iProp]["nom2propietario"] = ($prop["nombre2"]);
                            $retorno["propietarios"][$iProp]["ape1propietario"] = ($prop["apellido1"]);
                            $retorno["propietarios"][$iProp]["ape2propietario"] = ($prop["apellido2"]);
                            $retorno["propietarios"][$iProp]["tipopropiedad"] = ($prop["tipopropiedad"]);
                            $retorno["propietarios"][$iProp]["direccionpropietario"] = ($prop["dircom"]);
                            $retorno["propietarios"][$iProp]["municipiopropietario"] = ($prop["muncom"]);
                            $retorno["propietarios"][$iProp]["direccionnotpropietario"] = ($prop["dirnot"]);
                            $retorno["propietarios"][$iProp]["municipionotpropietario"] = ($prop["munnot"]);
                            $retorno["propietarios"][$iProp]["telefonopropietario"] = ($prop["telcom1"]);
                            $retorno["propietarios"][$iProp]["telefono2propietario"] = ($prop["telcom2"]);
                            $retorno["propietarios"][$iProp]["celularpropietario"] = ($prop["telcom3"]);
                            $retorno["propietarios"][$iProp]["nomreplegpropietario"] = ($prop["nombrereplegal"]);
                            $retorno["propietarios"][$iProp]["numidreplegpropietario"] = ($prop["identificacionreplegal"]);
                            $retorno["propietarios"][$iProp]["tipoidreplegpropietario"] = ($prop["tipoidentificacionreplegal"]);

                            $retorno["propietarios"][$iProp]["fecmatripropietario"] = '';
                            $retorno["propietarios"][$iProp]["fecrenovpropietario"] = '';
                            $retorno["propietarios"][$iProp]["ultanorenpropietario"] = '';
                            $retorno["propietarios"][$iProp]["organizacionpropietario"] = '';
                            $retorno["propietarios"][$iProp]["estadodatospropietario"] = '';
                            $retorno["propietarios"][$iProp]["estadomatriculapropietario"] = '';
                            $retorno["propietarios"][$iProp]["afiliacionpropietario"] = '';
                            $retorno["propietarios"][$iProp]["ultanorenafipropietario"] = '';
                            $retorno["propietarios"][$iProp]["saldoafiliadopropietario"] = '';

                            if (isset($prop["fecmatprop"])) {
                                $retorno["propietarios"][$iProp]["fecmatripropietario"] = ($prop["fecmatprop"]);
                            }
                            if (isset($prop["fecrenprop"])) {
                                $retorno["propietarios"][$iProp]["fecrenovpropietario"] = ($prop["fecrenprop"]);
                            }
                            if (isset($prop["ultanorenprop"])) {
                                $retorno["propietarios"][$iProp]["ultanorenpropietario"] = ($prop["ultanorenprop"]);
                            }
                            if (isset($prop["organizacionprop"])) {
                                $retorno["propietarios"][$iProp]["organizacionpropietario"] = ($prop["organizacionprop"]);
                            }
                            if (isset($prop["estadodatosprop"])) {
                                $retorno["propietarios"][$iProp]["estadodatospropietario"] = ($prop["estadodatosprop"]);
                            }
                            if (isset($prop["estadomatriculaprop"])) {
                                $retorno["propietarios"][$iProp]["estadomatriculapropietario"] = ($prop["estadomatriculaprop"]);
                            }
                            if (isset($prop["afiliacionprop"])) {
                                $retorno["propietarios"][$iProp]["afiliacionpropietario"] = ($prop["afiliacionprop"]);
                            }
                            if (isset($prop["ultanorenafliaprop"])) {
                                $retorno["propietarios"][$iProp]["ultanorenafipropietario"] = ($prop["ultanorenafliaprop"]);
                            }
                            if (isset($prop["saldoafliaprop"])) {
                                $retorno["propietarios"][$iProp]["saldoafiliadopropietario"] = ($prop["saldoafliaprop"]);
                            }
                        }
                    }
                }
            }
        }

        // Propietarios historicos
        $retorno["propietariosh"] = array();
        if ($retorno["organizacion"] == '02') {
            $props = retornarRegistrosMysqliApi($mysqli, 'mreg_est_propietarios', "matricula='" . $retorno["matricula"] . "'", "id");
            $iProp = 0;
            if ($props) {
                if (!empty($props)) {
                    foreach ($props as $prop) {
                        if ($prop["estado"] == 'H') {
                            $iProp++;
                            if (ltrim($prop["matriculapropietario"], "0") != '') {
                                if (ltrim($prop["codigocamara"], "0") == '') {
                                    $prop["codigocamara"] = CODIGO_EMPRESA;
                                }
                            }

                            //
                            $prop["fecmatprop"] = '';
                            $prop["fecrenprop"] = '';
                            $prop["ultanorenprop"] = '';
                            $prop["organizacionprop"] = '';
                            $prop["estadodatosprop"] = '';
                            $prop["estadomatriculaprop"] = '';
                            $prop["afiliacionprop"] = '';
                            $prop["ultanorenafliaprop"] = '';
                            $prop["saldoafliaprop"] = 0;
                            $prop["nombrereplegal"] = '';
                            $prop["identificacionreplegal"] = '';
                            $prop["tipoidentificacionreplegal"] = '';

                            //
                            if ($prop["codigocamara"] == CODIGO_EMPRESA) {
                                if (ltrim(trim($prop["matriculapropietario"]), "0") != '') {
                                    $xprop = retornarRegistroMysqliApi($mysqli, 'mreg_est_inscritos', "matricula='" . ltrim($prop["matriculapropietario"], "0") . "'");
                                    if ($xprop === false || empty($xprop)) {
                                        $prop["tipoidentificacion"] = '';
                                        $prop["identificacion"] = '';
                                        $prop["nit"] = '';
                                        $prop["razonsocial"] = '';
                                        $prop["nombre1"] = '';
                                        $prop["nombre2"] = '';
                                        $prop["apellido1"] = '';
                                        $prop["apellido2"] = '';
                                        $prop["dircom"] = '';
                                        $prop["muncom"] = '';
                                        $prop["dirnot"] = '';
                                        $prop["munnot"] = '';
                                        $prop["telcom1"] = '';
                                        $prop["telcom2"] = '';
                                        $prop["telcom3"] = '';
                                        $prop["fecmatprop"] = '';
                                        $prop["fecrenprop"] = '';
                                        $prop["ultanorenprop"] = '';
                                        $prop["organizacionprop"] = '';
                                        $prop["estadodatosprop"] = '';
                                        $prop["estadomatriculaprop"] = '';
                                        $prop["afiliacionprop"] = '';
                                        $prop["ultanorenafliaprop"] = '';
                                        $prop["saldoafliaprop"] = '';
                                        $prop["nombrereplegal"] = '';
                                        $prop["identificacionreplegal"] = '';
                                        $prop["tipoidentificacionreplegal"] = '';
                                    } else {
                                        $prop["tipoidentificacion"] = $xprop["idclase"];
                                        $prop["identificacion"] = $xprop["numid"];
                                        $prop["nit"] = $xprop["nit"];
                                        $prop["razonsocial"] = $xprop["razonsocial"];
                                        $prop["nombre1"] = $xprop["nombre1"];
                                        $prop["nombre2"] = $xprop["nombre2"];
                                        $prop["apellido1"] = $xprop["apellido1"];
                                        $prop["apellido2"] = $xprop["apellido2"];
                                        $prop["dircom"] = $xprop["dircom"];
                                        $prop["muncom"] = $xprop["muncom"];
                                        $prop["dirnot"] = $xprop["dirnot"];
                                        $prop["munnot"] = $xprop["munnot"];
                                        $prop["telcom1"] = $xprop["telcom1"];
                                        $prop["telcom2"] = $xprop["telcom2"];
                                        $prop["telcom3"] = $xprop["telcom3"];
                                        $prop["fecmatprop"] = $xprop["fecmatricula"];
                                        $prop["fecrenprop"] = $xprop["fecrenovacion"];
                                        $prop["ultanorenprop"] = $xprop["ultanoren"];
                                        $prop["organizacionprop"] = $xprop["organizacion"];
                                        $prop["estadodatosprop"] = $xprop["ctrestdatos"];
                                        $prop["estadomatriculaprop"] = $xprop["ctrestmatricula"];
                                        $prop["afiliacionprop"] = $xprop["ctrafiliacion"];
                                        $prop["ultanorenafliaprop"] = $xprop["anorenaflia"];
                                        $prop["saldoafliaprop"] = $xprop["saldoaflia"];

                                        $iXvincs = 0;
                                        $xvincs = retornarRegistrosMysqliApi($mysqli, 'mreg_est_vinculos', "matricula='" . $xprop["matricula"] . "' and estado = 'V'", "id");
                                        if ($xvincs) {
                                            if (!empty($xvincs)) {
                                                foreach ($xvincs as $xvin) {
                                                    if ($_SESSION["maestrovinculos"][$xvin["vinculo"]]["tipovinculo"] == 'RLP' ||
                                                            $_SESSION["maestrovinculos"][$xvin["vinculo"]]["tipovinculo"] == 'GER') {
                                                        $iXvincs++;
                                                        if ($iXvincs == 1) {
                                                            $prop["nombrereplegal"] = stripslashes($xvin["nombre"]);
                                                            $prop["identificacionreplegal"] = $xvin["idclase"];
                                                            $prop["tipoidentificacionreplegal"] = $xvin["numid"];
                                                        }
                                                        $iVinProp++;
                                                        $retorno["vincuprop"][$iVinProp] = array();
                                                        $retorno["vincuprop"][$iVinProp]["idclase"] = $xvin["idclase"];
                                                        $retorno["vincuprop"][$iVinProp]["numid"] = $xvin["numid"];
                                                        $retorno["vincuprop"][$iVinProp]["nombre"] = $xvin["nombre"];
                                                        $retorno["vincuprop"][$iVinProp]["vinculo"] = $xvin["vinculo"];
                                                        $retorno["vincuprop"][$iVinProp]["cargo"] = $xvin["descargo"];
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }

                            $retorno["propietariosh"][$iProp]["camarapropietario"] = $prop["codigocamara"];
                            $retorno["propietariosh"][$iProp]["matriculapropietario"] = ltrim($prop["matriculapropietario"], '0');
                            $retorno["propietariosh"][$iProp]["idtipoidentificacionpropietario"] = trim($prop["tipoidentificacion"]);
                            $retorno["propietariosh"][$iProp]["identificacionpropietario"] = ltrim($prop["identificacion"], '0');
                            $retorno["propietariosh"][$iProp]["nitpropietario"] = ltrim($prop["nit"], '0');
                            $retorno["propietariosh"][$iProp]["nombrepropietario"] = ($prop["razonsocial"]);
                            $retorno["propietariosh"][$iProp]["nom1propietario"] = ($prop["nombre1"]);
                            $retorno["propietariosh"][$iProp]["nom2propietario"] = ($prop["nombre2"]);
                            $retorno["propietariosh"][$iProp]["ape1propietario"] = ($prop["apellido1"]);
                            $retorno["propietariosh"][$iProp]["ape2propietario"] = ($prop["apellido2"]);
                            $retorno["propietariosh"][$iProp]["tipopropiedad"] = ($prop["tipopropiedad"]);
                            $retorno["propietariosh"][$iProp]["direccionpropietario"] = ($prop["dircom"]);
                            $retorno["propietariosh"][$iProp]["municipiopropietario"] = ($prop["muncom"]);
                            $retorno["propietariosh"][$iProp]["direccionnotpropietario"] = ($prop["dirnot"]);
                            $retorno["propietariosh"][$iProp]["municipionotpropietario"] = ($prop["munnot"]);
                            $retorno["propietariosh"][$iProp]["telefonopropietario"] = ($prop["telcom1"]);
                            $retorno["propietariosh"][$iProp]["telefono2propietario"] = ($prop["telcom2"]);
                            $retorno["propietariosh"][$iProp]["celularpropietario"] = ($prop["telcom3"]);
                            $retorno["propietariosh"][$iProp]["nomreplegpropietario"] = ($prop["nombrereplegal"]);
                            $retorno["propietariosh"][$iProp]["numidreplegpropietario"] = ($prop["identificacionreplegal"]);
                            $retorno["propietariosh"][$iProp]["tipoidreplegpropietario"] = ($prop["tipoidentificacionreplegal"]);

                            $retorno["propietariosh"][$iProp]["fecmatripropietario"] = '';
                            $retorno["propietariosh"][$iProp]["fecrenovpropietario"] = '';
                            $retorno["propietariosh"][$iProp]["ultanorenpropietario"] = '';
                            $retorno["propietariosh"][$iProp]["organizacionpropietario"] = '';
                            $retorno["propietariosh"][$iProp]["estadodatospropietario"] = '';
                            $retorno["propietariosh"][$iProp]["estadomatriculapropietario"] = '';
                            $retorno["propietariosh"][$iProp]["afiliacionpropietario"] = '';
                            $retorno["propietariosh"][$iProp]["ultanorenafipropietario"] = '';
                            $retorno["propietariosh"][$iProp]["saldoafiliadopropietario"] = '';

                            if (isset($prop["fecmatprop"])) {
                                $retorno["propietariosh"][$iProp]["fecmatripropietario"] = ($prop["fecmatprop"]);
                            }
                            if (isset($prop["fecrenprop"])) {
                                $retorno["propietariosh"][$iProp]["fecrenovpropietario"] = ($prop["fecrenprop"]);
                            }
                            if (isset($prop["ultanorenprop"])) {
                                $retorno["propietariosh"][$iProp]["ultanorenpropietario"] = ($prop["ultanorenprop"]);
                            }
                            if (isset($prop["organizacionprop"])) {
                                $retorno["propietariosh"][$iProp]["organizacionpropietario"] = ($prop["organizacionprop"]);
                            }
                            if (isset($prop["estadodatosprop"])) {
                                $retorno["propietariosh"][$iProp]["estadodatospropietario"] = ($prop["estadodatosprop"]);
                            }
                            if (isset($prop["estadomatriculaprop"])) {
                                $retorno["propietariosh"][$iProp]["estadomatriculapropietario"] = ($prop["estadomatriculaprop"]);
                            }
                            if (isset($prop["afiliacionprop"])) {
                                $retorno["propietariosh"][$iProp]["afiliacionpropietario"] = ($prop["afiliacionprop"]);
                            }
                            if (isset($prop["ultanorenafliaprop"])) {
                                $retorno["propietariosh"][$iProp]["ultanorenafipropietario"] = ($prop["ultanorenafliaprop"]);
                            }
                            if (isset($prop["saldoafliaprop"])) {
                                $retorno["propietariosh"][$iProp]["saldoafiliadopropietario"] = ($prop["saldoafliaprop"]);
                            }
                        }
                    }
                }
            }
        }

        // Vinculos de la casa principal, en caso de sucursales o agencias
        if ($retorno["organizacion"] > '02' && $retorno["categoria"] == '1') {
            if ($retorno["cpcodcam"] == '' || $retorno["cpcodcam"] == CODIGO_EMPRESA) {
                $iXvincs = 0;
                $xvincs = retornarRegistrosMysqliApi($mysqli, 'mreg_est_vinculos', "matricula='" . $retorno["cpnummat"] . "' and estado = 'V'", "id");
                if ($xvincs) {
                    if (!empty($xvincs)) {
                        foreach ($xvincs as $xvin) {
                            if ($_SESSION["maestrovinculos"][$xvin["vinculo"]]["tipovinculo"] == 'RLP' ||
                                    $_SESSION["maestrovinculos"][$xvin["vinculo"]]["tipovinculo"] == 'GER') {
                                $iXvincs++;
                                if ($iXvincs == 1) {
                                    $prop["nombrereplegal"] = stripslashes($xvin["nombre"]);
                                    $prop["identificacionreplegal"] = $xvin["idclase"];
                                    $prop["tipoidentificacionreplegal"] = $xvin["numid"];
                                }
                                $iVinProp++;
                                $retorno["vincuprop"][$iVinProp] = array();
                                $retorno["vincuprop"][$iVinProp]["idclase"] = $xvin["idclase"];
                                $retorno["vincuprop"][$iVinProp]["numid"] = $xvin["numid"];
                                $retorno["vincuprop"][$iVinProp]["nombre"] = $xvin["nombre"];
                                $retorno["vincuprop"][$iVinProp]["vinculo"] = $xvin["vinculo"];
                                $retorno["vincuprop"][$iVinProp]["cargo"] = $xvin["descargo"];
                            }
                        }
                    }
                }
            }
        }

        // \logApi::general2($nameLog, $retorno["matricula"], 'Entró a relación establecimientos : ' . date("His"));
        // Relación de establecimientos
        $retorno["establecimientos"] = array();
        if ($retorno["organizacion"] != '02' && (trim($retorno["categoria"]) == '' || $retorno["categoria"] == '0' || $retorno["categoria"] == '1')) {
            $in = "'" . ltrim(trim($retorno["matricula"]), "0") . "'";
            $in .= ",'" . sprintf("%08s", ltrim(trim($retorno["matricula"]), "0")) . "'";
            $arrX = retornarRegistrosMysqliApi($mysqli, 'mreg_est_propietarios', "matriculapropietario IN (" . $in . ")", "matricula");
            if ($arrX === false) {
                echo $_SESSION["generales"]["mensajeerror"];
            }
            if ($arrX && !empty($arrX)) {
                $ix = 0;
                foreach ($arrX as $x) {
                    if (ltrim(trim($x["matricula"]), "0") != '') {
                        if ($x["estado"] != 'H') {
                            if ($x["codigocamara"] == '' || $x["codigocamara"] == CODIGO_EMPRESA) {
                                $temEst = retornarRegistroMysqliApi($mysqli, 'mreg_est_inscritos', "matricula='" . $x["matricula"] . "'");
                                if ($temEst["ctrestmatricula"] == 'MA' || $temEst["ctrestmatricula"] == 'MI') {
                                    if ($temEst["organizacion"] == '02') {
                                        $ix++;
                                        $retorno["establecimientos"][$ix]["matriculaestablecimiento"] = $x["matricula"];
                                        $retorno["establecimientos"][$ix]["nombreestablecimiento"] = $temEst["razonsocial"];
                                        $retorno["establecimientos"][$ix]["estadodatosestablecimiento"] = $temEst["ctrestmatricula"];
                                        $retorno["establecimientos"][$ix]["estadomatricula"] = $temEst["ctrestmatricula"];
                                        $retorno["establecimientos"][$ix]["dircom"] = $temEst["dircom"];
                                        $retorno["establecimientos"][$ix]["barriocom"] = $temEst["barriocom"];
                                        $retorno["establecimientos"][$ix]["telcom1"] = $temEst["telcom1"];
                                        $retorno["establecimientos"][$ix]["telcom2"] = $temEst["telcom2"];
                                        $retorno["establecimientos"][$ix]["telcom3"] = $temEst["telcom3"];
                                        $retorno["establecimientos"][$ix]["muncom"] = $temEst["muncom"];
                                        $retorno["establecimientos"][$ix]["emailcom"] = $temEst["emailcom"];
                                        $retorno["establecimientos"][$ix]["fechamatricula"] = $temEst["fecmatricula"];
                                        $retorno["establecimientos"][$ix]["fecharenovacion"] = $temEst["fecrenovacion"];
                                        $retorno["establecimientos"][$ix]["ultanoren"] = $temEst["ultanoren"];
                                        $retorno["establecimientos"][$ix]["actvin"] = $temEst["actvin"];
                                        $retorno["establecimientos"][$ix]["ciiu1"] = $temEst["ciiu1"];
                                        $retorno["establecimientos"][$ix]["ciiu2"] = $temEst["ciiu2"];
                                        $retorno["establecimientos"][$ix]["ciiu3"] = $temEst["ciiu3"];
                                        $retorno["establecimientos"][$ix]["ciiu4"] = $temEst["ciiu4"];
                                        $retorno["establecimientos"][$ix]["embargado"] = 'NO';
                                        $retorno["establecimientos"][$ix]["embargos"] = array();

                                        $temE = retornarRegistrosMysqliApi($mysqli, 'mreg_est_embargos', "matricula='" . trim($x["matricula"]) . "' and acto IN ('0900','0940','0991','1000','1040') and ctrestadoembargo='1'");
                                        if ($temE && !empty($temE)) {
                                            $iEmb = 0;
                                            foreach ($temE as $e) {
                                                $retorno["establecimientos"][$ix]["embargado"] = 'SI';
                                                $iEmb++;
                                                $retorno["establecimientos"][$ix]["embargos"][$iEmb]["libroembargo"] = $e["libro"];
                                                $retorno["establecimientos"][$ix]["embargos"][$iEmb]["registroembargo"] = $e["numreg"];
                                                $retorno["establecimientos"][$ix]["embargos"][$iEmb]["fechaembargo"] = $e["fecinscripcion"];
                                                $retorno["establecimientos"][$ix]["embargos"][$iEmb]["txtorigenembargo"] = $e["txtorigen"];
                                            }
                                        }

                                        $retorno["establecimientos"][$ix]["valest"] = $temEst["actvin"];
                                        $retorno["establecimientos"][$ix]["tipopropiedad"] = '';
                                        $retorno["establecimientos"][$ix]["ideadministrador"] = '';
                                        $retorno["establecimientos"][$ix]["nombreadministrador"] = '';
                                        $retorno["establecimientos"][$ix]["idearrendatario"] = '';
                                        $retorno["establecimientos"][$ix]["nombrearrendatario"] = '';

                                        $temE = retornarRegistrosMysqliApi($mysqli, 'mreg_est_vinculos', "matricula='" . $x["matricula"] . "' and estado='V'", "vinculo");
                                        if ($temE && !empty($temE)) {
                                            foreach ($temE as $tx) {
                                                if ($_SESSION["maestrovinculos"][$tx["vinculo"]]["tipovinculo"] == 'ADMP') {
                                                    $retorno["establecimientos"][$ix]["ideadministrador"] = $tx["numid"];
                                                    $retorno["establecimientos"][$ix]["nombreadministrador"] = $tx["nombre"];
                                                }
                                                if ($_SESSION["maestrovinculos"][$tx["vinculo"]]["tipovinculo"] == 'ARR') {
                                                    $retorno["establecimientos"][$ix]["idearrendatario"] = $tx["numid"];
                                                    $retorno["establecimientos"][$ix]["nombrearrendatario"] = $tx["nombre"];
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            unset($arrX);
        }
        // \logApi::general2($nameLog, $retorno["matricula"], 'Salió de relación establecimientos : ' . date("His"));
        //2017-11-22 WSIERRA:         
        //Establecimientos que ha tenido una matricula propietaria
        // \logApi::general2($nameLog, $retorno["matricula"], 'Entró a relación establecimientosh : ' . date("His"));
        $retorno["establecimientosh"] = array();

        if ($retorno["organizacion"] != '02' && (trim($retorno["categoria"]) == '' || $retorno["categoria"] == '0' || $retorno["categoria"] == '1')) {
            $in = "'" . ltrim(trim($retorno["matricula"]), "0") . "'";
            $in .= ",'" . sprintf("%08s", ltrim(trim($retorno["matricula"]), "0")) . "'";
            $arrX = retornarRegistrosMysqliApi($mysqli, 'mreg_est_propietarios', "matriculapropietario IN (" . $in . ")", "matricula");
            if ($arrX === false) {
                echo $_SESSION["generales"]["mensajeerror"];
            }
            if ($arrX && !empty($arrX)) {
                $ix = 0;
                foreach ($arrX as $x) {
                    if (ltrim(trim($x["matricula"]), "0") != '') {
                        if ($x["estado"] != 'H') {
                            if ($x["codigocamara"] == '' || $x["codigocamara"] == CODIGO_EMPRESA) {
                                $temEst = retornarRegistroMysqliApi($mysqli, 'mreg_est_inscritos', "matricula='" . $x["matricula"] . "'");
                                if ($temEst["ctrestmatricula"] == 'MC' || $temEst["ctrestmatricula"] == 'MF') {
                                    if ($temEst["organizacion"] == '02') {
                                        $ix++;
                                        $retorno["establecimientosh"][$ix]["matriculaestablecimiento"] = $x["matricula"];
                                        $retorno["establecimientosh"][$ix]["nombreestablecimiento"] = $temEst["razonsocial"];
                                        $retorno["establecimientosh"][$ix]["estadodatosestablecimiento"] = $temEst["ctrestmatricula"];
                                        $retorno["establecimientosh"][$ix]["estadomatricula"] = $temEst["ctrestmatricula"];
                                        $retorno["establecimientosh"][$ix]["dircom"] = $temEst["dircom"];
                                        $retorno["establecimientosh"][$ix]["barriocom"] = $temEst["barriocom"];
                                        $retorno["establecimientosh"][$ix]["telcom1"] = $temEst["telcom1"];
                                        $retorno["establecimientosh"][$ix]["telcom2"] = $temEst["telcom2"];
                                        $retorno["establecimientosh"][$ix]["telcom3"] = $temEst["telcom3"];
                                        $retorno["establecimientosh"][$ix]["muncom"] = $temEst["muncom"];
                                        $retorno["establecimientosh"][$ix]["emailcom"] = $temEst["emailcom"];
                                        $retorno["establecimientosh"][$ix]["fechamatricula"] = $temEst["fecmatricula"];
                                        $retorno["establecimientosh"][$ix]["fecharenovacion"] = $temEst["fecrenovacion"];
                                        $retorno["establecimientosh"][$ix]["fechacancelacion"] = $temEst["feccancelacion"];
                                        $retorno["establecimientosh"][$ix]["ultanoren"] = $temEst["ultanoren"];
                                        $retorno["establecimientosh"][$ix]["actvin"] = $temEst["actvin"];
                                        $retorno["establecimientosh"][$ix]["ciiu1"] = $temEst["ciiu1"];
                                        $retorno["establecimientosh"][$ix]["ciiu2"] = $temEst["ciiu2"];
                                        $retorno["establecimientosh"][$ix]["ciiu3"] = $temEst["ciiu3"];
                                        $retorno["establecimientosh"][$ix]["ciiu4"] = $temEst["ciiu4"];
                                    }
                                }
                            }
                        }
                    }
                }
            }
            unset($arrX);
        }
        // \logApi::general2($nameLog, $retorno["matricula"], 'Salió de relación establecimientosh : ' . date("His"));
        // Relación de sucursales y agencias
        // \logApi::general2($nameLog, $retorno["matricula"], 'Entró a relación suc/age : ' . date("His"));
        $retorno["sucursalesagencias"] = array();
        if ($retorno["organizacion"] == '01' ||
                ($retorno["organizacion"] > '02' && $retorno["categoria"] == '1')) {
            $camposRequeridos = 'matricula,razonsocial,categoria,ctrestmatricula,fecmatricula,fecrenovacion,ultanoren,dircom,muncom,telcom1,telcom2,telcom3,emailcom,ciiu1,ciiu2,ciiu3,ciiu4,actvin';

            $arrX = retornarRegistrosMysqliApi($mysqli, 'mreg_est_inscritos', "cpcodcam='" . CODIGO_EMPRESA . "' and cpnummat IN ('" . sprintf("%08s", $reg["matricula"]) . "','" . ltrim($reg["matricula"], "0") . "')", "matricula", $camposRequeridos);
            if ($arrX && !empty($arrX)) {
                $ix = 0;
                foreach ($arrX as $x) {
                    $ix++;
                    $retorno["sucursalesagencias"][$ix]["matriculasucage"] = $x["matricula"];
                    $retorno["sucursalesagencias"][$ix]["nombresucage"] = $x["razonsocial"];
                    $retorno["sucursalesagencias"][$ix]["categoria"] = $x["categoria"];
                    $retorno["sucursalesagencias"][$ix]["estado"] = $x["ctrestmatricula"];
                    $retorno["sucursalesagencias"][$ix]["fechamatricula"] = $x["fecmatricula"];
                    $retorno["sucursalesagencias"][$ix]["fecharenovacion"] = $x["fecrenovacion"];
                    $retorno["sucursalesagencias"][$ix]["ultanoren"] = $x["ultanoren"];
                    $retorno["sucursalesagencias"][$ix]["dircom"] = $x["dircom"];
                    $retorno["sucursalesagencias"][$ix]["muncom"] = $x["muncom"];
                    $retorno["sucursalesagencias"][$ix]["telcom1"] = $x["telcom1"];
                    $retorno["sucursalesagencias"][$ix]["telcom2"] = $x["telcom2"];
                    $retorno["sucursalesagencias"][$ix]["telcom3"] = $x["telcom3"];
                    $retorno["sucursalesagencias"][$ix]["emailcom"] = $x["emailcom"];
                    $retorno["sucursalesagencias"][$ix]["ciiu1"] = $x["ciiu1"];
                    $retorno["sucursalesagencias"][$ix]["ciiu2"] = $x["ciiu2"];
                    $retorno["sucursalesagencias"][$ix]["ciiu3"] = $x["ciiu3"];
                    $retorno["sucursalesagencias"][$ix]["ciiu4"] = $x["ciiu4"];
                    $retorno["sucursalesagencias"][$ix]["embargado"] = 'NO';

                    $retorno["sucursalesagencias"][$ix]["libro1embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["registro1embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["fecha1embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["txtorigen1embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["libro2embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["registro2embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["fecha2embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["txtorigen2embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["libro3embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["registro3embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["fecha3embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["txtorigen3embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["libro4embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["registro4embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["fecha4embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["txtorigen4embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["libro5embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["registro5embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["fecha5embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["txtorigen5embargo"] = '';
                    $retorno["sucursalesagencias"][$ix]["embargado"] = 'NO';
                    $retorno["sucursalesagencias"][$ix]["embargos"] = array();

                    $temE = retornarRegistrosMysqliApi($mysqli, 'mreg_est_embargos', "matricula='" . trim($x["matricula"]) . "' and acto IN ('0900','0940','0991','1000','1040') and ctrestadoembargo='1'");
                    if ($temE && !empty($temE)) {
                        $iEmb = 0;
                        foreach ($temE as $e) {
                            $retorno["sucursalesagencias"][$ix]["embargado"] = 'SI';
                            $iEmb++;
                            $retorno["sucursalesagencias"][$ix]["embargos"][$iEmb]["libroembargo"] = $e["libro"];
                            $retorno["sucursalesagencias"][$ix]["embargos"][$iEmb]["registroembargo"] = $e["numreg"];
                            $retorno["sucursalesagencias"][$ix]["embargos"][$iEmb]["fechaembargo"] = $e["fecinscripcion"];
                            $retorno["sucursalesagencias"][$ix]["embargos"][$iEmb]["txtorigenembargo"] = $e["txtorigen"];
                        }
                    }

                    $retorno["sucursalesagencias"][$ix]["actvin"] = $x["actvin"];
                }
            }
            unset($arrX);
        }
        // \logApi::general2($nameLog, $retorno["matricula"], 'Salió de relación suc/age : ' . date("His"));
        // Relación de establecimientos arrendados
        // \logApi::general2($nameLog, $retorno["matricula"], 'Entró a establecimientos arrendados : ' . date("His"));
        $retorno["establecimientosarrendados"] = array();
        if ($retorno["organizacion"] != '02' && (trim($retorno["categoria"]) == '' || $retorno["categoria"] == '0' || $retorno["categoria"] == '1')) {
            if ($retorno["identificacion"] != '') {
                $arrX = retornarRegistrosMysqliApi($mysqli, 'mreg_est_vinculos', "numid='" . $retorno["identificacion"] . "'", "matricula");
                if ($arrX === false) {
                    echo $_SESSION["generales"]["mensajeerror"];
                }
                if ($arrX && !empty($arrX)) {
                    $ix = 0;
                    foreach ($arrX as $x) {
                        if ($_SESSION["maestrovinculos"][$x["vinculo"]]["tipovinculo"] == 'ARR') {
                            if (ltrim(trim($x["matricula"]), "0") != '') {
                                if ($x["estado"] != 'H') {
                                    $temEst = retornarRegistroMysqliApi($mysqli, 'mreg_est_inscritos', "matricula='" . $x["matricula"] . "'");
                                    if ($temEst["ctrestmatricula"] == 'MA' || $temEst["ctrestmatricula"] == 'MI') {
                                        if ($temEst["organizacion"] == '02') {
                                            $ix++;
                                            $retorno["establecimientosarrendados"][$ix]["matricula"] = $x["matricula"];
                                            $retorno["establecimientosarrendados"][$ix]["nombre"] = $temEst["razonsocial"];
                                            $retorno["establecimientosarrendados"][$ix]["estadodatos"] = $temEst["ctrestmatricula"];
                                            $retorno["establecimientosarrendados"][$ix]["estadomatricula"] = $temEst["ctrestmatricula"];
                                            $retorno["establecimientosarrendados"][$ix]["dircom"] = $temEst["dircom"];
                                            $retorno["establecimientosarrendados"][$ix]["barriocom"] = $temEst["barriocom"];
                                            $retorno["establecimientosarrendados"][$ix]["telcom1"] = $temEst["telcom1"];
                                            $retorno["establecimientosarrendados"][$ix]["telcom2"] = $temEst["telcom2"];
                                            $retorno["establecimientosarrendados"][$ix]["telcom3"] = $temEst["telcom3"];
                                            $retorno["establecimientosarrendados"][$ix]["muncom"] = $temEst["muncom"];
                                            $retorno["establecimientosarrendados"][$ix]["emailcom"] = $temEst["emailcom"];
                                            $retorno["establecimientosarrendados"][$ix]["fechamatricula"] = $temEst["fecmatricula"];
                                            $retorno["establecimientosarrendados"][$ix]["fecharenovacion"] = $temEst["fecrenovacion"];
                                            $retorno["establecimientosarrendados"][$ix]["ultanoren"] = $temEst["ultanoren"];
                                            $retorno["establecimientosarrendados"][$ix]["actvin"] = $temEst["actvin"];
                                            $retorno["establecimientosarrendados"][$ix]["ciiu1"] = $temEst["ciiu1"];
                                            $retorno["establecimientosarrendados"][$ix]["ciiu2"] = $temEst["ciiu2"];
                                            $retorno["establecimientosarrendados"][$ix]["ciiu3"] = $temEst["ciiu3"];
                                            $retorno["establecimientosarrendados"][$ix]["ciiu4"] = $temEst["ciiu4"];
                                            $retorno["establecimientosarrendados"][$ix]["valest"] = $temEst["actvin"];
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            unset($arrX);
        }
        // \logApi::general2($nameLog, $retorno["matricula"], 'Salió de establecimientos arrendados : ' . date("His"));
        //  if ($tipodata == 'E') {
        // Relación de establecimientos nacionales 
        // \logApi::general2($nameLog, $retorno["matricula"], 'Entró a establecimientos nacionales : ' . date("His"));

        $retorno["establecimientosnacionales"] = array();
        if ($tipodata == 'E') {
            if ($retorno["organizacion"] == '01' || $retorno["organizacion"] > '02' && $retorno["categoria"] == '1') {
                $ests = \funcionesGenerales::consultarEstablecimientosNacionales($mysqli, $retorno["tipoidentificacion"], $retorno["identificacion"]);
                if (!empty($ests)) {
                    $ix = 0;

                    foreach ($ests as $x) {
                        if ($x["codigo_estado_matricula"] == '01') { // Solo establecimientos activos
                            if ($x["codigo_camara"] != CODIGO_EMPRESA) { // Solo si son de una cámara diferente
                                $ix++;

                                //
                                $retorno["establecimientosnacionales"][$ix]["cc"] = trim($x["codigo_camara"]);
                                $retorno["establecimientosnacionales"][$ix]["matriculaestablecimiento"] = ltrim($x["matricula"], "0");
                                $retorno["establecimientosnacionales"][$ix]["nombreestablecimiento"] = trim($x["razon_social"]);
                                $retorno["establecimientosnacionales"][$ix]["estadodatosestablecimiento"] = '6';
                                $retorno["establecimientosnacionales"][$ix]["estadomatricula"] = 'MA';
                                $retorno["establecimientosnacionales"][$ix]["organizacion"] = trim($x["codigo_organizacion_juridica"]);
                                $retorno["establecimientosnacionales"][$ix]["categoria"] = trim($x["codigo_categoria_matricula"]);

                                //
                                $retorno["establecimientosnacionales"][$ix]["dircom"] = trim($x["direccion_comercial"]);
                                $retorno["establecimientosnacionales"][$ix]["barriocom"] = trim($x["codigo_barrio_comercial"]);
                                $retorno["establecimientosnacionales"][$ix]["nbarriocom"] = trim($x["barrio_comercial"]);
                                $retorno["establecimientosnacionales"][$ix]["telcom1"] = trim($x["telefono_comercial_1"]);
                                $retorno["establecimientosnacionales"][$ix]["telcom2"] = trim($x["telefono_comercial_2"]);
                                $retorno["establecimientosnacionales"][$ix]["telcom3"] = trim($x["telefono_comercial_3"]);
                                $retorno["establecimientosnacionales"][$ix]["muncom"] = trim($x["municipio_comercial"]);
                                $retorno["establecimientosnacionales"][$ix]["nmuncom"] = trim($x["nombre_municipio_comercial"]);
                                $retorno["establecimientosnacionales"][$ix]["emailcom"] = trim($x["correo_electronico_comercial"]);
                                $retorno["establecimientosnacionales"][$ix]["codpostalcom"] = trim($x["codigo_postal_comercial"]);

                                //
                                $retorno["establecimientosnacionales"][$ix]["dirnot"] = trim($x["direccion_fiscal"]);
                                $retorno["establecimientosnacionales"][$ix]["barrionot"] = trim($x["codigo_barrio_fiscal"]);
                                $retorno["establecimientosnacionales"][$ix]["nbarrionot"] = trim($x["barrio_fiscal"]);
                                $retorno["establecimientosnacionales"][$ix]["telnot1"] = '';
                                $retorno["establecimientosnacionales"][$ix]["telnot2"] = '';
                                $retorno["establecimientosnacionales"][$ix]["telnot3"] = '';
                                $retorno["establecimientosnacionales"][$ix]["munnot"] = trim($x["municipio_fiscal"]);
                                $retorno["establecimientosnacionales"][$ix]["nmunnot"] = trim($x["nombre_municipio_fiscal"]);
                                $retorno["establecimientosnacionales"][$ix]["emailnor"] = trim($x["correo_electronico_fiscal"]);
                                $retorno["establecimientosnacionales"][$ix]["codpostalnot"] = trim($x["codigo_postal_fiscal"]);

                                //
                                $retorno["establecimientosnacionales"][$ix]["fechamatricula"] = trim($x["fecha_matricula"]);
                                $retorno["establecimientosnacionales"][$ix]["fecharenovacion"] = trim($x["fecha_renovacion"]);
                                $retorno["establecimientosnacionales"][$ix]["fechacancelacion"] = '';
                                $retorno["establecimientosnacionales"][$ix]["ultanoren"] = trim($x["ultimo_ano_renovado"]);
                                $retorno["establecimientosnacionales"][$ix]["actvin"] = doubleval($x["valor_est_ag_suc"]);
                                $retorno["establecimientosnacionales"][$ix]["empleados"] = doubleval($x["empleados"]);

                                //
                                $retorno["establecimientosnacionales"][$ix]["ciiu1"] = '';
                                $retorno["establecimientosnacionales"][$ix]["ciiu2"] = '';
                                $retorno["establecimientosnacionales"][$ix]["ciiu3"] = '';
                                $retorno["establecimientosnacionales"][$ix]["ciiu4"] = '';
                                $retorno["establecimientosnacionales"][$ix]["shd1"] = '';
                                $retorno["establecimientosnacionales"][$ix]["shd2"] = '';
                                $retorno["establecimientosnacionales"][$ix]["shd3"] = '';
                                $retorno["establecimientosnacionales"][$ix]["shd4"] = '';
                                if (trim($x["ciiu1"]) != '') {
                                    $retorno["establecimientosnacionales"][$ix]["ciiu1"] = retornarRegistroMysqliApi($mysqli, "bas_ciius", "idciiunum='" . trim($x["ciiu1"]) . "'", "idciiu");
                                }
                                if (trim($x["ciiu2"]) != '') {
                                    $retorno["establecimientosnacionales"][$ix]["ciiu2"] = retornarRegistroMysqliApi($mysqli, "bas_ciius", "idciiunum='" . trim($x["ciiu2"]) . "'", "idciiu");
                                }
                                if (trim($x["ciiu3"]) != '') {
                                    $retorno["establecimientosnacionales"][$ix]["ciiu3"] = retornarRegistroMysqliApi($mysqli, "bas_ciius", "idciiunum='" . trim($x["ciiu3"]) . "'", "idciiu");
                                }
                                if (trim($x["ciiu4"]) != '') {
                                    $retorno["establecimientosnacionales"][$ix]["ciiu4"] = retornarRegistroMysqliApi($mysqli, "bas_ciius", "idciiunum='" . trim($x["ciiu4"]) . "'", "idciiu");
                                }
                                if (trim($x["shd1"]) != '') {
                                    $retorno["establecimientosnacionales"][$ix]["shd1"] = $x["shd1"];
                                }
                                if (trim($x["shd2"]) != '') {
                                    $retorno["establecimientosnacionales"][$ix]["shd2"] = $x["shd2"];
                                }
                                if (trim($x["shd3"]) != '') {
                                    $retorno["establecimientosnacionales"][$ix]["shd3"] = $x["shd3"];
                                }
                                if (trim($x["shd4"]) != '') {
                                    $retorno["establecimientosnacionales"][$ix]["shd4"] = $x["shd4"];
                                }
                                $retorno["establecimientosnacionales"][$ix]["desactiv"] = trim($x["desc_Act_Econ"]);

                                //
                                $retorno["establecimientosnacionales"][$ix]["afiliado"] = trim($x["afiliado"]);
                                $retorno["establecimientosnacionales"][$ix]["tipolocal"] = trim($x["codigo_tipo_local"]);
                                $retorno["establecimientosnacionales"][$ix]["ctrubi"] = trim($x["codigo_ubicacion_empresa"]);
                            }
                        }
                    }
                }
            }
        }

        $retorno["rr"] = array();
        $retorno["lcodigosbarras"] = array();
        $arrX = retornarRegistrosMysqliApi($mysqli, 'mreg_est_codigosbarras', "matricula='" . $reg["matricula"] . "'", "codigobarras");
        $ix = 0;
        $irr = 0;
        if ($arrX && !empty($arrX)) {
            foreach ($arrX as $x) {
                if ($x["estadofinal"] == '01' || // Radicado
                        $x["estadofinal"] == '04' || // En estudio
                        $x["estadofinal"] == '09' || // Reingresado
                        $x["estadofinal"] == '10' || // Devuelto a reparto
                        $x["estadofinal"] == '11' || // Inscrito
                        $x["estadofinal"] == '13' || // Asignado a estudio
                        $x["estadofinal"] == '22' || // Registrado - proponentes
                        $x["estadofinal"] == '23' || // En digitacion
                        $x["estadofinal"] == '34' || // Para firma
                        $x["estadofinal"] == '35' || // Firmado
                        $x["estadofinal"] == '38' // Control de calidad
                ) {
                    $ix++;
                    $retorno["lcodigosbarras"][$ix]["cbar"] = $x["codigobarras"];
                    $retorno["lcodigosbarras"][$ix]["frad"] = $x["fecharadicacion"];
                    $retorno["lcodigosbarras"][$ix]["ttra"] = $x["actoreparto"];
                    $retorno["lcodigosbarras"][$ix]["esta"] = $x["estadofinal"];
                    $retorno["lcodigosbarras"][$ix]["nesta"] = '';
                    $retorno["lcodigosbarras"][$ix]["ntra"] = retornarRegistroMysqliApi($mysqli, 'mreg_codrutas', "id='" . $retorno["lcodigosbarras"][$ix]["ttra"] . "'", "descripcion");
                    $retorno["lcodigosbarras"][$ix]["sist"] = retornarRegistroMysqliApi($mysqli, 'mreg_codrutas', "id='" . $retorno["lcodigosbarras"][$ix]["ttra"] . "'", "tipo");
                    if (($retorno["lcodigosbarras"][$ix]["sist"] == 'ME') || ($retorno["lcodigosbarras"][$ix]["sist"] == 'ES') ||
                            ($retorno["lcodigosbarras"][$ix]["sist"] == 'RM') || ($retorno["lcodigosbarras"][$ix]["sist"] == 'RE')) {
                        $retorno["lcodigosbarras"][$ix]["nesta"] = retornarRegistroMysqliApi($mysqli, 'mreg_codestados_rutamercantil', "id='" . $retorno["lcodigosbarras"][$ix]["esta"] . "'", "descripcion");
                    }
                    if ($retorno["lcodigosbarras"][$ix]["sist"] == 'PR') {
                        $retorno["lcodigosbarras"][$ix]["nesta"] = retornarRegistroMysqliApi($mysqli, 'mreg_codestados_rutaproponentes', "id='" . $retorno["lcodigosbarras"][$ix]["esta"] . "'", "descripcion");
                    }
                    $retorno["codigosbarras"] ++;

                    // Si la ruta es un embargo
                    if ($x["actoreparto"] == '07') {
                        $retorno["embargostramite"] = 'S';
                    }

                    // Si la ruta es un recurso en trámite
                    if ($x["actoreparto"] == '19' || $x["actoreparto"] == '23' || $x["actoreparto"] == '54') {
                        $retorno["recursostramite"] = 'S';
                        $irr++;
                        $retorno["rr"][$irr] = array();
                        $retorno["rr"][$irr]["codigobarras"] = $x["codigobarras"];
                        $retorno["rr"][$irr]["fecharadicacion"] = $x["fecharadicacion"];
                        $retorno["rr"][$irr]["detalle"] = $x["detalle"];
                        $retorno["rr"][$irr]["tipodocrecurso"] = '';
                        $retorno["rr"][$irr]["numdocrecurso"] = '';
                        $retorno["rr"][$irr]["fecdocrecurso"] = '';
                        $retorno["rr"][$irr]["idclaserecurrente"] = '';
                        $retorno["rr"][$irr]["numidrecurrente"] = '';
                        $retorno["rr"][$irr]["nombrerecurrente"] = '';
                        $retorno["rr"][$irr]["tipodocafectado"] = '';
                        $retorno["rr"][$irr]["numdocafectado"] = '';
                        $retorno["rr"][$irr]["fecdocafectado"] = '';
                        $retorno["rr"][$irr]["libroafectado"] = '';
                        $retorno["rr"][$irr]["registroafectado"] = '';
                        $retorno["rr"][$irr]["dupliafectado"] = '';
                        $retorno["rr"][$irr]["subsidioapelacion"] = '';
                        $retorno["rr"][$irr]["noticiarecurrida"] = '';
                        if (isset($x["idclaserecurrente"])) {
                            $retorno["rr"][$irr]["tipodocrecurso"] = $x["tipdoc"];
                            $retorno["rr"][$irr]["numdocrecurso"] = $x["numdoc"];
                            $retorno["rr"][$irr]["fecdocrecurso"] = $x["fecdoc"];
                            $retorno["rr"][$irr]["idclaserecurrente"] = $x["idclaserecurrente"];
                            $retorno["rr"][$irr]["numidrecurrente"] = $x["numidrecurrente"];
                            $retorno["rr"][$irr]["nombrerecurrente"] = $x["nombrerecurrente"];
                            $retorno["rr"][$irr]["libroafectado"] = $x["libroafectado"];
                            $retorno["rr"][$irr]["registroafectado"] = $x["registroafectado"];
                            $retorno["rr"][$irr]["dupliafectado"] = $x["dupliafectado"];
                            $retorno["rr"][$irr]["subsidioapelacion"] = $x["subsidioapelacion"];
                            if ($x["libroafectado"] != '' && $x["registroafectado"] != '' && $x["dupliafectado"] != '') {
                                $condx = "libro='" . $x["libroafectado"] . "' and registro='" . $x["registroafectado"] . "' and dupli='" . $x["dupliafectado"] . "'";
                                $libx = retornarRegistroMysqliApi($mysqli, 'mreg_est_inscripciones', $condx);
                                if ($libx && !empty($libx)) {
                                    $retorno["rr"][$irr]["tipodocafectado"] = $libx["tipodocumento"];
                                    $retorno["rr"][$irr]["numdocafectado"] = $libx["numerodocumento"];
                                    $retorno["rr"][$irr]["fecdocafectado"] = $libx["fechadocumento"];
                                    $retorno["rr"][$irr]["noticiarecurrida"] = $libx["noticia"];
                                }
                            }
                        }
                    }
                }
            }
        }

        // \logApi::general2($nameLog, $retorno["matricula"], 'Salió de codbarras pendientes : ' . date("His"));
        // Relación de inscripciones
        // \logApi::general2($nameLog, $retorno["matricula"], 'Entró a inscripciones : ' . date("His"));
        $retorno["inscripciones"] = array();
        $retorno["inscripcioneslibros"] = array();
        $ix = 0;
        $ixl = 0;

        //
        $enliquidacion = 'no';
        $enreestructuracion = 'no';
        $enreorganizacion = 'no';
        $enliquidacionjudicial = 'no';
        $enliquidacionforsoza = 'no';

        //
        $arrX = retornarRegistrosMysqliApi($mysqli, 'mreg_est_inscripciones', "matricula='" . ltrim(trim($reg["matricula"]), "0") . "'", "fecharegistro,libro,registro,dupli");
        if ($arrX && !empty($arrX)) {
            foreach ($arrX as $x) {
                $ix++;
                // 2017-11-08: JINT: Se incluye control de revocación solo a partir del 2017
                // dado que en SIREP este no está bien manejado y pone problemas con
                // inscripciones antiguas
                if ($x["fecharegistro"] < '20170101' && $x["ctrrevoca"] == '1') {
                    $x["ctrrevoca"] = '0';
                }
                if ($x["ctrrevoca"] != '1') {
                    $retorno["inscripciones"][$ix] = array();
                    $retorno["inscripciones"][$ix]["lib"] = $x["libro"];
                    $retorno["inscripciones"][$ix]["nreg"] = $x["registro"];
                    $retorno["inscripciones"][$ix]["dupli"] = $x["dupli"];
                    $retorno["inscripciones"][$ix]["freg"] = $x["fecharegistro"];
                    $retorno["inscripciones"][$ix]["hreg"] = $x["horaregistro"];
                    $retorno["inscripciones"][$ix]["frad"] = $x["fecharadicacion"];
                    $retorno["inscripciones"][$ix]["cb"] = $x["idradicacion"];
                    $retorno["inscripciones"][$ix]["rec"] = $x["recibo"];
                    $retorno["inscripciones"][$ix]["nope"] = $x["numerooperacion"];
                    $retorno["inscripciones"][$ix]["ope"] = $x["operador"];
                    $retorno["inscripciones"][$ix]["acto"] = $x["acto"];
                    $retorno["inscripciones"][$ix]["idclase"] = $x["tipoidentificacion"];
                    $retorno["inscripciones"][$ix]["numid"] = $x["identificacion"];
                    $retorno["inscripciones"][$ix]["nombre"] = $x["nombre"];
                    $retorno["inscripciones"][$ix]["ndocext"] = $x["numdocextenso"];
                    $retorno["inscripciones"][$ix]["ndoc"] = $x["numerodocumento"];
                    $retorno["inscripciones"][$ix]["tdoc"] = $x["tipodocumento"];
                    $retorno["inscripciones"][$ix]["fdoc"] = $x["fechadocumento"];
                    $retorno["inscripciones"][$ix]["idoridoc"] = $x["idorigendoc"];
                    $retorno["inscripciones"][$ix]["txoridoc"] = $x["origendocumento"];
                    $retorno["inscripciones"][$ix]["idmunidoc"] = $x["municipiodocumento"];
                    $retorno["inscripciones"][$ix]["idpaidoc"] = $x["paisdocumento"];
                    $retorno["inscripciones"][$ix]["tipolibro"] = $x["tipolibro"];
                    $retorno["inscripciones"][$ix]["idlibvii"] = $x["idcodlibro"];
                    $retorno["inscripciones"][$ix]["codlibcom"] = $x["codigolibro"];
                    $retorno["inscripciones"][$ix]["deslib"] = $x["descripcionlibro"];
                    $retorno["inscripciones"][$ix]["paginainicial"] = $x["paginainicial"];
                    $retorno["inscripciones"][$ix]["numhojas"] = $x["numeropaginas"];
                    $retorno["inscripciones"][$ix]["not"] = $x["noticia"];
                    $retorno["inscripciones"][$ix]["aclaratoria"] = '';
                    if (isset($x["aclaratoria"])) {
                        $retorno["inscripciones"][$ix]["aclaratoria"] = $x["aclaratoria"];
                    }
                    $retorno["inscripciones"][$ix]["not2"] = '';
                    $retorno["inscripciones"][$ix]["not3"] = '';
                    $retorno["inscripciones"][$ix]["crecu"] = $x["ctrrecurso"];
                    $retorno["inscripciones"][$ix]["cimg"] = '';
                    $retorno["inscripciones"][$ix]["cver"] = '';
                    $retorno["inscripciones"][$ix]["crot"] = $x["ctrrotulo"];
                    $retorno["inscripciones"][$ix]["crev"] = $x["ctrrevoca"];
                    $retorno["inscripciones"][$ix]["regrev"] = $x["registrorevocacion"];
                    $retorno["inscripciones"][$ix]["cnat"] = '';
                    $retorno["inscripciones"][$ix]["fir"] = $x["firma"];
                    $retorno["inscripciones"][$ix]["cfir"] = $x["clavefirmado"];
                    $retorno["inscripciones"][$ix]["uins"] = $x["usuarioinscribe"];
                    $retorno["inscripciones"][$ix]["ufir"] = $x["usuariofirma"];
                    $retorno["inscripciones"][$ix]["tnotemail"] = $x["timestampnotificacionemail"];
                    $retorno["inscripciones"][$ix]["tnotsms"] = $x["timestampnotificacionsms"];
                    $retorno["inscripciones"][$ix]["tnotemail"] = $x["idnotificacionemail"];
                    $retorno["inscripciones"][$ix]["tnotsms"] = $x["idnotificacionsms"];
                    $retorno["inscripciones"][$ix]["ipubrue"] = $x["idpublicacionrue"];
                    $retorno["inscripciones"][$ix]["fpubrue"] = $x["fecpublicacionrue"];

                    //
                    $retorno["inscripciones"][$ix]["camant"] = $x["camaraanterior"];
                    $retorno["inscripciones"][$ix]["libant"] = $x["libroanterior"];
                    $retorno["inscripciones"][$ix]["regant"] = $x["registroanterior"];
                    $retorno["inscripciones"][$ix]["fecant"] = $x["fecharegistroanterior"];

                    //
                    $retorno["inscripciones"][$ix]["camant2"] = $x["camaraanterior2"];
                    $retorno["inscripciones"][$ix]["libant2"] = $x["libroanterior2"];
                    $retorno["inscripciones"][$ix]["regant2"] = $x["registroanterior2"];
                    $retorno["inscripciones"][$ix]["fecant2"] = $x["fecharegistroanterior2"];

                    //
                    $retorno["inscripciones"][$ix]["camant3"] = $x["camaraanterior3"];
                    $retorno["inscripciones"][$ix]["libant3"] = $x["libroanterior3"];
                    $retorno["inscripciones"][$ix]["regant3"] = $x["registroanterior3"];
                    $retorno["inscripciones"][$ix]["fecant3"] = $x["fecharegistroanterior3"];

                    //
                    $retorno["inscripciones"][$ix]["est"] = $x["estado"];
                    if ($retorno["inscripciones"][$ix]["not"] == '') {
                        if (defined('CAMARA_SUR_OCCIDENTE') && CAMARA_SUR_OCCIDENTE == 'S') {
                            $retorno["inscripciones"][$ix]["not"] = \funcionesGenerales::construirNoticiaSurOccidente($mysqli, $x);
                        }
                        if ($retorno["inscripciones"][$ix]["not"] == '') {
                            if ($x["acto"] != '') {
                                $ind = $x["libro"] . '-' . $x["acto"];
                                $retorno["inscripciones"][$ix]["not"] = $_SESSION["maestroactos"][$ind]["nombre"];
                            }
                        }
                    }
                    $ind = $x["libro"] . '-' . $x["acto"];

                    $retorno["inscripciones"][$ix]["grupoacto"] = '';
                    $retorno["inscripciones"][$ix]["esreforma"] = '';
                    $retorno["inscripciones"][$ix]["esreformaespecial"] = '';
                    $retorno["inscripciones"][$ix]["actosistemaanterior"] = '';
                    $retorno["inscripciones"][$ix]["vinculoafectado"] = $x["vinculoafectado"];
                    $retorno["inscripciones"][$ix]["tipoidentificacionafectada"] = $x["tipoidentificacionafectada"];
                    $retorno["inscripciones"][$ix]["identificacionafectada"] = $x["identificacionafectada"];
                    $retorno["inscripciones"][$ix]["fechalimite"] = $x["fechalimite"];
                    if (trim(ltrim($x["idradicacion"], "0")) != '') {
                        $retorno["inscripciones"][$ix]["idradicacion"] = $x["idradicacion"];
                    } else {
                        $cbx = retornarRegistrosMysqliApi($mysqli, 'mreg_est_codigosbarras_libros', "libro='" . $x["libro"] . "' and registro='" . $x["registro"] . "'", "id");
                        if ($cbx && !empty($cbx)) {
                            foreach ($cbx as $cbx1) {
                                $retorno["inscripciones"][$ix]["idradicacion"] = $cbx1["codigobarras"];
                            }
                        }
                        unset($cbx);
                    }

                    //
                    if ($x["tipodocumento"] == '03' && $x["acto"] == '0510' && strpos($retorno["inscripciones"][$ix]["not"], "DEPURACION")) {
                        $retorno["inscripciones"][$ix]["tdoc"] = '38';
                    }

                    //
                    if ($x["tipodocumento"] == '03' && ($x["acto"] == '0530' || $x["acto"] == '0540') && strpos($retorno["inscripciones"][$ix]["not"], "DEPURACION")) {
                        $retorno["inscripciones"][$ix]["tdoc"] = '38';
                    }


                    if (isset($_SESSION["maestroactos"][$ind])) {
                        $retorno["inscripciones"][$ix]["grupoacto"] = $_SESSION["maestroactos"][$ind]["idgrupoacto"];
                        $retorno["inscripciones"][$ix]["esreforma"] = $_SESSION["maestroactos"][$ind]["controlreforma"];
                        $retorno["inscripciones"][$ix]["esreformaespecial"] = $_SESSION["maestroactos"][$ind]["controlreformaespecial"];
                        $retorno["inscripciones"][$ix]["actosistemaanterior"] = $x["actosistemaanterior"];

                        //
                        // Perdida de calidad de comerciante
                        if ($_SESSION["maestroactos"][$ind]["idgrupoacto"] == '071') {
                            $retorno["fechaperdidacalidadcomerciante"] = $x["fecharegistro"];
                            $retorno["perdidacalidadcomerciante"] = 'si';
                            if (ltrim(trim($x["fecharadicacion"]), "0") != '') {
                                $retorno["fechaperdidacalidadcomerciante"] = $x["fecharadicacion"];
                            } else {
                                $retorno["fechaperdidacalidadcomerciante"] = $x["fecharegistro"];
                            }
                        }

                        // Reactivación como comerciante 
                        if ($_SESSION["maestroactos"][$ind]["idgrupoacto"] == '073') {
                            $retorno["fechaperdidacalidadcomerciante"] = '';
                            $retorno["perdidacalidadcomerciante"] = '';
                        }

                        //
                        // Disolucion
                        if (
                                ($_SESSION["maestroactos"][$ind]["idgrupoacto"] == '009') ||
                                ($_SESSION["maestroactos"][$ind]["controldisolucion"] == 'S') ||
                                ($_SESSION["maestroactos"][$ind]["textoenliquidacion"] == 'S') ||
                                ($_SESSION["maestroactos"][$ind]["textoenliquidacion"] == 'L')
                        ) {
                            $retorno["reactivadaacto511"] = '';
                            $retorno["fechaacto511"] = '';
                            $retorno["fechadisolucion"] = $x["fecharegistro"];
                            $retorno["disueltaporacto510"] = 'si';
                            if ($x["fecharegistroanterior"] != '') {
                                $retorno["fechaacto510"] = $x["fecharegistroanterior"];
                            } else {
                                if (ltrim(trim($x["fecharadicacion"]), "0") != '') {
                                    $retorno["fechaacto510"] = $x["fecharadicacion"];
                                } else {
                                    $retorno["fechaacto510"] = $x["fecharegistro"];
                                }
                            }
                        }

                        // Reactivacion 
                        if (
                                ($_SESSION["maestroactos"][$ind]["idgrupoacto"] == '011') ||
                                ($_SESSION["maestroactos"][$ind]["controldisolucion"] == 'R') ||
                                ($_SESSION["maestroactos"][$ind]["textoenliquidacion"] == 'F') ||
                                ($_SESSION["maestroactos"][$ind]["textoenliquidacion"] == 'Q')
                        ) {
                            $retorno["fechadisolucion"] = '';
                            $retorno["disueltaporacto510"] = '';
                            $retorno["fechaacto510"] = '';
                            $retorno["reactivadaacto511"] = 'si';
                            $retorno["fechaacto511"] = $x["fecharegistro"];
                        }


                        // Constitucion      
                        if ($_SESSION["maestroactos"][$ind]["idgrupoacto"] == '005') {
                            $retorno["fechaconstitucion"] = $x["fecharegistro"];
                        }

                        // Cancelacion            
                        if ($retorno["estadomatricula"] == 'MC' || $retorno["estadomatricula"] == 'MF' || $retorno["estadomatricula"] == 'MG') {
                            if ($_SESSION["maestroactos"][$ind]["idgrupoacto"] == '002') {
                                $retorno["fechacancelacion"] = $x["fecharegistro"];
                            }
                        }

                        // liquidacion            
                        if ($_SESSION["maestroactos"][$ind]["idgrupoacto"] == '010') {
                            $retorno["fechaliquidacion"] = $x["fecharegistro"];
                        }

                        // Libros de comercio
                        $eslib = 'no';
                        if ($x["libro"] == 'RM07' || $x["libro"] == 'RE52') {
                            if (ltrim(trim($x["acto"]), "0") == '') {
                                $eslib = 'si';
                            } else {
                                if ($_SESSION["maestroactos"][$ind]["idgrupoacto"] == '004' ||
                                        $_SESSION["maestroactos"][$ind]["idgrupoacto"] == '059') {
                                    $eslib = 'si';
                                }
                            }
                        }
                        if ($x["libro"] == 'RM22') {
                            if (trim($x["acto"]) == '0003') {
                                if ($_SESSION["maestroactos"][$ind]["idgrupoacto"] == '004' ||
                                        $_SESSION["maestroactos"][$ind]["idgrupoacto"] == '059') {
                                    $eslib = 'si';
                                }
                            }
                        }
                        if ($eslib == 'si') {
                            $ixl++;
                            $retorno["inscripcioneslibros"][$ixl] = array();
                            $retorno["inscripcioneslibros"][$ixl]["lib"] = $x["libro"];
                            $retorno["inscripcioneslibros"][$ixl]["nreg"] = $x["registro"];
                            $retorno["inscripcioneslibros"][$ixl]["dupli"] = $x["dupli"];
                            $retorno["inscripcioneslibros"][$ixl]["freg"] = $x["fecharegistro"];
                            $retorno["inscripcioneslibros"][$ixl]["hreg"] = $x["horaregistro"];
                            $retorno["inscripcioneslibros"][$ixl]["tipolibro"] = $x["tipolibro"];
                            $retorno["inscripcioneslibros"][$ixl]["idlibvii"] = $x["idcodlibro"];
                            $retorno["inscripcioneslibros"][$ixl]["codlibcom"] = $x["codigolibro"];
                            $retorno["inscripcioneslibros"][$ixl]["deslib"] = $x["descripcionlibro"];
                            $retorno["inscripcioneslibros"][$ixl]["paginainicial"] = $x["paginainicial"];
                            $retorno["inscripcioneslibros"][$ixl]["numhojas"] = $x["numeropaginas"];
                            $retorno["inscripcioneslibros"][$ixl]["not"] = $x["noticia"];
                            $retorno["inscripcioneslibros"][$ixl]["camant"] = $x["camaraanterior"];
                            $retorno["inscripcioneslibros"][$ixl]["libant"] = $x["libroanterior"];
                            $retorno["inscripcioneslibros"][$ixl]["regant"] = $x["registroanterior"];
                            $retorno["inscripcioneslibros"][$ixl]["fecant"] = $x["fecharegistroanterior"];
                            $retorno["inscripcioneslibros"][$ixl]["est"] = $x["estado"];
                            if ($retorno["inscripcioneslibros"][$ixl]["not"] == '') {
                                $retorno["inscripcioneslibros"][$ixl]["not"] = $_SESSION["maestroactos"][$x["libro"] . '-' . '0003']["nombre"];
                            }
                        }

                        //
                        if (isset($_SESSION["maestroactos"][$ind])) {
                            if ($_SESSION["maestroactos"][$ind]["textoenliquidacion"] == 'S') {
                                $enliquidacion = 'si';
                                $enreestructuracion = 'no';
                                $enreorganizacion = 'no';
                                $enliquidacionjudicial = 'no';
                                $enliquidacionforsoza = 'no';
                            }
                            if ($_SESSION["maestroactos"][$ind]["textoenliquidacion"] == 'L') {
                                $enliquidacionjudicial = 'si';
                                $enliquidacion = 'no';
                                $enreorganizacion = 'no';
                                $enreestructuracion = 'no';
                                $enliquidacionforsoza = 'no';
                            }
                            if ($_SESSION["maestroactos"][$ind]["textoenliquidacion"] == 'F') {
                                $enliquidacionforsoza = 'si';
                                $enliquidacion = 'no';
                                $enreorganizacion = 'no';
                                $enliquidacionjudicial = 'no';
                                $enreestructuracion = 'no';
                            }

                            if ($_SESSION["maestroactos"][$ind]["textoenliquidacion"] == 'Q') {
                                $enliquidacion = 'no';
                                $enliquidacionjudicial = 'no';
                                $enreestructuracion = 'no';
                                $enreorganizacion = 'no';
                                $enliquidacionforsoza = 'no';
                            }

                            if ($_SESSION["maestroactos"][$ind]["textoenreestructuracion"] == 'S') {
                                $enliquidacion = 'no';
                                $enliquidacionjudicial = 'no';
                                $enreestructuracion = 'si';
                                $enreorganizacion = 'no';
                            }
                            if ($_SESSION["maestroactos"][$ind]["textoenreestructuracion"] == 'L') {
                                $enliquidacion = 'no';
                                $enliquidacionjudicial = 'si';
                                $enreestructuracion = 'no';
                                $enreorganizacion = 'no';
                            }
                            if ($_SESSION["maestroactos"][$ind]["textoenreestructuracion"] == 'R') {
                                $enliquidacion = 'no';
                                $enliquidacionjudicial = 'no';
                                $enreestructuracion = 'no';
                                $enreorganizacion = 'si';
                            }

                            if ($_SESSION["maestroactos"][$ind]["textoenreestructuracion"] == 'Q') {
                                $enliquidacion = 'no';
                                $enliquidacionjudicial = 'no';
                                $enreestructuracion = 'no';
                                $enreorganizacion = 'no';
                            }
                        }
                    }
                }
            }
            //
        }

        // \logApi::general2($nameLog, $retorno["matricula"], 'Salió de inscripciones : ' . date("His"));
        // 2017-08-21: JINT: Pone automáticamente la palabra EN LIQUIDACION y EN RESTRUCTURACION
        // Bien sea porque se vencieron los términos de duracion (Vigencia) o porque
        // encontro algún acto que indique que se debe colocar o no dicha palabra
        // Aplica solo para personas jurídica sprincipales
        // 2017-11-18: si debe adicionar palabras a la razón social, revisa primero
        // si existe contenido en el campo "complentorazonsocial"

        if ($retorno["estadomatricula"] != 'MC' && $retorno["estadomatricula"] != 'IC') {
            if ($retorno["organizacion"] == '01' ||
                    ($retorno["organizacion"] > '02' && $retorno["categoria"] == '1')) {
                $ya = 'no';
                if ($enliquidacion == 'si' ||
                        $enreestructuracion == 'si' ||
                        $enreorganizacion == 'si' ||
                        $enliquidacionjudicial == 'si' ||
                        $enliquidacionforsoza == 'si'
                ) {
                    if ($retorno["complementorazonsocial"] != '') {
                        $retorno["nombre"] .= ' ' . $retorno["complementorazonsocial"];
                        $ya = 'si';
                    }
                }
                if ($ya == 'no') {
                    if ($enliquidacion == 'si') {
                        $retorno["nombre"] .= ' EN LIQUIDACION';
                        $ya = 'si';
                    }
                    if ($enreestructuracion == 'si') {
                        $retorno["nombre"] .= ' EN REESTRUCTURACION';
                        $ya = 'si';
                    }
                    if ($enreorganizacion == 'si') {
                        $retorno["nombre"] .= ' EN REORGANIZACION';
                        $ya = 'si';
                    }
                    if ($enliquidacionjudicial == 'si') {
                        $retorno["nombre"] .= ' EN LIQUIDACION JUDICIAL';
                        $ya = 'si';
                    }
                    if ($enliquidacionforsoza == 'si') {
                        $retorno["nombre"] .= ' EN LIQUIDACION FORZOSA';
                        $ya = 'si';
                    }
                }
                if ($ya == 'no') {
                    if (trim($retorno["fechavencimiento"]) != '' && $retorno["fechavencimiento"] != '99999999') {
                        if (trim($retorno["fechavencimiento"]) < date("Ymd")) {
                            $retorno["nombre"] .= ' EN LIQUIDACION';
                            $ya = 'si';
                        }
                    }
                }
            }
        }

        // Relación de nombres anteriores
        // \logApi::general2($nameLog, $retorno["matricula"], 'Entró a nombres anteriores : ' . date("His"));
        $retorno["nomant"] = array();

        $arrX = retornarRegistrosMysqliApi($mysqli, 'mreg_est_nombresanteriores', "matricula='" . $retorno["matricula"] . "'", "secuencia");
        $ix = 0;
        if ($arrX && !empty($arrX)) {
            foreach ($arrX as $x) {
                $ix++;
                $retorno["nomant"][$ix] = array();
                $retorno["nomant"][$ix]["sec"] = $ix;
                $retorno["nomant"][$ix]["lib"] = $x["libro"];
                $retorno["nomant"][$ix]["nreg"] = $x["registro"];
                $retorno["nomant"][$ix]["dup"] = $x["dupli"];
                $retorno["nomant"][$ix]["freg"] = $x["fechareg"];
                $retorno["nomant"][$ix]["nom"] = $x["nombre"];
                $retorno["nomant"][$ix]["ope"] = $x["operador"];
                $retorno["nomant"][$ix]["fcre"] = $x["fechacreacion"];
            }
        }
        // \logApi::general2($nameLog, $retorno["matricula"], 'Salió de nombres anteriores : ' . date("His"));
        // Relación de capitales
        // \logApi::general2($nameLog, $retorno["matricula"], 'Entró a capitales : ' . date("His"));
        $retorno["capitales"] = array();
        $arrX = retornarRegistrosMysqliApi($mysqli, 'mreg_est_capitales', "matricula='" . ltrim(trim($retorno["matricula"]), "0") . "'", "anodatos,fechadatos");
        $icap = 0;
        if ($arrX && !empty($arrX)) {
            foreach ($arrX as $hcap) {
                $icap++;
                $retorno["capitales"][$icap]["anodatos"] = $hcap["anodatos"];
                $retorno["capitales"][$icap]["fechadatos"] = $hcap["fechadatos"];
                $retorno["capitales"][$icap]["libro"] = $hcap["libro"];
                $retorno["capitales"][$icap]["registro"] = $hcap["registro"];
                $retorno["capitales"][$icap]["tipoeconomia"] = $hcap["tipoeconomia"];
                $retorno["capitales"][$icap]["pornaltot"] = $hcap["pornaltot"];
                $retorno["capitales"][$icap]["pornalpri"] = $hcap["pornalpri"];
                $retorno["capitales"][$icap]["pornalpub"] = $hcap["pornalpub"];
                $retorno["capitales"][$icap]["porexttot"] = $hcap["porexttot"];
                $retorno["capitales"][$icap]["porextpri"] = $hcap["porextpri"];
                $retorno["capitales"][$icap]["porextpub"] = $hcap["porextpub"];
                $retorno["capitales"][$icap]["apoact"] = $hcap["aporteactivos"];
                $retorno["capitales"][$icap]["apodin"] = $hcap["aportedinero"];
                $retorno["capitales"][$icap]["apolab"] = $hcap["aportelaboral"];
                $retorno["capitales"][$icap]["apolabadi"] = $hcap["aportelaboraladi"];
                $retorno["capitales"][$icap]["suscrito"] = $hcap["valorsuscrito"];
                $retorno["capitales"][$icap]["autorizado"] = $hcap["valorautorizado"];
                $retorno["capitales"][$icap]["pagado"] = $hcap["valorpagado"];
                $retorno["capitales"][$icap]["social"] = $hcap["valorsocial"];
                $retorno["capitales"][$icap]["asigsuc"] = $hcap["capsucursal"];
                $retorno["capitales"][$icap]["cuosuscrito"] = $hcap["cuotassuscrito"];
                $retorno["capitales"][$icap]["cuoautorizado"] = $hcap["cuotasautorizado"];
                $retorno["capitales"][$icap]["cuopagado"] = $hcap["cuotaspagado"];
                $retorno["capitales"][$icap]["cuosocial"] = $hcap["cuotassocial"];

                // información de porcentajes de capital
                // $retorno["cap_porcnaltot"] = $hcap["pornaltot"];
                // $retorno["cap_porcnalpri"] = $hcap["pornalpri"];
                // $retorno["cap_porcnalpub"] = $hcap["pornalpub"];
                // $retorno["cap_porcexttot"] = $hcap["porexttot"];
                // $retorno["cap_porcextpri"] = $hcap["porextpri"];
                // $retorno["cap_porcextpub"] = $hcap["porextpub"];

                $retorno["cap_apolab"] = doubleval($hcap["aportelaboral"]);
                $retorno["cap_apolabadi"] = doubleval($hcap["aportelaboraladi"]);
                $retorno["cap_apoact"] = doubleval($hcap["aporteactivos"]);
                $retorno["cap_apodin"] = doubleval($hcap["aportedinero"]);

                $retorno["capsoc"] = $hcap["valorsocial"];
                $retorno["capaut"] = $hcap["valorautorizado"];
                $retorno["capsus"] = $hcap["valorsuscrito"];
                $retorno["cappag"] = $hcap["valorpagado"];
                $retorno["cuosoc"] = $hcap["cuotassocial"];
                $retorno["cuoaut"] = $hcap["cuotasautorizado"];
                $retorno["cuosus"] = $hcap["cuotassuscrito"];
                $retorno["cuopag"] = $hcap["cuotaspagado"];
                $retorno["capsuc"] = $hcap["capsucursal"];
            }
        }
        // \logApi::general2($nameLog, $retorno["matricula"], 'Salió de capitales : ' . date("His"));
        // Relación de capitales
        // \logApi::general2($nameLog, $retorno["matricula"], 'Entró a patrimonios : ' . date("His"));
        $retorno["patrimoniosesadl"] = array();
        $arrX = retornarRegistrosMysqliApi($mysqli, 'mreg_est_patrimonios', "matricula='" . $retorno["matricula"] . "'", "anodatos,fechadatos");
        $icap = 0;
        if ($arrX && !empty($arrX)) {
            foreach ($arrX as $hcap) {
                $icap++;
                $retorno["patrimoniosesadl"][$icap]["anodatos"] = $hcap["anodatos"];
                $retorno["patrimoniosesadl"][$icap]["fechadatos"] = $hcap["fechadatos"];
                $retorno["patrimoniosesadl"][$icap]["patrimonio"] = $hcap["patrimonio"];
            }
        }
        // \logApi::general($nameLog, $retorno["matricula"], 'Salió de patrimonios : ' . date("His"));
        // Información financiera histórica
        // \logApi::general($nameLog, $retorno["matricula"], 'Entró histórico financiera : ' . date("His"));
        $retorno["hf"] = array();
        $ix = 0;
        $arrX = retornarRegistrosMysqliApi($mysqli, 'mreg_est_financiera', "matricula='" . $retorno["matricula"] . "'", "anodatos,fechadatos");
        if ($arrX && !empty($arrX)) {
            foreach ($arrX as $regf) {
                $ix++;
                $retorno["hf"][$ix]["anodatos"] = $regf["anodatos"];
                $retorno["hf"][$ix]["fechadatos"] = $regf["fechadatos"];
                $retorno["hf"][$ix]["personal"] = $regf["personal"];
                $retorno["hf"][$ix]["personaltemp"] = $regf["pcttemp"];
                $retorno["hf"][$ix]["actvin"] = $regf["actvin"];
                $retorno["hf"][$ix]["actcte"] = $regf["actcte"];
                $retorno["hf"][$ix]["actnocte"] = $regf["actnocte"];
                $retorno["hf"][$ix]["actfij"] = $regf["actfij"];
                $retorno["hf"][$ix]["fijnet"] = $regf["fijnet"];
                $retorno["hf"][$ix]["actotr"] = $regf["actotr"];
                $retorno["hf"][$ix]["actval"] = $regf["actval"];
                $retorno["hf"][$ix]["acttot"] = $regf["acttot"];
                $retorno["hf"][$ix]["actsinaju"] = 0;
                $retorno["hf"][$ix]["invent"] = 0;
                $retorno["hf"][$ix]["pascte"] = $regf["pascte"];
                $retorno["hf"][$ix]["paslar"] = $regf["paslar"];
                $retorno["hf"][$ix]["pastot"] = $regf["pastot"];
                $retorno["hf"][$ix]["pattot"] = $regf["patnet"];
                $retorno["hf"][$ix]["paspat"] = $regf["paspat"];
                $retorno["hf"][$ix]["balsoc"] = $regf["balsoc"];
                $retorno["hf"][$ix]["ingope"] = $regf["ingope"];
                $retorno["hf"][$ix]["ingnoope"] = $regf["ingnoope"];
                $retorno["hf"][$ix]["gtoven"] = $regf["gasope"];
                $retorno["hf"][$ix]["gtoadm"] = $regf["gasadm"];
                $retorno["hf"][$ix]["cosven"] = $regf["cosven"];
                $retorno["hf"][$ix]["depamo"] = 0;
                $retorno["hf"][$ix]["gasint"] = $regf["gasint"];
                $retorno["hf"][$ix]["gasimp"] = $regf["gasimp"];
                $retorno["hf"][$ix]["utiope"] = $regf["utiope"];
                $retorno["hf"][$ix]["utinet"] = $regf["utinet"];
            }
        }
        unset($arrX);

        // \logApi::general($nameLog, $retorno["matricula"], 'Salió histórico financiera : ' . date("His"));
        // Carga códigos CAE
        // \logApi::general2($nameLog, $retorno["matricula"], 'Entró a información CAE : ' . date("His"));
        $retorno["codigoscae"] = array();
        $arrY = retornarRegistrosMysqliApi($mysqli, 'mreg_anexoscae', "1=1", "codigocae");
        if ($arrY && !empty($arrY)) {
            foreach ($arrY as $y) {
                $retorno["codigoscae"][$y["codigocae"]] = retornarRegistroMysqliApi($mysqli, 'mreg_est_campostablas', "tabla='200' and registro='" . $retorno["matricula"] . "' and campo='" . $y["codigocae"] . "'", "contenido");
            }
        }

        // Carga información adicional
        $retorno["informacionadicional"] = array();
        $arrY = retornarRegistrosMysqliApi($mysqli, 'mreg_campos_adicionales_camara', "1=1", "orden");
        if ($arrY && !empty($arrY)) {
            foreach ($arrY as $y) {
                $retorno["informacionadicional"][$y["codigoadicional"]] = retornarRegistroMysqliApi($mysqli, 'mreg_est_campostablas', "tabla='200' and registro='" . $retorno["matricula"] . "' and campo='" . $y["codigoadicional"] . "'", "contenido");
            }
        }
        // \logApi::general2($nameLog, $retorno["matricula"], 'Salió de información CAE : ' . date("His"));
        // Certificas que se importaron del SIREP
        // \logApi::general2($nameLog, $retorno["matricula"], 'Entró a certificas SIREP: ' . date("His"));
        $retorno["crt"] = array();
        $arrTemC = retornarRegistrosMysqliApi($mysqli, 'mreg_est_certificas', "matricula='" . ltrim($retorno["matricula"], "0") . "'", "idcertifica,id");
        if ($arrTemC && !empty($arrTemC)) {
            foreach ($arrTemC as $tx) {
                if (trim($tx["texto"]) != '') {
                    if (trim($tx["idcertifica"]) != '') {
                        if (!isset($retorno["crt"][trim($tx["idcertifica"])])) {
                            $retorno["crt"][trim($tx["idcertifica"])] = '';
                        }
                        $txt1 = \funcionesGenerales::reemplazarAcutes(\funcionesGenerales::restaurarEspeciales(trim(str_replace("&rdquo;", '"', $tx["texto"]))));
                        $txt1 = str_replace("||", CHR(13) . CHR(10) . CHR(13) . CHR(10), $txt1);
                        $txt1 = str_replace("|", " ", $txt1);
                        $retorno["crt"][$tx["idcertifica"]] .= $txt1;
                    }
                }
            }
        }
        unset($arrTemC);
        // \logApi::general2($nameLog, $retorno["matricula"], 'Salió de certificas SIREP: ' . date("His"));
        // Certificas que se han grabado en el SII
        // \logApi::general2($nameLog, $retorno["matricula"], 'Entró a certificas SII: ' . date("His"));
        $retorno["crtsii"] = array();
        $arrTemC = retornarRegistrosMysqliApi($mysqli, 'mreg_certificas_sii', "registro='REGMER' and expediente='" . ltrim($retorno["matricula"], "0") . "'", "idcertifica,id");
        if ($arrTemC && !empty($arrTemC)) {
            foreach ($arrTemC as $tx) {
                if (trim($tx["contenido"]) != '') {
                    if (!isset($retorno["crtsii"][$tx["idcertifica"]])) {
                        $retorno["crtsii"][$tx["idcertifica"]] = '';
                    }
                    $txt1 = \funcionesGenerales::reemplazarAcutes(\funcionesGenerales::restaurarEspeciales(trim(str_replace("&rdquo;", '"', $tx["contenido"]))));
                    $txt1 = str_replace("||", CHR(13) . CHR(10) . CHR(13) . CHR(10), $txt1);
                    $txt1 = str_replace("|", " ", $txt1);
                    $retorno["crtsii"][$tx["idcertifica"]] .= $txt1;
                }
            }
        }
        unset($arrTemC);
        // \logApi::general2($nameLog, $retorno["matricula"], 'Salió de certificas SII: ' . date("His"));
        // Carga relación de embargos
        // \logApi::general2($nameLog, $retorno["matricula"], 'Entró a embargos: ' . date("His"));
        $retorno["embargos"] = 0;
        $retorno["ctrembargos"] = array();
        $i = 0;
        $arrTemE = retornarRegistrosMysqliApi($mysqli, 'mreg_est_embargos', "matricula='" . $retorno["matricula"] . "'", "libro,numreg");
        if ($arrTemE === false) {
            echo $_SESSION["generales"]["mensajeerror"];
        }
        if ($arrTemE && !empty($arrTemE)) {
            foreach ($arrTemE as $e) {
                $i++;
                $retorno["ctrembargos"][$i] = array();
                $retorno["ctrembargos"][$i]["acto"] = $e["acto"];
                $retorno["ctrembargos"][$i]["idclase"] = $e["idclase"];
                $retorno["ctrembargos"][$i]["numid"] = $e["numid"];
                $retorno["ctrembargos"][$i]["nombre"] = stripslashes($e["nombredemandante"]);
                $retorno["ctrembargos"][$i]["idclasedemandante"] = $e["idclasedemandante"];
                $retorno["ctrembargos"][$i]["numiddemandante"] = $e["numiddemandante"];
                $retorno["ctrembargos"][$i]["nombredemandante"] = stripslashes($e["nombredemandante"]);
                $retorno["ctrembargos"][$i]["tipdoc"] = $e["tipdoc"];
                $retorno["ctrembargos"][$i]["numdoc"] = $e["numdoc"];
                $retorno["ctrembargos"][$i]["fecdoc"] = $e["fecdoc"];
                $retorno["ctrembargos"][$i]["idorigen"] = $e["idorigen"];
                $retorno["ctrembargos"][$i]["txtorigen"] = stripslashes($e["txtorigen"]);
                $retorno["ctrembargos"][$i]["fecrad"] = $e["fecradica"];
                $retorno["ctrembargos"][$i]["estado"] = $e["ctrestadoembargo"];
                if (strlen($e["libro"]) == 2) {
                    if (trim($e["libro"]) < '50') {
                        $retorno["ctrembargos"][$i]["libro"] = 'RM' . $e["libro"];
                    } else {
                        $retorno["ctrembargos"][$i]["libro"] = 'RE' . $e["libro"];
                    }
                } else {
                    $retorno["ctrembargos"][$i]["libro"] = $e["libro"];
                }
                $retorno["ctrembargos"][$i]["numreg"] = $e["numreg"];
                $retorno["ctrembargos"][$i]["codbarras"] = $e["codbarras"];
                $retorno["ctrembargos"][$i]["noticia"] = stripslashes($e["noticia"]);
                $retorno["ctrembargos"][$i]["fecinscripcion"] = $e["fecinscripcion"];
                $retorno["ctrembargos"][$i]["esembargo"] = '';

                $ind = $retorno["ctrembargos"][$i]["libro"] . '-' . $e["acto"];
                if (isset($_SESSION["maestroactos"][$ind])) {
                    if ($_SESSION["maestroactos"][$ind]["idgrupoacto"] == '018') {
                        $retorno["ctrembargos"][$i]["esembargo"] = 'S';
                        if ($e["ctrestadoembargo"] != '2') {
                            $retorno["embargos"] ++;
                        }
                    }
                }
            }
        }
        // echo count ($retornos["ctrembargos"]);
        unset($arrTemE);
        // \logApi::general2($nameLog, $retorno["matricula"], 'Salió de embargos: ' . date("His"));
        // Relación de pagos de afiliacion
        // \logApi::general2($nameLog, $retorno["matricula"], 'Entró a historico afiliacion: ' . date("His"));
        $retorno["periodicoafiliados"] = array(); // Calcular
        $arrX = retornarRegistrosMysqliApi($mysqli, 'mreg_est_afiliados_pagos', "matricula='" . $retorno["matricula"] . "'", "fec_pago");
        $ix = 0;
        if ($arrX && !empty($arrX)) {
            foreach ($arrX as $x) {
                $ix++;
                $retorno["periodicoafiliados"][$ix] = array();
                $retorno["periodicoafiliados"][$ix]["fec_pago"] = $x["fec_pago"];
                $retorno["periodicoafiliados"][$ix]["tip_pago"] = $x["tip_pago"];
                $retorno["periodicoafiliados"][$ix]["ano_pagado"] = $x["ano_pagado"];
                $retorno["periodicoafiliados"][$ix]["recibo"] = $x["recibo"];
                $retorno["periodicoafiliados"][$ix]["operacion"] = $x["operacion"];
                $retorno["periodicoafiliados"][$ix]["valor"] = $x["valor"];
                $retorno["periodicoafiliados"][$ix]["eliminado"] = $x["eliminado"];
            }
        }
        unset($arrX);
        // \logApi::general2($nameLog, $retorno["matricula"], 'Salió de  historico afiliacion: ' . date("His"));
        // Relacion de anexos documentales
        // \logApi::general2($nameLog, $retorno["matricula"], 'Entró a imagenes: ' . date("His"));
        $retorno["imagenes"] = array();
        if ($tipodata == 'E') {
            $imgs = array();
            if ($retorno["tipoidentificacion"] == '7') {
                $idex = '';
            } else {
                $idex = ltrim(trim($retorno["identificacion"]), "0");
                if (strlen($idex) < 5) {
                    $idex = '';
                }
            }
            // \logApi::general2($nameLog, $retorno["matricula"], 'Entró buscar imagenes: ' . date("His"));
            if ($idex != '') {
                $imgs = retornarRegistrosMysqliApi($mysqli, 'mreg_radicacionesanexos', "eliminado<>'SI' and (matricula='" . ltrim($retorno["matricula"], "0") . "' or identificacion like '" . $idex . "%')", "idanexo");
            } else {
                if (ltrim($retorno["matricula"], "0") != '') {
                    $imgs = retornarRegistrosMysqliApi($mysqli, 'mreg_radicacionesanexos', "eliminado<>'SI' and matricula='" . ltrim($retorno["matricula"], "0") . "'", "idanexo");
                }
            }
            // \logApi::general2($nameLog, $retorno["matricula"], 'Salió de buscar imagenes: ' . date("His"));
            if ($imgs) {
                if (!empty($imgs)) {
                    $i = 0;
                    foreach ($imgs as $img) {
                        if ($img["tipoanexo"] != '509' && $img["eliminado"] != 'SI') {
                            $i++;
                            $retorno["imagenes"][$i] = $img;

                            if (trim($img["bandeja"]) == '') {
                                $tx = retornarRegistroMysqliApi($mysqli, 'bas_tipodoc', "idtipodoc='" . $img["idtipodoc"] . "'");
                                if ($tx === false || empty($tx)) {
                                    $retorno["imagenes"][$i]["bandeja"] = '';
                                } else {
                                    $retorno["imagenes"][$i]["bandeja"] = $tx["bandejadigitalizacion"];
                                }
                            }
                            if (trim($img["bandeja"]) == '') {
                                if (trim($img["libro"]) != '') {
                                    if (strlen(trim($img["libro"])) < 3) {
                                        if (sprintf("%02s", $img["libro"]) < '50') {
                                            $retorno["imagenes"][$i]["bandeja"] = '4.-REGMER';
                                        } else {
                                            $retorno["imagenes"][$i]["bandeja"] = '5.-REGESADL';
                                        }
                                    } else {
                                        if (substr($img["libro"], 2, 2) < '50') {
                                            $retorno["imagenes"][$i]["bandeja"] = '4.-REGMER';
                                        } else {
                                            $retorno["imagenes"][$i]["bandeja"] = '5.-REGESADL';
                                        }
                                    }
                                }
                            }
                            $obs = '';
                            $fechamostrar = '';

                            if (trim($img["libro"]) != '' && trim($img["registro"]) != '') {
                                if (strlen(trim($img["libro"])) < 3) {
                                    if (sprintf("%02s", $img["libro"]) < '50') {
                                        $txLib = 'RM' . sprintf("%02s", trim($img["libro"]));
                                    } else {
                                        $txLib = 'RE' . sprintf("%02s", trim($img["libro"]));
                                    }
                                } else {
                                    $txLib = trim($img["libro"]);
                                }
                                $condic = "libro='" . $txLib . "' and registro='" . ltrim($img["registro"], "0") . "'";
                                $temIns = retornarRegistroMysqliApi($mysqli, 'mreg_est_inscripciones', $condic);
                                if ($temIns && !empty($temIns)) {
                                    $obs = '<strong>Inscripción No. </strong>' . $txLib . '-' . $img["registro"];
                                    if ($temIns["noticia"] != '') {
                                        if (trim($obs) != '') {
                                            $obs .= '<br>';
                                        }
                                        $obs .= $temIns["noticia"];
                                    }
                                    $fechamostrar = $temIns["fecharegistro"];
                                }
                            } else {
                                if (ltrim($img["idradicacion"], "0") != '') {
                                    $fechamostrar = retornarRegistroMysqliApi($mysqli, 'mreg_est_codigosbarras', "codigobarras='" . ltrim($img["idradicacion"], "0") . "'", "fecharadicacion");
                                    $actorep = retornarRegistroMysqliApi($mysqli, 'mreg_est_codigosbarras', "codigobarras='" . ltrim($img["idradicacion"], "0") . "'", "actoreparto");
                                    if ($actorep != '') {
                                        if (trim($obs) != '') {
                                            $obs .= '<br>';
                                        }
                                        $obs .= retornarRegistroMysqliApi($mysqli, 'mreg_codrutas', "id='" . $actorep . "'", "descripcion");
                                    }
                                } else {
                                    if (trim($img["numerorecibo"]) != '') {
                                        $fechamostrar = retornarRegistroMysqliApi($mysqli, 'mreg_est_recibos', "numerorecibo='" . trim($img["numerorecibo"]) . "'", "fecoperacion");
                                        $actorep = retornarRegistroMysqliApi($mysqli, 'mreg_est_recibos', "numerorecibo='" . trim($img["numerorecibo"]) . "'", "servicio");
                                        if ($actorep != '') {
                                            if (trim($obs) != '') {
                                                $obs .= '<br>';
                                            }
                                            $obs .= retornarRegistroMysqliApi($mysqli, 'mreg_servicios', "idservicio='" . $actorep . "'", "nombre");
                                        }
                                    }
                                }
                            }

                            if (trim($img["idtipodoc"]) != '') {
                                if ($obs != '') {
                                    $obs .= '<br>';
                                }
                                $obs .= '<strong>Tipo documental : </strong>(' . $img["idtipodoc"] . ') ' . utf8_encode(retornarRegistroMysqliApi($mysqli, 'bas_tipodoc', "idtipodoc='" . trim($img["idtipodoc"]) . "'", "descripcion"));
                            }

                            if (trim($img["libro"]) == '') {
                                if (trim($img["observaciones"]) != '') {
                                    if ($obs != '') {
                                        $obs .= '<br>';
                                    }
                                    $obs .= $img["observaciones"];
                                }
                            }
                            if ($fechamostrar == '') {
                                $fechamostrar = $img["fechadoc"];
                            }
                            $retorno["imagenes"][$i]["obs"] = $obs;
                            $retorno["imagenes"][$i]["fmostrar"] = $fechamostrar;
                        }
                    }
                    $retorno["imagenes"] = \funcionesGenerales::ordenarMatriz($retorno["imagenes"], "fmostrar", true);
                }
            }
        }
        // \logApi::general2($nameLog, $retorno["matricula"], 'Salió de imagenes: ' . date("His"));
        // Confirma si tiene o no beneficio de la Ley 1780
        // Aplica para el 2017
        if (date("Y") == '2017') {
            if ($retorno["organizacion"] == '01' || ($retorno["organizacion"] > '02' && $retorno["categoria"] == '1')) {
                if ($retorno["fechamatricula"] >= '20160502') {
                    if ($retorno["benley1780"] == '') {
                        if (contarRegistrosMysqliApi($mysqli, 'mreg_est_recibos', "matricula='" . $retorno["matricula"] . "' and servicio='01090110' and (fecoperacion between '20160101' and '20161231')") > 0) {
                            $retorno["benley1780"] = 'S';
                        }
                    }
                }
            }
        }

        // Aplica para el 2018
        if (date("Y") == '2018') {
            if ($retorno["organizacion"] == '01' || ($retorno["organizacion"] > '02' && $retorno["categoria"] == '1')) {
                if ($retorno["fechamatricula"] >= '20170101') {
                    if ($retorno["benley1780"] == '') {
                        if (contarRegistrosMysqliApi($mysqli, 'mreg_est_recibos', "matricula='" . $retorno["matricula"] . "' and (servicio IN ('01090110','01090111')) and (fecoperacion between '20170101' and '20171231')") > 0) {
                            $retorno["benley1780"] = 'S';
                        }
                    }
                }
            }
        }


        // 2017-09-26: jint : DATOS DEL CAE
        $retorno["placaalcaldia"] = '';
        $retorno["placaalcaldiafecha"] = '';
        $retorno["reportealcaldia"] = '';

        $temx = retornarRegistroMysqliApi($mysqli, 'mreg_alcaldias', "idmunicipio='" . trim($retorno["muncom"]) . "'");
        if ($temx && !empty($temx)) {
            if ($temx["eliminado"] != 'SI') {
                if ($temx["fechainicio"] <= $retorno["fechamatricula"]) {
                    $retorno["reportealcaldia"] = 'si';
                }
            }
        }
        unset($temx);

        if ($retorno["reportealcaldia"] == 'si') {
            $temx = retornarRegistroMysqliApi($mysqli, 'mreg_matriculasalcaldia', "idmatricula='" . ltrim($retorno["matricula"], "0") . "'");
            if ($temx && !empty($temx)) {
                $retorno["placaalcaldia"] = trim($temx["matriculaic"]);
                $retorno["placaalcaldiafecha"] = trim($temx["fechamatriculaic"]);
            } else {
                $temx = retornarRegistroMysqliApi($mysqli, 'mreg_envio_matriculas_api', "matricula='" . ltrim($retorno["matricula"], "0") . "'", '*', 'U');
                if ($temx && !empty($temx)) {
                    $retorno["placaalcaldia"] = trim($temx["codigoasignadorespuesta"]);
                    $retorno["placaalcaldiafecha"] = trim($temx["fechahorarespuesta"]);
                }
            }
            unset($temx);
        }

        //
        unset($reg);


        // Cierra la conexión con MYSQL
        if ($dbx === null) {
            $mysqli->close();
        }

        // Retorna la respuesta
        if ($mat != '') {
            $_SESSION["expedienteactual"][ltrim(trim($mat), "0")] = $retorno;
        }
        return $retorno;
    }

    public static function retornarExpedienteProponente($dbx = null, $prop, $mat = '', $tipotramite = '', $proceso = 'Sin identificar la rutina', $origen = '', $retornarInhabilidad = 'si', $retornarRee = 'si') {
        require_once ($_SESSION["generales"]["pathabsoluto"] . '/api/funcionesRues.php');

        // Instancia la BD si no existe
        // ********************************************************************************** //
        if ($dbx === null) {
            $mysqli = new \mysqli(DB_HOST, DB_USUARIO, DB_PASSWORD, DB_NAME, DB_PORT);
            if (mysqli_connect_error()) {
                $_SESSION["generales"]["mensajerror"] = 'Error coenctando con la BD';
                return false;
            }
        } else {
            $mysqli = $dbx;
        }


        $fecultinsc = '';
        $estadoultimainscripcion = '';
        $estadoultimoacto = '';
        $cantidadnofirme = 0;
        $cantidadnopublicadasrues = 0;
        $fecultren = '';
        $fecultact = '';
        $fecultcanc = '';


        //
        if (ltrim($prop, "0") != '') {
            $arrTemIns = retornarRegistroMysqliApi($mysqli, 'mreg_est_inscritos', "proponente='" . ltrim($prop, "0") . "'");
            if ($arrTemIns === false || empty($arrTemIns)) {
                $_SESSION["generales"]["mensajeerror"] = '(1) Proponente no encontrado en mreg_est_inscritos';
                return false;
            } else {
                $arrTem = retornarRegistroMysqliApi($mysqli, 'mreg_est_proponentes', "proponente='" . ltrim($prop, "0") . "'");
                if ($arrTem === false || empty($arrTem)) {
                    $_SESSION["generales"]["mensajeerror"] = '(2) Proponente no encontrado en mreg_est_proponentes';
                    return false;
                }
            }
        }

        if (ltrim($prop, "0") != '') {
            if (ltrim($arrTemIns["matricula"], "0") != '') {
                if ($arrTemIns["ctrestmatricula"] != 'MA' && $arrTemIns["ctrestmatricula"] != 'MI' && $arrTemIns["ctrestmatricula"] != 'IA' && $arrTemIns["ctrestmatricula"] != 'II') {
                    $arrTemMer = false;
                } else {
                    $arrTemMer = $arrTemIns;
                }
            } else {
                $arrTemMer = false;
            }
        } else {
            $arrTem = false;
            $arrTemIns = false;
            if (ltrim($mat, "0") != '') {
                $arrTemMer = retornarRegistroMysqliApi($mysqli, 'mreg_est_inscritos', "matricula='" . ltrim($mat, "0") . "'");
                if ($arrTemMer["ctrestmatricula"] != 'MA' && $arrTemMer["ctrestmatricula"] != 'MI' && $arrTemMer["ctrestmatricula"] != 'IA' && $arrTemMer["ctrestmatricula"] != 'II') {
                    $arrTemMer = false;
                }
            }
        }

        //
        $retorno["tipotramite"] = $tipotramite;
        $retorno["numerorecuperacion"] = '';
        $retorno["numeroliquidacion"] = '';

        // Inicializa arreglos generales
        $retorno["enfirme"] = array();
        $retorno["representanteslegales"] = array();
        $retorno["sitcontrol"] = array();
        $retorno["exp1510"] = array();
        $retorno["clasi1510"] = array();
        $retorno["bienes"] = array();
        $retorno["contratos"] = array();
        $retorno["multas"] = array();
        $retorno["sanciones"] = array();
        $retorno["sandis"] = array();
        $retorno["inscripciones"] = array();
        $retorno["observaciones"] = '';
        $retorno["lcodigosbarras"] = array();
        $retorno["codigosbarraspendientes"] = '';
        $retorno["codigosbarras"] = 0;
        $retorno["recursostramite"] = '';
        $retorno["reeentramite"] = '';
        $retorno["inhabilidad"] = array();

        // ***************************************************************************** //
        // Relación de códigos de barras pendientes
        // ***************************************************************************** //
        if (ltrim($prop, "0") != '') {
            $arrX = retornarRegistrosMysqliApi($mysqli, 'mreg_est_codigosbarras', "proponente='" . $prop . "'", "codigobarras");
            $ix = 0;
            if ($arrX && !empty($arrX)) {
                foreach ($arrX as $x) {
                    if ($x["actoreparto"] == '09' || // Trámites de proponentes locales
                            $x["actoreparto"] == '27' || // Recursos de reposición
                            $x["actoreparto"] == '53' // Trámites RUES de proponentes
                    ) {
                        if ($x["estadofinal"] == '01' || // Radicado
                                $x["estadofinal"] == '04' || // En estudio
                                $x["estadofinal"] == '09' || // Reingresado
                                $x["estadofinal"] == '10' || // Devuelto a reparto
                                $x["estadofinal"] == '11' || // Inscrito
                                $x["estadofinal"] == '13' || // Asignado a estudio
                                $x["estadofinal"] == '22' || // Registrado - proponentes
                                $x["estadofinal"] == '23' || // En digitacion
                                $x["estadofinal"] == '34' || // Para firma
                                $x["estadofinal"] == '35' || // Firmado
                                $x["estadofinal"] == '38' // Control de calidad
                        ) {
                            $ix++;
                            $retorno["lcodigosbarras"][$ix]["cbar"] = $x["codigobarras"];
                            $retorno["lcodigosbarras"][$ix]["frad"] = $x["fecharadicacion"];
                            $retorno["lcodigosbarras"][$ix]["ttra"] = $x["actoreparto"];
                            $retorno["lcodigosbarras"][$ix]["esta"] = $x["estadofinal"];
                            $retorno["lcodigosbarras"][$ix]["nesta"] = '';
                            $retorno["lcodigosbarras"][$ix]["ntra"] = retornarRegistroMysqliApi($mysqli, 'mreg_tablassirep', "idtabla='01' and idcodigo='" . $retorno["lcodigosbarras"][$ix]["ttra"] . "'", "descripcion");
                            $retorno["lcodigosbarras"][$ix]["sist"] = retornarRegistroMysqliApi($mysqli, 'mreg_tablassirep', "idtabla='01' and idcodigo='" . $retorno["lcodigosbarras"][$ix]["ttra"] . "'", "tipo");
                            $retorno["lcodigosbarras"][$ix]["nesta"] = retornarRegistroMysqliApi($mysqli, 'mreg_tablassirep', "idtabla='82' and idcodigo='" . $retorno["lcodigosbarras"][$ix]["esta"] . "'", "descripcion");
                            $retorno["codigosbarras"] ++;
                        }
                    }

                    // Si la ruta es un recurso en trámite
                    if ($x["actoreparto"] == '19' || $x["actoreparto"] == '23' || $x["actoreparto"] == '54') {
                        $retorno["recursostramite"] = 'S';
                    }
                }
            }
        }

        // ***************************************************************************** //
        // ARMA LISTA COMPLETA DE INSCRIPCIONES
        // Encuentra ultimas fechas de cada acto de control
        // Encuentra el estado de la ultima inscripcion
        // ***************************************************************************** //
        // ****************************************************************************** //
        // Busca si existen reportes que no hayan sido inscritos
        // mreg_reportescontratos
        // mreg_reportesmultas
        // mreg_reportessanciones
        // mreg_reportessancionesdisciplinarias
        $where = '';
        if ($arrTemIns && trim($arrTemIns["numid"], "0") != '') {
            $where = "nitproponente='" . $arrTemIns["numid"] . "'";
        }
        if ($arrTemIns && trim($arrTemIns["nit"], "0") != '') {
            if ($where != '') {
                $where .= " or ";
            }
            $where .= "nitproponente='" . $arrTemIns["numid"] . "'";
        }
        if (ltrim(trim($prop), "0") != '') {
            if ($where != '') {
                $where .= " or ";
            }
            $where .= "numeroproponente='" . trim(trim($prop), "0") . "'";
        }
        if ($where != '') {
            $temx = retornarRegistrosMysqliApi($mysqli, 'mreg_reportescontratos', $where, "id");
        } else {
            $temx = false;
        }
        if ($temx && !empty($temx)) {
            foreach ($temx as $tx) {
                if (ltrim(trim($tx["numeroregistro"]), "0") == '') {
                    $retorno["reeentramite"] = 'si';
                }
            }
        }
        if ($retorno["reeentramite"] != 'si') {
            if ($where != '') {
                $temx = retornarRegistrosMysqliApi($mysqli, 'mreg_reportesmultas', $where, "id");
            } else {
                $temx = false;
            }
            if ($temx && !empty($temx)) {
                foreach ($temx as $tx) {
                    if (ltrim(trim($tx["numeroregistro"]), "0") == '') {
                        $retorno["reeentramite"] = 'si';
                    }
                }
            }
        }
        if ($retorno["reeentramite"] != 'si') {
            if ($where != '') {
                $temx = retornarRegistrosMysqliApi($mysqli, 'mreg_reportessanciones', $where, "id");
            } else {
                $temx = false;
            }
            if ($temx && !empty($temx)) {
                foreach ($temx as $tx) {
                    if (ltrim(trim($tx["numeroregistro"]), "0") == '') {
                        $retorno["reeentramite"] = 'si';
                    }
                }
            }
        }
        if ($retorno["reeentramite"] != 'si') {
            if ($where != '') {
                $temx = retornarRegistrosMysqliApi($mysqli, 'mreg_reportessancionesdisciplinarias', $where, "id");
            } else {
                $temx = false;
            }
            if ($temx && !empty($temx)) {
                foreach ($temx as $tx) {
                    if (ltrim(trim($tx["numeroregistro"]), "0") == '') {
                        $retorno["reeentramite"] = 'si';
                    }
                }
            }
        }

        // ***************************************************************************** //
        // ARMA LISTA COMPLETA DE INSCRIPCIONES
        // Encuentra ultimas fechas de cada acto de control
        // Encuentra el estado de la ultima inscripcion
        // ***************************************************************************** //

        $iInsc = 0;
        if (ltrim($prop, "0") != '') {
            $arrTemInsc = retornarRegistrosMysqliApi($mysqli, 'mreg_est_inscripciones_proponentes', "proponente='" . $arrTem["proponente"] . "'", "fecharegistro,horaregistro");
            if ($arrTemInsc && !empty($arrTemInsc)) {
                foreach ($arrTemInsc as $insc) {
                    $iInsc++;
                    $retorno["inscripciones"][$iInsc] = array(
                        'libro' => $insc["libro"],
                        'registro' => $insc["registro"],
                        'fecharegistro' => $insc["fecharegistro"],
                        'horaregistro' => $insc["horaregistro"],
                        'fechadocumento' => $insc["fechadocumento"],
                        'tipodocumento' => $insc["tipodocumento"],
                        'acto' => $insc["acto"],
                        'fecpublicacionrue' => $insc["fecpublicacionrue"],
                        'idpublicacionrue' => $insc["idpublicacionrue"],
                        'estado' => $insc["estado"],
                        'texto' => $insc["texto"],
                        'ctrrevoca' => $insc["ctrrevoca"],
                        'registrorevocacion' => $insc["registrorevocacion"],
                        'fecharegistrorevocacion' => '' // Ojo calcular - 2017 08 22
                    );
                    if (trim($insc["acto"]) == '01') { // Ultima inscripcion
                        $cantidadnopublicadasrues = 0;
                        $cantidadnofirme = 0;
                        $fecultinsc = $insc["fecharegistro"];
                        $estadoultimainscripcion = $insc["estado"];
                        $estadoultimoacto = $insc["estado"];
                        $fecultren = '';
                        $fecultact = '';
                        $fecultcanc = '';
                        if ($insc["estado"] == '00') {
                            $cantidadnopublicadasrues++;
                        }
                        if ($insc["estado"] != '04') {
                            $cantidadnofirme++;
                        }
                    }
                    if (trim($insc["acto"]) == '16') { // Ultima inscripcion por cambio de domicilio
                        $cantidadnopublicadasrues = 0;
                        $cantidadnofirme = 0;
                        $fecultinsc = $insc["fecharegistro"];
                        $estadoultimainscripcion = '04';
                        $estadoultimoacto = '04'; // Automaticamente queda en firme
                        $fecultren = '';
                        $fecultact = '';
                        $fecultcanc = '';
                        if ($insc["estado"] == '00') {
                            $cantidadnopublicadasrues++;
                        }
                        /*
                          if ($insc["estado"] != '04') {
                          $cantidadnofirme++;
                          }
                         */
                    }
                    if (trim($insc["acto"]) == '02') { // Ultima renovacion
                        $fecultren = $insc["fecharegistro"];
                        $estadoultimoacto = $insc["estado"];
                        if ($insc["estado"] == '00') {
                            $cantidadnopublicadasrues++;
                        }
                        if ($insc["estado"] != '04') {
                            $cantidadnofirme++;
                        }
                    }
                    if (trim($insc["acto"]) == '03') { // Ultima actualización
                        $fecultact = $insc["fecharegistro"];
                        $estadoultimoacto = $insc["estado"];
                        if ($insc["estado"] == '00') {
                            $cantidadnopublicadasrues++;
                        }
                        if ($insc["estado"] != '04') {
                            $cantidadnofirme++;
                        }
                    }
                    if (trim($insc["acto"]) == '04' || trim($insc["acto"]) == '05') { // Ultima cancelacion - cesacion
                        // if ($insc["estado"] == '00') {
                        //     $cantidadnopublicadasrues++;
                        // }
                        $fecultcanc = $insc["fecharegistro"];
                    }
                }
            }

            $retorno["observaciones"] = '';
            if ($cantidadnopublicadasrues > 0) {
                $retorno["observaciones"] .= '!!! CUIDADO !!! Existen inscripciones en libros que no han sido publicadas al RUES';
            }
            if ($cantidadnofirme > 0) {
                if ($retorno["observaciones"] != '') {
                    $retorno["observaciones"] .= '<br><br>';
                }
                $retorno["observaciones"] .= '!!! CUIDADO !!! Existen inscripciones en libros que aún no han adquirido firmeza';
            }
        }

        // ***************************************************************************** //
        // ARMA DATOS ACTUALIZADOS DEL EXPEDIENTE
        // ES LA INFORMACIÓN ACTUAL, INCLUSIVE SI NO ESTÁ EN FIRME
        // ***************************************************************************** //
        // Datos de Identificacion del expediente
        if ($arrTemIns) {
            $retorno["proponente"] = ltrim(trim($arrTemIns["proponente"]), "0");
            $retorno["matricula"] = ltrim(trim($arrTemIns["matricula"]), "0");
            $retorno["ctrestmatricula"] = trim($arrTemIns["ctrestmatricula"]);
            $retorno["fecmatricula"] = trim($arrTemIns["fecmatricula"]);
            $retorno["nombre"] = trim($arrTemIns["razonsocial"]);
            $retorno["ape1"] = trim($arrTemIns["apellido1"]);
            $retorno["ape2"] = trim($arrTemIns["apellido2"]);
            $retorno["nom1"] = trim($arrTemIns["nombre1"]);
            $retorno["nom2"] = trim($arrTemIns["nombre2"]);
            $retorno["sigla"] = trim($arrTemIns["sigla"]);
            $retorno["idtipoidentificacion"] = $arrTemIns["idclase"];
            $retorno["categoria"] = $arrTemIns["categoria"];
            $retorno["identificacion"] = ltrim(trim($arrTemIns["numid"]), "0");

            $retorno["idpaisidentificacion"] = ''; // 20170607 - Nuevo campo por circular única
            $retorno["idmunidoc"] = ''; // 20170607 - Nuevo campo por circular única
            $retorno["fecexpdoc"] = ''; // 20170607 - Nuevo campo por circular única

            $retorno["nit"] = ltrim(trim($arrTemIns["nit"]), "0");
            $retorno["nacionalidad"] = trim($arrTemIns["nacionalidad"]);
            $retorno["organizacion"] = trim($arrTemIns["organizacion"]);
            if ($arrTem) {
                $retorno["tamanoempresa"] = trim($arrTem["tamanoempresa"]);
                $retorno["emprendedor28"] = trim($arrTem["emprendedor28"]);
                $retorno["pemprendedor28"] = trim($arrTem["pemprendedor28"]);
                $retorno["vigcontrol"] = trim($arrTem["vigcontrol"]);
                $retorno["certificardesde"] = trim($arrTem["certificardesde"]);
            }

            // Datos de cambio de domicilio
            $retorno["propcamaraorigen"] = '';
            if ($arrTem) {
                $retorno["cambidom_idmunicipioorigen"] = trim($arrTem["cambidom_idmunicipioorigen"]);
                $retorno["cambidom_idmunicipiodestino"] = trim($arrTem["cambidom_idmunicipiodestino"]);
                $retorno["cambidom_fechaultimainscripcion"] = trim($arrTem["cambidom_fechaultimainscripcion"]);
                $retorno["cambidom_fechaultimarenovacion"] = trim($arrTem["cambidom_fechaultimarenovacion"]);
            }

            // Datos de catalogacion del registro
            $retorno["idestadoproponente"] = trim($arrTemIns["ctrestproponente"]);
            $retorno["fechaultimainscripcion"] = $fecultinsc;
            $retorno["fechaultimarenovacion"] = $fecultren;
            $retorno["fechaultimaactualizacion"] = $fecultact;
            $retorno["fechacancelacion"] = $fecultcanc;

            //LLENA CON INFORMACION DE mreg_est_proponentes
            if ($arrTem) {
                $retorno["idtipodocperjur"] = trim($arrTem["idtipodocperjur"]);
                $retorno["numdocperjur"] = trim($arrTem["numdocperjur"]);
                $retorno["fecdocperjur"] = trim($arrTem["fechaconstitucion"]);
                $retorno["origendocperjur"] = trim($arrTem["origendocperjur"]);
                $retorno["fechaconstitucion"] = trim($arrTem["fechaconstitucion"]);
                $retorno["fechavencimiento"] = trim($arrTem["fechavencimiento"]);
            }

            // informacion de ubicacion comercial en el registro mercantil
            if ($arrTem) {
                $retorno["dircom"] = trim($arrTem["dircom"]);
                $retorno["dircom_tipovia"] = '';
                $retorno["dircom_numvia"] = '';
                $retorno["dircom_apevia"] = '';
                $retorno["dircom_orivia"] = '';
                $retorno["dircom_numcruce"] = '';
                $retorno["dircom_apecruce"] = '';
                $retorno["dircom_oricruce"] = '';
                $retorno["dircom_numplaca"] = '';
                $retorno["dircom_complemento"] = '';
                $retorno["muncom"] = trim($arrTem["muncom"]);
                $retorno["paicom"] = '';  // Nuevo campo circular 002
                $retorno["telcom1"] = trim($arrTem["telcom1"]);
                $retorno["telcom2"] = trim($arrTem["telcom2"]);
                $retorno["faxcom"] = trim($arrTem["faxcom"]);
                $retorno["celcom"] = trim($arrTem["celcom"]);
                $retorno["emailcom"] = trim($arrTem["emailcom"]);
                $retorno["enviarint"] = trim($arrTem["enviarint"]);
                $retorno["codigopostalcom"] = ''; // Nuevo campo circular 002
                $retorno["codigozonacom"] = ''; // Nuevo campo circular 002 R/U
                // informacion de ubicacion de notificacion
                $retorno["dirnot"] = trim($arrTem["dirnot"]);
                $retorno["dirnot_tipovia"] = '';
                $retorno["dirnot_numvia"] = '';
                $retorno["dirnot_apevia"] = '';
                $retorno["dirnot_orivia"] = '';
                $retorno["dirnot_numcruce"] = '';
                $retorno["dirnot_apecruce"] = '';
                $retorno["dirnot_oricruce"] = '';
                $retorno["dirnot_numplaca"] = '';
                $retorno["dirnot_complemento"] = '';
                $retorno["munnot"] = trim($arrTem["munnot"]);
                $retorno["painot"] = '';  // Nuevo campo circular 002
                $retorno["telnot"] = trim($arrTem["telnot"]);
                $retorno["telnot2"] = trim($arrTem["telnot2"]);
                $retorno["faxnot"] = trim($arrTem["faxnot"]);
                $retorno["celnot"] = trim($arrTem["celnot"]);
                $retorno["emailnot"] = trim($arrTem["emailnot"]);
                $retorno["enviarnot"] = trim($arrTem["enviarnot"]);
                $retorno["codigopostalnot"] = ''; // Nuevo campo circular 002
                $retorno["codigozonanot"] = ''; // Nuevo campo circular 002 R/U
                $retorno["facultades"] = trim($arrTem["facultades"]);
            }

            // Informacion financiera decreto 1510
            if ($arrTem) {
                $retorno["gruponiif"] = ''; // Nuevo campo circular 002 - (pagina 2 del formulario)
                $retorno["gruponiiftextual"] = ''; // Nuevo campo circular 002 - (Anexo 2 hoja 1)
                $retorno["marcotecnicoanterior"] = ''; // Nuevo campo circular 002 - (Anexo 2 hoja 1)
                $retorno["inffin1510_fechacorte"] = trim($arrTem["inffin1510_fechacorte"]);
                $retorno["inffin1510_actcte"] = trim($arrTem["inffin1510_actcte"]);
                $retorno["inffin1510_actnocte"] = trim($arrTem["inffin1510_actnocte"]);
                $retorno["inffin1510_fijnet"] = trim($arrTem["inffin1510_fijnet"]);
                $retorno["inffin1510_actotr"] = trim($arrTem["inffin1510_actotr"]);
                $retorno["inffin1510_actval"] = trim($arrTem["inffin1510_actval"]);
                $retorno["inffin1510_acttot"] = trim($arrTem["inffin1510_acttot"]);

                $retorno["inffin1510_pascte"] = trim($arrTem["inffin1510_pascte"]);
                $retorno["inffin1510_paslar"] = trim($arrTem["inffin1510_paslar"]);
                $retorno["inffin1510_pastot"] = trim($arrTem["inffin1510_pastot"]);
                $retorno["inffin1510_patnet"] = trim($arrTem["inffin1510_patnet"]);
                $retorno["inffin1510_paspat"] = trim($arrTem["inffin1510_paspat"]);
                $retorno["inffin1510_balsoc"] = trim($arrTem["inffin1510_balsoc"]);

                $retorno["inffin1510_ingope"] = trim($arrTem["inffin1510_ingope"]);
                $retorno["inffin1510_ingnoope"] = trim($arrTem["inffin1510_ingnoope"]);
                $retorno["inffin1510_gasope"] = trim($arrTem["inffin1510_gasope"]);
                $retorno["inffin1510_gasnoope"] = trim($arrTem["inffin1510_gasnoope"]);
                $retorno["inffin1510_cosven"] = trim($arrTem["inffin1510_cosven"]);
                $retorno["inffin1510_utinet"] = trim($arrTem["inffin1510_utinet"]);
                $retorno["inffin1510_utiope"] = trim($arrTem["inffin1510_utiope"]);
                $retorno["inffin1510_gasint"] = trim($arrTem["inffin1510_gasint"]);
                $retorno["inffin1510_gasimp"] = trim($arrTem["inffin1510_gasimp"]);

                $retorno["inffin1510_indliq"] = trim($arrTem["inffin1510_indliq"]);
                $retorno["inffin1510_nivend"] = trim($arrTem["inffin1510_nivend"]);
                $retorno["inffin1510_razcob"] = trim($arrTem["inffin1510_razcob"]);
                $retorno["inffin1510_renpat"] = trim($arrTem["inffin1510_renpat"]);
                $retorno["inffin1510_renact"] = trim($arrTem["inffin1510_renact"]);

                // 2017-04-17: JINT: COn  el animo de mitigar el problema de los decimales en el certificado
                if (doubleval($retorno["inffin1510_patnet"]) != 0) {
                    $retorno["inffin1510_renpat"] = $retorno["inffin1510_utiope"] / $retorno["inffin1510_patnet"];
                }

                if (doubleval($retorno["inffin1510_acttot"]) != 0) {
                    $retorno["inffin1510_renact"] = $retorno["inffin1510_utiope"] / $retorno["inffin1510_acttot"];
                }

                //
                $retorno["inffin1510_actnocte"] = $retorno["inffin1510_actnocte"] +
                        $retorno["inffin1510_fijnet"] +
                        $retorno["inffin1510_actotr"] +
                        $retorno["inffin1510_actval"];

                $retorno["inffin1510_gruponiif"] = trim($arrTem["gruponiif"]);
            }
        }

        //
        if ($arrTemMer) {
            $arrTemx = \funcionesRegistrales::retornarExpedienteMercantil($mysqli, $arrTemMer["matricula"], '', '', '', 'N');
            $retorno["nombre"] = trim($arrTemMer["razonsocial"]);
            $retorno["ape1"] = trim($arrTemMer["apellido1"]);
            $retorno["ape2"] = trim($arrTemMer["apellido2"]);
            $retorno["nom1"] = trim($arrTemMer["nombre1"]);
            $retorno["nom2"] = trim($arrTemMer["nombre2"]);
            $retorno["sigla"] = trim($arrTemMer["sigla"]);

            $retorno["tipoidentificacion"] = $arrTemMer["idclase"];
            $retorno["categoria"] = $arrTemMer["categoria"];

            $retorno["identificacion"] = ltrim(trim($arrTemMer["numid"]), "0");
            $retorno["idpaisidentificacion"] = '';
            $retorno["nit"] = ltrim(trim($arrTemMer["nit"]), "0");
            $retorno["nacionalidad"] = trim($arrTemMer["nacionalidad"]);
            $retorno["organizacion"] = trim($arrTemMer["organizacion"]);
            // $retorno["tamanoempresa"] = trim($arrTemMer["tamanoempresa"]);
            $retorno["emprendedor28"] = trim($arrTemMer["emprendedor28"]);
            $retorno["pemprendedor28"] = trim($arrTemMer["pemprendedor28"]);
            $retorno["vigcontrol"] = trim($arrTemMer["vigcontrol"]);

            //LLENA CON INFORMACION DE mreg_est_proponentes
            $retorno["idtipodocperjur"] = '';
            $retorno["numdocperjur"] = '';
            $retorno["fecdocperjur"] = '';
            $retorno["origendocperjur"] = '';
            $retorno["fechaconstitucion"] = trim($arrTemx["fechaconstitucion"]);
            $retorno["fechavencimiento"] = trim($arrTemx["fechavencimiento"]);
            if (trim($retorno["fechavencimiento"]) == '99999999') {
                $retorno["fechavencimiento"] = '';
            }

            //
            if ($retorno["organizacion"] > '02') {
                foreach ($arrTemx["inscripciones"] as $ix) {
                    if ($ix["grupoacto"] == '005') {
                        $retorno["idtipodocperjur"] = $ix["tdoc"];
                        $retorno["numdocperjur"] = $ix["ndoc"];
                        $retorno["fecdocperjur"] = $ix["fdoc"];
                        $retorno["origendocperjur"] = $ix["txoridoc"];
                    }
                }
                if ($retorno["idtipodocperjur"] == '') {
                    $retorno["numdocperjur"] = $arrTemx["numperj"];
                    $retorno["fecdocperjur"] = $arrTemx["fecperj"];
                }
            }


            //
            $retorno["dircom"] = trim($arrTemMer["dircom"]);
            $retorno["dircom_tipovia"] = '';
            $retorno["dircom_numvia"] = '';
            $retorno["dircom_apevia"] = '';
            $retorno["dircom_orivia"] = '';
            $retorno["dircom_numcruce"] = '';
            $retorno["dircom_apecruce"] = '';
            $retorno["dircom_oricruce"] = '';
            $retorno["dircom_numplaca"] = '';
            $retorno["dircom_complemento"] = '';
            $retorno["muncom"] = trim($arrTemMer["muncom"]);
            $retorno["paicom"] = trim($arrTemMer["paicom"]);
            $retorno["telcom1"] = trim($arrTemMer["telcom1"]);
            $retorno["telcom2"] = trim($arrTemMer["telcom2"]);
            $retorno["faxcom"] = trim($arrTemMer["faxcom"]);
            $retorno["celcom"] = trim($arrTemMer["telcom3"]);
            $retorno["emailcom"] = trim($arrTemMer["emailcom"]);
            $retorno["enviarint"] = trim($arrTemMer["ctrnotemail"]);
            $retorno["codigopostalcom"] = trim($arrTemMer["codigopostalcom"]);
            $retorno["codigozonacom"] = trim($arrTemMer["codigozonacom"]);


            // informacion de ubicacion de notificacion
            $retorno["dirnot"] = trim($arrTemMer["dirnot"]);
            $retorno["dirnot_tipovia"] = '';
            $retorno["dirnot_numvia"] = '';
            $retorno["dirnot_apevia"] = '';
            $retorno["dirnot_orivia"] = '';
            $retorno["dirnot_numcruce"] = '';
            $retorno["dirnot_apecruce"] = '';
            $retorno["dirnot_oricruce"] = '';
            $retorno["dirnot_numplaca"] = '';
            $retorno["dirnot_complemento"] = '';
            $retorno["munnot"] = trim($arrTemMer["munnot"]);
            $retorno["painot"] = trim($arrTemMer["painot"]);
            $retorno["telnot"] = trim($arrTemMer["telnot"]);
            $retorno["telnot2"] = trim($arrTemMer["telnot2"]);
            $retorno["faxnot"] = trim($arrTemMer["faxnot"]);
            $retorno["celnot"] = trim($arrTemMer["telnot3"]);
            $retorno["emailnot"] = trim($arrTemMer["emailnot"]);
            $retorno["enviarnot"] = trim($arrTemMer["ctrnotsms"]);
            $retorno["codigopostalnot"] = trim($arrTemMer["codigopostalnot"]);
            $retorno["codigozonanot"] = ''; // Adicionado con circular 002

            if (isset($arrTemx["crtsii"]["0041"]) && trim($arrTemx["crtsii"]["0041"]) != '') {
                $retorno["crt0041"] = $arrTemx["crtsii"]["0041"]; // Adicionado con circular 002
            } else {
                if (isset($arrTemx["crt"]["0041"]) && trim($arrTemx["crt"]["0041"]) != '') {
                    $retorno["crt0041"] = $arrTemx["crt"]["0041"]; // Adicionado con circular 
                }
            }

            if (isset($arrTemx["crtsii"]["1121"]) && trim($arrTemx["crtsii"]["1121"]) != '') {
                $retorno["crt1121"] = $arrTemx["crtsii"]["1121"]; // Adicionado con circular 002
            } else {
                if (isset($arrTemx["crt"]["1121"]) && trim($arrTemx["crt"]["1121"]) != '') {
                    $retorno["crt1121"] = $arrTemx["crt"]["1121"]; // Adicionado con circular 
                }
            }

            // Localiza vínculos de representación legal
            $i = 0;
            if (!empty($arrTemx["vinculos"])) {
                foreach ($arrTemx["vinculos"] as $v) {
                    if ($v["tipovinculo"] == 'RLP' ||
                            $v["tipovinculo"] == 'RLS' ||
                            $v["tipovinculo"] == 'RLS1' ||
                            $v["tipovinculo"] == 'RLS2' ||
                            $v["tipovinculo"] == 'RLS3' ||
                            $v["tipovinculo"] == 'RLS4') {
                        $i++;
                        $retorno["representanteslegales"][$i]["idtipoidentificacionrepleg"] = $v["idtipoidentificacionotros"];
                        $retorno["representanteslegales"][$i]["identificacionrepleg"] = $v["identificacionotros"];
                        $retorno["representanteslegales"][$i]["paisrepleg"] = $v["paisotros"];
                        $retorno["representanteslegales"][$i]["nombrerepleg"] = $v["nombreotros"];
                        $retorno["representanteslegales"][$i]["cargorepleg"] = $v["cargootros"];
                        $retorno["representanteslegales"][$i]["nom1"] = $v["nombre1otros"];
                        $retorno["representanteslegales"][$i]["nom2"] = $v["nombre2otros"];
                        $retorno["representanteslegales"][$i]["ape1"] = $v["apellido1otros"];
                        $retorno["representanteslegales"][$i]["ape2"] = $v["apellido2otros"];
                    }
                }
            }

            // Localiza facultades de los comerciantes
            $retorno["facultades"] = '';
            $certs = retornarRegistrosMysqliApi($mysqli, 'mreg_codigos_certificas', "clase IN ('CRT-FACULTADES','CRT-ORGADM')", "id");
            if ($certs && !empty($certs)) {
                foreach ($certs as $cr) {
                    if (isset($arrTemx["crtsii"][$cr["id"]]) && trim($arrTemx["crtsii"][$cr["id"]]) != '') {
                        if ($retorno["facultades"] != '') {
                            $retorno["facultades"] .= "\r\n";
                        }
                        $retorno["facultades"] .= \funcionesGenerales::reemplazarAcutes($arrTemx["crtsii"][$cr["id"]]);
                    }
                }
                if (trim($retorno["facultades"]) == '') {
                    foreach ($certs as $cr) {
                        if (isset($arrTemx["crt"][$cr["id"]]) && trim($arrTemx["crt"][$cr["id"]]) != '') {
                            if ($retorno["facultades"] != '') {
                                $retorno["facultades"] .= "\r\n";
                            }
                            $retorno["facultades"] .= str_replace(array("||", "|"), array(chr(13), chr(10), " "), $arrTemx["crt"][$cr["id"]]);
                        }
                    }
                }
            }


            //
            unset($arrTemx);
        }


        // Busca Representantes Legales - Cuando no es comerciante
        $i = 0;
        if ($arrTemMer === false && $arrTem) {
            $arrTemVin = retornarRegistrosMysqliApi($mysqli, 'mreg_est_proponentes_representacion', "proponente='" . $arrTem["proponente"] . "'", "id");
            foreach ($arrTemVin as $v) {
                $i++;
                $retorno["representanteslegales"][$i]["idtipoidentificacionrepleg"] = $v["tipoidentificacion"];
                $retorno["representanteslegales"][$i]["identificacionrepleg"] = $v["identificacion"];
                $retorno["representanteslegales"][$i]["paisrepleg"] = ''; // nace con circular 002
                $retorno["representanteslegales"][$i]["nombrerepleg"] = $v["nombre"];
                $retorno["representanteslegales"][$i]["cargorepleg"] = $v["cargo"];
                $retorno["representanteslegales"][$i]["nom1"] = '';
                $retorno["representanteslegales"][$i]["nom2"] = '';
                $retorno["representanteslegales"][$i]["ape1"] = '';
                $retorno["representanteslegales"][$i]["ape2"] = '';
            }
        }

        // Busca Situaciones de control
        if (ltrim($prop, "0") != '') {
            $i = 0;
            $arrTemCer = retornarRegistrosMysqliApi($mysqli, 'mreg_est_proponentes_sitcontrol', "proponente='" . ltrim($prop, "0") . "'", "secuencia");
            foreach ($arrTemCer as $c) {
                $i++;
                $retorno["sitcontrol"][$i]["nombre"] = $c["nombre"];
                $retorno["sitcontrol"][$i]["identificacion"] = $c["identificacion"];
                $retorno["sitcontrol"][$i]["domicilio"] = $c["domicilio"];
                $retorno["sitcontrol"][$i]["tipo"] = $c["tipo"];
            }
        }

        // Busca clasificaciones
        if (ltrim($prop, "0") != '') {
            $i = 0;
            $retorno["clasi1510"] = array();
            $arrTemCer = retornarRegistrosMysqliApi($mysqli, 'mreg_est_proponentes_unspsc', "proponente='" . ltrim($prop, "0") . "'", "unspsc");
            foreach ($arrTemCer as $c) {
                $i++;
                $retorno["clasi1510"][$i] = $c["unspsc"];
            }
        }

        // Busca experiencia
        if (ltrim($prop, "0") != '') {
            $i = 0;
            $retorno["exp1510"] = array();
            $arrTemCer = retornarRegistrosMysqliApi($mysqli, 'mreg_est_proponentes_experiencia', "proponente='" . ltrim($prop, "0") . "'", "secuencia");
            foreach ($arrTemCer as $c) {
                $i++;
                $retorno["exp1510"][$i]["secuencia"] = $c["secuencia"];
                $retorno["exp1510"][$i]["clavecontrato"] = '';
                $retorno["exp1510"][$i]["celebradopor"] = $c["celebradopor"];
                $retorno["exp1510"][$i]["nombrecontratista"] = \funcionesGenerales::restaurarEspeciales(str_replace("?", "", trim($c["nombrecontratista"])));
                $retorno["exp1510"][$i]["nombrecontratante"] = \funcionesGenerales::restaurarEspeciales(str_replace("?", "", trim($c["nombrecontratante"])));
                $retorno["exp1510"][$i]["fecejecucion"] = $c["fecejecucion"];
                $retorno["exp1510"][$i]["valor"] = $c["valor"];
                $retorno["exp1510"][$i]["porcentaje"] = $c["porcentaje"];
                $retorno["exp1510"][$i]["clasif"] = array();
                $arrx = explode(",", $c["clasificaciones"]);
                $iCla = 0;
                $tx = array();
                if (trim($c["clasificaciones"]) != '') {
                    if (!empty($arrx)) {
                        foreach ($arrx as $x) {
                            $x = trim($x);
                            if (!isset($tx[$x])) {
                                $iCla++;
                                $retorno["exp1510"][$i]["clasif"][$iCla] = trim($x);
                                $tx[$x] = $x;
                            }
                        }
                    }
                }
                unset($tx);
                $retorno["exp1510"][$i]["soportedeclaracion"] = '';
                $retorno["exp1510"][$i]["soportecontrato"] = '';
                $retorno["exp1510"][$i]["generardeclaracion"] = '';
                $retorno["exp1510"][$i]["revisado"] = '';
            }
        }

        // ***************************************************************************** //
        // ARMA ARREGLO DE DATOS EN FIRME
        // ***************************************************************************** //
        $retorno["enfirme"]["proponente"] = $retorno["proponente"];
        $retorno["enfirme"]["matricula"] = $retorno["matricula"];
        $retorno["enfirme"]["fecmatricula"] = $retorno["fecmatricula"];
        $retorno["enfirme"]["ctrestmatricula"] = $retorno["ctrestmatricula"];
        $retorno["enfirme"]["nombre"] = $retorno["nombre"];
        $retorno["enfirme"]["ape1"] = $retorno["ape1"];
        $retorno["enfirme"]["ape2"] = $retorno["ape2"];
        $retorno["enfirme"]["nom1"] = $retorno["nom1"];
        $retorno["enfirme"]["nom2"] = $retorno["nom2"];
        $retorno["enfirme"]["sigla"] = $retorno["sigla"];
        $retorno["enfirme"]["idtipoidentificacion"] = $retorno["idtipoidentificacion"];
        $retorno["enfirme"]["categoria"] = $retorno["categoria"];
        $retorno["enfirme"]["identificacion"] = $retorno["identificacion"];
        $retorno["enfirme"]["idpaisidentificacion"] = $retorno["idpaisidentificacion"];
        $retorno["enfirme"]["nit"] = $retorno["nit"];
        $retorno["enfirme"]["nacionalidad"] = $retorno["nacionalidad"];
        $retorno["enfirme"]["organizacion"] = $retorno["organizacion"];
        $retorno["enfirme"]["tamanoempresa"] = $retorno["tamanoempresa"];
        $retorno["enfirme"]["emprendedor28"] = $retorno["emprendedor28"];
        $retorno["enfirme"]["pemprendedor28"] = $retorno["pemprendedor28"];
        $retorno["enfirme"]["vigcontrol"] = $retorno["vigcontrol"];

        $retorno["enfirme"]["idestadoproponente"] = $retorno["idestadoproponente"];
        $retorno["enfirme"]["fechaultimainscripcion"] = $retorno["fechaultimainscripcion"];
        $retorno["enfirme"]["fechaultimarenovacion"] = $retorno["fechaultimarenovacion"];
        $retorno["enfirme"]["fechaultimaactualizacion"] = $retorno["fechaultimaactualizacion"];
        $retorno["enfirme"]["fechacancelacion"] = $retorno["fechacancelacion"];

        // Datos de cambio de domicilio
        $retorno["enfirme"]["propcamaraorigen"] = $retorno["propcamaraorigen"];
        $retorno["enfirme"]["cambidom_idmunicipioorigen"] = $retorno["cambidom_idmunicipioorigen"];
        $retorno["enfirme"]["cambidom_idmunicipiodestino"] = $retorno["cambidom_idmunicipiodestino"];
        $retorno["enfirme"]["cambidom_fechaultimainscripcion"] = $retorno["cambidom_fechaultimainscripcion"];
        $retorno["enfirme"]["cambidom_fechaultimarenovacion"] = $retorno["cambidom_fechaultimarenovacion"];

        $retorno["enfirme"]["dircom"] = $retorno["dircom"];
        $retorno["enfirme"]["muncom"] = $retorno["muncom"];
        $retorno["enfirme"]["telcom1"] = $retorno["telcom1"];
        $retorno["enfirme"]["telcom2"] = $retorno["telcom2"];
        $retorno["enfirme"]["faxcom"] = $retorno["faxcom"];
        $retorno["enfirme"]["celcom"] = $retorno["celcom"];
        $retorno["enfirme"]["emailcom"] = $retorno["emailcom"];
        $retorno["enfirme"]["enviarint"] = $retorno["enviarint"];

        // informacion de ubicacion de notificacion
        $retorno["enfirme"]["dirnot"] = $retorno["dirnot"];
        $retorno["enfirme"]["munnot"] = $retorno["munnot"];
        $retorno["enfirme"]["telnot"] = $retorno["telnot"];
        $retorno["enfirme"]["telnot2"] = $retorno["telnot2"];
        $retorno["enfirme"]["faxnot"] = $retorno["faxnot"];
        $retorno["enfirme"]["celnot"] = $retorno["celnot"];
        $retorno["enfirme"]["emailnot"] = $retorno["emailnot"];
        $retorno["enfirme"]["enviarnot"] = $retorno["enviarnot"];

        //
        $retorno["enfirme"]["inffin1510_fechacorte"] = $retorno["inffin1510_fechacorte"];
        $retorno["enfirme"]["inffin1510_actcte"] = $retorno["inffin1510_actcte"];
        $retorno["enfirme"]["inffin1510_actnocte"] = $retorno["inffin1510_actnocte"];
        $retorno["enfirme"]["inffin1510_fijnet"] = $retorno["inffin1510_fijnet"];
        $retorno["enfirme"]["inffin1510_actotr"] = $retorno["inffin1510_actotr"];
        $retorno["enfirme"]["inffin1510_actval"] = $retorno["inffin1510_actval"];
        $retorno["enfirme"]["inffin1510_acttot"] = $retorno["inffin1510_acttot"];
        $retorno["enfirme"]["inffin1510_pascte"] = $retorno["inffin1510_pascte"];
        $retorno["enfirme"]["inffin1510_paslar"] = $retorno["inffin1510_paslar"];
        $retorno["enfirme"]["inffin1510_pastot"] = $retorno["inffin1510_pastot"];
        $retorno["enfirme"]["inffin1510_patnet"] = $retorno["inffin1510_patnet"];
        $retorno["enfirme"]["inffin1510_paspat"] = $retorno["inffin1510_paspat"];
        $retorno["enfirme"]["inffin1510_balsoc"] = $retorno["inffin1510_balsoc"];
        $retorno["enfirme"]["inffin1510_ingope"] = $retorno["inffin1510_ingope"];
        $retorno["enfirme"]["inffin1510_ingnoope"] = $retorno["inffin1510_ingnoope"];


        //
        $retorno["enfirme"]["inffin1510_gasope"] = $retorno["inffin1510_gasope"];
        $retorno["enfirme"]["inffin1510_gasnoope"] = $retorno["inffin1510_gasnoope"];
        $retorno["enfirme"]["inffin1510_cosven"] = $retorno["inffin1510_cosven"];
        $retorno["enfirme"]["inffin1510_utinet"] = $retorno["inffin1510_utinet"];
        $retorno["enfirme"]["inffin1510_utiope"] = $retorno["inffin1510_utiope"];
        $retorno["enfirme"]["inffin1510_gasint"] = $retorno["inffin1510_gasint"];
        $retorno["enfirme"]["inffin1510_gasimp"] = $retorno["inffin1510_gasimp"];
        $retorno["enfirme"]["inffin1510_indliq"] = $retorno["inffin1510_indliq"];
        $retorno["enfirme"]["inffin1510_nivend"] = $retorno["inffin1510_nivend"];

        //
        $retorno["enfirme"]["inffin1510_razcob"] = $retorno["inffin1510_razcob"];
        $retorno["enfirme"]["inffin1510_renpat"] = $retorno["inffin1510_renpat"];
        $retorno["enfirme"]["inffin1510_renact"] = $retorno["inffin1510_renact"];

        // 2017-04-17: JINT: COn  el animo de mitigar el problema de los decimales en el certificado
        if (doubleval($retorno["enfirme"]["inffin1510_patnet"]) != 0) {
            $retorno["enfirme"]["inffin1510_renpat"] = $retorno["enfirme"]["inffin1510_utiope"] / $retorno["enfirme"]["inffin1510_patnet"];
        }

        if (doubleval($retorno["enfirme"]["inffin1510_acttot"]) != 0) {
            $retorno["enfirme"]["inffin1510_renact"] = $retorno["enfirme"]["inffin1510_utiope"] / $retorno["enfirme"]["inffin1510_acttot"];
        }

        $retorno["enfirme"]["inffin1510_gruponiif"] = $retorno["inffin1510_gruponiif"];

        //
        $retorno["enfirme"]["representanteslegales"] = $retorno["representanteslegales"];
        $retorno["enfirme"]["sitcontrol"] = $retorno["sitcontrol"];
        $retorno["enfirme"]["clasi1510"] = $retorno["clasi1510"];
        $retorno["enfirme"]["exp1510"] = $retorno["exp1510"];

        // 2017-09-20: JINT: Para no invocar dos veces a retornarExpedienteMercantil
        $retorno["enfirme"]["idtipodocperjur"] = $retorno["idtipodocperjur"];
        $retorno["enfirme"]["numdocperjur"] = $retorno["numdocperjur"];
        $retorno["enfirme"]["fecdocperjur"] = $retorno["fecdocperjur"];
        $retorno["enfirme"]["origendocperjur"] = $retorno["origendocperjur"];
        $retorno["enfirme"]["fechaconstitucion"] = $retorno["fechaconstitucion"];
        $retorno["enfirme"]["fechavencimiento"] = $retorno["fechavencimiento"];
        $retorno["enfirme"]["facultades"] = $retorno["facultades"];
        $retorno["enfirme"]["crt0041"] = $retorno["crt0041"];
        $retorno["enfirme"]["crt1121"] = $retorno["crt1121"];

        // En caso que la última inscripción no esté en firme
        if ($arrTemMer === false && $estadoultimainscripcion != '04') {
            unset($retorno["enfirme"]["tamanoempresa"]);
            unset($retorno["enfirme"]["idtipodocperjur"]);
            unset($retorno["enfirme"]["numdocperjur"]);
            unset($retorno["enfirme"]["fecdocperjur"]);
            unset($retorno["enfirme"]["origendocperjur"]);
            unset($retorno["enfirme"]["fechaconstitucion"]);
            unset($retorno["enfirme"]["fechavencimiento"]);
            unset($retorno["enfirme"]["facultades"]);
            unset($retorno["enfirme"]["representanteslegales"]);
        }
        if ($estadoultimainscripcion != '' && $estadoultimainscripcion != '04') {
            unset($retorno["enfirme"]["sitcontrol"]);
            unset($retorno["enfirme"]["exp1510"]);
            unset($retorno["enfirme"]["inffin1510_fechacorte"]);
            unset($retorno["enfirme"]["inffin1510_actcte"]);
            unset($retorno["enfirme"]["inffin1510_actnocte"]);
            unset($retorno["enfirme"]["inffin1510_fijnet"]);
            unset($retorno["enfirme"]["inffin1510_actotr"]);
            unset($retorno["enfirme"]["inffin1510_actval"]);
            unset($retorno["enfirme"]["inffin1510_acttot"]);
            unset($retorno["enfirme"]["inffin1510_pascte"]);
            unset($retorno["enfirme"]["inffin1510_paslar"]);
            unset($retorno["enfirme"]["inffin1510_pastot"]);
            unset($retorno["enfirme"]["inffin1510_patnet"]);
            unset($retorno["enfirme"]["inffin1510_paspat"]);
            unset($retorno["enfirme"]["inffin1510_balsoc"]);
            unset($retorno["enfirme"]["inffin1510_ingope"]);
            unset($retorno["enfirme"]["inffin1510_ingnoope"]);
            unset($retorno["enfirme"]["inffin1510_gasope"]);
            unset($retorno["enfirme"]["inffin1510_gasnoope"]);
            unset($retorno["enfirme"]["inffin1510_cosven"]);
            unset($retorno["enfirme"]["inffin1510_utinet"]);
            unset($retorno["enfirme"]["inffin1510_utiope"]);
            unset($retorno["enfirme"]["inffin1510_gasint"]);
            unset($retorno["enfirme"]["inffin1510_gasimp"]);
            unset($retorno["enfirme"]["inffin1510_indliq"]);
            unset($retorno["enfirme"]["inffin1510_nivend"]);
            unset($retorno["enfirme"]["inffin1510_razcob"]);
            unset($retorno["enfirme"]["inffin1510_renpat"]);
            unset($retorno["enfirme"]["inffin1510_renact"]);
            unset($retorno["enfirme"]["inffin1510_gruponiif"]);
            // unset($retorno["enfirme"]["representanteslegales"]);
        }

        // ************************************************************************* //
        // Si el estado del ultimo acto es diferente a en firme (04)
        // Busca las inscripciones que no estan en firme
        // Si el expediente se recupera para una actualización especial solamente
        // recupera la información que está en firme
        // ************************************************************************* //
        if ($tipotramite != 'actualizacionespecial' && $arrTem) {
            if ($estadoultimoacto != '04') {
                $inscnofirme = 0;
                // Busca inscripciones que no estén en firme 
                // Para actualizar la información del proponente
                // Solo tiene en cuenta:
                // - Datos de constitución - si no es comerciante
                // - Facultades - si no es comerciante
                // - Representantes Legales - Si no es comerciante
                // - Financiera
                // - Experiencia - Solo los contratos que hubieren cambiado
                // - Situaciones de control
                $arrTemInsc = retornarRegistrosMysqliApi($mysqli, 'mreg_est_inscripciones_proponentes', "proponente='" . $arrTem["proponente"] . "' and fecharegistro >= '20160101'", "fecharegistro,horaregistro");
                if ($arrTemInsc && !empty($arrTemInsc)) {
                    foreach ($arrTemInsc as $insc) {
                        if (trim($insc["acto"]) == '01' && ($insc["estado"] == '00' || $insc["estado"] == '01')) {
                            $inscnofirme++;
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["datosmodificados"] = 'si';
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["libro"] = $insc["libro"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["registro"] = $insc["registro"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["fecharegistro"] = $insc["fecharegistro"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["fecpublicacionrue"] = $insc["fecpublicacionrue"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["acto"] = $insc["acto"];
                            $arrXml = \funcionesGenerales::desserializarExpedienteProponente($mysqli, $insc["xml"]);
                            if ($arrTemMer === false) {
                                $retorno["idtipodocperjur"] = $arrXml["idtipodocperjur"];
                                $retorno["numdocperjur"] = $arrXml["numdocperjur"];
                                $retorno["fecdocperjur"] = $arrXml["fecdocperjur"];
                                $retorno["origendocperjur"] = $arrXml["origendocperjur"];
                                $retorno["fechaconstitucion"] = $arrXml["fechaconstitucion"];
                                $retorno["fechavencimiento"] = $arrXml["fechavencimiento"];
                                $retorno["facultades"] = $arrXml["facultades"];
                                $retorno["representanteslegales"] = $arrXml["representanteslegales"];

                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["idtipodocperjur"] = $arrXml["idtipodocperjur"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["numdocperjur"] = $arrXml["numdocperjur"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["fecdocperjur"] = $arrXml["fecdocperjur"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["origendocperjur"] = $arrXml["origendocperjur"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["fechaconstitucion"] = $arrXml["fechaconstitucion"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["fechavencimiento"] = $arrXml["fechavencimiento"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["facultades"] = $arrXml["facultades"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["representanteslegales"] = $arrXml["representanteslegales"];
                            }

                            $retorno["tamanoempresa"] = $arrXml["tamanoempresa"];
                            $retorno["sitcontrol"] = $arrXml["sitcontrol"];
                            $retorno["exp1510"] = $arrXml["exp1510"];
                            $retorno["inffin1510_fechacorte"] = $arrXml["inffin1510_fechacorte"];
                            $retorno["inffin1510_actcte"] = $arrXml["inffin1510_actcte"];
                            $retorno["inffin1510_actnocte"] = $arrXml["inffin1510_actnocte"];
                            $retorno["inffin1510_fijnet"] = $arrXml["inffin1510_fijnet"];
                            $retorno["inffin1510_actotr"] = $arrXml["inffin1510_actotr"];
                            $retorno["inffin1510_actval"] = $arrXml["inffin1510_actval"];
                            $retorno["inffin1510_acttot"] = $arrXml["inffin1510_acttot"];
                            $retorno["inffin1510_pascte"] = $arrXml["inffin1510_pascte"];
                            $retorno["inffin1510_paslar"] = $arrXml["inffin1510_paslar"];
                            $retorno["inffin1510_pastot"] = $arrXml["inffin1510_pastot"];
                            $retorno["inffin1510_patnet"] = $arrXml["inffin1510_patnet"];
                            $retorno["inffin1510_paspat"] = $arrXml["inffin1510_paspat"];
                            $retorno["inffin1510_balsoc"] = $arrXml["inffin1510_balsoc"];
                            $retorno["inffin1510_ingope"] = $arrXml["inffin1510_ingope"];
                            $retorno["inffin1510_ingnoope"] = $arrXml["inffin1510_ingnoope"];
                            $retorno["inffin1510_gasope"] = $arrXml["inffin1510_gasope"];
                            $retorno["inffin1510_gasnoope"] = $arrXml["inffin1510_gasnoope"];
                            $retorno["inffin1510_cosven"] = $arrXml["inffin1510_cosven"];
                            $retorno["inffin1510_utinet"] = $arrXml["inffin1510_utinet"];
                            $retorno["inffin1510_utiope"] = $arrXml["inffin1510_utiope"];
                            $retorno["inffin1510_gasint"] = $arrXml["inffin1510_gasint"];
                            $retorno["inffin1510_gasimp"] = $arrXml["inffin1510_gasimp"];
                            $retorno["inffin1510_indliq"] = $arrXml["inffin1510_indliq"];
                            $retorno["inffin1510_nivend"] = $arrXml["inffin1510_nivend"];
                            $retorno["inffin1510_razcob"] = $arrXml["inffin1510_razcob"];
                            $retorno["inffin1510_renpat"] = $arrXml["inffin1510_renpat"];
                            $retorno["inffin1510_renact"] = $arrXml["inffin1510_renact"];

                            // 2017-04-17: JINT: COn  el animo de mitigar el problema de los decimales en el certificado
                            if (doubleval($retorno["inffin1510_patnet"]) != 0) {
                                $retorno["inffin1510_renpat"] = $retorno["inffin1510_utiope"] / $retorno["inffin1510_patnet"];
                            }

                            if (doubleval($retorno["inffin1510_acttot"]) != 0) {
                                $retorno["inffin1510_renact"] = $retorno["inffin1510_utiope"] / $retorno["inffin1510_acttot"];
                            }


                            $retorno["inffin1510_actnocte"] = $retorno["inffin1510_actnocte"] +
                                    $retorno["inffin1510_fijnet"] +
                                    $retorno["inffin1510_actotr"] +
                                    $retorno["inffin1510_actval"];

                            $retorno["inffin1510_gruponiif"] = $arrXml["inffin1510_gruponiif"];


                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["tamanoempresa"] = $arrXml["tamanoempresa"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["sitcontrol"] = $arrXml["sitcontrol"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["exp1510"] = $arrXml["exp1510"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_fechacorte"] = $arrXml["inffin1510_fechacorte"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actcte"] = $arrXml["inffin1510_actcte"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actnocte"] = $arrXml["inffin1510_actnocte"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_fijnet"] = $arrXml["inffin1510_fijnet"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actotr"] = $arrXml["inffin1510_actotr"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actval"] = $arrXml["inffin1510_actval"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_acttot"] = $arrXml["inffin1510_acttot"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_pascte"] = $arrXml["inffin1510_pascte"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_paslar"] = $arrXml["inffin1510_paslar"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_pastot"] = $arrXml["inffin1510_pastot"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_patnet"] = $arrXml["inffin1510_patnet"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_paspat"] = $arrXml["inffin1510_paspat"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_balsoc"] = $arrXml["inffin1510_balsoc"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_ingope"] = $arrXml["inffin1510_ingope"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_ingnoope"] = $arrXml["inffin1510_ingnoope"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_gasope"] = $arrXml["inffin1510_gasope"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_gasnoope"] = $arrXml["inffin1510_gasnoope"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_cosven"] = $arrXml["inffin1510_cosven"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_utinet"] = $arrXml["inffin1510_utinet"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_utiope"] = $arrXml["inffin1510_utiope"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_gasint"] = $arrXml["inffin1510_gasint"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_gasimp"] = $arrXml["inffin1510_gasimp"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_indliq"] = $arrXml["inffin1510_indliq"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_nivend"] = $arrXml["inffin1510_nivend"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_razcob"] = $arrXml["inffin1510_razcob"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_renpat"] = $arrXml["inffin1510_renpat"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_renact"] = $arrXml["inffin1510_renact"];

                            // 2017-04-17: JINT: COn  el animo de mitigar el problema de los decimales en el certificado
                            if (doubleval($retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_patnet"]) != 0) {
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_renpat"] = $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_utiope"] / $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_patnet"];
                            }

                            if (doubleval($retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_acttot"]) != 0) {
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_renact"] = $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_utiope"] / $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_acttot"];
                            }


                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actnocte"] = $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actnocte"] +
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_fijnet"] +
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actotr"] +
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actval"];

                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_gruponiif"] = $arrXml["inffin1510_gruponiif"];
                        }

                        if ((trim($insc["acto"]) == '02' || trim($insc["acto"]) == '03') && ($insc["estado"] == '00' || $insc["estado"] == '01')) {
                            $inscnofirme++;
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["datosmodificados"] = 'no';
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["libro"] = $insc["libro"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["registro"] = $insc["registro"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["fecharegistro"] = $insc["fecharegistro"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["fecpublicacionrue"] = $insc["fecpublicacionrue"];
                            $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["acto"] = $insc["acto"];
                            $arrXml = \funcionesGenerales::desserializarExpedienteProponente($mysqli, $insc["xml"]);
                            if ($arrTemMer === false) {
                                if (isset($arrXml["gruposmodificados"]["perjur"])) {
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["datosmodificados"] = 'si';
                                    $retorno["idtipodocperjur"] = $arrXml["idtipodocperjur"];
                                    $retorno["numdocperjur"] = $arrXml["numdocperjur"];
                                    $retorno["fecdocperjur"] = $arrXml["fecdocperjur"];
                                    $retorno["origendocperjur"] = $arrXml["origendocperjur"];
                                    $retorno["fechaconstitucion"] = $arrXml["fechaconstitucion"];
                                    $retorno["fechavencimiento"] = $arrXml["fechavencimiento"];

                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["idtipodocperjur"] = $arrXml["idtipodocperjur"];
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["numdocperjur"] = $arrXml["numdocperjur"];
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["fecdocperjur"] = $arrXml["fecdocperjur"];
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["origendocperjur"] = $arrXml["origendocperjur"];
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["fechaconstitucion"] = $arrXml["fechaconstitucion"];
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["fechavencimiento"] = $arrXml["fechavencimiento"];
                                }
                                if (isset($arrXml["gruposmodificados"]["facultades"])) {
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["datosmodificados"] = 'si';
                                    $retorno["facultades"] = $arrXml["facultades"];
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["facultades"] = $arrXml["facultades"];
                                }
                                if (isset($arrXml["gruposmodificados"]["repleg"])) {
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["datosmodificados"] = 'si';
                                    $retorno["representanteslegales"] = $arrXml["representanteslegales"];
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["representanteslegales"] = $arrXml["representanteslegales"];
                                }
                            }
                            if (isset($arrXml["gruposmodificados"]["datosbasicos"])) {
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["datosmodificados"] = 'si';
                                $retorno["tamanoempresa"] = $arrXml["tamanoempresa"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["tamanoempresa"] = $arrXml["tamanoempresa"];
                            }

                            if (isset($arrXml["gruposmodificados"]["sitcontrol"])) {
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["datosmodificados"] = 'si';
                                $retorno["sitcontrol"] = $arrXml["sitcontrol"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["sitcontrol"] = $arrXml["sitcontrol"];
                            }
                            if (isset($arrXml["gruposmodificados"]["inffin1510"])) {
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["datosmodificados"] = 'si';
                                $retorno["inffin1510_fechacorte"] = $arrXml["inffin1510_fechacorte"];
                                $retorno["inffin1510_actcte"] = $arrXml["inffin1510_actcte"];
                                $retorno["inffin1510_actnocte"] = $arrXml["inffin1510_actnocte"];
                                $retorno["inffin1510_fijnet"] = $arrXml["inffin1510_fijnet"];
                                $retorno["inffin1510_actotr"] = $arrXml["inffin1510_actotr"];
                                $retorno["inffin1510_actval"] = $arrXml["inffin1510_actval"];
                                $retorno["inffin1510_acttot"] = $arrXml["inffin1510_acttot"];
                                $retorno["inffin1510_pascte"] = $arrXml["inffin1510_pascte"];
                                $retorno["inffin1510_paslar"] = $arrXml["inffin1510_paslar"];
                                $retorno["inffin1510_pastot"] = $arrXml["inffin1510_pastot"];
                                $retorno["inffin1510_patnet"] = $arrXml["inffin1510_patnet"];
                                $retorno["inffin1510_paspat"] = $arrXml["inffin1510_paspat"];
                                $retorno["inffin1510_balsoc"] = $arrXml["inffin1510_balsoc"];
                                $retorno["inffin1510_ingope"] = $arrXml["inffin1510_ingope"];
                                $retorno["inffin1510_ingnoope"] = $arrXml["inffin1510_ingnoope"];
                                $retorno["inffin1510_gasope"] = $arrXml["inffin1510_gasope"];
                                $retorno["inffin1510_gasnoope"] = $arrXml["inffin1510_gasnoope"];
                                $retorno["inffin1510_cosven"] = $arrXml["inffin1510_cosven"];
                                $retorno["inffin1510_utinet"] = $arrXml["inffin1510_utinet"];
                                $retorno["inffin1510_utiope"] = $arrXml["inffin1510_utiope"];
                                $retorno["inffin1510_gasint"] = $arrXml["inffin1510_gasint"];
                                $retorno["inffin1510_gasimp"] = $arrXml["inffin1510_gasimp"];
                                $retorno["inffin1510_indliq"] = $arrXml["inffin1510_indliq"];
                                $retorno["inffin1510_nivend"] = $arrXml["inffin1510_nivend"];
                                $retorno["inffin1510_razcob"] = $arrXml["inffin1510_razcob"];
                                $retorno["inffin1510_renpat"] = $arrXml["inffin1510_renpat"];
                                $retorno["inffin1510_renact"] = $arrXml["inffin1510_renact"];

                                // 2017-04-17: JINT: COn  el animo de mitigar el problema de los decimales en el certificado
                                if (doubleval($retorno["inffin1510_patnet"]) != 0) {
                                    $retorno["inffin1510_renpat"] = $retorno["inffin1510_utiope"] / $retorno["inffin1510_patnet"];
                                }

                                if (doubleval($retorno["inffin1510_acttot"]) != 0) {
                                    $retorno["inffin1510_renact"] = $retorno["inffin1510_utiope"] / $retorno["inffin1510_acttot"];
                                }

                                $retorno["inffin1510_actnocte"] = $retorno["inffin1510_actnocte"] +
                                        $retorno["inffin1510_fijnet"] +
                                        $retorno["inffin1510_actotr"] +
                                        $retorno["inffin1510_actval"];

                                $retorno["inffin1510_gruponiif"] = $arrXml["inffin1510_gruponiif"];

                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_fechacorte"] = $arrXml["inffin1510_fechacorte"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actcte"] = $arrXml["inffin1510_actcte"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actnocte"] = $arrXml["inffin1510_actnocte"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_fijnet"] = $arrXml["inffin1510_fijnet"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actotr"] = $arrXml["inffin1510_actotr"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actval"] = $arrXml["inffin1510_actval"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_acttot"] = $arrXml["inffin1510_acttot"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_pascte"] = $arrXml["inffin1510_pascte"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_paslar"] = $arrXml["inffin1510_paslar"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_pastot"] = $arrXml["inffin1510_pastot"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_patnet"] = $arrXml["inffin1510_patnet"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_paspat"] = $arrXml["inffin1510_paspat"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_balsoc"] = $arrXml["inffin1510_balsoc"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_ingope"] = $arrXml["inffin1510_ingope"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_ingnoope"] = $arrXml["inffin1510_ingnoope"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_gasope"] = $arrXml["inffin1510_gasope"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_gasnoope"] = $arrXml["inffin1510_gasnoope"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_cosven"] = $arrXml["inffin1510_cosven"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_utinet"] = $arrXml["inffin1510_utinet"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_utiope"] = $arrXml["inffin1510_utiope"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_gasint"] = $arrXml["inffin1510_gasint"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_gasimp"] = $arrXml["inffin1510_gasimp"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_indliq"] = $arrXml["inffin1510_indliq"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_nivend"] = $arrXml["inffin1510_nivend"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_razcob"] = $arrXml["inffin1510_razcob"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_renpat"] = $arrXml["inffin1510_renpat"];
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_renact"] = $arrXml["inffin1510_renact"];

                                // 2017-04-17: JINT: COn  el animo de mitigar el problema de los decimales en el certificado
                                if (doubleval($retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_patnet"]) != 0) {
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_renpat"] = $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_utiope"] / $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_patnet"];
                                }

                                if (doubleval($retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_acttot"]) != 0) {
                                    $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_renact"] = $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_utiope"] / $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_acttot"];
                                }

                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actnocte"] = $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actnocte"] +
                                        $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_fijnet"] +
                                        $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actotr"] +
                                        $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_actval"];

                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["inffin1510_gruponiif"] = $arrXml["inffin1510_gruponiif"];
                            }

                            if (isset($arrXml["gruposmodificados"]["exp1510"])) {
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["datosmodificados"] = 'si';
                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["exp1510"] = array();
                            }
                            $iExp = 0;
                            foreach ($arrXml["gruposmodificados"] as $exp) {
                                if (substr($exp, 0, 8) == 'exp1510-') {
                                    $subs = substr($exp, 8);
                                    if (strlen($subs) == 5) {
                                        $ind = (substr($exp, 8, 3));
                                        $mod = (substr($exp, 12, 1));
                                    }
                                    if (strlen($subs) == 6) {
                                        $ind = (substr($exp, 8, 4));
                                        $mod = (substr($exp, 13, 1));
                                    }
                                    if ($mod == 'S') {
                                        foreach ($arrXml["exp1510"] as $key => $rep) {
                                            if ($rep["secuencia"] == $ind) {
                                                $iExp++;
                                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["exp1510"][$iExp] = $rep;
                                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["exp1510"][$iExp]["soportedeclaracion"] = '';
                                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["exp1510"][$iExp]["soportecontrato"] = '';
                                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["exp1510"][$iExp]["generardeclaracion"] = '';
                                                $retorno["nofirme" . sprintf("%02s", $inscnofirme)]["exp1510"][$iExp]["revisado"] = '';



                                                //
                                                $encontro = 'no';
                                                $ultexp = 0;
                                                foreach ($retorno["exp1510"] as $key => $repx) {
                                                    if ($repx["secuencia"] == $ind) {
                                                        $retorno["exp1510"][$key] = $rep;
                                                        $retorno["exp1510"][$key]["soportedeclaracion"] = '';
                                                        $retorno["exp1510"][$key]["soportecontrato"] = '';
                                                        $retorno["exp1510"][$key]["generardeclaracion"] = '';
                                                        $retorno["exp1510"][$key]["revisado"] = '';
                                                        $encontro = 'si';
                                                    }
                                                    // $ultexp = $key;
                                                }
                                                if ($encontro == 'no') {
                                                    $ultexp = count($retorno["exp1510"]) + 1;
                                                    // $ultexp++;
                                                    $retorno["exp1510"][$ultexp] = $rep;
                                                    $retorno["exp1510"][$ultexp]["soportedeclaracion"] = '';
                                                    $retorno["exp1510"][$ultexp]["soportecontrato"] = '';
                                                    $retorno["exp1510"][$ultexp]["generardeclaracion"] = '';
                                                    $retorno["exp1510"][$ultexp]["revisado"] = '';
                                                }
                                            }
                                        }
                                    }
                                    if ($mod == 'E') {
                                        $cnt = 0;
                                        foreach ($retorno["exp1510"] as $key => $rep) {
                                            if ($rep["secuencia"] == $ind) {
                                                $cnt = $key;
                                            }
                                        }
                                        if ($cnt != 0) {
                                            unset($retorno["exp1510"][$cnt]);
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }

        // ***************************************************************************** //
        // ARMA CONTRATOS MULTAS Y SANCIONES
        // ***************************************************************************** //
        // Busca contratos
        if ($retornarRee == 'si') {
            $i = 0;
            if ($arrTem) {
                $arrTemCer = retornarRegistrosMysqliApi($mysqli, 'mreg_est_proponentes_contratos', "proponente='" . $arrTem["proponente"] . "'", "secuencia");
                foreach ($arrTemCer as $c) {
                    if ($c["estadocont"] != '9') {
                        $i++;
                        $retorno["contratos"][$i]["codcamara"] = $c["codcamara"];
                        $retorno["contratos"][$i]["numradic"] = $c["numradic"];
                        $retorno["contratos"][$i]["fecradic"] = $c["fecradic"];
                        $retorno["contratos"][$i]["horradic"] = $c["horradic"];
                        $retorno["contratos"][$i]["fecreporte"] = $c["fecreporte"];
                        $retorno["contratos"][$i]["nitentidad"] = $c["nitentidad"];
                        $retorno["contratos"][$i]["nombreentidad"] = \funcionesGenerales::restaurarEspeciales($c["nombreentidad"]);
                        $retorno["contratos"][$i]["idmunientidad"] = $c["idmunientidad"];
                        $retorno["contratos"][$i]["divarea"] = \funcionesGenerales::restaurarEspeciales($c["divarea"]);
                        $retorno["contratos"][$i]["idefun"] = $c["idefun"];
                        $retorno["contratos"][$i]["nomfun"] = \funcionesGenerales::restaurarEspeciales($c["nomfun"]);
                        $retorno["contratos"][$i]["carfun"] = \funcionesGenerales::restaurarEspeciales($c["carfun"]);
                        $retorno["contratos"][$i]["numcontrato"] = $c["numcontrato"];
                        $retorno["contratos"][$i]["numcontratosecop"] = $c["numcontratosecop"];
                        $retorno["contratos"][$i]["fechaadj"] = $c["fechaadj"];
                        $retorno["contratos"][$i]["fechaper"] = $c["fechaper"];
                        $retorno["contratos"][$i]["fechaini"] = $c["fechaini"];
                        $retorno["contratos"][$i]["fechater"] = $c["fechater"];
                        $retorno["contratos"][$i]["fechaeje"] = $c["fechaeje"];
                        $retorno["contratos"][$i]["fechaliq"] = $c["fechaliq"];
                        $retorno["contratos"][$i]["codigoact"] = $c["codigoact"];
                        $retorno["contratos"][$i]["ciiu1"] = $c["ciiu1"];
                        $retorno["contratos"][$i]["ciiu2"] = $c["ciiu2"];
                        $retorno["contratos"][$i]["ciiu3"] = $c["ciiu3"];
                        $retorno["contratos"][$i]["ciiu4"] = $c["ciiu4"];
                        $retorno["contratos"][$i]["tipocont"] = $c["tipocont"];
                        $retorno["contratos"][$i]["valorcont"] = $c["valorcont"];
                        $retorno["contratos"][$i]["valorcontpag"] = $c["valorcontpag"];
                        $retorno["contratos"][$i]["indcump"] = $c["indcump"];
                        $retorno["contratos"][$i]["estadocont"] = $c["estadocont"];
                        $retorno["contratos"][$i]["contratorelacionadoconstruccion"] = $c["contratorelacionadoconstruccion"];
                        $retorno["contratos"][$i]["motivoter"] = \funcionesGenerales::restaurarEspeciales($c["motivoter"]);
                        $retorno["contratos"][$i]["fechaterant"] = $c["fechaterant"];
                        $retorno["contratos"][$i]["motivoces"] = \funcionesGenerales::restaurarEspeciales($c["motivoces"]);
                        $retorno["contratos"][$i]["fechaces"] = $c["fechaces"];
                        $retorno["contratos"][$i]["observaciones"] = \funcionesGenerales::restaurarEspeciales($c["observaciones"]);
                        $retorno["contratos"][$i]["numlibro"] = $c["numlibro"];
                        $retorno["contratos"][$i]["numreglib"] = $c["numreglib"];
                        $retorno["contratos"][$i]["fecreglib"] = $c["fecreglib"];
                        $retorno["contratos"][$i]["clasificaciones"] = array();
                        $retorno["contratos"][$i]["unspsc"] = array();
                        if (trim($c["clasificaciones"]) != '') {
                            $iCla = 0;
                            $arrx = explode(",", $c["clasificaciones"]);
                            foreach ($arrx as $x) {
                                $iCla++;
                                $retorno["contratos"][$i]["clasificaciones"][$iCla] = $x;
                            }
                        }
                        if (trim($c["unspsc"]) != '') {
                            $iCla = 0;
                            $arrx = explode(",", $c["unspsc"]);
                            foreach ($arrx as $x) {
                                $iCla++;
                                $retorno["contratos"][$i]["unspsc"][$iCla] = $x;
                            }
                        }
                        $retorno["contratos"][$i]["objeto"] = \funcionesGenerales::restaurarEspeciales($c["objeto"]);
                        $retorno["contratos"][$i]["codigocamaraorigen"] = $c["codigocamaraorigen"];
                        $retorno["contratos"][$i]["numregistrocamaraorigen"] = $c["numregistrocamaraorigen"];
                        $retorno["contratos"][$i]["fecregistrocamaraorigen"] = $c["fecregistrocamaraorigen"];
                        $retorno["contratos"][$i]["indicadorenvio"] = '0';
                    }
                }

                // Busca multas
                $i = 0;
                $arrTemCer = retornarRegistrosMysqliApi($mysqli, 'mreg_est_proponentes_multas', "proponente='" . $arrTem["proponente"] . "'", "secuencia");
                foreach ($arrTemCer as $c) {
                    $i++;
                    $retorno["multas"][$i]["codcamara"] = $c["codcamara"];
                    $retorno["multas"][$i]["numradic"] = $c["numradic"];
                    $retorno["multas"][$i]["fecradic"] = $c["fecradic"];
                    $retorno["multas"][$i]["horradic"] = $c["horradic"];
                    $retorno["multas"][$i]["fecreporte"] = $c["fecreporte"];
                    $retorno["multas"][$i]["nitentidad"] = $c["nitentidad"];
                    $retorno["multas"][$i]["nombreentidad"] = \funcionesGenerales::restaurarEspeciales($c["nombreentidad"]);
                    $retorno["multas"][$i]["idmunientidad"] = $c["idmunientidad"];
                    $retorno["multas"][$i]["divarea"] = \funcionesGenerales::restaurarEspeciales($c["divarea"]);
                    $retorno["multas"][$i]["idefun"] = $c["idefun"];
                    $retorno["multas"][$i]["nomfun"] = \funcionesGenerales::restaurarEspeciales($c["nomfun"]);
                    $retorno["multas"][$i]["carfun"] = \funcionesGenerales::restaurarEspeciales($c["carfun"]);
                    $retorno["multas"][$i]["numcontrato"] = $c["numcontrato"];
                    $retorno["multas"][$i]["numcontratosecop"] = $c["numcontratosecop"];
                    $retorno["multas"][$i]["numacto"] = $c["numacto"];
                    $retorno["multas"][$i]["fechaacto"] = $c["fechaacto"];
                    $retorno["multas"][$i]["fechaeje"] = $c["fechaeje"];
                    $retorno["multas"][$i]["valormult"] = $c["valormult"];
                    $retorno["multas"][$i]["valormultpag"] = $c["valormultpag"];
                    $retorno["multas"][$i]["numsus"] = $c["numsus"];
                    $retorno["multas"][$i]["fechasus"] = $c["fechasus"];
                    $retorno["multas"][$i]["numconf"] = $c["numconf"];
                    $retorno["multas"][$i]["fechaconf"] = $c["fechaconf"];
                    $retorno["multas"][$i]["estadomult"] = $c["estadomult"];
                    $retorno["multas"][$i]["numrev"] = $c["numrev"];
                    $retorno["multas"][$i]["fechanumrev"] = $c["fechanumrev"];
                    $retorno["multas"][$i]["numlibro"] = $c["numlibro"];
                    $retorno["multas"][$i]["numreglib"] = $c["numreglib"];
                    $retorno["multas"][$i]["fecreglib"] = $c["fecreglib"];
                    $retorno["multas"][$i]["codigocamaraorigen"] = $c["codigocamaraorigen"];
                    $retorno["multas"][$i]["numregistrocamaraorigen"] = $c["numregistrocamaraorigen"];
                    $retorno["multas"][$i]["fecregistrocamaraorigen"] = $c["fecregistrocamaraorigen"];
                    $retorno["multas"][$i]["indicadorenvio"] = '0';
                    $retorno["multas"][$i]["observaciones"] = '';
                }

                // Busca sanciones
                $i = 0;
                $arrTemCer = retornarRegistrosMysqliApi($mysqli, 'mreg_est_proponentes_sanciones', "proponente='" . $arrTem["proponente"] . "'", "secuencia");
                foreach ($arrTemCer as $c) {
                    $i++;
                    $retorno["sanciones"][$i]["codcamara"] = $c["codcamara"];
                    $retorno["sanciones"][$i]["numradic"] = $c["numradic"];
                    $retorno["sanciones"][$i]["fecradic"] = $c["fecradic"];
                    $retorno["sanciones"][$i]["horradic"] = $c["horradic"];
                    $retorno["sanciones"][$i]["fecreporte"] = $c["fecreporte"];
                    $retorno["sanciones"][$i]["nitentidad"] = $c["nitentidad"];
                    $retorno["sanciones"][$i]["nombreentidad"] = \funcionesGenerales::restaurarEspeciales($c["nombreentidad"]);
                    $retorno["sanciones"][$i]["idmunientidad"] = $c["idmunientidad"];
                    $retorno["sanciones"][$i]["divarea"] = \funcionesGenerales::restaurarEspeciales($c["divarea"]);
                    $retorno["sanciones"][$i]["idefun"] = $c["idefun"];
                    $retorno["sanciones"][$i]["nomfun"] = \funcionesGenerales::restaurarEspeciales($c["nomfun"]);
                    $retorno["sanciones"][$i]["carfun"] = \funcionesGenerales::restaurarEspeciales($c["carfun"]);
                    $retorno["sanciones"][$i]["numcontrato"] = $c["numcontrato"];
                    $retorno["sanciones"][$i]["numcontratosecop"] = $c["numcontratosecop"];
                    $retorno["sanciones"][$i]["numacto"] = $c["numacto"];
                    $retorno["sanciones"][$i]["fechaacto"] = $c["fechaacto"];
                    $retorno["sanciones"][$i]["fechaeje"] = $c["fechaeje"];
                    $retorno["sanciones"][$i]["numsus"] = $c["numsus"];
                    $retorno["sanciones"][$i]["fechasus"] = $c["fechasus"];
                    $retorno["sanciones"][$i]["numconf"] = $c["numconf"];
                    $retorno["sanciones"][$i]["fechaconf"] = $c["fechaconf"];
                    $retorno["sanciones"][$i]["condinc"] = $c["condinc"];
                    $retorno["sanciones"][$i]["contratorelacionadoconstruccion"] = $c["contratorelacionadoconstruccion"];
                    $retorno["sanciones"][$i]["incumplimientoviviendainteressocial"] = $c["incumplimientoviviendainteressocial"];
                    $retorno["sanciones"][$i]["cumsanc"] = $c["cumsanc"];
                    $retorno["sanciones"][$i]["estadosanc"] = $c["estadosanc"];
                    $retorno["sanciones"][$i]["numrev"] = $c["numrev"];
                    $retorno["sanciones"][$i]["fechanumrev"] = $c["fechanumrev"];
                    $retorno["sanciones"][$i]["descripcion"] = restaurarEspecialesSii2($c["descripcion"]);
                    $retorno["sanciones"][$i]["fundamento"] = restaurarEspecialesSii2($c["fundamento"]);
                    $retorno["sanciones"][$i]["vigencia"] = $c["vigencia"];
                    $retorno["sanciones"][$i]["numlibro"] = $c["numlibro"];
                    $retorno["sanciones"][$i]["numreglib"] = $c["numreglib"];
                    $retorno["sanciones"][$i]["fecreglib"] = $c["fecreglib"];
                    $retorno["sanciones"][$i]["codigocamaraorigen"] = $c["codigocamaraorigen"];
                    $retorno["sanciones"][$i]["numregistrocamaraorigen"] = $c["numregistrocamaraorigen"];
                    $retorno["sanciones"][$i]["fecregistrocamaraorigen"] = $c["fecregistrocamaraorigen"];
                    $retorno["sanciones"][$i]["indicadorenvio"] = '0';
                    $retorno["sanciones"][$i]["observaciones"] = '';
                }

                // Busca sanciones disciplinarias
                $i = 0;
                $arrTemCer = retornarRegistrosMysqliApi($mysqli, 'mreg_est_proponentes_sandis', "proponente='" . $arrTem["proponente"] . "'", "secuencia");
                foreach ($arrTemCer as $c) {
                    $i++;
                    $retorno["sandis"][$i]["codcamara"] = $c["codcamara"];
                    $retorno["sandis"][$i]["numradic"] = $c["numradic"];
                    $retorno["sandis"][$i]["fecradic"] = $c["fecradic"];
                    $retorno["sandis"][$i]["horradic"] = $c["horradic"];
                    $retorno["sandis"][$i]["fecreporte"] = $c["fecreporte"];
                    $retorno["sandis"][$i]["nitentidad"] = $c["nitentidad"];
                    $retorno["sandis"][$i]["nombreentidad"] = \funcionesGenerales::restaurarEspeciales($c["nombreentidad"]);
                    $retorno["sandis"][$i]["idmunientidad"] = $c["idmunientidad"];
                    $retorno["sandis"][$i]["divarea"] = \funcionesGenerales::restaurarEspeciales($c["divarea"]);
                    $retorno["sandis"][$i]["idefun"] = $c["idefun"];
                    $retorno["sandis"][$i]["nomfun"] = \funcionesGenerales::restaurarEspeciales($c["nomfun"]);
                    $retorno["sandis"][$i]["carfun"] = \funcionesGenerales::restaurarEspeciales($c["carfun"]);
                    $retorno["sandis"][$i]["numcontratosecop"] = $c["numcontratosecop"];
                    $retorno["sandis"][$i]["numacto"] = $c["numacto"];
                    $retorno["sandis"][$i]["fechaacto"] = $c["fechaacto"];
                    $retorno["sandis"][$i]["fechaeje"] = $c["fechaeje"];
                    $retorno["sandis"][$i]["numsus"] = $c["numsus"];
                    $retorno["sandis"][$i]["fechasus"] = $c["fechasus"];
                    $retorno["sandis"][$i]["numconf"] = $c["numconf"];
                    $retorno["sandis"][$i]["fechaconf"] = $c["fechaconf"];
                    $retorno["sandis"][$i]["condinc"] = $c["condinc"];
                    $retorno["sandis"][$i]["cumsanc"] = $c["cumsanc"];
                    $retorno["sandis"][$i]["estadosanc"] = $c["estadosanc"];
                    $retorno["sandis"][$i]["numrev"] = $c["numrev"];
                    $retorno["sandis"][$i]["fechanumrev"] = $c["fechanumrev"];
                    $retorno["sandis"][$i]["descripcion"] = \funcionesGenerales::restaurarEspeciales($c["descripcion"]);
                    $retorno["sandis"][$i]["fundamento"] = \funcionesGenerales::restaurarEspeciales($c["fundamento"]);
                    $retorno["sandis"][$i]["vigencia"] = $c["vigencia"];
                    $retorno["sandis"][$i]["numlibro"] = $c["numlibro"];
                    $retorno["sandis"][$i]["numreglib"] = $c["numreglib"];
                    $retorno["sandis"][$i]["fecreglib"] = $c["fecreglib"];
                    $retorno["sandis"][$i]["codigocamaraorigen"] = $c["codigocamaraorigen"];
                    $retorno["sandis"][$i]["numregistrocamaraorigen"] = $c["numregistrocamaraorigen"];
                    $retorno["sandis"][$i]["fecregistrocamaraorigen"] = $c["fecregistrocamaraorigen"];
                    $retorno["sandis"][$i]["indicadorenvio"] = '0';
                    $retorno["sandis"][$i]["observaciones"] = '';
                }
            }
        }


        // Busca inhabilidad por incumplimiento reiterado
        // arreglo
        // $retorno["inhabilidad"]["inhabilidad"] = 'no/si';
        // $retorno["inhabilidad"]["ano"] = 'Año para el cual se detrermina la inhabilidad';
        // $retorno["inhabilidad"]["multas"] = array de multas
        // $retorno["inhabilidad"]["sanciones"] = array de sanciones
        // $retorno["inhabilidad"]["sinindicador"] = array de sanciones sin indicador
        // $retorno["inhabilidad"]["texto"] = array - texto en líneas de 65 para sirep
        // $retorno["inhabilidad"]["textosii"] = array - [0][1][2][3][4]

        if ($retornarInhabilidad != 'no') {
            $retorno["inhabilidad"] = \funcionesRues::validarInhabilidad($retorno["nit"], $retorno["proponente"], $retorno["nombre"], "CALCULO EN LINEA DE LA INHABILIDAD");
        }

        return $retorno;
    }

    public static function retornarLiquidacionDatosExpediente($mysqli, $numliq, $tipotramite, $numexp = '', $grudat = '', $proceso = '', $secuencia = '') {

        $vmat = explode("-", $numexp);
        $cc = '';
        $ma = '';
        if (count($vmat) == 1) {
            $cc = CODIGO_EMPRESA;
            $ma = $vmat[0];
        } else {
            $cc = $vmat[0];
            $ma = $vmat[1];
        }

        if (($tipotramite == 'renovacionmatricula') || ($tipotramite == 'renovacionesadl')) {
            $result = retornarRegistrosMysqliApi($mysqli, 'mreg_liquidaciondatos', "idliquidacion=" . $numliq . " and expediente='" . $ma . "' and grupodatos='" . $grudat . "'", "idliquidacion,secuencia");
        }

        if ($tipotramite == 'matriculapnat' ||
                $tipotramite == 'matriculacambidom' ||
                $tipotramite == 'matriculapjur' ||
                $tipotramite == 'matriculaest' ||
                $tipotramite == 'matriculasuc' ||
                $tipotramite == 'matriculaage' ||
                $tipotramite == 'matriculaesadl' ||
                $tipotramite == 'constitucionpjur' ||
                $tipotramite == 'constitucionesadl' ||
                $tipotramite == 'inscripciondocumentos' ||
                $tipotramite == 'inscripcionesregmer' ||
                $tipotramite == 'compraventa' ||
                $tipotramite == 'mercantil') {
            if ($secuencia != '' && $secuencia != '000') {
                $result = retornarRegistrosMysqliApi($mysqli, 'mreg_liquidaciondatos', "idliquidacion=" . $numliq . " and secuencia ='" . sprintf("%03s", $secuencia) . "' and expediente='" . $ma . "' and grupodatos='" . $grudat . "'", "idliquidacion,secuencia");
            } else {
                $result = retornarRegistrosMysqliApi($mysqli, 'mreg_liquidaciondatos', "idliquidacion=" . $numliq . " and expediente='" . $ma . "' and grupodatos='" . $grudat . "'", "idliquidacion,secuencia");
            }
        }

        if (($tipotramite == 'mutaciondireccion') || ($tipotramite == 'mutacionactividad') || ($tipotramite == 'mutacionnombre') || ($tipotramite == 'mutaciongeneral')) {
            $result = retornarRegistrosMysqliApi($mysqli, 'mreg_liquidaciondatos', "idliquidacion=" . $numliq . " and expediente='" . $ma . "' and grupodatos='" . $grudat . "'", "idliquidacion,secuencia");
        }

        if ($tipotramite == 'cancelacionmatricula') {
            $result = retornarRegistrosMysqliApi($mysqli, 'mreg_liquidaciondatos', "idliquidacion=" . $numliq . " and expediente='" . $ma . "' and grupodatos='" . $grudat . "'", "idliquidacion,secuencia");
        }

        //
        if ($tipotramite == 'inscripcionproponente' || $tipotramite == 'compraventa') {
            $result = retornarRegistrosMysqliApi($mysqli, 'mreg_liquidaciondatos', "idliquidacion=" . $numliq, "idliquidacion,secuencia");
        }

        //
        if ($tipotramite == 'actualizacionespecial') {
            $result = retornarRegistrosMysqliApi($mysqli, 'mreg_liquidaciondatos', "idliquidacion=" . $numliq, "idliquidacion,secuencia");
        }

        if ($tipotramite == 'actualizacionproponente') {
            $result = retornarRegistrosMysqliApi($mysqli, 'mreg_liquidaciondatos', "idliquidacion=" . $numliq, "idliquidacion,secuencia");
        }

        //
        if ($tipotramite == 'renovacionproponente') {
            $result = retornarRegistrosMysqliApi($mysqli, 'mreg_liquidaciondatos', "idliquidacion=" . $numliq, "idliquidacion,secuencia");
        }

        //
        if ($tipotramite == 'cambiodomicilioproponente') {
            $result = retornarRegistrosMysqliApi($mysqli, 'mreg_liquidaciondatos', "idliquidacion=" . $numliq, "idliquidacion,secuencia");
        }

        //
        if ($tipotramite == 'cancelacionproponente') {
            $query = "select * from mreg_liquidaciondatos where idliquidacion=" . $numliq;
        }

        if ($result === false) {
            $retornar = false;
        } else {
            $retornar = 0;
            foreach ($result as $res) {

                if (($tipotramite == 'renovacionmatricula') || ($tipotramite == 'renovacionesadl')) {
                    $retornar = \funcionesGenerales::desserializarExpedienteMatricula($mysqli, stripslashes($res["xml"]));
                }

                if ($tipotramite == 'matriculapnat' ||
                        $tipotramite == 'matriculacambidom' ||
                        $tipotramite == 'matriculaest' ||
                        $tipotramite == 'matriculasuc' ||
                        $tipotramite == 'matriculaage' ||
                        $tipotramite == 'matriculapjur' ||
                        $tipotramite == 'matriculaest' ||
                        $tipotramite == 'constitucionpjur' ||
                        $tipotramite == 'constitucionesadl' ||
                        $tipotramite == 'inscripciondocumentos' ||
                        $tipotramite == 'compraventa' ||
                        $tipotramite == 'mercantil'
                ) {
                    $retornar = \funcionesGenerales::desserializarExpedienteMatricula($mysqli, stripslashes($res["xml"]));
                }

                if ($tipotramite == 'inscripcionproponente') {
                    $retornar = \funcionesGenerales::desserializarExpedienteProponente($mysqli, stripslashes($res["xml"]), '', 'no', $proceso);
                }

                if ($tipotramite == 'actualizacionproponente') {
                    $retornar = \funcionesGenerales::desserializarExpedienteProponente($mysqli, stripslashes($res["xml"]), '', 'no', $proceso);
                }

                if ($tipotramite == 'renovacionproponente') {
                    $retornar = \funcionesGenerales::desserializarExpedienteProponente($mysqli, stripslashes($res["xml"]), '', 'no', $proceso);
                }

                if ($tipotramite == 'cambiodomicilioproponente') {
                    $retornar = \funcionesGenerales::desserializarExpedienteProponente($mysqli, stripslashes($res["xml"]), '', 'no', $proceso);
                }

                if ($tipotramite == 'actualizacionespecial') {
                    $retornar = \funcionesGenerales::desserializarExpedienteProponente($mysqli, stripslashes($res["xml"]), '', 'no', $proceso);
                }
            }

            $_SESSION["generales"]["mensajeerror"] = '';
        }

        return $retornar;
    }

    public static function retornarMregLiquidacion($dbx, $numliq, $tipo = 'L') {

        // Inicializa las variables del tr&aacute;mite
        $respuesta = array();
        $respuesta["idliquidacion"] = 0;
        $respuesta["numeroliquidacion"] = 0;
        $respuesta["fecha"] = '';
        $respuesta["hora"] = '';
        $respuesta["idusuario"] = '';
        $respuesta["sede"] = '';
        $respuesta["tipotramite"] = '';
        $respuesta["subtipotramite"] = '';
        $respuesta["origen"] = '';
        $respuesta["iptramite"] = '';
        $respuesta["idestado"] = '';
        $respuesta["txtestado"] = '';
        $respuesta["idexpedientebase"] = '';
        $respuesta["idmatriculabase"] = '';
        $respuesta["idproponentebase"] = '';
        $respuesta["tipoproponente"] = '';
        $respuesta["tipoidentificacionbase"] = '';
        $respuesta["identificacionbase"] = '';
        $respuesta["nombrebase"] = '';
        $respuesta["nom1base"] = '';
        $respuesta["nom2base"] = '';
        $respuesta["ape1base"] = '';
        $respuesta["ape2base"] = '';
        $respuesta["organizacionbase"] = '';
        $respuesta["categoriabase"] = '';
        $respuesta["afiliadobase"] = '';
        $respuesta["matriculabase"] = '';
        $respuesta["proponentebase"] = '';

        $respuesta["numeromatriculapnat"] = '';
        $respuesta["camarapnat"] = '';
        $respuesta["orgpnat"] = '';
        $respuesta["tipoidepnat"] = '';
        $respuesta["idepnat"] = '';
        $respuesta["nombrepnat"] = '';

        //
        $respuesta["nombreest"] = '';
        $respuesta["nombrepjur"] = '';
        $respuesta["nombresuc"] = '';
        $respuesta["nombreage"] = '';

        $respuesta["orgpjur"] = '';
        $respuesta["orgsuc"] = '';
        $respuesta["orgage"] = '';

        $respuesta["actpnat"] = '';
        $respuesta["actpjur"] = '';
        $respuesta["actest"] = '';
        $respuesta["actsuc"] = '';
        $respuesta["actage"] = '';

        $respuesta["perpnat"] = '';
        $respuesta["perpjur"] = '';

        $respuesta["munpnat"] = '';
        $respuesta["munest"] = '';
        $respuesta["munpjur"] = '';
        $respuesta["munsuc"] = '';
        $respuesta["munage"] = '';

        $respuesta["ultanoren"] = '';
        $respuesta["domicilioorigen"] = '';
        $respuesta["domiciliodestino"] = '';


        $respuesta["tipocliente"] = '';
        $respuesta["idtipoidentificacioncliente"] = '';
        $respuesta["identificacioncliente"] = '';
        $respuesta["nombrecliente"] = '';
        $respuesta["apellidocliente"] = '';

        $respuesta["razonsocialcliente"] = '';
        $respuesta["nombre1cliente"] = '';
        $respuesta["nombre2cliente"] = '';
        $respuesta["apellido1cliente"] = '';
        $respuesta["apellido2cliente"] = '';

        $respuesta["email"] = '';
        $respuesta["direccion"] = '';
        $respuesta["idmunicipio"] = '';
        $respuesta["telefono"] = '';
        $respuesta["movil"] = '';

        $respuesta["tipopagador"] = '';
        $respuesta["nombrepagador"] = '';
        $respuesta["apellidopagador"] = '';

        $respuesta["razonsocialpagador"] = '';
        $respuesta["nombre1pagador"] = '';
        $respuesta["nombre2pagador"] = '';
        $respuesta["apellido1pagador"] = '';
        $respuesta["apellido2pagador"] = '';

        $respuesta["tipoidentificacionpagador"] = '';
        $respuesta["identificacionpagador"] = '';
        $respuesta["direccionpagador"] = '';
        $respuesta["telefonopagador"] = '';
        $respuesta["movilpagador"] = '';
        $respuesta["municipiopagador"] = '';
        $respuesta["emailpagador"] = '';

        $respuesta["valorbruto"] = 0;
        $respuesta["valorbaseiva"] = 0;
        $respuesta["valoriva"] = 0;
        $respuesta["valortotal"] = 0;
        $respuesta["idsolicitudpago"] = 0;
        $respuesta["vueltas"] = 0;
        $respuesta["pagoefectivo"] = 0;
        $respuesta["pagocheque"] = 0;
        $respuesta["pagoconsignacion"] = 0;
        $respuesta["pagovisa"] = 0;
        $respuesta["pagoach"] = 0;
        $respuesta["pagomastercard"] = 0;
        $respuesta["pagoamerican"] = 0;
        $respuesta["pagocredencial"] = 0;
        $respuesta["pagodiners"] = 0;
        $respuesta["pagotdebito"] = 0;
        $respuesta["pagoprepago"] = 0;
        $respuesta["pagoafiliado"] = 0;
        $respuesta["idformapago"] = '';
        $respuesta["numerorecibo"] = '';
        $respuesta["numerooperacion"] = '';
        $respuesta["fecharecibo"] = '';
        $respuesta["horarecibo"] = '';
        $respuesta["idfranquicia"] = '';
        $respuesta["nombrefranquicia"] = '';
        $respuesta["numeroautorizacion"] = '';
        $respuesta["idcodban"] = '';
        $respuesta["nombrebanco"] = '';
        $respuesta["numerocheque"] = '';
        $respuesta["numerorecuperacion"] = '';
        $respuesta["numeroradicacion"] = '';
        $respuesta["alertaid"] = 0;
        $respuesta["alertaservicio"] = '';
        $respuesta["alertavalor"] = 0;
        $respuesta["ctrcancelacion"] = '';
        $respuesta["idasesor"] = '';
        $respuesta["numeroempleados"] = 0;
        $respuesta["pagoafiliacion"] = '';
        $respuesta["numerofactura"] = '';

        $respuesta["incluirformularios"] = '';
        $respuesta["incluircertificados"] = '';
        $respuesta["incluirdiploma"] = '';
        $respuesta["incluircartulina"] = '';
        $respuesta["matricularpnat"] = '';
        $respuesta["matricularest"] = '';
        $respuesta["regimentributario"] = '';
        $respuesta["tipomatricula"] = '';
        $respuesta["camaracambidom"] = '';
        $respuesta["matriculacambidom"] = '';
        $respuesta["municipiocambidom"] = '';
        $respuesta["fecmatcambidom"] = '';
        $respuesta["fecrencambidom"] = '';
        $respuesta["benart7"] = 'N';
        $respuesta["benley1780"] = 'N';
        $respuesta["controlfirma"] = 'N';
        $respuesta["actualizacionciiuversion4"] = '';
        $respuesta["reliquidacion"] = '';
        $respuesta["cumplorequisitosbenley1780"] = '';
        $respuesta["mantengorequisitosbenley1780"] = '';
        $respuesta["renunciobeneficiosley1780"] = '';
        $respuesta["multadoponal"] = '';
        $respuesta["controlaactividadaltoimpacto"] = '';

        $respuesta["capital"] = 0;
        $respuesta["tipodoc"] = '';
        $respuesta["numdoc"] = '';
        $respuesta["fechadoc"] = '';
        $respuesta["origendoc"] = '';
        $respuesta["mundoc"] = '';
        $respuesta["organizacion"] = '';
        $respuesta["categoria"] = '';

        $respuesta["tipoiderepleg"] = '';
        $respuesta["iderepleg"] = '';
        $respuesta["nombre1repleg"] = '';
        $respuesta["nombre2repleg"] = '';
        $respuesta["apellido1repleg"] = '';
        $respuesta["apellido2repleg"] = '';
        $respuesta["cargorepleg"] = ''; //
        $respuesta["emailrepleg"] = ''; //
        $respuesta["firmorepleg"] = ''; //
        $respuesta["celularrepleg"] = ''; //

        $respuesta["tipoideradicador"] = '';
        $respuesta["ideradicador"] = '';
        $respuesta["nombreradicador"] = '';
        $respuesta["fechaexpradicador"] = '';
        $respuesta["emailradicador"] = '';
        $respuesta["telefonoradicador"] = '';
        $respuesta["celularradicador"] = '';

        $respuesta["tipolibro"] = ''; //
        $respuesta["codigolibro"] = ''; //
        $respuesta["primeravez"] = ''; //
        $respuesta["confirmadigital"] = ''; //

        $respuesta["iderevfis"] = ''; //
        $respuesta["nombre1revfis"] = ''; //
        $respuesta["nombre2revfis"] = ''; //
        $respuesta["apellido1revfis"] = ''; //
        $respuesta["apellido2revfis"] = ''; //
        $respuesta["cargorevfis"] = ''; //
        $respuesta["emailrevfis"] = ''; //
        $respuesta["firmorevfis"] = ''; //
        $respuesta["celularrevfis"] = ''; //

        $respuesta["idepreasa"] = ''; //
        $respuesta["nombre1preasa"] = ''; //
        $respuesta["nombre2preasa"] = ''; //
        $respuesta["apellido1preasa"] = ''; //
        $respuesta["apellido2preasa"] = ''; //
        $respuesta["cargopreasa"] = ''; //
        $respuesta["emailpreasa"] = ''; //
        $respuesta["firmopreasa"] = ''; //
        $respuesta["celularpreasa"] = ''; //

        $respuesta["idesecasa"] = ''; //
        $respuesta["nombre1secasa"] = ''; //
        $respuesta["nombre2secasa"] = ''; //    
        $respuesta["apellido1secasa"] = ''; //
        $respuesta["apellido2secasa"] = ''; //
        $respuesta["cargosecasa"] = ''; //
        $respuesta["emailsecasa"] = ''; //
        $respuesta["firmosecasa"] = ''; //
        $respuesta["celularsecasa"] = ''; //

        $respuesta["tipoidentificacionaceptante"] = '';
        $respuesta["identificacionaceptante"] = '';
        $respuesta["nombre1aceptante"] = '';
        $respuesta["nombre2aceptante"] = '';
        $respuesta["apellido1aceptante"] = '';
        $respuesta["apellido2aceptante"] = '';
        $respuesta["direccionaceptante"] = '';
        $respuesta["municipioaceptante"] = '';
        $respuesta["emailaceptante"] = '';
        $respuesta["telefonoaceptante"] = '';
        $respuesta["celularaceptante"] = '';
        $respuesta["cargoaceptante"] = '';
        $respuesta["fechadocideaceptante"] = '';

        $respuesta["motivocorreccion"] = '';
        $respuesta["tipoerror1"] = '';
        $respuesta["tipoerror2"] = '';
        $respuesta["tipoerror3"] = '';
        $respuesta["tipoidentificacioncor"] = '';
        $respuesta["nombre1cor"] = '';
        $respuesta["nombre2cor"] = '';
        $respuesta["apellido1cor"] = '';
        $respuesta["apellido2cor"] = '';
        $respuesta["direccioncor"] = '';
        $respuesta["municipiocor"] = '';
        $respuesta["emailcor"] = '';
        $respuesta["telefonocor"] = '';
        $respuesta["celularcor"] = '';


        $respuesta["descripcionembargo"] = '';
        $respuesta["descripciondesembargo"] = '';
        $respuesta["tipoidentificaciondemandante"] = '';
        $respuesta["identificaciondemandante"] = '';
        $respuesta["nombredemandante"] = '';
        $respuesta["libro"] = '';
        $respuesta["numreg"] = '';

        $respuesta["descripcionpqr"] = '';
        $respuesta["tipoidentificacionpqr"] = '';
        $respuesta["nombre1pqr"] = '';
        $respuesta["nombre2pqr"] = '';
        $respuesta["apellido1pqr"] = '';
        $respuesta["apellido2pqr"] = '';
        $respuesta["direccionpqr"] = '';
        $respuesta["municipiopqr"] = '';
        $respuesta["emailpqr"] = '';
        $respuesta["telefonopqr"] = '';
        $respuesta["celularpqr"] = '';

        $respuesta["descripcionrr"] = '';
        $respuesta["inscripcionrr"] = '';
        $respuesta["tipoidentificacionrr"] = '';
        $respuesta["nombre1rr"] = '';
        $respuesta["nombre2rr"] = '';
        $respuesta["apellido1rr"] = '';
        $respuesta["apellido2rr"] = '';
        $respuesta["direccionrr"] = '';
        $respuesta["municipiorr"] = '';
        $respuesta["emailrr"] = '';
        $respuesta["telefonorr"] = '';
        $respuesta["celularrr"] = '';
        $respuesta["subsidioapelacionrr"] = '';

        $respuesta["tipocertificado"] = '';
        $respuesta["explicacion"] = '';
        $respuesta["textolibre"] = '';

        $respuesta["proyectocaja"] = '001';
        $respuesta["cargoafiliacion"] = 'NO';
        $respuesta["cargogastoadministrativo"] = 'NO';
        $respuesta["cargoentidadoficial"] = 'NO';
        $respuesta["cargoconsulta"] = 'NO';

        $respuesta["opcionafiliado"] = '';
        $respuesta["saldoafiliado"] = 0;
        $respuesta["matriculaafiliado"] = '';
        $respuesta["ultanorenafi"] = '';

        // Mutaciones
        $respuesta["modcom"] = '';
        $respuesta["modnot"] = '';
        $respuesta["modciiu"] = '';
        $respuesta["modnombre"] = '';

        $respuesta["nombreanterior"] = '';
        $respuesta["nombrenuevo"] = '';

        $respuesta["ant_versionciiu"] = '';
        $respuesta["ant_ciiu11"] = '';
        $respuesta["ant_ciiu12"] = '';
        $respuesta["ant_ciiu13"] = '';
        $respuesta["ant_ciiu14"] = '';
        $respuesta["ant_ciiu21"] = '';
        $respuesta["ant_ciiu22"] = '';
        $respuesta["ant_ciiu23"] = '';
        $respuesta["ant_ciiu24"] = '';
        $respuesta["ant_dircom"] = '';
        $respuesta["ant_telcom1"] = '';
        $respuesta["ant_telcom2"] = '';
        $respuesta["ant_faxcom"] = '';
        $respuesta["ant_celcom"] = '';
        $respuesta["ant_muncom"] = '';
        $respuesta["ant_barriocom"] = '';
        $respuesta["ant_numpredial"] = '';
        $respuesta["ant_emailcom"] = '';
        $respuesta["ant_emailcom2"] = '';
        $respuesta["ant_emailcom3"] = '';
        $respuesta["ant_dirnot"] = '';
        $respuesta["ant_telnot1"] = '';
        $respuesta["ant_telnot2"] = '';
        $respuesta["ant_faxnot"] = '';
        $respuesta["ant_celnot"] = '';
        $respuesta["ant_munnot"] = '';
        $respuesta["ant_barrionot"] = '';
        $respuesta["ant_emailnot"] = '';

        $respuesta["versionciiu"] = '';
        $respuesta["ciiu11"] = '';
        $respuesta["ciiu12"] = '';
        $respuesta["ciiu13"] = '';
        $respuesta["ciiu14"] = '';
        $respuesta["ciiu21"] = '';
        $respuesta["ciiu22"] = '';
        $respuesta["ciiu23"] = '';
        $respuesta["ciiu24"] = '';
        $respuesta["dircom"] = '';
        $respuesta["telcom1"] = '';
        $respuesta["telcom2"] = '';
        $respuesta["faxcom"] = '';
        $respuesta["celcom"] = '';
        $respuesta["muncom"] = '';
        $respuesta["barriocom"] = '';
        $respuesta["numpredial"] = '';
        $respuesta["emailcom"] = '';
        $respuesta["emailcom2"] = '';
        $respuesta["emailcom3"] = '';
        $respuesta["dirnot"] = '';
        $respuesta["telnot1"] = '';
        $respuesta["telnot2"] = '';
        $respuesta["faxnot"] = '';
        $respuesta["celnot"] = '';
        $respuesta["munnot"] = '';
        $respuesta["barrionot"] = '';
        $respuesta["emailnot"] = '';

        // En caso de trámites rues
        $respuesta["rues_numerointerno"] = "";
        $respuesta["rues_numerounico"] = "";
        $respuesta["rues_camarareceptora"] = "";
        $respuesta["rues_camararesponsable"] = "";
        $respuesta["rues_matricula"] = "";
        $respuesta["rues_proponente"] = "";
        $respuesta["rues_nombreregistrado"] = "";
        $respuesta["rues_claseidentificacion"] = "";
        $respuesta["rues_numeroidentificacion"] = "";
        $respuesta["rues_dv"] = "";
        $respuesta["rues_estado_liquidacion"] = "";
        $respuesta["rues_estado_transaccion"] = "";
        $respuesta["rues_nombrepagador"] = "";
        $respuesta["rues_origendocumento"] = "";
        $respuesta["rues_fechadocumento"] = "";
        $respuesta["rues_fechapago"] = "";
        $respuesta["rues_numerofactura"] = "";
        $respuesta["rues_referenciaoperacion"] = "";
        $respuesta["rues_totalpagado"] = 0;
        $respuesta["rues_formapago"] = "";
        $respuesta["rues_indicadororigen"] = "";
        $respuesta["rues_empleados"] = "";
        $respuesta["rues_indicadorbeneficio"] = "";
        $respuesta["rues_fecharespuesta"] = "";
        $respuesta["rues_horarespuesta"] = "";
        $respuesta["rues_codigoerror"] = "";
        $respuesta["rues_mensajeerror"] = "";
        $respuesta["rues_firmadigital"] = "";
        $respuesta["rues_firmadigital"] = "";
        $respuesta["rues_caracteres_por_linea"] = "";


        $respuesta["expedientes"] = array();
        $respuesta["liquidacion"] = array();
        $respuesta["rues_servicios"] = array();
        $respuesta["rues_textos"] = array();
        $respuesta["transacciones"] = array();

        //
        $respuesta["nrocontrolsipref"] = '';
        $respuesta["foto"] = '../../images/sii/people.png';
        $respuesta["fotoabsoluta"] = 'images/sii/people.png';
        $respuesta["cedula1"] = '../../images/sii/people.png';
        $respuesta["cedula1absoluta"] = 'images/sii/people.png';
        $respuesta["cedula2"] = '../../images/sii/people.png';
        $respuesta["cedula2absoluta"] = 'images/sii/people.png';

        //
        $respuesta["firmadoelectronicamente"] = '';
        $respuesta["firmadomanuscrita"] = '';
        $respuesta["tipoidefirmante"] = '';
        $respuesta["identificacionfirmante"] = '';
        $respuesta["fechaexpfirmante"] = '';
        $respuesta["apellido1firmante"] = '';
        $respuesta["apellido2firmante"] = '';
        $respuesta["nombre1firmante"] = '';
        $respuesta["nombre2firmante"] = '';
        $respuesta["emailfirmante"] = '';
        $respuesta["emailfirmanteseguimiento"] = '';
        $respuesta["celularfirmante"] = '';
        $respuesta["direccionfirmante"] = '';
        $respuesta["municipiofirmante"] = '';

        //
        $respuesta["emailcontactoasesoria"] = '';
        $respuesta["comentariosasesoria"] = '';

        //
        $respuesta["pedirbalance"] = '';
        $respuesta["incrementocupocertificados"] = 0;
        $respuesta["cobrarmutacion"] = '';

        $respuesta["propcamaraorigen"] = '';
        $respuesta["propproponenteorigen"] = '';
        $respuesta["propfechaultimainscripcion"] = '';
        $respuesta["propfechaultimarenovacion"] = '';
        $respuesta["propdircom"] = '';
        $respuesta["propmuncom"] = '';
        $respuesta["proptelcom1"] = '';
        $respuesta["proptelcom2"] = '';
        $respuesta["proptelcom3"] = '';
        $respuesta["propemailcom"] = '';
        $respuesta["propdirnot"] = '';
        $respuesta["propmunnot"] = '';
        $respuesta["proptelnot1"] = '';
        $respuesta["proptelnot2"] = '';
        $respuesta["proptelnot3"] = '';
        $respuesta["propemailnot"] = '';


        $respuesta["tramitepresencial"] = '';
        $respuesta["sede"] = '01';
        if (!isset($_SESSION["generales"]["codigousuario"]) || $_SESSION["generales"]["codigousuario"] == 'USUPUBXX') {
            $respuesta["sede"] = '99'; // Sede virtual
            $respuesta["tramitepresencial"] = '1'; // Tramite virtual
        } else {
            $respuesta["tramitepresencial"] = '4'; // Trámite presencial
            if (!isset($_SESSION["generales"]["sedeusuario"])) {
                $_SESSION["generales"]["sedeusuario"] = '01';
            }
            $respuesta["sede"] = $_SESSION["generales"]["sedeusuario"];
        }

        //
        $respuesta["anodeposito"] = '';
        $respuesta["cantidadfolios"] = '';
        $respuesta["cantidadhojas"] = '';
        $respuesta["enviara"] = '';
        $respuesta["gateway"] = '';

        //
        if ($tipo == 'VC') {
            return $respuesta;
        }

        //
        $arrLiq = array();

        //
        if ($tipo == 'L') {
            $arrLiq = retornarRegistroMysqliApi($dbx, 'mreg_liquidacion', "idliquidacion=" . $numliq);
        }

        //
        if ($tipo == 'NR') {
            $arrLiq = retornarRegistroMysqliApi($dbx, 'mreg_liquidacion', "numerorecuperacion='" . $numliq . "'");
            if (($arrLiq) && (!empty($arrLiq))) {
                $numliq = $arrLiq["idliquidacion"];
            }
        }

        if ($tipo == 'CB') {
            $arrLiq = retornarRegistroMysqliApi($dbx, 'mreg_liquidacion', "numeroradicacion='" . $numliq . "'");
            if (($arrLiq) && (!empty($arrLiq))) {
                $numliq = $arrLiq["idliquidacion"];
            }
        }

        if (empty($arrLiq)) {
            return false;
        }

        // 2016-07-31 : JINT
        // Asocia la sede al trámite
        if (!isset($arrLiq["sede"]) || $arrLiq["sede"] == '') {
            $arrLiq["sede"] = '99';
            if ($arrLiq["idusuario"] != 'USUPUBXX') {
                if ($arrLiq["idusuario"] == 'RUE') {
                    $arrLiq["sede"] = '90';
                } else {
                    $arrusu = retornarRegistroMysqliApi($dbx, 'usuarios', "idusuario='" . $arrLiq["idusuario"] . "'");
                    if ($arrusu === false || $arrusu["idsede"] == '') {
                        $arrLiq["sede"] = '01';
                    } else {
                        $arrLiq["sede"] = $arrusu["idsede"];
                    }
                }
            }
            if ($arrLiq["sede"] == '') {
                $arrLiq["sede"] = '01';
            }
        }

        if (!isset($arrLiq["pagoconsignacion"])) {
            $arrLiq["pagoconsignacion"] = 0;
        }
        if (!isset($arrLiq["proyectocaja"])) {
            $arrLiq["proyectocaja"] = '001';
        }
        if (!isset($arrLiq["cargoafiliacion"])) {
            $arrLiq["cargoafiliacion"] = 'NO';
        }
        if (!isset($arrLiq["cargogastoadministrativo"])) {
            $arrLiq["cargogastoadministrativo"] = 'NO';
        }
        if (!isset($arrLiq["cargoentidadoficial"])) {
            $arrLiq["cargoentidadoficial"] = 'NO';
        }
        if (!isset($arrLiq["cargoconsulta"])) {
            $arrLiq["cargoconsulta"] = 'NO';
        }
        if (!isset($arrLiq["domicilioorigen"])) {
            $arrLiq["domicilioorigen"] = '';
        }
        if (!isset($arrLiq["domiciliodestino"])) {
            $arrLiq["domiciliodestino"] = '';
        }
        if (!isset($arrLiq["benart7"])) {
            $arrLiq["benart7"] = 'N';
        }
        if (!isset($arrLiq["controlfirma"])) {
            $arrLiq["controlfirma"] = 'N';
        }
        if (!isset($arrLiq["ultanoren"])) {
            $arrLiq["ultanoren"] = '';
        }
        if (!isset($arrLiq["idmatriculabase"])) {
            $arrLiq["idmatriculabase"] = '';
        }
        if (!isset($arrLiq["idproponentebase"])) {
            $arrLiq["idproponentebase"] = '';
        }

        // $respuesta = array();
        $respuesta["idliquidacion"] = $arrLiq["idliquidacion"];
        $respuesta["numeroliquidacion"] = $arrLiq["idliquidacion"];
        $respuesta["fecha"] = $arrLiq["fecha"];
        $respuesta["hora"] = $arrLiq["hora"];
        $respuesta["fechaultimamodificacion"] = $arrLiq["fechaultimamodificacion"];
        $respuesta["idusuario"] = $arrLiq["idusuario"];
        $respuesta["tipotramite"] = $arrLiq["tipotramite"];
        $respuesta["iptramite"] = $arrLiq["iptramite"];
        $respuesta["idestado"] = $arrLiq["idestado"];
        $respuesta["txtestado"] = retornarRegistroMysqliApi($dbx, "mreg_liquidacionestados", "id='" . $arrLiq["idestado"] . "'", "descripcion");

        $respuesta["idexpedientebase"] = $arrLiq["idexpedientebase"];
        $respuesta["idmatriculabase"] = $arrLiq["idmatriculabase"];
        $respuesta["idproponentebase"] = $arrLiq["idproponentebase"];

        $respuesta["identificacionbase"] = $arrLiq["identificacionbase"];
        $respuesta["tipoidentificacionbase"] = $arrLiq["tipoidentificacionbase"];
        $respuesta["nombrebase"] = $arrLiq["nombrebase"];
        $respuesta["organizacionbase"] = $arrLiq["organizacionbase"];
        $respuesta["categoriabase"] = $arrLiq["categoriabase"];

        $respuesta["tipoidepnat"] = $arrLiq["tipoidepnat"];
        $respuesta["idepnat"] = $arrLiq["idepnat"];

        $respuesta["nombrepnat"] = $arrLiq["nombrepnat"];
        $respuesta["nombreest"] = $arrLiq["nombreest"];

        $respuesta["actpnat"] = $arrLiq["actpnat"];
        $respuesta["actest"] = $arrLiq["actest"];

        $respuesta["perpnat"] = $arrLiq["perpnat"];

        $respuesta["numeromatriculapnat"] = $arrLiq["numeromatriculapnat"];
        $respuesta["camarapnat"] = $arrLiq["camarapnat"];

        $respuesta["ultanoren"] = $arrLiq["ultanoren"];
        $respuesta["domicilioorigen"] = $arrLiq["domicilioorigen"];
        $respuesta["domiciliodestino"] = $arrLiq["domiciliodestino"];

        $respuesta["idtipoidentificacioncliente"] = $arrLiq["idtipoidentificacioncliente"];
        $respuesta["identificacioncliente"] = $arrLiq["identificacioncliente"];
        $respuesta["nombrecliente"] = $arrLiq["nombrecliente"];
        $respuesta["apellidocliente"] = $arrLiq["apellidocliente"];
        $respuesta["email"] = $arrLiq["email"];
        $respuesta["direccion"] = $arrLiq["direccion"];
        $respuesta["idmunicipio"] = $arrLiq["idmunicipio"];
        $respuesta["telefono"] = $arrLiq["telefono"];
        $respuesta["movil"] = $arrLiq["movil"];

        $respuesta["nombrepagador"] = $arrLiq["nombrepagador"];
        $respuesta["apellidopagador"] = $arrLiq["apellidopagador"];
        $respuesta["tipoidentificacionpagador"] = $arrLiq["tipoidentificacionpagador"];
        $respuesta["identificacionpagador"] = $arrLiq["identificacionpagador"];
        $respuesta["direccionpagador"] = $arrLiq["direccionpagador"];
        $respuesta["telefonopagador"] = $arrLiq["telefonopagador"];
        $respuesta["movilpagador"] = $arrLiq["movilpagador"];
        $respuesta["municipiopagador"] = $arrLiq["municipiopagador"];
        $respuesta["emailpagador"] = $arrLiq["emailpagador"];

        $respuesta["valorbruto"] = $arrLiq["valorbruto"];
        $respuesta["valorbaseiva"] = $arrLiq["valorbaseiva"];
        $respuesta["valoriva"] = $arrLiq["valoriva"];
        $respuesta["valortotal"] = $arrLiq["valortotal"];
        $respuesta["idsolicitudpago"] = $arrLiq["idsolicitudpago"];

        $respuesta["pagoefectivo"] = $arrLiq["pagoefectivo"];
        $respuesta["pagocheque"] = $arrLiq["pagocheque"];
        $respuesta["pagoconsignacion"] = $arrLiq["pagoconsignacion"];
        $respuesta["pagovisa"] = $arrLiq["pagovisa"];
        $respuesta["pagoach"] = $arrLiq["pagoach"];
        $respuesta["pagomastercard"] = $arrLiq["pagomastercard"];
        $respuesta["pagoamerican"] = $arrLiq["pagoamerican"];
        $respuesta["pagocredencial"] = $arrLiq["pagocredencial"];
        $respuesta["pagodiners"] = $arrLiq["pagodiners"];
        $respuesta["pagotdebito"] = $arrLiq["pagotdebito"];
        $respuesta["pagoprepago"] = $arrLiq["pagoprepago"];
        $respuesta["pagoafiliado"] = $arrLiq["pagoafiliado"];

        $respuesta["idformapago"] = $arrLiq["idformapago"];
        $respuesta["numerorecibo"] = $arrLiq["numerorecibo"];
        $respuesta["numerooperacion"] = $arrLiq["numerooperacion"];
        $respuesta["fecharecibo"] = $arrLiq["fecharecibo"];
        $respuesta["horarecibo"] = $arrLiq["horarecibo"];
        $respuesta["idfranquicia"] = $arrLiq["idfranquicia"];
        $respuesta["nombrefranquicia"] = $arrLiq["nombrefranquicia"];
        $respuesta["numeroautorizacion"] = $arrLiq["numeroautorizacion"];
        $respuesta["idcodban"] = $arrLiq["idcodban"];
        $respuesta["nombrebanco"] = $arrLiq["nombrebanco"];
        $respuesta["numerocheque"] = $arrLiq["numerocheque"];
        $respuesta["numerorecuperacion"] = $arrLiq["numerorecuperacion"];
        $respuesta["numeroradicacion"] = $arrLiq["numeroradicacion"];
        $respuesta["alertaid"] = $arrLiq["alertaid"];
        $respuesta["alertaservicio"] = $arrLiq["alertaservicio"];
        $respuesta["alertavalor"] = $arrLiq["alertavalor"];
        $respuesta["ctrcancelacion"] = $arrLiq["ctrcancelacion"];
        $respuesta["idasesor"] = $arrLiq["idasesor"];
        $respuesta["numeroempleados"] = $arrLiq["numeroempleados"];
        $respuesta["pagoafiliacion"] = $arrLiq["pagoafiliacion"];
        $respuesta["numerofactura"] = $arrLiq["numerofactura"];

        $respuesta["incluirformularios"] = $arrLiq["incluirformularios"];
        $respuesta["incluircertificados"] = $arrLiq["incluircertificados"];
        $respuesta["incluirdiploma"] = $arrLiq["incluirdiploma"];
        $respuesta["incluircartulina"] = $arrLiq["incluircartulina"];
        $respuesta["matricularpnat"] = $arrLiq["matricularpnat"];
        $respuesta["matricularest"] = $arrLiq["matricularest"];
        $respuesta["regimentributario"] = $arrLiq["regimentributario"];
        $respuesta["tipomatricula"] = $arrLiq["tipomatricula"];
        $respuesta["camaracambidom"] = $arrLiq["camaracambidom"];
        $respuesta["matriculacambidom"] = $arrLiq["matriculacambidom"];
        $respuesta["municipiocambidom"] = $arrLiq["municipiocambidom"];
        $respuesta["fecmatcambidom"] = $arrLiq["fecmatcambidom"];
        $respuesta["benart7"] = $arrLiq["benart7"];
        $respuesta["controlfirma"] = $arrLiq["controlfirma"];
        $respuesta["actualizacionciiuversion4"] = $arrLiq["actualizacionciiuversion4"];
        $respuesta["reliquidacion"] = $arrLiq["reliquidacion"];

        $respuesta["capital"] = $arrLiq["capital"];
        $respuesta["tipodoc"] = $arrLiq["tipodoc"];
        $respuesta["numdoc"] = $arrLiq["numdoc"];
        $respuesta["fechadoc"] = $arrLiq["fechadoc"];
        $respuesta["origendoc"] = $arrLiq["origendoc"];
        $respuesta["mundoc"] = $arrLiq["mundoc"];
        $respuesta["organizacion"] = $arrLiq["organizacion"];
        $respuesta["categoria"] = $arrLiq["categoria"];

        $respuesta["tipoiderepleg"] = $arrLiq["tipoiderepleg"];
        $respuesta["iderepleg"] = $arrLiq["iderepleg"];
        $respuesta["nombrerepleg"] = $arrLiq["nombrerepleg"];

        $respuesta["tipoideradicador"] = $arrLiq["tipoideradicador"];
        $respuesta["ideradicador"] = $arrLiq["ideradicador"];
        $respuesta["nombreradicador"] = $arrLiq["nombreradicador"];
        $respuesta["fechaexpradicador"] = $arrLiq["fechaexpradicador"];
        $respuesta["emailradicador"] = $arrLiq["emailradicador"];
        $respuesta["telefonoradicador"] = $arrLiq["telefonoradicador"];
        $respuesta["celularradicador"] = $arrLiq["celularradicador"];

        $respuesta["proyectocaja"] = $arrLiq["proyectocaja"];
        $respuesta["cargoafiliacion"] = $arrLiq["cargoafiliacion"];
        $respuesta["cargogastoadministrativo"] = $arrLiq["cargogastoadministrativo"];
        $respuesta["cargoentidadoficial"] = $arrLiq["cargoentidadoficial"];
        $respuesta["cargoconsulta"] = $arrLiq["cargoconsulta"];

        // 2016-04-08: JINT
        $respuesta["tramitepresencial"] = $arrLiq["tramitepresencial"];
        if ($respuesta["tramitepresencial"] == '') {
            if (!isset($_SESSION["generales"]["codigousuario"]) || $_SESSION["generales"]["codigousuario"] == 'USUPUBXX') {
                $respuesta["tramitepresencial"] = '1'; // Tramite virtual
            } else {
                $respuesta["tramitepresencial"] = '4'; // Trámite presencial
            }
        }

        // 2016-09-07: JINT
        $respuesta["firmadoelectronicamente"] = $arrLiq["firmadoelectronicamente"];
        $respuesta["firmadomanuscrita"] = $arrLiq["firmadomanuscrita"];

        $respuesta["cumplorequisitosbenley1780"] = $arrLiq["cumplorequisitosbenley1780"];
        $respuesta["mantengorequisitosbenley1780"] = $arrLiq["mantengorequisitosbenley1780"];
        $respuesta["renunciobeneficiosley1780"] = $arrLiq["renunciobeneficiosley1780"];
        $respuesta["controlactividadaltoimpacto"] = $arrLiq["controlactividadaltoimpacto"];
        $respuesta["multadoponal"] = $arrLiq["multadoponal"];
        $respuesta["gateway"] = $arrLiq["gateway"];

        //
        $respuesta["rues_claseidentificacion "] = '';

        $temCampos = retornarRegistrosMysqliApi($dbx, 'mreg_liquidacion_campos', "idliquidacion=" . $numliq);

        if (!empty($temCampos)) {
            foreach ($temCampos as $c) {
                if ($c["campo"] == 'incrementocupocertificados') {
                    $respuesta[$c["campo"]] = intval(trim($c["contenido"]));
                } else {
                    if ($c["campo"] != 'firmadoelectronicamente') {
                        $respuesta[$c["campo"]] = trim($c["contenido"]);
                    }
                }
            }
        }

        unset($temCampos);

        //
        // $respuesta["pagoefectivo"] = $respuesta["pagoefectivo"] + $respuesta["vueltas"];
        //
        // En caso de tramites rues	
        $temx = retornarRegistrosMysqliApi($dbx, 'mreg_liquidacion_textos_rues', "idliquidacion='" . $numliq . "'", "id");
        $ix = 0;
        foreach ($temx as $x) {
            $ix++;
            $respuesta["rues_textos"][$ix] = stripslashes($x);
        }
        unset($temx);

        //	
        //
        $respuesta["matriculabase"] = '';
        $respuesta["proponentebase"] = '';
        $respuesta["nrocontrolsipref"] = $arrLiq["nrocontrolsipref"];

        //
        $arrTem1 = retornarRegistroMysqliApi($dbx, 'bas_tipotramites', "id='" . $respuesta["tipotramite"] . "'");
        if ($arrTem1 && !empty($arrTem1)) {
            if ($arrTem1["tiporegistro"] == 'RegMer' || $arrTem1["tiporegistro"] == 'RegEsadl') {
                $respuesta["matriculabase"] = $respuesta["idexpedientebase"];
            }
            if ($arrTem1["tiporegistro"] == 'RegPro') {
                $respuesta["proponentebase"] = $respuesta["idexpedientebase"];
            }
        }

        //
        unset($arrLiq);

        //
        $respuesta["expedientes"] = array();
        $respuesta["transacciones"] = array();
        $respuesta["liquidacion"] = array();


        // Arma arreglo de la liquidación
        $ix = 0;
        $arrDet = retornarRegistrosMysqliApi($dbx, "mreg_liquidaciondetalle", "idliquidacion=" . $numliq, "idsec");
        foreach ($arrDet as $lin) {
            if ($lin["idservicio"] != '') {
                $renglon = array();
                $renglon["idsec"] = sprintf("%03s", $lin["idsec"]);
                $renglon["idservicio"] = $lin["idservicio"];
                $renglon["txtservicio"] = retornarRegistroMysqliApi($dbx, "mreg_servicios", "idservicio='" . $lin["idservicio"] . "'", "nombre");
                if (!isset($lin["cc"])) {
                    $lin["cc"] = '';
                }
                $renglon["cc"] = $lin["cc"];
                //$renglon["expediente"] = $lin["cc"].' - '.$lin["expediente"];
                $renglon["expediente"] = $lin["expediente"];
                $renglon["nombre"] = $lin["nombre"];
                $renglon["ano"] = $lin["ano"];
                $renglon["cantidad"] = $lin["cantidad"];
                $renglon["valorbase"] = $lin["valorbase"];
                $renglon["porcentaje"] = $lin["porcentaje"];
                $renglon["valorservicio"] = $lin["valorservicio"];
                $renglon["benart7"] = $lin["benart7"];
                $renglon["benley1780"] = $lin["benley1780"];
                $renglon["reliquidacion"] = $lin["reliquidacion"];
                $renglon["serviciobase"] = $lin["serviciobase"];
                $renglon["pagoafiliacion"] = $lin["pagoafiliacion"];
                $renglon["ir"] = $lin["ir"];
                $renglon["iva"] = $lin["iva"];
                $renglon["idalerta"] = $lin["idalerta"];
                $ix++;
                $respuesta["liquidacion"][$ix] = $renglon;
            }
        }
        unset($arrDet);

        // Arma arreglo de la liquidación RUES
        $ix = 0;
        $arrDet = retornarRegistrosMysqliApi($dbx, "mreg_liquidaciondetalle_rues", "idliquidacion=" . $numliq, "secuencia");
        foreach ($arrDet as $lin) {
            if ($lin["codigo_servicio"] != '') {
                $renglon = array();
                $renglon["codigo_servicio"] = $lin["codigo_servicio"];
                $renglon["descripcion_servicio"] = $lin["descripcion_servicio"];
                $renglon["orden_servicio"] = $lin["orden_servicio"];
                $renglon["orden_servicio_asociado"] = $lin["orden_servicio_asociado"];
                $renglon["nombre_base"] = $lin["nombre_base"];
                $renglon["valor_base"] = $lin["valor_base"];
                $renglon["valor_liquidacion"] = $lin["valor_liquidacion"];
                $renglon["cantidad_servicio"] = $lin["cantidad_servicio"];
                $renglon["indicador_base"] = $lin["indicador_base"];
                $renglon["indicador_renovacion"] = $lin["indicador_renovacion"];
                $renglon["matricula_servicio"] = $lin["matricula_servicio"];
                $renglon["nombre_matriculado"] = $lin["nombre_matriculado"];
                $renglon["ano_renovacion"] = $lin["ano_renovacion"];
                $renglon["valor_activos_sin_ajustes"] = $lin["valor_activos_sin_ajustes"];
                $ix++;
                $respuesta["rues_servicios"][$ix] = $renglon;
            }
        }
        unset($arrDet);

        // Arma arreglo de expedientes
        $temx = retornarRegistrosMysqliApi($dbx, "mreg_liquidacionexpedientes", "idliquidacion=" . $numliq);
        if ($temx === false) {
            $arrExp = false;
        } else {
            $arrExp = array();
            $i = -1;
            foreach ($temx as $res) {
                $i++;
                $arrExp[$i] = $res;
                if ($arrExp[$i]["registrobase"] == 'S') {
                    if (trim($arrExp[$i]["primeranorenovado"]) == '') {
                        $arrExp[$i]["primeranorenovado"] = $arrExp[$i]["ultimoanorenovado"];
                    }
                }
            }
        }
        unset($temx);


        if ($arrExp) {
            $i = 0;
            foreach ($arrExp as $lin) {
                $renglon = array();
                $i++;
                if (!isset($lin["cc"])) {
                    $lin["cc"] = '';
                }
                $renglon["cc"] = $lin["cc"];
                $renglon["matricula"] = $lin["matricula"];
                $renglon["proponente"] = $lin["proponente"];
                $renglon["numrue"] = $lin["numrue"];
                $renglon["idtipoidentificacion"] = $lin["idtipoidentificacion"];
                $renglon["identificacion"] = $lin["identificacion"];
                $renglon["razonsocial"] = $lin["razonsocial"];
                $renglon["ape1"] = $lin["ape1"];
                $renglon["ape2"] = $lin["ape2"];
                $renglon["nom1"] = $lin["nom1"];
                $renglon["nom2"] = $lin["nom2"];
                $renglon["organizacion"] = $lin["organizacion"];
                $renglon["txtorganizacion"] = retornarRegistroMysqliApi($dbx, "bas_organizacionjuridica", "id='" . $lin["organizacion"] . "'", "descripcion");
                $renglon["categoria"] = $lin["categoria"];
                $renglon["txtcategoria"] = '';
                if ($lin ["organizacion"] != '01' && $lin ["organizacion"] != '02') {
                    $renglon["txtcategoria"] = retornarRegistroMysqliApi($dbx, "bas_categorias", "id='" . $lin["categoria"] . "'", "descripcion");
                }
                $renglon["afiliado"] = $lin["afiliado"];
                $renglon["propietariojurisdiccion"] = $lin["propietariojurisdiccion"];
                $renglon["ultimoanoafiliado"] = $lin["ultimoanoafiliado"];
                $renglon["primeranorenovado"] = $lin["primeranorenovado"];
                $renglon["ultimoanorenovado"] = $lin["ultimoanorenovado"];
                $renglon["ultimosactivos"] = $lin["ultimosactivos"];
                $renglon["nuevosactivos"] = $lin["nuevosactivos"];
                $renglon["actividad"] = $lin["actividad"];
                $renglon["registrobase"] = $lin["registrobase"];
                $renglon["benart7"] = $lin["benart7"];
                $renglon["benley1780"] = $lin["benley1780"];
                $renglon["fechanacimiento"] = $lin["fechanacimiento"];
                $renglon["renovaresteano"] = $lin["renovaresteano"];
                $renglon["fechamatricula"] = $lin["fechamatricula"];
                $renglon["fecmatant"] = $lin["fecmatant"];
                $renglon["reliquidacion"] = $lin["reliquidacion"];
                $renglon["controlpot"] = $lin["controlpot"];
                $respuesta["expedientes"][$i] = $renglon;
            }
        }
        unset($arrExp);

        // Arma arreglo de transacciones
        $ix = 0;
        $arrTra = retornarRegistrosMysqliApi($dbx, 'mreg_liquidacion_transacciones', "idliquidacion=" . $respuesta["numeroliquidacion"], "idsecuencia");
        foreach ($arrTra as $tra) {
            $ix++;
            $respuesta["transacciones"][$ix] = $tra;
        }
        unset($arrTra);

        //
        $respuesta["iLin"] = $i;

        //
        if ($respuesta["numerorecuperacion"] != '') {
            if (file_exists('../' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/fotoEvidencias/' . substr($respuesta["numerorecuperacion"], 0, 3) . '/' . $respuesta["numerorecuperacion"] . '-Foto.jpg')) {
                $respuesta["foto"] = '../' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/fotoEvidencias/' . substr($respuesta["numerorecuperacion"], 0, 3) . '/' . $respuesta["numerorecuperacion"] . '-Foto.jpg';
                $respuesta["fotoabsoluta"] = PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/fotoEvidencias/' . substr($respuesta["numerorecuperacion"], 0, 3) . '/' . $respuesta["numerorecuperacion"] . '-Foto.jpg';
            } else {
                $respuesta["fotoabsoluta"] = 'images/sii/people.png';
                $respuesta["foto"] = '../images/sii/people.png';
            }

            if (file_exists('../' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/fotoEvidencias/' . substr($respuesta["numerorecuperacion"], 0, 3) . '/' . $respuesta["numerorecuperacion"] . '-Cedula1.jpg')) {
                $respuesta["cedula1"] = '../' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/fotoEvidencias/' . substr($respuesta["numerorecuperacion"], 0, 3) . '/' . $respuesta["numerorecuperacion"] . '-Cedula1.jpg';
                $respuesta["cedula1absoluta"] = PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/fotoEvidencias/' . substr($respuesta["numerorecuperacion"], 0, 3) . '/' . $respuesta["numerorecuperacion"] . '-Cedula1.jpg';
            } else {
                $respuesta["cedula1absoluta"] = 'images/sii/people.png';
                $respuesta["cedula1"] = '../images/sii/people.png';
            }

            if (file_exists('../' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/fotoEvidencias/' . substr($respuesta["numerorecuperacion"], 0, 3) . '/' . $respuesta["numerorecuperacion"] . '-Cedula2.jpg')) {
                $respuesta["cedula2"] = '../' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/fotoEvidencias/' . substr($respuesta["numerorecuperacion"], 0, 3) . '/' . $respuesta["numerorecuperacion"] . '-Cedula2.jpg';
                $respuesta["cedula2absoluta"] = PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/fotoEvidencias/' . substr($respuesta["numerorecuperacion"], 0, 3) . '/' . $respuesta["numerorecuperacion"] . '-Cedula2.jpg';
            } else {
                $respuesta["cedula2absoluta"] = 'images/sii/people.png';
                $respuesta["cedula2"] = '../images/sii/people.png';
            }
        }


        return $respuesta;
    }

    public static function retornarMregSecuencia($dbx, $clave) {
        $arrTem = retornarRegistroMysqliApi($dbx, 'mreg_secuencias', "id='" . $clave . "'");
        if ($arrTem === false || empty($arrTem)) {
            return 0;
        } else {
            return $arrTem["secuencia"];
        }
    }

    public static function retornarMregSecuenciaMaxAsentarRecibo($dbx, $clave) {

        //
        if ($clave == 'RECIBOS-NORMALES') {
            $query = "select max(recibo) as a from mreg_recibosgenerados where substring(recibo,1,1) = 'S'";
        }
        if ($clave == 'RECIBOS-NOTAS') {
            $query = "select max(recibo) as a from mreg_recibosgenerados where substring(recibo,1,1) = 'M'";
        }
        if ($clave == 'RECIBOS-GA') {
            $query = "select max(recibo) as a from mreg_recibosgenerados where substring(recibo,1,1) = 'H'";
        }
        if ($clave == 'RECIBOS-CO') {
            $query = "select max(recibo) as a from mreg_recibosgenerados where substring(recibo,1,1) = 'D'";
        }

        //
        $temx = ejecutarQueryMysqliApi($dbx, $query);
        $siguiente = ltrim(substr($temx[1]["a"], 1), "0");

        //
        return $siguiente;
    }

    public static function rutinaNotificarRadicacion($mysqli, $recibo = '', $codbarras = '', $emailsentrada = array(), $celularesentrada = array(), $nameLog = '', $idliquidacion = 0) {

        ini_set('memory_limit', '1024M');

        if ($nameLog == '') {
            $nameLog = 'rutinaNotificarRadicacion_API_' . date("Ymd");
        }
        \logApi::general2($nameLog, $idliquidacion, 'Ingreso a notificar radicacion  : ' . $recibo . ' /' . $codbarras);

        //
        $reg = false;
        $notificar = 'si';

        // *********************************************************************************** //
        // Localiza el recibo a través del código de barras
        // *********************************************************************************** //
        if ($recibo == '' && $codbarras != '') {
            $temx = retornarRegistroMysqliApi($mysqli, 'mreg_est_codigosbarras', "codigobarras='" . $codbarras . "'");
            if ($temx && !empty($temx)) {
                if ($temx["recibo"] != '') {
                    $query = "recibo='" . $temx["recibo"] . "' and tipogasto IN ('0','4','6','8')";
                    $reg = retornarRegistroMysqliApi($mysqli, 'mreg_recibosgenerados', $query);
                }
            }
            \logApi::general2($nameLog, $idliquidacion, 'Localizo recibo a traves del codigo de barras');
        }

        // *********************************************************************************** //
        // Localiza el recibo directamente por el numero
        // *********************************************************************************** //
        if ($recibo != '') {
            $query = "recibo='" . $recibo . "' and tipogasto IN ('0','4','6','8')";
            $reg = retornarRegistroMysqliApi($mysqli, 'mreg_recibosgenerados', $query);
            \logApi::general2($nameLog, $idliquidacion, 'Localizo recibo a traves del nro de recibo');
        }

        // *********************************************************************************** //
        // Inicializa arreglo de respuesta
        // *********************************************************************************** //
        $resultadoRecibo = array();

        // ********************************************************************************* //
        // Si no encuentra el recibo se sale con false
        // ********************************************************************************* //
        if ($reg === false || empty($reg)) {
            $notificar = 'no';
            \logApi::general2($nameLog, $idliquidacion, 'Recibo no localizado : ' . $reg["recibo"]);
            return false;
        }

        // ********************************************************************************* //
        // Lee el código de barras
        // ********************************************************************************* //
        if ($reg["codigobarras"] === false || empty($reg["codigobarras"])) {
            $notificar = 'no';
            \logApi::general2($nameLog, $idliquidacion, 'Recibo sin codigo de barras');
            return false;
        }
        $arrTemCB = retornarRegistroMysqliApi($mysqli, 'mreg_est_codigosbarras', "codigobarras='" . $reg["codigobarras"] . "'");

        // ********************************************************************************* //
        // Si no encuentra el código de barras se sale con no
        // ********************************************************************************* //
        if ($arrTemCB === false || empty($arrTemCB)) {
            $notificar = 'no';
            \logApi::general2($nameLog, $idliquidacion, 'Código de barras no localizado  : ' . $reg["recibo"] . ' /' . $reg["codigobarras"]);
            return false;
        }

        // ********************************************************************************* //
        // Si el código de barras es de embargos
        // se sale sin notificar
        // ********************************************************************************* //
        if ($arrTemCB["actoreparto"] == '07' || $arrTemCB["actoreparto"] == '29') {
            $notificar = 'no';
            \logApi::general2($nameLog, $idliquidacion, 'Código de barras no notificable, embargo, desembargo o medida cautelar  : ' . $reg["recibo"] . ' /' . $reg["codigobarras"]);
            return false;
        }

        // ********************************************************************************* //
        // Localiza liquidacion
        // ********************************************************************************* //
        $liq = retornarRegistroMysqliApi($mysqli, 'mreg_liquidacion', "numerorecibo='" . $reg["recibo"] . "'");
        if ($liq === false || empty($liq)) {
            $liq = false;
        }

        // ********************************************************************************* //
        // Localiza transaccion (solo en caso de compraventas)
        // ********************************************************************************* //
        if ($arrTemCB["actoreparto"] == '25' && $liq && !empty($liq)) {
            $liqtras = retornarRegistrosMysqliApi($mysqli, 'mreg_liquidacion_transacciones', "idliquidacion=" . $liq["idliquidacion"], "id");
        } else {
            $liqtras = false;
        }

        // ********************************************************************************* //
        // Localiza bandeja de digitalización
        // ********************************************************************************* //
        $bandejaDigitalizacion = '';
        $tt = retornarRegistroMysqliApi($mysqli, 'mreg_codrutas', "id='" . $arrTemCB["actoreparto"] . "'");
        if ($tt && !empty($tt)) {
            $bandejaDigitalizacion = $tt["bandeja"];
        }

        //
        \logApi::general2($nameLog, $idliquidacion, 'Notificaciones: Localizo recibo : ' . $reg["recibo"]);

        // ********************************************************************************* //    
        // Inicializa variables para el conrol del envío de las notificaciones
        // ********************************************************************************* //    
        $resultadoRecibo["nrec"] = $reg["recibo"];
        $resultadoRecibo["cba"] = $reg["codigobarras"];
        $resultadoRecibo["ope"] = $reg["operacion"];
        $resultadoRecibo["fec"] = $reg["fecha"];
        $resultadoRecibo["hor"] = $reg["hora"];
        $resultadoRecibo["ide"] = $reg["identificacion"];
        $resultadoRecibo["nom"] = $reg["razonsocial"];
        $resultadoRecibo["mat"] = array();
        $resultadoRecibo["pro"] = '';
        $resultadoRecibo["ser"] = array();
        $resultadoRecibo["valor"] = $reg["valorneto"];
        $resultadoRecibo["tt"] = $reg["tipotramite"];
        $resultadoRecibo["emails"] = array();
        $resultadoRecibo["telefonos"] = array();
        $resultadoRecibo["emailshistoricos"] = array();
        $resultadoRecibo["telefonoshistoricos"] = array();

        // ********************************************************************************* //    
        // Encuentra correos y celulares asociados a la liquidacion
        // ********************************************************************************* //  
        if ($liq && !empty($liq)) {
            if ($liq["email"] != '') {
                if (!isset($resultadoRecibo["emails"][$liq["email"]])) {
                    $resultadoRecibo["emails"][$liq["email"]] = $liq["email"];
                }
            }
            if ($liq["emailpagador"] != '') {
                if (!isset($resultadoRecibo["emails"][$liq["emailpagador"]])) {
                    $resultadoRecibo["emails"][$liq["emailpagador"]] = $liq["emailpagador"];
                }
            }
            if ($liq["telefono"] != '' && strlen($liq["telefono"]) == 10 && substr($liq["telefono"], 0, 1) == '3') {
                $resultadoRecibo["telefonos"][$liq["telefono"]] = $liq["telefono"];
            }
            if ($liq["movil"] != '' && strlen($liq["movil"]) == 10 && substr($liq["movil"], 0, 1) == '3') {
                $resultadoRecibo["telefonos"][$liq["movil"]] = $liq["movil"];
            }
            if ($liq["telefonopagador"] != '' && strlen($liq["telefonopagador"]) == 10 && substr($liq["telefonopagador"], 0, 1) == '3') {
                $resultadoRecibo["telefonos"][$liq["telefonopagador"]] = $liq["telefonopagador"];
            }
            if ($liq["movilpagador"] != '' && strlen($liq["movilpagador"]) == 10 && substr($liq["movilpagador"], 0, 1) == '3') {
                $resultadoRecibo["telefonos"][$liq["movilpagador"]] = $liq["movilpagador"];
            }
        }

        // ********************************************************************************* //    
        // Encuentra correos y celulares asociados al recibo
        // ********************************************************************************* // 
        $resultadoRecibo["emails"][$reg["email"]] = $reg["email"];
        if ($reg["telefono1"] != '' && strlen($reg["telefono1"]) == 10 && substr($reg["telefono1"], 0, 1) == '3') {
            $resultadoRecibo["telefonos"][$reg["telefono1"]] = $reg["telefono1"];
        }
        if ($reg["telefono2"] != '' && strlen($reg["telefono2"]) == 10 && substr($reg["telefono2"], 0, 1) == '3') {
            $resultadoRecibo["telefonos"][$reg["telefono2"]] = $reg["telefono2"];
        }

        // ********************************************************************************* //    
        // Encuentra correos y celulares asociados a la transaccion
        // ********************************************************************************* // 
        if ($liqtras && !empty($liqtras)) {
            foreach ($liqtras as $liqtra) {
                if ($liqtra["emailvendedor"] != '') {
                    if (!isset($resultadoRecibo["emails"][$liqtra["emailvendedor"]])) {
                        $resultadoRecibo["emails"][$liqtra["emailvendedor"]] = $liqtra["emailvendedor"];
                    }
                }
                if ($liqtra["emailcomprador"] != '') {
                    if (!isset($resultadoRecibo["emails"][$liqtra["emailcomprador"]])) {
                        $resultadoRecibo["emails"][$liqtra["emailcomprador"]] = $liqtra["emailcomprador"];
                    }
                }
                if ($liqtra["celularvendedor"] != '' && strlen($liqtra["celularvendedor"]) == 10 && substr($liqtra["celularvendedor"], 0, 1) == '3') {
                    if (!isset($resultadoRecibo["telefonos"][$liqtra["celularvendedor"]])) {
                        $resultadoRecibo["emails"][$liqtra["celularvendedor"]] = $liqtra["celularvendedor"];
                    }
                }
                if ($liqtra["celularcomprador"] != '' && strlen($liqtra["celularcomprador"]) == 10 && substr($liqtra["celularcomprador"], 0, 1) == '3') {
                    if (!isset($resultadoRecibo["telefonos"][$liqtra["celularcomprador"]])) {
                        $resultadoRecibo["emails"][$liqtra["celularcomprador"]] = $liqtra["celularcomprador"];
                    }
                }
            }
        }

        // ********************************************************************************* //    
        // Adiciona emails reportados como parámetros
        // ********************************************************************************* // 
        if (empty($emailsentrada)) {
            foreach ($emailsentrada as $e) {
                if (!isset($resultadoRecibo["emails"][$e])) {
                    $resultadoRecibo["emails"][$e] = $e;
                }
            }
        }

        // ********************************************************************************* //    
        // Adiciona celulares reportados como parámetros
        // ********************************************************************************* // 
        if (empty($celularesentrada)) {
            foreach ($celularesentrada as $e) {
                if (!isset($resultadoRecibo["telefonos"][$e])) {
                    $resultadoRecibo["telefonos"][$e] = $e;
                }
            }
        }

        // ******************************************************************************************** //    
        // Busca las matrículas y proponentes asociadas al trámite a traves de recibosgenerados_detalle
        // ******************************************************************************************** // 
        $arrTem = retornarRegistrosMysqliApi($mysqli, 'mreg_recibosgenerados_detalle', "recibo='" . $reg["recibo"] . "'", "secuencia");
        $j = 0;
        if ($arrTem && !empty($arrTem)) {
            foreach ($arrTem as $tx) {
                $j++;
                if ($j == 1) {
                    if ($tx["matricula"] != '' && substr($tx["matricula"], 0, 5) != 'NUEVA') {
                        $resultadoRecibo["mat"][$tx["matricula"]] = $tx["matricula"];
                    }
                    if ($tx["proponente"] != '') {
                        $resultadoRecibo["pro"] = $tx["proponente"];
                    }
                    if (!isset($resultadoRecibo["ser"][$tx["idservicio"]])) {
                        $resultadoRecibo["ser"][$tx["idservicio"]] = $tx["idservicio"];
                    }
                    \logApi::general2($nameLog, $liq["idliquidacion"], 'Notificaciones: Localizo matricula : ' . $tx["matricula"]);
                    \logApi::general2($nameLog, $liq["idliquidacion"], 'Notificaciones: Localizo servicio : ' . $tx["idservicio"]);
                }
            }
        }

        // ************************************************************************************************** //
        // Adiciona los emails y celulares asociados al código de barras
        // ************************************************************************************************** //
        // $arrTemCB = retornarRegistroMysqli($mysqli, 'mreg_est_codigosbarras', "codigobarras='" . $reg["codigobarras"] . "'");
        if ($arrTemCB["emailnot1"] != '') {
            $resultadoRecibo["emails"][$arrTemCB["emailnot1"]] = $arrTemCB["emailnot1"];
        }
        if ($arrTemCB["emailnot2"] != '') {
            $resultadoRecibo["emails"][$arrTemCB["emailnot2"]] = $arrTemCB["emailnot2"];
        }
        if ($arrTemCB["emailnot3"] != '') {
            $resultadoRecibo["emails"][$arrTemCB["emailnot3"]] = $arrTemCB["emailnot3"];
        }
        if ($arrTemCB["celnot1"] != '' && strlen($arrTemCB["celnot1"]) == 10 && substr($arrTemCB["celnot1"], 0, 1) == '3') {
            $resultadoRecibo["telefonos"][$arrTemCB["celnot1"]] = $arrTemCB["celnot1"];
        }
        if ($arrTemCB["celnot2"] != '' && strlen($arrTemCB["celnot2"]) == 10 && substr($arrTemCB["celnot2"], 0, 1) == '3') {
            $resultadoRecibo["telefonos"][$arrTemCB["celnot2"]] = $arrTemCB["celnot2"];
        }
        if ($arrTemCB["celnot3"] != '' && strlen($arrTemCB["celnot3"]) == 10 && substr($arrTemCB["celnot3"], 0, 1) == '3') {
            $resultadoRecibo["telefonos"][$arrTemCB["celnot3"]] = $arrTemCB["celnot3"];
        }

        // *********************************************************************************** //
        // Busca cada expediente
        // *********************************************************************************** //            
        if (!empty($resultadoRecibo["mat"])) {
            foreach ($resultadoRecibo["mat"] as $m) {
                $exp = retornarRegistroMysqliApi($mysqli, 'mreg_est_inscritos', "matricula='" . $m . "'");

                // *********************************************************************************** //
                // Localiza emails y celulares actuales
                // *********************************************************************************** //                                    
                if ($exp && !empty($exp)) {
                    if (trim($exp["telcom1"]) != '' && strlen($exp["telcom1"]) == 10 && substr($exp["telcom1"], 0, 1) == '3') {
                        $resultadoRecibo["telefonos"][$exp["telcom1"]] = $exp["telcom1"];
                    }
                    if (trim($exp["telcom2"]) != '' && strlen($exp["telcom2"]) == 10 && substr($exp["telcom2"], 0, 1) == '3') {
                        $resultadoRecibo["telefonos"][$exp["telcom2"]] = $exp["telcom2"];
                    }
                    if (trim($exp["telcom3"]) != '' && strlen($exp["telcom3"]) == 10 && substr($exp["telcom3"], 0, 1) == '3') {
                        $resultadoRecibo["telefonos"][$exp["telcom3"]] = $exp["telcom3"];
                    }
                    if (trim($exp["telnot"]) != '' && strlen($exp["telnot"]) == 10 && substr($exp["telnot"], 0, 1) == '3') {
                        $resultadoRecibo["telefonos"][$exp["telnot"]] = $exp["telnot"];
                    }
                    if (trim($exp["telnot2"]) != '' && strlen($exp["telnot2"]) == 10 && substr($exp["telnot2"], 0, 1) == '3') {
                        $resultadoRecibo["telefonos"][$exp["telnot2"]] = $exp["telnot2"];
                    }
                    if (trim($exp["telnot3"]) != '' && strlen($exp["telnot3"]) == 10 && substr($exp["telnot3"], 0, 1) == '3') {
                        $resultadoRecibo["telefonos"][$exp["telnot3"]] = $exp["telnot3"];
                    }
                    if (trim($exp["emailcom"]) != '') {
                        $resultadoRecibo["emails"][$exp["emailcom"]] = $exp["emailcom"];
                    }
                    if (trim($exp["emailcom2"]) != '') {
                        $resultadoRecibo["emails"][$exp["emailcom2"]] = $exp["emailcom2"];
                    }
                    if (trim($exp["emailcom3"]) != '') {
                        $resultadoRecibo["emails"][$exp["emailcom3"]] = $exp["emailcom3"];
                    }
                    if (trim($exp["emailnot"]) != '') {
                        $resultadoRecibo["emails"][$exp["emailnot"]] = $exp["emailnot"];
                    }
                }

                // *********************************************************************************** //
                // Localiza emails y celulares anteriores migrados del sirep
                // *********************************************************************************** //                                                            
                $exps = retornarRegistrosMysqliApi($mysqli, 'mreg_est_campostablas', "tabla='200' and registro='" . ltrim($m, "0") . "'", "id");
                if ($exps && !empty($exps)) {
                    foreach ($exps as $exps1) {
                        if (trim($exps1["campo"]) == "EMAILCOM-ANTERIOR") {
                            if (!isset($resultadoRecibo["emailshistoricos"][trim($exps1["contenido"])])) {
                                if (!isset($resultadoRecibo["emails"][trim($exps1["contenido"])])) {
                                    $resultadoRecibo["emailshistoricos"][trim($exps1["contenido"])] = trim($exps1["contenido"]);
                                }
                            }
                        }
                        if (trim($exps1["campo"]) == "EMAILNOT-ANTERIOR") {
                            if (!isset($resultadoRecibo["emailshistoricos"][trim($exps1["contenido"])])) {
                                if (!isset($resultadoRecibo["emails"][trim($exps1["contenido"])])) {
                                    $resultadoRecibo["emailshistoricos"][trim($exps1["contenido"])] = trim($exps1["contenido"]);
                                }
                            }
                        }
                        if (trim($exps1["campo"]) == "CELCOM-ANTERIOR") {
                            if (!isset($resultadoRecibo["telefonoshistoricos"][trim($exps1["contenido"])])) {
                                if (!isset($resultadoRecibo["telefonos"][trim($exps1["contenido"])])) {
                                    $resultadoRecibo["telefonoshistoricos"][trim($exps1["contenido"])] = trim($exps1["contenido"]);
                                }
                            }
                        }
                        if (trim($exps1["campo"]) == "CELNOT-ANTERIOR") {
                            if (!isset($resultadoRecibo["telefonoshistoricos"][trim($exps1["contenido"])])) {
                                if (!isset($resultadoRecibo["telefonos"][trim($exps1["contenido"])])) {
                                    $resultadoRecibo["telefonoshistoricos"][trim($exps1["contenido"])] = trim($exps1["contenido"]);
                                }
                            }
                        }
                    }
                }

                // *********************************************************************************** //
                // Localiza emails y celulares modificados en mreg_campos_historicos_AAAA
                // *********************************************************************************** //                                                            
                $d = localizarCampoAnteriorTodosMysqliApi($mysqli, $m, 'telcom1');
                foreach ($d as $d1) {
                    if (trim($d1) != '' && strlen($d1) == 10 && substr($d1, 0, 1) == '3') {
                        if (!isset($resultadoRecibo["telefonoshistoricos"][trim($d1)])) {
                            if (!isset($resultadoRecibo["telefonos"][trim($d1)])) {
                                $resultadoRecibo["telefonoshistoricos"][trim($d1)] = trim($d1);
                            }
                        }
                    }
                }
                $d = localizarCampoAnteriorTodosMysqliApi($mysqli, $m, 'telcom2');
                foreach ($d as $d1) {
                    if (trim($d1) != '' && strlen($d1) == 10 && substr($d1, 0, 1) == '3') {
                        if (!isset($resultadoRecibo["telefonoshistoricos"][trim($d1)])) {
                            if (!isset($resultadoRecibo["telefonos"][trim($d1)])) {
                                $resultadoRecibo["telefonoshistoricos"][trim($d1)] = trim($d1);
                            }
                        }
                    }
                }
                $d = localizarCampoAnteriorTodosMysqliApi($mysqli, $m, 'telcom3');
                foreach ($d as $d1) {
                    if (trim($d1) != '' && strlen($d1) == 10 && substr($d1, 0, 1) == '3') {
                        if (!isset($resultadoRecibo["telefonoshistoricos"][trim($d1)])) {
                            if (!isset($resultadoRecibo["telefonos"][trim($d1)])) {
                                $resultadoRecibo["telefonoshistoricos"][trim($d1)] = trim($d1);
                            }
                        }
                    }
                }
                $d = localizarCampoAnteriorTodosMysqliApi($mysqli, $m, 'telnot');
                foreach ($d as $d1) {
                    if (trim($d1) != '' && strlen($d1) == 10 && substr($d1, 0, 1) == '3') {
                        if (!isset($resultadoRecibo["telefonoshistoricos"][trim($d1)])) {
                            if (!isset($resultadoRecibo["telefonos"][trim($d1)])) {
                                $resultadoRecibo["telefonoshistoricos"][trim($d1)] = trim($d1);
                            }
                        }
                    }
                }
                $d = localizarCampoAnteriorTodosMysqliApi($mysqli, $m, 'emailcom');
                foreach ($d as $d1) {
                    if (!isset($resultadoRecibo["emailshistoricos"][trim($d1)])) {
                        if (!isset($resultadoRecibo["emails"][trim($d1)])) {
                            $resultadoRecibo["emailshistoricos"][trim($d1)] = trim($d1);
                        }
                    }
                }
                $d = localizarCampoAnteriorTodosMysqliApi($mysqli, $m, 'emailnot');
                foreach ($d as $d1) {
                    if (!isset($resultadoRecibo["emailshistoricos"][trim($d1)])) {
                        if (!isset($resultadoRecibo["emails"][trim($d1)])) {
                            $resultadoRecibo["emailshistoricos"][trim($d1)] = trim($d1);
                        }
                    }
                }
            }
        }

        // *********************************************************************************** //
        // Recupera números telefonicos y emails actuales - proponentes
        // *********************************************************************************** //
        if ($resultadoRecibo["pro"] != '') {
            $exp = retornarRegistroMysqliApi($mysqli, 'mreg_est_proponentes', "proponente='" . $resultadoRecibo["pro"] . "'");
            if ($exp && !empty($exp)) {
                if (trim($exp["telcom1"]) != '' && strlen($exp["telcom1"]) == 10 && substr($exp["telcom1"], 0, 1) == '3') {
                    if (!isset($resultadoRecibo["telefonos"][$exp["telcom1"]])) {
                        $resultadoRecibo["telefonos"][$exp["telcom1"]] = $exp["telcom1"];
                    }
                }
                if (trim($exp["telcom2"]) != '' && strlen($exp["telcom2"]) == 10 && substr($exp["telcom2"], 0, 1) == '3') {
                    if (!isset($resultadoRecibo["telefonos"][$exp["telcom2"]])) {
                        $resultadoRecibo["telefonos"][$exp["telcom2"]] = $exp["telcom2"];
                    }
                }
                if (trim($exp["celcom"]) != '' && strlen($exp["celcom"]) == 10 && substr($exp["celcom"], 0, 1) == '3') {
                    if (!isset($resultadoRecibo["telefonos"][$exp["celcom"]])) {
                        $resultadoRecibo["telefonos"][$exp["celcom"]] = $exp["celcom"];
                    }
                }
                if (trim($exp["telnot"]) != '' && strlen($exp["telnot"]) == 10 && substr($exp["telnot"], 0, 1) == '3') {
                    if (!isset($resultadoRecibo["telefonos"][$exp["telnot"]])) {
                        $resultadoRecibo["telefonos"][$exp["telnot"]] = $exp["telnot"];
                    }
                }
                if (trim($exp["telnot2"]) != '' && strlen($exp["telnot2"]) == 10 && substr($exp["telnot2"], 0, 1) == '3') {
                    if (!isset($resultadoRecibo["telefonos"][$exp["telnot2"]])) {
                        $resultadoRecibo["telefonos"][$exp["telnot2"]] = $exp["telnot2"];
                    }
                }
                if (trim($exp["celnot"]) != '' && strlen($exp["celnot"]) == 10 && substr($exp["celnot"], 0, 1) == '3') {
                    if (!isset($resultadoRecibo["telefonos"][$exp["celnot"]])) {
                        $resultadoRecibo["telefonos"][$exp["celnot"]] = $exp["celnot"];
                    }
                }
                if (trim($exp["emailcom"]) != '') {
                    if (!isset($resultadoRecibo["emails"][$exp["emailcom"]])) {
                        $resultadoRecibo["emails"][$exp["emailcom"]] = $exp["emailcom"];
                    }
                }
                if (trim($exp["emailnot"]) != '') {
                    if (!isset($resultadoRecibo["emails"][$exp["emailnot"]])) {
                        $resultadoRecibo["emails"][$exp["emailnot"]] = $exp["emailnot"];
                    }
                }
            }
        }

        unset($reg);

        //
        // *********************************************************************************** //
        // Log de cantidad de emails y celulares
        // *********************************************************************************** //
        \logApi::general2($nameLog, $liq["idliquidacion"], 'Notificaciones: Total emails vigentes : ' . count($resultadoRecibo["emails"]));
        \logApi::general2($nameLog, $liq["idliquidacion"], 'Notificaciones: Total emails históricos : ' . count($resultadoRecibo["emailshistoricos"]));
        \logApi::general2($nameLog, $liq["idliquidacion"], 'Notificaciones: Total celulares vigentes : ' . count($resultadoRecibo["telefonos"]));
        \logApi::general2($nameLog, $liq["idliquidacion"], 'Notificaciones: Total celulares históricos : ' . count($resultadoRecibo["telefonoshistoricos"]));

        // *********************************************************************************** //
        // Localiza descripción de servicio(s) a notificar
        // *********************************************************************************** //
        $txtServicios = '';
        foreach ($resultadoRecibo["ser"] as $ser) {
            if ($txtServicios != '') {
                $txtServicios .= ', ';
            }
            $txtServicios .= retornarRegistroMysqliApi($mysqli, 'mreg_servicios', "idservicio='" . $ser . "'", "nombre");
        }
        \logApi::general2($nameLog, $liq["idliquidacion"], 'Notificaciones: Servicio a reportar ' . $txtServicios);
        $sinemails = 0;

        // *********************************************************************************** //
        // 2019-09-26: JINT.
        // Determinar si se envía o no a los históricos
        // En caso que no se envie, limpiar los arreglos de históricos y guardar log
        // *********************************************************************************** //
        // *********************************************************************************** //
        // Une arreglos de emails y celurares
        // *********************************************************************************** //
        $resultadoRecibo["listaemails"] = array_merge($resultadoRecibo["emails"], $resultadoRecibo["emailshistoricos"]);
        $resultadoRecibo["listatelefonos"] = array_merge($resultadoRecibo["telefonos"], $resultadoRecibo["telefonoshistoricos"]);

        //
        $arrCampos = array(
            'recibo',
            'codigobarras',
            'idliquidacion',
            'tipo',
            'contenido'
        );
        $arrValores = array();
        if (!empty($resultadoRecibo["listaemails"])) {
            $arrValores = array();
            foreach ($resultadoRecibo["listaemails"] as $e) {
                $arrValores[] = array(
                    "'" . $reg["recibo"] . "'",
                    "'" . $codbarras . "'",
                    "'" . $reg["idliquidacion"] . "'",
                    "'email-radicacion'",
                    "'" . $e . "'"
                );
            }
        }
        if (!empty($resultadoRecibo["listatelefonos"])) {
            $arrValores = array();
            foreach ($resultadoRecibo["listatelefonos"] as $e) {
                $arrValores[] = array(
                    "'" . $reg["recibo"] . "'",
                    "'" . $codbarras . "'",
                    "'" . $reg["idliquidacion"] . "'",
                    "'telefono-radicacion'",
                    "'" . $e . "'"
                );
            }
        }

        // *********************************************************************************** //
        // Almacena tabla donde guarda que emails y celulares será notificados por recibo
        // *********************************************************************************** //
        if (!empty($arrValores)) {
            insertarRegistrosBloqueMysqliApi($mysqli, 'mreg_recibos_sipref_destinos', $arrCampos, $arrValores);
        }

        // *********************************************************************************** //
        // Envía emails de notificaicón
        // *********************************************************************************** //
        if (count($resultadoRecibo["listaemails"]) == 0) {
            $arrCampos = array('estadoemail');
            $arrValores = array("'2'");
            regrabarRegistrosMysqliApi($mysqli, 'mreg_recibosgenerados', $arrCampos, $arrValores, "recibo='" . $resultadoRecibo["nrec"] . "'");
            $sinemails++;
        } else {
            $msg = '';
            $msg .= 'LA ' . RAZONSOCIAL . ' le informa que el dia ' . \funcionesGenerales::mostrarFecha($resultadoRecibo["fec"]) . ' a las ' . \funcionesGenerales::mostrarHora($resultadoRecibo["hor"]) . ' ';
            $msg .= 'fue radicada en nuestras oficinas una transaccion en los registros publicos que ';
            $msg .= 'administra y maneja nuestra entidad. Los datos del tramite radicado son los siguientes:<br><br>';
            $msg .= 'Recibo de Caja No. ' . $resultadoRecibo["nrec"] . '<br>';
            $msg .= 'Numero operacion: ' . $resultadoRecibo["ope"] . '<br>';
            if (ltrim($resultadoRecibo["cba"], "0") != '') {
                $msg .= 'Codigo de barras: ' . $resultadoRecibo["cba"] . '<br>';
            }
            $mats = '';
            if (!empty($resultadoRecibo["mat"])) {
                foreach ($resultadoRecibo["mat"] as $mt1) {
                    if ($mats != '') {
                        $mats .= ', ';
                    }
                    $mats .= $mt1;
                }
            }
            if ($mats != '') {
                $msg .= 'Matriculas/Inscripciones: ' . $mats . '<br>';
            }
            if (ltrim($resultadoRecibo["pro"], "0") != '') {
                $msg .= 'Proponente: ' . $resultadoRecibo["pro"] . '<br>';
            }

            $msg .= 'Identificacion: ' . $resultadoRecibo["ide"] . '<br>';
            $msg .= 'Nombre: ' . utf8_decode($resultadoRecibo["nom"]) . '<br>';
            $msg .= 'Tramite: ' . $txtServicios . '<br>';
            foreach ($resultadoRecibo["listaemails"] as $emx) {
                $msg .= 'Email : ' . $emx . '<br>';
            }
            $msg .= '<br>';
            $msg .= 'Valor de la transaccion: ' . $resultadoRecibo["valor"] . '<br><br>';

            $msg .= 'De conformidad con lo establecido en el numeral 1.14.2.3 de la Circular 002 de noviembre 23 de 2016 de la Superintendencia de ';
            $msg .= 'Industria y Comercio el titular de la informacion tiene el derecho a oponerse del tramite cuando advierta que el acto o documento ';
            $msg .= 'que pretende modificar su registro, no es de su procedencia. La oposicion puede efectuarse verbalmente o por escrito y en el ';
            $msg .= 'termino de dos (2) dias habiles contados a partir del momento en que se manifieste la oposicion, el titular de la informacion ';
            $msg .= 'debe aportar la denuncia penal correspondiente, para que la Camara de Comercio pueda abstenerse de realizar el registro o la ';
            $msg .= 'modificacion solicitada. Si el titular de la informacion no se opone o no allega la denuncia correspondiente, la Camara de Comercio ';
            $msg .= 'debera continuar la actuacion.<br><br>';
            $msg .= 'Cuando la persona que aparece firmando la peticion de modificacion de informacion o el acta o documento del cual se solicita su registro, ';
            $msg .= 'concurre personalmente a la Camara de Comercio y manifiesta no haberlo suscrito, la entidad cameral se abstendra de realizar la inscripcion ';
            $msg .= 'o la modificacion de informacion solicitada.<br><br>';
            $msg .= 'Si alguna persona tiene otro tipo de reparo en relacion con el documento que se radico para que modifique el registro, este debe ';
            $msg .= 'debatirse utilizando los medios que le otorga la normativa vigente, dentro de los que pueden mencionarse, a manera de ejemplo, ';
            $msg .= 'los recursos administrativos, las denuncias penales por posibles delitos y las demandas de impugnacion de actas ante los jueces de ';
            $msg .= 'la Republica y/o autoridades competentes.<br><br>';

            $msg .= 'Para el efecto puede comunicarse al numero ' . TELEFONO_ATENCION_USUARIOS . ' en la ciudad ';
            $msg .= 'de ' . retornarNombreMunicipioMysqliApi($mysqli, MUNICIPIO) . ' citando el Nro. ' . $resultadoRecibo["nrec"] . '<br><br>';

            $msg .= 'Este mensaje se envia en forma automatica por el Sistema de Registro de LA ' . RAZONSOCIAL . ' ';
            $msg .= 'en cumplimiento a lo contemplado en el Codigo de Procedimiento Administrativo y de lo Contencioso Administrativo.';
            $msg .= '<br><br>';
            $msg .= 'Correo desatendido: Por favor no responda a la direccion de correo electronico que envia este mensaje, dicha cuenta ';
            $msg .= 'no es revisada por ningun funcionario de nuestra entidad. Este mensaje es informativo.';
            $msg .= '<br><br>';
            $msg .= 'Los acentos y tildes de este correo han sido omitidos intencionalmente con el objeto de evitar inconvenientes en la lectura del mismo.';


            // ***************************************************************************************** //
            // En caso de renovación que se asienta automáticamente
            // ***************************************************************************************** //
            $msg1 = '';
            $msg1 .= 'LA ' . RAZONSOCIAL . ' le informa que el dia ' . \funcionesGenerales::mostrarFecha($resultadoRecibo["fec"]) . ' a las ' . \funcionesGenerales::mostrarHora($resultadoRecibo["hor"]) . ' ';
            $msg1 .= 'fue asentada en los registros publicos que ';
            $msg1 .= 'administra y maneja nuestra organizacion una renovacion con la siguiente informacion: <br><br>';
            $msg1 .= 'Recibo de Caja No. ' . $resultadoRecibo["nrec"] . '<br>';
            $msg1 .= 'Numero operacion: ' . $resultadoRecibo["ope"] . '<br>';
            if (ltrim($resultadoRecibo["cba"], "0") != '') {
                $msg1 .= 'Codigo de barras: ' . $resultadoRecibo["cba"] . '<br>';
            }
            $mats = '';
            if (!empty($resultadoRecibo["mat"])) {
                foreach ($resultadoRecibo["mat"] as $mt1) {
                    if ($mats != '') {
                        $mats .= ', ';
                    }
                    $mats .= $mt1;
                }
            }
            if ($mats != '') {
                $msg1 .= 'Matriculas/Inscripciones: ' . $mats . '<br>';
            }
            if (ltrim($resultadoRecibo["pro"], "0") != '') {
                $msg1 .= 'Proponente: ' . $resultadoRecibo["pro"] . '<br>';
            }

            $msg1 .= 'Identificacion: ' . $resultadoRecibo["ide"] . '<br>';
            $msg1 .= 'Nombre: ' . utf8_decode($resultadoRecibo["nom"]) . '<br>';
            $msg1 .= 'Tramite: ' . $txtServicios . '<br>';
            foreach ($resultadoRecibo["listaemails"] as $emx) {
                $msg1 .= 'Email : ' . $emx . '<br>';
            }
            $msg1 .= '<br>';
            $msg1 .= 'Valor de la transaccion: ' . $resultadoRecibo["valor"] . '<br><br>';

            if (!defined('NOTIFICAR_TELEFONO')) {
                define('NOTIFICAR_TELEFONO', 'NO');
            }
            if (NOTIFICAR_TELEFONO == 'SI') {
                $msg1 .= 'Si tiene alguna duda o inquietud con el contenido de esta notificacion, puede comunicarse al ';
                $msg1 .= 'numero ' . TELEFONO_ATENCION_USUARIOS . ' en la ciudad de ' . retornarNombreMunicipioMysqliApi($mysqli, MUNICIPIO) . ' ';
                $msg1 .= 'citando el tramite (recibo de caja) No. ' . $resultadoRecibo["nrec"] . '<br><br>';
            }

            $msg1 .= 'Este mensaje se envia en forma automatica por el Sistema de Registro de LA ' . RAZONSOCIAL . ' ';
            $msg1 .= 'en cumplimiento a lo contemplado en el Codigo de Procedimiento Administrativo y de lo Contencioso Administrativo.';
            $msg1 .= '<br><br>';
            $msg1 .= 'Correo desatendido: Por favor no responda a la direccion de correo electronico que envia este mensaje, dicha cuenta ';
            $msg1 .= 'no es revisada por ningun funcionario de nuestra entidad. Este mensaje es informativo.';
            $msg1 .= '<br><br>';
            $msg1 .= 'Los acentos y tildes de este correo han sido omitidos intencionalmente con el objeto de evitar inconvenientes en la lectura del mismo.';

            //
            $emailtotales = 0;
            $emailvalidos = 0;
            foreach ($resultadoRecibo["listaemails"] as $emx) {
                if (trim($emx) != '') {
                    $emx1 = $emx;
                    if (TIPO_AMBIENTE == 'PRUEBAS') {
                        if (defined('EMAIL_NOTIFICACION_PRUEBAS') && EMAIL_NOTIFICACION_PRUEBAS != '') {
                            $emx1 = EMAIL_NOTIFICACION_PRUEBAS;
                        } else {
                            $emx1 = 'jint@confecamaras.org.co';
                        }
                    }
                    $emailtotales++;
                    if (\funcionesGenerales::validarEmail($emx) === true) {

                        $rEmail = \funcionesGenerales::enviarEmail(SERVER_SMTP, CUENTA_ADMIN_PORTAL, CLAVE_ADMIN_PORTAL, EMAIL_ADMIN_PORTAL, NOMBRE_ADMIN_PORTAL, $emx1, 'Notificacion de radicacion No. ' . $resultadoRecibo["nrec"] . ' en  LA ' . RAZONSOCIAL, $msg);
                        if ($resultadoRecibo["tt"] == 'renovacionmatricula' || $resultadoRecibo["tt"] == 'renovacionesadl') {
                            if ($_SESSION["tramite"]["multadoponal"] != 'S' &&
                                    $_SESSION["tramite"]["multadoponal"] != 'L' &&
                                    $_SESSION["tramite"]["controlactividadaltoimpacto"] != 'S' &&
                                    ($_SESSION ["tramite"] ["cumplorequisitosbenley1780"] != 'S' ||
                                    $_SESSION ["tramite"] ["mantengorequisitosbenley1780"] != 'S' ||
                                    $_SESSION ["tramite"] ["renunciobeneficiosley1780"] != 'N')) {
                                $rEmail1 = \funcionesGenerales::enviarEmail(SERVER_SMTP, CUENTA_ADMIN_PORTAL, CLAVE_ADMIN_PORTAL, EMAIL_ADMIN_PORTAL, NOMBRE_ADMIN_PORTAL, $emx1, 'Notificacion de asentamiento No. ' . $resultadoRecibo["nrec"] . ' en  LA ' . RAZONSOCIAL, $msg1);
                            } else {
                                unset($rEmail1);
                            }
                        } else {
                            unset($rEmail1);
                        }

                        //
                        if (($arrTemCB["actoreparto"] != '07') && ($arrTemCB["actoreparto"] != '29')) {
                            if ($rEmail === false) {
                                \funcionesRegistrales::actualizarMregNotificacionesParaEnviarEmail($mysqli, '01', $resultadoRecibo["cba"], '', $resultadoRecibo["ope"], $resultadoRecibo["nrec"], '', '', '', '', $resultadoRecibo["ide"], '', $resultadoRecibo["pro"], $resultadoRecibo["nom"], $emx, $msg, date("Ymd"), date("His"), date("Ymd"), date("His"), '2', '** ERROR : ' . $_SESSION["generales"]["mensajeerror"], $bandejaDigitalizacion);
                            } else {
                                \funcionesRegistrales::actualizarMregNotificacionesParaEnviarEmail($mysqli, '01', $resultadoRecibo["cba"], '', $resultadoRecibo["ope"], $resultadoRecibo["nrec"], '', '', '', '', $resultadoRecibo["ide"], '', $resultadoRecibo["pro"], $resultadoRecibo["nom"], $emx, $msg, date("Ymd"), date("His"), date("Ymd"), date("His"), '3', '**OK **', $bandejaDigitalizacion);
                            }
                            if (isset($rEmail1)) {
                                if ($rEmail1 === false) {
                                    \funcionesRegistrales::actualizarMregNotificacionesParaEnviarEmail($mysqli, '10', $resultadoRecibo["cba"], '', $resultadoRecibo["ope"], $resultadoRecibo["nrec"], '', '', '', '', $resultadoRecibo["ide"], '', $resultadoRecibo["pro"], $resultadoRecibo["nom"], $emx, $msg1, date("Ymd"), date("His"), date("Ymd"), date("His"), '2', '** ERROR : ' . $_SESSION["generales"]["mensajeerror"], $bandejaDigitalizacion);
                                } else {
                                    \funcionesRegistrales::actualizarMregNotificacionesParaEnviarEmail($mysqli, '10', $resultadoRecibo["cba"], '', $resultadoRecibo["ope"], $resultadoRecibo["nrec"], '', '', '', '', $resultadoRecibo["ide"], '', $resultadoRecibo["pro"], $resultadoRecibo["nom"], $emx, $msg1, date("Ymd"), date("His"), date("Ymd"), date("His"), '3', '**OK **', $bandejaDigitalizacion);
                                }
                            }
                        } else {
                            if (isset($resultadoRecibo["mat"]) && !empty($resultadoRecibo["mat"])) {
                                foreach ($resultadoRecibo["mat"] as $mt1) {
                                    if ($rEmail === false) {
                                        \funcionesRegistrales::actualizarMregNotificacionesParaEnviarEmail($mysqli, '01', $resultadoRecibo["cba"], '', $resultadoRecibo["ope"], $resultadoRecibo["nrec"], '', '', '', '', $resultadoRecibo["ide"], $mt1, $resultadoRecibo["pro"], $resultadoRecibo["nom"], $emx, $msg, date("Ymd"), date("His"), date("Ymd"), date("His"), '2', '** ERROR : ' . $_SESSION["generales"]["mensajeerror"], $bandejaDigitalizacion);
                                    } else {
                                        \funcionesRegistrales::actualizarMregNotificacionesParaEnviarEmail($mysqli, '01', $resultadoRecibo["cba"], '', $resultadoRecibo["ope"], $resultadoRecibo["nrec"], '', '', '', '', $resultadoRecibo["ide"], $mt1, $resultadoRecibo["pro"], $resultadoRecibo["nom"], $emx, $msg, date("Ymd"), date("His"), date("Ymd"), date("His"), '3', '**OK **', $bandejaDigitalizacion);
                                    }
                                    if (isset($rEmail1)) {
                                        if ($rEmail1 === false) {
                                            \funcionesRegistrales::actualizarMregNotificacionesParaEnviarEmail($mysqli, '10', $resultadoRecibo["cba"], '', $resultadoRecibo["ope"], $resultadoRecibo["nrec"], '', '', '', '', $resultadoRecibo["ide"], $mt1, $resultadoRecibo["pro"], $resultadoRecibo["nom"], $emx, $msg1, date("Ymd"), date("His"), date("Ymd"), date("His"), '2', '** ERROR : ' . $_SESSION["generales"]["mensajeerror"], $bandejaDigitalizacion);
                                        } else {
                                            \funcionesRegistrales::actualizarMregNotificacionesParaEnviarEmail($mysqli, '10', $resultadoRecibo["cba"], '', $resultadoRecibo["ope"], $resultadoRecibo["nrec"], '', '', '', '', $resultadoRecibo["ide"], $mt1, $resultadoRecibo["pro"], $resultadoRecibo["nom"], $emx, $msg1, date("Ymd"), date("His"), date("Ymd"), date("His"), '3', '**OK **', $bandejaDigitalizacion);
                                        }
                                    }
                                }
                            } else {
                                if ($rEmail === false) {
                                    \funcionesRegistrales::actualizarMregNotificacionesParaEnviarEmail($mysqli, '01', $resultadoRecibo["cba"], '', $resultadoRecibo["ope"], $resultadoRecibo["nrec"], '', '', '', '', $resultadoRecibo["ide"], '', '', $resultadoRecibo["nom"], $emx, $msg, date("Ymd"), date("His"), date("Ymd"), date("His"), '2', '** ERROR : ' . $_SESSION["generales"]["mensajeerror"], $bandejaDigitalizacion);
                                } else {
                                    \funcionesRegistrales::actualizarMregNotificacionesParaEnviarEmail($mysqli, '01', $resultadoRecibo["cba"], '', $resultadoRecibo["ope"], $resultadoRecibo["nrec"], '', '', '', '', $resultadoRecibo["ide"], '', '', $resultadoRecibo["nom"], $emx, $msg, date("Ymd"), date("His"), date("Ymd"), date("His"), '3', '**OK **', $bandejaDigitalizacion);
                                }
                                if (isset($rEmail1)) {
                                    if ($rEmail1 === false) {
                                        \funcionesRegistrales::actualizarMregNotificacionesParaEnviarEmail($mysqli, '10', $resultadoRecibo["cba"], '', $resultadoRecibo["ope"], $resultadoRecibo["nrec"], '', '', '', '', $resultadoRecibo["ide"], '', '', $resultadoRecibo["nom"], $emx, $msg1, date("Ymd"), date("His"), date("Ymd"), date("His"), '2', '** ERROR : ' . $_SESSION["generales"]["mensajeerror"], $bandejaDigitalizacion);
                                    } else {
                                        \funcionesRegistrales::actualizarMregNotificacionesParaEnviarEmail($mysqli, '10', $resultadoRecibo["cba"], '', $resultadoRecibo["ope"], $resultadoRecibo["nrec"], '', '', '', '', $resultadoRecibo["ide"], '', '', $resultadoRecibo["nom"], $emx, $msg1, date("Ymd"), date("His"), date("Ymd"), date("His"), '3', '**OK **', $bandejaDigitalizacion);
                                    }
                                }
                            }
                        }

                        //
                        if ($rEmail) {
                            $emailvalidos++;
                        }
                    }
                }
            }

            // Actualiza el estado de la notificacion en SIREP
            if ($emailvalidos == 0) {
                if (NOTIFICAR_RADICACION == 'SI') {
                    $arrCampos = array('estadoemail');
                    $arrValores = array("'2'");
                    regrabarRegistrosMysqliApi($mysqli, 'mreg_recibosgenerados', $arrCampos, $arrValores, "recibo='" . $resultadoRecibo["nrec"] . "'");
                }
            }

            if ($emailvalidos > 0) {
                if (NOTIFICAR_RADICACION == 'SI') {
                    $arrCampos = array('estadoemail');
                    $arrValores = array("'1'");
                    regrabarRegistrosMysqliApi($mysqli, 'mreg_recibosgenerados', $arrCampos, $arrValores, "recibo='" . $resultadoRecibo["nrec"] . "'");
                }
            }
        }

        // ***************************************************************************** //
        // Enviar a SMS
        // ***************************************************************************** //
        if (count($resultadoRecibo["listatelefonos"]) == 0) {
            $arrCampos = array('estadosms');
            $arrValores = array("'2'");
            regrabarRegistrosMysqliApi($mysqli, 'mreg_recibosgenerados', $arrCampos, $arrValores, "recibo='" . $resultadoRecibo["nrec"] . "'");
        } else {
            $mt1 = '';
            foreach ($resultadoRecibo["mat"] as $mx) {
                if ($mt1 == '') {
                    $mt1 = $mx;
                }
            }

            //
            if (defined('RAZONSOCIALSMS') && trim(RAZONSOCIALSMS) != '') {
                $txtSms = 'La ' . RAZONSOCIALSMS . ' le informa que el ' . \funcionesGenerales::mostrarFecha($resultadoRecibo["fec"]) . ' a las ' . \funcionesGenerales::mostrarHora($resultadoRecibo["hor"]) . ' se radico una transaccion para el expediente ' . ltrim($mt1, "0") . ltrim($resultadoRecibo["pro"], "0");
            } else {
                $txtSms = 'La ' . RAZONSOCIAL . ' le informa que el ' . \funcionesGenerales::mostrarFecha($resultadoRecibo["fec"]) . ' a las ' . \funcionesGenerales::mostrarHora($resultadoRecibo["hor"]) . ' se radico una transaccion para el expediente ' . ltrim($mt1, "0") . ltrim($resultadoRecibo["pro"], "0");
            }

            //
            if (defined('RAZONSOCIALSMS') && trim(RAZONSOCIALSMS) != '') {
                $txtSms1 = 'La ' . RAZONSOCIALSMS . ' le informa que el ' . \funcionesGenerales::mostrarFecha($resultadoRecibo["fec"]) . ' a las ' . \funcionesGenerales::mostrarHora($resultadoRecibo["hor"]) . ' se asento la renovacion del expediente ' . ltrim($mt1, "0") . ltrim($resultadoRecibo["pro"], "0");
            } else {
                $txtSms1 = 'La ' . RAZONSOCIAL . ' le informa que el ' . \funcionesGenerales::mostrarFecha($resultadoRecibo["fec"]) . ' a las ' . \funcionesGenerales::mostrarHora($resultadoRecibo["hor"]) . ' se asento la renovacion del expediente ' . ltrim($mt1, "0") . ltrim($resultadoRecibo["pro"], "0");
            }

            //
            if ($tt["tipo"] == 'PQ') {
                if (defined('RAZONSOCIALSMS') && trim(RAZONSOCIALSMS) != '') {
                    $txtSms = 'La ' . RAZONSOCIALSMS . ' le informa que el ' . \funcionesGenerales::mostrarFecha($resultadoRecibo["fec"]) . ' a las ' . \funcionesGenerales::mostrarHora($resultadoRecibo["hor"]) . ' se radico una PQR para el expediente ' . ltrim($mt1, "0") . ltrim($resultadoRecibo["pro"], "0");
                } else {
                    $txtSms = 'La ' . RAZONSOCIAL . ' le informa que el ' . \funcionesGenerales::mostrarFecha($resultadoRecibo["fec"]) . ' a las ' . \funcionesGenerales::mostrarHora($resultadoRecibo["hor"]) . ' se radico una PQR para el expediente ' . ltrim($mt1, "0") . ltrim($resultadoRecibo["pro"], "0");
                }
            }

            foreach ($resultadoRecibo["listatelefonos"] as $t) {
                $exp1 = '';
                if (ltrim($mt1, "0") != '') {
                    $exp1 = $mt1;
                }
                if (ltrim($resultadoRecibo["pro"], "0") != '') {
                    $exp1 = $resultadoRecibo["pro"];
                }
                \funcionesRegistrales::actualizarPilaSms($mysqli, $t, '1', $resultadoRecibo["nrec"], $resultadoRecibo["cba"], '', '', $exp1, $mt1, $resultadoRecibo["pro"], $resultadoRecibo["ide"], $resultadoRecibo["nom"], $txtSms, '', $bandejaDigitalizacion);
                if ($resultadoRecibo["tt"] == 'renovacionmatricula' || $resultadoRecibo["tt"] == 'renovacionesadl') {
                    $enviar = 'no';
                    if ($_SESSION["tramite"]["multadoponal"] != 'S' &&
                            $_SESSION["tramite"]["multadoponal"] != 'L' &&
                            $_SESSION["tramite"]["controlactividadaltoimpacto"] != 'S' &&
                            ($_SESSION ["tramite"] ["cumplorequisitosbenley1780"] != 'S' ||
                            $_SESSION ["tramite"] ["mantengorequisitosbenley1780"] != 'S' ||
                            $_SESSION ["tramite"] ["renunciobeneficiosley1780"] != 'N')) {
                        $enviar = 'si';
                    } else {
                        if ($_SESSION["tramite"]["reliquidacion"] == 'si') {
                            $enviar = 'si';
                        }
                    }
                    if ($enviar == 'si') {
                        \funcionesRegistrales::actualizarPilaSms($mysqli, $t, '10', $resultadoRecibo["nrec"], $resultadoRecibo["cba"], '', '', $exp1, $mt1, $resultadoRecibo["pro"], $resultadoRecibo["ide"], $resultadoRecibo["nom"], $txtSms1, '', $bandejaDigitalizacion);
                    }
                }
            }

            // ***************************************************************************** //
            // Actualización final del recibo como notificado
            // ***************************************************************************** //
            $arrCampos = array('estadosms');
            $arrValores = array("'1'");
            regrabarRegistrosMysqliApi($mysqli, 'mreg_recibosgenerados', $arrCampos, $arrValores, "recibo='" . $resultadoRecibo["nrec"] . "'");
        }
    }

    public static function rutinaNotificarInscripciones($mysqli, $codbarras = '', $idliquidacion = 0, $nameLog = '') {

        ini_set('memory_limit', '1024M');

        if ($nameLog == '') {
            $nameLog = 'rutinaNotificarInscripciones_API_' . date("Ymd");
        }
        \logApi::general2($nameLog, $idliquidacion, 'Ingreso a notificar inscripciones  : ' . $codbarras);

        $arrEmails = array();
        $arrTels = array();

        //
        if (trim($codbarras) != '') {
            $arrTem = retornarRegistrosMysqliApi($mysqli, 'mreg_est_inscripciones', "idradicacion='" . ltrim($codbarras, "0") . "'", "id");
            if ($arrTem && !empty($arrTem)) {
                foreach ($arrTem as $t) {
                    if ($t["idnotificacionemail"] == 0 || $t["idnotificacionsms"] == 0) {
                        $bandejaDigitalizacion = '4.-REGMER';
                        if (substr($t["libro"], 0, 2) == 'RE') {
                            $bandejaDigitalizacion = '5.-REGESADL';
                        }
                        if ($t["matricula"] != '') {
                            $exps = retornarRegistroMysqliApi($mysqli, 'mreg_est_inscritos', "matricula='" . $t["matricula"] . "'");
                            if ($exps["emailcom"] != '') {
                                $arrEmails[$exps["emailcom"]] = $exps["emailcom"];
                            }
                            if ($exps["emailnot"] != '') {
                                $arrEmails[$exps["emailnot"]] = $exps["emailnot"];
                            }

                            //
                            $exps["telcom1"] = ltrim(trim(str_replace(array("+", " ", ",", ".", "-"), "", $exps["telcom1"])), "0");
                            $exps["telcom2"] = ltrim(trim(str_replace(array("+", " ", ",", ".", "-"), "", $exps["telcom2"])), "0");
                            $exps["telcom3"] = ltrim(trim(str_replace(array("+", " ", ",", ".", "-"), "", $exps["telcom3"])), "0");
                            $exps["telnot"] = ltrim(trim(str_replace(array("+", " ", ",", ".", "-"), "", $exps["telnot"])), "0");
                            $exps["telnot2"] = ltrim(trim(str_replace(array("+", " ", ",", ".", "-"), "", $exps["telnot2"])), "0");
                            $exps["telnot3"] = ltrim(trim(str_replace(array("+", " ", ",", ".", "-"), "", $exps["telnot3"])), "0");

                            //
                            if ($exps["telcom1"] != '' && strlen($exps["telcom1"]) == 10 && substr($exps["telcom1"], 0, 1) == '3') {
                                $arrTels[$exps["telcom1"]] = $exps["telcom1"];
                            }
                            if ($exps["telcom2"] != '' && strlen($exps["telcom2"]) == 10 && substr($exps["telcom2"], 0, 1) == '3') {
                                $arrTels[$exps["telcom2"]] = $exps["telcom2"];
                            }
                            if ($exps["telcom3"] != '' && strlen($exps["telcom3"]) == 10 && substr($exps["telcom3"], 0, 1) == '3') {
                                $arrTels[$exps["telcom3"]] = $exps["telcom3"];
                            }
                            if ($exps["telnot"] != '' && strlen($exps["telnot"]) == 10 && substr($exps["telnot"], 0, 1) == '3') {
                                $arrTels[$exps["telnot"]] = $exps["telnot"];
                            }
                            if ($exps["telnot2"] != '' && strlen($exps["telnot2"]) == 10 && substr($exps["telnot2"], 0, 1) == '3') {
                                $arrTels[$exps["telnot2"]] = $exps["telnot2"];
                            }
                            if ($exps["telnot3"] != '' && strlen($exps["telnot3"]) == 10 && substr($exps["telnot3"], 0, 1) == '3') {
                                $arrTels[$exps["telnot3"]] = $exps["telnot3"];
                            }

                            // *********************************************************************************** //
                            // Localiza emails y celulares anteriores migrados del SII
                            // *********************************************************************************** //                                                            
                            $exps = retornarRegistrosMysqliApi($mysqli, 'mreg_est_campostablas', "tabla='200' and registro='" . ltrim($t["matricula"], "0") . "'", "id");
                            if ($exps && !empty($exps)) {
                                foreach ($exps as $exps1) {
                                    if (trim($exps1["campo"]) == "EMAILCOM-ANTERIOR") {
                                        $arrEmails[trim($exps1["contenido"])] = trim($exps1["contenido"]);
                                    }
                                    if (trim($exps1["campo"]) == "EMAILNOT-ANTERIOR") {
                                        $arrEmails[trim($exps1["contenido"])] = trim($exps1["contenido"]);
                                    }
                                    if (trim($exps1["campo"]) == "CELCOM-ANTERIOR") {
                                        $exps1["contenido"] = ltrim(trim(str_replace(array("+", " ", ",", ".", "-"), "", $exps1["contenido"])), "0");
                                        if (strlen(trim($exps1["contenido"])) == 10 && substr(trim($exps1["contenido"]), 0, 1) == '3') {
                                            $arrTels[trim($exps1["contenido"])] = trim($exps1["contenido"]);
                                        }
                                    }
                                    if (trim($exps1["campo"]) == "CELNOT-ANTERIOR") {
                                        $exps1["contenido"] = ltrim(trim(str_replace(array("+", " ", ",", ".", "-"), "", $exps1["contenido"])), "0");
                                        if (strlen(trim($exps1["contenido"])) == 10 && substr(trim($exps1["contenido"]), 0, 1) == '3') {
                                            $arrTels[trim($exps1["contenido"])] = trim($exps1["contenido"]);
                                        }
                                    }
                                }
                            }

                            // *********************************************************************************** //
                            // Localiza emails y celulares modificados en mreg_campos_historicos_AAAA
                            // *********************************************************************************** //                                                            
                            $d = localizarCampoAnteriorTodosMysqliApi($mysqli, $t["matricula"], 'telcom1');
                            foreach ($d as $d1) {
                                $d1 = ltrim(trim(str_replace(array("+", " ", ",", ".", "-"), "", $d1)), "0");
                                if (trim($d1) != '' && strlen($d1) == 10 && substr($d1, 0, 1) == '3') {
                                    $arrTels[trim($d1)] = trim($d1);
                                }
                            }
                            $d = localizarCampoAnteriorTodosMysqliApi($mysqli, $t["matricula"], 'telcom2');
                            foreach ($d as $d1) {
                                $d1 = ltrim(trim(str_replace(array("+", " ", ",", ".", "-"), "", $d1)), "0");
                                if (trim($d1) != '' && strlen($d1) == 10 && substr($d1, 0, 1) == '3') {
                                    $arrTels[trim($d1)] = trim($d1);
                                }
                            }
                            $d = localizarCampoAnteriorTodosMysqliApi($mysqli, $t["matricula"], 'telcom3');
                            foreach ($d as $d1) {
                                $d1 = ltrim(trim(str_replace(array("+", " ", ",", ".", "-"), "", $d1)), "0");
                                if (trim($d1) != '' && strlen($d1) == 10 && substr($d1, 0, 1) == '3') {
                                    $arrTels[trim($d1)] = trim($d1);
                                }
                            }
                            $d = localizarCampoAnteriorTodosMysqliApi($mysqli, $t["matricula"], 'telnot');
                            foreach ($d as $d1) {
                                $d1 = ltrim(trim(str_replace(array("+", " ", ",", ".", "-"), "", $d1)), "0");
                                if (trim($d1) != '' && strlen($d1) == 10 && substr($d1, 0, 1) == '3') {
                                    $arrTels[trim($d1)] = trim($d1);
                                }
                            }
                            $d = localizarCampoAnteriorTodosMysqliApi($mysqli, $t["matricula"], 'emailcom');
                            foreach ($d as $d1) {
                                $arrEmails[trim($d1)] = trim($d1);
                            }
                            $d = localizarCampoAnteriorTodosMysqliApi($mysqli, $t["matricula"], 'emailnot');
                            foreach ($d as $d1) {
                                $arrEmails[trim($d1)] = trim($d1);
                            }

                            //

                            $arrCampos = array(
                                'recibo',
                                'codigobarras',
                                'idliquidacion',
                                'tipo',
                                'contenido'
                            );
                            $arrValores = array();
                            if (!empty($arrEmails)) {
                                $arrValores = array();
                                foreach ($arrEmails as $e) {
                                    $arrValores[] = array(
                                        "''",
                                        "'" . $codbarras . "'",
                                        "'" . $idliquidacion . "'",
                                        "'email-inscripcion'",
                                        "'" . $e . "'"
                                    );
                                }
                            }
                            if (!empty($arrTels)) {
                                $arrValores = array();
                                foreach ($arrTels as $e) {
                                    $arrValores[] = array(
                                        "''",
                                        "'" . $codbarras . "'",
                                        "'" . $idliquidacion . "'",
                                        "'telefono-inscripcion'",
                                        "'" . $e . "'"
                                    );
                                }
                            }

                            // *********************************************************************************** //
                            // Almacena tabla donde guarda que emails y celulares será notificados por recibo
                            // *********************************************************************************** //
                            if (!empty($arrValores)) {
                                insertarRegistrosBloqueMysqliApi($mysqli, 'mreg_recibos_sipref_destinos', $arrCampos, $arrValores);
                            }

                            //
                            if (!empty($arrEmails)) {
                                $totEmails = 0;
                                $totCorrectos = 0;
                                foreach ($arrEmails as $em) {
                                    $totEmails++;
                                    $mensaje = \funcionesRegistrales::generarEmailNotificacionInscripcionSipref($mysqli, $t);
                                    $emx = $em;
                                    if (TIPO_AMBIENTE == 'PRUEBAS') {
                                        $emx = 'jint@confecamaras.org.co';
                                        if (define('EMAIL_NOTIFICACION_PRUEBAS') && EMAIL_NOTIFICACION_PRUEBAS != '') {
                                            $emx = EMAIL_NOTIFICACION_PRUEBAS;
                                        }
                                    }
                                    $rEmail = \funcionesGenerales::enviarEmail(SERVER_SMTP, CUENTA_ADMIN_PORTAL, CLAVE_ADMIN_PORTAL, EMAIL_ADMIN_PORTAL, NOMBRE_ADMIN_PORTAL, $emx, 'Notificacion de inscripcion No. ' . $t["libro"] . '-' . $t["registro"] . '-' . $t["dupli"] . ' en  LA ' . RAZONSOCIAL, $mensaje, array());
                                    if ($rEmail) {
                                        $totCorrectos++;
                                        \logApi::general2($nameLog, $idliquidacion, 'Notificando Inscripcion No. ' . $t["libro"] . '-' . $t["registro"] . '-' . $t["dupli"] . ' del codigo de barras: ' . $t["idradicacion"] . ', Email : ' . $em . ' ** OK **');
                                        \funcionesRegistrales::actualizarMregNotificacionesParaEnviarEmail($mysqli, '03', $t["idradicacion"], '', $t["numerooperacion"], $t["recibo"], $t["libro"], $t["registro"], $t["dupli"], $t["tipoidentificacion"], $t["identificacion"], $t["matricula"], '', $t["nombre"], $em, $mensaje, date("Ymd"), date("His"), date("Ymd"), date("His"), '3', '** OK **', $bandejaDigitalizacion);
                                    } else {
                                        \funcionesRegistrales::actualizarMregNotificacionesParaEnviarEmail($mysqli, '03', $t["idradicacion"], '', $t["numerooperacion"], $t["recibo"], $t["libro"], $t["registro"], $t["dupli"], $t["tipoidentificacion"], $t["identificacion"], $t["matricula"], '', $t["nombre"], $em, $mensaje, date("Ymd"), date("His"), date("Ymd"), date("His"), '2', '** ERROR: ' . $_SESSION["generales"]["mensajeerror"], $bandejaDigitalizacion);
                                        \logApi::general2($nameLog, $idliquidacion, 'Notificando Inscripcion No. ' . $t["libro"] . '-' . $t["registro"] . '-' . $t["dupli"] . ' del codigo de barras: ' . $t["idradicacion"] . ', Email : ' . $em . ' ** ERROR : ' . $_SESSION["generales"]["mensajeerror"]);
                                    }
                                }
                                if ($totCorrectos > 0) {
                                    $valx = 1; // Enviado al menos a un email
                                } else {
                                    $valx = 2; // Envios incorrectos
                                }
                            } else {
                                $valx = 3; // Sin emails para notificar
                            }
                            $arrCampos = array(
                                'idnotificacionemail'
                            );
                            $arrValores = array(
                                $valx
                            );
                            $condicion = "libro='" . $t["libro"] . "' and registro='" . $t["registro"] . "' and dupli='" . $t["dupli"] . "'";
                            $resg = regrabarRegistrosMysqliApi($mysqli, 'mreg_est_inscripciones', $arrCampos, $arrValores, $condicion);
                            if ($resg === false) {
                                \logApi::general2($nameLog, $idliquidacion, 'Error regrabando mreg_est_inscripciones, campo idnotificacionemail : ' . $_SESSION["generales"]["mensajeerror"]);
                            }
                            \logApi::general2($nameLog, $idliquidacion, 'Salio de enviar emails de notificación sipref de inscripciones, radicado ' . $codbarras);

                            //
                            if (!empty($arrTels)) {
                                $txtx = '';
                                $txtx = 'Acto: ' . retornarRegistroMysqliApi($mysqli, 'mreg_actos', "idlibro='" . $t["libro"] . "' and idacto='" . $t["acto"] . "'", "nombre");
                                if (defined('RAZONSOCIALSMS') && trim(RAZONSOCIALSMS) != '') {
                                    $txtSms = 'La ' . RAZONSOCIALSMS . ' le informa que se inscribio un tramite que modifica su registro, ' . $txtx;
                                } else {
                                    $txtSms = 'La ' . RAZONSOCIAL . ' le informa que se inscribio un tramite que modifica su registro, ' . $txtx;
                                }
                                foreach ($arrTels as $tx) {
                                    \funcionesRegistrales::actualizarPilaSms($mysqli, $tx, '2', $t["recibo"], $t["idradicacion"], $t["libro"] . '-' . $t["registro"] . '-' . $t["dupli"], '', $t["matricula"], $t["matricula"], '', $t["identificacion"], $t["nombre"], $txtSms, '', $bandejaDigitalizacion);
                                }
                                \logApi::general2($nameLog, $idliquidacion, 'Salio de crear pila_sms');
                                $valx = 1; // Enviado al menos a un celular
                            } else {
                                $valx = 3; // Sin celulares para notificar
                            }
                            $arrCampos = array(
                                'idnotificacionsms'
                            );
                            $arrValores = array(
                                $valx
                            );
                            $condicion = "libro='" . $t["libro"] . "' and registro='" . $t["registro"] . "' and dupli='" . $t["dupli"] . "'";
                            $resg = regrabarRegistrosMysqliApi($mysqli, 'mreg_est_inscripciones', $arrCampos, $arrValores, $condicion);
                            if ($resg === false) {
                                \logApi::general2($nameLog, $idliquidacion, 'Error regrabando mreg_est_inscripciones, campo idnotificacionsms : ' . $_SESSION["generales"]["mensajeerror"]);
                            }
                        }
                    }
                }
            }
            \logApi::general2($nameLog, $idliquidacion, 'Salio de la generacion de notificaciones sipref de inscripcion');
        }
    }

    public static function rutinaNotificarInscripcionesProponentes($mysqli, $proponente, $libro, $registro) {

        $nameLog = 'rutinaNotificarInscripcionesProponentesAPI_' . date("Ymd");
        \logApi::general2($nameLog, '', 'Ingreso a notificar sipref inscripcion de proponentes : ' . $proponente . ':' . $libro . ':' . $registro);
        $prop = \funcionesRegistrales::retornarExpedienteProponente($mysqli, $proponente, '', '', '', '', '', 'no', 'no');
        if ($prop && !empty($prop)) {
            $arrTels = array();
            $arrEmails = array();

            if ($prop["telcom1"] != '' && strlen($prop["telcom1"]) == 10 && substr($prop["telcom1"], 0, 1) == '3') {
                $arrTels[$prop["telcom1"]] = $prop["telcom1"];
            }
            if ($prop["telcom2"] != '' && strlen($prop["telcom2"]) == 10 && substr($prop["telcom2"], 0, 1) == '3') {
                $arrTels[$prop["telcom2"]] = $prop["telcom2"];
            }
            if ($prop["celcom"] != '' && strlen($prop["celcom"]) == 10 && substr($prop["celcom"], 0, 1) == '3') {
                $arrTels[$prop["celcom"]] = $prop["celcom"];
            }
            if ($prop["telnot"] != '' && strlen($prop["telnot"]) == 10 && substr($prop["telnot"], 0, 1) == '3') {
                $arrTels[$prop["telnot"]] = $prop["telnot"];
            }
            if ($prop["telnot2"] != '' && strlen($prop["telnot2"]) == 10 && substr($prop["telnot2"], 0, 1) == '3') {
                $arrTels[$prop["telnot2"]] = $prop["telnot2"];
            }
            if ($prop["celnot"] != '' && strlen($prop["celnot"]) == 10 && substr($prop["celnot"], 0, 1) == '3') {
                $arrTels[$prop["celnot"]] = $prop["celnot"];
            }
            if (trim($prop["emailcom"]) != '') {
                $arrEmails[$prop["emailcom"]] = $prop["emailcom"];
            }
            if (trim($prop["emailnot"]) != '') {
                $arrEmails[$prop["emailnot"]] = $prop["emailnot"];
            }
            $t = retornarRegistroMysqliApi($mysqli, 'mreg_est_inscripciones_proponentes', "libro='" . $libro . "' and registro='" . $registro . "'");
            if ($t && !empty($t)) {
                if (!empty($arrEmails)) {
                    $totEmails = 0;
                    $totCorrectos = 0;
                    foreach ($arrEmails as $em) {
                        $totEmails++;
                        $mensaje = \funcionesRegistrales::generarEmailNotificacionInscripcionSipref($mysqli, $t);
                        $emx = $em;
                        if (TIPO_AMBIENTE == 'PRUEBAS') {
                            $emx = 'jint@confecamaras.org.co';
                            if (defined('EMAIL_NOTIFICACION_PRUEBAS') && EMAIL_NOTIFICACION_PRUEBAS != '') {
                                $emx = EMAIL_NOTIFICACION_PRUEBAS;
                            }
                        }
                        $rEmail = \funcionesGenerales::enviarEmail(SERVER_SMTP, CUENTA_ADMIN_PORTAL, CLAVE_ADMIN_PORTAL, EMAIL_ADMIN_PORTAL, NOMBRE_ADMIN_PORTAL, $emx, 'Notificacion de inscripcion No. ' . $t["libro"] . '-' . $t["registro"] . '-' . $t["dupli"] . ' en  LA ' . RAZONSOCIAL, $mensaje, array());
                        if ($rEmail) {
                            $totCorrectos++;
                            \logApi::general2($nameLog, '', 'Notificando Inscripcion No. ' . $t["libro"] . '-' . $t["registro"] . '-' . $t["dupli"] . ' del codigo de barras: ' . $t["idradicacion"] . ', Email : ' . $em . ' ** OK **');
                            \funcionesRegistrales::actualizarMregNotificacionesParaEnviarEmail($mysqli, '03', $t["idradicacion"], '', $t["numerooperacion"], $t["recibo"], $t["libro"], $t["registro"], $t["dupli"], $t["tipoidentificacion"], $t["identificacion"], $t["matricula"], '', $t["nombre"], $em, $mensaje, date("Ymd"), date("His"), date("Ymd"), date("His"), '3', '** OK **', '6.-REGPRO');
                        } else {
                            \funcionesRegistrales::actualizarMregNotificacionesParaEnviarEmail($mysqli, '03', $t["idradicacion"], '', $t["numerooperacion"], $t["recibo"], $t["libro"], $t["registro"], $t["dupli"], $t["tipoidentificacion"], $t["identificacion"], $t["matricula"], '', $t["nombre"], $em, $mensaje, date("Ymd"), date("His"), date("Ymd"), date("His"), '2', '** ERROR: ' . $_SESSION["generales"]["mensajeerror"], '6.-REGPRO');
                            \logApi::general2($nameLog, '', 'Notificando Inscripcion No. ' . $t["libro"] . '-' . $t["registro"] . '-' . $t["dupli"] . ' del codigo de barras: ' . $t["idradicacion"] . ', Email : ' . $em . ' ** ERROR : ' . $_SESSION["generales"]["mensajeerror"]);
                        }
                    }
                    if ($totCorrectos > 0) {
                        $valx = 1; // Enviado al menos a un email
                    } else {
                        $valx = 2; // Envios incorrectos
                    }
                } else {
                    $valx = 3; // SIn emails para notificar
                }
                $arrCampos = array(
                    'idnotificacionemail'
                );
                $arrValores = array(
                    $valx
                );
                $condicion = "libro='" . $t["libro"] . "' and registro='" . $t["registro"] . "' and dupli='" . $t["dupli"] . "'";
                $resg = regrabarRegistrosMysqliApi($mysqli, 'mreg_est_inscripciones_proponentes', $arrCampos, $arrValores, $condicion);
                if ($resg === false) {
                    \logApi::general2($nameLog, '', 'Error regrabando mreg_est_inscripciones_proponentes, campo idnotificacionemail : ' . $_SESSION["generales"]["mensajeerror"]);
                }
                if (!empty($arrTels)) {
                    $txtx = '';
                    $txtx = 'Acto: ' . retornarRegistroMysqliApi($mysqli, 'mreg_actosproponente', "id='" . $t["acto"] . "'", "descripcion");
                    if (defined('RAZONSOCIALSMS') && trim(RAZONSOCIALSMS) != '') {
                        $txtSms = 'La ' . RAZONSOCIALSMS . ' le informa que se inscribio un tramite que modifica su registro, ' . $txtx;
                    } else {
                        $txtSms = 'La ' . RAZONSOCIAL . ' le informa que se inscribio un tramite que modifica su registro, ' . $txtx;
                    }
                    foreach ($arrTels as $tx) {
                        \funcionesRegistrales::actualizarPilaSms($mysqli, $tx, '2', $t["recibo"], $t["idradicacion"], $t["libro"] . '-' . $t["registro"] . '-' . $t["dupli"], '', $t["proponente"], '', $t["proponente"], $t["identificacion"], $t["nombre"], $txtSms, '', '6.-REGPRO');
                    }
                    $valx = 1; // Enviado al menos a un celular
                } else {
                    $valx = 3; // Sin celulares para notificar
                }
                $arrCampos = array(
                    'idnotificacionsms'
                );
                $arrValores = array(
                    $valx
                );
                $condicion = "libro='" . $t["libro"] . "' and registro='" . $t["registro"] . "' and dupli='" . $t["dupli"] . "'";
                $resg = regrabarRegistrosMysqli($mysqli, 'mreg_est_inscripciones_proponentes', $arrCampos, $arrValores, $condicion);
                if ($resg === false) {
                    log::general2($nameLog, '', 'Error regrabando mreg_est_inscripciones_proponentes, campo idnotificacionsms : ' . $_SESSION["generales"]["mensajeerror"]);
                }
                return true;
            } else {
                \logApi::general2($nameLog, '', 'No localizo la inscripcion en mreg_est_inscripciones_proponentes : ' . $libro . '-' . $registro);
                return false;
            }
        } else {
            \logApi::general2($nameLog, '', 'No localizo el proponente en mreg_est_inscritos : ' . $proponente);
            return false;
        }
    }

    public static function emailsCeluaresAsociadosRadicacion($mysqli, $codbarras) {

        $matriculas = array();
        $servicio = '';
        $proponente = '';
        $salida = array();
        $salida["emails"] = array();
        $salida["telefonos"] = array();
        $reg = false;
        $notificar = 'si';

        //
        $temx = retornarRegistroMysqliApi($mysqli, 'mreg_est_codigosbarras', "codigobarras='" . $codbarras . "'");
        if ($temx && !empty($temx)) {
            if ($temx["recibo"] != '') {
                $query = "recibo='" . $temx["recibo"] . "' and tipogasto IN ('0','4','6','8')";
                $reg = retornarRegistroMysqliApi($mysqli, 'mreg_recibosgenerados', $query);
            }
        }

        //
        if ($reg && !empty($reg)) {
            $arrTemCB = retornarRegistroMysqliApi($mysqli, 'mreg_est_codigosbarras', "codigobarras='" . $reg["codigobarras"] . "'");
            if ($notificar == 'si') {
                //
                $salida["emails"][$reg["email"]] = $reg["email"];
                if ($reg["telefono1"] != '' && strlen($reg["telefono1"]) == 10 && substr($reg["telefono1"], 0, 1) == '3') {
                    $salida["telefonos"][$reg["telefono1"]] = $reg["telefono1"];
                }
                if ($reg["telefono2"] != '' && strlen($reg["telefono2"]) == 10 && substr($reg["telefono2"], 0, 1) == '3') {
                    $salida["telefonos"][$reg["telefono2"]] = $reg["telefono2"];
                }

                //
                $arrTem = retornarRegistrosMysqliApi($mysqli, 'mreg_recibosgenerados_detalle', "recibo='" . $reg["recibo"] . "'", "secuencia");
                $j = 0;
                if ($arrTem && !empty($arrTem)) {
                    foreach ($arrTem as $tx) {
                        $j++;
                        if ($j == 1) {
                            if ($tx["matricula"] != '' && substr($tx["matricula"], 0, 5) != 'NUEVA') {
                                $matriculas[$tx["matricula"]] = $tx["matricula"];
                            }
                            if ($tx["proponente"] != '') {
                                $proponente = $tx["proponente"];
                            }
                            $servicio = $tx["idservicio"];
                        }
                    }
                }

                // ************************************************************************************************** //
                // 2017-12-15: JINT: Se notifica sin importar que sea a los emails del recibo y del código de barras
                // ************************************************************************************************** //
                // $arrTemCB = retornarRegistroMysqli($mysqli, 'mreg_est_codigosbarras', "codigobarras='" . $reg["codigobarras"] . "'");
                if ($arrTemCB["emailnot1"] != '') {
                    $salida["emails"][$arrTemCB["emailnot1"]] = $arrTemCB["emailnot1"];
                }
                if ($arrTemCB["emailnot2"] != '') {
                    $salida["emails"][$arrTemCB["emailnot2"]] = $arrTemCB["emailnot2"];
                }
                if ($arrTemCB["emailnot3"] != '') {
                    $salida["emails"][$arrTemCB["emailnot3"]] = $arrTemCB["emailnot3"];
                }
                if ($arrTemCB["celnot1"] != '' && strlen($arrTemCB["celnot1"]) == 10 && substr($arrTemCB["celnot1"], 0, 1) == '3') {
                    $salida["telefonos"][$arrTemCB["celnot1"]] = $arrTemCB["celnot1"];
                }
                if ($arrTemCB["celnot2"] != '' && strlen($arrTemCB["celnot2"]) == 10 && substr($arrTemCB["celnot2"], 0, 1) == '3') {
                    $salida["telefonos"][$arrTemCB["celnot2"]] = $arrTemCB["celnot2"];
                }
                if ($arrTemCB["celnot3"] != '' && strlen($arrTemCB["celnot3"]) == 10 && substr($arrTemCB["celnot3"], 0, 1) == '3') {
                    $salida["telefonos"][$arrTemCB["celnot3"]] = $arrTemCB["celnot3"];
                }

                // *********************************************************************************** //
                // Siempre y cuando no sea un embargo
                // *********************************************************************************** //            
                if (($arrTemCB["actoreparto"] != '07') && ($arrTemCB["actoreparto"] != '29')) {

                    // *********************************************************************************** //
                    // Busca cada expediente
                    // *********************************************************************************** //            
                    if (!empty($matriculas)) {
                        foreach ($matriculas as $m) {
                            $exp = retornarRegistroMysqliApi($mysqli, 'mreg_est_inscritos', "matricula='" . $m . "'");

                            // *********************************************************************************** //
                            // Localiza emails y celulares actuales
                            // *********************************************************************************** //                                    
                            if ($exp && !empty($exp)) {
                                if (trim($exp["telcom1"]) != '' && strlen($exp["telcom1"]) == 10 && substr($exp["telcom1"], 0, 1) == '3') {
                                    $salida["telefonos"][$exp["telcom1"]] = $exp["telcom1"];
                                }
                                if (trim($exp["telcom2"]) != '' && strlen($exp["telcom2"]) == 10 && substr($exp["telcom2"], 0, 1) == '3') {
                                    $salida["telefonos"][$exp["telcom2"]] = $exp["telcom2"];
                                }
                                if (trim($exp["telcom3"]) != '' && strlen($exp["telcom3"]) == 10 && substr($exp["telcom3"], 0, 1) == '3') {
                                    $salida["telefonos"][$exp["telcom3"]] = $exp["telcom3"];
                                }
                                if (trim($exp["telnot"]) != '' && strlen($exp["telnot"]) == 10 && substr($exp["telnot"], 0, 1) == '3') {
                                    $salida["telefonos"][$exp["telnot"]] = $exp["telnot"];
                                }
                                if (trim($exp["telnot2"]) != '' && strlen($exp["telnot2"]) == 10 && substr($exp["telnot2"], 0, 1) == '3') {
                                    $salida["telefonos"][$exp["telnot2"]] = $exp["telnot2"];
                                }
                                if (trim($exp["telnot3"]) != '' && strlen($exp["telnot3"]) == 10 && substr($exp["telnot3"], 0, 1) == '3') {
                                    $salida["telefonos"][$exp["telnot3"]] = $exp["telnot3"];
                                }
                                if (trim($exp["emailcom"]) != '') {
                                    $salida["emails"][$exp["emailcom"]] = $exp["emailcom"];
                                }
                                if (trim($exp["emailcom2"]) != '') {
                                    $salida["emails"][$exp["emailcom2"]] = $exp["emailcom2"];
                                }
                                if (trim($exp["emailcom3"]) != '') {
                                    $salida["emails"][$exp["emailcom3"]] = $exp["emailcom3"];
                                }
                                if (trim($exp["emailnot"]) != '') {
                                    $salida["emails"][$exp["emailnot"]] = $exp["emailnot"];
                                }
                            }

                            // *********************************************************************************** //
                            // Localiza emails y celulares anteriores migrados del SIREP
                            // *********************************************************************************** //                                                            
                            $exps = retornarRegistrosMysqliApi($mysqli, 'mreg_est_campostablas', "tabla='200' and registro='" . ltrim($m, "0") . "'", "id");
                            if ($exps && !empty($exps)) {
                                foreach ($exps as $exps1) {
                                    if (trim($exps1["campo"]) == "EMAILCOM-ANTERIOR") {
                                        $salida["emails"][trim($exps1["contenido"])] = trim($exps1["contenido"]);
                                    }
                                    if (trim($exps1["campo"]) == "EMAILNOT-ANTERIOR") {
                                        $salida["emails"][trim($exps1["contenido"])] = trim($exps1["contenido"]);
                                    }
                                    if (trim($exps1["campo="]) == "CELCOM-ANTERIOR") {
                                        if (strlen(trim($exps1["contenido"])) == 10 && substr(trim($exps1["contenido"]), 0, 1) == '3') {
                                            $salida["telefonos"][trim($exps1["contenido"])] = trim($exps1["contenido"]);
                                        }
                                    }
                                    if (trim($exps1["campo"]) == "CELNOT-ANTERIOR") {
                                        if (strlen(trim($exps1["contenido"])) == 10 && substr(trim($exps1["contenido"]), 0, 1) == '3') {
                                            $salida["telefonos"][trim($exps1["contenido"])] = trim($exps1["contenido"]);
                                        }
                                    }
                                }
                            }

                            // *********************************************************************************** //
                            // Localiza emails y celulares modificados en mreg_campos_historicos_AAAA
                            // *********************************************************************************** //                                                            
                            $d = localizarCampoAnteriorTodosMysqliApi($mysqli, $m, 'telcom1');
                            foreach ($d as $d1) {
                                if (trim($d1) != '' && strlen($d1) == 10 && strlen($d1, 0, 1) == '3') {
                                    $salida["telefonos"][trim($d1)] = trim($d1);
                                }
                            }
                            $d = localizarCampoAnteriorTodosMysqliApi($mysqli, $m, 'telcom2');
                            foreach ($d as $d1) {
                                if (trim($d1) != '' && strlen($d1) == 10 && strlen($d1, 0, 1) == '3') {
                                    $salida["telefonos"][trim($d1)] = trim($d1);
                                }
                            }
                            $d = localizarCampoAnteriorTodosMysqliApi($mysqli, $m, 'telcom3');
                            foreach ($d as $d1) {
                                if (trim($d1) != '' && strlen($d1) == 10 && strlen($d1, 0, 1) == '3') {
                                    $salida["telefonos"][trim($d1)] = trim($d1);
                                }
                            }
                            $d = localizarCampoAnteriorTodosMysqliApi($mysqli, $m, 'telnot');
                            foreach ($d as $d1) {
                                if (trim($d1) != '' && strlen($d1) == 10 && strlen($d1, 0, 1) == '3') {
                                    $salida["telefonos"][trim($d1)] = trim($d1);
                                }
                            }
                            $d = localizarCampoAnteriorTodosMysqliApi($mysqli, $m, 'emailcom');
                            foreach ($d as $d1) {
                                $salida["emails"][trim($d1)] = trim($d1);
                            }
                            $d = localizarCampoAnteriorTodosMysqliApi($mysqli, $m, 'emailnot');
                            foreach ($d as $d1) {
                                $salida["emails"][trim($d1)] = trim($d1);
                            }
                        }
                    }
                }

                // Recupera números telefonicos y emails actuales - proponentes
                if ($proponente != '') {
                    $exp = retornarRegistroMysqliApi($mysqli, 'mreg_est_proponentes', "proponente='" . $proponente . "'");
                    if ($exp && !empty($exp)) {
                        if (trim($exp["telcom1"]) != '' && strlen($exp["telcom1"]) == 10 && substr($exp["telcom1"], 0, 1) == '3') {
                            $salida["telefonos"][$exp["telcom1"]] = $exp["telcom1"];
                        }
                        if (trim($exp["telcom2"]) != '' && strlen($exp["telcom2"]) == 10 && substr($exp["telcom2"], 0, 1) == '3') {
                            $salida["telefonos"][$exp["telcom2"]] = $exp["telcom2"];
                        }
                        if (trim($exp["celcom"]) != '' && strlen($exp["celcom"]) == 10 && substr($exp["celcom"], 0, 1) == '3') {
                            $salida["telefonos"][$exp["celcom"]] = $exp["celcom"];
                        }
                        if (trim($exp["telnot"]) != '' && strlen($exp["telnot"]) == 10 && substr($exp["telnot"], 0, 1) == '3') {
                            $salida["telefonos"][$exp["telnot"]] = $exp["telnot"];
                        }
                        if (trim($exp["telnot2"]) != '' && strlen($exp["telnot2"]) == 10 && substr($exp["telnot2"], 0, 1) == '3') {
                            $salida["telefonos"][$exp["telnot2"]] = $exp["telnot2"];
                        }
                        if (trim($exp["celnot"]) != '' && strlen($exp["celnot"]) == 10 && substr($exp["celnot"], 0, 1) == '3') {
                            $salida["telefonos"][$exp["celnot"]] = $exp["celnot"];
                        }
                        if (trim($exp["emailcom"]) != '') {
                            $salida["emails"][$exp["emailcom"]] = $exp["emailcom"];
                        }
                        if (trim($exp["emailnot"]) != '') {
                            $salida["emails"][$exp["emailnot"]] = $exp["emailnot"];
                        }
                    }
                }

                // recupera números y emails anteriores (proponentes)
                if ($proponente != '') {
                    $exps = retornarRegistrosMysqliApi($mysqli, 'mreg_est_campostablas', "tabla='032' and registro='" . ltrim($proponente, "0") . "'", "id");
                    if ($exps && !empty($exps)) {
                        foreach ($exps as $exps1) {
                            if (trim($exps1["campo"]) == "EMAILCOM-ANTERIOR") {
                                $salida["emails"][trim($exps1["contenido"])] = trim($exps1["contenido"]);
                            }
                            if (trim($exps1["campo"]) == "EMAILNOT-ANTERIOR") {
                                $salida["emails"][trim($exps1["contenido"])] = trim($exps1["contenido"]);
                            }
                            if (trim($exps1["campo"]) == "CELCOM-ANTERIOR") {
                                if (strlen(trim($exps1["contenido"])) == 10 && substr(trim($exps1["contenido"]), 0, 1) == '3') {
                                    $salida["telefonos"][trim($exps1["contenido"])] = trim($exps1["contenido"]);
                                }
                            }
                            if (trim($exps1["campo"]) == "CELNOT-ANTERIOR") {
                                if (strlen(trim($exps1["contenido"])) == 10 && substr(trim($exps1["contenido"]), 0, 1) == '3') {
                                    $salida["telefonos"][trim($exps1["contenido"])] = trim($exps1["contenido"]);
                                }
                            }
                        }
                    }
                }

                unset($reg);
            }
        }
        return $salida;
    }

    public static function serializacionLineal($arr) {
        $sal = '';
        foreach ($arr as $key => $datos) {
            if (!is_array($datos)) {
                $sal .= '<' . $key . '><![CDATA[' . $datos . ']]></' . $key . '>';
            } else {
                $sal .= '<' . $key . '>';
                foreach ($datos as $key1 => $datos1) {
                    if (!is_array($datos1)) {
                        $sal .= '<' . $key1 . '><![CDATA[' . $datos1 . ']]></' . $key1 . '>';
                    } else {
                        $sal .= '<' . $key1 . '>';
                        foreach ($datos1 as $key2 => $datos2) {
                            if (!is_array($datos2)) {
                                $sal .= '<' . $key2 . '><![CDATA[' . $datos2 . ']]></' . $key2 . '>';
                            } else {
                                $sal .= '<' . $key2 . '>';
                                foreach ($datos2 as $key3 => $datos3) {
                                    $sal .= '<' . $key3 . '><![CDATA[' . $datos3 . ']]></' . $key3 . '>';
                                }
                                $sal .= '</' . $key2 . '>';
                            }
                        }
                        $sal .= '</' . $key1 . '>';
                    }
                }
                $sal .= '</' . $key . '>';
            }
        }
        return $sal;
    }

    public static function serializarExpedienteMatricula($dbx, $numrec = '', $datos = array(), $reemplazar = 'si', $extendido = 'si') {
        //
        $xml = '<?xml version="1.0" encoding="utf-8" ?>';
        $xml .= '<expedientes>';
        $xml .= '<error>0000</error>';
        $xml .= '<msgError>Registro serializado correctamente</msgError>';
        $xml .= '<expediente>';

        // Valida los datos conm nlos que debe trabajar
        if (trim($numrec) != '') {
            $xml .= '<numerorecuperacion>' . $numrec . '</numerorecuperacion>';
        } else {
            if (isset($_SESSION["tramite"]["numerorecuperacion"])) {
                $xml .= '<numerorecuperacion>' . trim($_SESSION["tramite"]["numerorecuperacion"]) . '</numerorecuperacion>';
            } else {
                $xml .= '<numerorecuperacion></numerorecuperacion>';
            }
        }
        if (empty($datos)) {
            $datos = $_SESSION["formulario"]["datos"];
        }

        //
        if (!isset($datos["cc"])) {
            $datos["cc"] = CODIGO_EMPRESA;
        }
        if (!isset($datos["complementorazonsocial"])) {
            $datos["complementorazonsocial"] = '';
        }
        if (!isset($datos["estadoproponente"])) {
            $datos["estadoproponente"] = '';
        }
        if (!isset($datos["nuevonombre"])) {
            $datos["nuevonombre"] = '';
        }
        if (!isset($datos["fechanacimiento"])) {
            $datos["fechanacimiento"] = '';
        }
        if (!isset($datos["sexo"])) {
            $datos["sexo"] = '';
        }
        if (!isset($datos["ideext"])) {
            $datos["ideext"] = '';
        }
        if (!isset($datos["estadonit"])) {
            $datos["estadonit"] = '';
        }
        if (!isset($datos["prerut"])) {
            $datos["prerut"] = '';
        }
        if (!isset($datos["expedienteinactivo"])) {
            $datos["expedienteinactivo"] = '';
        }
        if (!isset($datos["fechacancelacion"])) {
            $datos["fechacancelacion"] = '';
        }
        if (!isset($datos["motivocancelacion"])) {
            $datos["motivocancelacion"] = '';
        }
        if (!isset($datos["estadotipoliquidacion"])) {
            $datos["estadotipoliquidacion"] = '';
        }
        if (!isset($datos["paiori"])) {
            $datos["paiori"] = '';
        }
        if (!isset($datos["idetripaiori"])) {
            $datos["idetripaiori"] = '';
        }
        if (!isset($datos["idetriextep"])) {
            $datos["idetriextep"] = '';
        }

        if (!isset($datos["empresafamiliar"])) {
            $datos["empresafamiliar"] = '';
        }
        if (!isset($datos["procesosinnovacion"])) {
            $datos["procesosinnovacion"] = '';
        }
        if (!isset($datos["tipogruemp"])) {
            $datos["tipogruemp"] = '';
        }
        if (!isset($datos["nombregruemp"])) {
            $datos["nombregruemp"] = '';
        }
        if (!isset($datos["ctrderpub"])) {
            $datos["ctrderpub"] = '';
        }
        if (!isset($datos["ctrcodcoop"])) {
            $datos["ctrcodcoop"] = '';
        }
        if (!isset($datos["ctrcodotras"])) {
            $datos["ctrcodotras"] = '';
        }
        if (!isset($datos["ctresacntasociados"])) {
            $datos["ctresacntasociados"] = 0;
        }
        if (!isset($datos["ctresacntmujeres"])) {
            $datos["ctresacntmujeres"] = 0;
        }
        if (!isset($datos["ctresacnthombres"])) {
            $datos["ctresacnthombres"] = 0;
        }
        if (!isset($datos["ctresapertgremio"])) {
            $datos["ctresapertgremio"] = '';
        }
        if (!isset($datos["ctresagremio"])) {
            $datos["ctresagremio"] = '';
        }
        if (!isset($datos["ctresaacredita"])) {
            $datos["ctresaacredita"] = '';
        }
        if (!isset($datos["ctresaivc"])) {
            $datos["ctresaivc"] = '';
        }
        if (!isset($datos["ctresainfoivc"])) {
            $datos["ctresainfoivc"] = '';
        }
        if (!isset($datos["ctresaautregistro"])) {
            $datos["ctresaautregistro"] = '';
        }
        if (!isset($datos["ctresaentautoriza"])) {
            $datos["ctresaentautoriza"] = '';
        }
        if (!isset($datos["ctresacodnat"])) {
            $datos["ctresacodnat"] = '';
        }
        if (!isset($datos["ctresadiscap"])) {
            $datos["ctresadiscap"] = '';
        }
        if (!isset($datos["ctresaetnia"])) {
            $datos["ctresaetnia"] = '';
        }
        if (!isset($datos["ctresacualetnia"])) {
            $datos["ctresacualetnia"] = '';
        }
        if (!isset($datos["ctresadespvictreins"])) {
            $datos["ctresadespvictreins"] = '';
        }
        if (!isset($datos["ctresacualdespvictreins"])) {
            $datos["ctresacualdespvictreins"] = '';
        }
        if (!isset($datos["ctresalgbti"])) {
            $datos["ctresalgbti"] = '';
        }
        if (!isset($datos["ctresaindgest"])) {
            $datos["ctresaindgest"] = '';
        }
        if (!isset($datos["codigopostalcom"])) {
            $datos["codigopostalcom"] = '';
        }
        if (!isset($datos["codigopostalnot"])) {
            $datos["codigopostalnot"] = '';
        }
        if (!isset($datos["feciniact1"])) {
            $datos["feciniact1"] = '';
        }
        if (!isset($datos["feciniact2"])) {
            $datos["feciniact2"] = '';
        }
        if (!isset($datos["codaduaneros"])) {
            $datos["codaduaneros"] = '';
        }
        if (!isset($datos["gruponiif"])) {
            $datos["gruponiif"] = '';
        }
        if (!isset($datos["niifconciliacion"])) {
            $datos["niifconciliacion"] = '';
        }
        if (!isset($datos["aportantesegsocial"])) {
            $datos["aportantesegsocial"] = '';
        }
        if (!isset($datos["tipoaportantesegsocial"])) {
            $datos["tipoaportantesegsocial"] = '';
        }

        if (!isset($datos["prerut"])) {
            $datos["prerut"] = '';
        }
        if (!isset($datos["fecmatant"])) {
            $datos["fecmatant"] = '';
        }
        if (!isset($datos["fecrenant"])) {
            $datos["fecrenant"] = '';
        }
        if (!isset($datos["camant"])) {
            $datos["camant"] = '';
        }
        if (!isset($datos["munant"])) {
            $datos["munant"] = '';
        }
        if (!isset($datos["benart7ant"])) {
            $datos["benart7ant"] = '';
        }
        if (!isset($datos["ultanorenant"])) {
            $datos["ultanorenant"] = '';
        }
        if (!isset($datos["matant"])) {
            $datos["matant"] = '';
        }
        if (!isset($datos["otorgaperjur"])) {
            $datos["otorgaperjur"] = '';
        }
        if (!isset($datos["nroperjur"])) {
            $datos["nroperjur"] = '';
        }
        if (!isset($datos["patrimonio"])) {
            $datos["patrimonio"] = 0;
        }
        if (!isset($datos["nombresegundocontacto"])) {
            $datos["nombresegundocontacto"] = '';
        }
        if (!isset($datos["cargosegundocontacto"])) {
            $datos["cargosegundocontacto"] = '';
        }

        if (!isset($datos["cumplerequisitos1780"])) {
            $datos["cumplerequisitos1780"] = '';
        }
        if (!isset($datos["cumplerequisitos1780primren"])) {
            $datos["cumplerequisitos1780primren"] = '';
        }
        if (!isset($datos["renunciabeneficios1780"])) {
            $datos["renunciabeneficios1780"] = '';
        }
        if (!isset($datos["naturaleza"])) {
            $datos["naturaleza"] = '0';
        }

        //
        if (!isset($datos["paicom"])) {
            $datos["paicom"] = '';
        }
        if (!isset($datos["painot"])) {
            $datos["painot"] = '';
        }
        if (!isset($datos["estadocapturado"])) {
            $datos["estadocapturado"] = '';
        }
        if (!isset($datos["estadocapturadootros"])) {
            $datos["estadocapturadootros"] = '';
        }
        if (!isset($datos["cantest"])) {
            $datos["cantest"] = 0;
        }
        if (!isset($datos["certificardesde"])) {
            $datos["certificardesde"] = '';
        }
        if (!isset($datos["ctrbic"])) {
            $datos["ctrbic"] = '';
        }

        if (!isset($datos["shd"])) {
            $datos["shd"] = array();
        }
        if (!isset($datos["shd"][1])) {
            $datos["shd"][1] = '';
        }
        if (!isset($datos["shd"][2])) {
            $datos["shd"][2] = '';
        }
        if (!isset($datos["shd"][3])) {
            $datos["shd"][3] = '';
        }
        if (!isset($datos["shd"][4])) {
            $datos["shd"][4] = '';
        }

        if (!isset($datos["cantidadmujeres"])) {
            $datos["cantidadmujeres"] = 0;
        }
        if (!isset($datos["cantidadmujerescargosdirectivos"])) {
            $datos["cantidadmujerescargosdirectivos"] = 0;
        }
        if (!isset($datos["participacionmujeres"])) {
            $datos["participacionmujeres"] = 0;
        }

        if (!isset($datos["ciiutamanoempresarial"])) {
            $datos["ciiutamanoempresarial"] = '';
        }
        if (!isset($datos["ingresostamanoempresarial"])) {
            $datos["ingresostamanoempresarial"] = 0;
        }
        if (!isset($datos["anodatostamanoempresarial"])) {
            $datos["anodatostamanoempresarial"] = '';
        }
        if (!isset($datos["fechadatostamanoempresarial"])) {
            $datos["fechadatostamanoempresarial"] = '';
        }


        // Datos b&aacute;sicos
        $xml .= '<cc>' . $datos["cc"] . '</cc>';
        $xml .= '<matricula>' . ltrim($datos["matricula"], '0') . '</matricula>';
        $xml .= '<proponente>' . sprintf("%08s", $datos["proponente"]) . '</proponente>';
        if ($reemplazar == 'si') {
            $xml .= '<nombre><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($datos["nombre"]) . ']]></nombre>';
            $xml .= '<nuevonombre><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($datos["nuevonombre"]) . ']]></nuevonombre>';
            $xml .= '<ape1><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($datos["ape1"]) . ']]></ape1>';
            $xml .= '<ape2><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($datos["ape2"]) . ']]></ape2>';
            $xml .= '<nom1><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($datos["nom1"]) . ']]></nom1>';
            $xml .= '<nom2><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($datos["nom2"]) . ']]></nom2>';
            $xml .= '<sigla><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($datos["sigla"]) . ']]></sigla>';
        } else {
            $xml .= '<nombre><![CDATA[' . $datos["nombre"] . ']]></nombre>';
            $xml .= '<nuevonombre><![CDATA[' . $datos["nuevonombre"] . ']]></nuevonombre>';
            $xml .= '<ape1><![CDATA[' . $datos["ape1"] . ']]></ape1>';
            $xml .= '<ape2><![CDATA[' . $datos["ape2"] . ']]></ape2>';
            $xml .= '<nom1><![CDATA[' . $datos["nom1"] . ']]></nom1>';
            $xml .= '<nom2><![CDATA[' . $datos["nom2"] . ']]></nom2>';
            $xml .= '<sigla><![CDATA[' . $datos["sigla"] . ']]></sigla>';
        }
        $xml .= '<complementorazonsocial><![CDATA[' . $datos["complementorazonsocial"] . ']]></complementorazonsocial>';
        $xml .= '<tipoidentificacion>' . $datos["tipoidentificacion"] . '</tipoidentificacion>';
        if (ltrim($datos["identificacion"], "0") == '') {
            $xml .= '<identificacion></identificacion>';
        } else {
            $xml .= '<identificacion>' . sprintf("%011s", $datos["identificacion"]) . '</identificacion>';
        }
        $xml .= '<sexo>' . $datos["sexo"] . '</sexo>';
        if (ltrim($datos["ideext"], "0") == '') {
            $xml .= '<ideext></ideext>';
        } else {
            $xml .= '<ideext>' . sprintf("%015s", $datos["ideext"]) . '</ideext>';
        }
        $xml .= '<idmunidoc>' . $datos["idmunidoc"] . '</idmunidoc>';
        $xml .= '<fechanacimiento>' . $datos["fechanacimiento"] . '</fechanacimiento>';
        $xml .= '<fecexpdoc>' . $datos["fecexpdoc"] . '</fecexpdoc>';
        $xml .= '<paisexpdoc>' . $datos["paisexpdoc"] . '</paisexpdoc>';
        $xml .= '<nit>' . sprintf("%015s", $datos["nit"]) . '</nit>';
        $xml .= '<prerut>' . $datos["prerut"] . '</prerut>';
        $xml .= '<admondian>' . $datos["admondian"] . '</admondian>';
        $xml .= '<estadonit>' . $datos["estadonit"] . '</estadonit>';
        $xml .= '<expedienteinactivo>' . $datos["expedienteinactivo"] . '</expedienteinactivo>';
        $xml .= '<nacionalidad><![CDATA[' . $datos["nacionalidad"] . ']]></nacionalidad>';
        $xml .= '<fechamatricula>' . $datos["fechamatricula"] . '</fechamatricula>';

        //
        $xml .= '<fecmatant>' . $datos["fecmatant"] . '</fecmatant>';
        $xml .= '<fecrenant>' . $datos["fecrenant"] . '</fecrenant>';
        $xml .= '<camant>' . $datos["camant"] . '</camant>';
        $xml .= '<munant>' . $datos["munant"] . '</munant>';
        $xml .= '<benart7ant>' . $datos["benart7ant"] . '</benart7ant>';
        $xml .= '<ultanorenant>' . $datos["ultanorenant"] . '</ultanorenant>';
        $xml .= '<matant>' . $datos["matant"] . '</matant>';

        //
        $xml .= '<fecharenovacion>' . $datos["fecharenovacion"] . '</fecharenovacion>';
        $xml .= '<fechaconstitucion>' . ltrim($datos["fechaconstitucion"], "0") . '</fechaconstitucion>';
        $xml .= '<fechavencimiento>' . ltrim($datos["fechavencimiento"], "0") . '</fechavencimiento>';

        $xml .= '<fechacancelacion>' . ltrim($datos["fechacancelacion"], "0") . '</fechacancelacion>';
        $xml .= '<motivocancelacion>' . $datos["motivocancelacion"] . '</motivocancelacion>';
        $xml .= '<estadotipoliquidacion>' . $datos["estadotipoliquidacion"] . '</estadotipoliquidacion>';

        $xml .= '<ultanoren>' . $datos["ultanoren"] . '</ultanoren>';
        $xml .= '<estadomatricula>' . $datos["estadomatricula"] . '</estadomatricula>';
        $xml .= '<estadoproponente>' . $datos["estadoproponente"] . '</estadoproponente>';
        $xml .= '<estadoactiva>' . $datos["estadoactiva"] . '</estadoactiva>';
        $xml .= '<estadopreoperativa>' . $datos["estadopreoperativa"] . '</estadopreoperativa>';
        $xml .= '<estadoconcordato>' . $datos["estadoconcordato"] . '</estadoconcordato>';
        $xml .= '<estadointervenida>' . $datos["estadointervenida"] . '</estadointervenida>';
        $xml .= '<estadodisuelta>' . $datos["estadodisuelta"] . '</estadodisuelta>';
        $xml .= '<estadoreestructuracion>' . $datos["estadoreestructuracion"] . '</estadoreestructuracion>';
        $xml .= '<estadodatosmatricula>' . $datos["estadodatosmatricula"] . '</estadodatosmatricula>';
        $xml .= '<ctrcertificardesde>' . $datos["certificardesde"] . '</ctrcertificardesde>';
        $xml .= '<tamanoempresa>' . $datos["tamanoempresa"] . '</tamanoempresa>';
        $xml .= '<emprendedor28>' . $datos["emprendedor28"] . '</emprendedor28>';
        $xml .= '<pemprendedor28>' . $datos["pemprendedor28"] . '</pemprendedor28>';
        $xml .= '<empresafamiliar>' . $datos["empresafamiliar"] . '</empresafamiliar>';
        $xml .= '<procesosinnovacion>' . $datos["procesosinnovacion"] . '</procesosinnovacion>';
        $xml .= '<estadocapturado>' . $datos["estadocapturado"] . '</estadocapturado>';
        $xml .= '<estadocapturadootros>' . $datos["estadocapturadootros"] . '</estadocapturadootros>';
        $xml .= '<cantest>' . $datos["cantest"] . '</cantest>';
        $xml .= '<idetripaiori>' . $datos["idetripaiori"] . '</idetripaiori>';
        $xml .= '<paiori>' . $datos["paiori"] . '</paiori>';
        $xml .= '<idetriextep>' . $datos["idetriextep"] . '</idetriextep>';

        $xml .= '<organizacion>' . $datos["organizacion"] . '</organizacion>';
        $xml .= '<categoria>' . $datos["categoria"] . '</categoria>';
        $xml .= '<naturaleza>' . $datos["naturaleza"] . '</naturaleza>';
        $xml .= '<imppredil>' . $datos["imppredil"] . '</imppredil>';

        //
        $xml .= '<tipogruemp>' . $datos["tipogruemp"] . '</tipogruemp>';
        $xml .= '<nombregruemp>' . $datos["nombregruemp"] . '</nombregruemp>';
        $xml .= '<impexp>' . $datos["impexp"] . '</impexp>';
        $xml .= '<tipopropiedad>' . $datos["tipopropiedad"] . '</tipopropiedad>';
        $xml .= '<tipolocal>' . $datos["tipolocal"] . '</tipolocal>';

        // Informacion de ESADL
        $xml .= '<vigcontrol>' . $datos["vigcontrol"] . '</vigcontrol>';
        $xml .= '<fecperj>' . $datos["fecperj"] . '</fecperj>';
        $xml .= '<idorigenperj>' . $datos["idorigenperj"] . '</idorigenperj>';
        if (isset($datos["origendocconst"])) {
            $xml .= '<origendocconst>' . $datos["origendocconst"] . '</origendocconst>';
        } else {
            $xml .= '<origendocconst></origendocconst>';
        }
        $xml .= '<numperj>' . $datos["numperj"] . '</numperj>';
        $xml .= '<vigifecini>' . $datos["vigifecini"] . '</vigifecini>';
        $xml .= '<vigifecfin>' . $datos["vigifecfin"] . '</vigifecfin>';
        $xml .= '<patrimonio>' . $datos["patrimonio"] . '</patrimonio>';
        $xml .= '<clasegenesadl>' . $datos["clasegenesadl"] . '</clasegenesadl>';
        $xml .= '<claseespesadl>' . $datos["claseespesadl"] . '</claseespesadl>';
        $xml .= '<claseeconsoli>' . $datos["claseeconsoli"] . '</claseeconsoli>';

        $xml .= '<ctrderpub>' . $datos["ctrderpub"] . '</ctrderpub>';
        $xml .= '<ctrcodcoop>' . $datos["ctrcodcoop"] . '</ctrcodcoop>';
        $xml .= '<ctrcodotras>' . $datos["ctrcodotras"] . '</ctrcodotras>';
        $xml .= '<ctresacntasociados>' . $datos["ctresacntasociados"] . '</ctresacntasociados>';
        $xml .= '<ctresacntmujeres>' . $datos["ctresacntmujeres"] . '</ctresacntmujeres>';
        $xml .= '<ctresacnthombres>' . $datos["ctresacnthombres"] . '</ctresacnthombres>';
        $xml .= '<ctresapertgremio>' . $datos["ctresapertgremio"] . '</ctresapertgremio>';
        $xml .= '<ctresagremio><![CDATA[' . $datos["ctresagremio"] . ']]></ctresagremio>';
        $xml .= '<ctresaacredita><![CDATA[' . $datos["ctresaacredita"] . ']]></ctresaacredita>';
        $xml .= '<ctresaivc><![CDATA[' . $datos["ctresaivc"] . ']]></ctresaivc>';
        $xml .= '<ctresainfoivc>' . $datos["ctresainfoivc"] . '</ctresainfoivc>';
        $xml .= '<ctresaautregistro>' . $datos["ctresaautregistro"] . '</ctresaautregistro>';
        $xml .= '<ctresaentautoriza><![CDATA[' . $datos["ctresaentautoriza"] . ']]></ctresaentautoriza>';
        $xml .= '<ctresacodnat>' . $datos["ctresacodnat"] . '</ctresacodnat>';
        $xml .= '<ctresadiscap>' . $datos["ctresadiscap"] . '</ctresadiscap>';
        $xml .= '<ctresaetnia>' . $datos["ctresaetnia"] . '</ctresaetnia>';
        $xml .= '<ctresacualetnia><![CDATA[' . $datos["ctresacualetnia"] . ']]></ctresacualetnia>';
        $xml .= '<ctresadespvictreins>' . $datos["ctresadespvictreins"] . '</ctresadespvictreins>';
        $xml .= '<ctresacualdespvictreins><![CDATA[' . $datos["ctresacualdespvictreins"] . ']]></ctresacualdespvictreins>';
        $xml .= '<ctresaindgest>' . $datos["ctresaindgest"] . '</ctresaindgest>';
        $xml .= '<ctresalgbti>' . $datos["ctresalgbti"] . '</ctresalgbti>';

        //Datos de afiliacion
        $xml .= '<afiliado>' . $datos["afiliado"] . '</afiliado>';
        $xml .= '<fechaafiliacion>' . $datos["fechaafiliacion"] . '</fechaafiliacion>';
        $xml .= '<ultanorenafi>' . $datos["ultanorenafi"] . '</ultanorenafi>';
        $xml .= '<fechaultpagoafi>' . $datos["fechaultpagoafi"] . '</fechaultpagoafi>';
        $xml .= '<valorultpagoafi>' . $datos["valorultpagoafi"] . '</valorultpagoafi>';
        (isset($datos["saldoafiliado"])) ? $xml .= '<saldoafiliado>' . $datos["saldoafiliado"] . '</saldoafiliado>' : $xml .= '<saldoafiliado></saldoafiliado>';
        (isset($datos["telaflia"])) ? $xml .= '<telaflia>' . $datos["telaflia"] . '</telaflia>' : $xml .= '<telaflia></telaflia>';
        (isset($datos["diraflia"])) ? $xml .= '<diraflia>' . str_replace("#", "Nro.", $datos["diraflia"]) . '</diraflia>' : $xml .= '<diraflia></diraflia>';
        (isset($datos["munaflia"])) ? $xml .= '<munaflia>' . $datos["munaflia"] . '</munaflia>' : $xml .= '<munaflia></munaflia>';
        (isset($datos["profaflia"])) ? $xml .= '<profaflia>' . $datos["profaflia"] . '</profaflia>' : $xml .= '<profaflia></profaflia>';
        (isset($datos["contaflia"])) ? $xml .= '<contaflia>' . $datos["contaflia"] . '</contaflia>' : $xml .= '<contaflia></contaflia>';
        (isset($datos["dircontaflia"])) ? $xml .= '<dircontaflia>' . str_replace("#", "Nro.", $datos["dircontaflia"]) . '</dircontaflia>' : $xml .= '<dircontaflia></dircontaflia>';
        (isset($datos["muncontaflia"])) ? $xml .= '<muncontaflia>' . $datos["muncontaflia"] . '</muncontaflia>' : $xml .= '<muncontaflia></muncontaflia>';
        (isset($datos["numactaaflia"])) ? $xml .= '<numactaaflia>' . $datos["numactaaflia"] . '</numactaaflia>' : $xml .= '<numactaaflia></numactaaflia>';
        (isset($datos["fecactaaflia"])) ? $xml .= '<fecactaaflia>' . $datos["fecactaaflia"] . '</fecactaaflia>' : $xml .= '<fecactaaflia></fecactaaflia>';
        (isset($datos["numactaafliacan"])) ? $xml .= '<numactaafliacan>' . $datos["numactaafliacan"] . '</numactaafliacan>' : $xml .= '<numactaafliacan></numactaafliacan>';
        (isset($datos["fecactaafliacan"])) ? $xml .= '<fecactaafliacan>' . $datos["fecactaafliacan"] . '</fecactaafliacan>' : $xml .= '<fecactaafliacan></fecactaafliacan>';
        (isset($datos["fecexafiliacion"])) ? $xml .= '<fecexafiliacion>' . $datos["fecexafiliacion"] . '</fecexafiliacion>' : $xml .= '<fecexafiliacion></fecexafiliacion>';

        if (isset($datos["periodicoafiliados"])) {
            foreach ($datos["periodicoafiliados"] as $pagafi) {
                $xml .= '<pagosafiliado>';
                $xml .= '<perafiano>' . $pagafi["ano"] . '</perafiano>';
                $xml .= '<perafifecha>' . $pagafi["fecha"] . '</perafifecha>';
                $xml .= '<perafitipo>' . $pagafi["tipo"] . '</perafitipo>';
                $xml .= '<perafirecibo>' . $pagafi["recibo"] . '</perafirecibo>';
                $xml .= '<perafivalor>' . sprintf("%015s", str_replace(array(",", "."), "", $pagafi["valor"])) . '</perafivalor>';
                $xml .= '</pagosafiliado>';
            }
        }

        // Datos de ubicaci&oacute;n
        $xml .= '<lggr>' . $datos["lggr"] . '</lggr>';
        $xml .= '<nombrecomercial><![CDATA[' . $datos["nombrecomercial"] . ']]></nombrecomercial>';
        if ($reemplazar == 'si') {
            $xml .= '<dircom><![CDATA[' . \funcionesGenerales::reemplazarEspeciales(str_replace("#", "Nro.", $datos["dircom"])) . ']]></dircom>';
        } else {
            $xml .= '<dircom><![CDATA[' . str_replace("#", "Nro.", $datos["dircom"]) . ']]></dircom>';
        }
        $xml .= '<dircom_tipovia><![CDATA[' . $datos["dircom_tipovia"] . ']]></dircom_tipovia>';
        $xml .= '<dircom_numvia><![CDATA[' . $datos["dircom_numvia"] . ']]></dircom_numvia>';
        $xml .= '<dircom_apevia><![CDATA[' . $datos["dircom_apevia"] . ']]></dircom_apevia>';
        $xml .= '<dircom_orivia><![CDATA[' . $datos["dircom_orivia"] . ']]></dircom_orivia>';
        $xml .= '<dircom_numcruce><![CDATA[' . $datos["dircom_numcruce"] . ']]></dircom_numcruce>';
        $xml .= '<dircom_apecruce><![CDATA[' . $datos["dircom_apecruce"] . ']]></dircom_apecruce>';
        $xml .= '<dircom_oricruce><![CDATA[' . $datos["dircom_oricruce"] . ']]></dircom_oricruce>';
        $xml .= '<dircom_numplaca><![CDATA[' . $datos["dircom_numplaca"] . ']]></dircom_numplaca>';
        if ($reemplazar == 'si') {
            $xml .= '<dircom_complemento><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($datos["dircom_complemento"]) . ']]></dircom_complemento>';
        } else {
            $xml .= '<dircom_complemento><![CDATA[' . $datos["dircom_complemento"] . ']]></dircom_complemento>';
        }
        $xml .= '<muncom>' . $datos["muncom"] . '</muncom>';
        $xml .= '<paicom>' . $datos["paicom"] . '</paicom>';
        $xml .= '<telcom1>' . $datos["telcom1"] . '</telcom1>';
        $xml .= '<telcom2>' . $datos["telcom2"] . '</telcom2>';
        $xml .= '<celcom>' . $datos["celcom"] . '</celcom>';
        $xml .= '<faxcom>' . $datos["faxcom"] . '</faxcom>';
        $xml .= '<aacom>' . $datos["aacom"] . '</aacom>';
        $xml .= '<zonapostalcom>' . $datos["zonapostalcom"] . '</zonapostalcom>';
        $xml .= '<barriocom>' . $datos["barriocom"] . '</barriocom>';
        $xml .= '<numpredial>' . $datos["numpredial"] . '</numpredial>';
        if ($reemplazar == 'si') {
            $xml .= '<emailcom><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($datos["emailcom"]) . ']]></emailcom>';
            $xml .= '<emailcom2><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($datos["emailcom2"]) . ']]></emailcom2>';
            $xml .= '<emailcom3><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($datos["emailcom3"]) . ']]></emailcom3>';
            $xml .= '<urlcom><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($datos["urlcom"]) . ']]></urlcom>';
        } else {
            $xml .= '<emailcom><![CDATA[' . $datos["emailcom"] . ']]></emailcom>';
            $xml .= '<emailcom2><![CDATA[' . $datos["emailcom2"] . ']]></emailcom2>';
            $xml .= '<emailcom3><![CDATA[' . $datos["emailcom3"] . ']]></emailcom3>';
            $xml .= '<urlcom><![CDATA[' . $datos["urlcom"] . ']]></urlcom>';
        }
        $xml .= '<codigopostalcom>' . $datos["codigopostalcom"] . '</codigopostalcom>';
        $xml .= '<codigozonacom>' . $datos["codigozonacom"] . '</codigozonacom>';

        //
        if ($reemplazar == 'si') {
            $xml .= '<nombresegundocontacto><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($datos["nombresegundocontacto"]) . ']]></nombresegundocontacto>';
            $xml .= '<cargosegundocontacto><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($datos["cargosegundocontacto"]) . ']]></cargosegundocontacto>';
        } else {
            $xml .= '<nombresegundocontacto><![CDATA[' . $datos["nombresegundocontacto"] . ']]></nombresegundocontacto>';
            $xml .= '<cargosegundocontacto><![CDATA[' . $datos["cargosegundocontacto"] . ']]></cargosegundocontacto>';
        }

        // Datos de ubicaci&oacute;n geogr&aacute;fica (latitud y longitud)
        if (isset($datos["latitudgrados"])) {
            $xml .= '<latitudgrados>' . $datos["latitudgrados"] . '</latitudgrados>';
        }
        if (isset($datos["latitudminutos"])) {
            $xml .= '<latitudminutos>' . $datos["latitudminutos"] . '</latitudminutos>';
        }
        if (isset($datos["latitudsegundos"])) {
            $xml .= '<latitudsegundos>' . $datos["latitudsegundos"] . '</latitudsegundos>';
        }
        if (isset($datos["latitudorientacion"])) {
            $xml .= '<latitudorientacion>' . $datos["latitudorientacion"] . '</latitudorientacion>';
        }
        if (isset($datos["longitudgrados"])) {
            $xml .= '<longitudgrados>' . $datos["longitudgrados"] . '</longitudgrados>';
        }
        if (isset($datos["longitudminutos"])) {
            $xml .= '<longitudminutos>' . $datos["longitudminutos"] . '</longitudminutos>';
        }
        if (isset($datos["longitudsegundos"])) {
            $xml .= '<longitudsegundos>' . $datos["longitudsegundos"] . '</longitudsegundos>';
        }
        if (isset($datos["longitudorientacion"])) {
            $xml .= '<longitudorientacion>' . $datos["longitudorientacion"] . '</longitudorientacion>';
        }

        // Direcci&oacute;n de notificaci&oacute;n
        if ($reemplazar == 'si') {
            $xml .= '<dirnot><![CDATA[' . \funcionesGenerales::reemplazarEspeciales(str_replace("#", "Nro.", $datos["dirnot"])) . ']]></dirnot>';
        } else {
            $xml .= '<dirnot><![CDATA[' . str_replace("#", "Nro.", $datos["dirnot"]) . ']]></dirnot>';
        }
        $xml .= '<dirnot_tipovia><![CDATA[' . $datos["dirnot_tipovia"] . ']]></dirnot_tipovia>';
        $xml .= '<dirnot_numvia><![CDATA[' . $datos["dirnot_numvia"] . ']]></dirnot_numvia>';
        $xml .= '<dirnot_apevia><![CDATA[' . $datos["dirnot_apevia"] . ']]></dirnot_apevia>';
        $xml .= '<dirnot_orivia><![CDATA[' . $datos["dirnot_orivia"] . ']]></dirnot_orivia>';
        $xml .= '<dirnot_numcruce><![CDATA[' . $datos["dirnot_numcruce"] . ']]></dirnot_numcruce>';
        $xml .= '<dirnot_apecruce><![CDATA[' . $datos["dirnot_apecruce"] . ']]></dirnot_apecruce>';
        $xml .= '<dirnot_oricruce><![CDATA[' . $datos["dirnot_oricruce"] . ']]></dirnot_oricruce>';
        $xml .= '<dirnot_numplaca><![CDATA[' . $datos["dirnot_numplaca"] . ']]></dirnot_numplaca>';
        if ($reemplazar == 'si') {
            $xml .= '<dirnot_complemento><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($datos["dirnot_complemento"]) . ']]></dirnot_complemento>';
        } else {
            $xml .= '<dirnot_complemento><![CDATA[' . $datos["dirnot_complemento"] . ']]></dirnot_complemento>';
        }
        $xml .= '<munnot>' . $datos["munnot"] . '</munnot>';
        $xml .= '<painot>' . $datos["painot"] . '</painot>';
        $xml .= '<telnot>' . $datos["telnot"] . '</telnot>';
        $xml .= '<telnot2>' . $datos["telnot2"] . '</telnot2>';
        $xml .= '<celnot>' . $datos["celnot"] . '</celnot>';
        $xml .= '<faxnot>' . $datos["faxnot"] . '</faxnot>';
        $xml .= '<aanot>' . $datos["aanot"] . '</aanot>';
        $xml .= '<zonapostalnot>' . $datos["zonapostalnot"] . '</zonapostalnot>';
        $xml .= '<barrionot>' . $datos["barrionot"] . '</barrionot>';
        if ($reemplazar == 'si') {
            $xml .= '<emailnot><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($datos["emailnot"]) . ']]></emailnot>';
            $xml .= '<urlnot><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($datos["urlnot"]) . ']]></urlnot>';
            $xml .= '<dircor><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($datos["dircor"]) . ']]></dircor>';
        } else {
            $xml .= '<emailnot><![CDATA[' . $datos["emailnot"] . ']]></emailnot>';
            $xml .= '<urlnot><![CDATA[' . $datos["urlnot"] . ']]></urlnot>';
            $xml .= '<dircor><![CDATA[' . $datos["dircor"] . ']]></dircor>';
        }
        $xml .= '<telcor><![CDATA[' . $datos["telcor"] . ']]></telcor>';
        $xml .= '<muncor><![CDATA[' . $datos["muncor"] . ']]></muncor>';
        $xml .= '<codigopostalnot>' . $datos["codigopostalnot"] . '</codigopostalnot>';
        $xml .= '<codigozonanot>' . $datos["codigozonanot"] . '</codigozonanot>';
        $xml .= '<tiposedeadm>' . $datos["tiposedeadm"] . '</tiposedeadm>';

        // Ciius
        $xml .= '<ciius>';
        if (trim($datos["ciius"][1]) != '') {
            $xml .= '<ciiu>' . $datos["ciius"][1] . '</ciiu>';
        }
        if (trim($datos["ciius"][2]) != '') {
            $xml .= '<ciiu>' . $datos["ciius"][2] . '</ciiu>';
        }
        if (trim($datos["ciius"][3]) != '') {
            $xml .= '<ciiu>' . $datos["ciius"][3] . '</ciiu>';
        }
        if (trim($datos["ciius"][4]) != '') {
            $xml .= '<ciiu>' . $datos["ciius"][4] . '</ciiu>';
        }
        $xml .= '</ciius>';

        //
        if (trim($datos["versionciiu"]) != '') {
            $xml .= '<versionciiu>' . $datos["versionciiu"] . '</versionciiu>';
        } else {
            $xml .= '<versionciiu></versionciiu>';
        }

        // shd
        $xml .= '<shds>';
        if (trim($datos["shd"][1]) != '') {
            $xml .= '<shd>' . $datos["shd"][1] . '</shd>';
        }
        if (trim($datos["shd"][2]) != '') {
            $xml .= '<shd>' . $datos["shd"][2] . '</shd>';
        }
        if (trim($datos["shd"][3]) != '') {
            $xml .= '<shd>' . $datos["shd"][3] . '</shd>';
        }
        if (trim($datos["shd"][4]) != '') {
            $xml .= '<shd>' . $datos["shd"][4] . '</shd>';
        }
        $xml .= '</shds>';


        //
        $xml .= '<feciniact1>' . $datos["feciniact1"] . '</feciniact1>';
        $xml .= '<feciniact2>' . $datos["feciniact2"] . '</feciniact2>';
        $xml .= '<codaduaneros>' . $datos["codaduaneros"] . '</codaduaneros>';
        if (!isset($datos["ingesperados"]) || doubleval($datos["ingesperados"]) == 0) {
            $datos["ingesperados"] = 0;
        }
        $xml .= '<ingesperados>' . $datos["ingesperados"] . '</ingesperados>';
        $xml .= '<gruponiif>' . $datos["gruponiif"] . '</gruponiif>';
        $xml .= '<niifconciliacion>' . $datos["niifconciliacion"] . '</niifconciliacion>';
        $xml .= '<aportantesegsocial>' . $datos["aportantesegsocial"] . '</aportantesegsocial>';
        $xml .= '<tipoaportantesegsocial>' . $datos["tipoaportantesegsocial"] . '</tipoaportantesegsocial>';
        if (isset($datos["desactiv"])) {
            $xml .= '<desactiv>' . trim($datos["desactiv"]) . '</desactiv>';
        } else {
            $xml .= '<desactiv></desactiv>';
        }

        // Porcentajes de capitales
        if (isset($datos["cap_porcnaltot"])) {
            $xml .= '<cap_porcnaltot>' . $datos["cap_porcnaltot"] . '</cap_porcnaltot>';
        } else {
            $xml .= '<cap_porcnaltot></cap_porcnaltot>';
        }
        if (isset($datos["cap_porcnalpri"])) {
            $xml .= '<cap_porcnalpri>' . $datos["cap_porcnalpri"] . '</cap_porcnalpri>';
        } else {
            $xml .= '<cap_porcnalpri></cap_porcnalpri>';
        }
        if (isset($datos["cap_porcnalpub"])) {
            $xml .= '<cap_porcnalpub>' . $datos["cap_porcnalpub"] . '</cap_porcnalpub>';
        } else {
            $xml .= '<cap_porcnalpub></cap_porcnalpub>';
        }
        if (isset($datos["cap_porcexttot"])) {
            $xml .= '<cap_porcexttot>' . $datos["cap_porcexttot"] . '</cap_porcexttot>';
        } else {
            $xml .= '<cap_porcexttot></cap_porcexttot>';
        }
        if (isset($datos["cap_porcextpri"])) {
            $xml .= '<cap_porcextpri>' . $datos["cap_porcextpri"] . '</cap_porcextpri>';
        } else {
            $xml .= '<cap_porcextpri></cap_porcextpri>';
        }
        if (isset($datos["cap_porcextpub"])) {
            $xml .= '<cap_porcextpub>' . $datos["cap_porcextpub"] . '</cap_porcextpub>';
        } else {
            $xml .= '<cap_porcextpub></cap_porcextpub>';
        }

        // Capitales de asociativas de trabajo
        if (!isset($datos["cap_apolab"])) {
            $datos["cap_apolab"] = 0;
        }
        if (!isset($datos["cap_apolabadi"])) {
            $datos["cap_apolabadi"] = 0;
        }
        if (!isset($datos["cap_apodin"])) {
            $datos["cap_apodin"] = 0;
        }
        if (!isset($datos["cap_apoact"])) {
            $datos["cap_apoact"] = 0;
        }
        $xml .= '<cap_apolab>' . $datos["cap_apolab"] . '</cap_apolab>';
        $xml .= '<cap_apolabadi>' . $datos["cap_apolabadi"] . '</cap_apolabadi>';
        $xml .= '<cap_apodin>' . $datos["cap_apodin"] . '</cap_apodin>';
        $xml .= '<cap_apoact>' . $datos["cap_apoact"] . '</cap_apoact>';
        // $xml.='<cap_apotot>' . ($datos["cap_apolab"] +  $datos["cap_apolabadi"] + $datos["cap_apodin"] + $datos["cap_apoact"]) . '</cap_apotot>';
        // Cantidad de establecimientos
        if (isset($datos["cntestab01"])) {
            $xml .= '<cntestab01>' . $datos["cntestab01"] . '</cntestab01>';
            $xml .= '<cntestab02>' . $datos["cntestab02"] . '</cntestab02>';
            $xml .= '<cntestab03>' . $datos["cntestab03"] . '</cntestab03>';
            $xml .= '<cntestab04>' . $datos["cntestab04"] . '</cntestab04>';
            $xml .= '<cntestab05>' . $datos["cntestab05"] . '</cntestab05>';
            $xml .= '<cntestab06>' . $datos["cntestab06"] . '</cntestab06>';
            $xml .= '<cntestab07>' . $datos["cntestab07"] . '</cntestab07>';
            $xml .= '<cntestab08>' . $datos["cntestab08"] . '</cntestab08>';
            $xml .= '<cntestab09>' . $datos["cntestab09"] . '</cntestab09>';
            $xml .= '<cntestab10>' . $datos["cntestab10"] . '</cntestab10>';
            $xml .= '<cntestab11>' . $datos["cntestab11"] . '</cntestab11>';
        } else {
            $xml .= '<cntestab01></cntestab01>';
            $xml .= '<cntestab02></cntestab02>';
            $xml .= '<cntestab03></cntestab03>';
            $xml .= '<cntestab04></cntestab04>';
            $xml .= '<cntestab05></cntestab05>';
            $xml .= '<cntestab06></cntestab06>';
            $xml .= '<cntestab07></cntestab07>';
            $xml .= '<cntestab08></cntestab08>';
            $xml .= '<cntestab09></cntestab09>';
            $xml .= '<cntestab10></cntestab10>';
            $xml .= '<cntestab11></cntestab11>';
        }

        // Referencias
        $xml .= '<refcrenom1><![CDATA[' . $datos["refcrenom1"] . ']]></refcrenom1>';
        $xml .= '<refcreofi1><![CDATA[' . $datos["refcreofi1"] . ']]></refcreofi1>';
        $xml .= '<refcretel1><![CDATA[' . $datos["refcretel1"] . ']]></refcretel1>';
        $xml .= '<refcrenom2><![CDATA[' . $datos["refcrenom2"] . ']]></refcrenom2>';
        $xml .= '<refcreofi2><![CDATA[' . $datos["refcreofi2"] . ']]></refcreofi2>';
        $xml .= '<refcretel2><![CDATA[' . $datos["refcretel2"] . ']]></refcretel2>';
        $xml .= '<refcomnom1><![CDATA[' . $datos["refcomnom1"] . ']]></refcomnom1>';
        $xml .= '<refcomdir1><![CDATA[' . $datos["refcomdir1"] . ']]></refcomdir1>';
        $xml .= '<refcomtel1>' . $datos["refcomtel1"] . '</refcomtel1>';
        $xml .= '<refcomnom2><![CDATA[' . $datos["refcomnom2"] . ']]></refcomnom2>';
        $xml .= '<refcomdir2><![CDATA[' . $datos["refcomdir2"] . ']]></refcomdir2>';
        $xml .= '<refcomtel2>' . $datos["refcomtel2"] . '</refcomtel2>';

        // informacion financiera historica
        if (isset($datos["hf"])) {
            foreach ($datos["hf"] as $hf) {
                if ($datos["organizacion"] == '01' ||
                        ($datos["organizacion"] > '02' && $datos["categoria"] == '1')
                ) {
                    $xml .= '<hf>';
                    $xml .= '<hf_anodatos>' . $hf["anodatos"] . '</hf_anodatos>';
                    $xml .= '<hf_feccredat>' . $hf["fechadatos"] . '</hf_feccredat>';
                    $xml .= '<hf_actcte>' . $hf["actcte"] . '</hf_actcte>';
                    $xml .= '<hf_actnocte>' . $hf["actnocte"] . '</hf_actnocte>';
                    $xml .= '<hf_actfij>' . $hf["actfij"] . '</hf_actfij>';
                    $xml .= '<hf_fijnet>' . $hf["fijnet"] . '</hf_fijnet>';
                    $xml .= '<hf_actval>' . $hf["actval"] . '</hf_actval>';
                    $xml .= '<hf_actotr>' . $hf["actotr"] . '</hf_actotr>';
                    $xml .= '<hf_acttot>' . $hf["acttot"] . '</hf_acttot>';
                    $xml .= '<hf_actsin>' . $hf["actsinaju"] . '</hf_actsin>';
                    $xml .= '<hf_invent>' . $hf["invent"] . '</hf_invent>';
                    $xml .= '<hf_pascte>' . $hf["pascte"] . '</hf_pascte>';
                    $xml .= '<hf_paslar>' . $hf["paslar"] . '</hf_paslar>';
                    $xml .= '<hf_pastot>' . $hf["pastot"] . '</hf_pastot>';
                    $xml .= '<hf_patliq>' . $hf["pattot"] . '</hf_patliq>';
                    $xml .= '<hf_paspat>' . $hf["paspat"] . '</hf_paspat>';
                    $xml .= '<hf_balsoc>' . $hf["balsoc"] . '</hf_balsoc>';
                    $xml .= '<hf_ingope>' . $hf["ingope"] . '</hf_ingope>';
                    $xml .= '<hf_ingnoope>' . $hf["ingnoope"] . '</hf_ingnoope>';
                    $xml .= '<hf_cosven>' . $hf["cosven"] . '</hf_cosven>';
                    $xml .= '<hf_gasint>' . $hf["gasint"] . '</hf_gasint>';
                    $xml .= '<hf_gasimp>' . $hf["gasimp"] . '</hf_gasimp>';
                    $xml .= '<hf_gasadm>' . $hf["gtoadm"] . '</hf_gasadm>';
                    $xml .= '<hf_gasope>' . $hf["gtoven"] . '</hf_gasope>';
                    $xml .= '<hf_utiope>' . $hf["utiope"] . '</hf_utiope>';
                    $xml .= '<hf_utinet>' . $hf["utinet"] . '</hf_utinet>';
                    $xml .= '<hf_person>' . $hf["personal"] . '</hf_person>';
                    $xml .= '<hf_pcttem>' . $hf["personaltemp"] . '</hf_pcttem>';
                    $xml .= '<hf_depamo>' . $hf["depamo"] . '</hf_depamo>';
                    $xml .= '</hf>';
                } else {
                    if ($hf["anodatos"] != '') {
                        $xml .= '<hf>';
                        $xml .= '<hf_anodatos>' . $hf["anodatos"] . '</hf_anodatos>';
                        if (isset($hf["feccredat"])) {
                            $xml .= '<hf_feccredat>' . $hf["feccredat"] . '</hf_feccredat>';
                        } else {
                            $xml .= '<hf_feccredat></hf_feccredat>';
                        }
                        if (isset($hf["valest"])) {
                            $xml .= '<hf_valest>' . $hf["actvin"] . '</hf_valest>';
                        } else {
                            $xml .= '<hf_valest></hf_valest>';
                        }
                        if (isset($hf["person"])) {
                            $xml .= '<hf_person>' . $hf["personal"] . '</hf_person>';
                        } else {
                            $xml .= '<hf_person></hf_person>';
                        }
                        $xml .= '</hf>';
                    }
                }
            }
        }

        // informacion financiera
        $xml .= '<anodatosactual>' . $datos["anodatos"] . '</anodatosactual>';
        $xml .= '<fechadatosactual>' . $datos["fechadatos"] . '</fechadatosactual>';
        $xml .= '<personalactual>' . $datos["personal"] . '</personalactual>';
        $xml .= '<personaltempactual>' . $datos["personaltemp"] . '</personaltempactual>';
        $xml .= '<actvinactual>' . $datos["actvin"] . '</actvinactual>';
        $xml .= '<actcteactual>' . $datos["actcte"] . '</actcteactual>';
        $xml .= '<actnocteactual>' . $datos["actnocte"] . '</actnocteactual>';
        $xml .= '<actfijactual>' . $datos["actfij"] . '</actfijactual>';
        $xml .= '<fijnetactual>' . $datos["fijnet"] . '</fijnetactual>';
        $xml .= '<actotractual>' . $datos["actotr"] . '</actotractual>';
        $xml .= '<actvalactual>' . $datos["actval"] . '</actvalactual>';
        $xml .= '<acttotactual>' . $datos["acttot"] . '</acttotactual>';
        $xml .= '<actsinajuactual>' . $datos["acttot"] . '</actsinajuactual>';
        $xml .= '<inventactual>' . $datos["invent"] . '</inventactual>';
        $xml .= '<pascteactual>' . $datos["pascte"] . '</pascteactual>';
        $xml .= '<paslaractual>' . $datos["paslar"] . '</paslaractual>';
        $xml .= '<pastotactual>' . $datos["pastot"] . '</pastotactual>';
        $xml .= '<pattotactual>' . $datos["pattot"] . '</pattotactual>';
        $xml .= '<paspatactual>' . $datos["paspat"] . '</paspatactual>';
        $xml .= '<balsocactual>' . $datos["balsoc"] . '</balsocactual>';
        $xml .= '<ingopeactual>' . $datos["ingope"] . '</ingopeactual>';
        $xml .= '<ingnoopeactual>' . $datos["ingnoope"] . '</ingnoopeactual>';

        $xml .= '<gtovenactual>' . $datos["gtoven"] . '</gtovenactual>';
        $xml .= '<gtoadmactual>' . $datos["gtoadm"] . '</gtoadmactual>';

        $xml .= '<gasopeactual>' . $datos["gtoven"] . '</gasopeactual>';
        $xml .= '<gasnoopeactual>' . $datos["gtoadm"] . '</gasnoopeactual>';

        $xml .= '<cosvenactual>' . $datos["cosven"] . '</cosvenactual>';
        $xml .= '<depamoactual>' . $datos["depamo"] . '</depamoactual>';
        $xml .= '<gasintactual>' . $datos["gasint"] . '</gasintactual>';
        $xml .= '<gasimpactual>' . $datos["gasimp"] . '</gasimpactual>';
        $xml .= '<utiopeactual>' . $datos["utiope"] . '</utiopeactual>';
        $xml .= '<utinetactual>' . $datos["utinet"] . '</utinetactual>';

        //
        $xml .= '<anodatos>' . $datos["anodatos"] . '</anodatos>';
        $xml .= '<fechadatos>' . $datos["fechadatos"] . '</fechadatos>';
        $xml .= '<personal>' . $datos["personal"] . '</personal>';
        $xml .= '<personaltemp>' . $datos["personaltemp"] . '</personaltemp>';
        $xml .= '<actvin>' . $datos["actvin"] . '</actvin>';
        $xml .= '<actcte>' . $datos["actcte"] . '</actcte>';
        $xml .= '<actnocte>' . $datos["actnocte"] . '</actnocte>';
        $xml .= '<actfij>' . $datos["actfij"] . '</actfij>';
        $xml .= '<fijnet>' . $datos["fijnet"] . '</fijnet>';
        $xml .= '<actotr>' . $datos["actotr"] . '</actotr>';
        $xml .= '<actval>' . $datos["actval"] . '</actval>';
        $xml .= '<acttot>' . $datos["acttot"] . '</acttot>';
        $xml .= '<actsinaju>' . $datos["acttot"] . '</actsinaju>';
        $xml .= '<invent>' . $datos["invent"] . '</invent>';
        $xml .= '<pascte>' . $datos["pascte"] . '</pascte>';
        $xml .= '<paslar>' . $datos["paslar"] . '</paslar>';
        $xml .= '<pastot>' . $datos["pastot"] . '</pastot>';
        $xml .= '<pattot>' . $datos["pattot"] . '</pattot>';
        $xml .= '<paspat>' . $datos["paspat"] . '</paspat>';
        $xml .= '<balsoc>' . $datos["balsoc"] . '</balsoc>';
        $xml .= '<ingope>' . $datos["ingope"] . '</ingope>';
        $xml .= '<ingnoope>' . $datos["ingnoope"] . '</ingnoope>';
        $xml .= '<gtoven>' . $datos["gtoven"] . '</gtoven>';
        $xml .= '<gtoadm>' . $datos["gtoadm"] . '</gtoadm>';

        $xml .= '<gasope>' . $datos["gtoven"] . '</gasope>';
        $xml .= '<gasnoope>' . $datos["gtoadm"] . '</gasnoope>';

        $xml .= '<cosven>' . $datos["cosven"] . '</cosven>';
        $xml .= '<depamo>' . $datos["depamo"] . '</depamo>';
        $xml .= '<gasint>' . $datos["gasint"] . '</gasint>';
        $xml .= '<gasimp>' . $datos["gasimp"] . '</gasimp>';
        $xml .= '<utiope>' . $datos["utiope"] . '</utiope>';
        $xml .= '<utinet>' . $datos["utinet"] . '</utinet>';

        //    
        if (isset($datos["apolab"])) {
            $xml .= '<apolab>' . $datos["apolab"] . '</apolab>';
        }
        if (isset($datos["apolabadi"])) {
            $xml .= '<apolabadi>' . $datos["apolabadi"] . '</apolabadi>';
        }
        if (isset($datos["apoact"])) {
            $xml .= '<apoact>' . $datos["apoact"] . '</apoact>';
        }
        if (isset($datos["apodin"])) {
            $xml .= '<apodin>' . $datos["apodin"] . '</apodin>';
        }
        if (isset($datos["apotot"])) {
            $xml .= '<apotot>' . $datos["apotot"] . '</apotot>';
        }

        //
        if (!isset($datos["anodatospatrimonio"])) {
            $datos["anodatospatrimonio"] = '';
        }
        if (!isset($datos["fechadatospatrimonio"])) {
            $datos["fechadatospatrimonio"] = '';
        }

        if (!isset($datos["patrimonioesadl"])) {
            $datos["patrimonioesadl"] = 0;
        }
        $xml .= '<anodatospatrimonio>' . $datos["anodatospatrimonio"] . '</anodatospatrimonio>';
        $xml .= '<fechadatospatrimonio>' . $datos["fechadatospatrimonio"] . '</fechadatospatrimonio>';
        $xml .= '<patrimonioesadl>' . $datos["patrimonioesadl"] . '</patrimonioesadl>';

        $xml .= '<cantidadmujeres>' . $datos["cantidadmujeres"] . '</cantidadmujeres>';
        $xml .= '<cantidadmujerescargosdirectivos>' . $datos["cantidadmujerescargosdirectivos"] . '</cantidadmujerescargosdirectivos>';
        $xml .= '<participacionmujeres>' . $datos["participacionmujeres"] . '</participacionmujeres>';
        $xml .= '<ciiutamanoempresarial>' . $datos["ciiutamanoempresarial"] . '</ciiutamanoempresarial>';
        $xml .= '<ingresostamanoempresarial>' . $datos["ingresostamanoempresarial"] . '</ingresostamanoempresarial>';
        $xml .= '<anodatostamanoempresarial>' . $datos["anodatostamanoempresarial"] . '</anodatostamanoempresarial>';
        $xml .= '<fechadatostamanoempresarial>' . $datos["fechadatostamanoempresarial"] . '</fechadatostamanoempresarial>';

        if (isset($datos["f"])) {
            foreach ($datos["f"] as $fin) {
                // informaci&oacute;n financiera
                if (!isset($fin["personaltemp"])) {
                    $fin["personaltemp"] = '';
                }
                if (!isset($fin["actvin"])) {
                    $fin["actvin"] = '0';
                }
                if (!isset($fin["actcte"])) {
                    $fin["actcte"] = '0';
                }
                if (!isset($fin["actnocte"])) {
                    $fin["actnocte"] = '0';
                }
                if (!isset($fin["actfij"])) {
                    $fin["actfij"] = '0';
                }
                if (!isset($fin["fijnet"])) {
                    $fin["fijnet"] = '0';
                }
                if (!isset($fin["actotr"])) {
                    $fin["actotr"] = '0';
                }
                if (!isset($fin["actval"])) {
                    $fin["actval"] = '0';
                }
                if (!isset($fin["acttot"])) {
                    $fin["acttot"] = '0';
                }
                if (!isset($fin["invent"])) {
                    $fin["invent"] = '0';
                }
                if (!isset($fin["pascte"])) {
                    $fin["pascte"] = '0';
                }
                if (!isset($fin["paslar"])) {
                    $fin["paslar"] = '0';
                }
                if (!isset($fin["pastot"])) {
                    $fin["pastot"] = '0';
                }
                if (!isset($fin["pattot"])) {
                    $fin["pattot"] = '0';
                }
                if (!isset($fin["paspat"])) {
                    $fin["paspat"] = '0';
                }
                if (!isset($fin["balsoc"])) {
                    $fin["balsoc"] = '0';
                }
                if (!isset($fin["ingope"])) {
                    $fin["ingope"] = '0';
                }
                if (!isset($fin["ingnoope"])) {
                    $fin["ingnoope"] = '0';
                }
                if (!isset($fin["gtoven"])) {
                    $fin["gtoven"] = '0';
                }
                if (!isset($fin["gtoadm"])) {
                    $fin["gtoadm"] = '0';
                }
                if (!isset($fin["cosven"])) {
                    $fin["cosven"] = '0';
                }
                if (!isset($fin["depamo"])) {
                    $fin["depamo"] = '0';
                }
                if (!isset($fin["gasint"])) {
                    $fin["gasint"] = '0';
                }
                if (!isset($fin["gasimp"])) {
                    $fin["gasimp"] = '0';
                }
                if (!isset($fin["utiope"])) {
                    $fin["utiope"] = '0';
                }
                if (!isset($fin["utinet"])) {
                    $fin["utinet"] = '0';
                }
                if (!isset($fin["personal"])) {
                    $fin["personal"] = '0';
                }
                if (!isset($fin["fechadatos"])) {
                    $fin["fechadatos"] = date("Ymd");
                }
                if ($fin["anodatos"] != '') {
                    $xml .= '<financieraanteriores>';
                    $xml .= '<anodatos>' . $fin["anodatos"] . '</anodatos>';
                    $xml .= '<fechadatos>' . $fin["fechadatos"] . '</fechadatos>';
                    $xml .= '<personal>' . $fin["personal"] . '</personal>';
                    $xml .= '<personaltemp>' . $fin["personaltemp"] . '</personaltemp>';
                    $xml .= '<actvin>' . $fin["actvin"] . '</actvin>';
                    $xml .= '<actcte>' . $fin["actcte"] . '</actcte>';
                    $xml .= '<actnocte>' . $fin["actnocte"] . '</actnocte>';
                    $xml .= '<actfij>' . $fin["actfij"] . '</actfij>';
                    $xml .= '<fijnet>' . $fin["fijnet"] . '</fijnet>';
                    $xml .= '<actotr>' . $fin["actotr"] . '</actotr>';
                    $xml .= '<actval>' . $fin["actval"] . '</actval>';
                    $xml .= '<acttot>' . $fin["acttot"] . '</acttot>';
                    $xml .= '<actsinaju>' . $fin["acttot"] . '</actsinaju>';
                    $xml .= '<invent>' . $fin["invent"] . '</invent>';
                    $xml .= '<pascte>' . $fin["pascte"] . '</pascte>';
                    $xml .= '<paslar>' . $fin["paslar"] . '</paslar>';
                    $xml .= '<pastot>' . $fin["pastot"] . '</pastot>';
                    $xml .= '<pattot>' . $fin["pattot"] . '</pattot>';
                    $xml .= '<paspat>' . $fin["paspat"] . '</paspat>';
                    $xml .= '<balsoc>' . $fin["balsoc"] . '</balsoc>';
                    $xml .= '<ingope>' . $fin["ingope"] . '</ingope>';
                    $xml .= '<ingnoope>' . $fin["ingnoope"] . '</ingnoope>';
                    $xml .= '<gtoven>' . $fin["gtoven"] . '</gtoven>';
                    $xml .= '<gtoadm>' . $fin["gtoadm"] . '</gtoadm>';
                    $xml .= '<cosven>' . $fin["cosven"] . '</cosven>';
                    $xml .= '<depamo>' . $fin["depamo"] . '</depamo>';
                    $xml .= '<gasint>' . $fin["gasint"] . '</gasint>';
                    $xml .= '<gasimp>' . $fin["gasimp"] . '</gasimp>';
                    $xml .= '<utiope>' . $fin["utiope"] . '</utiope>';
                    $xml .= '<utinet>' . $fin["utinet"] . '</utinet>';
                    $xml .= '</financieraanteriores>';
                }
            }
        }

        //
        if (!isset($datos["benley1780"])) {
            $datos["benley1780"] = '';
        }
        if (!isset($datos["ctrdepuracion1727"])) {
            $datos["ctrdepuracion1727"] = '';
        }
        if (!isset($datos["ctrfechadepuracion1727"])) {
            $datos["ctrfechadepuracion1727"] = '';
        }

        if (!isset($datos["ctrben658"])) {
            $datos["ctrben658"] = '';
        }

        // Campos adicionados en mayo 20 de 2011
        $xml .= '<ctrmen>' . $datos["ctrmen"] . '</ctrmen>';
        $xml .= '<ctrmennot>' . $datos["ctrmennot"] . '</ctrmennot>';
        $xml .= '<ctrubi>' . $datos["ctrubi"] . '</ctrubi>';
        $xml .= '<ctrfun>' . $datos["ctrfun"] . '</ctrfun>';
        $xml .= '<art4>' . $datos["art4"] . '</art4>';
        $xml .= '<art7>' . $datos["art7"] . '</art7>';
        $xml .= '<art50>' . $datos["art50"] . '</art50>';
        $xml .= '<benley1780>' . $datos["benley1780"] . '</benley1780>';
        $xml .= '<cumplerequisitos1780>' . $datos["cumplerequisitos1780"] . '</cumplerequisitos1780>';
        $xml .= '<renunciabeneficios1780>' . $datos["renunciabeneficios1780"] . '</renunciabeneficios1780>';
        $xml .= '<cumplerequisitos1780primren>' . $datos["cumplerequisitos1780primren"] . '</cumplerequisitos1780primren>';
        $xml .= '<matriculaanterior>' . $datos["matriculaanterior"] . '</matriculaanterior>';
        $xml .= '<ctrcancelacion1429>' . $datos["ctrcancelacion1429"] . '</ctrcancelacion1429>';
        $xml .= '<ctrdepuracion1727>' . $datos["ctrdepuracion1727"] . '</ctrdepuracion1727>';
        $xml .= '<ctrfechadepuracion1727>' . $datos["ctrfechadepuracion1727"] . '</ctrfechadepuracion1727>';
        $xml .= '<ctrben658>' . $datos["ctrben658"] . '</ctrben658>';
        $xml .= '<personaltemp>' . $datos["personaltemp"] . '</personaltemp>';
        $xml .= '<ivcenvio>' . $datos["ivcenvio"] . '</ivcenvio>';
        $xml .= '<ivcsuelos>' . $datos["ivcsuelos"] . '</ivcsuelos>';
        $xml .= '<ivcarea>' . $datos["ivcarea"] . '</ivcarea>';
        $xml .= '<ivcver>' . $datos["ivcver"] . '</ivcver>';
        $xml .= '<ivccretip>' . $datos["ivccretip"] . '</ivccretip>';
        $xml .= '<ivcali>' . $datos["ivcali"] . '</ivcali>';
        $xml .= '<ivcqui>' . $datos["ivcqui"] . '</ivcqui>';
        $xml .= '<ivcriesgo>' . $datos["ivcriesgo"] . '</ivcriesgo>';
        $xml .= '<ctrbic>' . $datos["ctrbic"] . '</ctrbic>';

        //
        foreach ($datos["codigoscae"] as $key => $dat) {
            $xml .= '<' . $key . '>' . trim($dat) . '</' . $key . '>';
        }

        //
        foreach ($datos["informacionadicional"] as $key => $dat) {
            $xml .= '<' . $key . '>' . trim($dat) . '</' . $key . '>';
        }

        /*
          // Incluidas en mayo 23 de 2014
          $xml.='<alc_cedcat>' . $datos["alc_cedcat"] . '</alc_cedcat>';
          $xml.='<alc_feciniact>' . $datos["alc_feciniact"] . '</alc_feciniact>';
          $xml.='<alc_ingresos>' . $datos["alc_ingresos"] . '</alc_ingresos>';
          $xml.='<alc_codica1>' . $datos["alc_codica1"] . '</alc_codica1>';
          $xml.='<alc_codica2>' . $datos["alc_codica2"] . '</alc_codica2>';
          $xml.='<alc_codica3>' . $datos["alc_codica3"] . '</alc_codica3>';
          $xml.='<alc_codica4>' . $datos["alc_codica4"] . '</alc_codica4>';
          $xml.='<alc_codica5>' . $datos["alc_codica5"] . '</alc_codica5>';
          $xml.='<alc_areatot>' . $datos["alc_areatot"] . '</alc_areatot>';
          $xml.='<alc_areauti>' . $datos["alc_areauti"] . '</alc_areauti>';
          $xml.='<alc_respiyc>' . $datos["alc_respiyc"] . '</alc_respiyc>';
          $xml.='<alc_respretiyc>' . $datos["alc_respretiyc"] . '</alc_respretiyc>';
          $xml.='<alc_respmedmag>' . $datos["alc_respmedmag"] . '</alc_respmedmag>';
          $xml.='<alc_respotros>' . $datos["alc_respotros"] . '</alc_respotros>';
          $xml.='<alc_regimen>' . $datos["alc_regimen"] . '</alc_regimen>';
          $xml.='<alc_grancon>' . $datos["alc_grancon"] . '</alc_grancon>';
          $xml.='<alc_lugpre>' . $datos["alc_lugpre"] . '</alc_lugpre>';
          $xml.='<alc_estienda>' . $datos["alc_estienda"] . '</alc_estienda>';
          $xml.='<alc_tieneav>' . $datos["alc_tieneav"] . '</alc_tieneav>';
          $xml.='<alc_barrio>' . $datos["alc_barrio"] . '</alc_barrio>';
          $xml.='<alc_predio>' . $datos["alc_predio"] . '</alc_predio>';
         */

        // Representacion legal y administracion
        $xml .= '<representanteslegales>';
        if (!empty($datos["repleg"])) {
            foreach ($datos["replegal"] as $rep) {
                $xml .= '<representantelegal>';
                $xml .= '<idtipoidentificacionreplegal>' . $rep["idtipoidentificacionreplegal"] . '</idtipoidentificacionreplegal>';
                $xml .= '<identificacionreplegal>' . $rep["identificacionreplegal"] . '</identificacionreplegal>';
                if ($reemplazar == 'si') {
                    $xml .= '<nombrereplegal><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($rep["nombrereplegal"]) . ']]></nombrereplegal>';
                    $xml .= '<cargoreplegal><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($rep["cargoreplegal"]) . ']]></cargoreplegal>';
                } else {
                    $xml .= '<nombrereplegal><![CDATA[' . $rep["nombrereplegal"] . ']]></nombrereplegal>';
                    $xml .= '<cargoreplegal><![CDATA[' . $rep["cargoreplegal"] . ']]></cargoreplegal>';
                }
                $xml .= '</representantelegal>';
            }
        }
        $xml .= '</representanteslegales>';

        // Administrador    
        $xml .= '<idtipoidentificacionadministrador>' . $datos["idtipoidentificacionadministrador"] . '</idtipoidentificacionadministrador>';
        $xml .= '<identificacionadministrador>' . $datos["identificacionadministrador"] . '</identificacionadministrador>';
        if ($reemplazar == 'si') {
            $xml .= '<nombreadministrador><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($datos["nombreadministrador"]) . ']]></nombreadministrador>';
        } else {
            $xml .= '<nombreadministrador><![CDATA[' . $datos["nombreadministrador"] . ']]></nombreadministrador>';
        }

        // Bienes
        $xml .= '<bienes>';
        if (!empty($datos["bienes"])) {
            foreach ($datos["bienes"] as $bien) {
                $xml .= '<bien>';
                $xml .= '<matinmo>' . $bien["matinmo"] . '</matinmo>';
                $xml .= '<dir><![CDATA[' . $bien["dir"] . ']]></dir>';
                $xml .= '<barrio><![CDATA[' . $bien["barrio"] . ']]></barrio>';
                $xml .= '<muni><![CDATA[' . $bien["muni"] . ']]></muni>';
                $xml .= '<dpto><![CDATA[' . $bien["dpto"] . ']]></dpto>';
                $xml .= '<pais><![CDATA[' . $bien["pais"] . ']]></pais>';
                $xml .= '</bien>';
            }
        }
        $xml .= '</bienes>';

        // Propietarios
        $xml .= '<propietarios>';
        if (
                ($datos["organizacion"] == '02')
        ) {
            if (!empty($datos["propietarios"])) {
                foreach ($datos["propietarios"] as $prop) {

                    if (!isset($prop["nom1propietario"])) {
                        $prop["nom1propietario"] = '';
                    }
                    if (!isset($prop["nom2propietario"])) {
                        $prop["nom2propietario"] = '';
                    }
                    if (!isset($prop["ape1propietario"])) {
                        $prop["ape1propietario"] = '';
                    }
                    if (!isset($prop["ape2propietario"])) {
                        $prop["ape2propietario"] = '';
                    }
                    if (!isset($prop["fecmatripropietario"])) {
                        $prop["fecmatripropietario"] = '';
                    }
                    if (!isset($prop["estadodatospropietario"])) {
                        $prop["estadodatospropietario"] = '';
                    }

                    $xml .= '<propietario>';

                    $xml .= '<idclase>' . $prop["idtipoidentificacionpropietario"] . '</idclase>';
                    $xml .= '<numid>' . ltrim($prop["identificacionpropietario"], '0') . '</numid>';
                    $xml .= '<nit>' . ltrim($prop["nitpropietario"], '0') . '</nit>';
                    if ($reemplazar == 'si') {
                        $xml .= '<nombre><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($prop["nombrepropietario"]) . ']]></nombre>';
                    } else {
                        $xml .= '<nombre><![CDATA[' . $prop["nombrepropietario"] . ']]></nombre>';
                    }
                    $xml .= '<camara>' . $prop["camarapropietario"] . '</camara>';
                    $xml .= '<matricula>' . ltrim($prop["matriculapropietario"], '0') . '</matricula>';

                    $xml .= '<camarapropietario>' . $prop["camarapropietario"] . '</camarapropietario>';
                    $xml .= '<matriculapropietario>' . ltrim($prop["matriculapropietario"], '0') . '</matriculapropietario>';
                    $xml .= '<idtipoidentificacionpropietario>' . $prop["idtipoidentificacionpropietario"] . '</idtipoidentificacionpropietario>';
                    $xml .= '<identificacionpropietario>' . ltrim($prop["identificacionpropietario"], '0') . '</identificacionpropietario>';
                    $xml .= '<nitpropietario>' . ltrim($prop["nitpropietario"], '0') . '</nitpropietario>';
                    if ($reemplazar == 'si') {
                        $xml .= '<nombrepropietario><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($prop["nombrepropietario"]) . ']]></nombrepropietario>';
                        $xml .= '<nom1propietario><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($prop["nom1propietario"]) . ']]></nom1propietario>';
                        $xml .= '<nom2propietario><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($prop["nom2propietario"]) . ']]></nom2propietario>';
                        $xml .= '<ape1propietario><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($prop["ape1propietario"]) . ']]></ape1propietario>';
                        $xml .= '<ape2propietario><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($prop["ape2propietario"]) . ']]></ape2propietario>';
                        $xml .= '<direccionpropietario><![CDATA[' . \funcionesGenerales::reemplazarEspeciales(str_replace("#", "Nro.", $prop["direccionpropietario"])) . ']]></direccionpropietario>';
                        $xml .= '<direccionnotpropietario><![CDATA[' . \funcionesGenerales::reemplazarEspeciales(str_replace("#", "Nro.", $prop["direccionnotpropietario"])) . ']]></direccionnotpropietario>';
                        $xml .= '<nomreplegpropietario><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($prop["nomreplegpropietario"]) . ']]></nomreplegpropietario>';
                    } else {
                        $xml .= '<nombrepropietario><![CDATA[' . $prop["nombrepropietario"] . ']]></nombrepropietario>';
                        $xml .= '<nom1propietario><![CDATA[' . $prop["nom1propietario"] . ']]></nom1propietario>';
                        $xml .= '<nom2propietario><![CDATA[' . $prop["nom2propietario"] . ']]></nom2propietario>';
                        $xml .= '<ape1propietario><![CDATA[' . $prop["ape1propietario"] . ']]></ape1propietario>';
                        $xml .= '<ape2propietario><![CDATA[' . $prop["ape2propietario"] . ']]></ape2propietario>';
                        $xml .= '<direccionpropietario><![CDATA[' . str_replace("#", "Nro.", $prop["direccionpropietario"]) . ']]></direccionpropietario>';
                        $xml .= '<direccionnotpropietario><![CDATA[' . str_replace("#", "Nro.", $prop["direccionnotpropietario"]) . ']]></direccionnotpropietario>';
                        $xml .= '<nomreplegpropietario><![CDATA[' . $prop["nomreplegpropietario"] . ']]></nomreplegpropietario>';
                    }
                    $xml .= '<municipiopropietario>' . $prop["municipiopropietario"] . '</municipiopropietario>';
                    $xml .= '<municipionotpropietario>' . $prop["municipionotpropietario"] . '</municipionotpropietario>';
                    $xml .= '<telefonopropietario>' . $prop["telefonopropietario"] . '</telefonopropietario>';
                    $xml .= '<telefono2propietario>' . $prop["telefono2propietario"] . '</telefono2propietario>';
                    $xml .= '<celularpropietario>' . $prop["celularpropietario"] . '</celularpropietario>';
                    $xml .= '<numidreplegpropietario>' . $prop["numidreplegpropietario"] . '</numidreplegpropietario>';
                    $xml .= '<tipoidreplegpropietario>' . $prop["tipoidreplegpropietario"] . '</tipoidreplegpropietario>';
                    $xml .= '<fecmatripropietario>' . $prop["fecmatripropietario"] . '</fecmatripropietario>';
                    $xml .= '<ultanorenpropietario>' . $prop["ultanorenpropietario"] . '</ultanorenpropietario>';
                    $xml .= '<organizacionpropietario>' . $prop["organizacionpropietario"] . '</organizacionpropietario>';
                    $xml .= '<estadodatospropietario>' . $prop["estadodatospropietario"] . '</estadodatospropietario>';
                    $xml .= '</propietario>';
                }
            }
        }
        $xml .= '</propietarios>';

        // Establecimientos
        if ($extendido == 'si') {
            $xml .= '<establecimientos>';
            if (
                    ($datos["organizacion"] != '02') &&
                    (($datos["categoria"] == '0') || ($datos["categoria"] == '1'))
            ) {
                if (!empty($datos["establecimientos"])) {
                    foreach ($datos["establecimientos"] as $est) {
                        $xml .= '<establecimiento>';
                        $xml .= '<matriculaestablecimiento>' . ltrim($est["matriculaestablecimiento"], '0') . '</matriculaestablecimiento>';
                        if ($reemplazar == 'si') {
                            $xml .= '<nombreestablecimiento><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($est["nombreestablecimiento"]) . ']]></nombreestablecimiento>';
                        } else {
                            $xml .= '<nombreestablecimiento><![CDATA[' . $est["nombreestablecimiento"] . ']]></nombreestablecimiento>';
                        }
                        $xml .= '<estadodatosestablecimiento><![CDATA[' . $est["estadodatosestablecimiento"] . ']]></estadodatosestablecimiento>';
                        $xml .= '<estadomatricula><![CDATA[' . $est["estadomatricula"] . ']]></estadomatricula>';
                        $xml .= '<dircom><![CDATA[' . $est["dircom"] . ']]></dircom>';
                        $xml .= '<telcom1><![CDATA[' . $est["telcom1"] . ']]></telcom1>';
                        $xml .= '<telcom2><![CDATA[' . $est["telcom2"] . ']]></telcom2>';
                        $xml .= '<telcom3><![CDATA[' . $est["telcom3"] . ']]></telcom3>';
                        $xml .= '<muncom><![CDATA[' . $est["muncom"] . ']]></muncom>';
                        $xml .= '<emailcom><![CDATA[' . $est["emailcom"] . ']]></emailcom>';
                        $xml .= '<fechamatricula><![CDATA[' . $est["fechamatricula"] . ']]></fechamatricula>';
                        $xml .= '<fecharenovacion><![CDATA[' . $est["fecharenovacion"] . ']]></fecharenovacion>';
                        $xml .= '<ultanorenovado><![CDATA[' . $est["ultanoren"] . ']]></ultanorenovado>';
                        $xml .= '<actvin><![CDATA[' . $est["actvin"] . ']]></actvin>';
                        $xml .= '<ciiu1><![CDATA[' . $est["ciiu1"] . ']]></ciiu1>';
                        $xml .= '<ciiu2><![CDATA[' . $est["ciiu2"] . ']]></ciiu2>';
                        $xml .= '<ciiu3><![CDATA[' . $est["ciiu3"] . ']]></ciiu3>';
                        $xml .= '<ciiu4><![CDATA[' . $est["ciiu4"] . ']]></ciiu4>';
                        $xml .= '<embargado><![CDATA[' . $est["embargado"] . ']]></embargado>';
                        $xml .= '</establecimiento>';
                    }
                }
            }
            $xml .= '</establecimientos>';
        }

        // Sucuarsales y agencias
        if ($extendido == 'si') {
            $xml .= '<sucursalesagencias>';
            if (
                    ($datos["organizacion"] != '02') &&
                    (($datos["categoria"] == '0') || ($datos["categoria"] == '1'))
            ) {
                if (!empty($datos["sucursalesagencias"])) {
                    foreach ($datos["sucursalesagencias"] as $est) {
                        $xml .= '<sucage>';
                        $xml .= '<matriculasucage>' . ltrim($est["matriculasucage"], '0') . '</matriculasucage>';
                        if ($reemplazar == 'si') {
                            $xml .= '<nombresucage><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($est["nombresucage"]) . ']]></nombresucage>';
                        } else {
                            $xml .= '<nombresucage><![CDATA[' . $est["nombresucage"] . ']]></nombresucage>';
                        }
                        $xml .= '<categoria><![CDATA[' . $est["categoria"] . ']]></categoria>';
                        $xml .= '<estado><![CDATA[' . $est["estado"] . ']]></estado>';
                        $xml .= '<dircom><![CDATA[' . $est["dircom"] . ']]></dircom>';
                        $xml .= '<telcom1><![CDATA[' . $est["telcom1"] . ']]></telcom1>';
                        $xml .= '<telcom2><![CDATA[' . $est["telcom2"] . ']]></telcom2>';
                        $xml .= '<telcom3><![CDATA[' . $est["telcom3"] . ']]></telcom3>';
                        $xml .= '<muncom><![CDATA[' . $est["muncom"] . ']]></muncom>';
                        $xml .= '<emailcom><![CDATA[' . $est["emailcom"] . ']]></emailcom>';
                        $xml .= '<fechamatricula><![CDATA[' . $est["fechamatricula"] . ']]></fechamatricula>';
                        $xml .= '<fecharenovacion><![CDATA[' . $est["fecharenovacion"] . ']]></fecharenovacion>';
                        $xml .= '<ultanorenovado><![CDATA[' . $est["ultanoren"] . ']]></ultanorenovado>';
                        $xml .= '<actvin><![CDATA[' . $est["actvin"] . ']]></actvin>';
                        $xml .= '<ciiu1><![CDATA[' . $est["ciiu1"] . ']]></ciiu1>';
                        $xml .= '<ciiu2><![CDATA[' . $est["ciiu2"] . ']]></ciiu2>';
                        $xml .= '<ciiu3><![CDATA[' . $est["ciiu3"] . ']]></ciiu3>';
                        $xml .= '<ciiu4><![CDATA[' . $est["ciiu4"] . ']]></ciiu4>';
                        $xml .= '<embargado><![CDATA[' . $est["embargado"] . ']]></embargado>';

                        $xml .= '</sucage>';
                    }
                }
            }
            $xml .= '</sucursalesagencias>';
        }

        // Referencia a casa principal
        if (
                ($datos["organizacion"] > '02') &&
                (($datos["categoria"] == '2') || ($datos["categoria"] == '3'))
        ) {
            if (!isset($datos["cpcodcam"])) {
                $datos["cpcodcam"] = '';
            }
            if (!isset($datos["cpnummat"])) {
                $datos["cpnummat"] = '';
            }
            if (!isset($datos["cprazsoc"])) {
                $datos["cprazsoc"] = '';
            }
            if (!isset($datos["cpnumnit"])) {
                $datos["cpnumnit"] = '';
            }
            if (!isset($datos["cpdircom"])) {
                $datos["cpdircom"] = '';
            }
            if (!isset($datos["cpdirnot"])) {
                $datos["cpdirnot"] = '';
            }
            if (!isset($datos["cpnumtel"])) {
                $datos["cpnumtel"] = '';
            }
            if (!isset($datos["cpnumfax"])) {
                $datos["cpnumfax"] = '';
            }
            if (!isset($datos["cpcodmun"])) {
                $datos["cpcodmun"] = '';
            }
            if (!isset($datos["cpmunnot"])) {
                $datos["cpmunnot"] = '';
            }
            if (!isset($datos["cptirepleg"])) {
                $datos["cptirepleg"] = '';
            }
            if (!isset($datos["cpirepleg"])) {
                $datos["cpirepleg"] = '';
            }
            if (!isset($datos["cptnrepleg"])) {
                $datos["cptnrepleg"] = '';
            }
            if (!isset($datos["cptelrepleg"])) {
                $datos["cptelrepleg"] = '';
            }
            if (!isset($datos["cpemailrepleg"])) {
                $datos["cpemailrepleg"] = '';
            }
            $xml .= '<cpcodcam>' . trim($datos["cpcodcam"]) . '</cpcodcam>';
            $xml .= '<cpnummat>' . sprintf("%08s", trim($datos["cpnummat"])) . '</cpnummat>';
            if ($reemplazar == 'si') {
                $xml .= '<cprazsoc><![CDATA[' . \funcionesGenerales::reemplazarEspeciales(trim($datos["cprazsoc"])) . ']]></cprazsoc>';
            } else {
                $xml .= '<cprazsoc><![CDATA[' . trim($datos["cprazsoc"]) . ']]></cprazsoc>';
            }
            $xml .= '<cpnumnit>' . sprintf("%011s", trim($datos["cpnumnit"])) . '</cpnumnit>';
            if ($reemplazar == 'si') {
                $xml .= '<cpdircom><![CDATA[' . \funcionesGenerales::reemplazarEspeciales(trim($datos["cpdircom"])) . ']]></cpdircom>';
            } else {
                $xml .= '<cpdircom><![CDATA[' . trim($datos["cpdircom"]) . ']]></cpdircom>';
            }
            $xml .= '<cpdirnot><![CDATA[' . trim($datos["cpdirnot"]) . ']]></cpdirnot>';
            $xml .= '<cpnumtel>' . trim($datos["cpnumtel"]) . '</cpnumtel>';
            $xml .= '<cpnumfax>' . trim($datos["cpnumfax"]) . '</cpnumfax>';
            $xml .= '<cpcodmun>' . sprintf("%05s", trim($datos["cpcodmun"])) . '</cpcodmun>';
            $xml .= '<cpmunnot>' . sprintf("%05s", trim($datos["cpmunnot"])) . '</cpmunnot>';
            $xml .= '<cptirepleg>' . trim($datos["cptirepleg"]) . '</cptirepleg>';
            $xml .= '<cpirepleg>' . trim($datos["cpirepleg"]) . '</cpirepleg>';
            $xml .= '<cpnrepleg>' . trim($datos["cpnrepleg"]) . '</cpnrepleg>';
            $xml .= '<cptelrepleg>' . trim($datos["cptelrepleg"]) . '</cptelrepleg>';
            $xml .= '<cpemailrepleg>' . trim($datos["cpemailrepleg"]) . '</cpemailrepleg>';
        } else {
            $xml .= '<cpcodcam></cpcodcam>';
            $xml .= '<cpnummat></cpnummat>';
            $xml .= '<cprazsoc></cprazsoc>';
            $xml .= '<cpnumnit></cpnumnit>';
            $xml .= '<cpdircom></cpdircom>';
            $xml .= '<cpdirnot></cpdirnot>';
            $xml .= '<cpnumtel></cpnumtel>';
            $xml .= '<cpnumfax></cpnumfax>';
            $xml .= '<cpcodmun></cpcodmun>';
            $xml .= '<cpmunnot></cpmunnot>';
            $xml .= '<cptirepleg></cptirepleg>';
            $xml .= '<cpirepleg></cpirepleg>';
            $xml .= '<cpnrepleg></cpnrepleg>';
            $xml .= '<cptelrepleg></cptelrepleg>';
            $xml .= '<cpemailrepleg></cpemailrepleg>';
        }

        if ($extendido == 'si') {
            if (isset($datos["vinculos"])) {
                if (!empty($datos["vinculos"])) {
                    foreach ($datos["vinculos"] as $v) {
                        $xml .= '<vinculo>';
                        $xml .= '<idtipoidentificacionotros>' . $v["idtipoidentificacionotros"] . '</idtipoidentificacionotros>';
                        $xml .= '<identificacionotros>' . $v["identificacionotros"] . '</identificacionotros>';
                        if ($reemplazar == 'si') {
                            $xml .= '<nombreotros><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($v["nombreotros"]) . ']]></nombreotros>';
                        } else {
                            $xml .= '<nombreotros>' . $v["nombreotros"] . '</nombreotros>';
                        }
                        $xml .= '<vinculootros>' . $v["vinculootros"] . '</vinculootros>';
                        $xml .= '</vinculo>';
                    }
                }
            }
        }

        if ($extendido == 'si') {
            if (isset($datos["vincuprop"])) {
                if (!empty($datos["vincuprop"])) {
                    foreach ($datos["vincuprop"] as $v) {
                        $xml .= '<vp>';
                        $xml .= '<idclase>' . $v["idclase"] . '</idclase>';
                        $xml .= '<numid>' . $v["numid"] . '</numid>';
                        if ($reemplazar == 'si') {
                            $xml .= '<nombre><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($v["nombre"]) . ']]></nombre>';
                        } else {
                            $xml .= '<nombre><![CDATA[' . $v["nombre"] . ']]></nombre>';
                        }
                        $xml .= '<vinculo>' . $v["vinculo"] . '</vinculo>';
                        if ($reemplazar == 'si') {
                            $xml .= '<cargo><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($v["cargo"]) . ']]></cargo>';
                        } else {
                            $xml .= '<cargo><![CDATA[' . $v["cargo"] . ']]></cargo>';
                        }
                        $xml .= '</vp>';
                    }
                }
            }
        }



        // Inscripciones
        if ($extendido == 'si') {
            if (isset($datos["inscripciones"])) {
                if (!empty($datos["inscripciones"])) {
                    foreach ($datos["inscripciones"] as $ins) {
                        $xml .= '<li>';
                        foreach ($ins as $key => $valor) {
                            if ($key == 'not' || $key == 'not2' || $key == 'not3' || $key == 'txoridoc') {
                                $xml .= '<' . $key . '><![CDATA[' . trim($valor) . ']]></' . $key . '>';
                            } else {
                                $xml .= '<' . $key . '>' . trim($valor) . '</' . $key . '>';
                            }
                        }
                        $xml .= '</li>';
                    }
                }
            }
        }

        // Nombres anteriores
        // if ($extendido == 'si') {
        if (isset($datos["nomant"])) {
            if (!empty($datos["nomant"])) {
                foreach ($datos["nomant"] as $ins) {
                    $xml .= '<na>';
                    $xml .= '<sec>' . $ins["sec"] . "</sec>";
                    $xml .= '<lib>' . $ins["lib"] . "</lib>";
                    $xml .= '<nreg>' . $ins["nreg"] . "</nreg>";
                    $xml .= '<freg>' . $ins["freg"] . "</freg>";
                    $xml .= '<nom><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($ins["nom"]) . "]]></nom>";
                    $xml .= '<ope>' . $ins["ope"] . "</ope>";
                    $xml .= '<fcre>' . $ins["fcre"] . "</fcre>";
                    $xml .= '</na>';
                }
            }
        }
        // }
        // Embargos
        // if ($extendido == 'si') {
        if (isset($datos["ctrembargos"])) {
            if (!empty($datos["ctrembargos"])) {
                foreach ($datos["ctrembargos"] as $ins) {
                    $xml .= '<emb>';
                    foreach ($ins as $key => $valor) {
                        $xml .= '<' . $key . '>' . $valor . '</' . $key . '>';
                    }
                    $xml .= '</emb>';
                }
            }
        }
        $xml .= '</expediente>';
        $xml .= '</expedientes>';

        return $xml;
    }

    public static function serializarExpedienteProponente($dbx, $data = '') {
        $xml = '<?xml version="1.0" encoding="utf-8" ?>' . chr(13);
        $xml .= '<expedientes>' . chr(13);
        $xml .= '<expediente>' . chr(13);

        //
        if ($data != '') {

            //
            $xml .= '<tipotramite></tipotramite>' . chr(13);
            $xml .= '<numerorecuperacion></numerorecuperacion>' . chr(13);
            $xml .= '<numeroliquidacion></numeroliquidacion>' . chr(13);
            $xml .= '<numeroradicacion></numeroradicacion>' . chr(13);
            $xml .= '<proponente>' . ltrim($data["proponente"], '0') . '</proponente>' . chr(13);
            $xml .= '<matricula>' . ltrim($data["matricula"], '0') . '</matricula>' . chr(13);
            $xml .= '<nombre><![CDATA[' . \funcionesGenerales::reemplazarEspeciales(trim($data["nombre"])) . ']]></nombre>' . chr(13);
            $xml .= '<ape1><![CDATA[' . \funcionesGenerales::reemplazarEspeciales(trim($data["ape1"])) . ']]></ape1>' . chr(13);
            $xml .= '<ape2><![CDATA[' . \funcionesGenerales::reemplazarEspeciales(trim($data["ape2"])) . ']]></ape2>' . chr(13);
            $xml .= '<nom1><![CDATA[' . \funcionesGenerales::reemplazarEspeciales(trim($data["nom1"])) . ']]></nom1>' . chr(13);
            $xml .= '<nom2><![CDATA[' . \funcionesGenerales::reemplazarEspeciales(trim($data["nom2"])) . ']]></nom2>' . chr(13);
            $xml .= '<sigla><![CDATA[' . \funcionesGenerales::reemplazarEspeciales(trim($data["sigla"])) . ']]></sigla>' . chr(13);
            $xml .= '<idtipoidentificacion>' . $data["idtipoidentificacion"] . '</idtipoidentificacion>' . chr(13);
            $xml .= '<identificacion>' . ltrim($data["identificacion"], '0') . '</identificacion>' . chr(13);
            $xml .= '<idpaisidentificacion>' . $data["idpaisidentificacion"] . '</idpaisidentificacion>' . chr(13);
            $xml .= '<nit>' . ltrim($data["nit"], '0') . '</nit>' . chr(13);
            $xml .= '<nacionalidad><![CDATA[' . trim($data["nacionalidad"]) . ']]></nacionalidad>' . chr(13);
            $xml .= '<organizacion>' . $data["organizacion"] . '</organizacion>' . chr(13);
            $xml .= '<tamanoempresa>' . $data["tamanoempresa"] . '</tamanoempresa>' . chr(13);
            $xml .= '<emprendedor28>' . $data["emprendedor28"] . '</emprendedor28>' . chr(13);
            $xml .= '<pemprendedor28>' . $data["pemprendedor28"] . '</pemprendedor28>' . chr(13);
            $xml .= '<vigcontrol>' . $data["vigcontrol"] . '</vigcontrol>' . chr(13);
            $xml .= '<idestadoproponente>' . $data["idestadoproponente"] . '</idestadoproponente>' . chr(13);
            $xml .= '<certificardesde>' . $data["certificardesde"] . '</certificardesde>' . chr(13);
            $xml .= '<fechaultimainscripcion>' . $data["fechaultimainscripcion"] . '</fechaultimainscripcion>' . chr(13);
            $xml .= '<fechaultimarenovacion>' . $data["fechaultimarenovacion"] . '</fechaultimarenovacion>' . chr(13);
            $xml .= '<fechacancelacion>' . $data["fechacancelacion"] . '</fechacancelacion>' . chr(13);

            // Cambio de domicilio
            $xml .= '<cambidom_idmunicipioorigen>' . $data["cambidom_idmunicipioorigen"] . '</cambidom_idmunicipioorigen>' . chr(13);
            $xml .= '<cambidom_idmunicipiodestino>' . $data["cambidom_idmunicipiodestino"] . '</cambidom_idmunicipiodestino>' . chr(13);
            $xml .= '<cambidom_fechaultimainscripcion>' . $data["cambidom_fechaultimainscripcion"] . '</cambidom_fechaultimainscripcion>' . chr(13);
            $xml .= '<cambidom_fechaultimarenovacion>' . $data["cambidom_fechaultimarenovacion"] . '</cambidom_fechaultimarenovacion>' . chr(13);
            if (isset($data["propcamaraorigen"])) {
                $xml .= '<propcamaraorigen>' . $data["propcamaraorigen"] . '</propcamaraorigen>' . chr(13);
            } else {
                $xml .= '<propcamaraorigen></propcamaraorigen>' . chr(13);
            }
            if (isset($data["propcamaradestino"])) {
                $xml .= '<propcamaradestino>' . $data["propcamaradestino"] . '</propcamaradestino>' . chr(13);
            } else {
                $xml .= '<propcamaradestino></propcamaradestino>' . chr(13);
            }

            // Datos de personer&iacute;a jur&iacute;dica
            $xml .= '<idtipodocperjur>' . $data["idtipodocperjur"] . '</idtipodocperjur>' . chr(13); // A02
            $xml .= '<numdocperjur>' . $data["numdocperjur"] . '</numdocperjur>' . chr(13); // A20
            $xml .= '<fecdocperjur>' . $data["fecdocperjur"] . '</fecdocperjur>' . chr(13); // (D)
            $xml .= '<origendocperjur><![CDATA[' . $data["origendocperjur"] . ']]></origendocperjur>' . chr(13); // A128
            $xml .= '<fechaconstitucion>' . $data["fechaconstitucion"] . '</fechaconstitucion>' . chr(13); // (D)
            $xml .= '<fechavencimiento>' . $data["fechavencimiento"] . '</fechavencimiento>' . chr(13); // (D)
            // Datos de ubicacion
            $xml .= '<dircom><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($data["dircom"]) . ']]></dircom>' . chr(13); // A128
            $xml .= '<dircom_tipovia></dircom_tipovia>' . chr(13); //A5
            $xml .= '<dircom_numvia></dircom_numvia>' . chr(13); //A3
            $xml .= '<dircom_apevia></dircom_apevia>' . chr(13); //A5
            $xml .= '<dircom_orivia></dircom_orivia>' . chr(13); //A5
            $xml .= '<dircom_numcruce></dircom_numcruce>' . chr(13); //A3
            $xml .= '<dircom_apecruce></dircom_apecruce>' . chr(13); //A5
            $xml .= '<dircom_oricruce></dircom_oricruce>' . chr(13); //A5
            $xml .= '<dircom_numplaca></dircom_numplaca>' . chr(13); //A3
            $xml .= '<dircom_complemento><![CDATA[]]></dircom_complemento>' . chr(13); //A20
            $xml .= '<muncom>' . $data["muncom"] . '</muncom>' . chr(13);
            $xml .= '<telcom1>' . $data["telcom1"] . '</telcom1>' . chr(13);
            $xml .= '<telcom2>' . $data["telcom2"] . '</telcom2>' . chr(13);
            $xml .= '<celcom>' . $data["celcom"] . '</celcom>' . chr(13);
            $xml .= '<faxcom>' . $data["faxcom"] . '</faxcom>' . chr(13);
            $xml .= '<emailcom><![CDATA[' . $data["emailcom"] . ']]></emailcom>' . chr(13);
            $xml .= '<enviarint>' . $data["enviarint"] . '</enviarint>' . chr(13);
            $xml .= '<dirnot><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($data["dirnot"]) . ']]></dirnot>' . chr(13);
            $xml .= '<dirnot_tipovia></dirnot_tipovia>' . chr(13);
            $xml .= '<dirnot_numvia></dirnot_numvia>' . chr(13);
            $xml .= '<dirnot_apevia></dirnot_apevia>' . chr(13);
            $xml .= '<dirnot_orivia></dirnot_orivia>' . chr(13);
            $xml .= '<dirnot_numcruce></dirnot_numcruce>' . chr(13);
            $xml .= '<dirnot_apecruce></dirnot_apecruce>' . chr(13);
            $xml .= '<dirnot_oricruce></dirnot_oricruce>' . chr(13);
            $xml .= '<dirnot_numplaca></dirnot_numplaca>' . chr(13);
            $xml .= '<dirnot_complemento><![CDATA[]]></dirnot_complemento>' . chr(13);
            $xml .= '<munnot>' . $data["munnot"] . '</munnot>' . chr(13);
            $xml .= '<telnot>' . $data["telnot"] . '</telnot>' . chr(13);
            $xml .= '<telnot2>' . $data["telnot2"] . '</telnot2>' . chr(13);
            $xml .= '<celnot>' . $data["celnot"] . '</celnot>' . chr(13);
            $xml .= '<faxnot>' . $data["faxnot"] . '</faxnot>' . chr(13);
            $xml .= '<emailnot><![CDATA[' . $data["emailnot"] . ']]></emailnot>' . chr(13);
            $xml .= '<enviarnot>' . $data["enviarnot"] . '</enviarnot>' . chr(13);


            // Representantes legales
            $xml .= '<representanteslegales>' . chr(13);
            if (!empty($data["representanteslegales"])) {
                foreach ($data["representanteslegales"] as $rep) {
                    $xml .= '<representantelegal>' . chr(13);
                    $xml .= '<idtipoidentificacionrepleg>' . $rep["idtipoidentificacionrepleg"] . "</idtipoidentificacionrepleg>";
                    $xml .= '<identificacionrepleg>' . $rep["identificacionrepleg"] . "</identificacionrepleg>";
                    $xml .= '<nombrerepleg><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($rep["nombrerepleg"]) . "]]></nombrerepleg>";
                    $xml .= '<cargorepleg><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($rep["cargorepleg"]) . "]]></cargorepleg>";
                    $xml .= '</representantelegal>' . chr(13);
                }
            }
            $xml .= '</representanteslegales>' . chr(13);


            // Facultades
            if (isset($data["facultades"])) {
                $xml .= '<facultades><![CDATA[' . \funcionesGenerales::reemplazarEspeciales(trim($data["facultades"])) . ']]></facultades>' . chr(13);
            } else {
                $data["facultades"] = '';
                $xml .= '<facultades><![CDATA[' . \funcionesGenerales::reemplazarEspeciales(trim($data["facultades"])) . ']]></facultades>' . chr(13);
            }


            // Situaciones de control
            if (!empty($data["sitcontrol"])) {
                foreach ($data["sitcontrol"] as $rep) {
                    $xml .= '<sitcontrol>' . chr(13);
                    $xml .= '<nombre><![CDATA[' . $rep["nombre"] . ']]></nombre>';
                    $xml .= '<identificacion>' . $rep["identificacion"] . '</identificacion>';
                    $xml .= '<domicilio>' . $rep["domicilio"] . '</domicilio>';
                    $xml .= '<tipo>' . $rep["tipo"] . '</tipo>';
                    $xml .= '</sitcontrol>' . chr(13);
                }
            }

            // Informacion financiera - Decreto 1510
            $xml .= '<inffin1510_fechacorte>' . $data["inffin1510_fechacorte"] . '</inffin1510_fechacorte>' . chr(13);
            $xml .= '<inffin1510_actcte>' . $data["inffin1510_actcte"] . '</inffin1510_actcte>' . chr(13);
            if (isset($data["inffin1510_actnocte"])) {
                $xml .= '<inffin1510_actnocte>' . $data["inffin1510_actnocte"] . '</inffin1510_actnocte>' . chr(13);
            } else {
                $xml .= '<inffin1510_actnocte>0</inffin1510_actnocte>' . chr(13);
            }
            $xml .= '<inffin1510_fijnet>' . $data["inffin1510_fijnet"] . '</inffin1510_fijnet>' . chr(13);
            $xml .= '<inffin1510_actotr>' . $data["inffin1510_actotr"] . '</inffin1510_actotr>' . chr(13);
            $xml .= '<inffin1510_actval>' . $data["inffin1510_actval"] . '</inffin1510_actval>' . chr(13);
            $xml .= '<inffin1510_acttot>' . $data["inffin1510_acttot"] . '</inffin1510_acttot>' . chr(13);

            $xml .= '<inffin1510_pascte>' . $data["inffin1510_pascte"] . '</inffin1510_pascte>' . chr(13);
            $xml .= '<inffin1510_paslar>' . $data["inffin1510_paslar"] . '</inffin1510_paslar>' . chr(13);
            $xml .= '<inffin1510_pastot>' . $data["inffin1510_pastot"] . '</inffin1510_pastot>' . chr(13);
            $xml .= '<inffin1510_patnet>' . $data["inffin1510_patnet"] . '</inffin1510_patnet>' . chr(13);
            $xml .= '<inffin1510_paspat>' . $data["inffin1510_paspat"] . '</inffin1510_paspat>' . chr(13);
            if (isset($data["inffin1510_balsoc"])) {
                $xml .= '<inffin1510_balsoc>' . $data["inffin1510_balsoc"] . '</inffin1510_balsoc>' . chr(13);
            } else {
                $xml .= '<inffin1510_balsoc>0</inffin1510_balsoc>' . chr(13);
            }
            $xml .= '<inffin1510_ingope>' . $data["inffin1510_ingope"] . '</inffin1510_ingope>' . chr(13);
            $xml .= '<inffin1510_ingnoope>' . $data["inffin1510_ingnoope"] . '</inffin1510_ingnoope>' . chr(13);
            $xml .= '<inffin1510_gasope>' . $data["inffin1510_gasope"] . '</inffin1510_gasope>' . chr(13);
            $xml .= '<inffin1510_gasnoope>' . $data["inffin1510_gasnoope"] . '</inffin1510_gasnoope>' . chr(13);
            $xml .= '<inffin1510_cosven>' . $data["inffin1510_cosven"] . '</inffin1510_cosven>' . chr(13);
            $xml .= '<inffin1510_utiope>' . $data["inffin1510_utiope"] . '</inffin1510_utiope>' . chr(13);
            $xml .= '<inffin1510_utinet>' . $data["inffin1510_utinet"] . '</inffin1510_utinet>' . chr(13);
            $xml .= '<inffin1510_gasint>' . $data["inffin1510_gasint"] . '</inffin1510_gasint>' . chr(13);
            if (isset($data["inffin1510_gasimp"])) {
                $xml .= '<inffin1510_gasimp>' . $data["inffin1510_gasimp"] . '</inffin1510_gasimp>' . chr(13);
            } else {
                $xml .= '<inffin1510_gasimp>0</inffin1510_gasimp>' . chr(13);
            }

            $xml .= '<inffin1510_indliq>' . $data["inffin1510_indliq"] . '</inffin1510_indliq>' . chr(13);
            $xml .= '<inffin1510_nivend>' . $data["inffin1510_nivend"] . '</inffin1510_nivend>' . chr(13);
            $xml .= '<inffin1510_razcob>' . $data["inffin1510_razcob"] . '</inffin1510_razcob>' . chr(13);
            $xml .= '<inffin1510_renpat>' . $data["inffin1510_renpat"] . '</inffin1510_renpat>' . chr(13);
            $xml .= '<inffin1510_renact>' . $data["inffin1510_renact"] . '</inffin1510_renact>' . chr(13);
            if (!isset($data["inffin1510_gruponiif"])) {
                $data["inffin1510_gruponiif"] = '';
            }
            $xml .= '<inffin1510_gruponiif>' . $data["inffin1510_gruponiif"] . '</inffin1510_gruponiif>' . chr(13);


            // Experiencia decreto 1510
            $i = 0;
            if (isset($data["exp1510"])) {
                if (count($data["exp1510"]) > 0) {
                    foreach ($data["exp1510"] as $cnt) {
                        if (trim($cnt["nombrecontratante"]) != '') {
                            $i++;
                            $xml .= '<exp1510>';
                            if (strlen(ltrim(trim($cnt["secuencia"]), "0")) <= 3) {
                                $xml .= '<secuencia>' . sprintf("%03s", $cnt["secuencia"]) . '</secuencia>';
                            } else {
                                $xml .= '<secuencia>' . $cnt["secuencia"] . '</secuencia>';
                            }
                            $xml .= '<clavecontrato>' . $cnt["clavecontrato"] . '</clavecontrato>';
                            $xml .= '<celebradopor>' . $cnt["celebradopor"] . '</celebradopor>';
                            $xml .= '<nombrecontratista><![CDATA[' . (\funcionesGenerales::reemplazarEspeciales($cnt["nombrecontratista"])) . ']]></nombrecontratista>';
                            $xml .= '<nombrecontratante><![CDATA[' . (\funcionesGenerales::reemplazarEspeciales($cnt["nombrecontratante"])) . ']]></nombrecontratante>';
                            if (isset($cnt["fecejecucion"])) {
                                $xml .= '<fecejecucion>' . $cnt["fecejecucion"] . '</fecejecucion>';
                            } else {
                                $xml .= '<fecejecucion></fecejecucion>';
                            }
                            if (isset($cnt["valorpesos"])) {
                                $xml .= '<valorpesos>' . $cnt["valorpesos"] . '</valorpesos>';
                            } else {
                                $xml .= '<valorpesos></valorpesos>';
                            }
                            $xml .= '<valor>' . $cnt["valor"] . '</valor>';
                            $xml .= '<porcentaje>' . $cnt["porcentaje"] . '</porcentaje>';
                            if (isset($cnt["clasif"])) {
                                foreach ($cnt["clasif"] as $c) {
                                    $xml .= '<clasif>' . trim($c) . '</clasif>';
                                }
                            }
                            $xml .= '<generardeclaracion>' . $cnt["generardeclaracion"] . '</generardeclaracion>' . chr(13);
                            $xml .= '</exp1510>';
                        }
                    }
                }
            }

            //
            if (isset($data["clasi1510"])) {
                asort($data["clasi1510"]);
                foreach ($data["clasi1510"] as $c) {
                    $xml .= '<cla1510>' . trim($c) . '</cla1510>';
                }
            }


            // Bienes
            $xml .= '<bienes>';
            if (!empty($data["bienes"])) {
                foreach ($data["bienes"] as $bien) {
                    $xml .= '<bien>';
                    $xml .= '<matinmo>' . $bien["matinmo"] . '</matinmo>';
                    $xml .= '<dir>' . $bien["dir"] . '</dir>';
                    $xml .= '<barrio>' . $bien["barrio"] . '</barrio>';
                    $xml .= '<muni>' . $bien["muni"] . '</muni>';
                    $xml .= '<dpto>' . $bien["muni"] . '</dpto>';
                    $xml .= '<pais>' . $bien["pais"] . '</pais>';
                    $xml .= '</bien>';
                }
            }
            $xml .= '</bienes>';

            foreach ($data["contratos"] as $cnt) {

                if (!isset($cnt["isn"])) {
                    $cnt["isn"] = '';
                }
                if (!isset($cnt["codcamara"])) {
                    $cnt["codcamara"] = '';
                }
                if (!isset($cnt["numradic"])) {
                    $cnt["numradic"] = '';
                }
                if (!isset($cnt["fecradic"])) {
                    $cnt["fecradic"] = '';
                }
                if (!isset($cnt["horradic"])) {
                    $cnt["horradic"] = '';
                }
                if (!isset($cnt["fecreporte"])) {
                    $cnt["fecreporte"] = '';
                }
                if (!isset($cnt["nitentidad"])) {
                    $cnt["nitentidad"] = '';
                }
                if (!isset($cnt["nombreentidad"])) {
                    $cnt["nombreentidad"] = '';
                }
                if (!isset($cnt["idmunientidad"])) {
                    $cnt["idmunientidad"] = '';
                }
                if (!isset($cnt["divarea"])) {
                    $cnt["divarea"] = '';
                }
                if (!isset($cnt["idefun"])) {
                    $cnt["idefun"] = '';
                }
                if (!isset($cnt["nomfun"])) {
                    $cnt["nomfun"] = '';
                }
                if (!isset($cnt["carfun"])) {
                    $cnt["carfun"] = '';
                }
                if (!isset($cnt["numcontrato"])) {
                    $cnt["numcontrato"] = '';
                }
                if (!isset($cnt["numcontratosecop"])) {
                    $cnt["numcontratosecop"] = '';
                }

                if (!isset($cnt["fechaadj"])) {
                    $cnt["fechaadj"] = '';
                }
                if (!isset($cnt["fechaper"])) {
                    $cnt["fechaper"] = '';
                }
                if (!isset($cnt["fechaini"])) {
                    $cnt["fechaini"] = '';
                }
                if (!isset($cnt["fechater"])) {
                    $cnt["fechater"] = '';
                }
                if (!isset($cnt["fechaeje"])) {
                    $cnt["fechaeje"] = '';
                }
                if (!isset($cnt["fechasus"])) {
                    $cnt["fechasus"] = '';
                }
                if (!isset($cnt["fechaliq"])) {
                    $cnt["fechaliq"] = '';
                }
                if (!isset($cnt["fechaterant"])) {
                    $cnt["fechaterant"] = '';
                }
                if (!isset($cnt["fechaces"])) {
                    $cnt["fechaces"] = '';
                }

                if (!isset($cnt["codigoact"])) {
                    $cnt["codigoact"] = '';
                }
                if (!isset($cnt["ciiu1"])) {
                    $cnt["ciiu1"] = '';
                }
                if (!isset($cnt["ciiu2"])) {
                    $cnt["ciiu2"] = '';
                }
                if (!isset($cnt["ciiu3"])) {
                    $cnt["ciiu3"] = '';
                }
                if (!isset($cnt["ciiu4"])) {
                    $cnt["ciiu4"] = '';
                }
                if (!isset($cnt["objeto"])) {
                    $cnt["objeto"] = '';
                }
                if (!isset($cnt["tipocont"])) {
                    $cnt["tipocont"] = '';
                }
                if (!isset($cnt["valorcont"])) {
                    $cnt["valorcont"] = '';
                }
                if (!isset($cnt["valorcontpag"])) {
                    $cnt["valorcontpag"] = '';
                }
                if (!isset($cnt["indcump"])) {
                    $cnt["indcump"] = '';
                }
                if (!isset($cnt["estadocont"])) {
                    $cnt["estadocont"] = '';
                }
                if (!isset($cnt["motivoter"])) {
                    $cnt["motivoter"] = '';
                }
                if (!isset($cnt["motivoces"])) {
                    $cnt["motivoces"] = '';
                }
                if (!isset($cnt["observaciones"])) {
                    $cnt["observaciones"] = '';
                }
                if (!isset($cnt["numlibro"])) {
                    $cnt["numlibro"] = '';
                }
                if (!isset($cnt["numreglib"])) {
                    $cnt["numreglib"] = '';
                }
                if (!isset($cnt["fecreglib"])) {
                    $cnt["fecreglib"] = '';
                }
                if (!isset($cnt["codigocamaraorigen"])) {
                    $cnt["codigocamaraorigen"] = '';
                }
                if (!isset($cnt["numregistrocamaraorigen"])) {
                    $cnt["numregistrocamaraorigen"] = '';
                }
                if (!isset($cnt["fecregistrocamaraorigen"])) {
                    $cnt["fecregistrocamaraorigen"] = '';
                }

                $xml .= '<contrato>' . chr(13);
                $xml .= '<isn>' . $cnt["isn"] . '</isn>' . chr(13);
                $xml .= '<codcamara>' . $cnt["codcamara"] . '</codcamara>' . chr(13);
                $xml .= '<numradic>' . $cnt["numradic"] . '</numradic>' . chr(13);
                $xml .= '<fecradic>' . $cnt["fecradic"] . '</fecradic>' . chr(13);
                $xml .= '<horradic>' . $cnt["horradic"] . '</horradic>' . chr(13);
                $xml .= '<fecreporte>' . $cnt["fecreporte"] . '</fecreporte>' . chr(13);
                $xml .= '<nitentidad>' . $cnt["nitentidad"] . '</nitentidad>' . chr(13);
                $xml .= '<nombreentidad>' . $cnt["nombreentidad"] . '</nombreentidad>' . chr(13);
                $xml .= '<idmunientidad>' . $cnt["idmunientidad"] . '</idmunientidad>' . chr(13);
                $xml .= '<divarea>' . $cnt["divarea"] . '</divarea>' . chr(13);
                $xml .= '<idefun>' . $cnt["idefun"] . '</idefun>' . chr(13);
                $xml .= '<nomfun>' . $cnt["nomfun"] . '</nomfun>' . chr(13);
                $xml .= '<carfun>' . $cnt["carfun"] . '</carfun>' . chr(13);
                $xml .= '<numcontrato>' . $cnt["numcontrato"] . '</numcontrato>' . chr(13);
                $xml .= '<numcontratosecop>' . $cnt["numcontratosecop"] . '</numcontratosecop>' . chr(13);
                $xml .= '<fechaadj>' . $cnt["fechaadj"] . '</fechaadj>' . chr(13);
                $xml .= '<fechaper>' . $cnt["fechaper"] . '</fechaper>' . chr(13);
                $xml .= '<fechaini>' . $cnt["fechaini"] . '</fechaini>' . chr(13);
                $xml .= '<fechater>' . $cnt["fechater"] . '</fechater>' . chr(13);
                $xml .= '<fechaeje>' . $cnt["fechaeje"] . '</fechaeje>' . chr(13);
                $xml .= '<fechaliq>' . $cnt["fechaliq"] . '</fechaliq>' . chr(13);
                $xml .= '<fechaterant>' . $cnt["fechaterant"] . '</fechaterant>' . chr(13);
                $xml .= '<fechaces>' . $cnt["fechaces"] . '</fechaces>' . chr(13);
                $xml .= '<codigoact>' . $cnt["codigoact"] . '</codigoact>' . chr(13);
                $xml .= '<ciiu1>' . $cnt["ciiu1"] . '</ciiu1>' . chr(13);
                $xml .= '<ciiu2>' . $cnt["ciiu2"] . '</ciiu2>' . chr(13);
                $xml .= '<ciiu3>' . $cnt["ciiu3"] . '</ciiu3>' . chr(13);
                $xml .= '<ciiu4>' . $cnt["ciiu4"] . '</ciiu4>' . chr(13);
                $xml .= '<tipocont>' . $cnt["tipocont"] . '</tipocont>' . chr(13);
                $xml .= '<valorcont>' . $cnt["valorcont"] . '</valorcont>' . chr(13);
                $xml .= '<valorcontpag>' . $cnt["valorcontpag"] . '</valorcontpag>' . chr(13);
                $xml .= '<indcump>' . $cnt["indcump"] . '</indcump>' . chr(13);
                $xml .= '<estadocont>' . $cnt["estadocont"] . '</estadocont>' . chr(13);
                $xml .= '<motivoter>' . $cnt["motivoter"] . '</motivoter>' . chr(13);
                $xml .= '<motivoces>' . $cnt["motivoces"] . '</motivoces>' . chr(13);
                $xml .= '<observaciones>' . $cnt["observaciones"] . '</observaciones>' . chr(13);
                $xml .= '<numlibro>' . $cnt["numlibro"] . '</numlibro>' . chr(13);
                $xml .= '<numreglib>' . $cnt["numreglib"] . '</numreglib>' . chr(13);
                $xml .= '<fecreglib>' . $cnt["fecreglib"] . '</fecreglib>' . chr(13);
                if (isset($cnt["clasificaciones"])) {
                    if (!empty($cnt["clasificaciones"])) {
                        foreach ($cnt["clasificaciones"] as $clasicon) {
                            $xml .= '<clasicon>' . $clasicon . '</clasicon>' . chr(13);
                        }
                    }
                }
                if (isset($cnt["unspsc"])) {
                    if (!empty($cnt["unspsc"])) {
                        foreach ($cnt["unspsc"] as $clasicon) {
                            $xml .= '<unspsc>' . $clasicon . '</unspsc>' . chr(13);
                        }
                    }
                }
                $xml .= '<codigocamaraorigen>' . $cnt["codigocamaraorigen"] . '</codigocamaraorigen>' . chr(13);
                $xml .= '<numregistrocamaraorigen>' . $cnt["numregistrocamaraorigen"] . '</numregistrocamaraorigen>' . chr(13);
                $xml .= '<fecregistrocamaraorigen>' . $cnt["fecregistrocamaraorigen"] . '</fecregistrocamaraorigen>' . chr(13);
                $xml .= '</contrato>' . chr(13);
            }

            foreach ($data["multas"] as $cnt) {

                if (!isset($cnt["isn"])) {
                    $cnt["isn"] = '';
                }
                if (!isset($cnt["codcamara"])) {
                    $cnt["codcamara"] = '';
                }
                if (!isset($cnt["numradic"])) {
                    $cnt["numradic"] = '';
                }
                if (!isset($cnt["fecradic"])) {
                    $cnt["fecradic"] = '';
                }
                if (!isset($cnt["horradic"])) {
                    $cnt["horradic"] = '';
                }
                if (!isset($cnt["fecreporte"])) {
                    $cnt["fecreporte"] = '';
                }
                if (!isset($cnt["nitentidad"])) {
                    $cnt["nitentidad"] = '';
                }
                if (!isset($cnt["nombreentidad"])) {
                    $cnt["nombreentidad"] = '';
                }
                if (!isset($cnt["idmunientidad"])) {
                    $cnt["idmunientidad"] = '';
                }
                if (!isset($cnt["divarea"])) {
                    $cnt["divarea"] = '';
                }
                if (!isset($cnt["idefun"])) {
                    $cnt["idefun"] = '';
                }
                if (!isset($cnt["nomfun"])) {
                    $cnt["nomfun"] = '';
                }
                if (!isset($cnt["carfun"])) {
                    $cnt["carfun"] = '';
                }
                if (!isset($cnt["numcontrato"])) {
                    $cnt["numcontrato"] = '';
                }
                if (!isset($cnt["numcontratosecop"])) {
                    $cnt["numcontratosecop"] = '';
                }
                if (!isset($cnt["numacto"])) {
                    $cnt["numacto"] = '';
                }
                if (!isset($cnt["fechaacto"])) {
                    $cnt["fechaacto"] = '';
                }
                if (!isset($cnt["fechaeje"])) {
                    $cnt["fechaeje"] = '';
                }
                if (!isset($cnt["valormult"])) {
                    $cnt["valormult"] = '';
                }
                if (!isset($cnt["valormultpag"])) {
                    $cnt["valormultpag"] = '';
                }
                if (!isset($cnt["numsus"])) {
                    $cnt["numsus"] = '';
                }
                if (!isset($cnt["fechasus"])) {
                    $cnt["fechasus"] = '';
                }
                if (!isset($cnt["numconf"])) {
                    $cnt["numconf"] = '';
                }
                if (!isset($cnt["fechaconf"])) {
                    $cnt["fechaconf"] = '';
                }
                if (!isset($cnt["estadomult"])) {
                    $cnt["estadomult"] = '';
                }
                if (!isset($cnt["numrev"])) {
                    $cnt["numrev"] = '';
                }
                if (!isset($cnt["fechanumrev"])) {
                    $cnt["fechanumrev"] = '';
                }
                if (!isset($cnt["numlibro"])) {
                    $cnt["numlibro"] = '';
                }
                if (!isset($cnt["numreglib"])) {
                    $cnt["numreglib"] = '';
                }
                if (!isset($cnt["fecreglib"])) {
                    $cnt["fecreglib"] = '';
                }
                if (!isset($cnt["codigocamaraorigen"])) {
                    $cnt["codigocamaraorigen"] = '';
                }
                if (!isset($cnt["numregistrocamaraorigen"])) {
                    $cnt["numregistrocamaraorigen"] = '';
                }
                if (!isset($cnt["fecregistrocamaraorigen"])) {
                    $cnt["fecregistrocamaraorigen"] = '';
                }


                $xml .= '<multa>' . chr(13);
                $xml .= '<isn>' . $cnt["isn"] . '</isn>' . chr(13);
                $xml .= '<codcamara>' . $cnt["codcamara"] . '</codcamara>' . chr(13);
                $xml .= '<numradic>' . $cnt["numradic"] . '</numradic>' . chr(13);
                $xml .= '<fecradic>' . $cnt["fecradic"] . '</fecradic>' . chr(13);
                $xml .= '<horradic>' . $cnt["horradic"] . '</horradic>' . chr(13);
                $xml .= '<fecreporte>' . $cnt["fecreporte"] . '</fecreporte>' . chr(13);
                $xml .= '<nitentidad>' . $cnt["nitentidad"] . '</nitentidad>' . chr(13);
                $xml .= '<nombreentidad>' . $cnt["nombreentidad"] . '</nombreentidad>' . chr(13);
                $xml .= '<idmunientidad>' . $cnt["idmunientidad"] . '</idmunientidad>' . chr(13);
                $xml .= '<divarea>' . $cnt["divarea"] . '</divarea>' . chr(13);
                $xml .= '<idefun>' . $cnt["idefun"] . '</idefun>' . chr(13);
                $xml .= '<nomfun>' . $cnt["nomfun"] . '</nomfun>' . chr(13);
                $xml .= '<carfun>' . $cnt["carfun"] . '</carfun>' . chr(13);
                $xml .= '<numcontrato>' . $cnt["numcontrato"] . '</numcontrato>' . chr(13);
                $xml .= '<numcontratosecop>' . $cnt["numcontratosecop"] . '</numcontratosecop>' . chr(13);
                $xml .= '<numacto>' . $cnt["numacto"] . '</numacto>' . chr(13);
                $xml .= '<fechaacto>' . $cnt["fechaacto"] . '</fechaacto>' . chr(13);
                $xml .= '<fechaeje>' . $cnt["fechaeje"] . '</fechaeje>' . chr(13);
                $xml .= '<valormult>' . $cnt["valormult"] . '</valormult>' . chr(13);
                $xml .= '<valormultpag>' . $cnt["valormultpag"] . '</valormultpag>' . chr(13);
                $xml .= '<numsus>' . $cnt["numsus"] . '</numsus>' . chr(13);
                $xml .= '<fechasus>' . $cnt["fechasus"] . '</fechasus>' . chr(13);
                $xml .= '<numconf>' . $cnt["numconf"] . '</numconf>' . chr(13);
                $xml .= '<fechaconf>' . $cnt["fechaconf"] . '</fechaconf>' . chr(13);
                $xml .= '<estadomult>' . $cnt["estadomult"] . '</estadomult>' . chr(13);
                $xml .= '<numrev>' . $cnt["numrev"] . '</numrev>' . chr(13);
                $xml .= '<fechanumrev>' . $cnt["fechanumrev"] . '</fechanumrev>' . chr(13);
                $xml .= '<numlibro>' . $cnt["numlibro"] . '</numlibro>' . chr(13);
                $xml .= '<numreglib>' . $cnt["numreglib"] . '</numreglib>' . chr(13);
                $xml .= '<fecreglib>' . $cnt["fecreglib"] . '</fecreglib>' . chr(13);
                $xml .= '<codigocamaraorigen>' . $cnt["codigocamaraorigen"] . '</codigocamaraorigen>' . chr(13);
                $xml .= '<numregistrocamaraorigen>' . $cnt["numregistrocamaraorigen"] . '</numregistrocamaraorigen>' . chr(13);
                $xml .= '<fecregistrocamaraorigen>' . $cnt["fecregistrocamaraorigen"] . '</fecregistrocamaraorigen>' . chr(13);
                $xml .= '</multa>' . chr(13);
            }

            foreach ($data["sanciones"] as $cnt) {
                if (!isset($cnt["isn"])) {
                    $cnt["isn"] = '';
                }
                if (!isset($cnt["codcamara"])) {
                    $cnt["codcamara"] = '';
                }
                if (!isset($cnt["numradic"])) {
                    $cnt["numradic"] = '';
                }
                if (!isset($cnt["fecradic"])) {
                    $cnt["fecradic"] = '';
                }
                if (!isset($cnt["horradic"])) {
                    $cnt["horradic"] = '';
                }
                if (!isset($cnt["fecreporte"])) {
                    $cnt["fecreporte"] = '';
                }
                if (!isset($cnt["nitentidad"])) {
                    $cnt["nitentidad"] = '';
                }
                if (!isset($cnt["nombreentidad"])) {
                    $cnt["nombreentidad"] = '';
                }
                if (!isset($cnt["idmunientidad"])) {
                    $cnt["idmunientidad"] = '';
                }
                if (!isset($cnt["divarea"])) {
                    $cnt["divarea"] = '';
                }
                if (!isset($cnt["idefun"])) {
                    $cnt["idefun"] = '';
                }
                if (!isset($cnt["nomfun"])) {
                    $cnt["nomfun"] = '';
                }
                if (!isset($cnt["carfun"])) {
                    $cnt["carfun"] = '';
                }
                if (!isset($cnt["numcontrato"])) {
                    $cnt["numcontrato"] = '';
                }
                if (!isset($cnt["numcontratosecop"])) {
                    $cnt["numcontratosecop"] = '';
                }
                if (!isset($cnt["numacto"])) {
                    $cnt["numacto"] = '';
                }
                if (!isset($cnt["fechaacto"])) {
                    $cnt["fechaacto"] = '';
                }
                if (!isset($cnt["fechaeje"])) {
                    $cnt["fechaeje"] = '';
                }
                if (!isset($cnt["numsus"])) {
                    $cnt["numsus"] = '';
                }
                if (!isset($cnt["fechasus"])) {
                    $cnt["fechasus"] = '';
                }
                if (!isset($cnt["numconf"])) {
                    $cnt["numconf"] = '';
                }
                if (!isset($cnt["fechaconf"])) {
                    $cnt["fechaconf"] = '';
                }
                if (!isset($cnt["estadosanc"])) {
                    $cnt["estadosanc"] = '';
                }
                if (!isset($cnt["condinc"])) {
                    $cnt["condinc"] = '';
                }
                if (!isset($cnt["cumsanc"])) {
                    $cnt["cumsanc"] = '';
                }
                if (!isset($cnt["numrev"])) {
                    $cnt["numrev"] = '';
                }
                if (!isset($cnt["fechanumrev"])) {
                    $cnt["fechanumrev"] = '';
                }
                if (!isset($cnt["descripcion"])) {
                    $cnt["descripcion"] = '';
                }
                if (!isset($cnt["fundamento"])) {
                    $cnt["fundamento"] = '';
                }
                if (!isset($cnt["vigencia"])) {
                    $cnt["vigencia"] = '';
                }
                if (!isset($cnt["numlibro"])) {
                    $cnt["numlibro"] = '';
                }
                if (!isset($cnt["numreglib"])) {
                    $cnt["numreglib"] = '';
                }
                if (!isset($cnt["fecreglib"])) {
                    $cnt["fecreglib"] = '';
                }
                if (!isset($cnt["codigocamaraorigen"])) {
                    $cnt["codigocamaraorigen"] = '';
                }
                if (!isset($cnt["numregistrocamaraorigen"])) {
                    $cnt["numregistrocamaraorigen"] = '';
                }
                if (!isset($cnt["fecregistrocamaraorigen"])) {
                    $cnt["fecregistrocamaraorigen"] = '';
                }


                $xml .= '<sancion>' . chr(13);
                $xml .= '<isn>' . $cnt["isn"] . '</isn>' . chr(13);
                $xml .= '<codcamara>' . $cnt["codcamara"] . '</codcamara>' . chr(13);
                $xml .= '<numradic>' . $cnt["numradic"] . '</numradic>' . chr(13);
                $xml .= '<fecradic>' . $cnt["fecradic"] . '</fecradic>' . chr(13);
                $xml .= '<horradic>' . $cnt["horradic"] . '</horradic>' . chr(13);
                $xml .= '<fecreporte>' . $cnt["fecreporte"] . '</fecreporte>' . chr(13);
                $xml .= '<nitentidad>' . $cnt["nitentidad"] . '</nitentidad>' . chr(13);
                $xml .= '<nombreentidad>' . $cnt["nombreentidad"] . '</nombreentidad>' . chr(13);
                $xml .= '<idmunientidad>' . $cnt["idmunientidad"] . '</idmunientidad>' . chr(13);
                $xml .= '<divarea>' . $cnt["divarea"] . '</divarea>' . chr(13);
                $xml .= '<idefun>' . $cnt["idefun"] . '</idefun>' . chr(13);
                $xml .= '<nomfun>' . $cnt["nomfun"] . '</nomfun>' . chr(13);
                $xml .= '<carfun>' . $cnt["carfun"] . '</carfun>' . chr(13);
                $xml .= '<numcontrato>' . $cnt["numcontrato"] . '</numcontrato>' . chr(13);
                $xml .= '<numcontratosecop>' . $cnt["numcontratosecop"] . '</numcontratosecop>' . chr(13);
                $xml .= '<numacto>' . $cnt["numacto"] . '</numacto>' . chr(13);
                $xml .= '<fechaacto>' . $cnt["fechaacto"] . '</fechaacto>' . chr(13);
                $xml .= '<fechaeje>' . $cnt["fechaeje"] . '</fechaeje>' . chr(13);
                $xml .= '<numsus>' . $cnt["numsus"] . '</numsus>' . chr(13);
                $xml .= '<fechasus>' . $cnt["fechasus"] . '</fechasus>' . chr(13);
                $xml .= '<numconf>' . $cnt["numconf"] . '</numconf>' . chr(13);
                $xml .= '<fechaconf>' . $cnt["fechaconf"] . '</fechaconf>' . chr(13);
                $xml .= '<estadosanc>' . $cnt["estadosanc"] . '</estadosanc>' . chr(13);
                $xml .= '<condinc>' . $cnt["condinc"] . '</condinc>' . chr(13);
                $xml .= '<cumsanc>' . $cnt["cumsanc"] . '</cumsanc>' . chr(13);
                $xml .= '<numrev>' . $cnt["numrev"] . '</numrev>' . chr(13);
                $xml .= '<dessanc>' . $cnt["descripcion"] . '</dessanc>' . chr(13);
                $xml .= '<fundamento>' . $cnt["fundamento"] . '</fundamento>' . chr(13);
                $xml .= '<vigencia>' . $cnt["vigencia"] . '</vigencia>' . chr(13);
                $xml .= '<fechanumrev>' . $cnt["fechanumrev"] . '</fechanumrev>' . chr(13);
                $xml .= '<numlibro>' . $cnt["numlibro"] . '</numlibro>' . chr(13);
                $xml .= '<numreglib>' . $cnt["numreglib"] . '</numreglib>' . chr(13);
                $xml .= '<fecreglib>' . $cnt["fecreglib"] . '</fecreglib>' . chr(13);
                $xml .= '<codigocamaraorigen>' . $cnt["codigocamaraorigen"] . '</codigocamaraorigen>' . chr(13);
                $xml .= '<numregistrocamaraorigen>' . $cnt["numregistrocamaraorigen"] . '</numregistrocamaraorigen>' . chr(13);
                $xml .= '<fecregistrocamaraorigen>' . $cnt["fecregistrocamaraorigen"] . '</fecregistrocamaraorigen>' . chr(13);
                $xml .= '</sancion>' . chr(13);
            }

            foreach ($data["sandis"] as $cnt) {
                if (!isset($cnt["isn"])) {
                    $cnt["isn"] = '';
                }
                if (!isset($cnt["codcamara"])) {
                    $cnt["codcamara"] = '';
                }
                if (!isset($cnt["numradic"])) {
                    $cnt["numradic"] = '';
                }
                if (!isset($cnt["fecradic"])) {
                    $cnt["fecradic"] = '';
                }
                if (!isset($cnt["horradic"])) {
                    $cnt["horradic"] = '';
                }
                if (!isset($cnt["fecreporte"])) {
                    $cnt["fecreporte"] = '';
                }
                if (!isset($cnt["nitentidad"])) {
                    $cnt["nitentidad"] = '';
                }
                if (!isset($cnt["nombreentidad"])) {
                    $cnt["nombreentidad"] = '';
                }
                if (!isset($cnt["idmunientidad"])) {
                    $cnt["idmunientidad"] = '';
                }
                if (!isset($cnt["divarea"])) {
                    $cnt["divarea"] = '';
                }
                if (!isset($cnt["idefun"])) {
                    $cnt["idefun"] = '';
                }
                if (!isset($cnt["nomfun"])) {
                    $cnt["nomfun"] = '';
                }
                if (!isset($cnt["carfun"])) {
                    $cnt["carfun"] = '';
                }
                if (!isset($cnt["numcontratosecop"])) {
                    $cnt["numcontratosecop"] = '';
                }
                if (!isset($cnt["numacto"])) {
                    $cnt["numacto"] = '';
                }
                if (!isset($cnt["fechaacto"])) {
                    $cnt["fechaacto"] = '';
                }
                if (!isset($cnt["fechaeje"])) {
                    $cnt["fechaeje"] = '';
                }
                if (!isset($cnt["numsus"])) {
                    $cnt["numsus"] = '';
                }
                if (!isset($cnt["fechasus"])) {
                    $cnt["fechasus"] = '';
                }
                if (!isset($cnt["numconf"])) {
                    $cnt["numconf"] = '';
                }
                if (!isset($cnt["fechaconf"])) {
                    $cnt["fechaconf"] = '';
                }
                if (!isset($cnt["estadosanc"])) {
                    $cnt["estadosanc"] = '';
                }
                if (!isset($cnt["numrev"])) {
                    $cnt["numrev"] = '';
                }
                if (!isset($cnt["fechanumrev"])) {
                    $cnt["fechanumrev"] = '';
                }
                if (!isset($cnt["descripcion"])) {
                    $cnt["descripcion"] = '';
                }
                if (!isset($cnt["fundamento"])) {
                    $cnt["fundamento"] = '';
                }
                if (!isset($cnt["vigencia"])) {
                    $cnt["vigencia"] = '';
                }
                if (!isset($cnt["numlibro"])) {
                    $cnt["numlibro"] = '';
                }
                if (!isset($cnt["numreglib"])) {
                    $cnt["numreglib"] = '';
                }
                if (!isset($cnt["fecreglib"])) {
                    $cnt["fecreglib"] = '';
                }
                if (!isset($cnt["codigocamaraorigen"])) {
                    $cnt["codigocamaraorigen"] = '';
                }
                if (!isset($cnt["numregistrocamaraorigen"])) {
                    $cnt["numregistrocamaraorigen"] = '';
                }
                if (!isset($cnt["fecregistrocamaraorigen"])) {
                    $cnt["fecregistrocamaraorigen"] = '';
                }

                $xml .= '<sandis>' . chr(13);
                $xml .= '<isn>' . $cnt["isn"] . '</isn>' . chr(13);
                $xml .= '<codcamara>' . $cnt["codcamara"] . '</codcamara>' . chr(13);
                $xml .= '<numradic>' . $cnt["numradic"] . '</numradic>' . chr(13);
                $xml .= '<fecradic>' . $cnt["fecradic"] . '</fecradic>' . chr(13);
                $xml .= '<horradic>' . $cnt["horradic"] . '</horradic>' . chr(13);
                $xml .= '<fecreporte>' . $cnt["fecreporte"] . '</fecreporte>' . chr(13);
                $xml .= '<nitentidad>' . $cnt["nitentidad"] . '</nitentidad>' . chr(13);
                $xml .= '<nombreentidad>' . $cnt["nombreentidad"] . '</nombreentidad>' . chr(13);
                $xml .= '<idmunientidad>' . $cnt["idmunientidad"] . '</idmunientidad>' . chr(13);
                $xml .= '<divarea>' . $cnt["divarea"] . '</divarea>' . chr(13);
                $xml .= '<idefun>' . $cnt["idefun"] . '</idefun>' . chr(13);
                $xml .= '<nomfun>' . $cnt["nomfun"] . '</nomfun>' . chr(13);
                $xml .= '<carfun>' . $cnt["carfun"] . '</carfun>' . chr(13);
                $xml .= '<numcontratosecop>' . $cnt["numcontratosecop"] . '</numcontratosecop>' . chr(13);
                $xml .= '<numacto>' . $cnt["numacto"] . '</numacto>' . chr(13);
                $xml .= '<fechaacto>' . $cnt["fechaacto"] . '</fechaacto>' . chr(13);
                $xml .= '<fechaeje>' . $cnt["fechaeje"] . '</fechaeje>' . chr(13);
                $xml .= '<numsus>' . $cnt["numsus"] . '</numsus>' . chr(13);
                $xml .= '<fechasus>' . $cnt["fechasus"] . '</fechasus>' . chr(13);
                $xml .= '<numconf>' . $cnt["numconf"] . '</numconf>' . chr(13);
                $xml .= '<fechaconf>' . $cnt["fechaconf"] . '</fechaconf>' . chr(13);
                $xml .= '<estadosanc>' . $cnt["estadosanc"] . '</estadosanc>' . chr(13);
                $xml .= '<numrev>' . $cnt["numrev"] . '</numrev>' . chr(13);
                $xml .= '<dessanc>' . $cnt["descripcion"] . '</dessanc>' . chr(13);
                $xml .= '<fundamento>' . $cnt["fundamento"] . '</fundamento>' . chr(13);
                $xml .= '<vigencia>' . $cnt["vigencia"] . '</vigencia>' . chr(13);
                $xml .= '<fechanumrev>' . $cnt["fechanumrev"] . '</fechanumrev>' . chr(13);
                $xml .= '<numlibro>' . $cnt["numlibro"] . '</numlibro>' . chr(13);
                $xml .= '<numreglib>' . $cnt["numreglib"] . '</numreglib>' . chr(13);
                $xml .= '<fecreglib>' . $cnt["fecreglib"] . '</fecreglib>' . chr(13);
                $xml .= '<codigocamaraorigen>' . $cnt["codigocamaraorigen"] . '</codigocamaraorigen>' . chr(13);
                $xml .= '<numregistrocamaraorigen>' . $cnt["numregistrocamaraorigen"] . '</numregistrocamaraorigen>' . chr(13);
                $xml .= '<fecregistrocamaraorigen>' . $cnt["fecregistrocamaraorigen"] . '</fecregistrocamaraorigen>' . chr(13);
                $xml .= '</sancion>' . chr(13);
            }

            $xml .= '</expediente>' . chr(13);
            $xml .= '</expedientes>' . chr(13);
            return $xml;
        }

        //
        if (!isset($_SESSION["formulario"]["tipotramite"])) {
            $_SESSION["formulario"]["tipotramite"] = '';
        }
        if (!isset($_SESSION["formulario"]["numerorecuperacion"])) {
            $_SESSION["formulario"]["numerorecuperacion"] = '';
        }
        if (!isset($_SESSION["formulario"]["liquidacion"])) {
            $_SESSION["formulario"]["liquidacion"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["tamanoempresa"])) {
            $_SESSION["formulario"]["datos"]["tamanoempresa"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["emprendedor28"])) {
            $_SESSION["formulario"]["datos"]["emprendedor28"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["pemprendedor28"])) {
            $_SESSION["formulario"]["datos"]["pemprendedor28"] = 0;
        }
        if (!isset($_SESSION["formulario"]["datos"]["vigcontrol"])) {
            $_SESSION["formulario"]["datos"]["vigcontrol"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["fechatermestudios"])) {
            $_SESSION["formulario"]["datos"]["fechatermestudios"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["celcom"])) {
            $_SESSION["formulario"]["datos"]["celcom"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["celnot"])) {
            $_SESSION["formulario"]["datos"]["celnot"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["idtipoidentificacion"])) {
            $_SESSION["formulario"]["datos"]["idtipoidentificacion"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["certificardesde"])) {
            $_SESSION["formulario"]["datos"]["certificardesde"] = '';
        }

        //
        if (!isset($_SESSION["formulario"]["cambidom_idmunicipioorigen"])) {
            $_SESSION["formulario"]["cambidom_idmunicipioorigen"] = '';
        }
        if (!isset($_SESSION["formulario"]["cambidom_idmunicipiodestino"])) {
            $_SESSION["formulario"]["cambidom_idmunicipiodestino"] = '';
        }
        if (!isset($_SESSION["formulario"]["cambidom_fechaultimainscripcion"])) {
            $_SESSION["formulario"]["cambidom_fechaultimainscripcion"] = '';
        }
        if (!isset($_SESSION["formulario"]["cambidom_fechaultimarenovacion"])) {
            $_SESSION["formulario"]["cambidom_fechaultimarenovacion"] = '';
        }

        //
        if (!isset($_SESSION["formulario"]["datos"]["sitcontrol"])) {
            $_SESSION["formulario"]["datos"]["sitcontrol"] = array();
        }

        //
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_fechacorte"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_fechacorte"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_actcte"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_actcte"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_fijnet"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_fijnet"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_actotr"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_actotr"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_actval"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_actval"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_acttot"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_acttot"] = '';
        }

        //
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_pascte"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_pascte"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_paslar"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_paslar"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_pastot"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_pastot"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_patnet"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_patnet"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_paspat"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_paspat"] = '';
        }

        //
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_ingope"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_ingope"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_ingnoope"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_ingnoope"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_gasope"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_gasope"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_gasnoope"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_gasnoope"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_cosven"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_cosven"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_utinet"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_utinet"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_utiope"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_utiope"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_gasint"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_gasint"] = '';
        }

        //
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_indliq"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_indliq"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_nivend"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_nivend"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_razcob"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_razcob"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_renpat"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_renpat"] = '';
        }
        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_renact"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_renact"] = '';
        }

        //
        if (!isset($_SESSION["formulario"]["datos"]["clasi1510"])) {
            $_SESSION["formulario"]["datos"]["clasi1510"] = array();
        }

        //
        if (!isset($_SESSION["formulario"]["datos"]["exp1510"])) {
            $_SESSION["formulario"]["datos"]["exp1510"] = array();
        }

        //
        $xml .= '<tipotramite>' . trim($_SESSION["formulario"]["tipotramite"]) . '</tipotramite>' . chr(13);
        $xml .= '<numerorecuperacion>' . trim($_SESSION["formulario"]["numerorecuperacion"]) . '</numerorecuperacion>' . chr(13);
        $xml .= '<numeroliquidacion>' . trim($_SESSION["formulario"]["liquidacion"]) . '</numeroliquidacion>' . chr(13);
        $xml .= '<numeroradicacion>' . trim($_SESSION["formulario"]["numeroradicacion"]) . '</numeroradicacion>' . chr(13);
        $xml .= '<proponente>' . ltrim($_SESSION["formulario"]["datos"]["proponente"], '0') . '</proponente>' . chr(13);
        $xml .= '<matricula>' . ltrim($_SESSION["formulario"]["datos"]["matricula"], '0') . '</matricula>' . chr(13);
        $xml .= '<nombre><![CDATA[' . \funcionesGenerales::reemplazarEspeciales(trim($_SESSION["formulario"]["datos"]["nombre"])) . ']]></nombre>' . chr(13);
        $xml .= '<ape1><![CDATA[' . \funcionesGenerales::reemplazarEspeciales(trim($_SESSION["formulario"]["datos"]["ape1"])) . ']]></ape1>' . chr(13);
        $xml .= '<ape2><![CDATA[' . \funcionesGenerales::reemplazarEspeciales(trim($_SESSION["formulario"]["datos"]["ape2"])) . ']]></ape2>' . chr(13);
        $xml .= '<nom1><![CDATA[' . \funcionesGenerales::reemplazarEspeciales(trim($_SESSION["formulario"]["datos"]["nom1"])) . ']]></nom1>' . chr(13);
        $xml .= '<nom2><![CDATA[' . \funcionesGenerales::reemplazarEspeciales(trim($_SESSION["formulario"]["datos"]["nom2"])) . ']]></nom2>' . chr(13);
        $xml .= '<sigla><![CDATA[' . \funcionesGenerales::reemplazarEspeciales(trim($_SESSION["formulario"]["datos"]["sigla"])) . ']]></sigla>' . chr(13);
        $xml .= '<idtipoidentificacion>' . $_SESSION["formulario"]["datos"]["idtipoidentificacion"] . '</idtipoidentificacion>' . chr(13);
        $xml .= '<identificacion>' . ltrim($_SESSION["formulario"]["datos"]["identificacion"], '0') . '</identificacion>' . chr(13);
        $xml .= '<idpaisidentificacion>' . $_SESSION["formulario"]["datos"]["idpaisidentificacion"] . '</idpaisidentificacion>' . chr(13);
        $xml .= '<nit>' . ltrim($_SESSION["formulario"]["datos"]["nit"], '0') . '</nit>' . chr(13);
        $xml .= '<nacionalidad><![CDATA[' . trim($_SESSION["formulario"]["datos"]["nacionalidad"]) . ']]></nacionalidad>' . chr(13);
        $xml .= '<organizacion>' . $_SESSION["formulario"]["datos"]["organizacion"] . '</organizacion>' . chr(13);
        $xml .= '<tamanoempresa>' . $_SESSION["formulario"]["datos"]["tamanoempresa"] . '</tamanoempresa>' . chr(13);
        $xml .= '<emprendedor28>' . $_SESSION["formulario"]["datos"]["emprendedor28"] . '</emprendedor28>' . chr(13);
        $xml .= '<pemprendedor28>' . $_SESSION["formulario"]["datos"]["pemprendedor28"] . '</pemprendedor28>' . chr(13);
        $xml .= '<vigcontrol>' . $_SESSION["formulario"]["datos"]["vigcontrol"] . '</vigcontrol>' . chr(13);
        $xml .= '<idestadoproponente>' . $_SESSION["formulario"]["datos"]["idestadoproponente"] . '</idestadoproponente>' . chr(13);
        $xml .= '<certificardesde>' . $_SESSION["formulario"]["datos"]["certificardesde"] . '</certificardesde>' . chr(13);
        $xml .= '<fechaultimainscripcion>' . $_SESSION["formulario"]["datos"]["fechaultimainscripcion"] . '</fechaultimainscripcion>' . chr(13);
        $xml .= '<fechaultimarenovacion>' . $_SESSION["formulario"]["datos"]["fechaultimarenovacion"] . '</fechaultimarenovacion>' . chr(13);
        $xml .= '<fechacancelacion>' . $_SESSION["formulario"]["datos"]["fechacancelacion"] . '</fechacancelacion>' . chr(13);

        // Cambio de domicilio
        $xml .= '<cambidom_idmunicipioorigen>' . $_SESSION["formulario"]["datos"]["cambidom_idmunicipioorigen"] . '</cambidom_idmunicipioorigen>' . chr(13);
        $xml .= '<cambidom_idmunicipiodestino>' . $_SESSION["formulario"]["datos"]["cambidom_idmunicipiodestino"] . '</cambidom_idmunicipiodestino>' . chr(13);
        $xml .= '<cambidom_fechaultimainscripcion>' . $_SESSION["formulario"]["datos"]["cambidom_fechaultimainscripcion"] . '</cambidom_fechaultimainscripcion>' . chr(13);
        $xml .= '<cambidom_fechaultimarenovacion>' . $_SESSION["formulario"]["datos"]["cambidom_fechaultimarenovacion"] . '</cambidom_fechaultimarenovacion>' . chr(13);
        if (isset($_SESSION["formulario"]["datos"]["propcamaraorigen"])) {
            $xml .= '<propcamaraorigen>' . $_SESSION["formulario"]["datos"]["propcamaraorigen"] . '</propcamaraorigen>' . chr(13);
        } else {
            $xml .= '<propcamaraorigen></propcamaraorigen>' . chr(13);
        }
        if (isset($_SESSION["formulario"]["datos"]["propcamaradestino"])) {
            $xml .= '<propcamaradestino>' . $_SESSION["formulario"]["datos"]["propcamaradestino"] . '</propcamaradestino>' . chr(13);
        } else {
            $xml .= '<propcamaradestino></propcamaradestino>' . chr(13);
        }

        // Datos de personer&iacute;a jur&iacute;dica
        $xml .= '<idtipodocperjur>' . $_SESSION["formulario"]["datos"]["idtipodocperjur"] . '</idtipodocperjur>' . chr(13); // A02
        $xml .= '<numdocperjur>' . $_SESSION["formulario"]["datos"]["numdocperjur"] . '</numdocperjur>' . chr(13); // A20
        $xml .= '<fecdocperjur>' . $_SESSION["formulario"]["datos"]["fecdocperjur"] . '</fecdocperjur>' . chr(13); // (D)
        $xml .= '<origendocperjur><![CDATA[' . $_SESSION["formulario"]["datos"]["origendocperjur"] . ']]></origendocperjur>' . chr(13); // A128
        $xml .= '<fechaconstitucion>' . $_SESSION["formulario"]["datos"]["fechaconstitucion"] . '</fechaconstitucion>' . chr(13); // (D)
        $xml .= '<fechavencimiento>' . $_SESSION["formulario"]["datos"]["fechavencimiento"] . '</fechavencimiento>' . chr(13); // (D)
        // Datos de ubicaci&oacute;n
        $xml .= '<dircom><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($_SESSION["formulario"]["datos"]["dircom"]) . ']]></dircom>' . chr(13); // A128
        $xml .= '<dircom_tipovia></dircom_tipovia>' . chr(13); //A5
        $xml .= '<dircom_numvia></dircom_numvia>' . chr(13); //A3
        $xml .= '<dircom_apevia></dircom_apevia>' . chr(13); //A5
        $xml .= '<dircom_orivia></dircom_orivia>' . chr(13); //A5
        $xml .= '<dircom_numcruce></dircom_numcruce>' . chr(13); //A3
        $xml .= '<dircom_apecruce></dircom_apecruce>' . chr(13); //A5
        $xml .= '<dircom_oricruce></dircom_oricruce>' . chr(13); //A5
        $xml .= '<dircom_numplaca></dircom_numplaca>' . chr(13); //A3
        $xml .= '<dircom_complemento><![CDATA[]]></dircom_complemento>' . chr(13); //A20
        $xml .= '<muncom>' . $_SESSION["formulario"]["datos"]["muncom"] . '</muncom>' . chr(13);
        $xml .= '<telcom1>' . $_SESSION["formulario"]["datos"]["telcom1"] . '</telcom1>' . chr(13);
        $xml .= '<telcom2>' . $_SESSION["formulario"]["datos"]["telcom2"] . '</telcom2>' . chr(13);
        $xml .= '<celcom>' . $_SESSION["formulario"]["datos"]["celcom"] . '</celcom>' . chr(13);
        $xml .= '<faxcom>' . $_SESSION["formulario"]["datos"]["faxcom"] . '</faxcom>' . chr(13);
        $xml .= '<emailcom><![CDATA[' . $_SESSION["formulario"]["datos"]["emailcom"] . ']]></emailcom>' . chr(13);
        $xml .= '<enviarint>' . $_SESSION["formulario"]["datos"]["enviarint"] . '</enviarint>' . chr(13);
        $xml .= '<dirnot><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($_SESSION["formulario"]["datos"]["dirnot"]) . ']]></dirnot>' . chr(13);
        $xml .= '<dirnot_tipovia></dirnot_tipovia>' . chr(13);
        $xml .= '<dirnot_numvia></dirnot_numvia>' . chr(13);
        $xml .= '<dirnot_apevia></dirnot_apevia>' . chr(13);
        $xml .= '<dirnot_orivia></dirnot_orivia>' . chr(13);
        $xml .= '<dirnot_numcruce></dirnot_numcruce>' . chr(13);
        $xml .= '<dirnot_apecruce></dirnot_apecruce>' . chr(13);
        $xml .= '<dirnot_oricruce></dirnot_oricruce>' . chr(13);
        $xml .= '<dirnot_numplaca></dirnot_numplaca>' . chr(13);
        $xml .= '<dirnot_complemento><![CDATA[]]></dirnot_complemento>' . chr(13);
        $xml .= '<munnot>' . $_SESSION["formulario"]["datos"]["munnot"] . '</munnot>' . chr(13);
        $xml .= '<telnot>' . $_SESSION["formulario"]["datos"]["telnot"] . '</telnot>' . chr(13);
        $xml .= '<telnot2>' . $_SESSION["formulario"]["datos"]["telnot2"] . '</telnot2>' . chr(13);
        $xml .= '<celnot>' . $_SESSION["formulario"]["datos"]["celnot"] . '</celnot>' . chr(13);
        $xml .= '<faxnot>' . $_SESSION["formulario"]["datos"]["faxnot"] . '</faxnot>' . chr(13);
        $xml .= '<emailnot><![CDATA[' . $_SESSION["formulario"]["datos"]["emailnot"] . ']]></emailnot>' . chr(13);
        $xml .= '<enviarnot>' . $_SESSION["formulario"]["datos"]["enviarnot"] . '</enviarnot>' . chr(13);


        // Representantes legales
        $xml .= '<representanteslegales>' . chr(13);
        if (!empty($_SESSION["formulario"]["datos"]["representanteslegales"])) {
            foreach ($_SESSION["formulario"]["datos"]["representanteslegales"] as $rep) {
                $xml .= '<representantelegal>' . chr(13);
                $xml .= '<idtipoidentificacionrepleg>' . $rep["idtipoidentificacionrepleg"] . "</idtipoidentificacionrepleg>";
                $xml .= '<identificacionrepleg>' . $rep["identificacionrepleg"] . "</identificacionrepleg>";
                $xml .= '<nombrerepleg><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($rep["nombrerepleg"]) . "]]></nombrerepleg>";
                $xml .= '<cargorepleg><![CDATA[' . \funcionesGenerales::reemplazarEspeciales($rep["cargorepleg"]) . "]]></cargorepleg>";
                $xml .= '</representantelegal>' . chr(13);
            }
        }
        $xml .= '</representanteslegales>' . chr(13);


        // Facultades
        if (isset($_SESSION["formulario"]["datos"]["facultades"])) {
            $xml .= '<facultades><![CDATA[' . \funcionesGenerales::reemplazarEspeciales(trim($_SESSION["formulario"]["datos"]["facultades"])) . ']]></facultades>' . chr(13);
        } else {
            $_SESSION["formulario"]["datos"]["facultades"] = '';
            $xml .= '<facultades><![CDATA[' . \funcionesGenerales::reemplazarEspeciales(trim($_SESSION["formulario"]["datos"]["facultades"])) . ']]></facultades>' . chr(13);
        }


        // Situaciones de control
        if (!empty($_SESSION["formulario"]["datos"]["sitcontrol"])) {
            foreach ($_SESSION["formulario"]["datos"]["sitcontrol"] as $rep) {
                $xml .= '<sitcontrol>' . chr(13);
                $xml .= '<nombre><![CDATA[' . $rep["nombre"] . ']]></nombre>';
                $xml .= '<identificacion>' . $rep["identificacion"] . '</identificacion>';
                $xml .= '<domicilio>' . $rep["domicilio"] . '</domicilio>';
                $xml .= '<tipo>' . $rep["tipo"] . '</tipo>';
                $xml .= '</sitcontrol>' . chr(13);
            }
        }

        // Informacion financiera - Decreto 1510
        $xml .= '<inffin1510_fechacorte>' . $_SESSION["formulario"]["datos"]["inffin1510_fechacorte"] . '</inffin1510_fechacorte>' . chr(13);
        $xml .= '<inffin1510_actcte>' . $_SESSION["formulario"]["datos"]["inffin1510_actcte"] . '</inffin1510_actcte>' . chr(13);
        $xml .= '<inffin1510_actnocte>' . $_SESSION["formulario"]["datos"]["inffin1510_actnocte"] . '</inffin1510_actnocte>' . chr(13);
        $xml .= '<inffin1510_fijnet>' . $_SESSION["formulario"]["datos"]["inffin1510_fijnet"] . '</inffin1510_fijnet>' . chr(13);
        $xml .= '<inffin1510_actotr>' . $_SESSION["formulario"]["datos"]["inffin1510_actotr"] . '</inffin1510_actotr>' . chr(13);
        $xml .= '<inffin1510_actval>' . $_SESSION["formulario"]["datos"]["inffin1510_actval"] . '</inffin1510_actval>' . chr(13);
        $xml .= '<inffin1510_acttot>' . $_SESSION["formulario"]["datos"]["inffin1510_acttot"] . '</inffin1510_acttot>' . chr(13);

        $xml .= '<inffin1510_pascte>' . $_SESSION["formulario"]["datos"]["inffin1510_pascte"] . '</inffin1510_pascte>' . chr(13);
        $xml .= '<inffin1510_paslar>' . $_SESSION["formulario"]["datos"]["inffin1510_paslar"] . '</inffin1510_paslar>' . chr(13);
        $xml .= '<inffin1510_pastot>' . $_SESSION["formulario"]["datos"]["inffin1510_pastot"] . '</inffin1510_pastot>' . chr(13);
        $xml .= '<inffin1510_patnet>' . $_SESSION["formulario"]["datos"]["inffin1510_patnet"] . '</inffin1510_patnet>' . chr(13);
        $xml .= '<inffin1510_paspat>' . $_SESSION["formulario"]["datos"]["inffin1510_paspat"] . '</inffin1510_paspat>' . chr(13);
        $xml .= '<inffin1510_balsoc>' . $_SESSION["formulario"]["datos"]["inffin1510_balsoc"] . '</inffin1510_balsoc>' . chr(13);

        $xml .= '<inffin1510_ingope>' . $_SESSION["formulario"]["datos"]["inffin1510_ingope"] . '</inffin1510_ingope>' . chr(13);
        $xml .= '<inffin1510_ingnoope>' . $_SESSION["formulario"]["datos"]["inffin1510_ingnoope"] . '</inffin1510_ingnoope>' . chr(13);
        $xml .= '<inffin1510_gasope>' . $_SESSION["formulario"]["datos"]["inffin1510_gasope"] . '</inffin1510_gasope>' . chr(13);
        $xml .= '<inffin1510_gasnoope>' . $_SESSION["formulario"]["datos"]["inffin1510_gasnoope"] . '</inffin1510_gasnoope>' . chr(13);
        $xml .= '<inffin1510_cosven>' . $_SESSION["formulario"]["datos"]["inffin1510_cosven"] . '</inffin1510_cosven>' . chr(13);
        $xml .= '<inffin1510_utiope>' . $_SESSION["formulario"]["datos"]["inffin1510_utiope"] . '</inffin1510_utiope>' . chr(13);
        $xml .= '<inffin1510_utinet>' . $_SESSION["formulario"]["datos"]["inffin1510_utinet"] . '</inffin1510_utinet>' . chr(13);
        $xml .= '<inffin1510_gasint>' . $_SESSION["formulario"]["datos"]["inffin1510_gasint"] . '</inffin1510_gasint>' . chr(13);
        $xml .= '<inffin1510_gasimp>' . $_SESSION["formulario"]["datos"]["inffin1510_gasimp"] . '</inffin1510_gasimp>' . chr(13);

        $xml .= '<inffin1510_indliq>' . $_SESSION["formulario"]["datos"]["inffin1510_indliq"] . '</inffin1510_indliq>' . chr(13);
        $xml .= '<inffin1510_nivend>' . $_SESSION["formulario"]["datos"]["inffin1510_nivend"] . '</inffin1510_nivend>' . chr(13);
        $xml .= '<inffin1510_razcob>' . $_SESSION["formulario"]["datos"]["inffin1510_razcob"] . '</inffin1510_razcob>' . chr(13);
        $xml .= '<inffin1510_renpat>' . $_SESSION["formulario"]["datos"]["inffin1510_renpat"] . '</inffin1510_renpat>' . chr(13);
        $xml .= '<inffin1510_renact>' . $_SESSION["formulario"]["datos"]["inffin1510_renact"] . '</inffin1510_renact>' . chr(13);

        if (!isset($_SESSION["formulario"]["datos"]["inffin1510_gruponiif"])) {
            $_SESSION["formulario"]["datos"]["inffin1510_gruponiif"] = '';
        }
        $xml .= '<inffin1510_gruponiif>' . $_SESSION["formulario"]["datos"]["inffin1510_gruponiif"] . '</inffin1510_gruponiif>' . chr(13);

        // Experiencia decreto 1510
        $i = 0;
        if (isset($_SESSION["formulario"]["datos"]["exp1510"])) {
            if (count($_SESSION["formulario"]["datos"]["exp1510"]) > 0) {
                foreach ($_SESSION["formulario"]["datos"]["exp1510"] as $cnt) {
                    if (trim($cnt["nombrecontratante"]) != '') {
                        $i++;
                        $xml .= '<exp1510>';
                        if (strlen(ltrim(trim($cnt["secuencia"]), "0")) <= 3) {
                            $xml .= '<secuencia>' . sprintf("%03s", $cnt["secuencia"]) . '</secuencia>';
                        } else {
                            $xml .= '<secuencia>' . $cnt["secuencia"] . '</secuencia>';
                        }
                        $xml .= '<clavecontrato>' . $cnt["clavecontrato"] . '</clavecontrato>';
                        $xml .= '<celebradopor>' . $cnt["celebradopor"] . '</celebradopor>';
                        $xml .= '<nombrecontratista><![CDATA[' . (\funcionesGenerales::reemplazarEspeciales($cnt["nombrecontratista"])) . ']]></nombrecontratista>';
                        $xml .= '<nombrecontratante><![CDATA[' . (\funcionesGenerales::reemplazarEspeciales($cnt["nombrecontratante"])) . ']]></nombrecontratante>';
                        if (isset($cnt["fecejecucion"])) {
                            $xml .= '<fecejecucion>' . $cnt["fecejecucion"] . '</fecejecucion>';
                        } else {
                            $xml .= '<fecejecucion></fecejecucion>';
                        }
                        if (isset($cnt["valorpesos"])) {
                            $xml .= '<valorpesos>' . $cnt["valorpesos"] . '</valorpesos>';
                        } else {
                            $xml .= '<valorpesos></valorpesos>';
                        }
                        $xml .= '<valor>' . $cnt["valor"] . '</valor>';
                        $xml .= '<porcentaje>' . $cnt["porcentaje"] . '</porcentaje>';
                        if (isset($cnt["clasif"])) {
                            foreach ($cnt["clasif"] as $c) {
                                $xml .= '<clasif>' . trim($c) . '</clasif>';
                            }
                        }
                        $xml .= '<generardeclaracion>' . $cnt["generardeclaracion"] . '</generardeclaracion>' . chr(13);
                        $xml .= '</exp1510>';
                    }
                }
            }
        }

        //
        if (isset($_SESSION["formulario"]["datos"]["clasi1510"])) {
            asort($_SESSION["formulario"]["datos"]["clasi1510"]);
            foreach ($_SESSION["formulario"]["datos"]["clasi1510"] as $c) {
                $xml .= '<cla1510>' . trim($c) . '</cla1510>';
            }
        }


        // Bienes
        $xml .= '<bienes>';
        if (!empty($_SESSION["formulario"]["datos"]["bienes"])) {
            foreach ($_SESSION["formulario"]["datos"]["bienes"] as $bien) {
                $xml .= '<bien>';
                $xml .= '<matinmo>' . $bien["matinmo"] . '</matinmo>';
                $xml .= '<dir>' . $bien["dir"] . '</dir>';
                $xml .= '<barrio>' . $bien["barrio"] . '</barrio>';
                $xml .= '<muni>' . $bien["muni"] . '</muni>';
                $xml .= '<dpto>' . $bien["muni"] . '</dpto>';
                $xml .= '<pais>' . $bien["pais"] . '</pais>';
                $xml .= '</bien>';
            }
        }
        $xml .= '</bienes>';

        foreach ($_SESSION["formulario"]["datos"]["contratos"] as $cnt) {

            if (!isset($cnt["isn"])) {
                $cnt["isn"] = '';
            }
            if (!isset($cnt["codcamara"])) {
                $cnt["codcamara"] = '';
            }
            if (!isset($cnt["numradic"])) {
                $cnt["numradic"] = '';
            }
            if (!isset($cnt["fecradic"])) {
                $cnt["fecradic"] = '';
            }
            if (!isset($cnt["horradic"])) {
                $cnt["horradic"] = '';
            }
            if (!isset($cnt["fecreporte"])) {
                $cnt["fecreporte"] = '';
            }
            if (!isset($cnt["nitentidad"])) {
                $cnt["nitentidad"] = '';
            }
            if (!isset($cnt["nombreentidad"])) {
                $cnt["nombreentidad"] = '';
            }
            if (!isset($cnt["idmunientidad"])) {
                $cnt["idmunientidad"] = '';
            }
            if (!isset($cnt["divarea"])) {
                $cnt["divarea"] = '';
            }
            if (!isset($cnt["idefun"])) {
                $cnt["idefun"] = '';
            }
            if (!isset($cnt["nomfun"])) {
                $cnt["nomfun"] = '';
            }
            if (!isset($cnt["carfun"])) {
                $cnt["carfun"] = '';
            }
            if (!isset($cnt["numcontrato"])) {
                $cnt["numcontrato"] = '';
            }
            if (!isset($cnt["numcontratosecop"])) {
                $cnt["numcontratosecop"] = '';
            }

            if (!isset($cnt["fechaadj"])) {
                $cnt["fechaadj"] = '';
            }
            if (!isset($cnt["fechaper"])) {
                $cnt["fechaper"] = '';
            }
            if (!isset($cnt["fechaini"])) {
                $cnt["fechaini"] = '';
            }
            if (!isset($cnt["fechater"])) {
                $cnt["fechater"] = '';
            }
            if (!isset($cnt["fechaeje"])) {
                $cnt["fechaeje"] = '';
            }
            if (!isset($cnt["fechasus"])) {
                $cnt["fechasus"] = '';
            }
            if (!isset($cnt["fechaliq"])) {
                $cnt["fechaliq"] = '';
            }
            if (!isset($cnt["fechaterant"])) {
                $cnt["fechaterant"] = '';
            }
            if (!isset($cnt["fechaces"])) {
                $cnt["fechaces"] = '';
            }

            if (!isset($cnt["codigoact"])) {
                $cnt["codigoact"] = '';
            }
            if (!isset($cnt["ciiu1"])) {
                $cnt["ciiu1"] = '';
            }
            if (!isset($cnt["ciiu2"])) {
                $cnt["ciiu2"] = '';
            }
            if (!isset($cnt["ciiu3"])) {
                $cnt["ciiu3"] = '';
            }
            if (!isset($cnt["ciiu4"])) {
                $cnt["ciiu4"] = '';
            }
            if (!isset($cnt["objeto"])) {
                $cnt["objeto"] = '';
            }
            if (!isset($cnt["tipocont"])) {
                $cnt["tipocont"] = '';
            }
            if (!isset($cnt["valorcont"])) {
                $cnt["valorcont"] = '';
            }
            if (!isset($cnt["valorcontpag"])) {
                $cnt["valorcontpag"] = '';
            }
            if (!isset($cnt["indcump"])) {
                $cnt["indcump"] = '';
            }
            if (!isset($cnt["estadocont"])) {
                $cnt["estadocont"] = '';
            }
            if (!isset($cnt["motivoter"])) {
                $cnt["motivoter"] = '';
            }
            if (!isset($cnt["motivoces"])) {
                $cnt["motivoces"] = '';
            }
            if (!isset($cnt["observaciones"])) {
                $cnt["observaciones"] = '';
            }
            if (!isset($cnt["numlibro"])) {
                $cnt["numlibro"] = '';
            }
            if (!isset($cnt["numreglib"])) {
                $cnt["numreglib"] = '';
            }
            if (!isset($cnt["fecreglib"])) {
                $cnt["fecreglib"] = '';
            }
            if (!isset($cnt["codigocamaraorigen"])) {
                $cnt["codigocamaraorigen"] = '';
            }
            if (!isset($cnt["numregistrocamaraorigen"])) {
                $cnt["numregistrocamaraorigen"] = '';
            }
            if (!isset($cnt["fecregistrocamaraorigen"])) {
                $cnt["fecregistrocamaraorigen"] = '';
            }

            $xml .= '<contrato>' . chr(13);
            $xml .= '<isn>' . $cnt["isn"] . '</isn>' . chr(13);
            $xml .= '<codcamara>' . $cnt["codcamara"] . '</codcamara>' . chr(13);
            $xml .= '<numradic>' . $cnt["numradic"] . '</numradic>' . chr(13);
            $xml .= '<fecradic>' . $cnt["fecradic"] . '</fecradic>' . chr(13);
            $xml .= '<horradic>' . $cnt["horradic"] . '</horradic>' . chr(13);
            $xml .= '<fecreporte>' . $cnt["fecreporte"] . '</fecreporte>' . chr(13);
            $xml .= '<nitentidad>' . $cnt["nitentidad"] . '</nitentidad>' . chr(13);
            $xml .= '<nombreentidad>' . $cnt["nombreentidad"] . '</nombreentidad>' . chr(13);
            $xml .= '<idmunientidad>' . $cnt["idmunientidad"] . '</idmunientidad>' . chr(13);
            $xml .= '<divarea>' . $cnt["divarea"] . '</divarea>' . chr(13);
            $xml .= '<idefun>' . $cnt["idefun"] . '</idefun>' . chr(13);
            $xml .= '<nomfun>' . $cnt["nomfun"] . '</nomfun>' . chr(13);
            $xml .= '<carfun>' . $cnt["carfun"] . '</carfun>' . chr(13);
            $xml .= '<numcontrato>' . $cnt["numcontrato"] . '</numcontrato>' . chr(13);
            $xml .= '<numcontratosecop>' . $cnt["numcontratosecop"] . '</numcontratosecop>' . chr(13);
            $xml .= '<fechaadj>' . $cnt["fechaadj"] . '</fechaadj>' . chr(13);
            $xml .= '<fechaper>' . $cnt["fechaper"] . '</fechaper>' . chr(13);
            $xml .= '<fechaini>' . $cnt["fechaini"] . '</fechaini>' . chr(13);
            $xml .= '<fechater>' . $cnt["fechater"] . '</fechater>' . chr(13);
            $xml .= '<fechaeje>' . $cnt["fechaeje"] . '</fechaeje>' . chr(13);
            $xml .= '<fechaliq>' . $cnt["fechaliq"] . '</fechaliq>' . chr(13);
            $xml .= '<fechaterant>' . $cnt["fechaterant"] . '</fechaterant>' . chr(13);
            $xml .= '<fechaces>' . $cnt["fechaces"] . '</fechaces>' . chr(13);
            $xml .= '<codigoact>' . $cnt["codigoact"] . '</codigoact>' . chr(13);
            $xml .= '<ciiu1>' . $cnt["ciiu1"] . '</ciiu1>' . chr(13);
            $xml .= '<ciiu2>' . $cnt["ciiu2"] . '</ciiu2>' . chr(13);
            $xml .= '<ciiu3>' . $cnt["ciiu3"] . '</ciiu3>' . chr(13);
            $xml .= '<ciiu4>' . $cnt["ciiu4"] . '</ciiu4>' . chr(13);
            $xml .= '<tipocont>' . $cnt["tipocont"] . '</tipocont>' . chr(13);
            $xml .= '<valorcont>' . $cnt["valorcont"] . '</valorcont>' . chr(13);
            $xml .= '<valorcontpag>' . $cnt["valorcontpag"] . '</valorcontpag>' . chr(13);
            $xml .= '<indcump>' . $cnt["indcump"] . '</indcump>' . chr(13);
            $xml .= '<estadocont>' . $cnt["estadocont"] . '</estadocont>' . chr(13);
            $xml .= '<motivoter>' . $cnt["motivoter"] . '</motivoter>' . chr(13);
            $xml .= '<motivoces>' . $cnt["motivoces"] . '</motivoces>' . chr(13);
            $xml .= '<observaciones>' . $cnt["observaciones"] . '</observaciones>' . chr(13);
            $xml .= '<numlibro>' . $cnt["numlibro"] . '</numlibro>' . chr(13);
            $xml .= '<numreglib>' . $cnt["numreglib"] . '</numreglib>' . chr(13);
            $xml .= '<fecreglib>' . $cnt["fecreglib"] . '</fecreglib>' . chr(13);
            if (isset($cnt["clasificaciones"])) {
                if (!empty($cnt["clasificaciones"])) {
                    foreach ($cnt["clasificaciones"] as $clasicon) {
                        $xml .= '<clasicon>' . $clasicon . '</clasicon>' . chr(13);
                    }
                }
            }
            if (isset($cnt["unspsc"])) {
                if (!empty($cnt["unspsc"])) {
                    foreach ($cnt["unspsc"] as $clasicon) {
                        $xml .= '<unspsc>' . $clasicon . '</unspsc>' . chr(13);
                    }
                }
            }
            $xml .= '<codigocamaraorigen>' . $cnt["codigocamaraorigen"] . '</codigocamaraorigen>' . chr(13);
            $xml .= '<numregistrocamaraorigen>' . $cnt["numregistrocamaraorigen"] . '</numregistrocamaraorigen>' . chr(13);
            $xml .= '<fecregistrocamaraorigen>' . $cnt["fecregistrocamaraorigen"] . '</fecregistrocamaraorigen>' . chr(13);
            $xml .= '</contrato>' . chr(13);
        }

        foreach ($_SESSION["formulario"]["datos"]["multas"] as $cnt) {

            if (!isset($cnt["isn"])) {
                $cnt["isn"] = '';
            }
            if (!isset($cnt["codcamara"])) {
                $cnt["codcamara"] = '';
            }
            if (!isset($cnt["numradic"])) {
                $cnt["numradic"] = '';
            }
            if (!isset($cnt["fecradic"])) {
                $cnt["fecradic"] = '';
            }
            if (!isset($cnt["horradic"])) {
                $cnt["horradic"] = '';
            }
            if (!isset($cnt["fecreporte"])) {
                $cnt["fecreporte"] = '';
            }
            if (!isset($cnt["nitentidad"])) {
                $cnt["nitentidad"] = '';
            }
            if (!isset($cnt["nombreentidad"])) {
                $cnt["nombreentidad"] = '';
            }
            if (!isset($cnt["idmunientidad"])) {
                $cnt["idmunientidad"] = '';
            }
            if (!isset($cnt["divarea"])) {
                $cnt["divarea"] = '';
            }
            if (!isset($cnt["idefun"])) {
                $cnt["idefun"] = '';
            }
            if (!isset($cnt["nomfun"])) {
                $cnt["nomfun"] = '';
            }
            if (!isset($cnt["carfun"])) {
                $cnt["carfun"] = '';
            }
            if (!isset($cnt["numcontrato"])) {
                $cnt["numcontrato"] = '';
            }
            if (!isset($cnt["numcontratosecop"])) {
                $cnt["numcontratosecop"] = '';
            }
            if (!isset($cnt["numacto"])) {
                $cnt["numacto"] = '';
            }
            if (!isset($cnt["fechaacto"])) {
                $cnt["fechaacto"] = '';
            }
            if (!isset($cnt["fechaeje"])) {
                $cnt["fechaeje"] = '';
            }
            if (!isset($cnt["valormult"])) {
                $cnt["valormult"] = '';
            }
            if (!isset($cnt["valormultpag"])) {
                $cnt["valormultpag"] = '';
            }
            if (!isset($cnt["numsus"])) {
                $cnt["numsus"] = '';
            }
            if (!isset($cnt["fechasus"])) {
                $cnt["fechasus"] = '';
            }
            if (!isset($cnt["numconf"])) {
                $cnt["numconf"] = '';
            }
            if (!isset($cnt["fechaconf"])) {
                $cnt["fechaconf"] = '';
            }
            if (!isset($cnt["estadomult"])) {
                $cnt["estadomult"] = '';
            }
            if (!isset($cnt["numrev"])) {
                $cnt["numrev"] = '';
            }
            if (!isset($cnt["fechanumrev"])) {
                $cnt["fechanumrev"] = '';
            }
            if (!isset($cnt["numlibro"])) {
                $cnt["numlibro"] = '';
            }
            if (!isset($cnt["numreglib"])) {
                $cnt["numreglib"] = '';
            }
            if (!isset($cnt["fecreglib"])) {
                $cnt["fecreglib"] = '';
            }
            if (!isset($cnt["codigocamaraorigen"])) {
                $cnt["codigocamaraorigen"] = '';
            }
            if (!isset($cnt["numregistrocamaraorigen"])) {
                $cnt["numregistrocamaraorigen"] = '';
            }
            if (!isset($cnt["fecregistrocamaraorigen"])) {
                $cnt["fecregistrocamaraorigen"] = '';
            }


            $xml .= '<multa>' . chr(13);
            $xml .= '<isn>' . $cnt["isn"] . '</isn>' . chr(13);
            $xml .= '<codcamara>' . $cnt["codcamara"] . '</codcamara>' . chr(13);
            $xml .= '<numradic>' . $cnt["numradic"] . '</numradic>' . chr(13);
            $xml .= '<fecradic>' . $cnt["fecradic"] . '</fecradic>' . chr(13);
            $xml .= '<horradic>' . $cnt["horradic"] . '</horradic>' . chr(13);
            $xml .= '<fecreporte>' . $cnt["fecreporte"] . '</fecreporte>' . chr(13);
            $xml .= '<nitentidad>' . $cnt["nitentidad"] . '</nitentidad>' . chr(13);
            $xml .= '<nombreentidad>' . $cnt["nombreentidad"] . '</nombreentidad>' . chr(13);
            $xml .= '<idmunientidad>' . $cnt["idmunientidad"] . '</idmunientidad>' . chr(13);
            $xml .= '<divarea>' . $cnt["divarea"] . '</divarea>' . chr(13);
            $xml .= '<idefun>' . $cnt["idefun"] . '</idefun>' . chr(13);
            $xml .= '<nomfun>' . $cnt["nomfun"] . '</nomfun>' . chr(13);
            $xml .= '<carfun>' . $cnt["carfun"] . '</carfun>' . chr(13);
            $xml .= '<numcontrato>' . $cnt["numcontrato"] . '</numcontrato>' . chr(13);
            $xml .= '<numcontratosecop>' . $cnt["numcontratosecop"] . '</numcontratosecop>' . chr(13);
            $xml .= '<numacto>' . $cnt["numacto"] . '</numacto>' . chr(13);
            $xml .= '<fechaacto>' . $cnt["fechaacto"] . '</fechaacto>' . chr(13);
            $xml .= '<fechaeje>' . $cnt["fechaeje"] . '</fechaeje>' . chr(13);
            $xml .= '<valormult>' . $cnt["valormult"] . '</valormult>' . chr(13);
            $xml .= '<valormultpag>' . $cnt["valormultpag"] . '</valormultpag>' . chr(13);
            $xml .= '<numsus>' . $cnt["numsus"] . '</numsus>' . chr(13);
            $xml .= '<fechasus>' . $cnt["fechasus"] . '</fechasus>' . chr(13);
            $xml .= '<numconf>' . $cnt["numconf"] . '</numconf>' . chr(13);
            $xml .= '<fechaconf>' . $cnt["fechaconf"] . '</fechaconf>' . chr(13);
            $xml .= '<estadomult>' . $cnt["estadomult"] . '</estadomult>' . chr(13);
            $xml .= '<numrev>' . $cnt["numrev"] . '</numrev>' . chr(13);
            $xml .= '<fechanumrev>' . $cnt["fechanumrev"] . '</fechanumrev>' . chr(13);
            $xml .= '<numlibro>' . $cnt["numlibro"] . '</numlibro>' . chr(13);
            $xml .= '<numreglib>' . $cnt["numreglib"] . '</numreglib>' . chr(13);
            $xml .= '<fecreglib>' . $cnt["fecreglib"] . '</fecreglib>' . chr(13);
            $xml .= '<codigocamaraorigen>' . $cnt["codigocamaraorigen"] . '</codigocamaraorigen>' . chr(13);
            $xml .= '<numregistrocamaraorigen>' . $cnt["numregistrocamaraorigen"] . '</numregistrocamaraorigen>' . chr(13);
            $xml .= '<fecregistrocamaraorigen>' . $cnt["fecregistrocamaraorigen"] . '</fecregistrocamaraorigen>' . chr(13);
            $xml .= '</multa>' . chr(13);
        }

        foreach ($_SESSION["formulario"]["datos"]["sanciones"] as $cnt) {
            if (!isset($cnt["isn"])) {
                $cnt["isn"] = '';
            }
            if (!isset($cnt["codcamara"])) {
                $cnt["codcamara"] = '';
            }
            if (!isset($cnt["numradic"])) {
                $cnt["numradic"] = '';
            }
            if (!isset($cnt["fecradic"])) {
                $cnt["fecradic"] = '';
            }
            if (!isset($cnt["horradic"])) {
                $cnt["horradic"] = '';
            }
            if (!isset($cnt["fecreporte"])) {
                $cnt["fecreporte"] = '';
            }
            if (!isset($cnt["nitentidad"])) {
                $cnt["nitentidad"] = '';
            }
            if (!isset($cnt["nombreentidad"])) {
                $cnt["nombreentidad"] = '';
            }
            if (!isset($cnt["idmunientidad"])) {
                $cnt["idmunientidad"] = '';
            }
            if (!isset($cnt["divarea"])) {
                $cnt["divarea"] = '';
            }
            if (!isset($cnt["idefun"])) {
                $cnt["idefun"] = '';
            }
            if (!isset($cnt["nomfun"])) {
                $cnt["nomfun"] = '';
            }
            if (!isset($cnt["carfun"])) {
                $cnt["carfun"] = '';
            }
            if (!isset($cnt["numcontrato"])) {
                $cnt["numcontrato"] = '';
            }
            if (!isset($cnt["numcontratosecop"])) {
                $cnt["numcontratosecop"] = '';
            }
            if (!isset($cnt["numacto"])) {
                $cnt["numacto"] = '';
            }
            if (!isset($cnt["fechaacto"])) {
                $cnt["fechaacto"] = '';
            }
            if (!isset($cnt["fechaeje"])) {
                $cnt["fechaeje"] = '';
            }
            if (!isset($cnt["numsus"])) {
                $cnt["numsus"] = '';
            }
            if (!isset($cnt["fechasus"])) {
                $cnt["fechasus"] = '';
            }
            if (!isset($cnt["numconf"])) {
                $cnt["numconf"] = '';
            }
            if (!isset($cnt["fechaconf"])) {
                $cnt["fechaconf"] = '';
            }
            if (!isset($cnt["estadosanc"])) {
                $cnt["estadosanc"] = '';
            }
            if (!isset($cnt["condinc"])) {
                $cnt["condinc"] = '';
            }
            if (!isset($cnt["cumsanc"])) {
                $cnt["cumsanc"] = '';
            }
            if (!isset($cnt["numrev"])) {
                $cnt["numrev"] = '';
            }
            if (!isset($cnt["fechanumrev"])) {
                $cnt["fechanumrev"] = '';
            }
            if (!isset($cnt["descripcion"])) {
                $cnt["descripcion"] = '';
            }
            if (!isset($cnt["fundamento"])) {
                $cnt["fundamento"] = '';
            }
            if (!isset($cnt["vigencia"])) {
                $cnt["vigencia"] = '';
            }
            if (!isset($cnt["numlibro"])) {
                $cnt["numlibro"] = '';
            }
            if (!isset($cnt["numreglib"])) {
                $cnt["numreglib"] = '';
            }
            if (!isset($cnt["fecreglib"])) {
                $cnt["fecreglib"] = '';
            }
            if (!isset($cnt["codigocamaraorigen"])) {
                $cnt["codigocamaraorigen"] = '';
            }
            if (!isset($cnt["numregistrocamaraorigen"])) {
                $cnt["numregistrocamaraorigen"] = '';
            }
            if (!isset($cnt["fecregistrocamaraorigen"])) {
                $cnt["fecregistrocamaraorigen"] = '';
            }


            $xml .= '<sancion>' . chr(13);
            $xml .= '<isn>' . $cnt["isn"] . '</isn>' . chr(13);
            $xml .= '<codcamara>' . $cnt["codcamara"] . '</codcamara>' . chr(13);
            $xml .= '<numradic>' . $cnt["numradic"] . '</numradic>' . chr(13);
            $xml .= '<fecradic>' . $cnt["fecradic"] . '</fecradic>' . chr(13);
            $xml .= '<horradic>' . $cnt["horradic"] . '</horradic>' . chr(13);
            $xml .= '<fecreporte>' . $cnt["fecreporte"] . '</fecreporte>' . chr(13);
            $xml .= '<nitentidad>' . $cnt["nitentidad"] . '</nitentidad>' . chr(13);
            $xml .= '<nombreentidad>' . $cnt["nombreentidad"] . '</nombreentidad>' . chr(13);
            $xml .= '<idmunientidad>' . $cnt["idmunientidad"] . '</idmunientidad>' . chr(13);
            $xml .= '<divarea>' . $cnt["divarea"] . '</divarea>' . chr(13);
            $xml .= '<idefun>' . $cnt["idefun"] . '</idefun>' . chr(13);
            $xml .= '<nomfun>' . $cnt["nomfun"] . '</nomfun>' . chr(13);
            $xml .= '<carfun>' . $cnt["carfun"] . '</carfun>' . chr(13);
            $xml .= '<numcontrato>' . $cnt["numcontrato"] . '</numcontrato>' . chr(13);
            $xml .= '<numcontratosecop>' . $cnt["numcontratosecop"] . '</numcontratosecop>' . chr(13);
            $xml .= '<numacto>' . $cnt["numacto"] . '</numacto>' . chr(13);
            $xml .= '<fechaacto>' . $cnt["fechaacto"] . '</fechaacto>' . chr(13);
            $xml .= '<fechaeje>' . $cnt["fechaeje"] . '</fechaeje>' . chr(13);
            $xml .= '<numsus>' . $cnt["numsus"] . '</numsus>' . chr(13);
            $xml .= '<fechasus>' . $cnt["fechasus"] . '</fechasus>' . chr(13);
            $xml .= '<numconf>' . $cnt["numconf"] . '</numconf>' . chr(13);
            $xml .= '<fechaconf>' . $cnt["fechaconf"] . '</fechaconf>' . chr(13);
            $xml .= '<estadosanc>' . $cnt["estadosanc"] . '</estadosanc>' . chr(13);
            $xml .= '<condinc>' . $cnt["condinc"] . '</condinc>' . chr(13);
            $xml .= '<cumsanc>' . $cnt["cumsanc"] . '</cumsanc>' . chr(13);
            $xml .= '<numrev>' . $cnt["numrev"] . '</numrev>' . chr(13);
            $xml .= '<dessanc>' . $cnt["descripcion"] . '</dessanc>' . chr(13);
            $xml .= '<fundamento>' . $cnt["fundamento"] . '</fundamento>' . chr(13);
            $xml .= '<vigencia>' . $cnt["vigencia"] . '</vigencia>' . chr(13);
            $xml .= '<fechanumrev>' . $cnt["fechanumrev"] . '</fechanumrev>' . chr(13);
            $xml .= '<numlibro>' . $cnt["numlibro"] . '</numlibro>' . chr(13);
            $xml .= '<numreglib>' . $cnt["numreglib"] . '</numreglib>' . chr(13);
            $xml .= '<fecreglib>' . $cnt["fecreglib"] . '</fecreglib>' . chr(13);
            $xml .= '<codigocamaraorigen>' . $cnt["codigocamaraorigen"] . '</codigocamaraorigen>' . chr(13);
            $xml .= '<numregistrocamaraorigen>' . $cnt["numregistrocamaraorigen"] . '</numregistrocamaraorigen>' . chr(13);
            $xml .= '<fecregistrocamaraorigen>' . $cnt["fecregistrocamaraorigen"] . '</fecregistrocamaraorigen>' . chr(13);
            $xml .= '</sancion>' . chr(13);
        }

        foreach ($_SESSION["formulario"]["datos"]["sandis"] as $cnt) {
            if (!isset($cnt["isn"])) {
                $cnt["isn"] = '';
            }
            if (!isset($cnt["codcamara"])) {
                $cnt["codcamara"] = '';
            }
            if (!isset($cnt["numradic"])) {
                $cnt["numradic"] = '';
            }
            if (!isset($cnt["fecradic"])) {
                $cnt["fecradic"] = '';
            }
            if (!isset($cnt["horradic"])) {
                $cnt["horradic"] = '';
            }
            if (!isset($cnt["fecreporte"])) {
                $cnt["fecreporte"] = '';
            }
            if (!isset($cnt["nitentidad"])) {
                $cnt["nitentidad"] = '';
            }
            if (!isset($cnt["nombreentidad"])) {
                $cnt["nombreentidad"] = '';
            }
            if (!isset($cnt["idmunientidad"])) {
                $cnt["idmunientidad"] = '';
            }
            if (!isset($cnt["divarea"])) {
                $cnt["divarea"] = '';
            }
            if (!isset($cnt["idefun"])) {
                $cnt["idefun"] = '';
            }
            if (!isset($cnt["nomfun"])) {
                $cnt["nomfun"] = '';
            }
            if (!isset($cnt["carfun"])) {
                $cnt["carfun"] = '';
            }
            if (!isset($cnt["numcontratosecop"])) {
                $cnt["numcontratosecop"] = '';
            }
            if (!isset($cnt["numacto"])) {
                $cnt["numacto"] = '';
            }
            if (!isset($cnt["fechaacto"])) {
                $cnt["fechaacto"] = '';
            }
            if (!isset($cnt["fechaeje"])) {
                $cnt["fechaeje"] = '';
            }
            if (!isset($cnt["numsus"])) {
                $cnt["numsus"] = '';
            }
            if (!isset($cnt["fechasus"])) {
                $cnt["fechasus"] = '';
            }
            if (!isset($cnt["numconf"])) {
                $cnt["numconf"] = '';
            }
            if (!isset($cnt["fechaconf"])) {
                $cnt["fechaconf"] = '';
            }
            if (!isset($cnt["estadosanc"])) {
                $cnt["estadosanc"] = '';
            }
            if (!isset($cnt["numrev"])) {
                $cnt["numrev"] = '';
            }
            if (!isset($cnt["fechanumrev"])) {
                $cnt["fechanumrev"] = '';
            }
            if (!isset($cnt["descripcion"])) {
                $cnt["descripcion"] = '';
            }
            if (!isset($cnt["fundamento"])) {
                $cnt["fundamento"] = '';
            }
            if (!isset($cnt["vigencia"])) {
                $cnt["vigencia"] = '';
            }
            if (!isset($cnt["numlibro"])) {
                $cnt["numlibro"] = '';
            }
            if (!isset($cnt["numreglib"])) {
                $cnt["numreglib"] = '';
            }
            if (!isset($cnt["fecreglib"])) {
                $cnt["fecreglib"] = '';
            }
            if (!isset($cnt["codigocamaraorigen"])) {
                $cnt["codigocamaraorigen"] = '';
            }
            if (!isset($cnt["numregistrocamaraorigen"])) {
                $cnt["numregistrocamaraorigen"] = '';
            }
            if (!isset($cnt["fecregistrocamaraorigen"])) {
                $cnt["fecregistrocamaraorigen"] = '';
            }

            $xml .= '<sandis>' . chr(13);
            $xml .= '<isn>' . $cnt["isn"] . '</isn>' . chr(13);
            $xml .= '<codcamara>' . $cnt["codcamara"] . '</codcamara>' . chr(13);
            $xml .= '<numradic>' . $cnt["numradic"] . '</numradic>' . chr(13);
            $xml .= '<fecradic>' . $cnt["fecradic"] . '</fecradic>' . chr(13);
            $xml .= '<horradic>' . $cnt["horradic"] . '</horradic>' . chr(13);
            $xml .= '<fecreporte>' . $cnt["fecreporte"] . '</fecreporte>' . chr(13);
            $xml .= '<nitentidad>' . $cnt["nitentidad"] . '</nitentidad>' . chr(13);
            $xml .= '<nombreentidad>' . $cnt["nombreentidad"] . '</nombreentidad>' . chr(13);
            $xml .= '<idmunientidad>' . $cnt["idmunientidad"] . '</idmunientidad>' . chr(13);
            $xml .= '<divarea>' . $cnt["divarea"] . '</divarea>' . chr(13);
            $xml .= '<idefun>' . $cnt["idefun"] . '</idefun>' . chr(13);
            $xml .= '<nomfun>' . $cnt["nomfun"] . '</nomfun>' . chr(13);
            $xml .= '<carfun>' . $cnt["carfun"] . '</carfun>' . chr(13);
            $xml .= '<numcontratosecop>' . $cnt["numcontratosecop"] . '</numcontratosecop>' . chr(13);
            $xml .= '<numacto>' . $cnt["numacto"] . '</numacto>' . chr(13);
            $xml .= '<fechaacto>' . $cnt["fechaacto"] . '</fechaacto>' . chr(13);
            $xml .= '<fechaeje>' . $cnt["fechaeje"] . '</fechaeje>' . chr(13);
            $xml .= '<numsus>' . $cnt["numsus"] . '</numsus>' . chr(13);
            $xml .= '<fechasus>' . $cnt["fechasus"] . '</fechasus>' . chr(13);
            $xml .= '<numconf>' . $cnt["numconf"] . '</numconf>' . chr(13);
            $xml .= '<fechaconf>' . $cnt["fechaconf"] . '</fechaconf>' . chr(13);
            $xml .= '<estadosanc>' . $cnt["estadosanc"] . '</estadosanc>' . chr(13);
            $xml .= '<numrev>' . $cnt["numrev"] . '</numrev>' . chr(13);
            $xml .= '<dessanc>' . $cnt["descripcion"] . '</dessanc>' . chr(13);
            $xml .= '<fundamento>' . $cnt["fundamento"] . '</fundamento>' . chr(13);
            $xml .= '<vigencia>' . $cnt["vigencia"] . '</vigencia>' . chr(13);
            $xml .= '<fechanumrev>' . $cnt["fechanumrev"] . '</fechanumrev>' . chr(13);
            $xml .= '<numlibro>' . $cnt["numlibro"] . '</numlibro>' . chr(13);
            $xml .= '<numreglib>' . $cnt["numreglib"] . '</numreglib>' . chr(13);
            $xml .= '<fecreglib>' . $cnt["fecreglib"] . '</fecreglib>' . chr(13);
            $xml .= '<codigocamaraorigen>' . $cnt["codigocamaraorigen"] . '</codigocamaraorigen>' . chr(13);
            $xml .= '<numregistrocamaraorigen>' . $cnt["numregistrocamaraorigen"] . '</numregistrocamaraorigen>' . chr(13);
            $xml .= '<fecregistrocamaraorigen>' . $cnt["fecregistrocamaraorigen"] . '</fecregistrocamaraorigen>' . chr(13);
            $xml .= '</sancion>' . chr(13);
        }

        $xml .= '</expediente>' . chr(13);
        $xml .= '</expedientes>' . chr(13);
        return $xml;
    }

    public static function validarEstadoMatriculasRenovar($txt) {
        require_once ($_SESSION["generales"]["pathabsoluto"] . '/api/funcionesGenerales.php');
        require_once ($_SESSION["generales"]["pathabsoluto"] . '/api/mysqli.php');
        if ($txt != '') {
            $lista = explode(',', $txt);
            $canceladas = 0;
            $aldia = 0;
            $in = '';
            $inx = '';
            foreach ($lista as $l) {
                $lx = explode('-', $l);
                if (isset($lx[1])) {
                    $ly = ltrim($lx[1], "0");
                } else {
                    $ly = ltrim($l, "0");
                }
                if ($in != '') {
                    $in .= ',';
                }
                $in .= "'" . $ly . "'";
                $inx = $ly . ' ';
            }
            $arrTem = retornarRegistrosMysqliApi(null, 'mreg_est_inscritos', "matricula IN (" . $in . ")", "matricula");
            foreach ($arrTem as $t) {
                if ($t["ctrestmatricula"] != 'MA' && $t["ctrestmatricula"] != 'IA') {
                    $canceladas++;
                }
                if ($t["ultanoren"] == date("Y")) {
                    $aldia++;
                }
            }
            unset($arrTem);

            if ($canceladas == 0 && $aldia == 0) {
                return true;
            }
            if ($canceladas > 0) {
                $_SESSION["generales"]["mensajeerror"] = 'Alguna(s) de la(s) matr&iacute;cula(s) a renovar fue(ron) cancelada(s) en fecha posterior a la elaboraci&oacute;n de la liquidación (' . $txt . ')';
                return false;
            }
            if ($aldia > 0) {
                $_SESSION["generales"]["mensajeerror"] = 'Alguna(s) de la(s) matr&iacute;cula(s) a renovar fue(ron) renovadas en fecha posterior a la elaboraci&oacute;n de la liquidación (' . $txt . ')';
                return false;
            }
        } else {
            return true;
        }
    }

    public static function consultarSaldoAfiliadoMysqliApi($mysqli = null, $matricula) {
        require_once ($_SESSION["generales"]["pathabsoluto"] . '/api/funcionesGenerales.php');
        require_once ($_SESSION["generales"]["pathabsoluto"] . '/api/mysqli.php');

        //
        $formaCalculoAfiliacion = retornarClaveValorMysqliApi($mysqli, '90.01.60');

        $salida = array(
            'valorultpagoafi' => 0,
            'fechaultpagoafi' => '',
            'pago' => 0,
            'cupo' => 0
        );

        //
        $arrSerAfil = retornarRegistrosMysqliApi($mysqli, "mreg_servicios", "grupoventas='02'", "idservicio");
        $Servicios = "";
        $ServiciosAfiliacion = array();
        foreach ($arrSerAfil as $ServAfil) {
            if ($Servicios != '') {
                $Servicios .= ",";
            }
            $Servicios .= "'" . $ServAfil["idservicio"] . "'";
            $ServiciosAfiliacion[] = $ServAfil["idservicio"];
        }

        //
        $arrFecValAfi = retornarRegistroMysqliApi($mysqli, 'mreg_est_recibos', "(matricula='" . $matricula . "' or expedienteafectado='" . $matricula . "') and servicio in (" . $Servicios . ") and ctranulacion = '0' and (substring(numerorecibo,1,1)='R' or substring(numerorecibo,1,1)='S') order by fecoperacion desc limit 1");
        $salida["valorultpagoafi"] = $arrFecValAfi["valor"];
        $salida["fechaultpagoafi"] = $arrFecValAfi["fecoperacion"];
        unset($arrFecValAfi);

        //
        $fecpagoafiliacion = '';
        $detalle = array();
        $iDetalle = 0;
        if (date("md") <= '0331') {
            $anox = date("Y") - 1;
            $feciniafi = (date("Y") - 1) . '0101';
        } else {
            $anox = date("Y");
            $feciniafi = date("Y") . '0101';
        }
        $inix = retornarRegistroMysqliApi($mysqli, 'mreg_saldos_afiliados_sirp', "ano='" . $anox . "' and matricula='" . $matricula . "'");
        if ($inix && !empty($inix)) {
            $iDetalle++;
            $detalle[$iDetalle] = array(
                'tipo' => 'SaldoInicial-SIRP',
                'fecha' => $anox,
                'recibo' => '',
                'valor' => $inix["cupocargado"],
                'cupo' => $inix["cupocargado"] - $inix["cupoconsumido"]
            );
            $salida["cupo"] = $inix["cupocargado"] - $inix["cupoconsumido"];
        }

        //
        $arrRecs = retornarRegistrosMysqliApi($mysqli, 'mreg_est_recibos', "(matricula='" . $matricula . "' or expedienteafectado='" . $matricula . "') and ctranulacion = '0' and left(numerorecibo,1) IN ('H','G','R','S') and fecoperacion >= '" . $feciniafi . "'", "fecoperacion");
        if ($arrRecs && !empty($arrRecs)) {
            foreach ($arrRecs as $rx) {
                if (in_array($rx["servicio"], $ServiciosAfiliacion)) {
                    // Si se cambia de año en el pago, se reinicia el histórico e pagos
                    if (substr($rx["fecoperacion"], 0, 4) != substr($feciniafi, 0, 4)) {
                        $iDetalle = 0;
                        $detalle = array();
                        $salida["cupo"] = 0;
                        $salida["pago"] = 0;
                        $fecpagoafiliacion = '';
                    } else {
                        if ($fecpagoafiliacion == '') {
                            $fecpagoafiliacion = $rx["fecoperacion"];
                        }
                    }

                    //
                    $iDetalle++;
                    $detalle[$iDetalle] = array(
                        'tipo' => 'PagoAfiliación',
                        'fecha' => $rx["fecoperacion"],
                        'recibo' => $rx["numerorecibo"],
                        'valor' => $rx["valor"],
                        'cupo' => 0
                    );
                    $salida["pago"] = $salida["pago"] + $rx["valor"];
                    if ($formaCalculoAfiliacion != '') {
                        if ($formaCalculoAfiliacion == 'RANGO_VAL_AFI') {
                            $arrRan = retornarRegistrosMysqliApi($mysqli, 'mreg_rangos_cupo_afiliacion', "ano='" . date("Y") . "'", "orden");
                            foreach ($arrRan as $rx1) {
                                if ($rx1["minimo"] <= $salida["pago"] && $rx1["maximo"] >= $salida["pago"]) {
                                    $salida["cupo"] = $rx1["cupo"];
                                }
                            }
                            unset($arrRan);
                            unset($rx1);
                        } else {
                            $salida["cupo"] = round(doubleval($formaCalculoAfiliacion) * $salida["pago"], 0);
                        }
                    }
                    $detalle[$iDetalle]["cupo"] = $salida["cupo"];
                }
            }
            foreach ($arrRecs as $rx) {
                if (!in_array($rx["servicio"], $ServiciosAfiliacion)) {
                    if ($salida["cupo"] > 0) {
                        if ($rx["tipogasto"] == '1') {
                            if ($rx["fecoperacion"] >= $fecpagoafiliacion) {
                                if ($salida["cupo"] - $rx["valor"] >= 0) {
                                    $salida["cupo"] = $salida["cupo"] - $rx["valor"];
                                } else {
                                    $salida["cupo"] = 0;
                                }
                                $iDetalle++;
                                $detalle[$iDetalle] = array(
                                    'tipo' => 'Consumo',
                                    'fecha' => $rx["fecoperacion"],
                                    'recibo' => $rx["numerorecibo"],
                                    'valor' => $rx["valor"],
                                    'cupo' => $salida["cupo"]
                                );
                            }
                        }
                    }
                }
            }
        }

        return $detalle;
    }

    public static function consultarSaldoAfiliadoCantidadMysqliApi($mysqli = null, $matricula) {
        require_once ($_SESSION["generales"]["pathabsoluto"] . '/api/funcionesGenerales.php');
        require_once ($_SESSION["generales"]["pathabsoluto"] . '/api/mysqli.php');

        //
        $cupo = 0;

        //
        $arrSerAfil = retornarRegistrosMysqliApi($mysqli, "mreg_servicios", "grupoventas='02'", "idservicio");
        $Servicios = "";
        $ServiciosAfiliacion = array();
        foreach ($arrSerAfil as $ServAfil) {
            if ($Servicios != '') {
                $Servicios .= ",";
            }
            $Servicios .= "'" . $ServAfil["idservicio"] . "'";
            $ServiciosAfiliacion[] = $ServAfil["idservicio"];
        }

        //
        $arrFecValAfi = retornarRegistroMysqliApi($mysqli, 'mreg_est_recibos', "(matricula='" . $matricula . "' or expedienteafectado='" . $matricula . "') and servicio in (" . $Servicios . ") and ctranulacion = '0' and (substring(numerorecibo,1,1)='R' or substring(numerorecibo,1,1)='S') order by fecoperacion desc limit 1");
        $salida["valorultpagoafi"] = $arrFecValAfi["valor"];
        $salida["fechaultpagoafi"] = $arrFecValAfi["fecoperacion"];
        unset($arrFecValAfi);

        //
        $fecpagoafiliacion = '';
        $detalle = array();
        $iDetalle = 0;
        if (date("md") <= '0331') {
            $anox = date("Y") - 1;
            $feciniafi = (date("Y") - 1) . '0101';
        } else {
            $anox = date("Y");
            $feciniafi = date("Y") . '0101';
        }

        //
        $arrRecs = retornarRegistrosMysqliApi($mysqli, 'mreg_est_recibos', "(matricula='" . $matricula . "' or expedienteafectado='" . $matricula . "') and ctranulacion = '0' and left(numerorecibo,1) IN ('H','G','R','S') and fecoperacion >= '" . $feciniafi . "'", "fecoperacion");
        if ($arrRecs && !empty($arrRecs)) {
            foreach ($arrRecs as $rx) {
                if (in_array($rx["servicio"], $ServiciosAfiliacion)) {
                    // Si se cambia de año en el pago, se reinicia el histórico e pagos
                    if (substr($rx["fecoperacion"], 0, 4) != substr($feciniafi, 0, 4)) {
                        $iDetalle = 0;
                        $detalle = array();
                        $fecpagoafiliacion = '';
                    } else {
                        if ($fecpagoafiliacion == '') {
                            $fecpagoafiliacion = $rx["fecoperacion"];
                        }
                    }

                    //
                    $iDetalle++;
                    $detalle[$iDetalle] = array(
                        'tipo' => 'PagoAfiliación',
                        'fecha' => $rx["fecoperacion"],
                        'recibo' => $rx["numerorecibo"],
                        'valor' => $rx["valor"],
                        'cantidad' => CANTIDAD_CERTIFICADOS_CUPO_AFILIADO,
                        'cupo' => CANTIDAD_CERTIFICADOS_CUPO_AFILIADO
                    );
                    $cupo = CANTIDAD_CERTIFICADOS_CUPO_AFILIADO;
                }
            }
            foreach ($arrRecs as $rx) {
                if (!in_array($rx["servicio"], $ServiciosAfiliacion)) {
                    if ($cupo > 0) {
                        if ($rx["tipogasto"] == '1') {
                            if ($rx["fecoperacion"] >= $fecpagoafiliacion) {
                                if ($cupo - $rx["cantidad"] >= 0) {
                                    $cupo = $cupo - $rx["cantidad"];
                                } else {
                                    $cupo = 0;
                                }
                                $iDetalle++;
                                $detalle[$iDetalle] = array(
                                    'tipo' => 'Consumo',
                                    'fecha' => $rx["fecoperacion"],
                                    'recibo' => $rx["numerorecibo"],
                                    'valor' => $rx["valor"],
                                    'cantidad' => $rx["cantidad"],
                                    'cupo' => $cupo
                                );
                            }
                        }
                    }
                }
            }
        }

        return $detalle;
    }

    public static function evaluarArchivadorAsentarRecibo($idserv) {
        $archivador = '01';
        if (substr($idserv, 0, 6) == '010101') {
            $archivador = '01';
        }
        if (substr($idserv, 0, 6) == '010102') {
            $archivador = '02';
        }
        if (substr($idserv, 0, 6) == '010103') {
            $archivador = '03';
        }
        if (substr($idserv, 0, 6) == '010201') {
            $archivador = '01';
        }
        if (substr($idserv, 0, 6) == '010202') {
            $archivador = '01';
        }
        if (substr($idserv, 0, 6) == '010203' ||
                substr($idserv, 0, 6) == '010204' ||
                substr($idserv, 0, 6) == '010205' ||
                substr($idserv, 0, 6) == '010206') {
            $archivador = '02';
        }
        if (substr($idserv, 0, 6) >= '010301' &&
                substr($idserv, 0, 6) <= '010322') {
            $archivador = '01';
        }
        if (substr($idserv, 0, 6) >= '010351' &&
                substr($idserv, 0, 6) <= '010355') {
            $archivador = '03';
        }
        if (substr($idserv, 0, 8) == '01020208') {
            $archivador = '03';
        }
        if (substr($idserv, 0, 6) == '010501') {
            $archivador = '01';
        }
        if (substr($idserv, 0, 6) == '010502') {
            $archivador = '02';
        }
        if (substr($idserv, 0, 6) == '010503') {
            $archivador = '03';
        }
        return $archivador;
    }

    public static function generarEmailNotificacionInscripcionSipref($mysqli, $t) {
        $tiporeg = '';
        switch (substr($t["libro"], 0, 2)) {
            case "RM" :
            case "ME" :
                $tiporeg = 'REGISTRO PUBLICO MERCANTIL';
                if (substr($t["libro"], 2, 2) == '22') {
                    $tiporeg = 'REGISTRO DE COMERCIANTES QUE EJERCEN LA ACTIVIDAD DE APUESTAS Y JUEGOS DE AZAR';
                }
                break;
            case "RE" :
            case "ES" :
                $tiporeg = 'REGISTRO DE ENTIDADES SIN ANIMO DE LUCRO';
                if (substr($t["libro"], 2, 2) == '53') {
                    $tiporeg = 'REGISTRO DE LA ECONOMIA SOLIDARIA';
                }
                if (substr($t["libro"], 2, 2) == '54') {
                    $tiporeg = 'REGISTRO DE VEEDURIAS';
                }
                if (substr($t["libro"], 2, 2) == '55') {
                    $tiporeg = 'REGISTRO DE ENTIDADES SIN ANIMO DE LUCRO DE CAPITAL PRIVADO EXTRANJERO';
                }
                break;
        }

        //
        $msg = '';
        $msg .= 'LA ' . RAZONSOCIAL . ' le informa que el dia ' . \funcionesGenerales::mostrarFecha($t["fecharegistro"]) . ' a las ' . \funcionesGenerales::mostrarHora($t["horaregistro"]) . ' ';
        $msg .= 'fue inscrito en el ' . $tiporeg . ', en el libro ' . substr($t["libro"], 2, 2) . ' bajo el numero ' . $t["registro"] . ' la siguiente actuacion: <br><br>';

        if (trim($t["recibo"]) != '') {
            $msg .= 'Recibo de Caja No. ' . $t["recibo"] . '<br>';
        }
        if (trim($t["numerooperacion"]) != '') {
            $msg .= 'Numero Operacion: ' . $t["numerooperacion"] . '<br>';
        }
        if (ltrim($t["matricula"], "0") != '') {
            $msg .= 'Matricula: ' . $t["matricula"] . '<br>';
        }
        if (ltrim($t["identificacion"], "0") != '') {
            $msg .= 'Identificacion: ' . $t["identificacion"] . '<br>';
        }
        $msg .= 'Nombre: ' . utf8_decode($t["nombre"]) . '<br>';

        //
        $txtx = '';
        if (substr($t["libro"], 0, 2) == 'RM' || substr($t["libro"], 0, 2) == 'ME') {
            $txtx = 'Acto: ' . retornarRegistroMysqliApi($mysqli, 'mreg_actos', "idlibro='" . $t["libro"] . "' and idacto='" . $t["acto"] . "'", "nombre");
        }
        if (substr($t["libro"], 0, 2) == 'RE' || substr($t["libro"], 0, 2) == 'ES') {
            $txtx = 'Acto: ' . retornarRegistroMysqliApi($mysqli, 'mreg_actos', "idlibro='" . $t["libro"] . "' and idacto='" . $t["acto"] . "'", "nombre");
        }

        //
        $msg .= $txtx . '<br>';

        //
        $msg .= 'En el siguiente enlace podra encontrar el detalle de la inscripcion realizada: ';
        $msg .= '<a href="' . TIPO_HTTP . HTTP_HOST . '/scripts/mregConsultaNoticiaMercantil.php?accion=vernoticia&_empresa=' . $_SESSION["generales"]["codigoempresa"] . '&libro=' . $t["libro"] . '&inscripcion=' . $t["registro"] . '&dupli=' . $t["dupli"] . '&session_parameters=' . \funcionesGenerales::armarVariablesPantalla() . '">Ver inscripcion</a>';
        $msg .= '<br><br>';
        $msg .= 'Antes de proceder con la solicitud del certificado en la C&aacute;mara de Comercio le recomendamos validar en el siguiente enlace que ';
        $msg .= 'el radicado haya terminado su proceso de digitaci&oacute;n y control de calidad. ';
        $msg .= '<a href="' . TIPO_HTTP . HTTP_HOST . '/scripts/regConsultaRutaDocumentos.php?accion=traerruta&_empresa=' . $_SESSION["generales"]["codigoempresa"] . '&_recibo=' . $t["recibo"] . '&session_parameters=' . \funcionesGenerales::armarVariablesPantalla() . '">Verificar</a>';
        $msg .= '<br><br>';
        //
        if (!defined('NOTIFICAR_TELEFONO')) {
            define('NOTIFICAR_TELEFONO', 'NO');
        }
        if (NOTIFICAR_TELEFONO == 'SI') {
            $msg .= 'Para mayores informes por favor comunicarse al numero ';
            $msg .= TELEFONO_ATENCION_USUARIOS . ' en la ciudad de ' . retornarRegistroMysqliApi($mysqli, "bas_municipios", "codigomunicipio='" . MUNICIPIO . "'", "ciudad") . '.<br><br>';
        }
        $msg .= 'Este mensaje se envia en forma automatica por el Sistema de Registro de LA ' . RAZONSOCIAL . ' y tiene por objeto informar, ';
        $msg .= 'en cumplimiento a lo contemplado en el Codigo de Procedimiento Administrativo y de lo Contencioso Administrativo.';
        $msg .= '<br><br>';
        $msg .= 'Correo desatendido: Por favor no responda a la direccion de correo electronico que envia este mensaje, dicha cuenta ';
        $msg .= 'no es revisada por ningun funcionario de nuestra entidad. Este mensaje es informativo.';
        $msg .= '<br><br>';
        $msg .= 'Los acentos y tildes de este correo han sido omitidos intencionalmente con el objeto de evitar inconvenientes en la lectura del mismo.';
        return $msg;
    }

    public static function generarFormularioRenovacionRepositorio($dbx, $mat = '') {
        //
        $iForm = 0;
        $iEstab = 0;
        $iPpal = 0;

        //
        $_SESSION["formulario"]["datos"] = array();
        $_SESSION["formulario"]["datoshijos"] = array();
        $_SESSION["formulario"]["matriculashijos"] = array();
        $_SESSION["formulario"]["tipotramite"] = $_SESSION["tramite"]["tipotramite"];

        //
        $datPrincipal = array();
        $textoFirmadoDatPrincipal = '';
        $tramasha1DatPrincipal = '';

        $arrForms = retornarRegistrosMysqliApi($dbx, 'mreg_liquidaciondatos', "idliquidacion=" . $_SESSION["tramite"]["numeroliquidacion"], "id", "xml");
        // $arrForms = retornarLiquidacionDatosExpedienteArregloXml($_SESSION["tramite"]["numeroliquidacion"]);
        if (!empty($arrForms)) {
            foreach ($arrForms as $form) {

                $x = \funcionesGenerales::desserializarExpedienteMatricula($dbx, $form);

                // 2018-10-17: JINT: Para generarf formato de renovación de afiliacion
                if (defined('TIPO_DOC_FOR_AFILIACION') && TIPO_DOC_FOR_AFILIACION != '') {
                    if ($_SESSION["tramite"]["tipotramite"] == 'renovacionmatricula') {
                        if ($x["organizacion"] == '01' || $x["organizacion"] > '02') {
                            if ($x["afiliado"] == '1') {
                                $datPrincipal = $x;
                            }
                        }
                    }
                }

                if (
                        $x["organizacion"] == '01' ||
                        ($x["organizacion"] > '02' && $x["categoria"] == '1')
                ) {
                    $_SESSION["formulario"]["datos"] = $x;
                    $_SESSION["formulario"]["datos"]["fechaultimamodificacion"] = $_SESSION["tramite"]["fechaultimamodificacion"];
                    $iPpal++;
                } else {
                    $iEstab++;
                    $_SESSION["formulario"]["datoshijos"][$iEstab] = $x;
                    $_SESSION["formulario"]["datoshijos"][$iEstab]["fechaultimamodificacion"] = $_SESSION["tramite"]["fechaultimamodificacion"];
                }
                $iForm++;
            }


            if ($iForm > 0) {

                if ($iPpal > 0) {

                    $det = '';

                    if ($_SESSION["tramite"]["tipotramite"] == 'renovacionmatricula' ||
                            $_SESSION["tramite"]["tipotramite"] == 'renovacionesadl'
                    ) {
                        $det = 'FORMULARIO DE RENOVACION - MATRICULA NO. ' . ltrim($_SESSION["formulario"]["datos"]["matricula"], "0");
                    }

                    if ($_SESSION["tramite"]["tipotramite"] == 'matriculapnat' ||
                            $_SESSION["tramite"]["tipotramite"] == 'matriculaest' ||
                            $_SESSION["tramite"]["tipotramite"] == 'matriculapjur'
                    ) {
                        $det = 'FORMULARIO DE MATRICULA - MATRICULA NO. ' . ltrim($_SESSION["formulario"]["datos"]["matricula"], "0");
                    }

                    if ($_SESSION["tramite"]["tipotramite"] == 'matriculaesadl'
                    ) {
                        $det = 'FORMULARIO DE INSCRIPCION AL REG-ESADL - NO. ' . ltrim($_SESSION["formulario"]["datos"]["matricula"], "0");
                    }
                    $name = armarPdfPrincipalNuevo1082($dbx, $_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"], '');


                    if (count($_SESSION["formulario"]["datos"]["f"]) > 1) {
                        if (ACTIVAR_CIRCULAR_002_2016 == 'SI1') {
                            $name1 = armarPdfPrincipalNuevoAnosAnteriores1510($dbx, $_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"], '');
                        } else {
                            $name1 = armarPdfPrincipalNuevoAnosAnteriores1082($dbx, $_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"], '');
                        }
                        unirPdfs(array($_SESSION["generales"]["pathabsoluto"] . '/tmp/' . $name, $_SESSION["generales"]["pathabsoluto"] . '/tmp/' . $name1), $_SESSION["generales"]["pathabsoluto"] . '/tmp/' . $name);
                    }

                    //
                    $bandeja = '';
                    if (substr(ltrim($_SESSION["formulario"]["datos"]["matricula"], "0"), 0, 1) == 'S') {
                        $bandeja = '5.-REGESADL';
                    } else {
                        $bandeja = '4.-REGMER';
                    }

                    //
                    $id = \funcionesRegistrales::grabarAnexoRadicacion(
                                    $dbx, ltrim($_SESSION["tramite"]["numeroradicacion"], "0"), // Codigo barras
                                    trim($_SESSION["tramite"]["numerorecibo"]), // Recibo
                                    trim($_SESSION["tramite"]["numerooperacion"]), // Operacion
                                    ltrim($_SESSION["tramite"]["identificacioncliente"], "0"), // Identificacion
                                    trim($_SESSION["tramite"]["nombrecliente"]), // Nombre
                                    '', // Acreedor
                                    '', // Nombre acreedor
                                    ltrim($_SESSION["formulario"]["datos"]["matricula"], "0"), // N&uacute;mero de matr&iacute;cula
                                    '', // N&uacute;mero de proponente
                                    TIPO_DOC_FOR_MERCANTIL, // Tipo de documento
                                    '', // N&uacute;mero del documento
                                    $_SESSION["tramite"]["fecharecibo"], '', // C&oacute;digo de origen
                                    'EL COMERCIANTE', '', // Clasificaci&oacute;n
                                    '', // N&uacute;mero del contrato
                                    '', // Idfuente
                                    1, // versi&oacute;n
                                    '', // Path
                                    '1', // Estado
                                    date("Ymd"), // fecha de escaneo o generaci&oacute;n
                                    $_SESSION["generales"]["codigousuario"], '', // Caja
                                    '', // Libro
                                    $det, '', // Libro del registro
                                    '', // Numero del registro
                                    '', // Dupli
                                    $bandeja, // Bandeja de registro
                                    'S', // Soporte del recibo
                                    '', // identificador
                                    '503' // Tipo anexo
                    );

                    $dirx = date("Ymd");
                    $path = PATH_ABSOLUTO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/mreg/' . $dirx;
                    if (!is_dir($path) || !is_readable($path)) {
                        mkdir($path, 0777);
                        \funcionesGenerales::crearIndex($path);
                    }

                    $pathsalida = 'mreg/' . $dirx . '/' . $id . '.pdf';
                    copy($_SESSION["generales"]["pathabsoluto"] . '/tmp/' . $name, $_SESSION["generales"]["pathabsoluto"] . '/' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/' . $pathsalida);
                    unlink($_SESSION["generales"]["pathabsoluto"] . '/tmp/' . $name);
                    \funcionesRegistrales::grabarPathAnexoRadicacion($dbx, $id, $pathsalida);
                }

                if ($iEstab > 0) {

                    foreach ($_SESSION["formulario"]["datoshijos"] as $hijo) {

                        $_SESSION["formulario"]["datos"] = $hijo;
                        $det = '';

                        if ($_SESSION["tramite"]["tipotramite"] == 'renovacionmatricula' ||
                                $_SESSION["tramite"]["tipotramite"] == 'renovacionesadl'
                        ) {
                            $det = 'FORMULARIO DE RENOVACION - MATRICULA NO. ' . ltrim($_SESSION["formulario"]["datos"]["matricula"], "0");
                        }

                        if ($_SESSION["tramite"]["tipotramite"] == 'matriculapnat' ||
                                $_SESSION["tramite"]["tipotramite"] == 'matriculaest' ||
                                $_SESSION["tramite"]["tipotramite"] == 'matriculapjur' ||
                                $_SESSION["tramite"]["tipotramite"] == 'matriculaesadl'
                        ) {
                            $det = 'FORMULARIO DE MATRICULA - MATRICULA NO. ' . ltrim($_SESSION["formulario"]["datos"]["matricula"], "0");
                        }

                        /*
                          if (FECHA_INICIAL_DECRETO1510 <= date("Ymd")) {
                          $name = armarPdfEstablecimientoNuevo1510($_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"], '');
                          } else {
                          $name = armarPdfEstablecimientoNuevo($_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"], '');
                          }
                         */
                        if (ACTIVAR_CIRCULAR_002_2016 == 'SI1') {
                            $name = armarPdfEstablecimientoNuevo1510($dbx, $_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"], '');
                        } else {
                            $name = armarPdfEstablecimientoNuevo1082($dbx, $_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"], '');
                        }

                        if (count($_SESSION["formulario"]["datos"]["f"]) > 1) {

                            /*
                              if (FECHA_INICIAL_DECRETO1510 <= date("Ymd")) {
                              $name1 = armarPdfEstablecimientoNuevoAnosAnteriores1510($_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"], '');
                              } else {
                              $name1 = armarPdfEstablecimientoNuevoAnosAnteriores($_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"], '');
                              }
                             */
                            if (ACTIVAR_CIRCULAR_002_2016 == 'SI1') {
                                $name1 = armarPdfEstablecimientoNuevoAnosAnteriores1510($dbx, $_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"], '');
                            } else {
                                $name1 = armarPdfEstablecimientoNuevoAnosAnteriores1082($dbx, $_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"], '');
                            }



                            unirPdfs(array($_SESSION["generales"]["pathabsoluto"] . '/tmp/' . $name, $_SESSION["generales"]["pathabsoluto"] . '/tmp/' . $name1), $_SESSION["generales"]["pathabsoluto"] . '/tmp/' . $name);
                        }


                        //
                        $bandeja = '';
                        if (substr(ltrim($_SESSION["formulario"]["datos"]["matricula"], "0"), 0, 1) == 'S') {
                            $bandeja = '5.-REGESADL';
                        } else {
                            $bandeja = '4.-REGMER';
                        }

                        $id = \funcionesRegistrales::grabarAnexoRadicacion(
                                        $dbx, // Conexion BD
                                        ltrim($_SESSION["tramite"]["numeroradicacion"], "0"), trim($_SESSION["tramite"]["numerorecibo"]), trim($_SESSION["tramite"]["numerooperacion"]), ltrim($_SESSION["tramite"]["identificacioncliente"], "0"), trim($_SESSION["tramite"]["nombrecliente"]), '', // Acreedor
                                        '', // Nombre acreedor
                                        ltrim($_SESSION["formulario"]["datos"]["matricula"], "0"), // N&uacute;mero de matr&iacute;cula
                                        '', // N&uacute;mero de proponente
                                        TIPO_DOC_FOR_MERCANTIL, // Tipo de documento
                                        '', // N&uacute;mero del documento
                                        $_SESSION["tramite"]["fecharecibo"], '', // C&oacute;digo de origen
                                        'EL COMERCIANTE', '', // Clasificaci&oacute;n
                                        '', // N&uacute;mero del contrato
                                        '', // Idfuente
                                        1, // versi&oacute;n
                                        '', // Path
                                        '1', // Estado
                                        date("Ymd"), // fecha de escaneo o generaci&oacute;n
                                        $_SESSION["generales"]["codigousuario"], '', // Caja
                                        '', // Libro
                                        $det, '', // Libro del registro
                                        '', // Numero del registro
                                        '', // Dupli
                                        $bandeja, // Bandeja de registro
                                        'S', // Soporte del recibo
                                        '', // Identificador
                                        '503' // Tipo de anexo
                        );

                        $dirx = date("Ymd");
                        $path = PATH_ABSOLUTO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/mreg/' . $dirx;
                        if (!is_dir($path) || !is_readable($path)) {
                            mkdir($path, 0777);
                            \funcionesGenerales::crearIndex($path);
                        }

                        $pathsalida = 'mreg/' . $dirx . '/' . $id . '.pdf';
                        copy($_SESSION["generales"]["pathabsoluto"] . '/tmp/' . $name, $_SESSION["generales"]["pathabsoluto"] . '/' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/' . $pathsalida);
                        unlink($_SESSION["generales"]["pathabsoluto"] . '/tmp/' . $name);
                        \funcionesRegistrales::grabarPathAnexoRadicacion($dbx, $id, $pathsalida);
                    }
                }
            }
            unset($arrForms);
            unset($form);

            //
            if (!empty($datPrincipal)) {
                $bandeja = '4.-REGMER';
                $_SESSION["formulario"]["datos"] = $datPrincipal;
                $_SESSION["formulario"]["numrec"] = $_SESSION["tramite"]["numerorecuperacion"];
                $name = armarPdfFormatoAfiliacion($dbx, $_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"], '', '');
                $det = 'Formato de renovación de afiliación matrícula No. ' . $datPrincipal["matricula"];
                $id = \funcionesRegistrales::grabarAnexoRadicacion(
                                $dbx, // COnexion bd
                                ltrim($_SESSION["tramite"]["numeroradicacion"], "0"), // COdigo barras
                                trim($_SESSION["tramite"]["numerorecibo"]), // Recibo
                                trim($_SESSION["tramite"]["numerooperacion"]), // Operacion
                                ltrim($_SESSION["tramite"]["identificacioncliente"], "0"), // identificacion
                                trim($_SESSION["tramite"]["nombrecliente"]), // Nombre
                                '', // Acreedor
                                '', // Nombre acreedor
                                ltrim($_SESSION["formulario"]["datos"]["matricula"], "0"), // Numero de matricula
                                '', // N&uacute;mero de proponente
                                TIPO_DOC_FOR_AFILIACION, // Tipo de documento
                                '', // Numero del documento
                                $_SESSION["tramite"]["fecharecibo"], // fecha del recibo
                                '', // Codigo de origen
                                'EL COMERCIANTE', '', // Clasificacion
                                '', // Numero del contrato
                                '', // Idfuente
                                1, // version
                                '', // Path
                                '1', // Estado
                                date("Ymd"), // fecha de escaneo o generacion
                                $_SESSION["generales"]["codigousuario"], // Usuario que genera
                                '', // Caja
                                '', // Libro
                                $det, // Detalle
                                '', // Libro del registro
                                '', // Numero del registro
                                '', // Dupli
                                $bandeja, // Bandeja de registro
                                'S', // Soporte del recibo
                                '', // Identificador
                                '503' // Tipo de anexo
                );

                $dirx = date("Ymd");
                $path = PATH_ABSOLUTO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/mreg/' . $dirx;
                if (!is_dir($path) || !is_readable($path)) {
                    mkdir($path, 0777);
                    \funcionesSii2::crearIndex($path);
                }

                $pathsalida = 'mreg/' . $dirx . '/' . $id . '.pdf';
                copy($_SESSION["generales"]["pathabsoluto"] . '/tmp/' . $name, $_SESSION["generales"]["pathabsoluto"] . '/' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/' . $pathsalida);
                unlink($_SESSION["generales"]["pathabsoluto"] . '/tmp/' . $name);
                \funcionesRegistrales::grabarPathAnexoRadicacion($dbx, $id, $pathsalida);
            }
        }
    }

    public static function generarMutacionRepositorio($dbx = null) {
        require_once ($_SESSION["generales"]["pathabsoluto"] . '/api/genPdfsMutacion.php');

        $_SESSION["formulario"]["datos"] = array();
        $_SESSION["formulario"]["numrec"] = $_SESSION["tramite"]["numerorecuperacion"];
        $arrForms = retornarRegistrosMysqliApi($dbx, 'mreg_liquidaciondatos', "idliquidacion=" . $_SESSION["tramite"]["numeroliquidacion"], "xml");
        foreach ($arrForms as $form) {
            $_SESSION["formulario"]["datos"] = \funcionesGenerales::desserializarExpedienteMatricula($dbx, $form);
            if (substr($_SESSION["formulario"]["datos"]["matricula"], 0, 1) == 'S') {
                $clavevalor = '90.20.43';
                $bandeja = '5.-REGESADL';
            } else {
                $clavevalor = '90.20.41';
                $bandeja = '4.-REGMER';
            }
            $name = armarPdfMutacion($dbx, $_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"]);
            $id = \funcionesRegistrales::grabarAnexoRadicacion(
                            $dbx, // Conexion BD
                            ltrim($_SESSION["tramite"]["numeroradicacion"], "0"), trim($_SESSION["tramite"]["numerorecibo"]), trim($_SESSION["tramite"]["numerooperacion"]), ltrim($_SESSION["tramite"]["identificacioncliente"], "0"), trim($_SESSION["tramite"]["nombrecliente"]), '', // Acreedor
                            '', // Nombre acreedor
                            ltrim($_SESSION["formulario"]["datos"]["matricula"], "0"), // N&uacute;mero de matr&iacute;cula
                            '', // N&uacute;mero de proponente
                            retornarClaveValorMysqliApi($dbx, $clavevalor), // Tipo de documento
                            'N/A', // N&uacute;mero del documento
                            $_SESSION["tramite"]["fecharecibo"], '', // C&oacute;digo de origen
                            'EL COMERCIANTE - INSCRITO', '', // Clasificaci&oacute;n
                            '', // N&uacute;mero del contrato
                            '', // Idfuente
                            1, // versi&oacute;n
                            '', // Path
                            '1', // Estado
                            date("Ymd"), // fecha de escaneo o generaci&oacute;n
                            $_SESSION["generales"]["codigousuario"], '', // Caja
                            '', // Libro
                            'SOLICITUD DE MUTACION DE ACTIVIDAD ECONOMICA MATRICULA NO. ' . ltrim($_SESSION["formulario"]["datos"]["matricula"], "0"), // Noticia
                            '', // LIBRO
                            '', // Registro
                            '', // Dupli
                            $bandeja, // Bandeja de registro
                            'S', // Soporte del recibo de caja
                            '', // Identificador
                            '501' // Tipo anexo	
            );
            $dirx = date("Ymd");
            $path = PATH_ABSOLUTO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/mreg/' . $dirx;
            if (!is_dir($path) || !is_readable($path)) {
                mkdir($path, 0777);
                \funcionesGenerales::crearIndex($path);
            }

            $pathsalida = 'mreg/' . $dirx . '/' . $id . '.pdf';
            copy($name, $_SESSION["generales"]["pathabsoluto"] . '/' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/' . $pathsalida);
            unlink($name);
            grabarPathAnexoRadicacion($id, $pathsalida);
            unset($arrForms);
            unset($form);
        }
    }

    public static function generarReciboCajaRepositorio($dbx, $mat, $pro, $arreglo = array(), $tiporegistro = 'RegMer', $genrec = '') {
        require_once ($_SESSION["generales"]["pathabsoluto"] . '/api/genPdfsGenerales.php');

        //
        if (!isset($_SESSION["tramite"]["claveprepago"])) {
            $_SESSION["tramite"]["claveprepago"] = '';
        }
        if (!isset($_SESSION["tramite"]["saldoprepago"])) {
            $_SESSION["tramite"]["saldoprepago"] = 0;
        }

        // echo "entra a armar pdf del recibo<br>";
        $name = armarPdfRecibo($dbx, $_SESSION["tramite"]["idliquidacion"], 'T', 'SI', $arreglo, $_SESSION["tramite"]["claveprepago"], $_SESSION["tramite"]["saldoprepago"], $genrec);

        // echo "armo pdf del recibo<br>";
        $tipodoc = '';
        $bandeja = '';
        switch ($tiporegistro) {
            case "RegMer": {
                    $tipodoc = TIPO_DOC_REC_CAJA_MERCANTIL;
                    $bandeja = '4.-REGMER';
                    break;
                }
            case "LibCom":
                $tipodoc = TIPO_DOC_REC_CAJA_MERCANTIL;
                $bandeja = '4.-REGMER';
                break;
            case "CerEle":
                $tipodoc = TIPO_DOC_REC_CAJA_MERCANTIL;
                $bandeja = '4.-REGMER';
                break;
            case "CerVirt":
                $tipodoc = TIPO_DOC_REC_CAJA_MERCANTIL;
                $bandeja = '4.-REGMER';
                break;
            case "InscDoc":
                $tipodoc = TIPO_DOC_REC_CAJA_MERCANTIL;
                $bandeja = '4.-REGMER';
                break;
            case "InscDocRegMer":
                $tipodoc = TIPO_DOC_REC_CAJA_MERCANTIL;
                $bandeja = '4.-REGMER';
                break;
            case "InscDocEsadl":
                $tipodoc = TIPO_DOC_REC_CAJA_ESADL;
                $bandeja = '5.-REGESADL';
                break;
            case "crm":
                $tipodoc = TIPO_DOC_REC_CAJA_MERCANTIL;
                $bandeja = '4.-REGMER';
                break;
            case "RegEsadl":
                $tipodoc = TIPO_DOC_REC_CAJA_ESADL;
                $bandeja = '5.-REGESADL';
                break;
            case "RegPro":
                $tipodoc = TIPO_DOC_REC_CAJA_PROPONENTES;
                $bandeja = '6.-REGPRO';
                break;
            case "PrePag":
                $tipodoc = TIPO_DOC_REC_CAJA_MERCANTIL;
                $bandeja = '4.-REGMER';
                break;
            default :
                $tipodoc = TIPO_DOC_REC_CAJA_MERCANTIL;
                $bandeja = '4.-REGMER';
                break;
        }

        $id = \funcionesRegistrales::grabarAnexoRadicacion(
                        $dbx, // COnexion
                        ltrim($_SESSION["tramite"]["numeroradicacion"], "0"), // NumRad
                        trim($_SESSION["tramite"]["numerorecibo"]), // NumRecibo
                        trim($_SESSION["tramite"]["numerooperacion"]), // NumOpe
                        ltrim($_SESSION["tramite"]["identificacioncliente"], "0"), // IdeCliente
                        trim($_SESSION["tramite"]["nombrecliente"]), // NomCliente
                        '', // Acreedor
                        '', // Nombre acreedor
                        ltrim($mat, "0"), // mat
                        ltrim($pro, "0"), // Prop
                        $tipodoc, // Tipo de documento
                        '', // N&uacute;mero del documento
                        $_SESSION["tramite"]["fecharecibo"], // fechaRecibo
                        '', // C&oacute;digo de origen
                        'CAJA DE LA CAMARA DE COMERCIO', // Txtorigen
                        '', // Clasificaci&oacute;n
                        '', // N&uacute;mero del contrato
                        '', // Idfuente
                        1, // versi&oacute;n
                        '', // Path
                        '1', // Estado
                        date("Ymd"), // fecha de escaneo o generaci&oacute;n
                        $_SESSION["generales"]["codigousuario"], // Usuario
                        '', // Caja
                        '', // Libro
                        'RECIBO DE CAJA No. ' . $_SESSION["tramite"]["numerorecibo"], // Detalle
                        '', // Libro de comercio
                        '', // Numero de registros en libro
                        '', // Dupli
                        $bandeja, // Bandeja de registro
                        'S', // Soporte del recibo de caja
                        '', // Identificador
                        '509' // Tipo anexo	
        );

        // Traslada la imagen tif del sello al repositorio
        // $tam = filesize($name);

        $dirx = date("Ymd");
        $path = PATH_ABSOLUTO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/mreg/' . $dirx;
        if (!is_dir($path) || !is_readable($path)) {
            mkdir($path, 0777);
            \funcionesGenerales::crearIndex($path);
        }

        $pathsalida = 'mreg/' . $dirx . '/' . $id . '.pdf';
        copy(PATH_ABSOLUTO_SITIO . '/' . $name, PATH_ABSOLUTO_SITIO . '/' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/' . $pathsalida);
        unlink(PATH_ABSOLUTO_SITIO . '/' . $name);
        \funcionesRegistrales::grabarPathAnexoRadicacion($dbx, $id, $pathsalida);
    }

    public static function generarMutacionDireccionRepositorio($dbx = null) {
        require_once ($_SESSION["generales"]["pathabsoluto"] . '/api/genPdfsMutacionDireccion.php');

        $_SESSION["formulario"]["datos"] = array();
        $_SESSION["formulario"]["numrec"] = $_SESSION["tramite"]["numerorecuperacion"];
        $arrForms = retornarRegistrosMysqliApi($dbx, 'mreg_liquidaciondatos', "idliquidacion=" . $_SESSION["tramite"]["numeroliquidacion"], "xml");
        foreach ($arrForms as $form) {
            $_SESSION["formulario"]["datos"] = \funcionesGenerales::desserializarExpedienteMatricula($dbx, $form);
            $_SESSION["formulario"]["datos"]["modcom"] = $_SESSION["tramite"]["modcom"];
            $_SESSION["formulario"]["datos"]["modnot"] = $_SESSION["tramite"]["modnot"];
            if (substr($_SESSION["formulario"]["datos"]["matricula"], 0, 1) == 'S') {
                $clavevalor = '90.20.43';
                $bandeja = '5.-REGESADL';
            } else {
                $clavevalor = '90.20.41';
                $bandeja = '4.-REGMER';
            }
            $name = armarPdfMutacionDireccion($_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"]);
            $id = \funcionesRegistrales::grabarAnexoRadicacion(
                            $dbx, // Conexion BD
                            ltrim($_SESSION["tramite"]["numeroradicacion"], "0"), trim($_SESSION["tramite"]["numerorecibo"]), trim($_SESSION["tramite"]["numerooperacion"]), ltrim($_SESSION["tramite"]["identificacioncliente"], "0"), trim($_SESSION["tramite"]["nombrecliente"]), '', // Acreedor
                            '', // Nombre acreedor
                            ltrim($_SESSION["formulario"]["datos"]["matricula"], "0"), // N&uacute;mero de matr&iacute;cula
                            '', // N&uacute;mero de proponente
                            retornarClaveValorMysqliApi($dbx, $clavevalor), // Tipo de documento
                            'N/A', // N&uacute;mero del documento
                            $_SESSION["tramite"]["fecharecibo"], '', // C&oacute;digo de origen
                            'EL COMERCIANTE - INSCRITO', '', // Clasificaci&oacute;n
                            '', // N&uacute;mero del contrato
                            '', // Idfuente
                            1, // versi&oacute;n
                            '', // Path
                            '1', // Estado
                            date("Ymd"), // fecha de escaneo o generaci&oacute;n
                            $_SESSION["generales"]["codigousuario"], '', // Caja
                            '', // Libro
                            'SOLICITUD DE MUTACION DE DIRECCION MATRICULA NO. ' . ltrim($_SESSION["formulario"]["datos"]["matricula"], "0"), // Noticia
                            '', // LIBRO
                            '', // Registro
                            '', // Dupli
                            $bandeja, // Bandeja de registro
                            'S', // Soporte del recibo de caja
                            '', // identificador
                            '501' // Tipo anexo				
            );
            $dirx = date("Ymd");
            $path = PATH_ABSOLUTO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/mreg/' . $dirx;
            if (!is_dir($path) || !is_readable($path)) {
                mkdir($path, 0777);
                \funcionesGenerales::crearIndex($path);
            }

            $pathsalida = 'mreg/' . $dirx . '/' . $id . '.pdf';
            copy($name, $_SESSION["generales"]["pathabsoluto"] . '/' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/' . $pathsalida);
            unlink($name);
            grabarPathAnexoRadicacion($id, $pathsalida);
            unset($arrForms);
            unset($form);
        }
    }

    public static function generarMutacionNombreRepositorio($dbx = null) {
        require_once ($_SESSION["generales"]["pathabsoluto"] . '/api/genPdfsMutacionNombre.php');

        $_SESSION["formulario"]["datos"] = array();
        $_SESSION["formulario"]["numrec"] = $_SESSION["tramite"]["numerorecuperacion"];
        $arrForms = retornarRegistrosMysqliApi($dbx, 'mreg_liquidaciondatos', "idliquidacion=" . $_SESSION["tramite"]["numeroliquidacion"], "xml");
        foreach ($arrForms as $form) {
            $_SESSION["formulario"]["datos"] = \funcionesGenerales::desserializarExpedienteMatricula($dbx, $form);
            if (substr($_SESSION["formulario"]["datos"]["matricula"], 0, 1) == 'S') {
                $clavevalor = '90.20.43';
                $bandeja = '5.-REGESADL';
            } else {
                $clavevalor = '90.20.41';
                $bandeja = '4.-REGMER';
            }
            $name = armarPdfMutacionNombre($dbx, $_SESSION["tramite"]["numerorecuperacion"], $_SESSION["tramite"]["numeroliquidacion"]);
            $id = \funcionesRegistrales::grabarAnexoRadicacion(
                            $dbx, // Conexion BD
                            ltrim($_SESSION["tramite"]["numeroradicacion"], "0"), trim($_SESSION["tramite"]["numerorecibo"]), trim($_SESSION["tramite"]["numerooperacion"]), ltrim($_SESSION["tramite"]["identificacioncliente"], "0"), trim($_SESSION["tramite"]["nombrecliente"]), '', // Acreedor
                            '', // Nombre acreedor
                            ltrim($_SESSION["formulario"]["datos"]["matricula"], "0"), // N&uacute;mero de matr&iacute;cula
                            '', // N&uacute;mero de proponente
                            retornarClaveValorMysqliApi($dbx, $clavevalor), // Tipo de documento
                            'N/A', // N&uacute;mero del documento
                            $_SESSION["tramite"]["fecharecibo"], '', // C&oacute;digo de origen
                            'EL COMERCIANTE - INSCRITO', '', // Clasificaci&oacute;n
                            '', // Numero del contrato
                            '', // Idfuente
                            1, // version
                            '', // Path
                            '1', // Estado
                            date("Ymd"), // fecha de escaneo o generaci&oacute;n
                            $_SESSION["generales"]["codigousuario"], '', // Caja
                            '', // Libro
                            'SOLICITUD DE MUTACION DE NOMBRE MATRICULA NO. ' . ltrim($_SESSION["formulario"]["datos"]["matricula"], "0"), // Noticia
                            '', // LIBRO
                            '', // Registro
                            '', // Dupli
                            $bandeja, // Bandeja de registro
                            'S', // Soporte del recibo de caja
                            '', // identificador
                            '501' // Tipo anexo
            );
            $dirx = date("Ymd");
            $path = PATH_ABSOLUTO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/mreg/' . $dirx;
            if (!is_dir($path) || !is_readable($path)) {
                mkdir($path, 0777);
                \funcionesGenerales::crearIndex($path);
            }

            $pathsalida = 'mreg/' . $dirx . '/' . $id . '.pdf';
            copy($name, $_SESSION["generales"]["pathabsoluto"] . '/' . PATH_RELATIVO_IMAGES . '/' . $_SESSION["generales"]["codigoempresa"] . '/' . $pathsalida);
            unlink($name);
            \funcionesRegistrales::grabarPathAnexoRadicacion($dbx, $id, $pathsalida);
            unset($arrForms);
            unset($form);
        }
    }

    public static function generarSecuenciaCodigoBarras($dbx) {
        $nameLog = 'generarSecuenciaCodigoBarras_' . date("Ymd");
        //
        $cb = 0;
        $cb = \funcionesRegistrales::retornarMregSecuencia($dbx, 'CODIGOS-BARRAS');
        if ($cb == 0) {
            log::general2($nameLog, '', 'Error recuperando secuencia codigo de barras : ' . $_SESSION["generales"]["mensajeerror"]);
            $_SESSION["generales"]["mensajeerror"] = 'No fue posible localizar el ultimo codigo de barras asignado';
            return false;
        }

        // ************************************************************************************************ //
        // Revisa que el codigo de barras no este previamente creado
        // ************************************************************************************************ //
        $seguir = "si";
        while ($seguir == 'si') {
            $cb++;
            if (contarRegistrosMysqliApi($dbx, 'mreg_est_codigosbarras', "codigobarras='" . $cb . "'") == 0) {
                $seguir = 'no';
            }
        }

        // ************************************************************************************************ //
        // Actualiza el consecutivo en claves valor
        // ************************************************************************************************ //	
        \funcionesRegistrales::actualizarMregSecuencia($dbx, 'CODIGOS-BARRAS', $cb);

        // ************************************************************************************************ //
        // Arma los arreglos para grabar el recibo
        // ************************************************************************************************ //

        $arrCampos = array(
            'codigobarras',
            'operacion',
            'recibo',
            'fecharadicacion',
            'matricula',
            'proponente',
            'idclase',
            'numid',
            'numdocextenso',
            'nombre',
            'estadofinal',
            'operadorfinal',
            'fechaestadofinal',
            'horaestadofinal',
            'sucursalfinal',
            'activos',
            'liquidacion',
            'reliquidacion',
            'actoreparto',
            'tipdoc',
            'numdoc',
            'oridoc',
            'mundoc',
            'fecdoc',
            'detalle',
            'canins',
            'candoc',
            'canfor',
            'cananx1',
            'cananx2',
            'cananx3',
            'cananx4',
            'cananx5',
            'sucursalradicacion',
            'tiprut',
            'numcaja',
            'escaneocompleto',
            'clavefirmado'
        );

        //
        $arrValores = array(
            "'" . $cb . "'",
            "''", // operacion
            "''", // recibo
            "'" . date("Ymd") . "'",
            "''", // matricula
            "''", // proponente
            "''", // idclase
            "''", // numid
            "''", // numdocextenso
            "''", // nombre
            "'" . '01' . "'",
            "''", // operadorfinal
            "'" . date("Ymd") . "'",
            "'" . date("His") . "'",
            "''", // sucursalfinal
            0, // activos
            0, // liquidacion
            "''", // reliquidacion
            "''", // actoreparto
            "''", // tipdoc
            "''", // numdoc
            "''", // oridoc
            "''", // mundoc
            "''", // fecdoc
            "''", // detalle
            0, // canins
            0, // candoc
            0, // canfor
            0, // cananx1
            0, // cananx2
            0, // cananx3
            0, // cananx4
            0, // cananx5
            "''", // sucursal radicacion
            "''", // tiprut
            "''", // numcaja
            "''", // escaneo completo
            "''" // clave firmado
        );

        //
        $res = insertarRegistrosMysqliApi($dbx, 'mreg_est_codigosbarras', $arrCampos, $arrValores);
        if ($res === false) {
            \logApi::general2($nameLog, '', 'Error creando codigo de barras : ' . $_SESSION["generales"]["mensajeerror"]);
            return false;
        }

        return $cb;
    }

    public static function generarSecuenciaCodigoBarrasPowerFile($dbx) {
        $cb = false;
        $headers = array(
            'function: authenticationUser',
            'pmhost: http://bpm.cccucuta.org.co',
            'workspace: cccucuta',
            'Content-Type: application/json'
        );
        $data = array('pmhost' => 'http://bpm.cccucuta.org.co',
            'workspace' => 'cccucuta',
            'clientId' => 'NZPXVTXFOLFZTOGQVGGYUDXGCGLLRFQV',
            'clientSecret' => '13653564459a7194df19bb2021547438',
            'username' => 'confecamara',
            'password' => '123456789'
        );

        $fields = json_encode($data);
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, 'http://bpm.cccucuta.org.co/syscccucuta/en/neoclassic/NewUser/services/loginUserService.php');
        curl_setopt($ch, CURLOPT_POST, true);
        curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
        curl_setopt($ch, CURLOPT_POSTFIELDS, $fields);
        $result = curl_exec($ch);
        curl_close($ch);
        $resultado = json_decode($result, true);
        $access_token = $resultado['access_token'];
        $expires_in = $resultado['expires_in'];
        $token_type = $resultado['token_type'];
        $scope = $resultado['scope'];
        $refresh_token = $resultado['refresh_token'];

        //echo $access_token;
        //Validacion de Autenticacion
        if ($access_token != '') {
            $header = array(
                'function: newCaseTrigger',
                'pmhost: http://bpm.cccucuta.org.co',
                'workspace: cccucuta',
                'Authorization:' . $access_token,
                'statusIngestion: SUCCESSFUL',
                'processId: 125488281598ddd07bbb5e4006297031',
                'taskId: 130462646598ddd080ea780009585776',
                'userId: 85714721659a72800144f89026507541',
                'Content-Type: application/json'
            );

            $ch = curl_init();
            curl_setopt($ch, CURLOPT_URL, 'http://bpm.cccucuta.org.co/syscccucuta/en/neoclassic/NewUser/services/powerfileService.php');
            curl_setopt($ch, CURLOPT_POST, true);
            curl_setopt($ch, CURLOPT_HTTPHEADER, $header);
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
            curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
            curl_setopt($ch, CURLOPT_POSTFIELDS, $fields);
            $results = curl_exec($ch);
            curl_close($ch);
            $resultado = json_decode($results, true);
            if (isset($resultado["txt_NumRad"])) {
                $cb = ltrim(trim($resultado["txt_NumRad"]), "0");
            }
        }

        // ************************************************************************************************ //
        // Arma los arreglos para grabar el recibo
        // ************************************************************************************************ //

        if ($cb && $cb != '') {
            $arrCampos = array(
                'codigobarras',
                'operacion',
                'recibo',
                'fecharadicacion',
                'matricula',
                'proponente',
                'idclase',
                'numid',
                'numdocextenso',
                'nombre',
                'estadofinal',
                'operadorfinal',
                'fechaestadofinal',
                'horaestadofinal',
                'sucursalfinal',
                'activos',
                'liquidacion',
                'reliquidacion',
                'actoreparto',
                'tipdoc',
                'numdoc',
                'oridoc',
                'mundoc',
                'fecdoc',
                'detalle',
                'canins',
                'candoc',
                'canfor',
                'cananx1',
                'cananx2',
                'cananx3',
                'cananx4',
                'cananx5',
                'sucursalradicacion',
                'tiprut',
                'numcaja',
                'escaneocompleto',
                'clavefirmado'
            );

            //
            $arrValores = array(
                "'" . $cb . "'",
                "''", // operacion
                "''", // recibo
                "'" . date("Ymd") . "'",
                "''", // matricula
                "''", // proponente
                "''", // idclase
                "''", // numid
                "''", // numdocextenso
                "''", // nombre
                "'" . '01' . "'",
                "''", // operadorfinal
                "'" . date("Ymd") . "'",
                "'" . date("His") . "'",
                "''", // sucursalfinal
                0, // activos
                0, // liquidacion
                "''", // reliquidacion
                "''", // actoreparto
                "''", // tipdoc
                "''", // numdoc
                "''", // oridoc
                "''", // mundoc
                "''", // fecdoc
                "''", // detalle
                0, // canins
                0, // candoc
                0, // canfor
                0, // cananx1
                0, // cananx2
                0, // cananx3
                0, // cananx4
                0, // cananx5
                "''", // sucursal radicacion
                "''", // tiprut
                "''", // numcaja
                "''", // escaneo completo
                "''" // clave firmado
            );

            //
            $res = insertarRegistrosMysqliApi($dbx, 'mreg_est_codigosbarras', $arrCampos, $arrValores);
            if ($res === false) {
                return false;
            }
        }

        return $cb;
    }

    public static function generarSecuenciaLibros($dbx, $libro = '') {
        if (strlen($libro) == 2) {
            if ($libro < '50') {
                $libro = 'RM' . $libro;
            } else {
                $libro = 'RE' . $libro;
            }
        }

        //
        $ins = 0;
        $ins = \funcionesRegistrales::retornarMregSecuencia($dbx, 'LIBRO-' . $libro);
        if ($ins == 0) {
            $_SESSION["generales"]["mensajeerror"] = 'No fue posible localizar la ultima inscripcion para el libro' . $libro;
            return false;
        }

        // ************************************************************************************************ //
        // Revisa que la inscripción no haya sido previamente asignada
        // ************************************************************************************************ //
        $seguir = "si";
        while ($seguir == 'si') {
            $ins++;
            if (contarRegistrosMysqliApi($dbx, 'mreg_est_inscripciones', "libro='" . $libro . "' and registro='" . $ins . "'") == 0) {
                $seguir = 'no';
            }
        }

        // ************************************************************************************************ //
        // Actualiza el consecutivo en claves valor
        // ************************************************************************************************ //	
        \funcionesRegistrales::actualizarMregSecuenciasAsentarRecibo($dbx, 'LIBRO-' . $libro, $ins);

        // ************************************************************************************************ //
        // Arma los arreglos para grabar el recibo
        // ************************************************************************************************ //

        $arrCampos = array(
            'libro',
            'registro',
            'dupli'
        );

        //
        $arrValores = array(
            "'" . $libro . "'",
            "'" . $ins . "'",
            "'01'"
        );

        //
        $res = insertarRegistrosMysqliApi($dbx, 'mreg_est_inscripciones', $arrCampos, $arrValores);
        if ($res === false) {
            return false;
        }

        return $ins;
    }

    public static function generarSecuenciaMatricula($dbx, $tipomat = '') {
        $nameLog = 'generarSecuenciaMatricula_' . date("Ymd");

        //
        $mat = 0;
        $mat = \funcionesRegistrales::retornarMregSecuencia($dbx, $tipomat);

        if ($mat == 0) {
            $_SESSION["generales"]["mensajeerror"] = 'No fue posible localizar la ultima matricula asignada';
            return false;
        }

        // ************************************************************************************************ //
        // Revisa que la inscripción no haya sido previamente asignada
        // ************************************************************************************************ //
        $seguir = "si";
        while ($seguir == 'si') {
            $mat++;
            if ($tipomat == 'MATREGMER') {
                $xMat = ltrim($mat, "0");
            }
            if ($tipomat == 'MATESADL') {
                $xMat = "S" . sprintf("%07s", $mat);
            }
            if ($tipomat == 'MATCIVIL') {
                $xMat = "N" . sprintf("%07s", $mat);
            }

            if (contarRegistrosMysqliApi($dbx, 'mreg_est_inscritos', "matricula='" . $xMat . "'") == 0) {
                $seguir = 'no';
            }
        }

        // ************************************************************************************************ //
        // Actualiza el consecutivo en claves valor
        // ************************************************************************************************ //	
        \funcionesRegistrales::actualizarMregSecuencia($dbx, $tipomat, $mat);

        //
        $arrCampos = array(
            'matricula',
            'ctrestmatricula',
            'ctrestdatos',
            'origendocconst',
            'fecactualizacion',
            'fecsincronizacion',
            'horsincronizacion'
        );
        $arrValores = array(
            "'" . $xMat . "'",
            "'AS'",
            "'3'",
            "''",
            "''",
            "''",
            "''"
        );
        unset($_SESSION["expedienteactual"]);
        $res = insertarRegistrosMysqliApi($dbx, 'mreg_est_inscritos', $arrCampos, $arrValores);
        if ($res === false) {
            \logApi::general2($nameLog, '', 'Error asignando numero de matricula : ' . $_SESSION["generales"]["mensajeerror"]);
            return false;
        }

        return $xMat;
    }

    public static function generarSecuenciaOperacion($dbx, $usuario, $fecha, $cajero = '', $sedex = '') {
        $sec = 0;
        $sec1 = 0;
        $sede = $sedex;

        // ************************************************************************************************ //
        // Si el usuario es INTERNET o USUPUBXX
        // ************************************************************************************************ //
        if ($cajero == 'INTERNET' || $cajero == 'USUPUBXX') {
            $sede = '99';
        }

        // ************************************************************************************************ //
        // Si el usuario es INTERNET o USUPUBXX
        // ************************************************************************************************ //    
        if ($cajero == 'RUE') {
            $sede = '90';
        }

        // ************************************************************************************************ //
        // Si el usuario es diferente de INTERNET, USUPUBXX, RUE
        // ************************************************************************************************ //    
        if ($cajero != 'INTERNET' && $cajero != 'USUPUBXX' && $cajero != 'RUE') {

            // ************************************************************************************************ //
            // Localiza el usuario en la tabla de usuarios
            // ************************************************************************************************ //
            $arrTem = retornarRegistroMysqliApi($dbx, "usuarios", "idusuario='" . $cajero . "'");

            // ************************************************************************************************ //
            // Si el usuario no existe
            // ************************************************************************************************ //
            if ($arrTem === false) {
                $_SESSION["generales"]["mensajeerror"] = 'Usuario-cajero no localizado en la tabla de usuarios';
                return false;
            }

            // ************************************************************************************************ //
            // Si el usuario esta inactivo
            // ************************************************************************************************ //
            if ($arrTem["fechainactivacion"] != '' && $arrTem["fechainactivacion"] != '00000000') {
                $_SESSION["generales"]["mensajeerror"] = 'Usuario-cajero esta inactivo';
                return false;
            }

            // ************************************************************************************************ //
            // Si el usuario no ha sido activado
            // ************************************************************************************************ //
            if ($arrTem["fechaactivacion"] == '' || $arrTem["fechaactivacion"] == '00000000') {
                $_SESSION["generales"]["mensajeerror"] = 'Usuario-cajero no ha sido activado';
                return false;
            }

            // ************************************************************************************************ //
            // Si el usuario no ha sido activado
            // ************************************************************************************************ //
            if ($arrTem["escajero"] != 'SI') {
                $_SESSION["generales"]["mensajeerror"] = 'Usuario-cajero no es tipo cajero';
                return false;
            }

            // ************************************************************************************************ //
            // Asigna la sede al número de operación.
            // Solo si esta no fue pasada como parámetro desde la liquidación.
            // ************************************************************************************************ //    
            if ($sede == '') {
                $sede = $arrTem["idsede"];
                if (trim($sede) == '') {
                    $sede = '01';
                }
            }
        }

        // ************************************************************************************************ //
        // Calcula la secuencia de la operacion
        // ************************************************************************************************ //
        $contar = contarRegistrosMysqliApi($dbx, 'mreg_controlusuarios', "usuario='" . $cajero . "' and fecha='" . $fecha . "'");
        if ($contar === false) {
            return false;
        }

        if ($contar == 0) {
            $arrCampos = array(
                'usuario',
                'fecha',
                'secuencia'
            );
            $arrValores = array(
                "'" . $usuario . "'",
                "'" . $fecha . "'",
                1
            );
            insertarRegistrosMysqliApi($dbx, 'mreg_controlusuarios', $arrCampos, $arrValores);
            $sec1 = 1;
        } else {
            $arrTem = retornarRegistroMysqliApi($dbx, 'mreg_controlusuarios', "usuario='" . $cajero . "' and fecha='" . $fecha . "'");
            $sec = $arrTem["secuencia"] + 1;
            $sec1 = $sec;
            $arrCampos = array(
                'secuencia'
            );
            $arrValores = array(
                $sec
            );
            regrabarRegistrosMysqliApi($dbx, 'mreg_controlusuarios', $arrCampos, $arrValores, "usuario='" . $cajero . "' and fecha='" . $fecha . "'");
        }

        // ************************************************************************************************ //
        // Retorna el numero de operacion
        // 2016-07-30 : JINT
        // Si hay integración con SIREP, retornar el número de operación a 12 dígitos
        // Si no hay integración con SIREP retorna el número de operación a 25 digitos
        // ************************************************************************************************ //
        return $sede . '-' . trim($cajero) . '-' . $fecha . '-' . sprintf("%04s", $sec1);
    }

    public static function generarSecuenciaRecibo($mysqli, $tipo = 'S', $fps = array(), $operacion = '', $fecha = '', $hora = '', $codbarras = '', $tiporegistro = '', $identificacion = '', $nombre = '', $organizacion = '', $categoria = '', $idtipodoc = '', $numdoc = '', $origendoc = '', $fechadoc = '') {

        // ******************************************************************************* //
        // validas que todos los datos requeridos se pasen
        // ******************************************************************************* //
        $errores = array();
        if (!empty($fps)) {
            $jx = 0;
            foreach ($fps as $d) {
                $jx++;
                if (!isset($d["tipo"])) {
                    $errores[] = 'FPago ' . $jx . ' . Tipo no reportado';
                }
                if (!isset($d["valor"])) {
                    $errores[] = 'FPago ' . $jx . ' . Valor no reportado';
                }
                if (!isset($d["banco"])) {
                    $errores[] = 'FPago ' . $jx . ' . Banco no reportado';
                }
                if (!isset($d["cheque"])) {
                    $errores[] = 'FPago ' . $jx . ' . Cheque no reportado';
                }
            }
        }

        if (!empty($errores)) {
            $_SESSION["generales"]["mensajeerror"] = '';
            foreach ($errores as $e) {
                $_SESSION["generales"]["mensajeerror"] .= $e . " ** ";
            }
            return false;
        }

        //
        $rec = 0;
        $recx = '';

        // ************************************************************************************************ //
        // Localiza el numero del recibo a generar dependiendo del tipo de documento
        // ************************************************************************************************ //
        if ($tipo == 'S') { // Si son recibos normales
            $tclave = 'RECIBOS-NORMALES';
            $rec = \funcionesRegistrales::retornarMregSecuenciaMaxAsentarRecibo($mysqli, $tclave);
        }
        if ($tipo == 'M') { // Si son notas de reversion
            $tclave = 'RECIBOS-NOTAS';
            $rec = \funcionesRegistrales::retornarMregSecuenciaMaxAsentarRecibo($mysqli, $tclave);
        }
        if ($tipo == 'H') { // Si son gastos administrativos
            $tclave = 'RECIBOS-GA';
            $rec = \funcionesRegistrales::retornarMregSecuenciaMaxAsentarRecibo($mysqli, $tclave);
        }
        if ($tipo == 'D') { // Si son consultas
            $tclave = 'RECIBOS-CO';
            $rec = \funcionesRegistrales::retornarMregSecuenciaMaxAsentarRecibo($mysqli, $tclave);
        }
        if ($rec === false) {
            \logApi::general2('reportarPago_' . date("Ymd"), '', 'Error recuperando la secuencia del recibo de caja : ' . $_SESSION["generales"]["mensajeerror"]);
            $_SESSION["generales"]["mensajeerror"] = 'Error recuperando la secuencia del recibo de caja';
            return false;
        } else {
            \logApi::general2('generarSecuenciaReciboNuevaSii_' . date("Ymd"), '', 'Secuencia generada : ' . $rec);
        }

        // ************************************************************************************************ //
        if ($rec == '') {
            $rec = 0;
        } else {
            $rec = intval($rec);
        }

        // ************************************************************************************************ //
        // Revisa que el recibo no esta creado previamente, de ser asi, genera un nuevo numero
        // ************************************************************************************************ //
        $seguir = "si";
        while ($seguir == 'si') {
            $rec++;
            $recx = $tipo . sprintf("%09s", $rec);
            if (contarRegistrosMysqliApi($mysqli, 'mreg_recibosgenerados', "recibo='" . $recx . "'") == 0) {
                $seguir = 'no';
            }
        }

        // ************************************************************************************************ //
        // Actualiza el consecutivo en claves valor
        // ************************************************************************************************ //	
        \funcionesRegistrales::actualizarMregSecuenciasAsentarRecibo($mysqli, $tclave, $rec);

        // ************************************************************************************************ //
        // Arma los arreglos para grabar el recibo
        // ************************************************************************************************ //

        $arrCampos = array(
            'recibo',
            'operacion',
            'factura',
            'codigobarras',
            'fecha',
            'hora',
            'usuario',
            'tipogasto',
            'tipoidentificacion',
            'identificacion',
            'razonsocial',
            'nombre1',
            'nombre2',
            'apellido1',
            'apellido2',
            'direccion',
            'municipio',
            'telefono1',
            'telefono2',
            'email',
            'idliquidacion',
            'tipotramite',
            'valorneto',
            'pagoprepago',
            'pagoafiliado',
            'pagoefectivo',
            'pagocheque',
            'pagoconsignacion',
            'pagopseach',
            'pagovisa',
            'pagomastercard',
            'pagocredencial',
            'pagoamerican',
            'pagodiners',
            'pagotdebito',
            'numeroautorizacion',
            'cheque',
            'franquicia',
            'nombrefranquicia',
            'codbanco',
            'nombrebanco',
            'alertaid',
            'alertaservicio',
            'alertavalor',
            'proyectocaja',
            'numerounicorue',
            'numerointernorue',
            'tipotramiterue',
            'idformapago',
            'estado',
            'estadoemail',
            'estadosms'
        );

        $_SESSION["tramite"]["tipotramiterue"] = '';
        if (substr($_SESSION["tramite"]["tipotramite"], 0, 4) == 'rues') {
            $_SESSION["tramite"]["tipotramiterue"] = substr($_SESSION["tramite"]["tipotramite"], 6);
        }

        //
        $arrValores = array(
            "'" . $recx . "'",
            "'" . $operacion . "'",
            "'" . $_SESSION["tramite"]["numerofactura"] . "'",
            "'" . $codbarras . "'",
            "'" . $fecha . "'",
            "'" . $hora . "'",
            "'" . $_SESSION["generales"]["cajero"] . "'",
            "'" . $_SESSION["tramite"]["tipogasto"] . "'",
            "'" . $_SESSION["tramite"]["tipoidentificacionpagador"] . "'",
            "'" . ltrim($_SESSION["tramite"]["identificacionpagador"], "0") . "'",
            "'" . addslashes(trim($_SESSION["tramite"]["nombrepagador"] . ' ' . $_SESSION["tramite"]["apellidopagador"])) . "'",
            "'" . addslashes(trim($_SESSION["tramite"]["nombre1pagador"])) . "'",
            "'" . addslashes(trim($_SESSION["tramite"]["nombre2pagador"])) . "'",
            "'" . addslashes(trim($_SESSION["tramite"]["apellido1pagador"])) . "'",
            "'" . addslashes(trim($_SESSION["tramite"]["apellido2pagador"])) . "'",
            "'" . addslashes(trim($_SESSION["tramite"]["direccionpagador"])) . "'",
            "'" . trim($_SESSION["tramite"]["municipiopagador"]) . "'",
            "'" . trim($_SESSION["tramite"]["telefonopagador"]) . "'",
            "'" . trim($_SESSION["tramite"]["movilpagador"]) . "'",
            "'" . addslashes(trim($_SESSION["tramite"]["emailpagador"])) . "'",
            $_SESSION["tramite"]["numeroliquidacion"],
            "'" . trim($_SESSION["tramite"]["tipotramite"]) . "'",
            $_SESSION["tramite"]["valortotal"],
            $_SESSION["tramite"]["pagoprepago"],
            $_SESSION["tramite"]["pagoafiliado"],
            $_SESSION["tramite"]["pagoefectivo"],
            $_SESSION["tramite"]["pagocheque"],
            $_SESSION["tramite"]["pagoconsignacion"],
            $_SESSION["tramite"]["pagoach"],
            $_SESSION["tramite"]["pagovisa"],
            $_SESSION["tramite"]["pagomastercard"],
            $_SESSION["tramite"]["pagocredencial"],
            $_SESSION["tramite"]["pagoamerican"],
            $_SESSION["tramite"]["pagodiners"],
            $_SESSION["tramite"]["pagotdebito"],
            "'" . $_SESSION["tramite"]["numeroautorizacion"] . "'",
            "'" . $_SESSION["tramite"]["numerocheque"] . "'",
            "'" . $_SESSION["tramite"]["idfranquicia"] . "'",
            "'" . $_SESSION["tramite"]["nombrefranquicia"] . "'",
            "'" . $_SESSION["tramite"]["idcodban"] . "'",
            "''", // Nombre banco
            $_SESSION["tramite"]["alertaid"],
            "'" . $_SESSION["tramite"]["alertaservicio"] . "'",
            $_SESSION["tramite"]["alertavalor"],
            "'" . $_SESSION["tramite"]["proyectocaja"] . "'",
            "'" . $_SESSION["tramite"]["rues_numerounico"] . "'",
            "'" . $_SESSION["tramite"]["rues_numerointerno"] . "'",
            "'" . $_SESSION["tramite"]["tipotramiterue"] . "'",
            "'" . $_SESSION["tramite"]["idformapago"] . "'",
            "'01'",
            "'0'",
            "'0'"
        );

        //
        $res = insertarRegistrosMysqliApi($mysqli, 'mreg_recibosgenerados', $arrCampos, $arrValores);
        if ($res === false) {
            \logApi::general2('generarSecuenciaReciboNuevaSii_' . date("Ymd"), '', 'Error insertando en mreg_recibosgenerados : ' . $_SESSION["generales"]["mensajeerror"]);
            return false;
        }

        // ************************************************************************************************ //
        // Arma el detalle del recibo y lo graba
        // ************************************************************************************************ //
        $arrCampos = array(
            'recibo',
            'secuencia',
            'fecha',
            'idservicio',
            // 'cc',
            'matricula',
            'proponente',
            // 'tipogasto',
            'ano',
            'cantidad',
            'valorbase',
            'porcentaje',
            'valorservicio',
            'identificacion',
            'razonsocial',
            'organizacion',
            'categoria',
            'idtipodoc',
            'numdoc',
            'origendoc',
            'fechadoc',
            'expedienteafectado',
            'fecharenovacionaplicable'
        );
        $sec = 0;
        foreach ($_SESSION["tramite"]["liquidacion"] as $d) {
            $matx = '';
            $prox = '';
            if (!isset($d["expediente"])) {
                $d["expediente"] = '';
            }
            if (!isset($d["idservicio"])) {
                $d["idservicio"] = '';
            }
            if (!isset($d["ano"])) {
                $d["ano"] = '';
            }
            if (!isset($d["cantidad"])) {
                $d["cantidad"] = 0;
            }
            if (!isset($d["valorbase"])) {
                $d["valorbase"] = 0;
            }
            if (!isset($d["porcentaje"])) {
                $d["porcentaje"] = 0;
            }
            if (!isset($d["valorservicio"])) {
                $d["valorservicio"] = 0;
            }
            if (!isset($d["expedienteafiliado"])) {
                $d["expedienteafiliado"] = '';
            }
            if (!isset($d["ccos"])) {
                $d["ccos"] = '';
            }

            //
            if ($tiporegistro == 'RegPro') {
                $prox = $d["expediente"];
            } else {
                $matx = $d["expediente"];
            }

            if ($d["idservicio"] != '') {
                $sec++;
                $arrValores = array(
                    "'" . $recx . "'",
                    $sec,
                    "'" . $fecha . "'",
                    "'" . $d["idservicio"] . "'",
                    // "''",
                    "'" . ltrim($matx, "0") . "'",
                    "'" . ltrim($prox, "0") . "'",
                    // "'" . $tots["tipogasto"] . "'",
                    "'" . ltrim($d["ano"], "0") . "'",
                    intval($d["cantidad"]),
                    doubleval($d["valorbase"]),
                    doubleval($d["porcentaje"]),
                    doubleval($d["valorservicio"]),
                    "'" . $identificacion . "'",
                    "'" . addslashes($nombre) . "'",
                    "'" . $organizacion . "'",
                    "'" . $categoria . "'",
                    "'" . $idtipodoc . "'",
                    "'" . $numdoc . "'",
                    "'" . addslashes($origendoc) . "'",
                    "'" . $fechadoc . "'",
                    "'" . $d["expedienteafiliado"] . "'",
                    "'" . $fecha . "'"
                );
                $res = insertarRegistrosMysqliApi($mysqli, 'mreg_recibosgenerados_detalle', $arrCampos, $arrValores);
                if ($res === false) {
                    \logApi::general2('generarSecuenciaReciboNuevaSii_' . date("Ymd"), '', 'Error insertando en mreg_recibosgenerados_detalle : ' . $_SESSION["generales"]["mensajeerror"]);
                    return false;
                }
            }
        }

        // ************************************************************************************************ //
        // Arma formas de pago del recibo y las graba
        // ************************************************************************************************ //
        $arrCampos = array(
            'recibo',
            'tipo',
            'valor',
            'banco',
            'cheque',
        );
        $sec = 0;
        foreach ($fps as $fp) {
            $arrValores = array(
                "'" . $recx . "'",
                "'" . $fp["tipo"] . "'",
                $fp["valor"],
                "'" . $fp["banco"] . "'",
                "'" . $fp["cheque"] . "'"
            );
            $res = insertarRegistrosMysqliApi($mysqli, 'mreg_recibosgenerados_fpago', $arrCampos, $arrValores);
            if ($res === false) {
                \logApi::general2('generarSecuenciaReciboNuevaSii_' . date("Ymd"), '', 'Error insertando en mreg_recibosgenerados_fpago : ' . $_SESSION["generales"]["mensajeerror"]);
                return false;
            }
        }

        // ************************************************************************************************ //
        // 2016-07-31 : JINT
        // crea el recibo automáticamente en mreg_est_recibos
        // ************************************************************************************************ //
        $arrCampos = array(
            'numerorecibo',
            'ctranulacion',
            'numfactura',
            'fecoperacion',
            'horaoperacion',
            'idclase',
            'identificacion',
            'nombre',
            'operador',
            'sucursal',
            'ccos',
            'unidad',
            'producto',
            'servicio',
            'serviciodescuento',
            'cantidad',
            'valor',
            'tipogasto',
            'base',
            'moneda',
            'tasa',
            'codigocontable',
            'matricula',
            'activos',
            'anorenovacion',
            'formapago',
            'apellido1',
            'apellido2',
            'nombre1',
            'nombre2',
            'numinterno',
            'numunico',
            'numerooperacion',
            'direccion',
            'municipio',
            'telefono',
            'email',
            'compite360',
            'proyecto',
            'expedienteafectado'
        );
        $arrValores = array();
        $sec = 0;
        if (!isset($_SESSION["tramite"]["camaradestino"])) {
            $_SESSION["tramite"]["camaradestino"] = '';
        }
        if (!isset($_SESSION["tramite"]["camaraorigen"])) {
            $_SESSION["tramite"]["camaraorigen"] = '';
        }
        if (!isset($_SESSION["tramite"]["numerointernorue"])) {
            $_SESSION["tramite"]["numerointernorue"] = '';
        }
        if (!isset($_SESSION["tramite"]["numerounicorue"])) {
            $_SESSION["tramite"]["numerounicorue"] = '';
        }
        if (!isset($_SESSION["tramite"]["proyecto"])) {
            $_SESSION["tramite"]["proyecto"] = '001';
        }

        foreach ($_SESSION["tramite"]["liquidacion"] as $d) {
            if (!isset($d["expediente"])) {
                $d["expediente"] = '';
            }
            if (!isset($d["idservicio"])) {
                $d["idservicio"] = '';
            }
            if (!isset($d["ano"])) {
                $d["ano"] = '';
            }
            if (!isset($d["cantidad"])) {
                $d["cantidad"] = 0;
            }
            if (!isset($d["valorbase"])) {
                $d["valorbase"] = 0;
            }
            if (!isset($d["porcentaje"])) {
                $d["porcentaje"] = 0;
            }
            if (!isset($d["valorservicio"])) {
                $d["valorservicio"] = 0;
            }
            if (!isset($d["expedienteafiliado"])) {
                $d["expedienteafiliado"] = '';
            }
            if (!isset($d["ccos"])) {
                $d["ccos"] = '';
            }

            //            
            $cc = '';
            if ($_SESSION["tramite"]["tipogasto"] == '7') {
                $cc = $_SESSION["tramite"]["camaradestino"];
            }
            if ($_SESSION["tramite"]["tipogasto"] == '8') {
                $cc = $_SESSION["tramite"]["camaraorigen"];
            }

            $fp = '1';
            switch ($_SESSION["tramite"]["idformapago"]) {
                case "02" : $fp = '2';
                    break;
                case "03" : $fp = '7';
                    break;
                case "04" : $fp = '3';
                    break;
                case "05" : $fp = '7';
                    break;
                case "06" : $fp = '5';
                    break;
                case "09" : $fp = '7';
                    break;
                case "90" : $fp = '4';
                    break;
            }

            if ($d["idservicio"] != '') {
                $sec++;

                $arrValores = array(
                    "'" . $recx . "'",
                    "'0'",
                    "'" . $_SESSION["tramite"]["numerofactura"] . "'",
                    "'" . $fecha . "'",
                    "'" . $hora . "'",
                    "'" . $_SESSION["tramite"]["tipoidentificacionpagador"] . "'",
                    "'" . ltrim($_SESSION["tramite"]["identificacionpagador"], "0") . "'",
                    "'" . addslashes(trim($_SESSION["tramite"]["nombrepagador"])) . "'",
                    "'" . $_SESSION["generales"]["cajero"] . "'",
                    "'" . $_SESSION["tramite"]["sede"] . "'",
                    "'" . $d["ccos"] . "'", // Ccos
                    "''", // Unidad
                    "''", // Servicio
                    "'" . $d["idservicio"] . "'",
                    "''", // Servicio descuento
                    intval($d["cantidad"]),
                    doubleval($d["valorservicio"]),
                    "'" . $_SESSION["tramite"]["tipogasto"] . "'",
                    doubleval($d["valorbase"]),
                    "'001'",
                    0,
                    "'" . $cc . "'",
                    "'" . ltrim($d["expediente"], "0") . "'",
                    doubleval($d["valorbase"]),
                    "'" . $d["ano"] . "'",
                    "'" . $fp . "'",
                    "'" . addslashes(substr(trim($_SESSION["tramite"]["apellido1pagador"]), 0, 50)) . "'",
                    "'" . addslashes(substr(trim($_SESSION["tramite"]["apellido2pagador"]), 0, 50)) . "'",
                    "'" . addslashes(substr(trim($_SESSION["tramite"]["nombre1pagador"]), 0, 50)) . "'",
                    "'" . addslashes(substr(trim($_SESSION["tramite"]["nombre2pagador"]), 0, 50)) . "'",
                    "'" . $_SESSION["tramite"]["numerointernorue"] . "'",
                    "'" . $_SESSION["tramite"]["numerounicorue"] . "'",
                    "'" . $operacion . "'",
                    "'" . addslashes(trim($_SESSION["tramite"]["direccionpagador"])) . "'",
                    "'" . addslashes(trim($_SESSION["tramite"]["municipiopagador"])) . "'",
                    "'" . addslashes(trim($_SESSION["tramite"]["telefonopagador"])) . "'",
                    "'" . addslashes(trim($_SESSION["tramite"]["emailpagador"])) . "'",
                    "'NO'",
                    "'" . sprintf("%03s", $_SESSION["tramite"]["proyectocaja"]) . "'",
                    "'" . $d["expedienteafiliado"] . "'"
                );
                $res = insertarRegistrosMysqliApi($mysqli, 'mreg_est_recibos', $arrCampos, $arrValores);
                if ($res === false) {
                    \logApi::general2('generarSecuenciaReciboNuevaSii_' . date("Ymd"), '', 'Error insertando en mreg_est_recibos : ' . $_SESSION["generales"]["mensajeerror"]);
                }
            }
        }

        //
        return $recx;
    }

    public static function grabarAnexoRadicacion($dbx = null, $idradicacion = 0, $numerorecibo = '', $numerooperacion = '', $identificacion = '', $nombre = '', $acreedor = '', $nombreacreedor = '', $matricula = '', $proponente = '', $idtipodoc = '', $numdoc = '', $fechadoc = '', $idorigendoc = '', $txtorigendoc = '', $idclasificacion = '', $numcontrato = '', $idfuente = '', $version = 1, $path = '', $estado = '', $fechaescaneo = '', $idusuarioescaneo = '', $idcajaarchivo = '', $idlibroarchivo = '', $observaciones = '', $libro = '', $registro = '', $dupli = '', $bandeja = '', $soporterecibo = '', $identificador = '', $tipoanexo = '', $procesoespecial = '') {
        if (ltrim($idradicacion, "0") == '') {
            $idradicacion = '';
        }

        if (trim($libro) != '') {
            if (strlen($libro) == 2) {
                if ($bandeja == '6.-REGPRO') {
                    $libro = 'RP' . sprintf("%02s", $libro);
                } else {
                    if ($libro >= '01' && $libro <= '49') {
                        $libro = 'RM' . sprintf("%02s", $libro);
                    } else {
                        $libro = 'RE' . sprintf("%02s", $libro);
                    }
                }
            }
        }

        $arrCampos = array(
            'idradicacion',
            'numerorecibo',
            'numerooperacion',
            'libro',
            'registro',
            'dupli',
            'identificacion',
            'nombre',
            'acreedor',
            'nombreacreedor',
            'matricula',
            'proponente',
            'idtipodoc',
            'numdoc',
            'fechadoc',
            'idorigendoc',
            'txtorigendoc',
            'idclasificacion',
            'numcontrato',
            'idfuente',
            'version',
            'path',
            'estado',
            'fechaescaneo',
            'idusuarioescaneo',
            'idcajaarchivo',
            'idlibroarchivo',
            'observaciones',
            'bandeja',
            'soporterecibo',
            'identificador',
            'tipoanexo',
            'procesosespeciales',
            'eliminado'
        );


        //
        $arrValores = array(
            "'" . ltrim($idradicacion, "0") . "'",
            "'" . $numerorecibo . "'",
            "'" . $numerooperacion . "'",
            "'" . $libro . "'",
            "'" . $registro . "'",
            "'" . $dupli . "'",
            "'" . $identificacion . "'",
            "'" . addslashes(strtoupper($nombre)) . "'",
            "'" . $acreedor . "'",
            "'" . addslashes(strtoupper($nombreacreedor)) . "'",
            "'" . $matricula . "'",
            "'" . $proponente . "'",
            "'" . $idtipodoc . "'",
            "'" . $numdoc . "'",
            "'" . $fechadoc . "'",
            "'" . $idorigendoc . "'",
            "'" . addslashes(strtoupper($txtorigendoc)) . "'",
            "'" . $idclasificacion . "'",
            "'" . $numcontrato . "'",
            "'" . $idfuente . "'",
            $version,
            "'" . $path . "'",
            "'" . $estado . "'",
            "'" . $fechaescaneo . "'",
            "'" . $idusuarioescaneo . "'",
            "'" . $idcajaarchivo . "'",
            "'" . $idlibroarchivo . "'",
            "'" . addslashes(strtoupper($observaciones)) . "'",
            "'" . $bandeja . "'",
            "'" . $soporterecibo . "'",
            "'" . $identificador . "'",
            "'" . $tipoanexo . "'",
            "'" . $procesoespecial . "'",
            "'NO'"
        );
        insertarRegistrosMysqliApi($dbx, 'mreg_radicacionesanexos', $arrCampos, $arrValores, 'si');
        return $_SESSION["generales"]["lastId"];
    }

    public static function grabarHistoricos($dbx, $fecha = '', $hora = '', $mat = '', $pro = '', $tipoid = '', $numid = '', $nom = '', $tt = '', $reg = '', $lib = '', $numreg = '', $rec = '', $ope = '', $codbar = '', $xmlo = '', $xmlf = '', $usu = '', $ip = '') {
        $arrCampos = array(
            'fecha',
            'hora',
            'matricula',
            'proponente',
            'tipoidentificacion',
            'identificacion',
            'nombre',
            'tipotramite',
            'registro',
            'libro',
            'inscripcion',
            'recibo',
            'operacion',
            'codigobarras',
            'xmloriginal',
            'xmlfinal',
            'usuario',
            'ip'
        );
        $arrValores = array(
            "'" . $fecha . "'",
            "'" . $hora . "'",
            "'" . $mat . "'",
            "'" . $pro . "'",
            "'" . $tipoid . "'",
            "'" . $numid . "'",
            "'" . addslashes($nom) . "'",
            "'" . $tt . "'",
            "'" . $reg . "'",
            "'" . $lib . "'",
            "'" . $numreg . "'",
            "'" . $rec . "'",
            "'" . $ope . "'",
            "'" . $codbar . "'",
            "'" . addslashes($xmlo) . "'",
            "'" . addslashes($xmlf) . "'",
            "'" . $usu . "'",
            "'" . $ip . "'"
        );

        insertarRegistrosMysqliApi($dbx, 'mreg_historicos_' . date("Y"), $arrCampos, $arrValores);
    }

    public static function grabarLiquidacionMreg($dbx = null) {
        // require_once ('sanarEntradas.class.php');
        //
        $conteo = contarRegistrosMysqliApi($dbx, 'mreg_liquidacion', 'idliquidacion=' . $_SESSION["tramite"]["numeroliquidacion"]);
        if ($conteo === false) {
            $_SESSION["generales"]["mensajeerror"] = 'Error al ubicar la liquidación en mreg_liquidacion';
            return false;
        }

        //
        if (!isset($_SESSION["tramite"]["tipomatricula"])) {
            $_SESSION["tramite"]["tipomatricula"] = '';
        }

        if (!isset($_SESSION["tramite"]["subtipotramite"])) {
            $_SESSION["tramite"]["subtipotramite"] = '';
        }

        if (!isset($_SESSION["tramite"]["origen"])) {
            $_SESSION["tramite"]["origen"] = '';
        }

        if (!isset($_SESSION["tramite"]["sede"])) {
            $_SESSION["tramite"]["sede"] = '';
        }
        if ($_SESSION["tramite"]["sede"] == '') {
            if ($_SESSION["tramite"]["idusuario"] == 'USUPUBXX') {
                $_SESSION["tramite"]["sede"] = '99';
            } else {
                if ($_SESSION["tramite"]["idusuario"] == 'RUE') {
                    $_SESSION["tramite"]["sede"] = '90';
                } else {
                    if (!isset($_SESSION["generales"]["sedeusuario"])) {
                        $_SESSION["generales"]["sedeusuario"] = '01';
                    }
                    $_SESSION["tramite"]["sede"] = $_SESSION["generales"]["sedeusuario"];
                }
            }
        }
        if ($_SESSION["tramite"]["sede"] == '') {
            $_SESSION["tramite"]["sede"] = '01';
        }

        // Datos base
        if (!isset($_SESSION["tramite"]["matriculabase"])) {
            $_SESSION["tramite"]["matriculabase"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombrebase"])) {
            $_SESSION["tramite"]["nombrebase"] = '';
        }
        if (!isset($_SESSION["tramite"]["nom1base"])) {
            $_SESSION["tramite"]["nom1base"] = '';
        }
        if (!isset($_SESSION["tramite"]["nom2base"])) {
            $_SESSION["tramite"]["nom2base"] = '';
        }
        if (!isset($_SESSION["tramite"]["ape1base"])) {
            $_SESSION["tramite"]["ape1base"] = '';
        }
        if (!isset($_SESSION["tramite"]["ape2base"])) {
            $_SESSION["tramite"]["ape2base"] = '';
        }
        if (!isset($_SESSION["tramite"]["tipoidentificacionbase"])) {
            $_SESSION["tramite"]["tipoidentificacionbase"] = '';
        }
        if (!isset($_SESSION["tramite"]["identificacionbase"])) {
            $_SESSION["tramite"]["identificacionbase"] = '';
        }
        if (!isset($_SESSION["tramite"]["organizacionbase"])) {
            $_SESSION["tramite"]["organizacionbase"] = '';
        }
        if (!isset($_SESSION["tramite"]["categoriabase"])) {
            $_SESSION["tramite"]["categoriabase"] = '';
        }
        if (!isset($_SESSION["tramite"]["afiliadobase"])) {
            $_SESSION["tramite"]["afiliadobase"] = '';
        }

        if (!isset($_SESSION["tramite"]["idexpedientebase"])) {
            $_SESSION["tramite"]["idexpedientebase"] = '';
        }
        if (!isset($_SESSION["tramite"]["idmatriculabase"])) {
            $_SESSION["tramite"]["idmatriculabase"] = '';
        }
        if (!isset($_SESSION["tramite"]["idproponentebase"])) {
            $_SESSION["tramite"]["idproponentebase"] = '';
        }
        if (!isset($_SESSION["tramite"]["tipoproponente"])) {
            $_SESSION["tramite"]["tipoproponente"] = '';
        }

        // Datos del cliente
        if (!isset($_SESSION["tramite"]["tipocliente"])) {
            $_SESSION["tramite"]["tipocliente"] = '';
        }
        if (!isset($_SESSION["tramite"]["razonsocialcliente"])) {
            $_SESSION["tramite"]["razonsocialcliente"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellidocliente"])) {
            $_SESSION["tramite"]["apellidocliente"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido1cliente"])) {
            $_SESSION["tramite"]["apellido1cliente"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido2cliente"])) {
            $_SESSION["tramite"]["apellido2cliente"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre1cliente"])) {
            $_SESSION["tramite"]["nombre1cliente"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre2cliente"])) {
            $_SESSION["tramite"]["nombre2cliente"] = '';
        }

        // Datos del pagador
        if (!isset($_SESSION["tramite"]["tipopagador"])) {
            $_SESSION["tramite"]["tipopagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["razonsocialpagador"])) {
            $_SESSION["tramite"]["razonsocialpagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre1pagador"])) {
            $_SESSION["tramite"]["nombre1pagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre2pagador"])) {
            $_SESSION["tramite"]["nombre2pagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido1pagador"])) {
            $_SESSION["tramite"]["apellido1pagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido2pagador"])) {
            $_SESSION["tramite"]["apellido2pagador"] = '';
        }

        if (!isset($_SESSION["tramite"]["movilpagador"])) {
            $_SESSION["tramite"]["movilpagador"] = '';
        }


        if (!isset($_SESSION["tramite"]["idsolicitudpago"])) {
            $_SESSION["tramite"]["idsolicitudpago"] = '';
        }
        if ($_SESSION["tramite"]["idsolicitudpago"] == '') {
            $_SESSION["tramite"]["idsolicitudpago"] = 0;
        }

        //
        if (!isset($_SESSION["tramite"]["alertaid"])) {
            $_SESSION["tramite"]["alertaid"] = 0;
        }
        if (!isset($_SESSION["tramite"]["alertaservicio"])) {
            $_SESSION["tramite"]["alertaservicio"] = '';
        }
        if (!isset($_SESSION["tramite"]["alertavalor"])) {
            $_SESSION["tramite"]["alertavalor"] = 0;
        }
        if (!isset($_SESSION["tramite"]["ctrcancelacion"])) {
            $_SESSION["tramite"]["ctrcancelacion"] = '';
        }
        if (!isset($_SESSION["tramite"]["idasesor"])) {
            $_SESSION["tramite"]["idasesor"] = '';
        }
        if (!isset($_SESSION["tramite"]["numeroempleados"])) {
            $_SESSION["tramite"]["numeroempleados"] = 0;
        }
        if (!isset($_SESSION["tramite"]["nombrepagador"])) {
            $_SESSION["tramite"]["nombrepagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellidopagador"])) {
            $_SESSION["tramite"]["apellidopagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["tipoidentificacionpagador"])) {
            $_SESSION["tramite"]["tipoidentificacionpagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["identificacionpagador"])) {
            $_SESSION["tramite"]["identificacionpagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["direccionpagador"])) {
            $_SESSION["tramite"]["direccionpagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["telefonopagador"])) {
            $_SESSION["tramite"]["telefonopagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["municipiopagador"])) {
            $_SESSION["tramite"]["municipiopagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailpagador"])) {
            $_SESSION["tramite"]["emailpagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["pagoprepago"])) {
            $_SESSION["tramite"]["pagoprepago"] = 0;
        }
        if (!isset($_SESSION["tramite"]["pagoafiliado"])) {
            $_SESSION["tramite"]["pagoafiliado"] = 0;
        }
        if (!isset($_SESSION["tramite"]["pagoacredito"])) {
            $_SESSION["tramite"]["pagoacredito"] = 0;
        }
        if (!isset($_SESSION["tramite"]["pagoconsignacion"])) {
            $_SESSION["tramite"]["pagoconsignacion"] = 0;
        }
        if (!isset($_SESSION["tramite"]["proyectocaja"])) {
            $_SESSION["tramite"]["proyectocaja"] = '001';
        }
        if (!isset($_SESSION["tramite"]["cargoafiliacion"])) {
            $_SESSION["tramite"]["cargoafiliacion"] = 'NO';
        }
        if (!isset($_SESSION["tramite"]["cargogastoadministrativo"])) {
            $_SESSION["tramite"]["cargogastoadministrativo"] = 'NO';
        }
        if (!isset($_SESSION["tramite"]["cargoentidadoficial"])) {
            $_SESSION["tramite"]["cargoentidadoficial"] = 'NO';
        }
        if (!isset($_SESSION["tramite"]["cargoconsulta"])) {
            $_SESSION["tramite"]["cargoconsulta"] = 'NO';
        }
        if (!isset($_SESSION["tramite"]["actualizacionciiuversion4"])) {
            $_SESSION["tramite"]["actualizacionciiuversion4"] = 'NO';
        }
        if (!isset($_SESSION["tramite"]["domicilioorigen"])) {
            $_SESSION["tramite"]["domicilioorigen"] = '';
        }
        if (!isset($_SESSION["tramite"]["domiciliodestino"])) {
            $_SESSION["tramite"]["domiciliodestino"] = '';
        }
        if (!isset($_SESSION["tramite"]["reliquidacion"])) {
            $_SESSION["tramite"]["reliquidacion"] = '';
        }
        if (!isset($_SESSION["tramite"]["pagoafiliacion"])) {
            $_SESSION["tramite"]["pagoafiliacion"] = '';
        }
        if (!isset($_SESSION["tramite"]["numerofactura"])) {
            $_SESSION["tramite"]["numerofactura"] = '';
        }
        if (!isset($_SESSION["tramite"]["nrocontrolsipref"])) {
            $_SESSION["tramite"]["nrocontrolsipref"] = '';
        }
        if (!isset($_SESSION["tramite"]["tipoideradicador"])) {
            $_SESSION["tramite"]["tipoideradicador"] = '';
        }
        if (!isset($_SESSION["tramite"]["ideradicador"])) {
            $_SESSION["tramite"]["ideradicador"] = '';
        }
        if (!isset($_SESSION["tramite"]["fechaexpradicador"])) {
            $_SESSION["tramite"]["fechaexpradicador"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombreradicador"])) {
            $_SESSION["tramite"]["nombreradicador"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombrebanco"])) {
            $_SESSION["tramite"]["nombrebanco"] = '';
        }

        if (!isset($_SESSION["tramite"]["orgpnat"])) {
            $_SESSION["tramite"]["orgpnat"] = '';
        }
        if (!isset($_SESSION["tramite"]["tipoidepnat"])) {
            $_SESSION["tramite"]["tipoidepnat"] = '';
        }
        if (!isset($_SESSION["tramite"]["idepnat"])) {
            $_SESSION["tramite"]["idepnat"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombrepnat"])) {
            $_SESSION["tramite"]["nombrepnat"] = '';
        }
        if (!isset($_SESSION["tramite"]["actpnat"])) {
            $_SESSION["tramite"]["actpnat"] = '';
        }
        if (!isset($_SESSION["tramite"]["perpnat"])) {
            $_SESSION["tramite"]["perpnat"] = '';
        }
        if (!isset($_SESSION["tramite"]["munpnat"])) {
            $_SESSION["tramite"]["munpnat"] = '';
        }

        if (!isset($_SESSION["tramite"]["numeromatriculapnat"])) {
            $_SESSION["tramite"]["numeromatriculapnat"] = '';
        }
        if (!isset($_SESSION["tramite"]["camarapnat"])) {
            $_SESSION["tramite"]["camarapnat"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombreest"])) {
            $_SESSION["tramite"]["nombreest"] = '';
        }
        if (!isset($_SESSION["tramite"]["actest"])) {
            $_SESSION["tramite"]["actest"] = '';
        }
        if (!isset($_SESSION["tramite"]["munest"])) {
            $_SESSION["tramite"]["munest"] = '';
        }
        if (!isset($_SESSION["tramite"]["ultanoren"])) {
            $_SESSION["tramite"]["ultanoren"] = '';
        }
        if (!isset($_SESSION["tramite"]["incluirformularios"])) {
            $_SESSION["tramite"]["incluirformularios"] = '';
        }
        if (!isset($_SESSION["tramite"]["incluircertificados"])) {
            $_SESSION["tramite"]["incluircertificados"] = '';
        }
        if (!isset($_SESSION["tramite"]["incluirdiploma"])) {
            $_SESSION["tramite"]["incluirdiploma"] = '';
        }
        if (!isset($_SESSION["tramite"]["incluircartulina"])) {
            $_SESSION["tramite"]["incluircartulina"] = '';
        }
        if (!isset($_SESSION["tramite"]["matricularpnat"])) {
            $_SESSION["tramite"]["matricularpnat"] = '';
        }
        if (!isset($_SESSION["tramite"]["matricularest"])) {
            $_SESSION["tramite"]["matricularest"] = '';
        }
        if (!isset($_SESSION["tramite"]["regimentributario"])) {
            $_SESSION["tramite"]["regimentributario"] = '';
        }
        if (!isset($_SESSION["tramite"]["benart7"])) {
            $_SESSION["tramite"]["benart7"] = 'N';
        }
        if (!isset($_SESSION["tramite"]["benley1780"])) {
            $_SESSION["tramite"]["benley1780"] = 'N';
        }
        if (!isset($_SESSION["tramite"]["fechanacimientopnat"])) {
            $_SESSION["tramite"]["fechanacimientopnat"] = '';
        }
        if (!isset($_SESSION["tramite"]["controlfirma"])) {
            $_SESSION["tramite"]["controlfirma"] = 'N';
        }
        if (!isset($_SESSION["tramite"]["modcom"])) {
            $_SESSION["tramite"]["modcom"] = 'N';
        }
        if (!isset($_SESSION["tramite"]["modnot"])) {
            $_SESSION["tramite"]["modnot"] = 'N';
        }
        if (!isset($_SESSION["tramite"]["modciiu"])) {
            $_SESSION["tramite"]["modciiu"] = 'N';
        }
        if (!isset($_SESSION["tramite"]["modnombre"])) {
            $_SESSION["tramite"]["modnombre"] = 'N';
        }

        if (!isset($_SESSION["tramite"]["nombrepjur"])) {
            $_SESSION["tramite"]["nombrepjur"] = '';
        }
        if (!isset($_SESSION["tramite"]["perpjur"])) {
            $_SESSION["tramite"]["perpjur"] = '';
        }
        if (!isset($_SESSION["tramite"]["actpjur"])) {
            $_SESSION["tramite"]["actpjur"] = '';
        }
        if (!isset($_SESSION["tramite"]["munpjur"])) {
            $_SESSION["tramite"]["munpjur"] = '';
        }
        if (!isset($_SESSION["tramite"]["orgpjur"])) {
            $_SESSION["tramite"]["orgpjur"] = '';
        }

        if (!isset($_SESSION["tramite"]["nombresuc"])) {
            $_SESSION["tramite"]["nombresuc"] = '';
        }
        if (!isset($_SESSION["tramite"]["actsuc"])) {
            $_SESSION["tramite"]["actsuc"] = '';
        }
        if (!isset($_SESSION["tramite"]["munsuc"])) {
            $_SESSION["tramite"]["munsuc"] = '';
        }
        if (!isset($_SESSION["tramite"]["orgsuc"])) {
            $_SESSION["tramite"]["orgsuc"] = '';
        }

        if (!isset($_SESSION["tramite"]["nombreage"])) {
            $_SESSION["tramite"]["nombreage"] = '';
        }
        if (!isset($_SESSION["tramite"]["actage"])) {
            $_SESSION["tramite"]["actage"] = '';
        }
        if (!isset($_SESSION["tramite"]["munage"])) {
            $_SESSION["tramite"]["munage"] = '';
        }
        if (!isset($_SESSION["tramite"]["orgage"])) {
            $_SESSION["tramite"]["orgage"] = '';
        }

        if (!isset($_SESSION["tramite"]["matriculacambidom"])) {
            $_SESSION["tramite"]["matriculacambidom"] = '';
        }
        if (!isset($_SESSION["tramite"]["camaracambidom"])) {
            $_SESSION["tramite"]["camaracambidom"] = '';
        }
        if (!isset($_SESSION["tramite"]["municipiocambidom"])) {
            $_SESSION["tramite"]["municipiocambidom"] = '';
        }
        if (!isset($_SESSION["tramite"]["fecmatcambidom"])) {
            $_SESSION["tramite"]["fecmatcambidom"] = '';
        }
        if (!isset($_SESSION["tramite"]["fecrencambidom"])) {
            $_SESSION["tramite"]["fecrencambidom"] = '';
        }

        if (ltrim($_SESSION["tramite"]["actpnat"], "0") == '') {
            $_SESSION["tramite"]["actpnat"] = 0;
        }
        if (ltrim($_SESSION["tramite"]["perpnat"], "0") == '') {
            $_SESSION["tramite"]["perpnat"] = 0;
        }
        if (ltrim($_SESSION["tramite"]["perpjur"], "0") == '') {
            $_SESSION["tramite"]["perpjur"] = 0;
        }
        if (ltrim($_SESSION["tramite"]["actest"], "0") == '') {
            $_SESSION["tramite"]["actest"] = 0;
        }
        if (ltrim($_SESSION["tramite"]["actpjur"], "0") == '') {
            $_SESSION["tramite"]["actpjur"] = 0;
        }
        if (ltrim($_SESSION["tramite"]["actsuc"], "0") == '') {
            $_SESSION["tramite"]["actsuc"] = 0;
        }
        if (ltrim($_SESSION["tramite"]["actage"], "0") == '') {
            $_SESSION["tramite"]["actage"] = 0;
        }

        if (!isset($_SESSION["tramite"]["capital"])) {
            $_SESSION["tramite"]["capital"] = 0;
        }
        if (!isset($_SESSION["tramite"]["tipodoc"])) {
            $_SESSION["tramite"]["tipodoc"] = '';
        }
        if (!isset($_SESSION["tramite"]["numdoc"])) {
            $_SESSION["tramite"]["numdoc"] = '';
        }
        if (!isset($_SESSION["tramite"]["fechadoc"])) {
            $_SESSION["tramite"]["fechadoc"] = '';
        }
        if (!isset($_SESSION["tramite"]["origendoc"])) {
            $_SESSION["tramite"]["origendoc"] = '';
        }
        if (!isset($_SESSION["tramite"]["mundoc"])) {
            $_SESSION["tramite"]["mundoc"] = '';
        }
        if (!isset($_SESSION["tramite"]["organizacion"])) {
            $_SESSION["tramite"]["organizacion"] = '';
        }
        if (!isset($_SESSION["tramite"]["categoria"])) {
            $_SESSION["tramite"]["categoria"] = '';
        }

        if (!isset($_SESSION["tramite"]["tipoiderepleg"])) {
            $_SESSION["tramite"]["tipoiderepleg"] = '';
        }
        if (!isset($_SESSION["tramite"]["iderepleg"])) {
            $_SESSION["tramite"]["iderepleg"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombrerepleg"])) {
            $_SESSION["tramite"]["nombrerepleg"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre1repleg"])) {
            $_SESSION["tramite"]["nombre1repleg"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre2repleg"])) {
            $_SESSION["tramite"]["nombre2repleg"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido1repleg"])) {
            $_SESSION["tramite"]["apellido1repleg"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido2repleg"])) {
            $_SESSION["tramite"]["apellido2repleg"] = '';
        }
        if (!isset($_SESSION["tramite"]["cargorepleg"])) {
            $_SESSION["tramite"]["cargorepleg"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailrepleg"])) {
            $_SESSION["tramite"]["emailrepleg"] = '';
        }
        if (!isset($_SESSION["tramite"]["firmorepleg"])) {
            $_SESSION["tramite"]["firmorepleg"] = '';
        }
        if (!isset($_SESSION["tramite"]["celularrepleg"])) {
            $_SESSION["tramite"]["celularrepleg"] = '';
        }

        if (!isset($_SESSION["tramite"]["tipoideradicador"])) {
            $_SESSION["tramite"]["tipoideradicador"] = '';
        }
        if (!isset($_SESSION["tramite"]["ideradicador"])) {
            $_SESSION["tramite"]["ideradicador"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombreradicador"])) {
            $_SESSION["tramite"]["nombreradicador"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailradicador"])) {
            $_SESSION["tramite"]["emailradicador"] = '';
        }
        if (!isset($_SESSION["tramite"]["telefonoradicador"])) {
            $_SESSION["tramite"]["telefonoradicador"] = '';
        }
        if (!isset($_SESSION["tramite"]["celularradicador"])) {
            $_SESSION["tramite"]["celularradicador"] = '';
        }

        if (!isset($_SESSION["tramite"]["tipolibro"])) {
            $_SESSION["tramite"]["tipolibro"] = '';
        }
        if (!isset($_SESSION["tramite"]["codigolibro"])) {
            $_SESSION["tramite"]["codigolibro"] = '';
        }
        if (!isset($_SESSION["tramite"]["primeravez"])) {
            $_SESSION["tramite"]["primeravez"] = '';
        }
        if (!isset($_SESSION["tramite"]["confirmadigital"])) {
            $_SESSION["tramite"]["confirmadigital"] = '';
        }

        if (!isset($_SESSION["tramite"]["iderevfis"])) {
            $_SESSION["tramite"]["iderevfis"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre1revfis"])) {
            $_SESSION["tramite"]["nombre1revfis"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre2revfis"])) {
            $_SESSION["tramite"]["nombre2revfis"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido1revfis"])) {
            $_SESSION["tramite"]["apellido1revfis"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido2revfis"])) {
            $_SESSION["tramite"]["apellido2revfis"] = '';
        }
        if (!isset($_SESSION["tramite"]["cargorevfis"])) {
            $_SESSION["tramite"]["cargorevfis"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailrevfis"])) {
            $_SESSION["tramite"]["emailrevfis"] = '';
        }
        if (!isset($_SESSION["tramite"]["firmorevfis"])) {
            $_SESSION["tramite"]["firmorevfis"] = '';
        }
        if (!isset($_SESSION["tramite"]["celularrevfis"])) {
            $_SESSION["tramite"]["celularrevfis"] = '';
        }

        if (!isset($_SESSION["tramite"]["idepreasa"])) {
            $_SESSION["tramite"]["idepreasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre1preasa"])) {
            $_SESSION["tramite"]["nombre1preasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre2preasa"])) {
            $_SESSION["tramite"]["nombre2preasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido1preasa"])) {
            $_SESSION["tramite"]["apellido1preasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido2preasa"])) {
            $_SESSION["tramite"]["apellido2preasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["cargopreasa"])) {
            $_SESSION["tramite"]["cargopreasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailpreasa"])) {
            $_SESSION["tramite"]["emailpreasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["firmopreasa"])) {
            $_SESSION["tramite"]["firmopreasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["celularpreasa"])) {
            $_SESSION["tramite"]["celularpreasa"] = '';
        }

        if (!isset($_SESSION["tramite"]["idesecasa"])) {
            $_SESSION["tramite"]["idesecasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre1secasa"])) {
            $_SESSION["tramite"]["nombre1secasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre2secasa"])) {
            $_SESSION["tramite"]["nombre2secasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido1secasa"])) {
            $_SESSION["tramite"]["apellido1secasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido2secasa"])) {
            $_SESSION["tramite"]["apellido2secasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["cargosecasa"])) {
            $_SESSION["tramite"]["cargosecasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailsecasa"])) {
            $_SESSION["tramite"]["emailsecasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["firmosecasa"])) {
            $_SESSION["tramite"]["firmosecasa"] = '';
        }
        if (!isset($_SESSION["tramite"]["celularsecasa"])) {
            $_SESSION["tramite"]["celularsecasa"] = '';
        }

        if (ltrim($_SESSION["tramite"]["actpnat"], "0") == '') {
            $_SESSION["tramite"]["actpnat"] = 0;
        }
        if (ltrim($_SESSION["tramite"]["perpnat"], "0") == '') {
            $_SESSION["tramite"]["perpnat"] = 0;
        }
        if (ltrim($_SESSION["tramite"]["actest"], "0") == '') {
            $_SESSION["tramite"]["actest"] = 0;
        }
        if (ltrim($_SESSION["tramite"]["capital"], "0") == '') {
            $_SESSION["tramite"]["capital"] = 0;
        }

        if (!isset($_SESSION["tramite"]["tipoidentificacionaceptante"])) {
            $_SESSION["tramite"]["tipoidentificacionaceptante"] = '';
        }
        if (!isset($_SESSION["tramite"]["identificacionaceptante"])) {
            $_SESSION["tramite"]["identificacionaceptante"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre1aceptante"])) {
            $_SESSION["tramite"]["nombre1aceptante"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre2aceptante"])) {
            $_SESSION["tramite"]["nombre2aceptante"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido1aceptante"])) {
            $_SESSION["tramite"]["apellido1aceptante"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido2aceptante"])) {
            $_SESSION["tramite"]["apellido2aceptante"] = '';
        }
        if (!isset($_SESSION["tramite"]["direccionaceptante"])) {
            $_SESSION["tramite"]["direccionaceptante"] = '';
        }
        if (!isset($_SESSION["tramite"]["municipioaceptante"])) {
            $_SESSION["tramite"]["municipioaceptante"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailaceptante"])) {
            $_SESSION["tramite"]["emailaceptante"] = '';
        }
        if (!isset($_SESSION["tramite"]["telefonoaceptante"])) {
            $_SESSION["tramite"]["telefonoaceptante"] = '';
        }
        if (!isset($_SESSION["tramite"]["celularaceptante"])) {
            $_SESSION["tramite"]["celularaceptante"] = '';
        }
        if (!isset($_SESSION["tramite"]["cargoaceptante"])) {
            $_SESSION["tramite"]["cargoaceptante"] = '';
        }
        if (!isset($_SESSION["tramite"]["fechadocideaceptante"])) {
            $_SESSION["tramite"]["fechadocideaceptante"] = '';
        }

        if (!isset($_SESSION["tramite"]["motivocorreccion"])) {
            $_SESSION["tramite"]["motivocorreccion"] = '';
        }
        if (!isset($_SESSION["tramite"]["tipoerror1"])) {
            $_SESSION["tramite"]["tipoerror1"] = '';
        }
        if (!isset($_SESSION["tramite"]["tipoerror2"])) {
            $_SESSION["tramite"]["tipoerror2"] = '';
        }
        if (!isset($_SESSION["tramite"]["tipoerror3"])) {
            $_SESSION["tramite"]["tipoerror3"] = '';
        }
        if (!isset($_SESSION["tramite"]["tipoidentificacioncor"])) {
            $_SESSION["tramite"]["tipoidentificacioncor"] = '';
        }
        if (!isset($_SESSION["tramite"]["identificacioncor"])) {
            $_SESSION["tramite"]["identificacioncor"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre1cor"])) {
            $_SESSION["tramite"]["nombre1cor"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre2cor"])) {
            $_SESSION["tramite"]["nombre2cor"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido1cor"])) {
            $_SESSION["tramite"]["apellido1cor"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido2cor"])) {
            $_SESSION["tramite"]["apellido2cor"] = '';
        }
        if (!isset($_SESSION["tramite"]["direccioncor"])) {
            $_SESSION["tramite"]["direccioncor"] = '';
        }
        if (!isset($_SESSION["tramite"]["municipiocor"])) {
            $_SESSION["tramite"]["municipiocor"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailcor"])) {
            $_SESSION["tramite"]["emailcor"] = '';
        }
        if (!isset($_SESSION["tramite"]["telefonocor"])) {
            $_SESSION["tramite"]["telefonocor"] = '';
        }
        if (!isset($_SESSION["tramite"]["celularcor"])) {
            $_SESSION["tramite"]["celularcor"] = '';
        }


        if (!isset($_SESSION["tramite"]["descripcionembargo"])) {
            $_SESSION["tramite"]["descripcionembargo"] = '';
        }
        if (!isset($_SESSION["tramite"]["descripciondesembargo"])) {
            $_SESSION["tramite"]["descripciondesembargo"] = '';
        }
        if (!isset($_SESSION["tramite"]["tipoidentificaciondemandante"])) {
            $_SESSION["tramite"]["tipoidentificaciondemandante"] = '';
        }
        if (!isset($_SESSION["tramite"]["identificaciondemandante"])) {
            $_SESSION["tramite"]["identificaciondemandante"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombredemandante"])) {
            $_SESSION["tramite"]["nombredemandante"] = '';
        }
        if (!isset($_SESSION["tramite"]["libro"])) {
            $_SESSION["tramite"]["libro"] = '';
        }
        if (!isset($_SESSION["tramite"]["numreg"])) {
            $_SESSION["tramite"]["numreg"] = '';
        }

        if (!isset($_SESSION["tramite"]["descripcionpqr"])) {
            $_SESSION["tramite"]["descripcionpqr"] = '';
        }
        if (!isset($_SESSION["tramite"]["tipoidentificacionpqr"])) {
            $_SESSION["tramite"]["tipoidentificacionpqr"] = '';
        }
        if (!isset($_SESSION["tramite"]["identificacionpqr"])) {
            $_SESSION["tramite"]["identificacionpqr"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre1pqr"])) {
            $_SESSION["tramite"]["nombre1pqr"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre2pqr"])) {
            $_SESSION["tramite"]["nombre2pqr"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido1pqr"])) {
            $_SESSION["tramite"]["apellido1pqr"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido2pqr"])) {
            $_SESSION["tramite"]["apellido2pqr"] = '';
        }
        if (!isset($_SESSION["tramite"]["direccionpqr"])) {
            $_SESSION["tramite"]["direccionpqr"] = '';
        }
        if (!isset($_SESSION["tramite"]["municipiopqr"])) {
            $_SESSION["tramite"]["municipiopqr"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailpqr"])) {
            $_SESSION["tramite"]["emailpqr"] = '';
        }
        if (!isset($_SESSION["tramite"]["telefonopqr"])) {
            $_SESSION["tramite"]["telefonopqr"] = '';
        }
        if (!isset($_SESSION["tramite"]["celularpqr"])) {
            $_SESSION["tramite"]["celularpqr"] = '';
        }

        if (!isset($_SESSION["tramite"]["descripcionrr"])) {
            $_SESSION["tramite"]["descripcionrr"] = '';
        }
        if (!isset($_SESSION["tramite"]["inscripcionrr"])) {
            $_SESSION["tramite"]["inscripcionrr"] = '';
        }
        if (!isset($_SESSION["tramite"]["tipoidentificacionrr"])) {
            $_SESSION["tramite"]["tipoidentificacionrr"] = '';
        }
        if (!isset($_SESSION["tramite"]["identificacionrr"])) {
            $_SESSION["tramite"]["identificacionrr"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre1rr"])) {
            $_SESSION["tramite"]["nombre1rr"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre2rr"])) {
            $_SESSION["tramite"]["nombre2rr"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido1rr"])) {
            $_SESSION["tramite"]["apellido1rr"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido2rr"])) {
            $_SESSION["tramite"]["apellido2rr"] = '';
        }
        if (!isset($_SESSION["tramite"]["direccionrr"])) {
            $_SESSION["tramite"]["direccionrr"] = '';
        }
        if (!isset($_SESSION["tramite"]["municipiorr"])) {
            $_SESSION["tramite"]["municipiorr"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailrr"])) {
            $_SESSION["tramite"]["emailrr"] = '';
        }
        if (!isset($_SESSION["tramite"]["telefonorr"])) {
            $_SESSION["tramite"]["telefonorr"] = '';
        }
        if (!isset($_SESSION["tramite"]["celularrr"])) {
            $_SESSION["tramite"]["celularrr"] = '';
        }
        if (!isset($_SESSION["tramite"]["subsidioapelacionrr"])) {
            $_SESSION["tramite"]["subsidioapelacionrr"] = '';
        }

        if (!isset($_SESSION["tramite"]["tipocertificado"])) {
            $_SESSION["tramite"]["tipocertificado"] = '';
        }
        if (!isset($_SESSION["tramite"]["explicacion"])) {
            $_SESSION["tramite"]["explicacion"] = '';
        }
        if (!isset($_SESSION["tramite"]["textolibre"])) {
            $_SESSION["tramite"]["textolibre"] = '';
        }

        // Datos de mutación de direccion - comercial
        if (!isset($_SESSION["tramite"]["ant_dircom"])) {
            $_SESSION["tramite"]["ant_dircom"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_telcom1"])) {
            $_SESSION["tramite"]["ant_telcom1"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_telcom2"])) {
            $_SESSION["tramite"]["ant_telcom2"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_faxcom"])) {
            $_SESSION["tramite"]["ant_faxcom"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_celcom"])) {
            $_SESSION["tramite"]["ant_celcom"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_barriocom"])) {
            $_SESSION["tramite"]["ant_barriocom"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_muncom"])) {
            $_SESSION["tramite"]["ant_muncom"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_emailcom"])) {
            $_SESSION["tramite"]["ant_emailcom"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_emailcom2"])) {
            $_SESSION["tramite"]["ant_emailcom2"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_emailcom3"])) {
            $_SESSION["tramite"]["ant_emailcom3"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_numpredial"])) {
            $_SESSION["tramite"]["ant_numpredial"] = '';
        }

        if (!isset($_SESSION["tramite"]["dircom"])) {
            $_SESSION["tramite"]["dircom"] = '';
        }
        if (!isset($_SESSION["tramite"]["telcom1"])) {
            $_SESSION["tramite"]["telcom1"] = '';
        }
        if (!isset($_SESSION["tramite"]["telcom2"])) {
            $_SESSION["tramite"]["telcom2"] = '';
        }
        if (!isset($_SESSION["tramite"]["faxcom"])) {
            $_SESSION["tramite"]["faxcom"] = '';
        }
        if (!isset($_SESSION["tramite"]["celcom"])) {
            $_SESSION["tramite"]["celcom"] = '';
        }
        if (!isset($_SESSION["tramite"]["barriocom"])) {
            $_SESSION["tramite"]["barriocom"] = '';
        }
        if (!isset($_SESSION["tramite"]["muncom"])) {
            $_SESSION["tramite"]["muncom"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailcom"])) {
            $_SESSION["tramite"]["emailcom"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailcom2"])) {
            $_SESSION["tramite"]["emailcom2"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailcom3"])) {
            $_SESSION["tramite"]["emailcom3"] = '';
        }
        if (!isset($_SESSION["tramite"]["numpredial"])) {
            $_SESSION["tramite"]["numpredial"] = '';
        }

        // Datos de mutación de direccion - notificación
        if (!isset($_SESSION["tramite"]["ant_dirnot"])) {
            $_SESSION["tramite"]["ant_dirnot"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_telnot1"])) {
            $_SESSION["tramite"]["ant_telnot1"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_telnot2"])) {
            $_SESSION["tramite"]["ant_telnot2"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_faxnot"])) {
            $_SESSION["tramite"]["ant_faxnot"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_celnot"])) {
            $_SESSION["tramite"]["ant_celnot"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_barrionot"])) {
            $_SESSION["tramite"]["ant_barrionot"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_munnot"])) {
            $_SESSION["tramite"]["ant_munnot"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_emailnot"])) {
            $_SESSION["tramite"]["ant_emailnot"] = '';
        }

        if (!isset($_SESSION["tramite"]["dirnot"])) {
            $_SESSION["tramite"]["dirnot"] = '';
        }
        if (!isset($_SESSION["tramite"]["telnot1"])) {
            $_SESSION["tramite"]["telnot1"] = '';
        }
        if (!isset($_SESSION["tramite"]["telnot2"])) {
            $_SESSION["tramite"]["telnot2"] = '';
        }
        if (!isset($_SESSION["tramite"]["faxnot"])) {
            $_SESSION["tramite"]["faxnot"] = '';
        }
        if (!isset($_SESSION["tramite"]["celnot"])) {
            $_SESSION["tramite"]["celnot"] = '';
        }
        if (!isset($_SESSION["tramite"]["barrionot"])) {
            $_SESSION["tramite"]["barrionot"] = '';
        }
        if (!isset($_SESSION["tramite"]["munnot"])) {
            $_SESSION["tramite"]["munnot"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailnot"])) {
            $_SESSION["tramite"]["emailnot"] = '';
        }

        // Datos de mutación de actividad
        if (!isset($_SESSION["tramite"]["ant_versionciiu"])) {
            $_SESSION["tramite"]["ant_versionciiu"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_ciiu11"])) {
            $_SESSION["tramite"]["ant_ciiu11"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_ciiu12"])) {
            $_SESSION["tramite"]["ant_ciiu12"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_ciiu13"])) {
            $_SESSION["tramite"]["ant_ciiu13"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_ciiu14"])) {
            $_SESSION["tramite"]["ant_ciiu14"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_ciiu21"])) {
            $_SESSION["tramite"]["ant_ciiu21"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_ciiu22"])) {
            $_SESSION["tramite"]["ant_ciiu22"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_ciiu23"])) {
            $_SESSION["tramite"]["ant_ciiu23"] = '';
        }
        if (!isset($_SESSION["tramite"]["ant_ciiu24"])) {
            $_SESSION["tramite"]["ant_ciiu24"] = '';
        }

        if (!isset($_SESSION["tramite"]["versionciiu"])) {
            $_SESSION["tramite"]["versionciiu"] = '';
        }
        if (!isset($_SESSION["tramite"]["ciiu11"])) {
            $_SESSION["tramite"]["ciiu11"] = '';
        }
        if (!isset($_SESSION["tramite"]["ciiu12"])) {
            $_SESSION["tramite"]["ciiu12"] = '';
        }
        if (!isset($_SESSION["tramite"]["ciiu13"])) {
            $_SESSION["tramite"]["ciiu13"] = '';
        }
        if (!isset($_SESSION["tramite"]["ciiu14"])) {
            $_SESSION["tramite"]["ciiu14"] = '';
        }
        if (!isset($_SESSION["tramite"]["ciiu21"])) {
            $_SESSION["tramite"]["ciiu21"] = '';
        }
        if (!isset($_SESSION["tramite"]["ciiu22"])) {
            $_SESSION["tramite"]["ciiu22"] = '';
        }
        if (!isset($_SESSION["tramite"]["ciiu23"])) {
            $_SESSION["tramite"]["ciiu23"] = '';
        }
        if (!isset($_SESSION["tramite"]["ciiu24"])) {
            $_SESSION["tramite"]["ciiu24"] = '';
        }

        // Datos mutación de nombre
        if (!isset($_SESSION["tramite"]["nombreanterior"])) {
            $_SESSION["tramite"]["nombreanterior"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombrenuevo"])) {
            $_SESSION["tramite"]["nombrenuevo"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombrenuevo"])) {
            $_SESSION["tramite"]["nombrenuevo"] = '';
        }
        if (!isset($_SESSION["tramite"]["nuevonombre"])) {
            $_SESSION["tramite"]["nuevonombre"] = '';
        }

        // Datos del afiliado
        if (!isset($_SESSION["tramite"]["matriculaafiliado"])) {
            $_SESSION["tramite"]["matriculaafiliado"] = '';
        }
        if (!isset($_SESSION["tramite"]["opcionafiliado"])) {
            $_SESSION["tramite"]["opcionafiliado"] = '';
        }
        if (!isset($_SESSION["tramite"]["saldoafiliado"])) {
            $_SESSION["tramite"]["saldoafiliado"] = 0;
        }
        if (!isset($_SESSION["tramite"]["ultanorenafi"])) {
            $_SESSION["tramite"]["ultanorenafi"] = '';
        }

        // Variables de trámites rues
        if (!isset($_SESSION["tramite"]["rues_empleados"])) {
            $_SESSION["tramite"]["rues_empleados"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_numerointerno"])) {
            $_SESSION["tramite"]["rues_numerointerno"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_numerounico"])) {
            $_SESSION["tramite"]["rues_numerounico"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_camarareceptora"])) {
            $_SESSION["tramite"]["rues_camarareceptora"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_camararesponsable"])) {
            $_SESSION["tramite"]["rues_camararesponsable"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_matricula"])) {
            $_SESSION["tramite"]["rues_matricula"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_proponente"])) {
            $_SESSION["tramite"]["rues_proponente"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_nombreregistrado"])) {
            $_SESSION["tramite"]["rues_nombreregistrado"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_claseidentificacion"])) {
            $_SESSION["tramite"]["rues_claseidentificacion"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_numeroidentificacion"])) {
            $_SESSION["tramite"]["rues_numeroidentificacion"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_dv"])) {
            $_SESSION["tramite"]["rues_dv"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_estado_liquidacion"])) {
            $_SESSION["tramite"]["rues_estado_liquidacion"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_estado_transaccion"])) {
            $_SESSION["tramite"]["rues_estado_transaccion"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_nombrepagador"])) {
            $_SESSION["tramite"]["rues_nombrepagador"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_origendocumento"])) {
            $_SESSION["tramite"]["rues_origendocumento"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_fechadocumento"])) {
            $_SESSION["tramite"]["rues_fechadocumento"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_fechapago"])) {
            $_SESSION["tramite"]["rues_fechapago"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_numerofactura"])) {
            $_SESSION["tramite"]["rues_numerofactura"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_referenciaoperacion"])) {
            $_SESSION["tramite"]["rues_referenciaoperacion"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_totalpagado"])) {
            $_SESSION["tramite"]["rues_totalpagado"] = 0;
        }
        if (!isset($_SESSION["tramite"]["rues_formapago"])) {
            $_SESSION["tramite"]["rues_formapago"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_indicadororigen"])) {
            $_SESSION["tramite"]["rues_indicadororigen"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_indicadorbeneficio"])) {
            $_SESSION["tramite"]["rues_indicadorbeneficio"] = 0;
        }
        if (!isset($_SESSION["tramite"]["rues_fecharespuesta"])) {
            $_SESSION["tramite"]["rues_fecharespuesta"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_codigoservicioradicar"])) {
            $_SESSION["tramite"]["rues_codigoservicioradicar"] = '';
        }

        if (!isset($_SESSION["tramite"]["rues_horarespuesta"])) {
            $_SESSION["tramite"]["rues_horarespuesta"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_codigoerror"])) {
            $_SESSION["tramite"]["rues_codigoerror"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_mensajeerror"])) {
            $_SESSION["tramite"]["rues_mensajeerror"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_firmadigital"])) {
            $_SESSION["tramite"]["rues_firmadigital"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_caracteres_por_linea"])) {
            $_SESSION["tramite"]["rues_caracteres_por_linea"] = '';
        }
        if (!isset($_SESSION["tramite"]["rues_texto"])) {
            $_SESSION["tramite"]["rues_texto"] = array();
        }

        // Variables del firmante
        if (!isset($_SESSION["tramite"]["tipoidefirmante"])) {
            $_SESSION["tramite"]["tipoidefirmante"] = '';
        }
        if (!isset($_SESSION["tramite"]["identificacionfirmante"])) {
            $_SESSION["tramite"]["identificacionfirmante"] = '';
        }
        if (!isset($_SESSION["tramite"]["fechaexpfirmante"])) {
            $_SESSION["tramite"]["fechaexpfirmante"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido1firmante"])) {
            $_SESSION["tramite"]["apellido1firmante"] = '';
        }
        if (!isset($_SESSION["tramite"]["apellido2firmante"])) {
            $_SESSION["tramite"]["apellido2firmante"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre1firmante"])) {
            $_SESSION["tramite"]["nombre1firmante"] = '';
        }
        if (!isset($_SESSION["tramite"]["nombre2firmante"])) {
            $_SESSION["tramite"]["nombre2firmante"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailfirmante"])) {
            $_SESSION["tramite"]["emailfirmante"] = '';
        }
        if (!isset($_SESSION["tramite"]["emailfirmanteseguimiento"])) {
            $_SESSION["tramite"]["emailfirmanteseguimiento"] = '';
        }
        if (!isset($_SESSION["tramite"]["celularfirmante"])) {
            $_SESSION["tramite"]["celularfirmante"] = '';
        }
        if (!isset($_SESSION["tramite"]["direccionfirmante"])) {
            $_SESSION["tramite"]["direccionfirmante"] = '';
        }
        if (!isset($_SESSION["tramite"]["municipiofirmante"])) {
            $_SESSION["tramite"]["municipiofirmante"] = '';
        }

        if (!isset($_SESSION["tramite"]["firmadoelectronicamente"])) {
            $_SESSION["tramite"]["firmadoelectronicamente"] = '';
        }

        // Variables para el proceso de asesoria
        if (!isset($_SESSION["tramite"]["emailcontactoasesoria"])) {
            $_SESSION["tramite"]["emailcontactoasesoria"] = '';
        }
        if (!isset($_SESSION["tramite"]["comentariosasesoria"])) {
            $_SESSION["tramite"]["comentariosasesoria"] = '';
        }

        //
        if (!isset($_SESSION["tramite"]["pedirbalance"])) {
            $_SESSION["tramite"]["pedirbalance"] = '';
        }

        //
        if (!isset($_SESSION["tramite"]["quienasesora"])) {
            $_SESSION["tramite"]["quienasesora"] = '';
        }

        //
        if (!isset($_SESSION["tramite"]["incrementocupocertificados"])) {
            $_SESSION["tramite"]["incrementocupocertificados"] = 0;
        }

        //
        if (!isset($_SESSION["tramite"]["aceptadoprepago"])) {
            $_SESSION["tramite"]["aceptadoprepago"] = 'NO';
        }

        //
        if (!isset($_SESSION["tramite"]["propcamaraorigen"])) {
            $_SESSION["tramite"]["propcamaraorigen"] = '';
        }
        if (!isset($_SESSION["tramite"]["propidmunicipioorigen"])) {
            $_SESSION["tramite"]["propidmunicipioorigen"] = '';
        }
        if (!isset($_SESSION["tramite"]["propidmunicipiodestino"])) {
            $_SESSION["tramite"]["propidmunicipiodestino"] = '';
        }
        if (!isset($_SESSION["tramite"]["propproponenteorigen"])) {
            $_SESSION["tramite"]["propproponenteorigen"] = '';
        }
        if (!isset($_SESSION["tramite"]["propfechaultimainscripcion"])) {
            $_SESSION["tramite"]["propfechaultimainscripcion"] = '';
        }
        if (!isset($_SESSION["tramite"]["propfechaultimarenovacion"])) {
            $_SESSION["tramite"]["propfechaultimarenovacion"] = '';
        }
        if (!isset($_SESSION["tramite"]["propdircom"])) {
            $_SESSION["tramite"]["propdircom"] = '';
        }
        if (!isset($_SESSION["tramite"]["propmuncom"])) {
            $_SESSION["tramite"]["propmuncom"] = '';
        }
        if (!isset($_SESSION["tramite"]["proptelcom1"])) {
            $_SESSION["tramite"]["proptelcom1"] = '';
        }
        if (!isset($_SESSION["tramite"]["proptelcom2"])) {
            $_SESSION["tramite"]["proptelcom2"] = '';
        }
        if (!isset($_SESSION["tramite"]["proptelcom3"])) {
            $_SESSION["tramite"]["proptelcom3"] = '';
        }
        if (!isset($_SESSION["tramite"]["propemailcom"])) {
            $_SESSION["tramite"]["propemailcom"] = '';
        }
        if (!isset($_SESSION["tramite"]["propdirnot"])) {
            $_SESSION["tramite"]["propdirnot"] = '';
        }
        if (!isset($_SESSION["tramite"]["propmunnot"])) {
            $_SESSION["tramite"]["propmunnot"] = '';
        }
        if (!isset($_SESSION["tramite"]["proptelnot1"])) {
            $_SESSION["tramite"]["proptelnot1"] = '';
        }
        if (!isset($_SESSION["tramite"]["proptelnot2"])) {
            $_SESSION["tramite"]["proptelnot2"] = '';
        }
        if (!isset($_SESSION["tramite"]["proptelnot3"])) {
            $_SESSION["tramite"]["proptelnot3"] = '';
        }
        if (!isset($_SESSION["tramite"]["propemailnot"])) {
            $_SESSION["tramite"]["propemailnot"] = '';
        }

        if (!isset($_SESSION["tramite"]["enviara"])) {
            $_SESSION["tramite"]["enviara"] = '';
        }

        if (!isset($_SESSION["tramite"]["reingresoautomatico"])) {
            $_SESSION["tramite"]["reingresoautomatico"] = '';
        }

        //
        if (!isset($_SESSION["tramite"]["cantidadfolios"])) {
            $_SESSION["tramite"]["cantidadfolios"] = 0;
        }
        if (!isset($_SESSION["tramite"]["cantidadhojass"])) {
            $_SESSION["tramite"]["cantidadhojass"] = 0;
        }


        // 2017-11-26:JINT: Para indicar el email del usuario que está logueado
        if (!isset($_SESSION["tramite"]["emailcontrol"])) {
            if (isset($_SESSION["generales"]["emailusuariocontrol"])) {
                $_SESSION["tramite"]["emailcontrol"] = $_SESSION["generales"]["emailusuariocontrol"];
            } else {
                $_SESSION["tramite"]["emailcontrol"] = '';
            }
        }

        // 2017-11-26:JINT: control para el cumplimiento de los requisitos de la ley 1780
        if (!isset($_SESSION["tramite"]["cumplorequisitosbenley1780"])) {
            $_SESSION["tramite"]["cumplorequisitosbenley1780"] = '';
        }

        // 2017-11-26:JINT: control para el mantenimiento de los requisitos de la ley 1780
        if (!isset($_SESSION["tramite"]["mantengorequisitosbenley1780"])) {
            $_SESSION["tramite"]["mantengorequisitosbenley1780"] = '';
        }

        // 2017-12-23:JINT: Control de renuncia al beneficio ley 1780
        if (!isset($_SESSION["tramite"]["renunciobeneficiosley1780"])) {
            $_SESSION["tramite"]["renunciobeneficiosley1780"] = '';
        }

        // 2017-11-26:JINT: control de actividades de alto impacto
        if (!isset($_SESSION["tramite"]["controlactividadaltoimpacto"])) {
            $_SESSION["tramite"]["controlactividadaltoimpacto"] = '';
        }

        // 2017-12-16:JINT: control de multas
        if (!isset($_SESSION["tramite"]["multadoponal"])) {
            $_SESSION["tramite"]["multadoponal"] = '';
        }

        // 2016-04-08: JINT
        if (!isset($_SESSION["tramite"]["tramitepresencial"]) || $_SESSION["tramite"]["tramitepresencial"] == '') {
            if (!isset($_SESSION["generales"]["codigousuario"]) || $_SESSION["generales"]["codigousuario"] == 'USUPUBXX') {
                $_SESSION["tramite"]["tramitepresencial"] = '1'; // Trámite virtual
            } else {
                $_SESSION["tramite"]["tramitepresencial"] = '4'; // Trámite presencial
            }
        }

        // 2016-08-23: JINT
        if (!isset($_SESSION["tramite"]["cobrarmutacion"])) {
            $_SESSION["tramite"]["cobrarmutacion"] = '';
        }

        // 2018-10-22 : JINT
        if (!isset($_SESSION["tramite"]["anodeposito"])) {
            $_SESSION["tramite"]["anodeposito"] = '';
        }



        //    
        $arrCampos = array(
            'idliquidacion',
            'fecha',
            'hora',
            'fechaultimamodificacion',
            'idusuario',
            'sede',
            'tipotramite',
            'iptramite',
            'idestado',
            'idexpedientebase',
            'idmatriculabase',
            'idproponentebase',
            'tipoidentificacionbase',
            'identificacionbase',
            'nombrebase',
            'organizacionbase',
            'categoriabase',
            'tipoidepnat',
            'idepnat',
            'nombrepnat',
            'actpnat',
            'perpnat',
            'numeromatriculapnat',
            'camarapnat',
            'nombreest',
            'actest',
            'ultanoren',
            'domicilioorigen',
            'domiciliodestino',
            'idtipoidentificacioncliente',
            'identificacioncliente',
            'nombrecliente',
            'apellidocliente',
            'email',
            'direccion',
            'idmunicipio',
            'telefono',
            'movil',
            'nombrepagador',
            'apellidopagador',
            'tipoidentificacionpagador',
            'identificacionpagador',
            'direccionpagador',
            'telefonopagador',
            'movilpagador',
            'municipiopagador',
            'emailpagador',
            'valorbruto',
            'valorbaseiva',
            'valoriva',
            'valortotal',
            'idsolicitudpago',
            'pagoefectivo',
            'pagocheque',
            'pagoconsignacion',
            'pagovisa',
            'pagoach',
            'pagomastercard',
            'pagoamerican',
            'pagocredencial',
            'pagodiners',
            'pagotdebito',
            'pagoprepago',
            'pagoafiliado',
            'pagoacredito',
            'idformapago',
            'numerorecibo',
            'numerooperacion',
            'fecharecibo',
            'horarecibo',
            'idfranquicia',
            'nombrefranquicia',
            'numeroautorizacion',
            'idcodban',
            'nombrebanco',
            'numerocheque',
            'numerorecuperacion',
            'numeroradicacion',
            'alertaid',
            'alertaservicio',
            'alertavalor',
            'ctrcancelacion',
            'idasesor',
            'numeroempleados',
            'pagoafiliacion',
            'numerofactura',
            'incluirformularios',
            'incluircertificados',
            'incluirdiploma',
            'incluircartulina',
            'matricularpnat',
            'matricularest',
            'regimentributario',
            'tipomatricula',
            'camaracambidom',
            'matriculacambidom',
            'municipiocambidom',
            'fecmatcambidom',
            'benart7',
            'controlfirma',
            'proyectocaja',
            'cargoafiliacion',
            'cargogastoadministrativo',
            'cargoentidadoficial',
            'cargoconsulta',
            'actualizacionciiuversion4',
            'reliquidacion',
            'capital',
            'tipodoc',
            'numdoc',
            'fechadoc',
            'origendoc',
            'mundoc',
            'organizacion',
            'categoria',
            'tipoiderepleg',
            'iderepleg',
            'nombrerepleg',
            'tipoideradicador',
            'ideradicador',
            'fechaexpradicador',
            'nombreradicador',
            'emailradicador',
            'telefonoradicador',
            'celularradicador',
            'nrocontrolsipref',
            'tramitepresencial',
            'firmadoelectronicamente',
            'gateway',
            'emailcontrol',
            'cumplorequisitosbenley1780',
            'mantengorequisitosbenley1780',
            'renunciobeneficiosley1780',
            'controlactividadaltoimpacto',
            'multadoponal'
        );

        $arrValues = array(
            $_SESSION["tramite"]["numeroliquidacion"],
            "'" . $_SESSION["tramite"]["fecha"] . "'",
            "'" . $_SESSION["tramite"]["hora"] . "'",
            "'" . date("Ymd") . "'",
            "'" . $_SESSION["tramite"]["idusuario"] . "'",
            "'" . $_SESSION["tramite"]["sede"] . "'",
            "'" . $_SESSION["tramite"]["tipotramite"] . "'",
            "'" . str_replace(",", "", $_SESSION["tramite"]["iptramite"]) . "'",
            "'" . $_SESSION["tramite"]["idestado"] . "'",
            "'" . ltrim($_SESSION["tramite"]["idexpedientebase"], '0') . "'",
            "'" . ltrim($_SESSION["tramite"]["idmatriculabase"], '0') . "'",
            "'" . ltrim($_SESSION["tramite"]["idproponentebase"], '0') . "'",
            "'" . ltrim($_SESSION["tramite"]["tipoidentificacionbase"], '0') . "'",
            "'" . ltrim($_SESSION["tramite"]["identificacionbase"], '0') . "'",
            "'" . addslashes($_SESSION["tramite"]["nombrebase"]) . "'",
            "'" . $_SESSION["tramite"]["organizacionbase"] . "'",
            "'" . $_SESSION["tramite"]["categoriabase"] . "'",
            "'" . $_SESSION["tramite"]["tipoidepnat"] . "'",
            "'" . $_SESSION["tramite"]["idepnat"] . "'",
            "'" . addslashes($_SESSION["tramite"]["nombrepnat"]) . "'",
            doubleval($_SESSION["tramite"]["actpnat"]),
            doubleval($_SESSION["tramite"]["perpnat"]),
            "'" . $_SESSION["tramite"]["numeromatriculapnat"] . "'",
            "'" . $_SESSION["tramite"]["camarapnat"] . "'",
            "'" . addslashes($_SESSION["tramite"]["nombreest"]) . "'",
            doubleval($_SESSION["tramite"]["actest"]),
            "'" . $_SESSION["tramite"]["ultanoren"] . "'",
            "'" . $_SESSION["tramite"]["domicilioorigen"] . "'",
            "'" . $_SESSION["tramite"]["domiciliodestino"] . "'",
            "'" . $_SESSION["tramite"]["idtipoidentificacioncliente"] . "'",
            "'" . $_SESSION["tramite"]["identificacioncliente"] . "'",
            "'" . addslashes($_SESSION["tramite"]["nombrecliente"]) . "'",
            "'" . addslashes($_SESSION["tramite"]["apellidocliente"]) . "'",
            "'" . addslashes($_SESSION["tramite"]["email"]) . "'",
            "'" . addslashes($_SESSION["tramite"]["direccion"]) . "'",
            "'" . $_SESSION["tramite"]["idmunicipio"] . "'",
            "'" . $_SESSION["tramite"]["telefono"] . "'",
            "'" . $_SESSION["tramite"]["movil"] . "'",
            "'" . addslashes($_SESSION["tramite"]["nombrepagador"]) . "'",
            "'" . addslashes($_SESSION["tramite"]["apellidopagador"]) . "'",
            "'" . $_SESSION["tramite"]["tipoidentificacionpagador"] . "'",
            "'" . $_SESSION["tramite"]["identificacionpagador"] . "'",
            "'" . addslashes($_SESSION["tramite"]["direccionpagador"]) . "'",
            "'" . $_SESSION["tramite"]["telefonopagador"] . "'",
            "'" . $_SESSION["tramite"]["movilpagador"] . "'",
            "'" . $_SESSION["tramite"]["municipiopagador"] . "'",
            "'" . addslashes($_SESSION["tramite"]["emailpagador"]) . "'",
            doubleval($_SESSION["tramite"]["valorbruto"]),
            doubleval($_SESSION["tramite"]["valorbaseiva"]),
            doubleval($_SESSION["tramite"]["valoriva"]),
            doubleval($_SESSION["tramite"]["valortotal"]),
            doubleval($_SESSION["tramite"]["idsolicitudpago"]),
            doubleval($_SESSION["tramite"]["pagoefectivo"]),
            doubleval($_SESSION["tramite"]["pagocheque"]),
            doubleval($_SESSION["tramite"]["pagoconsignacion"]),
            doubleval($_SESSION["tramite"]["pagovisa"]),
            doubleval($_SESSION["tramite"]["pagoach"]),
            doubleval($_SESSION["tramite"]["pagomastercard"]),
            doubleval($_SESSION["tramite"]["pagoamerican"]),
            doubleval($_SESSION["tramite"]["pagocredencial"]),
            doubleval($_SESSION["tramite"]["pagodiners"]),
            doubleval($_SESSION["tramite"]["pagotdebito"]),
            doubleval($_SESSION["tramite"]["pagoprepago"]),
            doubleval($_SESSION["tramite"]["pagoafiliado"]),
            doubleval($_SESSION["tramite"]["pagoacredito"]),
            "'" . $_SESSION["tramite"]["idformapago"] . "'",
            "'" . $_SESSION["tramite"]["numerorecibo"] . "'",
            "'" . $_SESSION["tramite"]["numerooperacion"] . "'",
            "'" . $_SESSION["tramite"]["fecharecibo"] . "'",
            "'" . $_SESSION["tramite"]["horarecibo"] . "'",
            "'" . $_SESSION["tramite"]["idfranquicia"] . "'",
            "'" . $_SESSION["tramite"]["nombrefranquicia"] . "'",
            "'" . $_SESSION["tramite"]["numeroautorizacion"] . "'",
            "'" . $_SESSION["tramite"]["idcodban"] . "'",
            "'" . $_SESSION["tramite"]["nombrebanco"] . "'",
            "'" . $_SESSION["tramite"]["numerocheque"] . "'",
            "'" . $_SESSION["tramite"]["numerorecuperacion"] . "'",
            "'" . ltrim($_SESSION["tramite"]["numeroradicacion"], '0') . "'",
            intval($_SESSION["tramite"]["alertaid"]),
            "'" . $_SESSION["tramite"]["alertaservicio"] . "'",
            doubleval($_SESSION["tramite"]["alertavalor"]),
            "'" . $_SESSION["tramite"]["ctrcancelacion"] . "'",
            "'" . $_SESSION["tramite"]["idasesor"] . "'",
            intval($_SESSION["tramite"]["numeroempleados"]),
            "'" . $_SESSION["tramite"]["pagoafiliacion"] . "'",
            "'" . $_SESSION["tramite"]["numerofactura"] . "'",
            "'" . $_SESSION["tramite"]["incluirformularios"] . "'",
            "'" . $_SESSION["tramite"]["incluircertificados"] . "'",
            "'" . $_SESSION["tramite"]["incluirdiploma"] . "'",
            "'" . $_SESSION["tramite"]["incluircartulina"] . "'",
            "'" . $_SESSION["tramite"]["matricularpnat"] . "'",
            "'" . $_SESSION["tramite"]["matricularest"] . "'",
            "'" . $_SESSION["tramite"]["regimentributario"] . "'",
            "'" . $_SESSION["tramite"]["tipomatricula"] . "'",
            "'" . $_SESSION["tramite"]["camaracambidom"] . "'",
            "'" . $_SESSION["tramite"]["matriculacambidom"] . "'",
            "'" . $_SESSION["tramite"]["municipiocambidom"] . "'",
            "'" . $_SESSION["tramite"]["fecmatcambidom"] . "'",
            "'" . $_SESSION["tramite"]["benart7"] . "'",
            "'" . $_SESSION["tramite"]["controlfirma"] . "'",
            "'" . $_SESSION["tramite"]["proyectocaja"] . "'",
            "'" . $_SESSION["tramite"]["cargoafiliacion"] . "'",
            "'" . $_SESSION["tramite"]["cargogastoadministrativo"] . "'",
            "'" . $_SESSION["tramite"]["cargoentidadoficial"] . "'",
            "'" . $_SESSION["tramite"]["cargoconsulta"] . "'",
            "'" . $_SESSION["tramite"]["actualizacionciiuversion4"] . "'",
            "'" . $_SESSION["tramite"]["reliquidacion"] . "'",
            doubleval($_SESSION["tramite"]["capital"]),
            "''", // Tipo de documento
            "'" . $_SESSION["tramite"]["numdoc"] . "'",
            "'" . $_SESSION["tramite"]["fechadoc"] . "'",
            "'" . addslashes($_SESSION["tramite"]["origendoc"]) . "'",
            "'" . $_SESSION["tramite"]["mundoc"] . "'",
            "'" . $_SESSION["tramite"]["organizacion"] . "'",
            "'" . $_SESSION["tramite"]["categoria"] . "'",
            "'" . $_SESSION["tramite"]["tipoiderepleg"] . "'",
            "'" . $_SESSION["tramite"]["iderepleg"] . "'",
            "'" . addslashes($_SESSION["tramite"]["nombrerepleg"]) . "'",
            "'" . $_SESSION["tramite"]["tipoideradicador"] . "'",
            "'" . $_SESSION["tramite"]["ideradicador"] . "'",
            "'" . $_SESSION["tramite"]["fechaexpradicador"] . "'",
            "'" . addslashes($_SESSION["tramite"]["nombreradicador"]) . "'",
            "'" . addslashes($_SESSION["tramite"]["emailradicador"]) . "'",
            "'" . $_SESSION["tramite"]["telefonoradicador"] . "'",
            "'" . $_SESSION["tramite"]["celularradicador"] . "'",
            "'" . addslashes($_SESSION["tramite"]["nrocontrolsipref"]) . "'",
            "'" . $_SESSION["tramite"]["tramitepresencial"] . "'",
            "'" . $_SESSION["tramite"]["firmadoelectronicamente"] . "'",
            "'" . $_SESSION["tramite"]["gateway"] . "'",
            "'" . addslashes($_SESSION["tramite"]["emailcontrol"]) . "'",
            "'" . $_SESSION["tramite"]["cumplorequisitosbenley1780"] . "'",
            "'" . $_SESSION["tramite"]["mantengorequisitosbenley1780"] . "'",
            "'" . $_SESSION["tramite"]["renunciobeneficiosley1780"] . "'",
            "'" . $_SESSION["tramite"]["controlactividadaltoimpacto"] . "'",
            "'" . $_SESSION["tramite"]["multadoponal"] . "'"
        );

        //
        if ($conteo == 0) {
            $result = insertarRegistrosMysqliApi($dbx, 'mreg_liquidacion', $arrCampos, $arrValues);
            if ($result === false) {
                $_SESSION["generales"]["mensajeerror"] = 'Error insertando liquidacion en mreg_liquidacion (' . $_SESSION["generales"]["mensajeerror"] . ')';
                return false;
            }
        }

        //
        if ($conteo > 0) {
            $condicion = 'idliquidacion=' . $_SESSION["tramite"]["numeroliquidacion"];
            $result = regrabarRegistrosMysqliApi($dbx, 'mreg_liquidacion', $arrCampos, $arrValues, $condicion);
            if ($result === false) {
                $_SESSION["generales"]["mensajeerror"] = 'Error actualizando liquidacion en mreg_liquidacion (' . $_SESSION["generales"]["mensajeerror"] . ')';
                return false;
            }
        }


        // Campos adicionales de la liquidación
        borrarRegistrosMysqliApi($dbx, 'mreg_liquidacion_campos', "idliquidacion=" . $_SESSION["tramite"]["numeroliquidacion"]);

        //

        $res = array();
        $arrCampos = array(
            'idliquidacion',
            'campo',
            'contenido'
        );
        $ix = 0;
        $arrValores = array();

        // WSIERRA 2018-03-05 grabación del campo de control de matriculas a renovar  
        if (!isset($_SESSION["tramite"]["procesartodas"])) {
            $_SESSION["tramite"]["procesartodas"] = '';
        }

        if (trim($_SESSION["tramite"]["anodeposito"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'anodeposito'", "'" . $_SESSION["tramite"]["anodeposito"] . "'");
        }

        if (trim($_SESSION["tramite"]["procesartodas"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'procesartodas'", "'" . $_SESSION["tramite"]["procesartodas"] . "'");
        }

        if (trim($_SESSION["tramite"]["origen"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'origen'", "'" . $_SESSION["tramite"]["origen"] . "'");
        }

        if (trim($_SESSION["tramite"]["subtipotramite"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'subtipotramite'", "'" . $_SESSION["tramite"]["subtipotramite"] . "'");
        }

        if (trim($_SESSION["tramite"]["tipoproponente"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipoproponente'", "'" . $_SESSION["tramite"]["tipoproponente"] . "'");
        }

        if (trim($_SESSION["tramite"]["matriculabase"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'matriculabase'", "'" . $_SESSION["tramite"]["matriculabase"] . "'");
        }

        if (trim($_SESSION["tramite"]["nom1base"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nom1base'", "'" . addslashes($_SESSION["tramite"]["nom1base"]) . "'");
        }

        if (trim($_SESSION["tramite"]["nom2base"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nom2base'", "'" . addslashes($_SESSION["tramite"]["nom2base"]) . "'");
        }

        if (trim($_SESSION["tramite"]["ape1base"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ape1base'", "'" . addslashes($_SESSION["tramite"]["ape1base"]) . "'");
        }

        if (trim($_SESSION["tramite"]["ape2base"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ape1base'", "'" . addslashes($_SESSION["tramite"]["ape2base"]) . "'");
        }

        if (trim($_SESSION["tramite"]["tipoidentificacionbase"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipoidentificacionbase'", "'" . $_SESSION["tramite"]["tipoidentificacionbase"] . "'");
        }

        if (trim($_SESSION["tramite"]["identificacionbase"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'identificacionbase'", "'" . $_SESSION["tramite"]["identificacionbase"] . "'");
        }

        if (trim($_SESSION["tramite"]["organizacionbase"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'organizacionbase'", "'" . $_SESSION["tramite"]["organizacionbase"] . "'");
        }

        if (trim($_SESSION["tramite"]["categoriabase"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'categoriabase'", "'" . $_SESSION["tramite"]["categoriabase"] . "'");
        }

        if (trim($_SESSION["tramite"]["afiliadobase"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'afiliadobase'", "'" . $_SESSION["tramite"]["afiliadobase"] . "'");
        }


        if (trim($_SESSION["tramite"]["tipocliente"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipocliente'", "'" . $_SESSION["tramite"]["tipocliente"] . "'");
        }

        if (trim($_SESSION["tramite"]["razonsocialcliente"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'razonsocialcliente'", "'" . addslashes($_SESSION["tramite"]["razonsocialcliente"]) . "'");
        }

        if (trim($_SESSION["tramite"]["apellido1cliente"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido1cliente'", "'" . addslashes($_SESSION["tramite"]["apellido1cliente"]) . "'");
        }

        if (trim($_SESSION["tramite"]["apellido2cliente"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido2cliente'", "'" . addslashes($_SESSION["tramite"]["apellido2cliente"]) . "'");
        }

        if (trim($_SESSION["tramite"]["nombre1cliente"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre1cliente'", "'" . addslashes($_SESSION["tramite"]["nombre1cliente"]) . "'");
        }

        if (trim($_SESSION["tramite"]["nombre2cliente"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre2cliente'", "'" . addslashes($_SESSION["tramite"]["nombre2cliente"]) . "'");
        }



        //
        if (trim($_SESSION["tramite"]["tipopagador"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipopagador'", "'" . $_SESSION["tramite"]["tipopagador"] . "'");
        }
        if (trim($_SESSION["tramite"]["razonsocialpagador"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'razonsocialpagador'", "'" . addslashes($_SESSION["tramite"]["razonsocialpagador"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido1pagador"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido1pagador'", "'" . addslashes($_SESSION["tramite"]["apellido1pagador"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido2pagador"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido2pagador'", "'" . addslashes($_SESSION["tramite"]["apellido2pagador"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre1pagador"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre1pagador'", "'" . addslashes($_SESSION["tramite"]["nombre1pagador"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre2pagador"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre2pagador'", "'" . addslashes($_SESSION["tramite"]["nombre2pagador"]) . "'");
        }

        //
        if (trim($_SESSION["tramite"]["modcom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'modcom'", "'" . $_SESSION["tramite"]["modcom"] . "'");
        }
        if (trim($_SESSION["tramite"]["modnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'modnot'", "'" . $_SESSION["tramite"]["modnot"] . "'");
        }
        if (trim($_SESSION["tramite"]["modciiu"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'modciiu'", "'" . $_SESSION["tramite"]["modciiu"] . "'");
        }
        if (trim($_SESSION["tramite"]["modnombre"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'modnombre'", "'" . $_SESSION["tramite"]["modnombre"] . "'");
        }
        if (trim($_SESSION["tramite"]["fecrencambidom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'fecrencambidom'", "'" . $_SESSION["tramite"]["fecrencambidom"] . "'");
        }

        if (trim($_SESSION["tramite"]["nombre1repleg"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre1repleg'", "'" . addslashes($_SESSION["tramite"]["nombre1repleg"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre2repleg"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre2repleg'", "'" . addslashes($_SESSION["tramite"]["nombre2repleg"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido1repleg"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido1repleg'", "'" . addslashes($_SESSION["tramite"]["apellido1repleg"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido2repleg"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido2repleg'", "'" . addslashes($_SESSION["tramite"]["apellido2repleg"]) . "'");
        }
        if (trim($_SESSION["tramite"]["cargorepleg"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'cargorepleg'", "'" . addslashes($_SESSION["tramite"]["cargorepleg"]) . "'");
        }
        if (trim($_SESSION["tramite"]["emailrepleg"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailrepleg'", "'" . addslashes($_SESSION["tramite"]["emailrepleg"]) . "'");
        }
        if (trim($_SESSION["tramite"]["firmorepleg"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'firmorepleg'", "'" . $_SESSION["tramite"]["firmorepleg"] . "'");
        }
        if (trim($_SESSION["tramite"]["celularrepleg"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'celularrepleg'", "'" . $_SESSION["tramite"]["celularrepleg"] . "'");
        }

        if (trim($_SESSION["tramite"]["tipolibro"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipolibro'", "'" . $_SESSION["tramite"]["tipolibro"] . "'");
        }
        if (trim($_SESSION["tramite"]["codigolibro"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'codigolibro'", "'" . $_SESSION["tramite"]["codigolibro"] . "'");
        }
        if (trim($_SESSION["tramite"]["primeravez"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'primeravez'", "'" . $_SESSION["tramite"]["primeravez"] . "'");
        }
        if (trim($_SESSION["tramite"]["confirmadigital"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'confirmadigital'", "'" . $_SESSION["tramite"]["confirmadigital"] . "'");
        }

        if (trim($_SESSION["tramite"]["iderevfis"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'iderevfis'", "'" . $_SESSION["tramite"]["iderevfis"] . "'");
        }
        if (trim($_SESSION["tramite"]["nombre1revfis"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre1revfis'", "'" . addslashes($_SESSION["tramite"]["nombre1revfis"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre2revfis"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre2revfis'", "'" . addslashes($_SESSION["tramite"]["nombre2revfis"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido1revfis"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido1revfis'", "'" . addslashes($_SESSION["tramite"]["apellido1revfis"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido2revfis"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido2revfis'", "'" . addslashes($_SESSION["tramite"]["apellido2revfis"]) . "'");
        }
        if (trim($_SESSION["tramite"]["cargorevfis"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'cargorevfis'", "'" . addslashes($_SESSION["tramite"]["cargorevfis"]) . "'");
        }
        if (trim($_SESSION["tramite"]["emailrevfis"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailrevfis'", "'" . addslashes($_SESSION["tramite"]["emailrevfis"]) . "'");
        }
        if (trim($_SESSION["tramite"]["firmorevfis"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'firmorevfis'", "'" . $_SESSION["tramite"]["firmorevfis"] . "'");
        }
        if (trim($_SESSION["tramite"]["celularrevfis"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'celularrevfis'", "'" . $_SESSION["tramite"]["celularrevfis"] . "'");
        }

        if (trim($_SESSION["tramite"]["idepreasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'idepreasa'", "'" . $_SESSION["tramite"]["idepreasa"] . "'");
        }
        if (trim($_SESSION["tramite"]["nombre1preasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre1preasa'", "'" . addslashes($_SESSION["tramite"]["nombre1preasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre2preasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre2preasa'", "'" . addslashes($_SESSION["tramite"]["nombre2preasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido1preasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido1preasa'", "'" . addslashes($_SESSION["tramite"]["apellido1preasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido2preasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido2preasa'", "'" . addslashes($_SESSION["tramite"]["apellido2preasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["cargopreasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'cargopreasa'", "'" . addslashes($_SESSION["tramite"]["cargopreasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["emailpreasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailpreasa'", "'" . addslashes($_SESSION["tramite"]["emailpreasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["firmopreasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'firmopreasa'", "'" . addslashes($_SESSION["tramite"]["firmopreasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["celularpreasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'celularpreasa'", "'" . $_SESSION["tramite"]["celularpreasa"] . "'");
        }

        if (trim($_SESSION["tramite"]["idesecasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'idesecasa'", "'" . addslashes($_SESSION["tramite"]["idesecasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre1secasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre1secasa'", "'" . addslashes($_SESSION["tramite"]["nombre1secasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre2secasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre2secasa'", "'" . addslashes($_SESSION["tramite"]["nombre2secasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido1secasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido1secasa'", "'" . addslashes($_SESSION["tramite"]["apellido1secasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido2secasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido2secasa'", "'" . addslashes($_SESSION["tramite"]["apellido2secasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["cargosecasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'cargosecasa'", "'" . addslashes($_SESSION["tramite"]["cargosecasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["emailsecasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailsecasa'", "'" . addslashes($_SESSION["tramite"]["emailsecasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["firmosecasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'firmosecasa'", "'" . addslashes($_SESSION["tramite"]["firmosecasa"]) . "'");
        }
        if (trim($_SESSION["tramite"]["celularsecasa"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'celularsecasa'", "'" . $_SESSION["tramite"]["celularsecasa"] . "'");
        }

        if (trim($_SESSION["tramite"]["tipoidentificacionaceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipoidentificacionaceptante'", "'" . addslashes($_SESSION["tramite"]["tipoidentificacionaceptante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["identificacionaceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'identificacionaceptante'", "'" . addslashes($_SESSION["tramite"]["identificacionaceptante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre1aceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre1aceptante'", "'" . addslashes($_SESSION["tramite"]["nombre1aceptante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre2aceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre2aceptante'", "'" . addslashes($_SESSION["tramite"]["nombre2aceptante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido1aceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido1aceptante'", "'" . addslashes($_SESSION["tramite"]["apellido1aceptante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido2aceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido2aceptante'", "'" . addslashes($_SESSION["tramite"]["apellido2aceptante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["direccionaceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'direccionaceptante'", "'" . addslashes($_SESSION["tramite"]["direccionaceptante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["emailaceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailaceptante'", "'" . addslashes($_SESSION["tramite"]["emailaceptante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["municipioaceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'municipioaceptante'", "'" . addslashes($_SESSION["tramite"]["municipioaceptante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["telefonoaceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'telefonoaceptante'", "'" . addslashes($_SESSION["tramite"]["telefonoaceptante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["celularaceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'celularaceptante'", "'" . addslashes($_SESSION["tramite"]["celularaceptante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["cargoaceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'cargoaceptante'", "'" . addslashes($_SESSION["tramite"]["cargoaceptante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["fechadocideaceptante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'fechadocideaceptante'", "'" . addslashes($_SESSION["tramite"]["fechadocideaceptante"]) . "'");
        }

        if (trim($_SESSION["tramite"]["motivocorreccion"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'motivocorreccion'", "'" . addslashes($_SESSION["tramite"]["motivocorreccion"]) . "'");
        }
        if (trim($_SESSION["tramite"]["tipoerror1"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipoerror1'", "'" . addslashes($_SESSION["tramite"]["tipoerror1"]) . "'");
        }
        if (trim($_SESSION["tramite"]["tipoerror2"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipoerror2'", "'" . addslashes($_SESSION["tramite"]["tipoerror2"]) . "'");
        }
        if (trim($_SESSION["tramite"]["tipoerror3"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipoerror3'", "'" . addslashes($_SESSION["tramite"]["tipoerror3"]) . "'");
        }
        if (trim($_SESSION["tramite"]["tipoidentificacioncor"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipoidentificacioncor'", "'" . addslashes($_SESSION["tramite"]["tipoidentificacioncor"]) . "'");
        }
        if (trim($_SESSION["tramite"]["identificacioncor"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'identificacioncor'", "'" . addslashes($_SESSION["tramite"]["identificacioncor"]) . "'");
        }

        if (trim($_SESSION["tramite"]["nombre1cor"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre1cor'", "'" . addslashes($_SESSION["tramite"]["nombre1cor"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre2cor"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre2cor'", "'" . addslashes($_SESSION["tramite"]["nombre2cor"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido1cor"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido1cor'", "'" . addslashes($_SESSION["tramite"]["apellido1cor"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido2cor"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido2cor'", "'" . addslashes($_SESSION["tramite"]["apellido2cor"]) . "'");
        }
        if (trim($_SESSION["tramite"]["direccioncor"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'direccioncor'", "'" . addslashes($_SESSION["tramite"]["direccioncor"]) . "'");
        }
        if (trim($_SESSION["tramite"]["municipiocor"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'municipiocor'", "'" . addslashes($_SESSION["tramite"]["municipiocor"]) . "'");
        }
        if (trim($_SESSION["tramite"]["emailcor"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailcor'", "'" . addslashes($_SESSION["tramite"]["emailcor"]) . "'");
        }
        if (trim($_SESSION["tramite"]["telefonocor"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'telefonocor'", "'" . addslashes($_SESSION["tramite"]["telefonocor"]) . "'");
        }
        if (trim($_SESSION["tramite"]["celularcor"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'celularcor'", "'" . addslashes($_SESSION["tramite"]["celularcor"]) . "'");
        }


        if (trim($_SESSION["tramite"]["descripcionembargo"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'descripcionembargo'", "'" . addslashes($_SESSION["tramite"]["descripcionembargo"]) . "'");
        }
        if (trim($_SESSION["tramite"]["descripciondesembargo"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'descripciondesembargo'", "'" . addslashes($_SESSION["tramite"]["descripciondesembargo"]) . "'");
        }
        if (trim($_SESSION["tramite"]["tipoidentificaciondemandante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipoidentificaciondemandante'", "'" . addslashes($_SESSION["tramite"]["tipoidentificaciondemandante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["identificaciondemandante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'identificaciondemandante'", "'" . addslashes($_SESSION["tramite"]["identificaciondemandante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombredemandante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombredemandante'", "'" . addslashes($_SESSION["tramite"]["nombredemandante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["libro"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'libro'", "'" . addslashes($_SESSION["tramite"]["libro"]) . "'");
        }
        if (trim($_SESSION["tramite"]["numreg"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'numreg'", "'" . addslashes($_SESSION["tramite"]["numreg"]) . "'");
        }

        if (trim($_SESSION["tramite"]["descripcionpqr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'descripcionpqr'", "'" . addslashes($_SESSION["tramite"]["descripcionpqr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["tipoidentificacionpqr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipoidentificacionpqr'", "'" . addslashes($_SESSION["tramite"]["tipoidentificacionpqr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["identificacionpqr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'identificacionpqr'", "'" . addslashes($_SESSION["tramite"]["identificacionpqr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre1pqr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre1pqr'", "'" . addslashes($_SESSION["tramite"]["nombre1pqr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre2pqr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre2pqr'", "'" . addslashes($_SESSION["tramite"]["nombre2pqr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido1pqr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido1pqr'", "'" . addslashes($_SESSION["tramite"]["apellido1pqr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido2pqr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido2pqr'", "'" . addslashes($_SESSION["tramite"]["apellido2pqr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["direccionpqr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'direccionpqr'", "'" . addslashes($_SESSION["tramite"]["direccionpqr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["municipiopqr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'municipiopqr'", "'" . addslashes($_SESSION["tramite"]["municipiopqr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["emailpqr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailpqr'", "'" . addslashes($_SESSION["tramite"]["emailpqr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["telefonopqr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'telefonopqr'", "'" . addslashes($_SESSION["tramite"]["telefonopqr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["celularpqr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'celularpqr'", "'" . addslashes($_SESSION["tramite"]["celularpqr"]) . "'");
        }

        if (trim($_SESSION["tramite"]["descripcionrr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'descripcionrr'", "'" . addslashes($_SESSION["tramite"]["descripcionrr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["inscripcionrr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'inscripcionrr'", "'" . addslashes($_SESSION["tramite"]["inscripcionrr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["subsidioapelacionrr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'subsidioapelacionrr'", "'" . addslashes($_SESSION["tramite"]["subsidioapelacionrr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["tipoidentificacionrr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipoidentificacionrr'", "'" . addslashes($_SESSION["tramite"]["tipoidentificacionrr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["identificacionrr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'identificacionrr'", "'" . addslashes($_SESSION["tramite"]["identificacionrr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre1rr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre1rr'", "'" . addslashes($_SESSION["tramite"]["nombre1rr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre2rr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre2rr'", "'" . addslashes($_SESSION["tramite"]["nombre2rr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido1rr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido1rr'", "'" . addslashes($_SESSION["tramite"]["apellido1rr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido2rr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido2rr'", "'" . addslashes($_SESSION["tramite"]["apellido2rr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["direccionrr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'direccionrr'", "'" . addslashes($_SESSION["tramite"]["direccionrr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["municipiorr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'municipiorr'", "'" . addslashes($_SESSION["tramite"]["municipiorr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["emailrr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailrr'", "'" . addslashes($_SESSION["tramite"]["emailrr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["telefonorr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'telefonorr'", "'" . addslashes($_SESSION["tramite"]["telefonorr"]) . "'");
        }
        if (trim($_SESSION["tramite"]["celularrr"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'celularrr'", "'" . addslashes($_SESSION["tramite"]["celularrr"]) . "'");
        }


        if (trim($_SESSION["tramite"]["tipocertificado"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipocertificado'", "'" . addslashes($_SESSION["tramite"]["tipocertificado"]) . "'");
        }
        if (trim($_SESSION["tramite"]["explicacion"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'explicacion'", "'" . addslashes($_SESSION["tramite"]["explicacion"]) . "'");
        }

        if (trim($_SESSION["tramite"]["textolibre"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'textolibre'", "'" . addslashes($_SESSION["tramite"]["textolibre"]) . "'");
        }

        if (trim($_SESSION["tramite"]["matriculaafiliado"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'matriculaafiliado'", "'" . addslashes($_SESSION["tramite"]["matriculaafiliado"]) . "'");
        }
        if (trim($_SESSION["tramite"]["opcionafiliado"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'opcionafiliado'", "'" . addslashes($_SESSION["tramite"]["opcionafiliado"]) . "'");
        }
        if (trim($_SESSION["tramite"]["saldoafiliado"]) != 0) {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'saldoafiliado'", "'" . addslashes($_SESSION["tramite"]["saldoafiliado"]) . "'");
        }
        if (trim($_SESSION["tramite"]["ultanorenafi"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ultanorenafi'", "'" . addslashes($_SESSION["tramite"]["ultanorenafi"]) . "'");
        }

        //
        if (trim($_SESSION["tramite"]["nombrepjur"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombrepjur'", "'" . addslashes($_SESSION["tramite"]["nombrepjur"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombresuc"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombresuc'", "'" . addslashes($_SESSION["tramite"]["nombresuc"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombreage"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombreage'", "'" . addslashes($_SESSION["tramite"]["nombreage"]) . "'");
        }

        if (trim($_SESSION["tramite"]["orgpnat"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'orgpnat'", "'" . addslashes($_SESSION["tramite"]["orgpnat"]) . "'");
        }
        if (trim($_SESSION["tramite"]["orgpjur"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'orgpjur'", "'" . addslashes($_SESSION["tramite"]["orgpjur"]) . "'");
        }
        if (trim($_SESSION["tramite"]["orgsuc"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'orgsuc'", "'" . addslashes($_SESSION["tramite"]["orgsuc"]) . "'");
        }
        if (trim($_SESSION["tramite"]["orgage"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'orgage'", "'" . addslashes($_SESSION["tramite"]["orgage"]) . "'");
        }

        if (trim($_SESSION["tramite"]["munpnat"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'munpnat'", "'" . addslashes($_SESSION["tramite"]["munpnat"]) . "'");
        }
        if (trim($_SESSION["tramite"]["munest"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'munest'", "'" . addslashes($_SESSION["tramite"]["munest"]) . "'");
        }
        if (trim($_SESSION["tramite"]["munpjur"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'munpjur'", "'" . addslashes($_SESSION["tramite"]["munpjur"]) . "'");
        }
        if (trim($_SESSION["tramite"]["munsuc"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'munsuc'", "'" . addslashes($_SESSION["tramite"]["munsuc"]) . "'");
        }
        if (trim($_SESSION["tramite"]["munage"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'munage'", "'" . addslashes($_SESSION["tramite"]["munage"]) . "'");
        }

        if (trim($_SESSION["tramite"]["perpjur"]) != 0) {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'perpjur'", "'" . addslashes($_SESSION["tramite"]["perpjur"]) . "'");
        }

        if (trim($_SESSION["tramite"]["actpjur"]) != 0) {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'actpjur'", "'" . addslashes($_SESSION["tramite"]["actpjur"]) . "'");
        }
        if (trim($_SESSION["tramite"]["actsuc"]) != 0) {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'actsuc", "'" . addslashes($_SESSION["tramite"]["actsuc"]) . "'");
        }
        if (trim($_SESSION["tramite"]["actage"]) != 0) {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'actage'", "'" . addslashes($_SESSION["tramite"]["actage"]) . "'");
        }

        // En caso de mutaciones - direccion comercial
        if (trim($_SESSION["tramite"]["ant_dircom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_dircom'", "'" . addslashes($_SESSION["tramite"]["ant_dircom"]) . "'");
        }
        if (trim($_SESSION["tramite"]["ant_telcom1"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_telcom1'", "'" . $_SESSION["tramite"]["ant_telcom1"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_telcom2"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_telcom2'", "'" . $_SESSION["tramite"]["ant_telcom2"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_faxcom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_faxcom'", "'" . $_SESSION["tramite"]["ant_faxcom"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_celcom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_celcom'", "'" . $_SESSION["tramite"]["ant_celcom"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_numpredial"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_numpredial'", "'" . $_SESSION["tramite"]["ant_numpredial"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_barriocom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_barriocom'", "'" . $_SESSION["tramite"]["ant_barriocom"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_muncom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_muncom'", "'" . $_SESSION["tramite"]["ant_muncom"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_emailcom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_emailcom'", "'" . addslashes($_SESSION["tramite"]["ant_emailcom"]) . "'");
        }
        if (trim($_SESSION["tramite"]["ant_emailcom2"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_emailcom2'", "'" . addslashes($_SESSION["tramite"]["ant_emailcom2"]) . "'");
        }
        if (trim($_SESSION["tramite"]["ant_emailcom3"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_emailcom3'", "'" . addslashes($_SESSION["tramite"]["ant_emailcom3"]) . "'");
        }

        if (trim($_SESSION["tramite"]["dircom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'dircom'", "'" . addslashes($_SESSION["tramite"]["dircom"]) . "'");
        }
        if (trim($_SESSION["tramite"]["telcom1"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'telcom1'", "'" . $_SESSION["tramite"]["telcom1"] . "'");
        }
        if (trim($_SESSION["tramite"]["telcom2"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'telcom2'", "'" . $_SESSION["tramite"]["telcom2"] . "'");
        }
        if (trim($_SESSION["tramite"]["faxcom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'faxcom'", "'" . $_SESSION["tramite"]["faxcom"] . "'");
        }
        if (trim($_SESSION["tramite"]["celcom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'celcom'", "'" . $_SESSION["tramite"]["celcom"] . "'");
        }
        if (trim($_SESSION["tramite"]["barriocom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'barriocom'", "'" . $_SESSION["tramite"]["barriocom"] . "'");
        }
        if (trim($_SESSION["tramite"]["muncom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'muncom'", "'" . $_SESSION["tramite"]["muncom"] . "'");
        }
        if (trim($_SESSION["tramite"]["numpredial"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'numpredial'", "'" . $_SESSION["tramite"]["numpredial"] . "'");
        }
        if (trim($_SESSION["tramite"]["emailcom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailcom'", "'" . addslashes($_SESSION["tramite"]["emailcom"]) . "'");
        }
        if (trim($_SESSION["tramite"]["emailcom2"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailcom2'", "'" . addslashes($_SESSION["tramite"]["emailcom2"]) . "'");
        }
        if (trim($_SESSION["tramite"]["emailcom3"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailcom3'", "'" . addslashes($_SESSION["tramite"]["emailcom3"]) . "'");
        }

        // En caso de mutaciones - direccion notificacion
        if (trim($_SESSION["tramite"]["ant_dirnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_dirnot'", "'" . addslashes($_SESSION["tramite"]["ant_dirnot"]) . "'");
        }
        if (trim($_SESSION["tramite"]["ant_telnot1"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_telnot1'", "'" . $_SESSION["tramite"]["ant_telnot1"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_telnot2"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_telnot2'", "'" . $_SESSION["tramite"]["ant_telnot2"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_faxnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_faxnot'", "'" . $_SESSION["tramite"]["ant_faxnot"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_celnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_celnot'", "'" . $_SESSION["tramite"]["ant_celnot"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_barrionot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_barrionot'", "'" . $_SESSION["tramite"]["ant_barrionot"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_munnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_munnot'", "'" . $_SESSION["tramite"]["ant_munnot"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_emailnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_emailnot'", "'" . addslashes($_SESSION["tramite"]["ant_emailnot"]) . "'");
        }

        if (trim($_SESSION["tramite"]["dirnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'dirnot'", "'" . addslashes($_SESSION["tramite"]["dirnot"]) . "'");
        }
        if (trim($_SESSION["tramite"]["telnot1"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'telnot1'", "'" . $_SESSION["tramite"]["telnot1"] . "'");
        }
        if (trim($_SESSION["tramite"]["telnot2"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'telnot2'", "'" . $_SESSION["tramite"]["telnot2"] . "'");
        }
        if (trim($_SESSION["tramite"]["faxnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'faxnot'", "'" . $_SESSION["tramite"]["faxnot"] . "'");
        }
        if (trim($_SESSION["tramite"]["celnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'celnot'", "'" . $_SESSION["tramite"]["celnot"] . "'");
        }
        if (trim($_SESSION["tramite"]["barrionot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'barrionot'", "'" . $_SESSION["tramite"]["barrionot"] . "'");
        }
        if (trim($_SESSION["tramite"]["munnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'munnot'", "'" . $_SESSION["tramite"]["munnot"] . "'");
        }
        if (trim($_SESSION["tramite"]["emailnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailnot'", "'" . addslashes($_SESSION["tramite"]["emailnot"]) . "'");
        }

        // En caso de mutaciones - actividad
        if (trim($_SESSION["tramite"]["ant_versionciiu"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_versionciiu'", "'" . $_SESSION["tramite"]["ant_versionciiu"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_ciiu11"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_ciiu11'", "'" . $_SESSION["tramite"]["ant_ciiu11"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_ciiu12"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_ciiu12'", "'" . $_SESSION["tramite"]["ant_ciiu12"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_ciiu13"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_ciiu13'", "'" . $_SESSION["tramite"]["ant_ciiu13"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_ciiu14"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_ciiu14'", "'" . $_SESSION["tramite"]["ant_ciiu14"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_ciiu21"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_ciiu21'", "'" . $_SESSION["tramite"]["ant_ciiu21"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_ciiu22"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_ciiu22'", "'" . $_SESSION["tramite"]["ant_ciiu22"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_ciiu23"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_ciiu23'", "'" . $_SESSION["tramite"]["ant_ciiu23"] . "'");
        }
        if (trim($_SESSION["tramite"]["ant_ciiu24"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ant_ciiu24'", "'" . $_SESSION["tramite"]["ant_ciiu24"] . "'");
        }

        if (trim($_SESSION["tramite"]["nombreanterior"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombreanterior'", "'" . addslashes($_SESSION["tramite"]["nombreanterior"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombrenuevo"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombrenuevo'", "'" . addslashes($_SESSION["tramite"]["nombrenuevo"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nuevonombre"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nuevonombre'", "'" . addslashes($_SESSION["tramite"]["nuevonombre"]) . "'");
        }

        if (trim($_SESSION["tramite"]["versionciiu"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'versionciiu'", "'" . $_SESSION["tramite"]["versionciiu"] . "'");
        }
        if (trim($_SESSION["tramite"]["ciiu11"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ciiu11'", "'" . $_SESSION["tramite"]["ciiu11"] . "'");
        }
        if (trim($_SESSION["tramite"]["ciiu12"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ciiu12'", "'" . $_SESSION["tramite"]["ciiu12"] . "'");
        }
        if (trim($_SESSION["tramite"]["ciiu13"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ciiu13'", "'" . $_SESSION["tramite"]["ciiu13"] . "'");
        }
        if (trim($_SESSION["tramite"]["ciiu14"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ciiu14'", "'" . $_SESSION["tramite"]["ciiu14"] . "'");
        }
        if (trim($_SESSION["tramite"]["ciiu21"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ciiu21'", "'" . $_SESSION["tramite"]["ciiu21"] . "'");
        }
        if (trim($_SESSION["tramite"]["ciiu22"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ciiu22'", "'" . $_SESSION["tramite"]["ciiu22"] . "'");
        }
        if (trim($_SESSION["tramite"]["ciiu23"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ciiu23'", "'" . $_SESSION["tramite"]["ciiu23"] . "'");
        }
        if (trim($_SESSION["tramite"]["ciiu24"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'ciiu24'", "'" . $_SESSION["tramite"]["ciiu24"] . "'");
        }

        if (trim($_SESSION["tramite"]["nombreanterior"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombreanterior'", "'" . addslashes($_SESSION["tramite"]["nombreanterior"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombrenuevo"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombrenuevo'", "'" . addslashes($_SESSION["tramite"]["nombrenuevo"]) . "'");
        }

        // En caso de tr&aacute;mites rues
        if (trim($_SESSION["tramite"]["rues_numerointerno"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_numerointerno'", "'" . addslashes($_SESSION["tramite"]["rues_numerointerno"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_numerounico"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_numerounico'", "'" . addslashes($_SESSION["tramite"]["rues_numerounico"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_camarareceptora"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_camarareceptora'", "'" . addslashes($_SESSION["tramite"]["rues_camarareceptora"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_camararesponsable"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_camararesponsable'", "'" . addslashes($_SESSION["tramite"]["rues_camararesponsable"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_codigoservicioradicar"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_codigoservicioradicar'", "'" . addslashes($_SESSION["tramite"]["rues_codigoservicioradicar"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_matricula"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_matricula'", "'" . addslashes($_SESSION["tramite"]["rues_matricula"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_proponente"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_proponente'", "'" . addslashes($_SESSION["tramite"]["rues_proponente"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_nombreregistrado"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_nombreregistrado'", "'" . addslashes($_SESSION["tramite"]["rues_nombreregistrado"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_claseidentificacion"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_claseidentificacion'", "'" . $_SESSION["tramite"]["rues_claseidentificacion"] . "'");
        }
        if (trim($_SESSION["tramite"]["rues_numeroidentificacion"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_numeroidentificacion'", "'" . $_SESSION["tramite"]["rues_numeroidentificacion"] . "'");
        }
        if (trim($_SESSION["tramite"]["rues_dv"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_dv'", "'" . $_SESSION["tramite"]["rues_dv"] . "'");
        }
        if (trim($_SESSION["tramite"]["rues_estado_liquidacion"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_estado_liquidacion'", "'" . $_SESSION["tramite"]["rues_estado_liquidacion"] . "'");
        }
        if (trim($_SESSION["tramite"]["rues_estado_transaccion"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_estado_transaccion'", "'" . $_SESSION["tramite"]["rues_estado_transaccion"] . "'");
        }
        if (trim($_SESSION["tramite"]["rues_nombrepagador"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_nombrepagador'", "'" . addslashes($_SESSION["tramite"]["rues_nombrepagador"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_origendocumento"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_origendocumento'", "'" . addslashes($_SESSION["tramite"]["rues_origendocumento"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_fechadocumento"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_fechadocumento'", "'" . addslashes($_SESSION["tramite"]["rues_fechadocumento"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_fechapago"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_fechapago'", "'" . addslashes($_SESSION["tramite"]["rues_fechapago"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_numerofactura"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_numerofactura'", "'" . addslashes($_SESSION["tramite"]["rues_numerofactura"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_referenciaoperacion"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_referenciaoperacion'", "'" . addslashes($_SESSION["tramite"]["rues_referenciaoperacion"]) . "'");
        }
        if (doubleval($_SESSION["tramite"]["rues_totalpagado"]) != 0) {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_totalpagado'", "'" . addslashes($_SESSION["tramite"]["rues_totalpagado"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_formapago"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_formapago'", "'" . addslashes($_SESSION["tramite"]["rues_formapago"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_indicadororigen"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_indicadororigen'", "'" . addslashes($_SESSION["tramite"]["rues_indicadororigen"]) . "'");
        }
        if (doubleval($_SESSION["tramite"]["rues_empleados"]) != 0) {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_empleados'", "'" . addslashes($_SESSION["tramite"]["rues_empleados"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_indicadorbeneficio"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_indicadorbeneficio'", "'" . addslashes($_SESSION["tramite"]["rues_indicadorbeneficio"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_fecharespuesta"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_fecharespuesta'", "'" . addslashes($_SESSION["tramite"]["rues_fecharespuesta"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_horarespuesta"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_horarespuesta'", "'" . addslashes($_SESSION["tramite"]["rues_horarespuesta"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_codigoerror"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_codigoerror'", "'" . addslashes($_SESSION["tramite"]["rues_codigoerror"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_mensajeerror"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_mensajeerror'", "'" . addslashes($_SESSION["tramite"]["rues_mensajeerror"]) . "'");
        }
        if (trim($_SESSION["tramite"]["rues_firmadigital"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_firmadigital'", "'" . addslashes($_SESSION["tramite"]["rues_firmadigital"]) . "'");
        }
        if (doubleval($_SESSION["tramite"]["rues_caracteres_por_linea"]) != 0) {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'rues_caracteres_por_linea'", "'" . addslashes($_SESSION["tramite"]["rues_caracteres_por_linea"]) . "'");
        }
        if (trim($_SESSION["tramite"]["tipoidefirmante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'tipoidefirmante'", "'" . addslashes($_SESSION["tramite"]["tipoidefirmante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["identificacionfirmante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'identificacionfirmante'", "'" . addslashes($_SESSION["tramite"]["identificacionfirmante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["fechaexpfirmante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'fechaexpfirmante'", "'" . addslashes($_SESSION["tramite"]["fechaexpfirmante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido1firmante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido1firmante'", "'" . addslashes($_SESSION["tramite"]["apellido1firmante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["apellido2firmante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'apellido2firmante'", "'" . addslashes($_SESSION["tramite"]["apellido2firmante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre1firmante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre1firmante'", "'" . addslashes($_SESSION["tramite"]["nombre1firmante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["nombre2firmante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'nombre2firmante'", "'" . addslashes($_SESSION["tramite"]["nombre2firmante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["emailfirmante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailfirmante'", "'" . addslashes($_SESSION["tramite"]["emailfirmante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["emailfirmanteseguimiento"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailfirmanteseguimiento'", "'" . addslashes($_SESSION["tramite"]["emailfirmanteseguimiento"]) . "'");
        }
        if (trim($_SESSION["tramite"]["celularfirmante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'celularfirmante'", "'" . addslashes($_SESSION["tramite"]["celularfirmante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["direccionfirmante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'direccionfirmante'", "'" . addslashes($_SESSION["tramite"]["direccionfirmante"]) . "'");
        }
        if (trim($_SESSION["tramite"]["municipiofirmante"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'municipiofirmante'", "'" . addslashes($_SESSION["tramite"]["municipiofirmante"]) . "'");
        }

        //
        if (trim($_SESSION["tramite"]["emailcontactoasesoria"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'emailcontactoasesoria'", "'" . addslashes($_SESSION["tramite"]["emailcontactoasesoria"]) . "'");
        }
        if (trim($_SESSION["tramite"]["comentariosasesoria"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'comentariosasesoria'", "'" . addslashes($_SESSION["tramite"]["comentariosasesoria"]) . "'");
        }

        //
        if (trim($_SESSION["tramite"]["pedirbalance"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'pedirbalance'", "'" . addslashes($_SESSION["tramite"]["pedirbalance"]) . "'");
        }

        //
        if (trim($_SESSION["tramite"]["quienasesora"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'quienasesora'", "'" . addslashes($_SESSION["tramite"]["quienasesora"]) . "'");
        }

        //
        if (trim($_SESSION["tramite"]["benley1780"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'benley1780'", "'" . addslashes($_SESSION["tramite"]["benley1780"]) . "'");
        }

        //
        if (trim($_SESSION["tramite"]["fechanacimientopnat"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'fechanacimientopnat'", "'" . addslashes($_SESSION["tramite"]["fechanacimientopnat"]) . "'");
        }

        //
        if (intval(trim($_SESSION["tramite"]["incrementocupocertificados"])) != 0) {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'incrementocupocertificados'", "'" . $_SESSION["tramite"]["incrementocupocertificados"] . "'");
        }

        // 2016-08-23 : JINT
        if (intval(trim($_SESSION["tramite"]["cobrarmutacion"])) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'cobrarmutacion'", "'" . $_SESSION["tramite"]["cobrarmutacion"] . "'");
        }

        // 2016-10-22 : JINT
        $ix++;
        $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'aceptadoprepago'", "'" . $_SESSION["tramite"]["aceptadoprepago"] . "'");

        // 2016-10-22 : JINT
        if (trim($_SESSION["tramite"]["propcamaraorigen"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'propcamaraorigen'", "'" . $_SESSION["tramite"]["propcamaraorigen"] . "'");
        }
        if (trim($_SESSION["tramite"]["propidmunicipioorigen"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'propidmunicipioorigen'", "'" . $_SESSION["tramite"]["propidmunicipioorigen"] . "'");
        }
        if (trim($_SESSION["tramite"]["propidmunicipiodestino"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'propidmunicipiodestino'", "'" . $_SESSION["tramite"]["propidmunicipiodestino"] . "'");
        }
        if (trim($_SESSION["tramite"]["propproponenteorigen"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'propproponenteorigen'", "'" . $_SESSION["tramite"]["propproponenteorigen"] . "'");
        }
        if (trim($_SESSION["tramite"]["propfechaultimainscripcion"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'propfechaultimainscripcion'", "'" . $_SESSION["tramite"]["propfechaultimainscripcion"] . "'");
        }
        if (trim($_SESSION["tramite"]["propfechaultimarenovacion"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'propfechaultimarenovacion'", "'" . $_SESSION["tramite"]["propfechaultimarenovacion"] . "'");
        }
        if (trim($_SESSION["tramite"]["propdircom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'propdircom'", "'" . addslashes($_SESSION["tramite"]["propdircom"]) . "'");
        }
        if (trim($_SESSION["tramite"]["propmuncom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'propmuncom'", "'" . $_SESSION["tramite"]["propmuncom"] . "'");
        }
        if (trim($_SESSION["tramite"]["proptelcom1"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'proptelcom1'", "'" . $_SESSION["tramite"]["proptelcom1"] . "'");
        }
        if (trim($_SESSION["tramite"]["proptelcom2"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'proptelcom2'", "'" . $_SESSION["tramite"]["proptelcom2"] . "'");
        }
        if (trim($_SESSION["tramite"]["proptelcom3"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'proptelcom3'", "'" . $_SESSION["tramite"]["proptelcom3"] . "'");
        }
        if (trim($_SESSION["tramite"]["propemailcom"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'propemailcom'", "'" . addslashes($_SESSION["tramite"]["propemailcom"]) . "'");
        }
        if (trim($_SESSION["tramite"]["propdirnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'propdirnot'", "'" . addslashes($_SESSION["tramite"]["propdirnot"]) . "'");
        }
        if (trim($_SESSION["tramite"]["propmunnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'propmunnot'", "'" . $_SESSION["tramite"]["propmunnot"] . "'");
        }
        if (trim($_SESSION["tramite"]["proptelnot1"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'proptelnot1'", "'" . $_SESSION["tramite"]["proptelnot1"] . "'");
        }
        if (trim($_SESSION["tramite"]["proptelnot2"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'proptelnot2'", "'" . $_SESSION["tramite"]["proptelnot2"] . "'");
        }
        if (trim($_SESSION["tramite"]["proptelnot3"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'proptelnot3'", "'" . $_SESSION["tramite"]["proptelnot3"] . "'");
        }
        if (trim($_SESSION["tramite"]["propemailnot"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'propemailnot'", "'" . addslashes($_SESSION["tramite"]["propemailnot"]) . "'");
        }

        if (isset($_SESSION["tramite"]["totalmatriculasrenovar"]) && trim($_SESSION["tramite"]["totalmatriculasrenovar"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'totalmatriculasrenovar'", "'" . ($_SESSION["tramite"]["totalmatriculasrenovar"]) . "'");
        }
        if (isset($_SESSION["tramite"]["totalmatriculasrenovadas"]) && trim($_SESSION["tramite"]["totalmatriculasrenovadas"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'totalmatriculasrenovadas'", "'" . ($_SESSION["tramite"]["totalmatriculasrenovadas"]) . "'");
        }

        if (!isset($_SESSION["tramite"]["cantidadfolios"])) {
            $_SESSION["tramite"]["cantidadfolios"] = '';
        }
        if (trim($_SESSION["tramite"]["cantidadfolios"]) != '' && $_SESSION["tramite"]["cantidadfolios"] != 0) {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'cantidadfolios'", "'" . ($_SESSION["tramite"]["cantidadfolios"]) . "'");
        }
        if (!isset($_SESSION["tramite"]["cantidadhojas"])) {
            $_SESSION["tramite"]["cantidadhojas"] = '';
        }
        if (trim($_SESSION["tramite"]["cantidadhojas"]) != '' && $_SESSION["tramite"]["cantidadhojas"] != 0) {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'cantidadhojas'", "'" . ($_SESSION["tramite"]["cantidadhojas"]) . "'");
        }
        if (!isset($_SESSION["tramite"]["vueltas"])) {
            $_SESSION["tramite"]["vueltas"] = '';
        }
        if (trim($_SESSION["tramite"]["vueltas"]) != '' && $_SESSION["tramite"]["vueltas"] != 0) {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'vueltas'", "'" . ($_SESSION["tramite"]["vueltas"]) . "'");
        }
        if (trim($_SESSION["tramite"]["enviara"]) != '' && $_SESSION["tramite"]["enviara"] != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'enviara'", "'" . ($_SESSION["tramite"]["enviara"]) . "'");
        }
        if (trim($_SESSION["tramite"]["reingresoautomatico"]) != '') {
            $ix++;
            $arrValores[$ix] = array($_SESSION["tramite"]["numeroliquidacion"], "'reingresoautomatico'", "'" . ($_SESSION["tramite"]["reingresoautomatico"]) . "'");
        }

        //
        $res = insertarRegistrosBloqueMysqliApi($dbx, 'mreg_liquidacion_campos', $arrCampos, $arrValores);
        if ($res === false) {
            return false;
        }

        $result = borrarRegistrosMysqliApi($dbx, 'mreg_liquidaciondetalle', 'idliquidacion=' . $_SESSION["tramite"]["numeroliquidacion"]);
        if ($result === false) {
            $_SESSION["generales"]["mensajeerror"] = 'Error borrando registros de mreg_liquidaciondetalle';
            return false;
        }

        $exp1 = '';
        $nom1 = '';
        $i = 0;
        foreach ($_SESSION["tramite"]["liquidacion"] as $liq) {
            if (!isset($liq["idsec"])) {
                $liq["idsec"] = '';
            }
            if (!isset($liq["idservicio"])) {
                $liq["idservicio"] = '';
            }
            if (!isset($liq["expediente"])) {
                $liq["expediente"] = '';
            }
            if (!isset($liq["nombre"])) {
                $liq["nombre"] = '';
            }
            if (!isset($liq["ano"])) {
                $liq["ano"] = '';
            }
            if (!isset($liq["cantidad"])) {
                $liq["cantidad"] = 0;
            }
            if (!isset($liq["valorbase"])) {
                $liq["valorbase"] = 0;
            }
            if (!isset($liq["porcentaje"])) {
                $liq["porcentaje"] = 0;
            }
            if (!isset($liq["valorservicio"])) {
                $liq["valorservicio"] = 0;
            }
            if (!isset($liq["benart7"])) {
                $liq["benart7"] = '';
            }
            if (!isset($liq["benley1780"])) {
                $liq["benley1780"] = '';
            }

            if (!isset($liq["reliquidacion"])) {
                $liq["reliquidacion"] = '';
            }
            if (!isset($liq["serviciobase"])) {
                $liq["serviciobase"] = '';
            }
            if (!isset($liq["pagoafiliacion"])) {
                $liq["pagoafiliacion"] = '';
            }
            if (!isset($liq["ir"])) {
                $liq["ir"] = '';
            }
            if (!isset($liq["iva"])) {
                $liq["iva"] = '';
            }
            if (!isset($liq["idalerta"])) {
                $liq["idalerta"] = '';
            }

            if (trim($liq["idservicio"]) != '') {
                $i++;
                if ($i == 1) {
                    $exp1 = $liq["expediente"];
                    $nom1 = $liq["nombre"];
                }

                //
                $arrCampos = array(
                    'idliquidacion',
                    'secuencia',
                    'idsec',
                    'idservicio',
                    'cc',
                    'expediente',
                    'nombre',
                    'ano',
                    'cantidad',
                    'valorbase',
                    'porcentaje',
                    'valorservicio',
                    'benart7',
                    'benley1780',
                    'reliquidacion',
                    'serviciobase',
                    'pagoafiliacion',
                    'ir',
                    'iva',
                    'idalerta'
                );

                //           
                if (!isset($liq["cc"])) {
                    $liq["cc"] = '';
                }
                //
                $arrValues = array(
                    $_SESSION["tramite"]["numeroliquidacion"],
                    $i,
                    "'" . sprintf("%03s", $liq["idsec"]) . "'",
                    "'" . $liq["idservicio"] . "'",
                    "'" . $liq["cc"] . "'",
                    "'" . $liq["expediente"] . "'",
                    "'" . addslashes(utf8_decode($liq["nombre"])) . "'",
                    "'" . $liq["ano"] . "'",
                    intval($liq["cantidad"]),
                    doubleval($liq["valorbase"]),
                    doubleval($liq["porcentaje"]),
                    doubleval($liq["valorservicio"]),
                    "'" . $liq["benart7"] . "'",
                    "'" . $liq["benley1780"] . "'",
                    "'" . $liq["reliquidacion"] . "'",
                    "'" . $liq["serviciobase"] . "'",
                    "'" . $liq["pagoafiliacion"] . "'",
                    "'" . $liq["ir"] . "'",
                    "'" . $liq["iva"] . "'",
                    intval($liq["idalerta"])
                );

                //
                $result = insertarRegistrosMysqliApi($dbx, 'mreg_liquidaciondetalle', $arrCampos, $arrValues);
                if ($result === false) {
                    $_SESSION["generales"]["mensajeerror"] = 'Error insertando registros en mreg_liquidaciondetalle (' . $_SESSION ["generales"] ["mensajeerror"] . ')';
                    return false;
                }
            }
        }

        // Graba liquidacion RUES
        $result = borrarRegistrosMysqliApi($dbx, 'mreg_liquidaciondetalle_rues', 'idliquidacion=' . $_SESSION["tramite"]["numeroliquidacion"]);
        if ($result === false) {
            $_SESSION["generales"]["mensajeerror"] = 'Error borrando registros de mreg_liquidaciondetalle_rues';
            return false;
        }
        $exp1 = '';
        $nom1 = '';
        $i = 0;

        //
        if (!isset($_SESSION["tramite"]["rues_servicios"])) {
            $_SESSION["tramite"]["rues_servicios"] = array();
        }

        //
        foreach ($_SESSION["tramite"]["rues_servicios"] as $liq) {
            if (!isset($liq["codigo_servicio"])) {
                $liq["codigo_servicio"] = '';
            }
            if (!isset($liq["descripcion_servicio"])) {
                $liq["descripcion_servicio"] = '';
            }
            if (!isset($liq["orden_servicio"])) {
                $liq["orden_servicio"] = 0;
            }
            if (!isset($liq["orden_servicio_asociado"])) {
                $liq["orden_servicio_asociado"] = 0;
            }
            if (!isset($liq["nombre_base"])) {
                $liq["nombre_base"] = '';
            }
            if (!isset($liq["valor_base"])) {
                $liq["valor_base"] = 0;
            }
            if (!isset($liq["valor_liquidacion"])) {
                $liq["valor_liquidacion"] = 0;
            }
            if (!isset($liq["cantidad_servicio"])) {
                $liq["cantidad_servicio"] = 0;
            }
            if (!isset($liq["indicador_base"])) {
                $liq["indicador_base"] = '';
            }
            if (!isset($liq["indicador_renovacion"])) {
                $liq["indicador_renovacion"] = '';
            }
            if (!isset($liq["matricula_servicio"])) {
                $liq["matricula_servicio"] = '';
            }
            if (!isset($liq["nombre_matriculado"])) {
                $liq["nombre_matriculado"] = '';
            }
            if (!isset($liq["ano_renovacion"])) {
                $liq["ano_renovacion"] = '';
            }
            if (!isset($liq["valor_activos_sin_ajustes"])) {
                $liq["valor_activos_sin_ajustes"] = 0;
            }

            $i++;


            $arrCampos = array(
                'idliquidacion',
                'secuencia',
                'codigo_servicio',
                'descripcion_servicio',
                'orden_servicio',
                'orden_servicio_asociado',
                'nombre_base',
                'valor_base',
                'valor_liquidacion',
                'cantidad_servicio',
                'indicador_base',
                'indicador_renovacion',
                'matricula_servicio',
                'nombre_matriculado',
                'ano_renovacion',
                'valor_activos_sin_ajustes'
            );


            $arrValues = array(
                $_SESSION["tramite"]["numeroliquidacion"],
                $i,
                "'" . $liq["codigo_servicio"] . "'",
                "'" . utf8_decode($liq["descripcion_servicio"]) . "'",
                "'" . $liq["orden_servicio"] . "'",
                "'" . $liq["orden_servicio_asociado"] . "'",
                "'" . addslashes(utf8_decode($liq["nombre_base"])) . "'",
                "'" . $liq["valor_base"] . "'",
                "'" . $liq["valor_liquidacion"] . "'",
                "'" . $liq["cantidad_servicio"] . "'",
                "'" . $liq["indicador_base"] . "'",
                "'" . $liq["indicador_renovacion"] . "'",
                "'" . $liq["matricula_servicio"] . "'",
                "'" . addslashes(utf8_decode($liq["nombre_matriculado"])) . "'",
                "'" . $liq["ano_renovacion"] . "'",
                "'" . $liq["valor_activos_sin_ajustes"] . "'"
            );


            $result = insertarRegistrosMysqliApi($dbx, 'mreg_liquidaciondetalle_rues', $arrCampos, $arrValues);
            if ($result === false) {
                $_SESSION["generales"]["mensajeerror"] = 'Error insertando registros en mreg_liquidaciondetalle_rues (' . $_SESSION ["generales"] ["mensajeerror"] . ')';
                return false;
            }
        }

        //
        if (!isset($_SESSION["tramite"]["rues_textos"])) {
            $_SESSION["tramite"]["rues_textos"] = array();
        }

        //
        borrarRegistrosMysqliApi($dbx, 'mreg_liquidacion_textos_rues', "idliquidacion=" . $_SESSION["tramite"]["numeroliquidacion"]);

        //
        $ix = 0;
        foreach ($_SESSION["tramite"]["rues_textos"] as $tx) {
            $ix++;

            //
            $arrCampos = array(
                'idliquidacion',
                'secuencia',
                'texto',
            );

            //
            $arrValues = array(
                $_SESSION["tramite"]["numeroliquidacion"],
                $ix,
                "'" . addslashes(utf8_decode($tx)) . "'"
            );

            //
            $result = insertarRegistrosMysqliApi($dbx, 'mreg_liquidacion_textos_rues', $arrCampos, $arrValues);
            if ($result === false) {
                $_SESSION["generales"]["mensajeerror"] = 'Error insertando registros en mreg_liquidaciontextos_rues (' . $_SESSION ["generales"] ["mensajeerror"] . ')';
                return false;
            }
        }


        // Graba expedientes
        $result = borrarRegistrosMysqliApi($dbx, 'mreg_liquidacionexpedientes', 'idliquidacion=' . $_SESSION["tramite"]["numeroliquidacion"]);
        if ($result === false) {
            $_SESSION["generales"]["mensajeerror"] = 'Error borrando registros de mreg_liquidacionexpedientes';
            return false;
        }

        if (!empty($_SESSION["tramite"]["expedientes"])) {
            $i = 0;
            foreach ($_SESSION["tramite"]["expedientes"] as $mat) {
                if (!isset($mat["cc"])) {
                    $mat["cc"] = '';
                }
                if (!isset($mat["matricula"])) {
                    $mat["matricula"] = '';
                }
                if (!isset($mat["proponente"])) {
                    $mat["proponente"] = '';
                }
                if (!isset($mat["numrue"])) {
                    $mat["numrue"] = '';
                }
                if (!isset($mat["idtipoidentificacion"])) {
                    $mat["idtipoidentificacion"] = '';
                }
                if (!isset($mat["identificacion"])) {
                    $mat["identificacion"] = '';
                }
                if (!isset($mat["razonsocial"])) {
                    $mat["razonsocial"] = '';
                }
                if (!isset($mat["ape1"])) {
                    $mat["ape1"] = '';
                }
                if (!isset($mat["ape2"])) {
                    $mat["ape2"] = '';
                }
                if (!isset($mat["nom1"])) {
                    $mat["nom1"] = '';
                }
                if (!isset($mat["nom2"])) {
                    $mat["nom2"] = '';
                }
                if (!isset($mat["organizacion"])) {
                    $mat["organizacion"] = '';
                }
                if (!isset($mat["categoria"])) {
                    $mat["caetgoria"] = '';
                }
                if (!isset($mat["afiliado"])) {
                    $mat["afiliado"] = '';
                }
                if (!isset($mat["propietariojurisdiccion"])) {
                    $mat["propietariojurisdiccion"] = '';
                }
                if (!isset($mat["primeranorenovado"])) {
                    $mat["primeranorenovado"] = '';
                }
                if (!isset($mat["ultimoanoafiliado"])) {
                    $mat["ultimoanoafiliado"] = '';
                }
                if (!isset($mat["ultimoanorenovado"])) {
                    $mat["ultimoanorenovado"] = '';
                }
                if (!isset($mat["ultimosactivos"])) {
                    $mat["ultimosactivos"] = 0;
                }
                if (!isset($mat["nuevosactivos"])) {
                    $mat["nuevosactivos"] = 0;
                }
                if (!isset($mat["actividad"])) {
                    $mat["actividad"] = '';
                }
                if (!isset($mat["registrobase"])) {
                    $mat["registrobase"] = '';
                }
                if (!isset($mat["benart7"])) {
                    $mat["benart7"] = '';
                }
                if (!isset($mat["benley1780"])) {
                    $mat["benley1780"] = '';
                }

                if (!isset($mat["renovaresteano"])) {
                    $mat["renovaresteano"] = '';
                }
                if (!isset($mat["fechanacimiento"])) {
                    $mat["fechanacimiento"] = '';
                }
                if (!isset($mat["fechamatricula"])) {
                    $mat["fechamatricula"] = '';
                }
                if (!isset($mat["fecmatant"])) {
                    $mat["fecmatant"] = '';
                }
                if (!isset($mat["reliquidacion"])) {
                    $mat["reliquidacion"] = '';
                }
                if ($mat["ultimosactivos"] == '') {
                    $mat["ultimosactivos"] = 0;
                }
                if ($mat["nuevosactivos"] == '') {
                    $mat["nuevosactivos"] = 0;
                }

                //
                $i++;
                $arrCampos = array(
                    'idliquidacion',
                    'secuencia',
                    'cc',
                    'matricula',
                    'proponente',
                    'numrue',
                    'idtipoidentificacion',
                    'identificacion',
                    'razonsocial',
                    'ape1',
                    'ape2',
                    'nom1',
                    'nom2',
                    'organizacion',
                    'categoria',
                    'afiliado',
                    'propietariojurisdiccion',
                    'ultimoanoafiliado',
                    'ultimoanorenovado',
                    'primeranorenovado',
                    'ultimosactivos',
                    'nuevosactivos',
                    'actividad',
                    'registrobase',
                    'benart7',
                    'benley1780',
                    'renovaresteano',
                    'fechanacimiento',
                    'fechamatricula',
                    'fecmatant',
                    'reliquidacion',
                    'controlpot'
                );
                if (!isset($mat["primeranorenovado"])) {
                    $mat["primeranorenovado"] = '';
                }
                if (!isset($mat["controlpot"])) {
                    $mat["controlpot"] = '';
                }
                $arrValues = array(
                    $_SESSION["tramite"]["numeroliquidacion"],
                    sprintf("%03s", $i),
                    "'" . $mat["cc"] . "'",
                    "'" . $mat["matricula"] . "'",
                    "'" . $mat["proponente"] . "'",
                    "'" . $mat["numrue"] . "'",
                    "'" . $mat["idtipoidentificacion"] . "'",
                    "'" . $mat["identificacion"] . "'",
                    "'" . addslashes(utf8_decode($mat["razonsocial"])) . "'",
                    "'" . addslashes(utf8_decode($mat["ape1"])) . "'",
                    "'" . addslashes(utf8_decode($mat["ape2"])) . "'",
                    "'" . addslashes(utf8_decode($mat["nom1"])) . "'",
                    "'" . addslashes(utf8_decode($mat["nom2"])) . "'",
                    "'" . $mat["organizacion"] . "'",
                    "'" . $mat["categoria"] . "'",
                    "'" . $mat["afiliado"] . "'",
                    "'" . $mat["propietariojurisdiccion"] . "'",
                    "'" . $mat["ultimoanoafiliado"] . "'",
                    "'" . $mat["ultimoanorenovado"] . "'",
                    "'" . $mat["primeranorenovado"] . "'",
                    $mat["ultimosactivos"],
                    $mat["nuevosactivos"],
                    "'" . $mat["actividad"] . "'",
                    "'" . $mat["registrobase"] . "'",
                    "'" . $mat["benart7"] . "'",
                    "'" . $mat["benley1780"] . "'",
                    "'" . $mat["renovaresteano"] . "'",
                    "'" . $mat["fechanacimiento"] . "'",
                    "'" . $mat["fechamatricula"] . "'",
                    "'" . $mat["fecmatant"] . "'",
                    "'" . $mat["reliquidacion"] . "'",
                    "'" . $mat["controlpot"] . "'",
                );
                $result = insertarRegistrosMysqliApi($dbx, 'mreg_liquidacionexpedientes', $arrCampos, $arrValues);
                if ($result === false) {
                    $_SESSION["generales"]["mensajeerror"] = 'Error insertando registros de mreg_liquidacionexpedientes';
                    return false;
                }
            }
        }

        // Graba transacciones
        $result = borrarRegistrosMysqliApi($dbx, 'mreg_liquidacion_transacciones', 'idliquidacion=' . $_SESSION["tramite"]["numeroliquidacion"]);
        if ($result === false) {
            $_SESSION["generales"]["mensajeerror"] = 'Error borrando registros de mreg_liquidaciondetalle';
            return false;
        }
        $exp1 = '';
        $nom1 = '';
        $i = 0;

        //
        $retornar = true;
        $mensajeRetornar = '';

        if (!empty($_SESSION["tramite"]["transacciones"])) {
            foreach ($_SESSION["tramite"]["transacciones"] as $tra) {
                if (!isset($tra["ultimoanorenovadoanterior"])) {
                    $tra["ultimoanorenovadoanterior"] = '';
                }

                //
                if (!isset($tra["benart7"])) {
                    $tra["benart7"] = '';
                }
                if (!isset($tra["benley1780"])) {
                    $tra["benley1780"] = '';
                }
                if (!isset($tra["fechanacimientopnat"])) {
                    $tra["fechanacimientopnat"] = '';
                }

                //
                if (!isset($tra["patrimonio"])) {
                    $tra["patrimonio"] = 0;
                }
                if (!isset($tra["capitalsocial"])) {
                    $tra["capitalsocial"] = 0;
                }
                if (!isset($tra["capitalautorizado"])) {
                    $tra["capitalautorizado"] = 0;
                }
                if (!isset($tra["capitalsuscrito"])) {
                    $tra["capitalsuscrito"] = 0;
                }
                if (!isset($tra["capitalpagado"])) {
                    $tra["capitalpagado"] = 0;
                }
                if (!isset($tra["aportedinero"])) {
                    $tra["aportedinero"] = 0;
                }
                if (!isset($tra["aporteactivos"])) {
                    $tra["aporteactivos"] = 0;
                }
                if (!isset($tra["aportelaboral"])) {
                    $tra["aportelaboral"] = 0;
                }
                if (!isset($tra["aportelaboraladicional"])) {
                    $tra["aportelaboraladicional"] = 0;
                }
                if (!isset($tra["capitalasignado"])) {
                    $tra["capitalasignado"] = 0;
                }
                if (!isset($tra["pornaltot"])) {
                    $tra["pornaltot"] = 0;
                }
                if (!isset($tra["pornalpub"])) {
                    $tra["pornalpub"] = 0;
                }
                if (!isset($tra["pornalpri"])) {
                    $tra["pornalpri"] = 0;
                }
                if (!isset($tra["porexttot"])) {
                    $tra["porexttot"] = 0;
                }
                if (!isset($tra["porextpub"])) {
                    $tra["porextpub"] = 0;
                }
                if (!isset($tra["porextpri"])) {
                    $tra["porextpri"] = 0;
                }

                if (!isset($tra["tipoidentificacionvendedor"])) {
                    $tra["tipoidentificacionvendedor"] = '';
                }
                if (!isset($tra["identificacionvendedor"])) {
                    $tra["identificacionvendedor"] = '';
                }
                if (!isset($tra["nombrevendedor"])) {
                    $tra["nombrevendedor"] = '';
                }
                if (!isset($tra["camaravendedor"])) {
                    $tra["camaravendedor"] = '';
                }
                if (!isset($tra["matriculavendedor"])) {
                    $tra["matriculavendedor"] = '';
                }
                if (!isset($tra["nombre1vendedor"])) {
                    $tra["nombre1vendedor"] = '';
                }
                if (!isset($tra["nombre2vendedor"])) {
                    $tra["nombre2vendedor"] = '';
                }
                if (!isset($tra["apellido1vendedor"])) {
                    $tra["apellido1vendedor"] = '';
                }
                if (!isset($tra["apellido2vendedor"])) {
                    $tra["apellido2vendedor"] = '';
                }
                if (!isset($tra["emailvendedor"])) {
                    $tra["emailvendedor"] = '';
                }
                if (!isset($tra["celularvendedor"])) {
                    $tra["celularvendedor"] = '';
                }
                if (!isset($tra["cancelarvendedor"])) {
                    $tra["cancelarvendedor"] = '';
                }

                if (!isset($tra["tipoidentificacioncomprador"])) {
                    $tra["tipoidentificacioncomprador"] = '';
                }
                if (!isset($tra["identificacioncomprador"])) {
                    $tra["identificacioncomprador"] = '';
                }
                if (!isset($tra["nombrecomprador"])) {
                    $tra["nombrecomprador"] = '';
                }
                if (!isset($tra["camaracomprador"])) {
                    $tra["camaracomprador"] = '';
                }
                if (!isset($tra["matriculacomprador"])) {
                    $tra["matriculacomprador"] = '';
                }
                if (!isset($tra["organizacioncomprador"])) {
                    $tra["organizacioncomprador"] = '';
                }
                if (!isset($tra["municipiocomprador"])) {
                    $tra["municipiocomprador"] = '';
                }
                if (!isset($tra["nombre1comprador"])) {
                    $tra["nombre1comprador"] = '';
                }
                if (!isset($tra["nombre2comprador"])) {
                    $tra["nombre2comprador"] = '';
                }
                if (!isset($tra["apellido1comprador"])) {
                    $tra["apellido1comprador"] = '';
                }
                if (!isset($tra["apellido2comprador"])) {
                    $tra["apellido2comprador"] = '';
                }
                if (!isset($tra["emailcomprador"])) {
                    $tra["emailcomprador"] = '';
                }
                if (!isset($tra["celularcomprador"])) {
                    $tra["celularcomprador"] = '';
                }
                if (!isset($tra["activoscomprador"])) {
                    $tra["activoscomprador"] = 0;
                }
                if (!isset($tra["personalcomprador"])) {
                    $tra["personalcomprador"] = 0;
                }

                if (!isset($tra["municipioanterior"])) {
                    $tra["municipioanterior"] = '';
                }
                if (!isset($tra["matriculaanterior"])) {
                    $tra["matriculaanterior"] = '';
                }
                if (!isset($tra["camaraanterior"])) {
                    $tra["camaraanterior"] = '';
                }
                if (!isset($tra["fecharenovacionanterior"])) {
                    $tra["fecharenovacionanterior"] = '';
                }
                if (!isset($tra["benart7anterior"])) {
                    $tra["benart7anterior"] = '';
                }
                if (!isset($tra["municipiodestino"])) {
                    $tra["municipiodestino"] = '';
                }
                if (!isset($tra["camaradestino"])) {
                    $tra["camaradestino"] = '';
                }
                if (!isset($tra["prerut"])) {
                    $tra["prerut"] = '';
                }
                if (!isset($tra["acreditapagoir"])) {
                    $tra["acreditapagoir"] = '';
                }
                if (!isset($tra["nroreciboacreditapagoir"])) {
                    $tra["nroreciboacreditapagoir"] = '';
                }
                if (!isset($tra["fechareciboacreditapagoir"])) {
                    $tra["fechareciboacreditapagoir"] = '';
                }
                if (!isset($tra["gobernacionreciboacreditapagoir"])) {
                    $tra["gobernacionreciboacreditapagoir"] = '';
                }
                if (!isset($tra["tipodisolucion"])) {
                    $tra["tipodisolucion"] = '';
                }
                if (!isset($tra["tipoliquidacion"])) {
                    $tra["tipoliquidacion"] = '';
                }
                if (!isset($tra["motivoliquidacion"])) {
                    $tra["motivoliquidacion"] = '';
                }
                if (!isset($tra["ciiu1"])) {
                    $tra["ciiu1"] = '';
                }
                if (!isset($tra["ciiu2"])) {
                    $tra["ciiu2"] = '';
                }
                if (!isset($tra["ciiu3"])) {
                    $tra["ciiu3"] = '';
                }
                if (!isset($tra["ciiu4"])) {
                    $tra["ciiu4"] = '';
                }
                if (!isset($tra["entidadvigilancia"])) {
                    $tra["entidadvigilancia"] = '';
                }
                if (!isset($tra["objetosocial"])) {
                    $tra["objetosocial"] = '';
                }
                if (!isset($tra["facultades"])) {
                    $tra["facultades"] = '';
                }
                if (!isset($tra["limitaciones"])) {
                    $tra["limitaciones"] = '';
                }
                if (!isset($tra["entidadvigilancia"])) {
                    $tra["entidadvigilancia"] = '';
                }
                if (!isset($tra["poderespecial"])) {
                    $tra["poderespecial"] = '';
                }

                if (!isset($tra["clase_libro"])) {
                    $tra["clase_libro"] = '';
                }
                if (!isset($tra["tipo_libro"])) {
                    $tra["tipo_libro"] = '';
                }
                if (!isset($tra["codigo_libro"])) {
                    $tra["codigo_libro"] = '';
                }
                if (!isset($tra["nombre_libro"])) {
                    $tra["nombre_libro"] = '';
                }
                if (!isset($tra["email_libro"])) {
                    $tra["email_libro"] = '';
                }
                if (!isset($tra["emailconfirmacion_libro"])) {
                    $tra["emailconfirmacion_libro"] = '';
                }
                if (!isset($tra["paginainicial_libro"]) || ltrim($tra["paginainicial_libro"], "0") == '') {
                    $tra["paginainicial_libro"] = 0;
                }
                if (!isset($tra["paginafinal_libro"]) || ltrim($tra["paginafinal_libro"], "0") == '') {
                    $tra["paginafinal_libro"] = 0;
                }
                if (!isset($tra["incluirrotulado_libro"])) {
                    $tra["incluirrotulado_libro"] = '';
                }

                if (!isset($tra["actanro_libro"])) {
                    $tra["actanro_libro"] = '';
                }
                if (!isset($tra["fechaacta_libro"])) {
                    $tra["fechaacta_libro"] = '';
                }
                if (!isset($tra["horaacta_libro"])) {
                    $tra["horaacta_libro"] = '';
                }
                if (!isset($tra["fechaini_libroelectronico"])) {
                    $tra["fechaini_libroelectronico"] = '';
                }
                if (!isset($tra["fechafin_libroelectronico"])) {
                    $tra["fechafin_libroelectronico"] = '';
                }
                if (!isset($tra["fechainiinscripciones_libroelectronico"])) {
                    $tra["fechainiinscripciones_libroelectronico"] = '';
                }
                if (!isset($tra["fechafininscripciones_libroelectronico"])) {
                    $tra["fechafininscripciones_libroelectronico"] = '';
                }

                //
                if (!isset($tra["libeleanot_libro"])) {
                    $tra["libeleanot_libro"] = '';
                }
                if (!isset($tra["libeleanot_registro"])) {
                    $tra["libeleanot_registro"] = '';
                }
                if (!isset($tra["libeleanot_dupli"])) {
                    $tra["libeleanot_dupli"] = '';
                }

                if (!isset($tra["libeleanot_nroacta"])) {
                    $tra["libeleanot_nroacta"] = '';
                }
                if (!isset($tra["libeleanot_fechaacta"])) {
                    $tra["libeleanot_fechaacta"] = '';
                }
                if (!isset($tra["libeleanot_nropaginas"])) {
                    $tra["libeleanot_nropaginas"] = 0;
                }
                if (!isset($tra["libeleanot_fechainiinscripciones"])) {
                    $tra["libeleanot_fechainiinscripciones"] = '';
                }
                if (!isset($tra["libeleanot_fechafininscripciones"])) {
                    $tra["libeleanot_fechafininscripciones"] = '';
                }
                if (!isset($tra["libeleanot_nroregistros"])) {
                    $tra["libeleanot_nroregistros"] = 0;
                }


                //
                if (!isset($tra["embargo"])) {
                    $tra["embargo"] = '';
                }
                if (!isset($tra["tipoideembargante"])) {
                    $tra["tipoideembargante"] = '';
                }
                if (!isset($tra["ideembargante"])) {
                    $tra["ideembargante"] = '';
                }
                if (!isset($tra["nom1embargante"])) {
                    $tra["nom1embargante"] = '';
                }
                if (!isset($tra["nom2embargante"])) {
                    $tra["nom2embargante"] = '';
                }
                if (!isset($tra["ape1embargante"])) {
                    $tra["ape1embargante"] = '';
                }
                if (!isset($tra["ape2embargante"])) {
                    $tra["ape2embargante"] = '';
                }

                //
                if (!isset($tra["desembargo"])) {
                    $tra["desembargo"] = '';
                }
                if (!isset($tra["librocruce"])) {
                    $tra["librocruce"] = '';
                }
                if (!isset($tra["inscripcioncruce"])) {
                    $tra["inscripcioncruce"] = '';
                }

                if (!isset($tra["cantidad"])) {
                    $tra["cantidad"] = 1;
                }

                if (!isset($tra["cantidadadicional"])) {
                    $tra["cantidadadicional"] = 0;
                }

                $i++;
                $arrCampos = array(
                    'idliquidacion',
                    'idsecuencia',
                    'idtransaccion',
                    'matriculaafectada',
                    'tipodoc',
                    'numdoc',
                    'fechadoc',
                    'origendoc',
                    'mundoc',
                    'camaravendedor',
                    'matriculavendedor',
                    'tipoidentificacionvendedor',
                    'identificacionvendedor',
                    'nombrevendedor',
                    'nombre1vendedor',
                    'nombre2vendedor',
                    'apellido1vendedor',
                    'apellido2vendedor',
                    'emailvendedor',
                    'celularvendedor',
                    'cancelarvendedor',
                    'camaracomprador',
                    'matriculacomprador',
                    'organizacioncomprador',
                    'municipiocomprador',
                    'tipoidentificacioncomprador',
                    'identificacioncomprador',
                    'nombrecomprador',
                    'nombre1comprador',
                    'nombre2comprador',
                    'apellido1comprador',
                    'apellido2comprador',
                    'emailcomprador',
                    'celularcomprador',
                    'activoscomprador',
                    'personalcomprador',
                    'municipioanterior',
                    'matriculaanterior',
                    'camaraanterior',
                    'fechamatriculaanterior',
                    'fecharenovacionanterior',
                    'ultimoanorenovadoanterior',
                    'benart7anterior',
                    'municipiodestino',
                    'camaradestino',
                    'organizacion',
                    'categoria',
                    'razonsocial',
                    'sigla',
                    'tipoidentificacion',
                    'identificacion',
                    'nit',
                    'prerut',
                    'ape1',
                    'ape2',
                    'nom1',
                    'nom2',
                    'cargo',
                    'idvinculo',
                    'idrenglon',
                    'aceptacion',
                    'identificacionrepresentada',
                    'razonsocialrepresentada',
                    'pornaltot',
                    'pornalpub',
                    'pornalpri',
                    'porexttot',
                    'porextpub',
                    'porextpri',
                    'personal',
                    'activos',
                    'costotransaccion',
                    'patrimonio',
                    'benart7',
                    'benley1780',
                    'fechanacimientopnat',
                    'capitalsocial',
                    'capitalautorizado',
                    'capitalsuscrito',
                    'capitalpagado',
                    'aporteactivos',
                    'aportedinero',
                    'aportelaboral',
                    'aportelaboraladicional',
                    'capitalasignado',
                    'acreditapagoir',
                    'nroreciboacreditapagoir',
                    'fechareciboacreditapagoir',
                    'gobernacionacreditapagoir',
                    'dircom',
                    'municipio',
                    'fechaduracion',
                    'tipodisolucion',
                    'motivodisolucion',
                    'tipoliquidacion',
                    'motivoliquidacion',
                    'ciiu1',
                    'ciiu2',
                    'ciiu3',
                    'ciiu4',
                    'clase_libro',
                    'tipo_libro',
                    'codigo_libro',
                    'nombre_libro',
                    'email_libro',
                    'emailconfirmacion_libro',
                    'paginainicial_libro',
                    'paginafinal_libro',
                    'incluirrotulado_libro',
                    'libeleanot_libro',
                    'libeleanot_registro',
                    'libeleanot_dupli',
                    'libeleanot_nroacta',
                    'libeleanot_fechaacta',
                    'libeleanot_nropaginas',
                    'libeleanot_fechainiinscripciones',
                    'libeleanot_fechafininscripciones',
                    'libeleanot_nroregistros',
                    'actanro_libro',
                    'fechaacta_libro',
                    'horaacta_libro',
                    'fechaini_libroelectronico',
                    'fechafin_libroelectronico',
                    'fechainiinscripciones_libroelectronico',
                    'fechafininscripciones_libroelectronico',
                    'embargo',
                    'tipoideembargante',
                    'ideembargante',
                    'nom1embargante',
                    'nom2embargante',
                    'ape1embargante',
                    'ape2embargante',
                    'desembargo',
                    'librocruce',
                    'inscripcioncruce',
                    'entidadvigilancia',
                    'objetosocial',
                    'facultades',
                    'limitaciones',
                    'poderespecial',
                    'texto',
                    'cantidad'
                );

                if (doubleval($tra["activos"]) == 0) {
                    $tra["activos"] = 0;
                }
                if (doubleval($tra["personal"]) == 0) {
                    $tra["personal"] = 0;
                }
                if (doubleval($tra["costotransaccion"]) == 0) {
                    $tra["costotransaccion"] = 0;
                }
                if (doubleval($tra["patrimonio"]) == 0) {
                    $tra["patrimonio"] = 0;
                }
                if (doubleval($tra["capitalsocial"]) == 0) {
                    $tra["capitalsocial"] = 0;
                }
                if (doubleval($tra["capitalautorizado"]) == 0) {
                    $tra["capitalautorizado"] = 0;
                }
                if (doubleval($tra["capitalsuscrito"]) == 0) {
                    $tra["capitalsuscrito"] = 0;
                }
                if (doubleval($tra["capitalpagado"]) == 0) {
                    $tra["capitalpagado"] = 0;
                }
                if (doubleval($tra["aportedinero"]) == 0) {
                    $tra["aportedinero"] = 0;
                }
                if (doubleval($tra["aporteactivos"]) == 0) {
                    $tra["aporteactivos"] = 0;
                }
                if (doubleval($tra["aportelaboral"]) == 0) {
                    $tra["aportelaboral"] = 0;
                }
                if (doubleval($tra["aportelaboraladicional"]) == 0) {
                    $tra["aportelaboraladicional"] = 0;
                }
                if (doubleval($tra["capitalasignado"]) == 0) {
                    $tra["capitalasignado"] = 0;
                }
                if (doubleval($tra["pornaltot"]) == 0) {
                    $tra["pornaltot"] = 0;
                }
                if (doubleval($tra["pornalpub"]) == 0) {
                    $tra["pornalpub"] = 0;
                }
                if (doubleval($tra["pornalpri"]) == 0) {
                    $tra["pornalpri"] = 0;
                }
                if (doubleval($tra["porexttot"]) == 0) {
                    $tra["porexttot"] = 0;
                }
                if (doubleval($tra["porextpub"]) == 0) {
                    $tra["porextpub"] = 0;
                }
                if (doubleval($tra["porextpri"]) == 0) {
                    $tra["porextpri"] = 0;
                }
                if (!isset($tra["nit"])) {
                    $tra["nit"] = '';
                }

                $arrValores = array(
                    $_SESSION["tramite"]["numeroliquidacion"],
                    "'" . sprintf("%03s", $i) . "'",
                    "'" . $tra['idtransaccion'] . "'",
                    "'" . $tra['matriculaafectada'] . "'",
                    "'" . $tra['tipodoc'] . "'",
                    "'" . $tra['numdoc'] . "'",
                    "'" . $tra['fechadoc'] . "'",
                    "'" . $tra['origendoc'] . "'",
                    "'" . $tra['mundoc'] . "'",
                    "'" . $tra['camaravendedor'] . "'",
                    "'" . $tra['matriculavendedor'] . "'",
                    "'" . $tra['tipoidentificacionvendedor'] . "'",
                    "'" . $tra['identificacionvendedor'] . "'",
                    "'" . addslashes(utf8_decode($tra['nombrevendedor'])) . "'",
                    "'" . addslashes(utf8_decode($tra['nombre1vendedor'])) . "'",
                    "'" . addslashes(utf8_decode($tra['nombre2vendedor'])) . "'",
                    "'" . addslashes(utf8_decode($tra['apellido1vendedor'])) . "'",
                    "'" . addslashes(utf8_decode($tra['apellido2vendedor'])) . "'",
                    "'" . addslashes(utf8_decode($tra['emailvendedor'])) . "'",
                    "'" . addslashes($tra['celularvendedor']) . "'",
                    "'" . addslashes($tra['cancelarvendedor']) . "'",
                    "'" . $tra['camaracomprador'] . "'",
                    "'" . $tra['matriculacomprador'] . "'",
                    "'" . $tra['organizacioncomprador'] . "'",
                    "'" . $tra['municipiocomprador'] . "'",
                    "'" . $tra['tipoidentificacioncomprador'] . "'",
                    "'" . $tra['identificacioncomprador'] . "'",
                    "'" . addslashes(utf8_decode($tra['nombrecomprador'])) . "'",
                    "'" . addslashes(utf8_decode($tra['nombre1comprador'])) . "'",
                    "'" . addslashes(utf8_decode($tra['nombre2comprador'])) . "'",
                    "'" . addslashes(utf8_decode($tra['apellido1comprador'])) . "'",
                    "'" . addslashes(utf8_decode($tra['apellido2comprador'])) . "'",
                    "'" . addslashes(utf8_decode($tra['emailcomprador'])) . "'",
                    "'" . addslashes($tra['celularcomprador']) . "'",
                    $tra['activoscomprador'],
                    $tra['personalcomprador'],
                    "'" . $tra['municipioanterior'] . "'",
                    "'" . $tra['matriculaanterior'] . "'",
                    "'" . $tra['camaraanterior'] . "'",
                    "'" . $tra['fechamatriculaanterior'] . "'",
                    "'" . $tra['fecharenovacionanterior'] . "'",
                    "'" . $tra['ultimoanorenovadoanterior'] . "'",
                    "'" . $tra['benart7anterior'] . "'",
                    "'" . $tra['municipiodestino'] . "'",
                    "'" . $tra['camaradestino'] . "'",
                    "'" . $tra['organizacion'] . "'",
                    "'" . $tra['categoria'] . "'",
                    "'" . addslashes(utf8_decode($tra['razonsocial'])) . "'",
                    "'" . addslashes(utf8_decode($tra['sigla'])) . "'",
                    "'" . $tra['tipoidentificacion'] . "'",
                    "'" . $tra['identificacion'] . "'",
                    "'" . $tra['nit'] . "'",
                    "'" . $tra['prerut'] . "'",
                    "'" . addslashes(utf8_decode($tra['ape1'])) . "'",
                    "'" . addslashes(utf8_decode($tra['ape2'])) . "'",
                    "'" . addslashes(utf8_decode($tra['nom1'])) . "'",
                    "'" . addslashes(utf8_decode($tra['nom2'])) . "'",
                    "'" . addslashes(utf8_decode($tra['cargo'])) . "'",
                    "'" . $tra['idvinculo'] . "'",
                    "'" . $tra['idrenglon'] . "'",
                    "'" . $tra['aceptacion'] . "'",
                    "'" . $tra['identificacionrepresentada'] . "'",
                    "'" . addslashes(utf8_decode($tra['razonsocialrepresentada'])) . "'",
                    $tra['pornaltot'],
                    $tra['pornalpub'],
                    $tra['pornalpri'],
                    $tra['porexttot'],
                    $tra['porextpub'],
                    $tra['porextpri'],
                    $tra['personal'],
                    $tra['activos'],
                    $tra['costotransaccion'],
                    $tra['patrimonio'],
                    "'" . addslashes($tra['benart7']) . "'",
                    "'" . addslashes($tra['benley1780']) . "'",
                    "'" . addslashes($tra['fechanacimientopnat']) . "'",
                    $tra['capitalsocial'],
                    $tra['capitalautorizado'],
                    $tra['capitalsuscrito'],
                    $tra['capitalpagado'],
                    $tra['aporteactivos'],
                    $tra['aportedinero'],
                    $tra['aportelaboral'],
                    $tra['aportelaboraladicional'],
                    $tra['capitalasignado'],
                    "'" . $tra['acreditapagoir'] . "'",
                    "'" . $tra['nroreciboacreditapagoir'] . "'",
                    "'" . $tra['fechareciboacreditapagoir'] . "'",
                    "'" . $tra['gobernacionacreditapagoir'] . "'",
                    "'" . addslashes(utf8_decode($tra['dircom'])) . "'",
                    "'" . $tra['municipio'] . "'",
                    "'" . $tra['fechaduracion'] . "'",
                    "'" . $tra['tipodisolucion'] . "'",
                    "'" . addslashes(utf8_decode($tra['motivodisolucion'])) . "'",
                    "'" . $tra['tipoliquidacion'] . "'",
                    "'" . addslashes(utf8_decode($tra['motivoliquidacion'])) . "'",
                    "'" . $tra['ciiu1'] . "'",
                    "'" . $tra['ciiu2'] . "'",
                    "'" . $tra['ciiu3'] . "'",
                    "'" . $tra['ciiu4'] . "'",
                    "'" . $tra['clase_libro'] . "'",
                    "'" . $tra['tipo_libro'] . "'",
                    "'" . $tra['codigo_libro'] . "'",
                    "'" . addslashes(utf8_decode($tra['nombre_libro'])) . "'",
                    "'" . addslashes(utf8_decode($tra['email_libro'])) . "'",
                    "'" . addslashes(utf8_decode($tra['emailconfirmacion_libro'])) . "'",
                    $tra['paginainicial_libro'],
                    $tra['paginafinal_libro'],
                    "'" . $tra['incluirrotulado_libro'] . "'",
                    "'" . $tra['libeleanot_libro'] . "'",
                    "'" . $tra['libeleanot_registro'] . "'",
                    "'" . $tra['libeleanot_dupli'] . "'",
                    "'" . $tra['libeleanot_nroacta'] . "'",
                    "'" . $tra['libeleanot_fechaacta'] . "'",
                    intval($tra['libeleanot_nropaginas']),
                    "'" . $tra['libeleanot_fechainiinscripciones'] . "'",
                    "'" . $tra['libeleanot_fechafininscripciones'] . "'",
                    intval($tra['libeleanot_nroregistros']),
                    "'" . $tra['actanro_libro'] . "'",
                    "'" . $tra['fechaacta_libro'] . "'",
                    "'" . $tra['horaacta_libro'] . "'",
                    "'" . $tra['fechaini_libroelectronico'] . "'",
                    "'" . $tra['fechafin_libroelectronico'] . "'",
                    "'" . $tra['fechainiinscripciones_libroelectronico'] . "'",
                    "'" . $tra['fechafininscripciones_libroelectronico'] . "'",
                    "'" . addslashes(utf8_decode($tra['embargo'])) . "'",
                    "'" . $tra['tipoideembargante'] . "'",
                    "'" . $tra['ideembargante'] . "'",
                    "'" . addslashes(utf8_decode($tra['nom1embargante'])) . "'",
                    "'" . addslashes(utf8_decode($tra['nom2embargante'])) . "'",
                    "'" . addslashes(utf8_decode($tra['ape1embargante'])) . "'",
                    "'" . addslashes(utf8_decode($tra['ape2embargante'])) . "'",
                    "'" . addslashes(utf8_decode($tra['desembargo'])) . "'",
                    "'" . $tra['librocruce'] . "'",
                    "'" . $tra['inscripcioncruce'] . "'",
                    "'" . addslashes(utf8_decode($tra['entidadvigilancia'])) . "'",
                    "'" . addslashes(utf8_decode($tra['objetosocial'])) . "'",
                    "'" . addslashes(utf8_decode($tra['facultades'])) . "'",
                    "'" . addslashes(utf8_decode($tra['limitaciones'])) . "'",
                    "'" . addslashes(utf8_decode($tra['poderespecial'])) . "'",
                    "'" . addslashes(utf8_decode($tra['texto'])) . "'",
                    intval($tra["cantidad"])
                );

                $res = insertarRegistrosMysqliApi($dbx, 'mreg_liquidacion_transacciones', $arrCampos, $arrValores);
                if ($res === false) {
                    $retornar = false;
                    $mensajeRetornar = $_SESSION["generales"]["mensajeerror"];
                }
            }
        }

        $_SESSION["generales"]["mensajeerror"] = $mensajeRetornar;
        return $retornar;
    }

    public static function grabarPathAnexoRadicacion($dbx = null, $idanexo = '', $path = '') {
        $arrCampos = array(
            'path'
        );

        $arrValores = array(
            "'" . $path . "'"
        );

        $condicion = "idanexo = " . $idanexo;

        regrabarRegistrosMysqliApi($dbx, 'mreg_radicacionesanexos', $arrCampos, $arrValores, $condicion);
    }

    public static function verificarDatosModificadosApi($dbx, $numliq, $numrad, $tipotra, $datos, $codigoEmpresa = '', $version = '1510') {

        require_once ($_SESSION["generales"]["pathabsoluto"] . '/configuracion/common.php');
        require_once ($_SESSION["generales"]["pathabsoluto"] . '/api/log.php');

        //
        if ($version == '1510') {
            $arreglo = array(
                'cambidom' => 'N',
                'datosbasicos' => 'S',
                'perjur' => 'S',
                'ubicacion' => 'S',
                'repleg' => 'S',
                'facultades' => 'S',
                'clasi1510' => 'S',
                'inffin1510' => 'S',
                'sitcontrol' => 'S',
                'exp1510' => 'S'
            );
        }


        if (empty($datos)) {
            return $arreglo;
        }

        if (trim($numliq) == '') {
            return $arreglo;
        }

        if (trim($numliq) == '0') {
            return $arreglo;
        }

        if (trim($tipotra) == 'inscripcionproponente') {
            if ($version == '1510') {
                return $arreglo;
            }
        }

        if (trim($tipotra) == 'cancelacionproponente') {
            if ($version == '1510') {
                $arreglo = array(
                    'cambidom' => 'N',
                    'datosbasicos' => 'N',
                    'perjur' => 'N',
                    'ubicacion' => 'N',
                    'repleg' => 'N',
                    'facultades' => 'N',
                    'clasi1510' => 'N',
                    'sitcontrol' => 'N',
                    'inffin1510' => 'N',
                    'exp1510' => 'N'
                );
            }
            return $arreglo;
        }

        if (trim($tipotra) == 'cambiodomicilioproponente') {
            if ($version == '1510') {
                $arreglo = array(
                    'cambidom' => 'S',
                    'datosbasicos' => 'S',
                    'perjur' => 'S',
                    'ubicacion' => 'S',
                    'repleg' => 'S',
                    'facultades' => 'S',
                    'clasi1510' => 'S',
                    'sitcontrol' => 'S',
                    'inffin1510' => 'S',
                    'exp1510' => 'S'
                );
            }

            return $arreglo;
        }

        if (trim($tipotra) == 'actualizacionespecial') {
            if ($version == '1510') {
                $arreglo = array(
                    'cambidom' => 'S',
                    'datosbasicos' => 'S',
                    'perjur' => 'S',
                    'ubicacion' => 'S',
                    'repleg' => 'S',
                    'facultades' => 'S',
                    'clasi1510' => 'S',
                    'sitcontrol' => 'S',
                    'inffin1510' => 'S',
                    'exp1510' => 'S'
                );
            }
            return $arreglo;
        }

        if (trim($tipotra) == '') {
            return $arreglo;
        }

        //

        $datosliq = 0;
        $arrTem = retornarRegistrosMysqliApi($dbx, 'mreg_liquidaciondatosoriginal', "idliquidacion=" . $numliq);
        if ($arrTem && !empty($arrTem)) {
            $datosliq = $arrTem["xml"];
        }
        // $datosliq = retornarLiquidacionDatosOriginalExpedienteXml($numliq);
        //
        if ($datosliq === false) {
            $_SESSION["generales"]["mensajeerror"] = 'El sistema retorn&oacute; un error al buscar los datos originales en la tabla mreg_liquidaciondatosoriginal (false) (' . $numliq . ') (' . str_replace("'", "", $_SESSION["generales"]["mensajeerror"]) . ')';
            return false;
        }
        if ($datosliq == "0") {
            $datosliq = retornarRegistroMysqliApi($dbx, 'mreg_radicacionesdatosoriginal', "idradicacion='" . ltrim($numrad, "0") . "'", "*", "U");
            // $datosliq = retornarRadicacionDatosOriginalExpedienteXml($numrad);
            if ($datosliq === false) {
                $_SESSION["generales"]["mensajeerror"] = 'El sistema retorn&oacute; un error al buscar los datos originales en la tabla mreg_radicacionesdatosoriginal (false) (' . $numrad . ') (' . str_replace("'", "", $_SESSION["generales"]["mensajeerror"]) . ')';
                return false;
            }
            if ($datosliq == "0" || empty($datosliq)) {
                $_SESSION["generales"]["mensajeerror"] = 'El sistema no localiz&oacute; los datos originales de la radicacion, se hace imposible encontrar las diferencias (' . $numrad . ')';
                return false;
            }
        }

        //
        if ((trim($tipotra) == 'actualizacionproponente') || (trim($tipotra) == 'renovacionproponente')) {

            if ($version == '1510') {
                $arreglo = array(
                    'cambidom' => 'N',
                    'datosbasicos' => 'N',
                    'perjur' => 'N',
                    'ubicacion' => 'N',
                    'repleg' => 'N',
                    'facultades' => 'N',
                    'clasi1510' => 'N',
                    'inffin1510' => 'N',
                    'sitcontrol' => 'N',
                    'exp1510' => 'N'
                );

                //
                $datosoriginal = \funcionesGenerales::desserializarExpedienteProponente($dbx, $datosliq["xml"], '', 'no', 'Recuperando datos originales');

                // Verifica si los datos b&aacute;sicos
                if (
                        ($datosoriginal["nombre"]) != ($datos["nombre"]) ||
                        ($datosoriginal["idtipoidentificacion"]) != ($datos["idtipoidentificacion"]) ||
                        ($datosoriginal["identificacion"]) != ($datos["identificacion"]) ||
                        ($datosoriginal["tamanoempresa"]) != ($datos["tamanoempresa"]) ||
                        ($datosoriginal["nit"]) != ($datos["nit"])
                ) {
                    $arreglo["datosbasicos"] = 'S';
                }

                // Verifica si los datos de constituci&oacute;n han cambiado
                if ($datos["organizacion"] == '99') {
                    if (
                            ($datosoriginal["idtipodocperjur"]) != ($datos["idtipodocperjur"]) ||
                            ($datosoriginal["numdocperjur"]) != ($datos["numdocperjur"]) ||
                            ($datosoriginal["origendocperjur"]) != ($datos["origendocperjur"]) ||
                            ($datosoriginal["fecdocperjur"]) != ($datos["fecdocperjur"]) ||
                            ($datosoriginal["fechaconstitucion"]) != ($datos["fechaconstitucion"]) ||
                            ($datosoriginal["fechavencimiento"]) != ($datos["fechavencimiento"])
                    ) {
                        $arreglo["perjur"] = 'S';
                    }
                }

                // Verifica si los datos de ubicaci&oacute;n
                if (
                        (trim($datosoriginal["dircom"])) != (trim($datos["dircom"])) ||
                        (trim($datosoriginal["muncom"])) != (trim($datos["muncom"])) ||
                        (trim($datosoriginal["telcom1"])) != (trim($datos["telcom1"])) ||
                        (trim($datosoriginal["telcom2"])) != (trim($datos["telcom2"])) ||
                        (trim($datosoriginal["faxcom"])) != (trim($datos["faxcom"])) ||
                        (trim($datosoriginal["celcom"])) != (trim($datos["celcom"])) ||
                        (trim($datosoriginal["emailcom"])) != (trim($datos["emailcom"])) ||
                        (trim($datosoriginal["dirnot"])) != (trim($datos["dirnot"])) ||
                        (trim($datosoriginal["munnot"])) != (trim($datos["munnot"])) ||
                        (trim($datosoriginal["telnot"])) != (trim($datos["telnot"])) ||
                        (trim($datosoriginal["celnot"])) != (trim($datos["celnot"])) ||
                        (trim($datosoriginal["faxnot"])) != (trim($datos["faxnot"])) ||
                        (trim($datosoriginal["emailnot"])) != (trim($datos["emailnot"]))
                ) {
                    $arreglo["ubicacion"] = 'S';
                }

                // Si cambian los representantes legales
                if ($datos["organizacion"] == '99') {
                    if ($datosoriginal["representanteslegales"] != $datos["representanteslegales"]) {
                        $arreglo["repleg"] = 'S';
                    }
                }

                // Si cambian las facultades
                if ($datos["organizacion"] == '99') {
                    if ($datosoriginal["facultades"] != $datos["facultades"]) {
                        $arreglo["facultades"] = 'S';
                    }
                }

                // Si cambian los datos de la situaci&oacute;n de control
                if ($datosoriginal["sitcontrol"] != $datos["sitcontrol"]) {
                    $arreglo["sitcontrol"] = 'S';
                }

                // Si cambia la clasificaci&oacute;n
                $clasiori = array();
                if (!empty($datosoriginal["clasi1510"])) {
                    foreach ($datosoriginal["clasi1510"] as $cnt) {
                        if (!isset($clasiori[$cnt])) {
                            $clasiori[$cnt] = $cnt;
                        }
                    }
                }
                asort($clasiori);

                //
                $clasi = array();
                foreach ($datos["clasi1510"] as $cnt) {
                    if (!isset($clasi[$cnt])) {
                        $clasi[$cnt] = $cnt;
                    }
                }


                asort($clasi);
                if ($clasiori != $clasi) {
                    $arreglo["clasi1510"] = 'S';
                }
                unset($clasiori);
                unset($clasi);


                // Si cambia la informaci&oacute;n financiera
                // 2017-06-29: JINT: Se ajusta la rutina para validar solamente los datos financieros requeridos por proponentes
                if (
                        (ltrim($datosoriginal["inffin1510_fechacorte"], '0') != ltrim($datos["inffin1510_fechacorte"], '0')) ||
                        (floatval($datosoriginal["inffin1510_actcte"]) != floatval($datos["inffin1510_actcte"])) ||
                        // (floatval($datosoriginal["inffin1510_actnocte"]) != floatval($datos["inffin1510_actnocte"])) ||
                        // (floatval($datosoriginal["inffin1510_fijnet"]) != floatval($datos["inffin1510_fijnet"])) ||
                        (floatval($datosoriginal["inffin1510_acttot"]) != floatval($datos["inffin1510_acttot"])) ||
                        (floatval($datosoriginal["inffin1510_pascte"]) != floatval($datos["inffin1510_pascte"])) ||
                        (floatval($datosoriginal["inffin1510_pastot"]) != floatval($datos["inffin1510_pastot"])) ||
                        (floatval($datosoriginal["inffin1510_patnet"]) != floatval($datos["inffin1510_patnet"])) ||
                        // (floatval($datosoriginal["inffin1510_paspat"]) != floatval($datos["inffin1510_paspat"])) ||
                        // (floatval($datosoriginal["inffin1510_balsoc"]) != floatval($datos["inffin1510_balsoc"])) ||
                        (floatval($datosoriginal["inffin1510_utiope"]) != floatval($datos["inffin1510_utiope"])) ||
                        // (floatval($datosoriginal["inffin1510_utinet"]) != floatval($datos["inffin1510_utinet"])) ||
                        // (floatval($datosoriginal["inffin1510_ingope"]) != floatval($datos["inffin1510_ingope"])) ||
                        // (floatval($datosoriginal["inffin1510_ingnoope"]) != floatval($datos["inffin1510_ingnoope"])) ||
                        // (floatval($datosoriginal["inffin1510_gasope"]) != floatval($datos["inffin1510_gasope"])) ||
                        // (floatval($datosoriginal["inffin1510_cosven"]) != floatval($datos["inffin1510_cosven"])) ||
                        // (floatval($datosoriginal["inffin1510_gasimp"]) != floatval($datos["inffin1510_gasimp"])) ||
                        (floatval($datosoriginal["inffin1510_gasint"]) != floatval($datos["inffin1510_gasint"]))
                // (floatval($datosoriginal["inffin1510_indliq"])!=floatval($datos["inffin1510_indliq"])) ||
                // (floatval($datosoriginal["inffin1510_nivend"])!=floatval($datos["inffin1510_nivend"])) ||
                // (floatval($datosoriginal["inffin1510_razcob"])!=floatval($datos["inffin1510_razcob"])) ||
                // (floatval($datosoriginal["inffin1510_renpat"])!=floatval($datos["inffin1510_renpat"])) ||
                // (floatval($datosoriginal["inffin1510_renact"])!=floatval($datos["inffin1510_renact"])) 
                ) {
                    $arreglo["inffin1510"] = 'S';
                }

                // Verificaci&oacute;n de la experiencia
                $arrTemAnt = array();
                if (!empty($datosoriginal["exp1510"])) {
                    foreach ($datosoriginal["exp1510"] as $cnt) {
                        $arrTemAnt[$cnt["secuencia"]] = $cnt;
                        $arrTemAnt[$cnt["secuencia"]]["elimino"] = 'si';
                    }
                }

                foreach ($datos["exp1510"] as $cnt) {
                    $sec = sprintf("%03s", $cnt["secuencia"]);
                    if (!isset($arrTemAnt[$sec])) {
                        $arreglo["exp1510-" . $sec] = 'S';
                        $arreglo["exp1510"] = 'S';
                    } else {
                        if (!isset($arrTemAnt[$sec]["clasif"]))
                            $arrTemAnt[$sec]["clasif"] = array();
                        if (!isset($cnt["clasif"]))
                            $cnt["clasif"] = array();
                        $arrTemAnt[$sec]["elimino"] = 'no';
                        if ($arrTemAnt[$sec]["celebradopor"] != $cnt["celebradopor"] ||
                                $arrTemAnt[$sec]["nombrecontratista"] != $cnt["nombrecontratista"] ||
                                $arrTemAnt[$sec]["nombrecontratante"] != $cnt["nombrecontratante"] ||
                                floatval($arrTemAnt[$sec]["valor"]) != floatval($cnt["valor"]) ||
                                $arrTemAnt[$sec]["clasif"] != $cnt["clasif"] ||
                                floatval($arrTemAnt[$sec]["porcentaje"]) != floatval($cnt["porcentaje"])
                        ) {
                            $arreglo["exp1510-" . $sec] = 'S';
                            $arreglo["exp1510"] = 'S';
                        } else {
                            $arreglo["exp1510-" . $sec] = 'N';
                        }
                    }
                }

                foreach ($arrTemAnt as $sec => $cnt) {
                    if ($cnt["elimino"] == 'si') {
                        $arreglo["exp1510-" . $sec] = 'E';
                        $arreglo["exp1510"] = 'S';
                    }
                }
            }

            return $arreglo;
        }
    }

}
